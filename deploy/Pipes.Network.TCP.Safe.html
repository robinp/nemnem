<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Rank2Types, TypeFamilies #-}

</span><span class="hl_comment"><span class="mpre">-- | This module exports facilities allowing you to safely obtain, use and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- release &#39;Socket&#39; resources within a /Pipes/ pipeline, by relying on</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @pipes-safe@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This module is meant to be used as a replacement of &quot;Pipes.Network.TCP&quot;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- and as such it overrides some functions from &quot;Network.Simple.TCP&quot; so that</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- they use &#39;Ps.MonadSafe&#39; instead of &#39;IO&#39; as their base monad. Additionally,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- It also exports pipes that establish a TCP connection and interact with</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- it in a streaming fashion at once.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If you just want to use &#39;Socket&#39; obtained outside the /Pipes/ pipeline,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- then you can just ignore this module and use the simpler module</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;Pipes.Network.TCP&quot; instead.</span></span><span class="mpre">

module Pipes.Network.TCP.Safe (
  </span><span class="hl_comment"><span class="mpre">-- * @MonadSafe@-compatible upgrades</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- $network-simple-upgrades</span></span><span class="mpre">
    connect
  , serve
  , listen
  , accept
  </span><span class="hl_comment"><span class="mpre">-- * Streaming</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- ** Client side</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- $client-streaming</span></span><span class="mpre">
  , fromConnect
  , toConnect
  </span><span class="hl_comment"><span class="mpre">-- ** Server side</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- $server-streaming</span></span><span class="mpre">
  , fromServe
  , toServe
  </span><span class="hl_comment"><span class="mpre">-- * Exports</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- $exports</span></span><span class="mpre">
  , module Pipes.Network.TCP
  , module Network.Simple.TCP
  , module Pipes.Safe
  ) where

import           Control.Monad
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 41, srcSpanStartColumn = 18, srcSpanEndLine = 41, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre">        as B
import           Network.Simple.TCP
                  (</span><a href="Network.Simple.TCP.html#loc_225_1_225_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.TCP.html#loc_225_1_225_11&#39;)"><span class="mpre">acceptFork</span></a><span class="mpre">, </span><a href="Network.Simple.TCP.html#loc_265_1_265_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.TCP.html#loc_265_1_265_9&#39;)"><span class="mpre">bindSock</span></a><span class="mpre">, </span><a href="Network.Simple.TCP.html#loc_245_1_245_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.TCP.html#loc_245_1_245_12&#39;)"><span class="mpre">connectSock</span></a><span class="mpre">, </span><a href="Network.Simple.TCP.html#loc_307_1_307_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.TCP.html#loc_307_1_307_5&#39;)"><span class="mpre">recv</span></a><span class="mpre">, </span><a href="Network.Simple.TCP.html#loc_316_1_316_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.TCP.html#loc_316_1_316_5&#39;)"><span class="mpre">send</span></a><span class="mpre">, withSocketsDo,
                   HostName, </span><a href="Network.Simple.Internal.html#loc_17_6_17_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.Internal.html#loc_17_6_17_20&#39;)"><span class="mpre">HostPreference</span></a><span class="mpre">(HostAny, HostIPv4, HostIPv6, Host),
                   ServiceName, SockAddr, Socket)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 46, srcSpanStartColumn = 18, srcSpanEndLine = 46, srcSpanEndColumn = 32}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre">         as NS
import           Pipes
import           Pipes.Network.TCP
                  (</span><a href="Pipes.Network.TCP.html#loc_75_1_75_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.Network.TCP.html#loc_75_1_75_11&#39;)"><span class="mpre">fromSocket</span></a><span class="mpre">, </span><a href="Pipes.Network.TCP.html#loc_90_1_90_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.Network.TCP.html#loc_90_1_90_18&#39;)"><span class="mpre">fromSocketTimeout</span></a><span class="mpre">, </span><a href="Pipes.Network.TCP.html#loc_112_1_112_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.Network.TCP.html#loc_112_1_112_12&#39;)"><span class="mpre">fromSocketN</span></a><span class="mpre">,
                   </span><a href="Pipes.Network.TCP.html#loc_128_1_128_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.Network.TCP.html#loc_128_1_128_19&#39;)"><span class="mpre">fromSocketTimeoutN</span></a><span class="mpre">, </span><a href="Pipes.Network.TCP.html#loc_155_1_155_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.Network.TCP.html#loc_155_1_155_9&#39;)"><span class="mpre">toSocket</span></a><span class="mpre">, </span><a href="Pipes.Network.TCP.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.Network.TCP.html#loc_165_1_165_16&#39;)"><span class="mpre">toSocketTimeout</span></a><span class="mpre">)
import qualified Pipes.Safe             as Ps
import           Pipes.Safe             (</span><a href="Pipes.Safe.html#loc_236_1_236_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.Safe.html#loc_236_1_236_9&#39;)"><span class="mpre">runSafeT</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- $network-simple-upgrades</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The following functions are analogous versions of those exported by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;Network.Simple.TCP&quot;, but compatible with &#39;Ps.MonadSafe&#39;.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Like &#39;Network.Simple.TCP.connect&#39; from &quot;Network.Simple.TCP&quot;, but compatible</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- with &#39;Ps.MonadSafe&#39;.</span></span><span class="mpre">
</span><a href="#loc_66_1_66_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_8&#39;)"><span class="mpre">connect</span></a><span class="mpre">
  :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 64, srcSpanStartColumn = 6, srcSpanEndLine = 65, srcSpanEndColumn = 5}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 3, srcSpanEndLine = 65, srcSpanEndColumn = 5}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/ne"><span class="mpre">Ps.MonadSafe m
  =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HostName</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ServiceName</span></span><span class="mpre"> -&gt; ((</span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">SockAddr</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">
</span><a name="loc_66_1_66_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_8&#39;)"><span class="hl_fundecl"><span class="mpre">connect</span></span></a><span class="mpre"> </span><a name="loc_66_9_66_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_9_66_13&#39;)"><span class="hl_vardecl"><span class="mpre">host</span></span></a><span class="mpre"> </span><a name="loc_66_14_66_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_14_66_18&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> = </span><a href="Pipes.Safe.html#loc_408_1_408_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.Safe.html#loc_408_1_408_8&#39;)"><span class="hl_varref"><span class="mpre">Ps.bracket</span></span></a><span class="mpre"> (</span><a href="Network.Simple.TCP.html#loc_245_1_245_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.TCP.html#loc_245_1_245_12&#39;)"><span class="hl_varref"><span class="mpre">connectSock</span></span></a><span class="mpre"> </span><a href="#loc_66_9_66_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_9_66_13&#39;)"><span class="hl_varref"><span class="mpre">host</span></span></a><span class="mpre"> </span><a href="#loc_66_14_66_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_14_66_18&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre">)
                               (</span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">NS.sClose</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fst</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Like &#39;Network.Simple.TCP.serve&#39; from &quot;Network.Simple.TCP&quot;, but compatible</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- with &#39;Ps.MonadSafe&#39;.</span></span><span class="mpre">
</span><a href="#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_6&#39;)"><span class="mpre">serve</span></a><span class="mpre">
  :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 72, srcSpanStartColumn = 6, srcSpanEndLine = 73, srcSpanEndColumn = 5}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 73, srcSpanStartColumn = 3, srcSpanEndLine = 73, srcSpanEndColumn = 5}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/ne"><span class="mpre">Ps.MonadSafe m
  =&gt;</span></span><span class="mpre"> </span><a href="Network.Simple.Internal.html#loc_17_6_17_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.Internal.html#loc_17_6_17_20&#39;)"><span class="hl_tyconref"><span class="mpre">HostPreference</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ServiceName</span></span><span class="mpre"> -&gt; ((</span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">SockAddr</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">
</span><a name="loc_74_1_74_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_6&#39;)"><span class="hl_fundecl"><span class="mpre">serve</span></span></a><span class="mpre"> </span><a name="loc_74_7_74_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_7_74_9&#39;)"><span class="hl_vardecl"><span class="mpre">hp</span></span></a><span class="mpre"> </span><a name="loc_74_10_74_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_10_74_14&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> </span><a name="loc_74_15_74_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_15_74_16&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = do
   </span><a href="#loc_83_1_83_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_7&#39;)"><span class="hl_varref"><span class="mpre">listen</span></span></a><span class="mpre"> </span><a href="#loc_74_7_74_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_7_74_9&#39;)"><span class="hl_varref"><span class="mpre">hp</span></span></a><span class="mpre"> </span><a href="#loc_74_10_74_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_10_74_14&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_75_23_75_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_23_75_28&#39;)"><span class="hl_vardecl"><span class="mpre">lsock</span></span></a><span class="mpre">,_) -&gt; do
      </span><a href="Control.Monad.html#loc_189_1_189_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_189_1_189_8&#39;)"><span class="hl_varref"><span class="mpre">forever</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Simple.TCP.html#loc_225_1_225_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.TCP.html#loc_225_1_225_11&#39;)"><span class="hl_varref"><span class="mpre">acceptFork</span></span></a><span class="mpre"> </span><a href="#loc_75_23_75_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_23_75_28&#39;)"><span class="hl_varref"><span class="mpre">lsock</span></span></a><span class="mpre"> </span><a href="#loc_74_15_74_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_15_74_16&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Like &#39;Network.Simple.TCP.listen&#39; from &quot;Network.Simple.TCP&quot;, but compatible</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- with &#39;Ps.MonadSafe&#39;.</span></span><span class="mpre">
</span><a href="#loc_83_1_83_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_7&#39;)"><span class="mpre">listen</span></a><span class="mpre">
  :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 81, srcSpanStartColumn = 6, srcSpanEndLine = 82, srcSpanEndColumn = 5}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 82, srcSpanStartColumn = 3, srcSpanEndLine = 82, srcSpanEndColumn = 5}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/ne"><span class="mpre">Ps.MonadSafe m
  =&gt;</span></span><span class="mpre"> </span><a href="Network.Simple.Internal.html#loc_17_6_17_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.Internal.html#loc_17_6_17_20&#39;)"><span class="hl_tyconref"><span class="mpre">HostPreference</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ServiceName</span></span><span class="mpre"> -&gt; ((</span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">SockAddr</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">
</span><a name="loc_83_1_83_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_7&#39;)"><span class="hl_fundecl"><span class="mpre">listen</span></span></a><span class="mpre"> </span><a name="loc_83_8_83_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_8_83_10&#39;)"><span class="hl_vardecl"><span class="mpre">hp</span></span></a><span class="mpre"> </span><a name="loc_83_11_83_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_11_83_15&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> = </span><a href="Pipes.Safe.html#loc_408_1_408_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.Safe.html#loc_408_1_408_8&#39;)"><span class="hl_varref"><span class="mpre">Ps.bracket</span></span></a><span class="mpre"> </span><a href="#loc_85_5_85_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_5_85_12&#39;)"><span class="hl_varref"><span class="mpre">listen&#39;</span></span></a><span class="mpre"> (</span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">NS.sClose</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fst</span></span><span class="mpre">)
  where
    </span><a name="loc_85_5_85_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_5_85_12&#39;)"><span class="hl_vardecl"><span class="mpre">listen&#39;</span></span></a><span class="mpre"> = </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><a name="loc_86_9_86_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_10&#39;)"><span class="hl_specname"><span class="mpre">x</span></span></a><span class="mpre">@(</span><a name="loc_86_12_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_12_86_17&#39;)"><span class="hl_vardecl"><span class="mpre">bsock</span></span></a><span class="mpre">,_) &lt;- </span><a href="Network.Simple.TCP.html#loc_265_1_265_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.TCP.html#loc_265_1_265_9&#39;)"><span class="hl_varref"><span class="mpre">bindSock</span></span></a><span class="mpre"> </span><a href="#loc_83_8_83_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_8_83_10&#39;)"><span class="hl_varref"><span class="mpre">hp</span></span></a><span class="mpre"> </span><a href="#loc_83_11_83_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_11_83_15&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">NS.listen</span></span><span class="mpre"> </span><a href="#loc_86_12_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_12_86_17&#39;)"><span class="hl_varref"><span class="mpre">bsock</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">max</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2048</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">NS.maxListenQueue</span></span><span class="mpre">)
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_86_9_86_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_10&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Like &#39;Network.Simple.TCP.accept&#39; from &quot;Network.Simple.TCP&quot;, but compatible</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- with &#39;Ps.MonadSafe&#39;.</span></span><span class="mpre">
</span><a href="#loc_95_1_95_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_1_95_7&#39;)"><span class="mpre">accept</span></a><span class="mpre">
  :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 93, srcSpanStartColumn = 6, srcSpanEndLine = 94, srcSpanEndColumn = 5}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 94, srcSpanStartColumn = 3, srcSpanEndLine = 94, srcSpanEndColumn = 5}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/ne"><span class="mpre">Ps.MonadSafe m
  =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; ((</span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">SockAddr</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">
</span><a name="loc_95_1_95_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_1_95_7&#39;)"><span class="hl_fundecl"><span class="mpre">accept</span></span></a><span class="mpre"> </span><a name="loc_95_8_95_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_8_95_13&#39;)"><span class="hl_vardecl"><span class="mpre">lsock</span></span></a><span class="mpre"> </span><a name="loc_95_14_95_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_14_95_15&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = do
    </span><a name="loc_96_5_96_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_5_96_9&#39;)"><span class="hl_specname"><span class="mpre">conn</span></span></a><span class="mpre">@(</span><a name="loc_96_11_96_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_11_96_16&#39;)"><span class="hl_vardecl"><span class="mpre">csock</span></span></a><span class="mpre">,_) &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">NS.accept</span></span><span class="mpre"> </span><a href="#loc_95_8_95_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_8_95_13&#39;)"><span class="hl_varref"><span class="mpre">lsock</span></span></a><span class="mpre">)
    </span><a href="Pipes.Safe.html#loc_401_4_401_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.Safe.html#loc_401_4_401_13&#39;)"><span class="hl_varref"><span class="mpre">Ps.finally</span></span></a><span class="mpre"> (</span><a href="#loc_95_14_95_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_14_95_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_96_5_96_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_5_96_9&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">) (</span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">NS.sClose</span></span><span class="mpre"> </span><a href="#loc_96_11_96_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_11_96_16&#39;)"><span class="hl_varref"><span class="mpre">csock</span></span></a><span class="mpre">)
</span><span class="hl_comment"><span class="mpre">{-# INLINABLE accept #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- $client-streaming</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The following pipes allow you to easily connect to a TCP server and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- immediately interact with it in a streaming fashion, all at once, instead of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- having to perform the individual steps separately. However, keep</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in mind that you&#39;ll be able to interact with the remote end in only one</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- direction, that is, you&#39;ll either send or receive data, but not both.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Connect to a TCP server and send downstream the bytes received from the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- remote end.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The connection socket is closed when done or in case of exceptions.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Using this &#39;Producer&#39;&#39; you can write straightforward code like the following,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- which prints whatever is received from a single TCP connection to a given</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- server listening locally on port 9000, in chunks of up to 4096 bytes:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; runSafeT . runEffect $ fromConnect 4096 &quot;127.0.0.1&quot; &quot;9000&quot; &gt;-&gt; P.print</span></span><span class="mpre">
</span><a href="#loc_131_1_131_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_1_131_12&#39;)"><span class="mpre">fromConnect</span></a><span class="mpre">
  :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 123, srcSpanStartColumn = 6, srcSpanEndLine = 124, srcSpanEndColumn = 5}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 124, srcSpanStartColumn = 3, srcSpanEndLine = 124, srcSpanEndColumn = 5}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagran"><span class="mpre">Ps.MonadSafe m
  =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">             </span><span class="hl_comment"><span class="mpre">-- ^Maximum number of bytes to receive and send</span></span><span class="mpre">
                     </span><span class="hl_comment"><span class="mpre">-- dowstream at once. Any positive value is fine, the</span></span><span class="mpre">
                     </span><span class="hl_comment"><span class="mpre">-- optimal value depends on how you deal with the</span></span><span class="mpre">
                     </span><span class="hl_comment"><span class="mpre">-- received data. Try using @4096@ if you don&#39;t care.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyconref"><span class="mpre">HostName</span></span><span class="mpre">        </span><span class="hl_comment"><span class="mpre">-- ^Server host name.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyconref"><span class="mpre">ServiceName</span></span><span class="mpre">     </span><span class="hl_comment"><span class="mpre">-- ^Server service port.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyconref"><span class="mpre">Producer&#39;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_131_1_131_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_1_131_12&#39;)"><span class="hl_fundecl"><span class="mpre">fromConnect</span></span></a><span class="mpre"> </span><a name="loc_131_13_131_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_13_131_19&#39;)"><span class="hl_vardecl"><span class="mpre">nbytes</span></span></a><span class="mpre"> </span><a name="loc_131_20_131_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_20_131_24&#39;)"><span class="hl_vardecl"><span class="mpre">host</span></span></a><span class="mpre"> </span><a name="loc_131_25_131_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_25_131_29&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> = do
   </span><a href="#loc_66_1_66_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_8&#39;)"><span class="hl_varref"><span class="mpre">connect</span></span></a><span class="mpre"> </span><a href="#loc_131_20_131_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_20_131_24&#39;)"><span class="hl_varref"><span class="mpre">host</span></span></a><span class="mpre"> </span><a href="#loc_131_25_131_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_25_131_29&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_132_26_132_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_26_132_31&#39;)"><span class="hl_vardecl"><span class="mpre">csock</span></span></a><span class="mpre">,_) -&gt; do
      </span><a href="Pipes.Network.TCP.html#loc_75_1_75_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.Network.TCP.html#loc_75_1_75_11&#39;)"><span class="hl_varref"><span class="mpre">fromSocket</span></span></a><span class="mpre"> </span><a href="#loc_132_26_132_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_26_132_31&#39;)"><span class="hl_varref"><span class="mpre">csock</span></span></a><span class="mpre"> </span><a href="#loc_131_13_131_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_13_131_19&#39;)"><span class="hl_varref"><span class="mpre">nbytes</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Connects to a TCP server, sends to the remote end the bytes received from</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- upstream.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The connection socket is closed in case of exceptions.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Using this &#39;Consumer&#39;&#39; you can write straightforward code like the following,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- which greets a TCP client listening locally at port 9000:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; :set -XOverloadedStrings</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; runSafeT . runEffect $ each [&quot;He&quot;,&quot;llo\r\n&quot;] &gt;-&gt; toConnect &quot;127.0.0.1&quot; &quot;9000&quot;</span></span><span class="mpre">
</span><a href="#loc_150_1_150_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_1_150_10&#39;)"><span class="mpre">toConnect</span></a><span class="mpre">
  :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 146, srcSpanStartColumn = 6, srcSpanEndLine = 147, srcSpanEndColumn = 5}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 147, srcSpanStartColumn = 3, srcSpanEndLine = 147, srcSpanEndColumn = 5}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagran"><span class="mpre">Ps.MonadSafe m
  =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HostName</span></span><span class="mpre">        </span><span class="hl_comment"><span class="mpre">-- ^Server host name.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyconref"><span class="mpre">ServiceName</span></span><span class="mpre">     </span><span class="hl_comment"><span class="mpre">-- ^Server service port.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyconref"><span class="mpre">Consumer&#39;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">
</span><a name="loc_150_1_150_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_1_150_10&#39;)"><span class="hl_fundecl"><span class="mpre">toConnect</span></span></a><span class="mpre"> </span><a name="loc_150_11_150_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_11_150_13&#39;)"><span class="hl_vardecl"><span class="mpre">hp</span></span></a><span class="mpre"> </span><a name="loc_150_14_150_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_14_150_18&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> = do
   </span><a href="#loc_66_1_66_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_8&#39;)"><span class="hl_varref"><span class="mpre">connect</span></span></a><span class="mpre"> </span><a href="#loc_150_11_150_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_11_150_13&#39;)"><span class="hl_varref"><span class="mpre">hp</span></span></a><span class="mpre"> </span><a href="#loc_150_14_150_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_14_150_18&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_151_24_151_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_24_151_29&#39;)"><span class="hl_vardecl"><span class="mpre">csock</span></span></a><span class="mpre">,_) -&gt; do
      </span><a href="Pipes.Network.TCP.html#loc_155_1_155_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.Network.TCP.html#loc_155_1_155_9&#39;)"><span class="hl_varref"><span class="mpre">toSocket</span></span></a><span class="mpre"> </span><a href="#loc_151_24_151_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_24_151_29&#39;)"><span class="hl_varref"><span class="mpre">csock</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- $server-streaming</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The following pipes allow you to easily run a TCP server and immediately</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- interact with incoming connections in a streaming fashion, all at once,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- instead of having to perform the individual steps separately. However, keep</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in mind that you&#39;ll be able to interact with the remote end in only one</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- direction, that is, you&#39;ll either send or receive data, but not both.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Binds a listening socket, accepts a single connection and sends downstream</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- any bytes received from the remote end.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Less than the specified maximum number of bytes might be received at once.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This &#39;Producer&#39;&#39; returns if the remote peer closes its side of the connection</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- or EOF is received.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Both the listening and connection sockets are closed when done or in case of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exceptions.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Using this &#39;Producer&#39;&#39; you can write straightforward code like the following,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- which prints whatever is received from a single TCP connection to port 9000,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in chunks of up to 4096 bytes.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; :set -XOverloadedStrings</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; runSafeT . runEffect $ fromServe 4096 &quot;127.0.0.1&quot; &quot;9000&quot; &gt;-&gt; P.print</span></span><span class="mpre">
</span><a href="#loc_192_1_192_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_1_192_10&#39;)"><span class="mpre">fromServe</span></a><span class="mpre">
  :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 184, srcSpanStartColumn = 6, srcSpanEndLine = 185, srcSpanEndColumn = 5}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 185, srcSpanStartColumn = 3, srcSpanEndLine = 185, srcSpanEndColumn = 5}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagran"><span class="mpre">Ps.MonadSafe m
  =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">             </span><span class="hl_comment"><span class="mpre">-- ^Maximum number of bytes to receive and send</span></span><span class="mpre">
                     </span><span class="hl_comment"><span class="mpre">-- dowstream at once. Any positive value is fine, the</span></span><span class="mpre">
                     </span><span class="hl_comment"><span class="mpre">-- optimal value depends on how you deal with the</span></span><span class="mpre">
                     </span><span class="hl_comment"><span class="mpre">-- received data. Try using @4096@ if you don&#39;t care.</span></span><span class="mpre">
  -&gt; </span><a href="Network.Simple.Internal.html#loc_17_6_17_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.Internal.html#loc_17_6_17_20&#39;)"><span class="hl_tyconref"><span class="mpre">HostPreference</span></span></a><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^Preferred host to bind.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyconref"><span class="mpre">ServiceName</span></span><span class="mpre">     </span><span class="hl_comment"><span class="mpre">-- ^Service port to bind.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyconref"><span class="mpre">Producer&#39;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_192_1_192_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_1_192_10&#39;)"><span class="hl_fundecl"><span class="mpre">fromServe</span></span></a><span class="mpre"> </span><a name="loc_192_11_192_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_11_192_17&#39;)"><span class="hl_vardecl"><span class="mpre">nbytes</span></span></a><span class="mpre"> </span><a name="loc_192_18_192_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_18_192_20&#39;)"><span class="hl_vardecl"><span class="mpre">hp</span></span></a><span class="mpre"> </span><a name="loc_192_21_192_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_21_192_25&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> = do
   </span><a href="#loc_83_1_83_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_7&#39;)"><span class="hl_varref"><span class="mpre">listen</span></span></a><span class="mpre"> </span><a href="#loc_192_18_192_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_18_192_20&#39;)"><span class="hl_varref"><span class="mpre">hp</span></span></a><span class="mpre"> </span><a href="#loc_192_21_192_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_21_192_25&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_193_23_193_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_23_193_28&#39;)"><span class="hl_vardecl"><span class="mpre">lsock</span></span></a><span class="mpre">,_) -&gt; do
      </span><a href="#loc_95_1_95_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_1_95_7&#39;)"><span class="hl_varref"><span class="mpre">accept</span></span></a><span class="mpre"> </span><a href="#loc_193_23_193_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_23_193_28&#39;)"><span class="hl_varref"><span class="mpre">lsock</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_194_24_194_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_24_194_29&#39;)"><span class="hl_vardecl"><span class="mpre">csock</span></span></a><span class="mpre">,_) -&gt; do
         </span><a href="Pipes.Network.TCP.html#loc_75_1_75_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.Network.TCP.html#loc_75_1_75_11&#39;)"><span class="hl_varref"><span class="mpre">fromSocket</span></span></a><span class="mpre"> </span><a href="#loc_194_24_194_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_24_194_29&#39;)"><span class="hl_varref"><span class="mpre">csock</span></span></a><span class="mpre"> </span><a href="#loc_192_11_192_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_11_192_17&#39;)"><span class="hl_varref"><span class="mpre">nbytes</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Binds a listening socket, accepts a single connection, sends to the remote</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- end the bytes received from upstream.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Both the listening and connection sockets are closed when done or in case of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exceptions.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Using this &#39;Consumer&#39;&#39; you can write straightforward code like the following,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- which greets a TCP client connecting to port 9000:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; :set -XOverloadedStrings</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; runSafeT . runEffect $ each [&quot;He&quot;,&quot;llo\r\n&quot;] &gt;-&gt; toServe &quot;127.0.0.1&quot; &quot;9000&quot;</span></span><span class="mpre">
</span><a href="#loc_213_1_213_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_1_213_8&#39;)"><span class="mpre">toServe</span></a><span class="mpre">
  :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 209, srcSpanStartColumn = 6, srcSpanEndLine = 210, srcSpanEndColumn = 5}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-network-0.6.3/src/Pipes/Network/TCP/Safe.hs&quot;, srcSpanStartLine = 210, srcSpanStartColumn = 3, srcSpanEndLine = 210, srcSpanEndColumn = 5}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagran"><span class="mpre">Ps.MonadSafe m
  =&gt;</span></span><span class="mpre"> </span><a href="Network.Simple.Internal.html#loc_17_6_17_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.Internal.html#loc_17_6_17_20&#39;)"><span class="hl_tyconref"><span class="mpre">HostPreference</span></span></a><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^Preferred host to bind.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyconref"><span class="mpre">ServiceName</span></span><span class="mpre">     </span><span class="hl_comment"><span class="mpre">-- ^Service port to bind.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyconref"><span class="mpre">Consumer&#39;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">
</span><a name="loc_213_1_213_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_1_213_8&#39;)"><span class="hl_fundecl"><span class="mpre">toServe</span></span></a><span class="mpre"> </span><a name="loc_213_9_213_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_9_213_11&#39;)"><span class="hl_vardecl"><span class="mpre">hp</span></span></a><span class="mpre"> </span><a name="loc_213_12_213_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_12_213_16&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> = do
   </span><a href="#loc_83_1_83_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_7&#39;)"><span class="hl_varref"><span class="mpre">listen</span></span></a><span class="mpre"> </span><a href="#loc_213_9_213_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_9_213_11&#39;)"><span class="hl_varref"><span class="mpre">hp</span></span></a><span class="mpre"> </span><a href="#loc_213_12_213_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_12_213_16&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_214_23_214_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_23_214_28&#39;)"><span class="hl_vardecl"><span class="mpre">lsock</span></span></a><span class="mpre">,_) -&gt; do
      </span><a href="#loc_95_1_95_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_1_95_7&#39;)"><span class="hl_varref"><span class="mpre">accept</span></span></a><span class="mpre"> </span><a href="#loc_214_23_214_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_23_214_28&#39;)"><span class="hl_varref"><span class="mpre">lsock</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_215_24_215_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_24_215_29&#39;)"><span class="hl_vardecl"><span class="mpre">csock</span></span></a><span class="mpre">,_) -&gt; do
         </span><a href="Pipes.Network.TCP.html#loc_155_1_155_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.Network.TCP.html#loc_155_1_155_9&#39;)"><span class="hl_varref"><span class="mpre">toSocket</span></span></a><span class="mpre"> </span><a href="#loc_215_24_215_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_24_215_29&#39;)"><span class="hl_varref"><span class="mpre">csock</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- $exports</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [From &quot;Pipes.Network.TCP&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;fromSocket&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;fromSocketN&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;fromSocketTimeout&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;fromSocketTimeoutN&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;toSocket&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;toSocketTimeout&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [From &quot;Network.Simple.TCP&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;acceptFork&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;bindSock&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;connectSock&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;HostPreference&#39;(&#39;HostAny&#39;,&#39;HostIPv4&#39;,&#39;HostIPv6&#39;,&#39;Host&#39;),</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;recv&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;send&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [From &quot;Network.Socket&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;HostName&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;ServiceName&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;SockAddr&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;Socket&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;withSocketsDo&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [From &quot;Pipes.Safe&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;Ps.runSafeT&#39;.</span></span><span class="mpre">

</span></div></body></html>