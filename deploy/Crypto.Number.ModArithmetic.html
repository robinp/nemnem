<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE BangPatterns #-}
{-# LANGUAGE DeriveDataTypeable #-}
{-# LANGUAGE CPP #-}
#ifndef MIN_VERSION_integer_gmp
#define MIN_VERSION_integer_gmp(a,b,c) 0
#endif
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Crypto.Number.ModArithmetic</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : Good</span></span><span class="mpre">

module Crypto.Number.ModArithmetic
    (
    </span><span class="hl_comment"><span class="mpre">-- * exponentiation</span></span><span class="mpre">
      expSafe
    , expFast
    , exponentiation_rtl_binary
    , exponentiation
    </span><span class="hl_comment"><span class="mpre">-- * deprecated name for exponentiation</span></span><span class="mpre">
    , exponantiation_rtl_binary
    , exponantiation
    </span><span class="hl_comment"><span class="mpre">-- * inverse computing</span></span><span class="mpre">
    , inverse
    , inverseCoprimes
    ) where

import Control.Exception (throw, Exception)
import Data.Typeable

#if MIN_VERSION_integer_gmp(0,5,1)
import GHC.Integer.GMP.Internals
#else
import Crypto.Number.Basic (</span><a href="Crypto.Number.Basic.html#loc_83_1_83_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.Basic.html#loc_83_1_83_12&#39;)"><span class="mpre">gcde_binary</span></a><span class="mpre">)
import Data.Bits
#endif

</span><span class="hl_comment"><span class="mpre">-- | Raised when two numbers are supposed to be coprimes but are not.</span></span><span class="mpre">
data </span><a name="loc_40_6_40_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_6_40_28&#39;)"><span class="hl_tycondecl"><span class="mpre">CoprimesAssertionError</span></span></a><span class="mpre"> = </span><a name="loc_40_31_40_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_31_40_53&#39;)"><span class="hl_condecl"><span class="mpre">CoprimesAssertionError</span></span></a><span class="mpre">
    </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-numbers-0.2.3/Crypto/Number/ModArithmetic.hs&quot;, srcSpanStartLine = 41, srcSpanStartColumn = 5, srcSpanEndLine = 41, srcSpanEndColumn = 29}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-numbers-0.2.3/Crypto/Number/ModArithmetic.hs&quot;, srcSpanStartLine = 41, srcSpanStartColumn = 5, srcSpanEndLine = 41, srcSpanEndColumn = 13},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-numbers-0.2.3/Cr"><span class="mpre">deriving (Show,Typeable)</span></span><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Exception</span></span><span class="mpre"> </span><a href="#loc_40_6_40_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_6_40_28&#39;)"><span class="hl_tyconref"><span class="mpre">CoprimesAssertionError</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Compute the modular exponentiation of base^exponant using</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- algorithms design to avoid side channels and timing measurement</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Modulo need to be odd otherwise the normal fast modular exponentiation</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is used.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- When used with integer-simple, this function is not different</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- from expFast, and thus provide the same unstudied and dubious</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- timing and side channels claims.</span></span><span class="mpre">
</span><a href="#loc_59_1_59_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_1_59_8&#39;)"><span class="mpre">expSafe</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ base</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ exponant</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ modulo</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ result</span></span><span class="mpre">
#if MIN_VERSION_integer_gmp(0,5,1)
</span><a name="loc_59_1_59_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_1_59_8&#39;)"><span class="hl_fundecl"><span class="mpre">expSafe</span></span></a><span class="mpre"> </span><a name="loc_59_9_59_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_9_59_10&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> </span><a name="loc_59_11_59_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_11_59_12&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> </span><a name="loc_59_13_59_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_13_59_14&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">odd</span></span><span class="mpre"> </span><a href="#loc_59_13_59_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_13_59_14&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">     = </span><span class="hl_varref"><span class="mpre">powModSecInteger</span></span><span class="mpre"> </span><a href="#loc_59_9_59_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_9_59_10&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><a href="#loc_59_11_59_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_11_59_12&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> </span><a href="#loc_59_13_59_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_13_59_14&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">powModInteger</span></span><span class="mpre"> </span><a href="#loc_59_9_59_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_9_59_10&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><a href="#loc_59_11_59_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_11_59_12&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> </span><a href="#loc_59_13_59_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_13_59_14&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
#else
</span><span class="hl_vardecl"><span class="mpre">expSafe</span></span><span class="mpre"> = </span><a href="#loc_104_1_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_15&#39;)"><span class="hl_varref"><span class="mpre">exponentiation</span></span></a><span class="mpre">
#endif

</span><span class="hl_comment"><span class="mpre">-- | Compute the modular exponentiation of base^exponant using</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the fastest algorithm without any consideration for</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- hiding parameters.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Use this function when all the parameters are public,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- otherwise &#39;expSafe&#39; should be prefered.</span></span><span class="mpre">
</span><a href="#loc_76_1_76_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_8&#39;)"><span class="mpre">expFast</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ base</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ exponant</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ modulo</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ result</span></span><span class="mpre">
</span><a name="loc_76_1_76_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_8&#39;)"><span class="hl_vardecl"><span class="mpre">expFast</span></span></a><span class="mpre"> =
#if MIN_VERSION_integer_gmp(0,5,1)
    </span><span class="hl_varref"><span class="mpre">powModInteger</span></span><span class="mpre">
#else
    </span><a href="#loc_104_1_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_15&#39;)"><span class="hl_varref"><span class="mpre">exponentiation</span></span></a><span class="mpre">
#endif

</span><span class="hl_comment"><span class="mpre">-- note on exponentiation: 0^0 is treated as 1 for mimicking the standard library;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the mathematic debate is still open on whether or not this is true, but pratically</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in computer science it shouldn&#39;t be useful for anything anyway.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | exponentiation_rtl_binary computes modular exponentiation as b^e mod m</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- using the right-to-left binary exponentiation algorithm (HAC 14.79)</span></span><span class="mpre">
</span><a href="#loc_91_1_91_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_1_91_26&#39;)"><span class="mpre">exponentiation_rtl_binary</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">
#if MIN_VERSION_integer_gmp(0,5,1)
</span><a name="loc_91_1_91_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_1_91_26&#39;)"><span class="hl_vardecl"><span class="mpre">exponentiation_rtl_binary</span></span></a><span class="mpre"> = </span><a href="#loc_59_1_59_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_1_59_8&#39;)"><span class="hl_varref"><span class="mpre">expSafe</span></span></a><span class="mpre">
#else
</span><a name="loc_93_1_93_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_26&#39;)"><span class="hl_fundecl"><span class="mpre">exponentiation_rtl_binary</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a name="loc_93_31_93_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_31_93_32&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`mod`</span></span><span class="mpre"> </span><a href="#loc_93_31_93_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_31_93_32&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
</span><a href="#loc_93_1_93_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_26&#39;)"><span class="hl_fundecl"><span class="mpre">exponentiation_rtl_binary</span></span></a><span class="mpre"> </span><a name="loc_94_27_94_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_27_94_28&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> </span><a name="loc_94_29_94_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_29_94_30&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> </span><a name="loc_94_31_94_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_31_94_32&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><a href="#loc_96_11_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_11_96_15&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_94_29_94_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_29_94_30&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> </span><a href="#loc_94_27_94_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_27_94_28&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
    where </span><a name="loc_95_11_95_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_11_95_13&#39;)"><span class="hl_fundecl"><span class="mpre">sq</span></span></a><span class="mpre"> </span><a name="loc_95_14_95_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_14_95_15&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">          = (</span><a href="#loc_95_14_95_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_14_95_15&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><a href="#loc_95_14_95_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_14_95_15&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">`mod`</span></span><span class="mpre"> </span><a href="#loc_94_31_94_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_31_94_32&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
          </span><a name="loc_96_11_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_11_96_15&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> !</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> _  !</span><a name="loc_96_23_96_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_23_96_24&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = </span><a href="#loc_96_23_96_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_23_96_24&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`mod`</span></span><span class="mpre"> </span><a href="#loc_94_31_94_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_31_94_32&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
          </span><a href="#loc_96_11_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_11_96_15&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> !</span><a name="loc_97_17_97_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_17_97_18&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> !</span><a name="loc_97_20_97_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_20_97_21&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> !</span><a name="loc_97_23_97_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_23_97_24&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = </span><a href="#loc_96_11_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_11_96_15&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> (</span><a href="#loc_97_17_97_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_17_97_18&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><a href="#loc_95_11_95_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_11_95_13&#39;)"><span class="hl_varref"><span class="mpre">sq</span></span></a><span class="mpre"> </span><a href="#loc_97_20_97_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_20_97_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) (if </span><span class="hl_varref"><span class="mpre">odd</span></span><span class="mpre"> </span><a href="#loc_97_17_97_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_17_97_18&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> then </span><a href="#loc_97_23_97_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_23_97_24&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><a href="#loc_97_20_97_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_20_97_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> else </span><a href="#loc_97_23_97_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_23_97_24&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)
#endif

</span><span class="hl_comment"><span class="mpre">-- | exponentiation computes modular exponentiation as b^e mod m</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- using repetitive squaring.</span></span><span class="mpre">
</span><a href="#loc_104_1_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_15&#39;)"><span class="mpre">exponentiation</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">
#if MIN_VERSION_integer_gmp(0,5,1)
</span><a name="loc_104_1_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_15&#39;)"><span class="hl_vardecl"><span class="mpre">exponentiation</span></span></a><span class="mpre"> = </span><a href="#loc_59_1_59_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_1_59_8&#39;)"><span class="hl_varref"><span class="mpre">expSafe</span></span></a><span class="mpre">
#else
</span><span class="hl_fundecl"><span class="mpre">exponentiation</span></span><span class="mpre"> </span><a name="loc_106_16_106_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_16_106_17&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> </span><a name="loc_106_18_106_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_18_106_19&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> </span><a name="loc_106_20_106_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_20_106_21&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">
    | </span><a href="#loc_106_16_106_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_16_106_17&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">    = </span><a href="#loc_106_16_106_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_16_106_17&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
    | </span><a href="#loc_106_18_106_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_18_106_19&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">    = </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
    | </span><a href="#loc_106_18_106_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_18_106_19&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">    = </span><a href="#loc_106_16_106_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_16_106_17&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`mod`</span></span><span class="mpre"> </span><a href="#loc_106_20_106_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_20_106_21&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">even</span></span><span class="mpre"> </span><a href="#loc_106_18_106_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_18_106_19&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">    = let </span><a name="loc_110_23_110_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_23_110_24&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = (</span><a href="#loc_104_1_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_15&#39;)"><span class="hl_varref"><span class="mpre">exponentiation</span></span></a><span class="mpre"> </span><a href="#loc_106_16_106_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_16_106_17&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> (</span><a href="#loc_106_18_106_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_18_106_19&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`div`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">) </span><a href="#loc_106_20_106_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_20_106_21&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">`mod`</span></span><span class="mpre"> </span><a href="#loc_106_20_106_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_20_106_21&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
                   in (</span><a href="#loc_110_23_110_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_23_110_24&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="hl_infix"><span class="mpre">^</span></span><span class="mpre">(</span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">::</span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">`mod`</span></span><span class="mpre"> </span><a href="#loc_106_20_106_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_20_106_21&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = (</span><a href="#loc_106_16_106_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_16_106_17&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><a href="#loc_104_1_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_15&#39;)"><span class="hl_varref"><span class="mpre">exponentiation</span></span></a><span class="mpre"> </span><a href="#loc_106_16_106_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_16_106_17&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> (</span><a href="#loc_106_18_106_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_18_106_19&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_106_20_106_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_20_106_21&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">`mod`</span></span><span class="mpre"> </span><a href="#loc_106_20_106_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_20_106_21&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
#endif

</span><span class="hl_comment"><span class="mpre">--{-# DEPRECATED exponantiation_rtl_binary &quot;typo in API name it&#39;s called exponentiation_rtl_binary #-}</span></span><span class="mpre">
</span><a href="#loc_117_1_117_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_26&#39;)"><span class="mpre">exponantiation_rtl_binary</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">
</span><a name="loc_117_1_117_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_26&#39;)"><span class="hl_vardecl"><span class="mpre">exponantiation_rtl_binary</span></span></a><span class="mpre"> = </span><a href="#loc_91_1_91_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_1_91_26&#39;)"><span class="hl_varref"><span class="mpre">exponentiation_rtl_binary</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--{-# DEPRECATED exponentiation &quot;typo in API name it&#39;s called exponentiation #-}</span></span><span class="mpre">
</span><a href="#loc_121_1_121_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_1_121_15&#39;)"><span class="mpre">exponantiation</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">
</span><a name="loc_121_1_121_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_1_121_15&#39;)"><span class="hl_vardecl"><span class="mpre">exponantiation</span></span></a><span class="mpre"> = </span><a href="#loc_104_1_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_15&#39;)"><span class="hl_varref"><span class="mpre">exponentiation</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | inverse computes the modular inverse as in g^(-1) mod m</span></span><span class="mpre">
</span><a href="#loc_126_1_126_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_8&#39;)"><span class="mpre">inverse</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">
#if MIN_VERSION_integer_gmp(0,5,1)
</span><a name="loc_126_1_126_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_8&#39;)"><span class="hl_fundecl"><span class="mpre">inverse</span></span></a><span class="mpre"> </span><a name="loc_126_9_126_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_9_126_10&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre"> </span><a name="loc_126_11_126_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_11_126_12&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">
    | </span><a href="#loc_129_9_129_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_9_129_10&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">    = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_129_9_129_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_9_129_10&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
  where </span><a name="loc_129_9_129_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_9_129_10&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">recipModInteger</span></span><span class="mpre"> </span><a href="#loc_126_9_126_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_9_126_10&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre"> </span><a href="#loc_126_11_126_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_11_126_12&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
#else
</span><a href="#loc_126_1_126_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_8&#39;)"><span class="hl_fundecl"><span class="mpre">inverse</span></span></a><span class="mpre"> </span><a name="loc_131_9_131_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_9_131_10&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre"> </span><a name="loc_131_11_131_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_11_131_12&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">
    | </span><a href="#loc_134_14_134_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_14_134_15&#39;)"><span class="hl_varref"><span class="mpre">d</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">     = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a href="#loc_134_10_134_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_10_134_11&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`mod`</span></span><span class="mpre"> </span><a href="#loc_131_11_131_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_11_131_12&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">)
  where (</span><a name="loc_134_10_134_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_10_134_11&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">,_,</span><a name="loc_134_14_134_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_14_134_15&#39;)"><span class="hl_vardecl"><span class="mpre">d</span></span></a><span class="mpre">) = </span><a href="Crypto.Number.Basic.html#loc_83_1_83_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.Basic.html#loc_83_1_83_12&#39;)"><span class="hl_varref"><span class="mpre">gcde_binary</span></span></a><span class="mpre"> </span><a href="#loc_131_9_131_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_9_131_10&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre"> </span><a href="#loc_131_11_131_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_11_131_12&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
#endif

</span><span class="hl_comment"><span class="mpre">-- | Compute the modular inverse of 2 coprime numbers.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This is equivalent to inverse except that the result</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is known to exists.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- if the numbers are not defined as coprime, this function</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- will raise a CoprimesAssertionError.</span></span><span class="mpre">
</span><a href="#loc_144_1_144_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_1_144_16&#39;)"><span class="mpre">inverseCoprimes</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">
</span><a name="loc_144_1_144_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_1_144_16&#39;)"><span class="hl_fundecl"><span class="mpre">inverseCoprimes</span></span></a><span class="mpre"> </span><a name="loc_144_17_144_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_17_144_18&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre"> </span><a name="loc_144_19_144_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_19_144_20&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> =
    case </span><a href="#loc_126_1_126_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_8&#39;)"><span class="hl_varref"><span class="mpre">inverse</span></span></a><span class="mpre"> </span><a href="#loc_144_17_144_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_17_144_18&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre"> </span><a href="#loc_144_19_144_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_19_144_20&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">throw</span></span><span class="mpre"> </span><a href="#loc_40_31_40_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_31_40_53&#39;)"><span class="hl_conref"><span class="mpre">CoprimesAssertionError</span></span></a><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_147_14_147_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_14_147_15&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">  -&gt; </span><a href="#loc_147_14_147_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_14_147_15&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
</span></div></body></html>