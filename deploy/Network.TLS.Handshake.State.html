<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE GeneralizedNewtypeDeriving #-}
{-# LANGUAGE MultiParamTypeClasses #-}
{-# LANGUAGE CPP #-}
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Network.TLS.Handshake.State</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Network.TLS.Handshake.State
    ( HandshakeState(..)
    , ClientCertRequestData
    , HandshakeM
    , newEmptyHandshake
    , runHandshake
    </span><span class="hl_comment"><span class="mpre">-- * key accessors</span></span><span class="mpre">
    , setPublicKey
    , setPrivateKey
    , getLocalPrivateKey
    , getRemotePublicKey
    , setServerDHParams
    </span><span class="hl_comment"><span class="mpre">-- * cert accessors</span></span><span class="mpre">
    , setClientCertSent
    , getClientCertSent
    , setCertReqSent
    , getCertReqSent
    , setClientCertChain
    , getClientCertChain
    , setClientCertRequest
    , getClientCertRequest
    </span><span class="hl_comment"><span class="mpre">-- * digest accessors</span></span><span class="mpre">
    , addHandshakeMessage
    , updateHandshakeDigest
    , getHandshakeMessages
    , getHandshakeDigest
    </span><span class="hl_comment"><span class="mpre">-- * master secret</span></span><span class="mpre">
    , setMasterSecret
    , setMasterSecretFromPre
    </span><span class="hl_comment"><span class="mpre">-- * misc accessor</span></span><span class="mpre">
    , getPendingCipher
    , setServerHelloParameters
    ) where

import Network.TLS.Util
import Network.TLS.Struct
import Network.TLS.Record.State
import Network.TLS.Packet
import Network.TLS.Crypto
import Network.TLS.Cipher
import Network.TLS.Compression
import Network.TLS.Types
import Control.Applicative (</span><a href="Control.Applicative.html#loc_113_20_113_31" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_113_20_113_31&#39;)"><span class="mpre">Applicative</span></a><span class="mpre">, </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="mpre">(&lt;$&gt;)</span></a><span class="mpre">)
import Control.Monad.State
import Data.X509 (</span><a href="Data.X509.CertificateChain.html#loc_21_9_21_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.CertificateChain.html#loc_21_9_21_25&#39;)"><a href="Data.X509.CertificateChain.html#loc_21_28_21_44" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.CertificateChain.html#loc_21_28_21_44&#39;)"><span class="mpre">CertificateChain</span></a></a><span class="mpre">)

data </span><a name="loc_57_6_57_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_6_57_23&#39;)"><span class="hl_tycondecl"><span class="mpre">HandshakeKeyState</span></span></a><span class="mpre"> = </span><span class="hl_condecl"><span class="mpre">HandshakeKeyState</span></span><span class="mpre">
    { </span><a name="loc_58_7_58_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_7_58_25&#39;)"><span class="hl_fielddecl"><span class="mpre">hksRemotePublicKey</span></span></a><span class="mpre"> :: !(</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Data.X509.PublicKey.html#loc_31_6_31_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.PublicKey.html#loc_31_6_31_12&#39;)"><span class="hl_tyconref"><span class="mpre">PubKey</span></span></a><span class="mpre">)
    , </span><a name="loc_59_7_59_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_7_59_25&#39;)"><span class="hl_fielddecl"><span class="mpre">hksLocalPrivateKey</span></span></a><span class="mpre"> :: !(</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Data.X509.PrivateKey.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.PrivateKey.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">PrivKey</span></span></a><span class="mpre">)
    } </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 60, srcSpanStartColumn = 7, srcSpanEndLine = 60, srcSpanEndColumn = 22}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 60, srcSpanStartColumn = 7, srcSpanEndLine = 60, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, sr"><span class="mpre">deriving (Show)</span></span><span class="mpre">

data </span><a name="loc_62_6_62_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_20&#39;)"><span class="hl_tycondecl"><span class="mpre">HandshakeState</span></span></a><span class="mpre"> = </span><span class="hl_condecl"><span class="mpre">HandshakeState</span></span><span class="mpre">
    { </span><a name="loc_63_7_63_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_7_63_23&#39;)"><span class="hl_fielddecl"><span class="mpre">hstClientVersion</span></span></a><span class="mpre">       :: !(</span><a href="Network.TLS.Types.html#loc_25_6_25_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_6_25_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre">)
    , </span><a name="loc_64_7_64_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_7_64_22&#39;)"><span class="hl_fielddecl"><span class="mpre">hstClientRandom</span></span></a><span class="mpre">        :: !</span><a href="Network.TLS.Struct.html#loc_160_9_160_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_160_9_160_21&#39;)"><span class="hl_tyconref"><span class="mpre">ClientRandom</span></span></a><span class="mpre">
    , </span><a name="loc_65_7_65_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_7_65_22&#39;)"><span class="hl_fielddecl"><span class="mpre">hstServerRandom</span></span></a><span class="mpre">        :: !(</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_159_9_159_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_159_9_159_21&#39;)"><span class="hl_tyconref"><span class="mpre">ServerRandom</span></span></a><span class="mpre">)
    , </span><a name="loc_66_7_66_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_7_66_22&#39;)"><span class="hl_fielddecl"><span class="mpre">hstMasterSecret</span></span></a><span class="mpre">        :: !(</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre">)
    , </span><a name="loc_67_7_67_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_7_67_18&#39;)"><span class="hl_fielddecl"><span class="mpre">hstKeyState</span></span></a><span class="mpre">            :: !</span><a href="#loc_57_6_57_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_6_57_23&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeKeyState</span></span></a><span class="mpre">
    , </span><a name="loc_68_7_68_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_7_68_24&#39;)"><span class="hl_fielddecl"><span class="mpre">hstServerDHParams</span></span></a><span class="mpre">      :: !(</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_226_6_226_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_226_6_226_20&#39;)"><span class="hl_tyconref"><span class="mpre">ServerDHParams</span></span></a><span class="mpre">)
    , </span><a name="loc_69_7_69_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_7_69_19&#39;)"><span class="hl_fielddecl"><span class="mpre">hstDHPrivate</span></span></a><span class="mpre">           :: !(</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">DHPrivate</span></span><span class="mpre">)
    , </span><a name="loc_70_7_70_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_7_70_25&#39;)"><span class="hl_fielddecl"><span class="mpre">hstHandshakeDigest</span></span></a><span class="mpre">     :: !(</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre">] </span><a href="Network.TLS.Crypto.html#loc_66_6_66_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Crypto.html#loc_66_6_66_13&#39;)"><span class="hl_tyconref"><span class="mpre">HashCtx</span></span></a><span class="mpre">)
    , </span><a name="loc_71_7_71_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_7_71_27&#39;)"><span class="hl_fielddecl"><span class="mpre">hstHandshakeMessages</span></span></a><span class="mpre">   :: [</span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre">]
    , </span><a name="loc_72_7_72_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_7_72_27&#39;)"><span class="hl_fielddecl"><span class="mpre">hstClientCertRequest</span></span></a><span class="mpre">   :: !(</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ClientCertRequestData</span></span><span class="mpre">) </span><span class="hl_comment"><span class="mpre">-- ^ Set to Just-value when certificate request was received</span></span><span class="mpre">
    , </span><a name="loc_73_7_73_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_7_73_24&#39;)"><span class="hl_fielddecl"><span class="mpre">hstClientCertSent</span></span></a><span class="mpre">      :: !</span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ Set to true when a client certificate chain was sent</span></span><span class="mpre">
    , </span><a name="loc_74_7_74_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_7_74_21&#39;)"><span class="hl_fielddecl"><span class="mpre">hstCertReqSent</span></span></a><span class="mpre">         :: !</span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ Set to true when a certificate request was sent</span></span><span class="mpre">
    , </span><a name="loc_75_7_75_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_7_75_25&#39;)"><span class="hl_fielddecl"><span class="mpre">hstClientCertChain</span></span></a><span class="mpre">     :: !(</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Data.X509.CertificateChain.html#loc_21_9_21_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.CertificateChain.html#loc_21_9_21_25&#39;)"><span class="hl_tyconref"><span class="mpre">CertificateChain</span></span></a><span class="mpre">)
    , </span><a name="loc_76_7_76_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_7_76_24&#39;)"><span class="hl_fielddecl"><span class="mpre">hstPendingTxState</span></span></a><span class="mpre">      :: </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.TLS.Record.State.html#loc_50_6_50_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Record.State.html#loc_50_6_50_17&#39;)"><span class="hl_tyconref"><span class="mpre">RecordState</span></span></a><span class="mpre">
    , </span><a name="loc_77_7_77_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_7_77_24&#39;)"><span class="hl_fielddecl"><span class="mpre">hstPendingRxState</span></span></a><span class="mpre">      :: </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.TLS.Record.State.html#loc_50_6_50_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Record.State.html#loc_50_6_50_17&#39;)"><span class="hl_tyconref"><span class="mpre">RecordState</span></span></a><span class="mpre">
    , </span><a name="loc_78_7_78_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_7_78_23&#39;)"><span class="hl_fielddecl"><span class="mpre">hstPendingCipher</span></span></a><span class="mpre">       :: </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.TLS.Cipher.html#loc_82_6_82_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_82_6_82_12&#39;)"><span class="hl_tyconref"><span class="mpre">Cipher</span></span></a><span class="mpre">
    , </span><a name="loc_79_7_79_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_7_79_28&#39;)"><span class="hl_fielddecl"><span class="mpre">hstPendingCompression</span></span></a><span class="mpre">  :: </span><a href="Network.TLS.Compression.html#loc_38_6_38_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Compression.html#loc_38_6_38_17&#39;)"><span class="hl_tyconref"><span class="mpre">Compression</span></span></a><span class="mpre">
    } </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 80, srcSpanStartColumn = 7, srcSpanEndLine = 80, srcSpanEndColumn = 22}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 80, srcSpanStartColumn = 7, srcSpanEndLine = 80, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, sr"><span class="mpre">deriving (Show)</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 82, srcSpanStartColumn = 1, srcSpanEndLine = 84, srcSpanEndColumn = 51}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 82, srcSpanStartColumn = 1, srcSpanEndLine = 82, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, src"><span class="mpre">type ClientCertRequestData = ([CertificateType],
                              Maybe [(HashAlgorithm, SignatureAlgorithm)],
                              [DistinguishedName])</span></span><span class="mpre">

newtype </span><a name="loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tycondecl"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_86_24_86_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_24_86_34&#39;)"><span class="hl_condecl"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> { </span><a name="loc_86_37_86_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_37_86_50&#39;)"><span class="hl_fielddecl"><span class="mpre">runHandshakeM</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">State</span></span><span class="mpre"> </span><a href="#loc_62_6_62_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_20&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeState</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> }
    </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 87, srcSpanStartColumn = 5, srcSpanEndLine = 87, srcSpanEndColumn = 43}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 87, srcSpanStartColumn = 5, srcSpanEndLine = 87, srcSpanEndColumn = 13},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, sr"><span class="mpre">deriving (Functor, Applicative, Monad)</span></span><span class="mpre">

instance </span><a href="Control.Monad.State.Class.html#loc_53_18_53_28" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_53_18_53_28&#39;)"><span class="hl_classref"><span class="mpre">MonadState</span></span></a><span class="mpre"> </span><a href="#loc_62_6_62_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_20&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeState</span></span></a><span class="mpre"> </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">put</span></span><span class="mpre"> </span><a name="loc_90_9_90_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_9_90_10&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="#loc_86_24_86_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_24_86_34&#39;)"><span class="hl_conref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">put</span></span><span class="mpre"> </span><a href="#loc_90_9_90_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_9_90_10&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)
    </span><span class="hl_vardecl"><span class="mpre">get</span></span><span class="mpre">   = </span><a href="#loc_86_24_86_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_24_86_34&#39;)"><span class="hl_conref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">get</span></span><span class="mpre">)
#if MIN_VERSION_mtl(2,1,0)
    </span><span class="hl_fundecl"><span class="mpre">state</span></span><span class="mpre"> </span><a name="loc_93_11_93_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_11_93_12&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_86_24_86_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_24_86_34&#39;)"><span class="hl_conref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">state</span></span><span class="mpre"> </span><a href="#loc_93_11_93_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_11_93_12&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">)
#endif

</span><span class="hl_comment"><span class="mpre">-- create a new empty handshake state</span></span><span class="mpre">
</span><a href="#loc_98_1_98_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_18&#39;)"><span class="mpre">newEmptyHandshake</span></a><span class="mpre"> :: </span><a href="Network.TLS.Types.html#loc_25_6_25_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_6_25_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Struct.html#loc_160_9_160_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_160_9_160_21&#39;)"><span class="hl_tyconref"><span class="mpre">ClientRandom</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_62_6_62_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_20&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeState</span></span></a><span class="mpre">
</span><a name="loc_98_1_98_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_18&#39;)"><span class="hl_fundecl"><span class="mpre">newEmptyHandshake</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">ver</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">crand</span></span><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 98, srcSpanStartColumn = 31, srcSpanEndLine = 116, srcSpanEndColumn = 6}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 99, srcSpanStartColumn = 5, srcSpanEndLine = 99, srcSpanEndColumn = 6},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, s"><span class="mpre">HandshakeState
    { hstClientVersion       = ver
    , hstClientRandom        = crand
    , hstServerRandom        = Nothing
    , hstMasterSecret        = Nothing
    , hstKeyState            = HandshakeKeyState Nothing Nothing
    , hstServerDHParams      = Nothing
    , hstDHPrivate           = Nothing
    , hstHandshakeDigest     = Left []
    , hstHandshakeMessages   = []
    , hstClientCertRequest   = Nothing
    , hstClientCertSent      = False
    , hstCertReqSent         = False
    , hstClientCertChain     = Nothing
    , hstPendingTxState      = Nothing
    , hstPendingRxState      = Nothing
    , hstPendingCipher       = Nothing
    , hstPendingCompression  = nullCompression
    }</span></span><span class="mpre">

</span><a href="#loc_119_1_119_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_13&#39;)"><span class="mpre">runHandshake</span></a><span class="mpre"> :: </span><a href="#loc_62_6_62_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_20&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeState</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><a href="#loc_62_6_62_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_20&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeState</span></span></a><span class="mpre">)
</span><a name="loc_119_1_119_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_13&#39;)"><span class="hl_fundecl"><span class="mpre">runHandshake</span></span></a><span class="mpre"> </span><a name="loc_119_14_119_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_14_119_17&#39;)"><span class="hl_vardecl"><span class="mpre">hst</span></span></a><span class="mpre"> </span><a name="loc_119_18_119_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_18_119_19&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="Control.Monad.Trans.State.Lazy.html#loc_98_1_98_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.State.Lazy.html#loc_98_1_98_9&#39;)"><span class="hl_varref"><span class="mpre">runState</span></span></a><span class="mpre"> (</span><a href="#loc_86_37_86_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_37_86_50&#39;)"><span class="hl_varref"><span class="mpre">runHandshakeM</span></span></a><span class="mpre"> </span><a href="#loc_119_18_119_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_18_119_19&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">) </span><a href="#loc_119_14_119_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_14_119_17&#39;)"><span class="hl_varref"><span class="mpre">hst</span></span></a><span class="mpre">

</span><a href="#loc_122_1_122_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_1_122_13&#39;)"><span class="mpre">setPublicKey</span></a><span class="mpre"> :: </span><a href="Data.X509.PublicKey.html#loc_31_6_31_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.PublicKey.html#loc_31_6_31_12&#39;)"><span class="hl_tyconref"><span class="mpre">PubKey</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_122_1_122_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_1_122_13&#39;)"><span class="hl_fundecl"><span class="mpre">setPublicKey</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">pk</span></span><span class="mpre"> = </span><a href="Control.Monad.State.Class.html#loc_85_1_85_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_85_1_85_7&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre"> (\</span><span class="hl_vardecl"><span class="mpre">hst</span></span><span class="mpre"> -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 122, srcSpanStartColumn = 35, srcSpanEndLine = 122, srcSpanEndColumn = 80}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 122, srcSpanStartColumn = 39, srcSpanEndLine = 122, srcSpanEndColumn = 40},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State."><span class="mpre">hst { hstKeyState = setPK (hstKeyState hst) }</span></span><span class="mpre">)
  where </span><span class="hl_fundecl"><span class="mpre">setPK</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">hks</span></span><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 123, srcSpanStartColumn = 21, srcSpanEndLine = 123, srcSpanEndColumn = 57}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 123, srcSpanStartColumn = 25, srcSpanEndLine = 123, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State."><span class="mpre">hks { hksRemotePublicKey = Just pk }</span></span><span class="mpre">

</span><a href="#loc_126_1_126_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_14&#39;)"><span class="mpre">setPrivateKey</span></a><span class="mpre"> :: </span><a href="Data.X509.PrivateKey.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.PrivateKey.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">PrivKey</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_126_1_126_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_14&#39;)"><span class="hl_fundecl"><span class="mpre">setPrivateKey</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">pk</span></span><span class="mpre"> = </span><a href="Control.Monad.State.Class.html#loc_85_1_85_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_85_1_85_7&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre"> (\</span><span class="hl_vardecl"><span class="mpre">hst</span></span><span class="mpre"> -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 126, srcSpanStartColumn = 36, srcSpanEndLine = 126, srcSpanEndColumn = 81}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 126, srcSpanStartColumn = 40, srcSpanEndLine = 126, srcSpanEndColumn = 41},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State."><span class="mpre">hst { hstKeyState = setPK (hstKeyState hst) }</span></span><span class="mpre">)
  where </span><span class="hl_fundecl"><span class="mpre">setPK</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">hks</span></span><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 127, srcSpanStartColumn = 21, srcSpanEndLine = 127, srcSpanEndColumn = 57}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 127, srcSpanStartColumn = 25, srcSpanEndLine = 127, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State."><span class="mpre">hks { hksLocalPrivateKey = Just pk }</span></span><span class="mpre">

</span><a href="#loc_130_1_130_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_19&#39;)"><span class="mpre">getRemotePublicKey</span></a><span class="mpre"> :: </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><a href="Data.X509.PublicKey.html#loc_31_6_31_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.PublicKey.html#loc_31_6_31_12&#39;)"><span class="hl_tyconref"><span class="mpre">PubKey</span></span></a><span class="mpre">
</span><a name="loc_130_1_130_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_19&#39;)"><span class="hl_vardecl"><span class="mpre">getRemotePublicKey</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Util.html#loc_53_1_53_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_53_1_53_9&#39;)"><span class="hl_varref"><span class="mpre">fromJust</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;remote public key&quot;</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> (</span><a href="#loc_58_7_58_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_7_58_25&#39;)"><span class="hl_varref"><span class="mpre">hksRemotePublicKey</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_67_7_67_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_7_67_18&#39;)"><span class="hl_varref"><span class="mpre">hstKeyState</span></span></a><span class="mpre">)

</span><a href="#loc_133_1_133_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_19&#39;)"><span class="mpre">getLocalPrivateKey</span></a><span class="mpre"> :: </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><a href="Data.X509.PrivateKey.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.PrivateKey.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">PrivKey</span></span></a><span class="mpre">
</span><a name="loc_133_1_133_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_19&#39;)"><span class="hl_vardecl"><span class="mpre">getLocalPrivateKey</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Util.html#loc_53_1_53_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_53_1_53_9&#39;)"><span class="hl_varref"><span class="mpre">fromJust</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;local private key&quot;</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> (</span><a href="#loc_59_7_59_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_7_59_25&#39;)"><span class="hl_varref"><span class="mpre">hksLocalPrivateKey</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_67_7_67_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_7_67_18&#39;)"><span class="hl_varref"><span class="mpre">hstKeyState</span></span></a><span class="mpre">)

</span><a href="#loc_136_1_136_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_1_136_18&#39;)"><span class="mpre">setServerDHParams</span></a><span class="mpre"> :: </span><a href="Network.TLS.Struct.html#loc_226_6_226_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_226_6_226_20&#39;)"><span class="hl_tyconref"><span class="mpre">ServerDHParams</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_136_1_136_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_1_136_18&#39;)"><span class="hl_fundecl"><span class="mpre">setServerDHParams</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">shp</span></span><span class="mpre"> = </span><a href="Control.Monad.State.Class.html#loc_85_1_85_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_85_1_85_7&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre"> (\</span><span class="hl_vardecl"><span class="mpre">hst</span></span><span class="mpre"> -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 136, srcSpanStartColumn = 41, srcSpanEndLine = 136, srcSpanEndColumn = 77}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 136, srcSpanStartColumn = 45, srcSpanEndLine = 136, srcSpanEndColumn = 46},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State."><span class="mpre">hst { hstServerDHParams = Just shp }</span></span><span class="mpre">)

</span><a href="#loc_139_1_139_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_15&#39;)"><span class="mpre">setCertReqSent</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_139_1_139_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_15&#39;)"><span class="hl_fundecl"><span class="mpre">setCertReqSent</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">b</span></span><span class="mpre"> = </span><a href="Control.Monad.State.Class.html#loc_85_1_85_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_85_1_85_7&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre"> (\</span><span class="hl_vardecl"><span class="mpre">hst</span></span><span class="mpre"> -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 139, srcSpanStartColumn = 36, srcSpanEndLine = 139, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 139, srcSpanStartColumn = 40, srcSpanEndLine = 139, srcSpanEndColumn = 41},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State."><span class="mpre">hst { hstCertReqSent = b }</span></span><span class="mpre">)

</span><a href="#loc_142_1_142_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_15&#39;)"><span class="mpre">getCertReqSent</span></a><span class="mpre"> :: </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_142_1_142_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_15&#39;)"><span class="hl_vardecl"><span class="mpre">getCertReqSent</span></span></a><span class="mpre"> = </span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> </span><a href="#loc_74_7_74_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_7_74_21&#39;)"><span class="hl_varref"><span class="mpre">hstCertReqSent</span></span></a><span class="mpre">

</span><a href="#loc_145_1_145_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_1_145_18&#39;)"><span class="mpre">setClientCertSent</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_145_1_145_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_1_145_18&#39;)"><span class="hl_fundecl"><span class="mpre">setClientCertSent</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">b</span></span><span class="mpre"> = </span><a href="Control.Monad.State.Class.html#loc_85_1_85_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_85_1_85_7&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre"> (\</span><span class="hl_vardecl"><span class="mpre">hst</span></span><span class="mpre"> -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 145, srcSpanStartColumn = 39, srcSpanEndLine = 145, srcSpanEndColumn = 68}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 145, srcSpanStartColumn = 43, srcSpanEndLine = 145, srcSpanEndColumn = 44},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State."><span class="mpre">hst { hstClientCertSent = b }</span></span><span class="mpre">)

</span><a href="#loc_148_1_148_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_1_148_18&#39;)"><span class="mpre">getClientCertSent</span></a><span class="mpre"> :: </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_148_1_148_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_1_148_18&#39;)"><span class="hl_vardecl"><span class="mpre">getClientCertSent</span></span></a><span class="mpre"> = </span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> </span><a href="#loc_73_7_73_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_7_73_24&#39;)"><span class="hl_varref"><span class="mpre">hstClientCertSent</span></span></a><span class="mpre">

</span><a href="#loc_151_1_151_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_1_151_19&#39;)"><span class="mpre">setClientCertChain</span></a><span class="mpre"> :: </span><a href="Data.X509.CertificateChain.html#loc_21_9_21_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.CertificateChain.html#loc_21_9_21_25&#39;)"><span class="hl_tyconref"><span class="mpre">CertificateChain</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_151_1_151_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_1_151_19&#39;)"><span class="hl_fundecl"><span class="mpre">setClientCertChain</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">b</span></span><span class="mpre"> = </span><a href="Control.Monad.State.Class.html#loc_85_1_85_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_85_1_85_7&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre"> (\</span><span class="hl_vardecl"><span class="mpre">hst</span></span><span class="mpre"> -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 151, srcSpanStartColumn = 40, srcSpanEndLine = 151, srcSpanEndColumn = 75}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 151, srcSpanStartColumn = 44, srcSpanEndLine = 151, srcSpanEndColumn = 45},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State."><span class="mpre">hst { hstClientCertChain = Just b }</span></span><span class="mpre">)

</span><a href="#loc_154_1_154_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_19&#39;)"><span class="mpre">getClientCertChain</span></a><span class="mpre"> :: </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Data.X509.CertificateChain.html#loc_21_9_21_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.CertificateChain.html#loc_21_9_21_25&#39;)"><span class="hl_tyconref"><span class="mpre">CertificateChain</span></span></a><span class="mpre">)
</span><a name="loc_154_1_154_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_19&#39;)"><span class="hl_vardecl"><span class="mpre">getClientCertChain</span></span></a><span class="mpre"> = </span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> </span><a href="#loc_75_7_75_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_7_75_25&#39;)"><span class="hl_varref"><span class="mpre">hstClientCertChain</span></span></a><span class="mpre">

</span><a href="#loc_157_1_157_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_1_157_21&#39;)"><span class="mpre">setClientCertRequest</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ClientCertRequestData</span></span><span class="mpre"> -&gt; </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_157_1_157_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_1_157_21&#39;)"><span class="hl_fundecl"><span class="mpre">setClientCertRequest</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">d</span></span><span class="mpre"> = </span><a href="Control.Monad.State.Class.html#loc_85_1_85_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_85_1_85_7&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre"> (\</span><span class="hl_vardecl"><span class="mpre">hst</span></span><span class="mpre"> -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 157, srcSpanStartColumn = 42, srcSpanEndLine = 157, srcSpanEndColumn = 79}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 157, srcSpanStartColumn = 46, srcSpanEndLine = 157, srcSpanEndColumn = 47},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State."><span class="mpre">hst { hstClientCertRequest = Just d }</span></span><span class="mpre">)

</span><a href="#loc_160_1_160_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_1_160_21&#39;)"><span class="mpre">getClientCertRequest</span></a><span class="mpre"> :: </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ClientCertRequestData</span></span><span class="mpre">)
</span><a name="loc_160_1_160_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_1_160_21&#39;)"><span class="hl_vardecl"><span class="mpre">getClientCertRequest</span></span></a><span class="mpre"> = </span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> </span><a href="#loc_72_7_72_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_7_72_27&#39;)"><span class="hl_varref"><span class="mpre">hstClientCertRequest</span></span></a><span class="mpre">

</span><a href="#loc_163_1_163_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_1_163_17&#39;)"><span class="mpre">getPendingCipher</span></a><span class="mpre"> :: </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><a href="Network.TLS.Cipher.html#loc_82_6_82_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_82_6_82_12&#39;)"><span class="hl_tyconref"><span class="mpre">Cipher</span></span></a><span class="mpre">
</span><a name="loc_163_1_163_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_1_163_17&#39;)"><span class="hl_vardecl"><span class="mpre">getPendingCipher</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Util.html#loc_53_1_53_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_53_1_53_9&#39;)"><span class="hl_varref"><span class="mpre">fromJust</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;pending cipher&quot;</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> </span><a href="#loc_78_7_78_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_7_78_23&#39;)"><span class="hl_varref"><span class="mpre">hstPendingCipher</span></span></a><span class="mpre">

</span><a href="#loc_166_1_166_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_1_166_20&#39;)"><span class="mpre">addHandshakeMessage</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre"> -&gt; </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_166_1_166_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_1_166_20&#39;)"><span class="hl_fundecl"><span class="mpre">addHandshakeMessage</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">content</span></span><span class="mpre"> = </span><a href="Control.Monad.State.Class.html#loc_85_1_85_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_85_1_85_7&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><span class="hl_vardecl"><span class="mpre">hs</span></span><span class="mpre"> -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 166, srcSpanStartColumn = 47, srcSpanEndLine = 166, srcSpanEndColumn = 109}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 166, srcSpanStartColumn = 50, srcSpanEndLine = 166, srcSpanEndColumn = 51},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State"><span class="mpre">hs { hstHandshakeMessages = content : hstHandshakeMessages hs}</span></span><span class="mpre">

</span><a href="#loc_169_1_169_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_1_169_21&#39;)"><span class="mpre">getHandshakeMessages</span></a><span class="mpre"> :: </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre">]
</span><a name="loc_169_1_169_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_1_169_21&#39;)"><span class="hl_vardecl"><span class="mpre">getHandshakeMessages</span></span></a><span class="mpre"> = </span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">reverse</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_71_7_71_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_7_71_27&#39;)"><span class="hl_varref"><span class="mpre">hstHandshakeMessages</span></span></a><span class="mpre">)

</span><a href="#loc_172_1_172_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_1_172_22&#39;)"><span class="mpre">updateHandshakeDigest</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre"> -&gt; </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_172_1_172_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_1_172_22&#39;)"><span class="hl_fundecl"><span class="mpre">updateHandshakeDigest</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">content</span></span><span class="mpre"> = </span><a href="Control.Monad.State.Class.html#loc_85_1_85_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_85_1_85_7&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><span class="hl_vardecl"><span class="mpre">hs</span></span><span class="mpre"> -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 172, srcSpanStartColumn = 49, srcSpanEndLine = 175, srcSpanEndColumn = 86}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 173, srcSpanStartColumn = 5, srcSpanEndLine = 173, srcSpanEndColumn = 6},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs"><span class="mpre">hs
    { hstHandshakeDigest = case hstHandshakeDigest hs of
                                Left bytes    -&gt; Left (content:bytes)
                                Right hashCtx -&gt; Right $ hashUpdate hashCtx content }</span></span><span class="mpre">

</span><a href="#loc_178_1_178_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_1_178_19&#39;)"><span class="mpre">getHandshakeDigest</span></a><span class="mpre"> :: </span><a href="Network.TLS.Types.html#loc_25_6_25_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_6_25_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Types.html#loc_44_6_44_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_6_44_10&#39;)"><span class="hl_tyconref"><span class="mpre">Role</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre">
</span><a name="loc_178_1_178_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_1_178_19&#39;)"><span class="hl_fundecl"><span class="mpre">getHandshakeDigest</span></span></a><span class="mpre"> </span><a name="loc_178_20_178_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_20_178_23&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a name="loc_178_24_178_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_24_178_28&#39;)"><span class="hl_vardecl"><span class="mpre">role</span></span></a><span class="mpre"> = </span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> </span><a href="#loc_179_9_179_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_9_179_12&#39;)"><span class="hl_varref"><span class="mpre">gen</span></span></a><span class="mpre">
  where </span><a name="loc_179_9_179_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_9_179_12&#39;)"><span class="hl_fundecl"><span class="mpre">gen</span></span></a><span class="mpre"> </span><a name="loc_179_13_179_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_13_179_16&#39;)"><span class="hl_vardecl"><span class="mpre">hst</span></span></a><span class="mpre"> = case </span><a href="#loc_70_7_70_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_7_70_25&#39;)"><span class="hl_varref"><span class="mpre">hstHandshakeDigest</span></span></a><span class="mpre"> </span><a href="#loc_179_13_179_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_13_179_16&#39;)"><span class="hl_varref"><span class="mpre">hst</span></span></a><span class="mpre"> of
                      </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a name="loc_180_29_180_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_29_180_36&#39;)"><span class="hl_vardecl"><span class="mpre">hashCtx</span></span></a><span class="mpre"> -&gt;
                         let </span><a name="loc_181_30_181_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_30_181_37&#39;)"><span class="hl_vardecl"><span class="mpre">msecret</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Util.html#loc_53_1_53_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_53_1_53_9&#39;)"><span class="hl_varref"><span class="mpre">fromJust</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;master secret&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_66_7_66_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_7_66_22&#39;)"><span class="hl_varref"><span class="mpre">hstMasterSecret</span></span></a><span class="mpre"> </span><a href="#loc_179_13_179_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_13_179_16&#39;)"><span class="hl_varref"><span class="mpre">hst</span></span></a><span class="mpre">
                          in </span><a href="#loc_185_9_185_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_9_185_23&#39;)"><span class="hl_varref"><span class="mpre">generateFinish</span></span></a><span class="mpre"> </span><a href="#loc_178_20_178_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_20_178_23&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_181_30_181_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_30_181_37&#39;)"><span class="hl_varref"><span class="mpre">msecret</span></span></a><span class="mpre"> </span><a href="#loc_180_29_180_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_29_180_36&#39;)"><span class="hl_varref"><span class="mpre">hashCtx</span></span></a><span class="mpre">
                      </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> _        -&gt;
                         </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;un-initialized handshake digest&quot;</span></span><span class="mpre">
        </span><a name="loc_185_9_185_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_9_185_23&#39;)"><span class="hl_vardecl"><span class="mpre">generateFinish</span></span></a><span class="mpre"> | </span><a href="#loc_178_24_178_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_24_178_28&#39;)"><span class="hl_varref"><span class="mpre">role</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_13_44_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_13_44_23&#39;)"><span class="hl_conref"><span class="mpre">ClientRole</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Packet.html#loc_568_1_568_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Packet.html#loc_568_1_568_23&#39;)"><span class="hl_varref"><span class="mpre">generateClientFinished</span></span></a><span class="mpre">
                       | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">          = </span><a href="Network.TLS.Packet.html#loc_574_1_574_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Packet.html#loc_574_1_574_23&#39;)"><span class="hl_varref"><span class="mpre">generateServerFinished</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Generate the master secret from the pre master secret.</span></span><span class="mpre">
</span><a href="#loc_193_1_193_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_1_193_23&#39;)"><span class="mpre">setMasterSecretFromPre</span></a><span class="mpre"> :: </span><a href="Network.TLS.Types.html#loc_25_6_25_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_6_25_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ chosen transmission version</span></span><span class="mpre">
                       -&gt; </span><a href="Network.TLS.Types.html#loc_44_6_44_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_6_44_10&#39;)"><span class="hl_tyconref"><span class="mpre">Role</span></span></a><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ the role (Client or Server) of the generating side</span></span><span class="mpre">
                       -&gt; </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre">   </span><span class="hl_comment"><span class="mpre">-- ^ the pre master secret</span></span><span class="mpre">
                       -&gt; </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_193_1_193_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_1_193_23&#39;)"><span class="hl_fundecl"><span class="mpre">setMasterSecretFromPre</span></span></a><span class="mpre"> </span><a name="loc_193_24_193_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_24_193_27&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a name="loc_193_28_193_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_28_193_32&#39;)"><span class="hl_vardecl"><span class="mpre">role</span></span></a><span class="mpre"> </span><a name="loc_193_33_193_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_33_193_48&#39;)"><span class="hl_vardecl"><span class="mpre">premasterSecret</span></span></a><span class="mpre"> = do
    </span><a name="loc_194_5_194_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_5_194_11&#39;)"><span class="hl_vardecl"><span class="mpre">secret</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_196_9_196_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_9_196_18&#39;)"><span class="hl_varref"><span class="mpre">genSecret</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">get</span></span><span class="mpre">
    </span><a href="#loc_204_1_204_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_1_204_16&#39;)"><span class="hl_varref"><span class="mpre">setMasterSecret</span></span></a><span class="mpre"> </span><a href="#loc_193_24_193_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_24_193_27&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_193_28_193_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_28_193_32&#39;)"><span class="hl_varref"><span class="mpre">role</span></span></a><span class="mpre"> </span><a href="#loc_194_5_194_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_5_194_11&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre">
  where </span><a name="loc_196_9_196_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_9_196_18&#39;)"><span class="hl_fundecl"><span class="mpre">genSecret</span></span></a><span class="mpre"> </span><a name="loc_196_19_196_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_19_196_22&#39;)"><span class="hl_vardecl"><span class="mpre">hst</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Packet.html#loc_528_1_528_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Packet.html#loc_528_1_528_21&#39;)"><span class="hl_varref"><span class="mpre">generateMasterSecret</span></span></a><span class="mpre"> </span><a href="#loc_193_24_193_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_24_193_27&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre">
                                 </span><a href="#loc_193_33_193_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_33_193_48&#39;)"><span class="hl_varref"><span class="mpre">premasterSecret</span></span></a><span class="mpre">
                                 (</span><a href="#loc_64_7_64_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_7_64_22&#39;)"><span class="hl_varref"><span class="mpre">hstClientRandom</span></span></a><span class="mpre"> </span><a href="#loc_196_19_196_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_19_196_22&#39;)"><span class="hl_varref"><span class="mpre">hst</span></span></a><span class="mpre">)
                                 (</span><a href="Network.TLS.Util.html#loc_53_1_53_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_53_1_53_9&#39;)"><span class="hl_varref"><span class="mpre">fromJust</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;server random&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_65_7_65_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_7_65_22&#39;)"><span class="hl_varref"><span class="mpre">hstServerRandom</span></span></a><span class="mpre"> </span><a href="#loc_196_19_196_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_19_196_22&#39;)"><span class="hl_varref"><span class="mpre">hst</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Set master secret and as a side effect generate the key block</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- with all the right parameters, and setup the pending tx/rx state.</span></span><span class="mpre">
</span><a href="#loc_204_1_204_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_1_204_16&#39;)"><span class="mpre">setMasterSecret</span></a><span class="mpre"> :: </span><a href="Network.TLS.Types.html#loc_25_6_25_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_6_25_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Types.html#loc_44_6_44_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_6_44_10&#39;)"><span class="hl_tyconref"><span class="mpre">Role</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre"> -&gt; </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_204_1_204_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_1_204_16&#39;)"><span class="hl_fundecl"><span class="mpre">setMasterSecret</span></span></a><span class="mpre"> </span><a name="loc_204_17_204_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_17_204_20&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a name="loc_204_21_204_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_21_204_25&#39;)"><span class="hl_vardecl"><span class="mpre">role</span></span></a><span class="mpre"> </span><a name="loc_204_26_204_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_26_204_38&#39;)"><span class="hl_vardecl"><span class="mpre">masterSecret</span></span></a><span class="mpre"> = </span><a href="Control.Monad.State.Class.html#loc_85_1_85_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_85_1_85_7&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_204_51_204_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_51_204_54&#39;)"><span class="hl_vardecl"><span class="mpre">hst</span></span></a><span class="mpre"> -&gt;
    let (</span><span class="hl_vardecl"><span class="mpre">pendingTx</span></span><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">pendingRx</span></span><span class="mpre">) = </span><a href="#loc_211_1_211_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_16&#39;)"><span class="hl_varref"><span class="mpre">computeKeyBlock</span></span></a><span class="mpre"> </span><a href="#loc_204_51_204_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_51_204_54&#39;)"><span class="hl_varref"><span class="mpre">hst</span></span></a><span class="mpre"> </span><a href="#loc_204_26_204_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_26_204_38&#39;)"><span class="hl_varref"><span class="mpre">masterSecret</span></span></a><span class="mpre"> </span><a href="#loc_204_17_204_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_17_204_20&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_204_21_204_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_21_204_25&#39;)"><span class="hl_varref"><span class="mpre">role</span></span></a><span class="mpre">
     in </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 206, srcSpanStartColumn = 9, srcSpanEndLine = 208, srcSpanEndColumn = 51}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 206, srcSpanStartColumn = 13, srcSpanEndLine = 206, srcSpanEndColumn = 14},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.h"><span class="mpre">hst { hstMasterSecret   = Just masterSecret
            , hstPendingTxState = Just pendingTx
            , hstPendingRxState = Just pendingRx }</span></span><span class="mpre">

</span><a href="#loc_211_1_211_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_16&#39;)"><span class="mpre">computeKeyBlock</span></a><span class="mpre"> :: </span><a href="#loc_62_6_62_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_20&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeState</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre"> -&gt; </span><a href="Network.TLS.Types.html#loc_25_6_25_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_6_25_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Types.html#loc_44_6_44_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_6_44_10&#39;)"><span class="hl_tyconref"><span class="mpre">Role</span></span></a><span class="mpre"> -&gt; (</span><a href="Network.TLS.Record.State.html#loc_50_6_50_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Record.State.html#loc_50_6_50_17&#39;)"><span class="hl_tyconref"><span class="mpre">RecordState</span></span></a><span class="mpre">, </span><a href="Network.TLS.Record.State.html#loc_50_6_50_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Record.State.html#loc_50_6_50_17&#39;)"><span class="hl_tyconref"><span class="mpre">RecordState</span></span></a><span class="mpre">)
</span><a name="loc_211_1_211_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_16&#39;)"><span class="hl_fundecl"><span class="mpre">computeKeyBlock</span></span></a><span class="mpre"> </span><a name="loc_211_17_211_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_17_211_20&#39;)"><span class="hl_vardecl"><span class="mpre">hst</span></span></a><span class="mpre"> </span><a name="loc_211_21_211_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_21_211_33&#39;)"><span class="hl_vardecl"><span class="mpre">masterSecret</span></span></a><span class="mpre"> </span><a name="loc_211_34_211_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_34_211_37&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">cc</span></span><span class="mpre"> = (</span><a href="#loc_235_9_235_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_9_235_18&#39;)"><span class="hl_varref"><span class="mpre">pendingTx</span></span></a><span class="mpre">, </span><a href="#loc_241_9_241_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_9_241_18&#39;)"><span class="hl_varref"><span class="mpre">pendingRx</span></span></a><span class="mpre">)
  where </span><a name="loc_212_9_212_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_9_212_15&#39;)"><span class="hl_vardecl"><span class="mpre">cipher</span></span></a><span class="mpre">       = </span><a href="Network.TLS.Util.html#loc_53_1_53_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_53_1_53_9&#39;)"><span class="hl_varref"><span class="mpre">fromJust</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;cipher&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_78_7_78_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_7_78_23&#39;)"><span class="hl_varref"><span class="mpre">hstPendingCipher</span></span></a><span class="mpre"> </span><a href="#loc_211_17_211_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_17_211_20&#39;)"><span class="hl_varref"><span class="mpre">hst</span></span></a><span class="mpre">
        </span><a name="loc_213_9_213_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_9_213_21&#39;)"><span class="hl_vardecl"><span class="mpre">keyblockSize</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Cipher.html#loc_92_1_92_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_92_1_92_19&#39;)"><span class="hl_varref"><span class="mpre">cipherKeyBlockSize</span></span></a><span class="mpre"> </span><a href="#loc_212_9_212_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_9_212_15&#39;)"><span class="hl_varref"><span class="mpre">cipher</span></span></a><span class="mpre">

        </span><a name="loc_215_9_215_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_9_215_13&#39;)"><span class="hl_vardecl"><span class="mpre">bulk</span></span></a><span class="mpre">         = </span><a href="Network.TLS.Cipher.html#loc_86_7_86_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_86_7_86_17&#39;)"><span class="hl_varref"><span class="mpre">cipherBulk</span></span></a><span class="mpre"> </span><a href="#loc_212_9_212_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_9_212_15&#39;)"><span class="hl_varref"><span class="mpre">cipher</span></span></a><span class="mpre">
        </span><a name="loc_216_9_216_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_9_216_19&#39;)"><span class="hl_vardecl"><span class="mpre">digestSize</span></span></a><span class="mpre">   = </span><a href="Network.TLS.Cipher.html#loc_72_7_72_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_72_7_72_15&#39;)"><span class="hl_varref"><span class="mpre">hashSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Cipher.html#loc_85_7_85_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_85_7_85_17&#39;)"><span class="hl_varref"><span class="mpre">cipherHash</span></span></a><span class="mpre"> </span><a href="#loc_212_9_212_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_9_212_15&#39;)"><span class="hl_varref"><span class="mpre">cipher</span></span></a><span class="mpre">
        </span><a name="loc_217_9_217_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_9_217_16&#39;)"><span class="hl_vardecl"><span class="mpre">keySize</span></span></a><span class="mpre">      = </span><a href="Network.TLS.Cipher.html#loc_55_7_55_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_55_7_55_18&#39;)"><span class="hl_varref"><span class="mpre">bulkKeySize</span></span></a><span class="mpre"> </span><a href="#loc_215_9_215_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_9_215_13&#39;)"><span class="hl_varref"><span class="mpre">bulk</span></span></a><span class="mpre">
        </span><a name="loc_218_9_218_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_9_218_15&#39;)"><span class="hl_vardecl"><span class="mpre">ivSize</span></span></a><span class="mpre">       = </span><a href="Network.TLS.Cipher.html#loc_56_7_56_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_56_7_56_17&#39;)"><span class="hl_varref"><span class="mpre">bulkIVSize</span></span></a><span class="mpre"> </span><a href="#loc_215_9_215_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_9_215_13&#39;)"><span class="hl_varref"><span class="mpre">bulk</span></span></a><span class="mpre">
        </span><a name="loc_219_9_219_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_9_219_11&#39;)"><span class="hl_vardecl"><span class="mpre">kb</span></span></a><span class="mpre">           = </span><a href="Network.TLS.Packet.html#loc_546_1_546_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Packet.html#loc_546_1_546_17&#39;)"><span class="hl_varref"><span class="mpre">generateKeyBlock</span></span></a><span class="mpre"> </span><a href="#loc_211_34_211_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_34_211_37&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> (</span><a href="#loc_64_7_64_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_7_64_22&#39;)"><span class="hl_varref"><span class="mpre">hstClientRandom</span></span></a><span class="mpre"> </span><a href="#loc_211_17_211_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_17_211_20&#39;)"><span class="hl_varref"><span class="mpre">hst</span></span></a><span class="mpre">)
                                        (</span><a href="Network.TLS.Util.html#loc_53_1_53_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_53_1_53_9&#39;)"><span class="hl_varref"><span class="mpre">fromJust</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;server random&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_65_7_65_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_7_65_22&#39;)"><span class="hl_varref"><span class="mpre">hstServerRandom</span></span></a><span class="mpre"> </span><a href="#loc_211_17_211_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_17_211_20&#39;)"><span class="hl_varref"><span class="mpre">hst</span></span></a><span class="mpre">)
                                        </span><a href="#loc_211_21_211_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_21_211_33&#39;)"><span class="hl_varref"><span class="mpre">masterSecret</span></span></a><span class="mpre"> </span><a href="#loc_213_9_213_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_9_213_21&#39;)"><span class="hl_varref"><span class="mpre">keyblockSize</span></span></a><span class="mpre">

        (</span><span class="hl_vardecl"><span class="mpre">cMACSecret</span></span><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">sMACSecret</span></span><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">cWriteKey</span></span><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">sWriteKey</span></span><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">cWriteIV</span></span><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">sWriteIV</span></span><span class="mpre">) =
                    </span><a href="Network.TLS.Util.html#loc_53_1_53_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_53_1_53_9&#39;)"><span class="hl_varref"><span class="mpre">fromJust</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;p6&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Util.html#loc_43_1_43_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_43_1_43_11&#39;)"><span class="hl_varref"><span class="mpre">partition6</span></span></a><span class="mpre"> </span><a href="#loc_219_9_219_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_9_219_11&#39;)"><span class="hl_varref"><span class="mpre">kb</span></span></a><span class="mpre"> (</span><a href="#loc_216_9_216_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_9_216_19&#39;)"><span class="hl_varref"><span class="mpre">digestSize</span></span></a><span class="mpre">, </span><a href="#loc_216_9_216_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_9_216_19&#39;)"><span class="hl_varref"><span class="mpre">digestSize</span></span></a><span class="mpre">, </span><a href="#loc_217_9_217_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_9_217_16&#39;)"><span class="hl_varref"><span class="mpre">keySize</span></span></a><span class="mpre">, </span><a href="#loc_217_9_217_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_9_217_16&#39;)"><span class="hl_varref"><span class="mpre">keySize</span></span></a><span class="mpre">, </span><a href="#loc_218_9_218_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_9_218_15&#39;)"><span class="hl_varref"><span class="mpre">ivSize</span></span></a><span class="mpre">, </span><a href="#loc_218_9_218_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_9_218_15&#39;)"><span class="hl_varref"><span class="mpre">ivSize</span></span></a><span class="mpre">)

        </span><span class="hl_vardecl"><span class="mpre">cstClient</span></span><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 226, srcSpanStartColumn = 21, srcSpanEndLine = 228, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 226, srcSpanStartColumn = 32, srcSpanEndLine = 226, srcSpanEndColumn = 33},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State."><span class="mpre">CryptState { cstKey        = cWriteKey
                               , cstIV         = cWriteIV
                               , cstMacSecret  = cMACSecret }</span></span><span class="mpre">
        </span><span class="hl_vardecl"><span class="mpre">cstServer</span></span><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 229, srcSpanStartColumn = 21, srcSpanEndLine = 231, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 229, srcSpanStartColumn = 32, srcSpanEndLine = 229, srcSpanEndColumn = 33},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State."><span class="mpre">CryptState { cstKey        = sWriteKey
                               , cstIV         = sWriteIV
                               , cstMacSecret  = sMACSecret }</span></span><span class="mpre">
        </span><span class="hl_vardecl"><span class="mpre">msClient</span></span><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 232, srcSpanStartColumn = 20, srcSpanEndLine = 232, srcSpanEndColumn = 47}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 232, srcSpanStartColumn = 29, srcSpanEndLine = 232, srcSpanEndColumn = 30},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State."><span class="mpre">MacState { msSequence = 0 }</span></span><span class="mpre">
        </span><span class="hl_vardecl"><span class="mpre">msServer</span></span><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 233, srcSpanStartColumn = 20, srcSpanEndLine = 233, srcSpanEndColumn = 47}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 233, srcSpanStartColumn = 29, srcSpanEndLine = 233, srcSpanEndColumn = 30},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State."><span class="mpre">MacState { msSequence = 0 }</span></span><span class="mpre">

        </span><a name="loc_235_9_235_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_9_235_18&#39;)"><span class="hl_vardecl"><span class="mpre">pendingTx</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 235, srcSpanStartColumn = 21, srcSpanEndLine = 240, srcSpanEndColumn = 20}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 236, srcSpanStartColumn = 19, srcSpanEndLine = 236, srcSpanEndColumn = 20},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State."><span class="mpre">RecordState
                  { stCryptState  = if cc == ClientRole then cstClient else cstServer
                  , stMacState    = if cc == ClientRole then msClient else msServer
                  , stCipher      = Just cipher
                  , stCompression = hstPendingCompression hst
                  }</span></span><span class="mpre">
        </span><a name="loc_241_9_241_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_9_241_18&#39;)"><span class="hl_vardecl"><span class="mpre">pendingRx</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 241, srcSpanStartColumn = 21, srcSpanEndLine = 246, srcSpanEndColumn = 20}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 242, srcSpanStartColumn = 19, srcSpanEndLine = 242, srcSpanEndColumn = 20},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State."><span class="mpre">RecordState
                  { stCryptState  = if cc == ClientRole then cstServer else cstClient
                  , stMacState    = if cc == ClientRole then msServer else msClient
                  , stCipher      = Just cipher
                  , stCompression = hstPendingCompression hst
                  }</span></span><span class="mpre">

</span><a href="#loc_253_1_253_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_1_253_25&#39;)"><span class="mpre">setServerHelloParameters</span></a><span class="mpre"> :: </span><a href="Network.TLS.Types.html#loc_25_6_25_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_6_25_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre">      </span><span class="hl_comment"><span class="mpre">-- ^ chosen version</span></span><span class="mpre">
                         -&gt; </span><a href="Network.TLS.Struct.html#loc_159_9_159_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_159_9_159_21&#39;)"><span class="hl_tyconref"><span class="mpre">ServerRandom</span></span></a><span class="mpre">
                         -&gt; </span><a href="Network.TLS.Cipher.html#loc_82_6_82_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_82_6_82_12&#39;)"><span class="hl_tyconref"><span class="mpre">Cipher</span></span></a><span class="mpre">
                         -&gt; </span><a href="Network.TLS.Compression.html#loc_38_6_38_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Compression.html#loc_38_6_38_17&#39;)"><span class="hl_tyconref"><span class="mpre">Compression</span></span></a><span class="mpre">
                         -&gt; </span><a href="#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_253_1_253_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_1_253_25&#39;)"><span class="hl_fundecl"><span class="mpre">setServerHelloParameters</span></span></a><span class="mpre"> </span><a name="loc_253_26_253_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_26_253_29&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">sran</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">cipher</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">compression</span></span><span class="mpre"> = do
    </span><a href="Control.Monad.State.Class.html#loc_85_1_85_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_85_1_85_7&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><span class="hl_vardecl"><span class="mpre">hst</span></span><span class="mpre"> -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 254, srcSpanStartColumn = 22, srcSpanEndLine = 259, srcSpanEndColumn = 18}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State.hs&quot;, srcSpanStartLine = 255, srcSpanStartColumn = 17, srcSpanEndLine = 255, srcSpanEndColumn = 18},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/State."><span class="mpre">hst
                { hstServerRandom       = Just sran
                , hstPendingCipher      = Just cipher
                , hstPendingCompression = compression
                , hstHandshakeDigest    = updateDigest $ hstHandshakeDigest hst
                }</span></span><span class="mpre">
  where </span><a name="loc_260_9_260_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_260_9_260_16&#39;)"><span class="hl_vardecl"><span class="mpre">initCtx</span></span></a><span class="mpre"> = if </span><a href="#loc_253_26_253_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_26_253_29&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_25_46_25_51" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_46_25_51&#39;)"><span class="hl_conref"><span class="mpre">TLS12</span></span></a><span class="mpre"> then </span><a href="Network.TLS.Crypto.html#loc_125_1_125_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Crypto.html#loc_125_1_125_12&#39;)"><span class="hl_varref"><span class="mpre">hashMD5SHA1</span></span></a><span class="mpre"> else </span><a href="Network.TLS.Crypto.html#loc_127_1_127_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Crypto.html#loc_127_1_127_11&#39;)"><span class="hl_varref"><span class="mpre">hashSHA256</span></span></a><span class="mpre">
        </span><a name="loc_261_9_261_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_9_261_21&#39;)"><span class="hl_fundecl"><span class="mpre">updateDigest</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_261_28_261_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_28_261_33&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">foldl</span></span><span class="mpre"> </span><a href="Network.TLS.Crypto.html#loc_113_1_113_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Crypto.html#loc_113_1_113_11&#39;)"><span class="hl_varref"><span class="mpre">hashUpdate</span></span></a><span class="mpre"> </span><a href="#loc_260_9_260_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_260_9_260_16&#39;)"><span class="hl_varref"><span class="mpre">initCtx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">reverse</span></span><span class="mpre"> </span><a href="#loc_261_28_261_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_28_261_33&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">
        </span><a href="#loc_261_9_261_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_9_261_21&#39;)"><span class="hl_fundecl"><span class="mpre">updateDigest</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> _)    = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;cannot initialize digest with another digest&quot;</span></span><span class="mpre">
</span></div></body></html>