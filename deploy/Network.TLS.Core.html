<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# OPTIONS_HADDOCK hide #-}
{-# LANGUAGE OverloadedStrings, ScopedTypeVariables #-}
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Network.TLS.Core</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Network.TLS.Core
    (
    </span><span class="hl_comment"><span class="mpre">-- * Internal packet sending and receiving</span></span><span class="mpre">
      sendPacket
    , recvPacket

    </span><span class="hl_comment"><span class="mpre">-- * Initialisation and Termination of context</span></span><span class="mpre">
    , bye
    , handshake

    </span><span class="hl_comment"><span class="mpre">-- * Next Protocol Negotiation</span></span><span class="mpre">
    , getNegotiatedProtocol

    </span><span class="hl_comment"><span class="mpre">-- * High level API</span></span><span class="mpre">
    , sendData
    , recvData
    , recvData&#39;
    ) where

import Network.TLS.Context
import Network.TLS.Struct
import Network.TLS.State (</span><a href="Network.TLS.State.html#loc_150_1_150_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_150_1_150_11&#39;)"><span class="mpre">getSession</span></a><span class="mpre">)
import Network.TLS.Parameters
import Network.TLS.IO
import Network.TLS.Session
import Network.TLS.Handshake
import Network.TLS.Util (</span><a href="Network.TLS.Util.html#loc_81_1_81_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_81_1_81_15&#39;)"><span class="mpre">catchException</span></a><span class="mpre">)
import qualified Network.TLS.State as S
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 38, srcSpanStartColumn = 18, srcSpanEndLine = 38, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 39, srcSpanStartColumn = 8, srcSpanEndLine = 39, srcSpanEndColumn = 29}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> ()
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 40, srcSpanStartColumn = 18, srcSpanEndLine = 40, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L
import qualified Control.Exception as E

import Control.Monad.State


</span><span class="hl_comment"><span class="mpre">-- | notify the context that this side wants to close connection.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- this is important that it is called before closing the handle, otherwise</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the session might not be resumable (for version &lt; TLS1.2).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- this doesn&#39;t actually close the handle</span></span><span class="mpre">
</span><a href="#loc_52_1_52_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_4&#39;)"><span class="mpre">bye</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 51, srcSpanStartColumn = 8, srcSpanEndLine = 51, srcSpanEndColumn = 20}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 51, srcSpanStartColumn = 18, srcSpanEndLine = 51, srcSpanEndColumn = 20}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core."><span class="mpre">MonadIO m =&gt;</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_52_1_52_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_4&#39;)"><span class="hl_fundecl"><span class="mpre">bye</span></span></a><span class="mpre"> </span><a name="loc_52_5_52_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_8&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> = </span><a href="Network.TLS.IO.html#loc_106_1_106_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.IO.html#loc_106_1_106_11&#39;)"><span class="hl_varref"><span class="mpre">sendPacket</span></span></a><span class="mpre"> </span><a href="#loc_52_5_52_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_8&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_152_7_152_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_152_7_152_12&#39;)"><span class="hl_conref"><span class="mpre">Alert</span></span></a><span class="mpre"> [(</span><a href="Network.TLS.Struct.html#loc_177_7_177_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_177_7_177_25&#39;)"><span class="hl_conref"><span class="mpre">AlertLevel_Warning</span></span></a><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_182_7_182_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_182_7_182_18&#39;)"><span class="hl_conref"><span class="mpre">CloseNotify</span></span></a><span class="mpre">)]

</span><span class="hl_comment"><span class="mpre">-- | If the Next Protocol Negotiation extension has been used, this will</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- return get the protocol agreed upon.</span></span><span class="mpre">
</span><a href="#loc_57_1_57_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_22&#39;)"><span class="mpre">getNegotiatedProtocol</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 56, srcSpanStartColumn = 26, srcSpanEndLine = 56, srcSpanEndColumn = 38}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 56, srcSpanStartColumn = 36, srcSpanEndLine = 56, srcSpanEndColumn = 38}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core"><span class="mpre">MonadIO m =&gt;</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">)
</span><a name="loc_57_1_57_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_22&#39;)"><span class="hl_fundecl"><span class="mpre">getNegotiatedProtocol</span></span></a><span class="mpre"> </span><a name="loc_57_23_57_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_23_57_26&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> = </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_57_23_57_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_23_57_26&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_186_1_186_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_186_1_186_22&#39;)"><span class="hl_varref"><span class="mpre">S.getNegotiatedProtocol</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | sendData sends a bunch of data.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- It will automatically chunk data to acceptable packet size</span></span><span class="mpre">
</span><a href="#loc_62_1_62_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_9&#39;)"><span class="mpre">sendData</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 61, srcSpanStartColumn = 13, srcSpanEndLine = 61, srcSpanEndColumn = 25}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 61, srcSpanStartColumn = 23, srcSpanEndLine = 61, srcSpanEndColumn = 25}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core"><span class="mpre">MonadIO m =&gt;</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_62_1_62_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_9&#39;)"><span class="hl_fundecl"><span class="mpre">sendData</span></span></a><span class="mpre"> </span><a name="loc_62_10_62_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_10_62_13&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_62_14_62_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_14_62_24&#39;)"><span class="hl_vardecl"><span class="mpre">dataToSend</span></span></a><span class="mpre"> = </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> (</span><a href="Network.TLS.IO.html#loc_32_1_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.IO.html#loc_32_1_32_11&#39;)"><span class="hl_varref"><span class="mpre">checkValid</span></span></a><span class="mpre"> </span><a href="#loc_62_10_62_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_10_62_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="Control.Monad.html#loc_116_1_116_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_116_1_116_6&#39;)"><span class="hl_varref"><span class="mpre">mapM_</span></span></a><span class="mpre"> </span><a href="#loc_63_9_63_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_22&#39;)"><span class="hl_varref"><span class="mpre">sendDataChunk</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">L.toChunks</span></span><span class="mpre"> </span><a href="#loc_62_14_62_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_14_62_24&#39;)"><span class="hl_varref"><span class="mpre">dataToSend</span></span></a><span class="mpre">)
  where </span><a name="loc_63_9_63_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_22&#39;)"><span class="hl_fundecl"><span class="mpre">sendDataChunk</span></span></a><span class="mpre"> </span><a name="loc_63_23_63_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_23_63_24&#39;)"><span class="hl_vardecl"><span class="mpre">d</span></span></a><span class="mpre">
            | </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_63_23_63_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_23_63_24&#39;)"><span class="hl_varref"><span class="mpre">d</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">16384</span></span><span class="mpre"> = do
                let (</span><a name="loc_65_22_65_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_22_65_29&#39;)"><span class="hl_vardecl"><span class="mpre">sending</span></span></a><span class="mpre">, </span><a name="loc_65_31_65_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_31_65_37&#39;)"><span class="hl_vardecl"><span class="mpre">remain</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">B.splitAt</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">16384</span></span><span class="mpre"> </span><a href="#loc_63_23_63_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_23_63_24&#39;)"><span class="hl_varref"><span class="mpre">d</span></span></a><span class="mpre">
                </span><a href="Network.TLS.IO.html#loc_106_1_106_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.IO.html#loc_106_1_106_11&#39;)"><span class="hl_varref"><span class="mpre">sendPacket</span></span></a><span class="mpre"> </span><a href="#loc_62_10_62_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_10_62_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_154_7_154_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_154_7_154_14&#39;)"><span class="hl_conref"><span class="mpre">AppData</span></span></a><span class="mpre"> </span><a href="#loc_65_22_65_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_22_65_29&#39;)"><span class="hl_varref"><span class="mpre">sending</span></span></a><span class="mpre">
                </span><a href="#loc_63_9_63_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_22&#39;)"><span class="hl_varref"><span class="mpre">sendDataChunk</span></span></a><span class="mpre"> </span><a href="#loc_65_31_65_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_31_65_37&#39;)"><span class="hl_varref"><span class="mpre">remain</span></span></a><span class="mpre">
            | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="Network.TLS.IO.html#loc_106_1_106_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.IO.html#loc_106_1_106_11&#39;)"><span class="hl_varref"><span class="mpre">sendPacket</span></span></a><span class="mpre"> </span><a href="#loc_62_10_62_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_10_62_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_154_7_154_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_154_7_154_14&#39;)"><span class="hl_conref"><span class="mpre">AppData</span></span></a><span class="mpre"> </span><a href="#loc_63_23_63_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_23_63_24&#39;)"><span class="hl_varref"><span class="mpre">d</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | recvData get data out of Data packet, and automatically renegotiate if</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a Handshake ClientHello is received</span></span><span class="mpre">
</span><a href="#loc_73_1_73_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_9&#39;)"><span class="mpre">recvData</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 72, srcSpanStartColumn = 13, srcSpanEndLine = 72, srcSpanEndColumn = 25}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 72, srcSpanStartColumn = 23, srcSpanEndLine = 72, srcSpanEndColumn = 25}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core"><span class="mpre">MonadIO m =&gt;</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_73_1_73_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_9&#39;)"><span class="hl_fundecl"><span class="mpre">recvData</span></span></a><span class="mpre"> </span><a name="loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> = </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a href="Network.TLS.IO.html#loc_32_1_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.IO.html#loc_32_1_32_11&#39;)"><span class="hl_varref"><span class="mpre">checkValid</span></span></a><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
    </span><a href="Control.Exception.Base.html#loc_170_1_170_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_170_1_170_10&#39;)"><span class="hl_varref"><span class="mpre">E.catchJust</span></span></a><span class="mpre"> </span><a href="#loc_82_9_82_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_9_82_28&#39;)"><span class="hl_varref"><span class="mpre">safeHandleError_EOF</span></span></a><span class="mpre">
                </span><a href="#loc_78_9_78_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_9_78_15&#39;)"><span class="hl_varref"><span class="mpre">doRecv</span></span></a><span class="mpre">
                (\</span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">)
  where </span><a name="loc_78_9_78_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_9_78_15&#39;)"><span class="hl_vardecl"><span class="mpre">doRecv</span></span></a><span class="mpre"> = do
            </span><a name="loc_79_13_79_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_13_79_16&#39;)"><span class="hl_vardecl"><span class="mpre">pkt</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_214_1_214_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_214_1_214_13&#39;)"><span class="hl_varref"><span class="mpre">withReadLock</span></span></a><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.IO.html#loc_86_1_86_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.IO.html#loc_86_1_86_11&#39;)"><span class="hl_varref"><span class="mpre">recvPacket</span></span></a><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">either</span></span><span class="mpre"> </span><a href="#loc_85_9_85_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_9_85_16&#39;)"><span class="hl_varref"><span class="mpre">onError</span></span></a><span class="mpre"> </span><a href="#loc_90_9_90_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_9_90_16&#39;)"><span class="hl_varref"><span class="mpre">process</span></span></a><span class="mpre"> </span><a href="#loc_79_13_79_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_13_79_16&#39;)"><span class="hl_varref"><span class="mpre">pkt</span></span></a><span class="mpre">
            
        </span><a name="loc_82_9_82_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_9_82_28&#39;)"><span class="hl_fundecl"><span class="mpre">safeHandleError_EOF</span></span></a><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_126_7_126_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_126_7_126_16&#39;)"><span class="hl_conref"><span class="mpre">Error_EOF</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
        </span><a href="#loc_82_9_82_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_9_82_28&#39;)"><span class="hl_fundecl"><span class="mpre">safeHandleError_EOF</span></span></a><span class="mpre"> _ = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
        
        </span><a name="loc_85_9_85_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_9_85_16&#39;)"><span class="hl_fundecl"><span class="mpre">onError</span></span></a><span class="mpre"> </span><a name="loc_85_17_85_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_17_85_20&#39;)"><span class="hl_specname"><span class="mpre">err</span></span></a><span class="mpre">@(</span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><a name="loc_85_38_85_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_38_85_44&#39;)"><span class="hl_vardecl"><span class="mpre">reason</span></span></a><span class="mpre">,</span><a name="loc_85_45_85_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_45_85_50&#39;)"><span class="hl_vardecl"><span class="mpre">fatal</span></span></a><span class="mpre">,</span><a name="loc_85_51_85_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_51_85_55&#39;)"><span class="hl_vardecl"><span class="mpre">desc</span></span></a><span class="mpre">)) =
            </span><a href="#loc_107_9_107_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_18&#39;)"><span class="hl_varref"><span class="mpre">terminate</span></span></a><span class="mpre"> </span><a href="#loc_85_17_85_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_17_85_20&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre"> (if </span><a href="#loc_85_45_85_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_45_85_50&#39;)"><span class="hl_varref"><span class="mpre">fatal</span></span></a><span class="mpre"> then </span><a href="Network.TLS.Struct.html#loc_178_7_178_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_178_7_178_23&#39;)"><span class="hl_conref"><span class="mpre">AlertLevel_Fatal</span></span></a><span class="mpre"> else </span><a href="Network.TLS.Struct.html#loc_177_7_177_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_177_7_177_25&#39;)"><span class="hl_conref"><span class="mpre">AlertLevel_Warning</span></span></a><span class="mpre">) </span><a href="#loc_85_51_85_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_51_85_55&#39;)"><span class="hl_varref"><span class="mpre">desc</span></span></a><span class="mpre"> </span><a href="#loc_85_38_85_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_38_85_44&#39;)"><span class="hl_varref"><span class="mpre">reason</span></span></a><span class="mpre">
        </span><a href="#loc_85_9_85_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_9_85_16&#39;)"><span class="hl_fundecl"><span class="mpre">onError</span></span></a><span class="mpre"> </span><a name="loc_87_17_87_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_17_87_20&#39;)"><span class="hl_vardecl"><span class="mpre">err</span></span></a><span class="mpre"> =
            </span><a href="#loc_107_9_107_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_18&#39;)"><span class="hl_varref"><span class="mpre">terminate</span></span></a><span class="mpre"> </span><a href="#loc_87_17_87_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_17_87_20&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_178_7_178_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_178_7_178_23&#39;)"><span class="hl_conref"><span class="mpre">AlertLevel_Fatal</span></span></a><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_202_7_202_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_202_7_202_20&#39;)"><span class="hl_conref"><span class="mpre">InternalError</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_87_17_87_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_17_87_20&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre">)

        </span><a name="loc_90_9_90_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_9_90_16&#39;)"><span class="hl_fundecl"><span class="mpre">process</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_151_7_151_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_151_7_151_16&#39;)"><span class="hl_conref"><span class="mpre">Handshake</span></span></a><span class="mpre"> [</span><a name="loc_90_29_90_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_29_90_31&#39;)"><span class="hl_specname"><span class="mpre">ch</span></span></a><span class="mpre">@(</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 90, srcSpanStartColumn = 33, srcSpanEndLine = 90, srcSpanEndColumn = 47}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 90, srcSpanStartColumn = 45, srcSpanEndLine = 90, srcSpanEndColumn = 46},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 90, srcSpanStartCo"><span class="mpre">ClientHello {}</span></span><span class="mpre">)]) =
            </span><a href="Network.TLS.Context.Internal.html#loc_220_1_220_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_220_1_220_11&#39;)"><span class="hl_varref"><span class="mpre">withRWLock</span></span></a><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> ((</span><span class="hl_varref"><span class="mpre">ctxDoHandshakeWith</span></span><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_90_29_90_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_29_90_31&#39;)"><span class="hl_varref"><span class="mpre">ch</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_73_1_73_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_9&#39;)"><span class="hl_varref"><span class="mpre">recvData</span></span></a><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
        </span><a href="#loc_90_9_90_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_9_90_16&#39;)"><span class="hl_fundecl"><span class="mpre">process</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_151_7_151_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_151_7_151_16&#39;)"><span class="hl_conref"><span class="mpre">Handshake</span></span></a><span class="mpre"> [</span><a name="loc_92_29_92_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_29_92_31&#39;)"><span class="hl_specname"><span class="mpre">hr</span></span></a><span class="mpre">@</span><a href="Network.TLS.Struct.html#loc_256_7_256_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_256_7_256_19&#39;)"><span class="hl_conref"><span class="mpre">HelloRequest</span></span></a><span class="mpre">]) =
            </span><a href="Network.TLS.Context.Internal.html#loc_220_1_220_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_220_1_220_11&#39;)"><span class="hl_varref"><span class="mpre">withRWLock</span></span></a><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> ((</span><span class="hl_varref"><span class="mpre">ctxDoHandshakeWith</span></span><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_92_29_92_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_29_92_31&#39;)"><span class="hl_varref"><span class="mpre">hr</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_73_1_73_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_9&#39;)"><span class="hl_varref"><span class="mpre">recvData</span></span></a><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">

        </span><a href="#loc_90_9_90_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_9_90_16&#39;)"><span class="hl_fundecl"><span class="mpre">process</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_152_7_152_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_152_7_152_12&#39;)"><span class="hl_conref"><span class="mpre">Alert</span></span></a><span class="mpre"> [(</span><a href="Network.TLS.Struct.html#loc_177_7_177_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_177_7_177_25&#39;)"><span class="hl_conref"><span class="mpre">AlertLevel_Warning</span></span></a><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_182_7_182_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_182_7_182_18&#39;)"><span class="hl_conref"><span class="mpre">CloseNotify</span></span></a><span class="mpre">)]) = </span><a href="#loc_118_9_118_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_9_118_15&#39;)"><span class="hl_varref"><span class="mpre">tryBye</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_149_1_149_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_149_1_149_7&#39;)"><span class="hl_varref"><span class="mpre">setEOF</span></span></a><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">
        </span><a href="#loc_90_9_90_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_9_90_16&#39;)"><span class="hl_fundecl"><span class="mpre">process</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_152_7_152_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_152_7_152_12&#39;)"><span class="hl_conref"><span class="mpre">Alert</span></span></a><span class="mpre"> [(</span><a href="Network.TLS.Struct.html#loc_178_7_178_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_178_7_178_23&#39;)"><span class="hl_conref"><span class="mpre">AlertLevel_Fatal</span></span></a><span class="mpre">, </span><a name="loc_96_44_96_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_44_96_48&#39;)"><span class="hl_vardecl"><span class="mpre">desc</span></span></a><span class="mpre">)]) = do
            </span><a href="Network.TLS.Context.Internal.html#loc_149_1_149_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_149_1_149_7&#39;)"><span class="hl_varref"><span class="mpre">setEOF</span></span></a><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
            </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">E.throwIO</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_141_7_141_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_141_7_141_17&#39;)"><span class="hl_conref"><span class="mpre">Terminated</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;received fatal error: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_96_44_96_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_44_96_48&#39;)"><span class="hl_varref"><span class="mpre">desc</span></span></a><span class="mpre">) (</span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;remote side fatal error&quot;</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="#loc_96_44_96_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_44_96_48&#39;)"><span class="hl_varref"><span class="mpre">desc</span></span></a><span class="mpre">)))

        </span><span class="hl_comment"><span class="mpre">-- when receiving empty appdata, we just retry to get some data.</span></span><span class="mpre">
        </span><a href="#loc_90_9_90_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_9_90_16&#39;)"><span class="hl_fundecl"><span class="mpre">process</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_154_7_154_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_154_7_154_14&#39;)"><span class="hl_conref"><span class="mpre">AppData</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">) = </span><a href="#loc_73_1_73_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_9&#39;)"><span class="hl_varref"><span class="mpre">recvData</span></span></a><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
        </span><a href="#loc_90_9_90_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_9_90_16&#39;)"><span class="hl_fundecl"><span class="mpre">process</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_154_7_154_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_154_7_154_14&#39;)"><span class="hl_conref"><span class="mpre">AppData</span></span></a><span class="mpre"> </span><a name="loc_102_26_102_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_26_102_27&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">)  = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_102_26_102_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_26_102_27&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
        </span><a href="#loc_90_9_90_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_9_90_16&#39;)"><span class="hl_fundecl"><span class="mpre">process</span></span></a><span class="mpre"> </span><a name="loc_103_17_103_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_17_103_18&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre">            = let </span><a name="loc_103_36_103_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_36_103_42&#39;)"><span class="hl_vardecl"><span class="mpre">reason</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;unexpected message &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_103_17_103_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_17_103_18&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> in
                               </span><a href="#loc_107_9_107_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_18&#39;)"><span class="hl_varref"><span class="mpre">terminate</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_122_7_122_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_122_7_122_17&#39;)"><span class="hl_conref"><span class="mpre">Error_Misc</span></span></a><span class="mpre"> </span><a href="#loc_103_36_103_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_36_103_42&#39;)"><span class="hl_varref"><span class="mpre">reason</span></span></a><span class="mpre">) </span><a href="Network.TLS.Struct.html#loc_178_7_178_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_178_7_178_23&#39;)"><span class="hl_conref"><span class="mpre">AlertLevel_Fatal</span></span></a><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_183_7_183_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_183_7_183_24&#39;)"><span class="hl_conref"><span class="mpre">UnexpectedMessage</span></span></a><span class="mpre"> </span><a href="#loc_103_36_103_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_36_103_42&#39;)"><span class="hl_varref"><span class="mpre">reason</span></span></a><span class="mpre">

        </span><a href="#loc_107_9_107_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_18&#39;)"><span class="mpre">terminate</span></a><span class="mpre"> :: </span><a href="Network.TLS.Struct.html#loc_121_6_121_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_121_6_121_14&#39;)"><span class="hl_tyconref"><span class="mpre">TLSError</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Struct.html#loc_176_6_176_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_176_6_176_16&#39;)"><span class="hl_tyconref"><span class="mpre">AlertLevel</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Struct.html#loc_181_6_181_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_181_6_181_22&#39;)"><span class="hl_tyconref"><span class="mpre">AlertDescription</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
        </span><a name="loc_107_9_107_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_18&#39;)"><span class="hl_fundecl"><span class="mpre">terminate</span></span></a><span class="mpre"> </span><a name="loc_107_19_107_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_19_107_22&#39;)"><span class="hl_vardecl"><span class="mpre">err</span></span></a><span class="mpre"> </span><a name="loc_107_23_107_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_23_107_28&#39;)"><span class="hl_vardecl"><span class="mpre">level</span></span></a><span class="mpre"> </span><a name="loc_107_29_107_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_29_107_33&#39;)"><span class="hl_vardecl"><span class="mpre">desc</span></span></a><span class="mpre"> </span><a name="loc_107_34_107_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_34_107_40&#39;)"><span class="hl_vardecl"><span class="mpre">reason</span></span></a><span class="mpre"> = do
            </span><a name="loc_108_13_108_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_13_108_20&#39;)"><span class="hl_vardecl"><span class="mpre">session</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_150_1_150_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_150_1_150_11&#39;)"><span class="hl_varref"><span class="mpre">getSession</span></span></a><span class="mpre">
            case </span><a href="#loc_108_13_108_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_13_108_20&#39;)"><span class="hl_varref"><span class="mpre">session</span></span></a><span class="mpre"> of
                </span><a href="Network.TLS.Struct.html#loc_161_19_161_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_161_19_161_26&#39;)"><span class="hl_conref"><span class="mpre">Session</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">    -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
                </span><a href="Network.TLS.Struct.html#loc_161_19_161_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_161_19_161_26&#39;)"><span class="hl_conref"><span class="mpre">Session</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_111_31_111_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_31_111_34&#39;)"><span class="hl_vardecl"><span class="mpre">sid</span></span></a><span class="mpre">) -&gt; </span><a href="Network.TLS.Session.html#loc_22_7_22_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Session.html#loc_22_7_22_24&#39;)"><span class="hl_varref"><span class="mpre">sessionInvalidate</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Parameters.html#loc_147_7_147_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_147_7_147_27&#39;)"><span class="hl_varref"><span class="mpre">sharedSessionManager</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">ctxShared</span></span><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><a href="#loc_111_31_111_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_31_111_34&#39;)"><span class="hl_varref"><span class="mpre">sid</span></span></a><span class="mpre">
            </span><a href="Network.TLS.Util.html#loc_81_1_81_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_81_1_81_15&#39;)"><span class="hl_varref"><span class="mpre">catchException</span></span></a><span class="mpre"> (</span><a href="Network.TLS.IO.html#loc_106_1_106_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.IO.html#loc_106_1_106_11&#39;)"><span class="hl_varref"><span class="mpre">sendPacket</span></span></a><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_152_7_152_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_152_7_152_12&#39;)"><span class="hl_conref"><span class="mpre">Alert</span></span></a><span class="mpre"> [(</span><a href="#loc_107_23_107_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_23_107_28&#39;)"><span class="hl_varref"><span class="mpre">level</span></span></a><span class="mpre">, </span><a href="#loc_107_29_107_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_29_107_33&#39;)"><span class="hl_varref"><span class="mpre">desc</span></span></a><span class="mpre">)]) (\_ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)
            </span><a href="Network.TLS.Context.Internal.html#loc_149_1_149_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_149_1_149_7&#39;)"><span class="hl_varref"><span class="mpre">setEOF</span></span></a><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
            </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">E.throwIO</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_141_7_141_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_141_7_141_17&#39;)"><span class="hl_conref"><span class="mpre">Terminated</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> </span><a href="#loc_107_34_107_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_34_107_40&#39;)"><span class="hl_varref"><span class="mpre">reason</span></span></a><span class="mpre"> </span><a href="#loc_107_19_107_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_19_107_22&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre">)

        </span><span class="hl_comment"><span class="mpre">-- the other side could have close the connection already, so wrap</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- this in a try and ignore all exceptions</span></span><span class="mpre">
        </span><a name="loc_118_9_118_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_9_118_15&#39;)"><span class="hl_vardecl"><span class="mpre">tryBye</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Util.html#loc_81_1_81_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_81_1_81_15&#39;)"><span class="hl_varref"><span class="mpre">catchException</span></span></a><span class="mpre"> (</span><a href="#loc_52_1_52_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_4&#39;)"><span class="hl_varref"><span class="mpre">bye</span></span></a><span class="mpre"> </span><a href="#loc_73_10_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) (\_ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)

</span><span class="warning" data-warning="DeclDeprPragmaDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 120, srcSpanStartColumn = 1, srcSpanEndLine = 120, srcSpanEndColumn = 75}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 120, srcSpanStartColumn = 1, srcSpanEndLine = 120, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 120, s"><span class="mpre">{-# DEPRECATED recvData&#39; &quot;use recvData that returns strict bytestring&quot; #-}</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | same as recvData but returns a lazy bytestring.</span></span><span class="mpre">
</span><a href="#loc_123_1_123_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_10&#39;)"><span class="mpre">recvData&#39;</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 122, srcSpanStartColumn = 14, srcSpanEndLine = 122, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Core.hs&quot;, srcSpanStartLine = 122, srcSpanStartColumn = 24, srcSpanEndLine = 122, srcSpanEndColumn = 26}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/"><span class="mpre">MonadIO m =&gt;</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre">
</span><a name="loc_123_1_123_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_10&#39;)"><span class="hl_fundecl"><span class="mpre">recvData&#39;</span></span></a><span class="mpre"> </span><a name="loc_123_11_123_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_11_123_14&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> = </span><a href="#loc_73_1_73_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_9&#39;)"><span class="hl_varref"><span class="mpre">recvData</span></span></a><span class="mpre"> </span><a href="#loc_123_11_123_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_11_123_14&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.fromChunks</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">[])
</span></div></body></html>