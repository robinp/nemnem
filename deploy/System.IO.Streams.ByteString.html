<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE BangPatterns       #-}
{-# LANGUAGE DeriveDataTypeable #-}
{-# LANGUAGE OverloadedStrings  #-}

</span><span class="hl_comment"><span class="mpre">-- | Stream operations on &#39;ByteString&#39;.</span></span><span class="mpre">
module System.IO.Streams.ByteString
 ( </span><span class="hl_comment"><span class="mpre">-- * Counting bytes</span></span><span class="mpre">
   countInput
 , countOutput

   </span><span class="hl_comment"><span class="mpre">-- * Treating strings as streams</span></span><span class="mpre">
 , fromByteString
 , fromLazyByteString

   </span><span class="hl_comment"><span class="mpre">-- * Input and output</span></span><span class="mpre">
 , readExactly
 , takeBytesWhile
 , writeLazyByteString

   </span><span class="hl_comment"><span class="mpre">-- * Stream transformers</span></span><span class="mpre">
   </span><span class="hl_comment"><span class="mpre">-- ** Splitting/Joining</span></span><span class="mpre">
 , splitOn
 , lines
 , unlines
 , words
 , unwords

   </span><span class="hl_comment"><span class="mpre">-- ** Other</span></span><span class="mpre">
 , giveBytes
 , giveExactly
 , takeBytes
 , takeExactly
 , throwIfConsumesMoreThan
 , throwIfProducesMoreThan

   </span><span class="hl_comment"><span class="mpre">-- ** Rate limiting</span></span><span class="mpre">
 , throwIfTooSlow

   </span><span class="hl_comment"><span class="mpre">-- * String search</span></span><span class="mpre">
 , MatchInfo(..)
 , search

   </span><span class="hl_comment"><span class="mpre">-- * Exception types</span></span><span class="mpre">
 , RateTooSlowException
 , ReadTooShortException
 , TooManyBytesReadException
 , TooManyBytesWrittenException
 , TooFewBytesWrittenException

 ) where

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
import           Control.Exception                 (Exception, </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="mpre">throwIO</span></a><span class="mpre">)
import           Control.Monad                     (</span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_180_3_180_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_180_3_180_6&#39;)"><span class="mpre">(&gt;=&gt;)</span></a><span class="mpre">)
import           </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/ByteString.hs&quot;, srcSpanStartLine = 55, srcSpanStartColumn = 18, srcSpanEndLine = 55, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre">                   (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/ByteString.hs&quot;, srcSpanStartLine = 56, srcSpanStartColumn = 18, srcSpanEndLine = 56, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre">             as S
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/ByteString.hs&quot;, srcSpanStartLine = 57, srcSpanStartColumn = 18, srcSpanEndLine = 57, srcSpanEndColumn = 44}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy.Char8&quot;"><span class="mpre">Data.ByteString.Lazy.Char8</span></span><span class="mpre">        as L
import qualified Data.ByteString.Unsafe            as S
import           Data.Char                         (</span><a href="GHC.Unicode.html#loc_72_1_72_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_72_1_72_8&#39;)"><span class="mpre">isSpace</span></a><span class="mpre">)
import           Data.Int                          (</span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="mpre">Int64</span></a><span class="mpre">)
import           Data.IORef                        (</span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="mpre">IORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="mpre">newIORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="mpre">readIORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="mpre">writeIORef</span></a><span class="mpre">)
import           Data.Time.Clock.POSIX             (</span><a href="Data.Time.Clock.POSIX.html#loc_51_1_51_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Time.Clock.POSIX.html#loc_51_1_51_13&#39;)"><span class="mpre">getPOSIXTime</span></a><span class="mpre">)
import           Data.Typeable                     (</span><a href="Data.Typeable.Internal.html#loc_196_7_196_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Typeable.Internal.html#loc_196_7_196_15&#39;)"><span class="mpre">Typeable</span></a><span class="mpre">)
import           Prelude                           hiding (</span><a href="Text.Read.html#loc_91_1_91_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Read.html#loc_91_1_91_5&#39;)"><span class="mpre">read</span></a><span class="mpre">, </span><a href="Data.List.html#loc_1044_1_1044_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_1044_1_1044_6&#39;)"><span class="mpre">lines</span></a><span class="mpre">, </span><a href="Data.List.html#loc_1060_1_1060_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_1060_1_1060_8&#39;)"><span class="mpre">unlines</span></a><span class="mpre">, </span><a href="Data.List.html#loc_1071_1_1071_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_1071_1_1071_6&#39;)"><span class="mpre">words</span></a><span class="mpre">, </span><a href="Data.List.html#loc_1081_1_1081_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_1081_1_1081_8&#39;)"><span class="mpre">unwords</span></a><span class="mpre">)
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
import           System.IO.Streams.Combinators     (</span><a href="System.IO.Streams.Combinators.html#loc_445_1_445_8" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Combinators.html#loc_445_1_445_8&#39;)"><span class="mpre">filterM</span></a><span class="mpre">, </span><a href="System.IO.Streams.Combinators.html#loc_502_1_502_12" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Combinators.html#loc_502_1_502_12&#39;)"><span class="mpre">intersperse</span></a><span class="mpre">, </span><a href="System.IO.Streams.Combinators.html#loc_88_1_88_12" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Combinators.html#loc_88_1_88_12&#39;)"><span class="mpre">outputFoldM</span></a><span class="mpre">)
import           System.IO.Streams.Internal        (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="mpre">InputStream</span></a><span class="mpre"> (..), </span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="mpre">OutputStream</span></a><span class="mpre">, </span><a href="System.IO.Streams.Internal.html#loc_247_1_247_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_247_1_247_16&#39;)"><span class="mpre">makeInputStream</span></a><span class="mpre">, </span><a href="System.IO.Streams.Internal.html#loc_273_1_273_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_273_1_273_17&#39;)"><span class="mpre">makeOutputStream</span></a><span class="mpre">, </span><a href="System.IO.Streams.Internal.html#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_137_1_137_5&#39;)"><span class="mpre">read</span></a><span class="mpre">, </span><a href="System.IO.Streams.Internal.html#loc_178_1_178_7" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_178_1_178_7&#39;)"><span class="mpre">unRead</span></a><span class="mpre">, </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="mpre">write</span></a><span class="mpre">)
import           System.IO.Streams.Internal.Search (</span><a href="System.IO.Streams.Internal.Search.html#loc_25_6_25_15" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.Search.html#loc_25_6_25_15&#39;)"><span class="mpre">MatchInfo</span></a><span class="mpre"> (..), </span><a href="System.IO.Streams.Internal.Search.html#loc_70_1_70_7" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.Search.html#loc_70_1_70_7&#39;)"><span class="mpre">search</span></a><span class="mpre">)
import           System.IO.Streams.List            (</span><a href="System.IO.Streams.List.html#loc_36_1_36_9" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.List.html#loc_36_1_36_9&#39;)"><span class="mpre">fromList</span></a><span class="mpre">, </span><a href="System.IO.Streams.List.html#loc_130_1_130_10" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.List.html#loc_130_1_130_10&#39;)"><span class="mpre">writeList</span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_75_1_75_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_10&#39;)"><span class="mpre">modifyRef</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_75_1_75_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_10&#39;)"><span class="mpre">modifyRef</span></a><span class="mpre"> :: </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_75_1_75_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_10&#39;)"><span class="hl_fundecl"><span class="mpre">modifyRef</span></span></a><span class="mpre"> </span><a name="loc_75_11_75_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_11_75_14&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> </span><a name="loc_75_15_75_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_15_75_16&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = do
    </span><a name="loc_76_5_76_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_5_76_6&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_75_11_75_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_11_75_14&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">
    </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_75_11_75_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_11_75_14&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_75_15_75_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_15_75_16&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_76_5_76_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_5_76_6&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Writes a lazy &#39;ByteString&#39; to an &#39;OutputStream&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;writeLazyByteString&#39; \&quot;Test\\n\&quot; Streams.&#39;System.IO.Streams.stdout&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Test</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_92_1_92_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_20&#39;)"><span class="mpre">writeLazyByteString</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre">             </span><span class="hl_comment"><span class="mpre">-- ^ string to write to output</span></span><span class="mpre">
                    -&gt; </span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^ output stream</span></span><span class="mpre">
                    -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_92_1_92_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_20&#39;)"><span class="hl_vardecl"><span class="mpre">writeLazyByteString</span></span></a><span class="mpre"> = </span><a href="System.IO.Streams.List.html#loc_130_1_130_10" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.List.html#loc_130_1_130_10&#39;)"><span class="hl_varref"><span class="mpre">writeList</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.toChunks</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_92_1_92_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_20&#39;)"><span class="mpre">writeLazyByteString</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Creates an &#39;InputStream&#39; from a &#39;ByteString&#39;.</span></span><span class="mpre">
</span><a href="#loc_99_1_99_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_15&#39;)"><span class="mpre">fromByteString</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_99_1_99_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_15&#39;)"><span class="hl_vardecl"><span class="mpre">fromByteString</span></span></a><span class="mpre"> = </span><a href="System.IO.Streams.List.html#loc_36_1_36_9" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.List.html#loc_36_1_36_9&#39;)"><span class="hl_varref"><span class="mpre">fromList</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">[])


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Creates an &#39;InputStream&#39; from a lazy &#39;ByteString&#39;.</span></span><span class="mpre">
</span><a href="#loc_105_1_105_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_1_105_19&#39;)"><span class="mpre">fromLazyByteString</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_105_1_105_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_1_105_19&#39;)"><span class="hl_vardecl"><span class="mpre">fromLazyByteString</span></span></a><span class="mpre"> = </span><a href="System.IO.Streams.List.html#loc_36_1_36_9" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.List.html#loc_36_1_36_9&#39;)"><span class="hl_varref"><span class="mpre">fromList</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.toChunks</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Wraps an &#39;InputStream&#39;, counting the number of bytes produced by the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- stream as a side effect. Produces a new &#39;InputStream&#39; as well as an IO</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- action to retrieve the count of bytes produced.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Strings pushed back to the returned &#39;InputStream&#39; will be pushed back to the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- original stream, and the count of produced bytes will be subtracted</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- accordingly.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; is &lt;- Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;abc\&quot;, \&quot;def\&quot;, \&quot;ghi\&quot;::ByteString]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; (is&#39;, getCount) &lt;- Streams.&#39;countInput&#39; is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;read&#39; is&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just \&quot;abc\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; getCount</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 3</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;unRead&#39; \&quot;bc\&quot; is&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; getCount</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 1</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.peek&#39; is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just \&quot;bc\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.toList&#39; is&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [\&quot;bc\&quot;,\&quot;def\&quot;,\&quot;ghi\&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; getCount</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 9</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_138_1_138_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_11&#39;)"><span class="mpre">countInput</span></a><span class="mpre"> :: </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre">)
</span><a name="loc_138_1_138_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_11&#39;)"><span class="hl_fundecl"><span class="mpre">countInput</span></span></a><span class="mpre"> </span><a name="loc_138_12_138_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_12_138_15&#39;)"><span class="hl_vardecl"><span class="mpre">src</span></span></a><span class="mpre"> = do
    </span><a name="loc_139_5_139_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_5_139_8&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre">    &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> (</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> :: </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">InputStream</span></span><span class="mpre"> (</span><a href="#loc_143_5_143_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_5_143_9&#39;)"><span class="hl_varref"><span class="mpre">prod</span></span></a><span class="mpre"> </span><a href="#loc_139_5_139_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_5_139_8&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">) (</span><a href="#loc_147_5_147_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_5_147_7&#39;)"><span class="hl_varref"><span class="mpre">pb</span></span></a><span class="mpre"> </span><a href="#loc_139_5_139_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_5_139_8&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">), </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_139_5_139_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_5_139_8&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">)

  where
    </span><a name="loc_143_5_143_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_5_143_9&#39;)"><span class="hl_fundecl"><span class="mpre">prod</span></span></a><span class="mpre"> </span><a name="loc_143_10_143_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_10_143_13&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> = </span><a href="System.IO.Streams.Internal.html#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_138_12_138_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_12_138_15&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">) (\</span><a name="loc_143_54_143_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_54_143_55&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; do
        </span><a href="#loc_75_1_75_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_10&#39;)"><span class="hl_varref"><span class="mpre">modifyRef</span></span></a><span class="mpre"> </span><a href="#loc_143_10_143_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_10_143_13&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_143_54_143_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_54_143_55&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">))
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_143_54_143_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_54_143_55&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)

    </span><a name="loc_147_5_147_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_5_147_7&#39;)"><span class="hl_fundecl"><span class="mpre">pb</span></span></a><span class="mpre"> </span><a name="loc_147_8_147_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_8_147_11&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> </span><a name="loc_147_12_147_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_12_147_13&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = do
        </span><a href="#loc_75_1_75_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_10&#39;)"><span class="hl_varref"><span class="mpre">modifyRef</span></span></a><span class="mpre"> </span><a href="#loc_147_8_147_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_8_147_11&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> (\</span><a name="loc_148_25_148_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_25_148_26&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_148_25_148_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_25_148_26&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_147_12_147_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_12_147_13&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">))
        </span><a href="System.IO.Streams.Internal.html#loc_178_1_178_7" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_178_1_178_7&#39;)"><span class="hl_varref"><span class="mpre">unRead</span></span></a><span class="mpre"> </span><a href="#loc_147_12_147_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_12_147_13&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_138_12_138_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_12_138_15&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Wraps an &#39;OutputStream&#39;, counting the number of bytes consumed by the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- stream as a side effect. Produces a new &#39;OutputStream&#39; as well as an IO</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- action to retrieve the count of bytes consumed.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; (os :: OutputStream ByteString, getList) &lt;- Streams.&#39;System.IO.Streams.listOutputStream&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; (os&#39;, getCount) &lt;- Streams.&#39;countOutput&#39; os</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;abc\&quot;, \&quot;def\&quot;, \&quot;ghi\&quot;] &gt;&gt;= Streams.&#39;System.IO.Streams.connectTo&#39; os&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; getList</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [\&quot;abc\&quot;,\&quot;def\&quot;,\&quot;ghi\&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; getCount</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 9</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_170_1_170_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_12&#39;)"><span class="mpre">countOutput</span></a><span class="mpre"> :: </span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre">)
</span><a name="loc_170_1_170_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_12&#39;)"><span class="hl_vardecl"><span class="mpre">countOutput</span></span></a><span class="mpre"> = </span><a href="System.IO.Streams.Combinators.html#loc_88_1_88_12" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Combinators.html#loc_88_1_88_12&#39;)"><span class="hl_varref"><span class="mpre">outputFoldM</span></span></a><span class="mpre"> </span><a href="#loc_172_5_172_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_5_172_6&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
  where
    </span><a name="loc_172_5_172_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_5_172_6&#39;)"><span class="hl_fundecl"><span class="mpre">f</span></span></a><span class="mpre"> !</span><a name="loc_172_8_172_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_8_172_13&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> </span><a name="loc_172_14_172_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_14_172_15&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_175_10_175_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_10_175_11&#39;)"><span class="hl_varref"><span class="mpre">z</span></span></a><span class="mpre">
      where
        !</span><a name="loc_174_10_174_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_10_174_11&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_172_14_172_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_14_172_15&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
        !</span><a name="loc_175_10_175_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_10_175_11&#39;)"><span class="hl_vardecl"><span class="mpre">z</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">toEnum</span></span><span class="mpre"> </span><a href="#loc_174_10_174_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_10_174_11&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_172_8_172_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_8_172_13&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Wraps an &#39;InputStream&#39;, producing a new &#39;InputStream&#39; that will produce at</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- most @n@ bytes, subsequently yielding end-of-stream forever.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Strings pushed back to the returned &#39;InputStream&#39; will be propagated</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- upstream, modifying the count of taken bytes accordingly.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; is &lt;- Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;truncated\&quot;, \&quot; string\&quot;::ByteString]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; is&#39; &lt;- Streams.&#39;takeBytes&#39; 9 is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;read&#39; is&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just \&quot;truncated\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;read&#39; is&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Nothing</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.peek&#39; is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just \&quot; string\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;unRead&#39; \&quot;cated\&quot; is&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.peek&#39; is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just \&quot;cated\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.peek&#39; is&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just \&quot;cated\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;read&#39; is&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just \&quot;cated\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;read&#39; is&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Nothing</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;read&#39; is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just \&quot; string\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_211_1_211_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_10&#39;)"><span class="mpre">takeBytes</span></a><span class="mpre"> :: </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre">                        </span><span class="hl_comment"><span class="mpre">-- ^ maximum number of bytes to read</span></span><span class="mpre">
          -&gt; </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">       </span><span class="hl_comment"><span class="mpre">-- ^ input stream to wrap</span></span><span class="mpre">
          -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_211_1_211_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_10&#39;)"><span class="hl_fundecl"><span class="mpre">takeBytes</span></span></a><span class="mpre"> </span><a name="loc_211_11_211_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_11_211_13&#39;)"><span class="hl_vardecl"><span class="mpre">k0</span></span></a><span class="mpre"> = </span><a href="#loc_233_1_233_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_1_233_11&#39;)"><span class="hl_varref"><span class="mpre">takeBytes&#39;</span></span></a><span class="mpre"> </span><a href="#loc_211_11_211_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_11_211_13&#39;)"><span class="hl_varref"><span class="mpre">k0</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_211_1_211_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_10&#39;)"><span class="mpre">takeBytes</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Like @Streams.&#39;takeBytes&#39;@, but throws &#39;ReadTooShortException&#39; when</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- there aren&#39;t enough bytes present on the source.</span></span><span class="mpre">
</span><a href="#loc_221_1_221_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_1_221_12&#39;)"><span class="mpre">takeExactly</span></a><span class="mpre"> :: </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre">                        </span><span class="hl_comment"><span class="mpre">-- ^ number of bytes to read</span></span><span class="mpre">
            -&gt; </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">       </span><span class="hl_comment"><span class="mpre">-- ^ input stream to wrap</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_221_1_221_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_1_221_12&#39;)"><span class="hl_fundecl"><span class="mpre">takeExactly</span></span></a><span class="mpre"> </span><a name="loc_221_13_221_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_13_221_15&#39;)"><span class="hl_vardecl"><span class="mpre">k0</span></span></a><span class="mpre"> = </span><a href="#loc_233_1_233_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_1_233_11&#39;)"><span class="hl_varref"><span class="mpre">takeBytes&#39;</span></span></a><span class="mpre"> </span><a href="#loc_221_13_221_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_13_221_15&#39;)"><span class="hl_varref"><span class="mpre">k0</span></span></a><span class="mpre"> (</span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_425_30_425_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_425_30_425_51&#39;)"><span class="hl_conref"><span class="mpre">ReadTooShortException</span></span></a><span class="mpre"> </span><a href="#loc_221_13_221_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_13_221_15&#39;)"><span class="hl_varref"><span class="mpre">k0</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_221_1_221_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_1_221_12&#39;)"><span class="mpre">takeExactly</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Helper for the two above.</span></span><span class="mpre">
</span><a href="#loc_233_1_233_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_1_233_11&#39;)"><span class="mpre">takeBytes&#39;</span></a><span class="mpre"> :: </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre">
           -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
           </span><span class="hl_comment"><span class="mpre">-- ^ What to do if the input ends before having consumed the</span></span><span class="mpre">
           </span><span class="hl_comment"><span class="mpre">-- right amount of bytes.</span></span><span class="mpre">
           -&gt; </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
           -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_233_1_233_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_1_233_11&#39;)"><span class="hl_fundecl"><span class="mpre">takeBytes&#39;</span></span></a><span class="mpre"> </span><a name="loc_233_12_233_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_12_233_14&#39;)"><span class="hl_vardecl"><span class="mpre">k0</span></span></a><span class="mpre"> </span><a name="loc_233_15_233_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_15_233_16&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_233_17_233_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_17_233_20&#39;)"><span class="hl_vardecl"><span class="mpre">src</span></span></a><span class="mpre"> = do
    </span><a name="loc_234_5_234_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_234_5_234_9&#39;)"><span class="hl_vardecl"><span class="mpre">kref</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_233_12_233_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_12_233_14&#39;)"><span class="hl_varref"><span class="mpre">k0</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">InputStream</span></span><span class="mpre"> (</span><a href="#loc_237_5_237_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_5_237_9&#39;)"><span class="hl_varref"><span class="mpre">prod</span></span></a><span class="mpre"> </span><a href="#loc_234_5_234_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_234_5_234_9&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre">) (</span><a href="#loc_254_5_254_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_5_254_7&#39;)"><span class="hl_varref"><span class="mpre">pb</span></span></a><span class="mpre"> </span><a href="#loc_234_5_234_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_234_5_234_9&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre">)
  where
    </span><a name="loc_237_5_237_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_5_237_9&#39;)"><span class="hl_fundecl"><span class="mpre">prod</span></span></a><span class="mpre"> </span><a name="loc_237_10_237_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_10_237_14&#39;)"><span class="hl_vardecl"><span class="mpre">kref</span></span></a><span class="mpre"> = do
        </span><a name="loc_238_9_238_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_238_9_238_10&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_237_10_237_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_10_237_14&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre">
        if </span><a href="#loc_238_9_238_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_238_9_238_10&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
           then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
           else </span><a href="System.IO.Streams.Internal.html#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_233_17_233_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_17_233_20&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> </span><a href="#loc_233_15_233_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_15_233_16&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> (</span><a href="#loc_243_9_243_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_9_243_14&#39;)"><span class="hl_varref"><span class="mpre">chunk</span></span></a><span class="mpre"> </span><a href="#loc_238_9_238_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_238_9_238_10&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)
      where
        </span><a name="loc_243_9_243_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_9_243_14&#39;)"><span class="hl_fundecl"><span class="mpre">chunk</span></span></a><span class="mpre"> </span><a name="loc_243_15_243_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_15_243_16&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> </span><a name="loc_243_17_243_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_17_243_18&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = do
            let </span><a name="loc_244_17_244_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_17_244_18&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_243_17_243_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_17_243_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
            let </span><a name="loc_245_17_245_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_17_245_19&#39;)"><span class="hl_vardecl"><span class="mpre">k&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_243_15_243_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_15_243_16&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_244_17_244_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_17_244_18&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
            if </span><a href="#loc_245_17_245_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_17_245_19&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
              then let (</span><a name="loc_247_25_247_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_25_247_26&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">,</span><a name="loc_247_27_247_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_27_247_28&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">S.splitAt</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_243_15_243_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_15_243_16&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">) </span><a href="#loc_243_17_243_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_17_243_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
                   in do
                       </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_247_27_247_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_27_247_28&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="System.IO.Streams.Internal.html#loc_178_1_178_7" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_178_1_178_7&#39;)"><span class="hl_varref"><span class="mpre">unRead</span></span></a><span class="mpre"> </span><a href="#loc_247_27_247_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_27_247_28&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><a href="#loc_233_17_233_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_17_233_20&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre">
                       </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_237_10_237_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_10_237_14&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
                       </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_247_25_247_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_25_247_26&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
              else </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_237_10_237_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_10_237_14&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre"> </span><a href="#loc_245_17_245_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_17_245_19&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_243_17_243_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_17_243_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)

    </span><a name="loc_254_5_254_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_5_254_7&#39;)"><span class="hl_fundecl"><span class="mpre">pb</span></span></a><span class="mpre"> </span><a name="loc_254_8_254_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_8_254_12&#39;)"><span class="hl_vardecl"><span class="mpre">kref</span></span></a><span class="mpre"> </span><a name="loc_254_13_254_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_13_254_14&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = do
        </span><a href="#loc_75_1_75_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_10&#39;)"><span class="hl_varref"><span class="mpre">modifyRef</span></span></a><span class="mpre"> </span><a href="#loc_254_8_254_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_8_254_12&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_254_13_254_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_13_254_14&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">))
        </span><a href="System.IO.Streams.Internal.html#loc_178_1_178_7" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_178_1_178_7&#39;)"><span class="hl_varref"><span class="mpre">unRead</span></span></a><span class="mpre"> </span><a href="#loc_254_13_254_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_13_254_14&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_233_17_233_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_17_233_20&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_233_1_233_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_1_233_11&#39;)"><span class="mpre">takeBytes&#39;</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Splits an &#39;InputStream&#39; over &#39;ByteString&#39;s using a delimiter predicate.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   * data pushed back with &#39;unRead&#39; is *not* propagated upstream here.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   * the resulting &#39;InputStream&#39; may hold an unbounded amount of the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     bytestring in memory waiting for the function to return true, so this</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     function should not be used in unsafe contexts.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   * the delimiter is NOT included in the output.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   * consecutive delimiters are not merged.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;the quick br\&quot;, \&quot;own  fox\&quot;::&#39;ByteString&#39;] &gt;&gt;=</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--       Streams.&#39;splitOn&#39; (== \&#39; \&#39;) &gt;&gt;= Streams.&#39;System.IO.Streams.toList&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [\&quot;the\&quot;,\&quot;quick\&quot;,\&quot;brown\&quot;,\&quot;\&quot;,\&quot;fox\&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_287_1_287_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_1_287_8&#39;)"><span class="mpre">splitOn</span></a><span class="mpre"> :: (</span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">)               </span><span class="hl_comment"><span class="mpre">-- ^ predicate used to break the input</span></span><span class="mpre">
                                        </span><span class="hl_comment"><span class="mpre">-- stream into chunks</span></span><span class="mpre">
        -&gt; </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">       </span><span class="hl_comment"><span class="mpre">-- ^ input stream</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_287_1_287_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_1_287_8&#39;)"><span class="hl_fundecl"><span class="mpre">splitOn</span></span></a><span class="mpre"> </span><a name="loc_287_9_287_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_9_287_10&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_287_11_287_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_11_287_13&#39;)"><span class="hl_vardecl"><span class="mpre">is</span></span></a><span class="mpre"> = do
    </span><a name="loc_288_5_288_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_288_5_288_8&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">
    </span><a href="System.IO.Streams.Internal.html#loc_247_1_247_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_247_1_247_16&#39;)"><span class="hl_varref"><span class="mpre">makeInputStream</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_291_5_291_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_5_291_10&#39;)"><span class="hl_varref"><span class="mpre">start</span></span></a><span class="mpre"> </span><a href="#loc_288_5_288_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_288_5_288_8&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">
  where
    </span><a name="loc_291_5_291_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_5_291_10&#39;)"><span class="hl_fundecl"><span class="mpre">start</span></span></a><span class="mpre"> </span><a name="loc_291_11_291_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_11_291_14&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> = </span><a href="#loc_293_9_293_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_9_293_11&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">
      where
        </span><a name="loc_293_9_293_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_9_293_11&#39;)"><span class="hl_vardecl"><span class="mpre">go</span></span></a><span class="mpre">  = </span><a href="System.IO.Streams.Internal.html#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_287_11_287_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_11_287_13&#39;)"><span class="hl_varref"><span class="mpre">is</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> </span><a href="#loc_295_9_295_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_295_9_295_12&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre"> </span><a href="#loc_302_9_302_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_9_302_14&#39;)"><span class="hl_varref"><span class="mpre">chunk</span></span></a><span class="mpre">

        </span><a name="loc_295_9_295_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_295_9_295_12&#39;)"><span class="hl_vardecl"><span class="mpre">end</span></span></a><span class="mpre"> = do
            </span><a name="loc_296_13_296_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_296_13_296_15&#39;)"><span class="hl_vardecl"><span class="mpre">dl</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_291_11_291_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_11_291_14&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">
            case </span><a href="#loc_296_13_296_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_296_13_296_15&#39;)"><span class="hl_varref"><span class="mpre">dl</span></span></a><span class="mpre"> [] of
              [] -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
              </span><a name="loc_299_15_299_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_15_299_17&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_291_11_291_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_11_291_14&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre">
                    (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.concat</span></span><span class="mpre"> </span><a href="#loc_299_15_299_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_15_299_17&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">)

        </span><a name="loc_302_9_302_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_9_302_14&#39;)"><span class="hl_fundecl"><span class="mpre">chunk</span></span></a><span class="mpre"> </span><a name="loc_302_15_302_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_15_302_16&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = let (</span><a name="loc_302_24_302_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_24_302_25&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">, </span><a name="loc_302_27_302_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_27_302_28&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">S.break</span></span><span class="mpre"> </span><a href="#loc_287_9_287_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_9_287_10&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_302_15_302_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_15_302_16&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
                  in if </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_302_27_302_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_27_302_28&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
                       then </span><a href="#loc_75_1_75_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_10&#39;)"><span class="hl_varref"><span class="mpre">modifyRef</span></span></a><span class="mpre"> </span><a href="#loc_291_11_291_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_11_291_14&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> (\</span><a name="loc_304_45_304_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_45_304_46&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_304_45_304_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_45_304_46&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (</span><a href="#loc_302_24_302_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_24_302_25&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_293_9_293_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_9_293_11&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">
                       else do
                         let !</span><a name="loc_306_31_306_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_306_31_306_33&#39;)"><span class="hl_vardecl"><span class="mpre">b&#39;</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Unsafe.html#loc_148_1_148_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Unsafe.html#loc_148_1_148_11&#39;)"><span class="hl_varref"><span class="mpre">S.unsafeDrop</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><a href="#loc_302_27_302_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_27_302_28&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
                         </span><a name="loc_307_26_307_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_26_307_28&#39;)"><span class="hl_vardecl"><span class="mpre">dl</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_291_11_291_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_11_291_14&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">

                         if </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_306_31_306_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_306_31_306_33&#39;)"><span class="hl_varref"><span class="mpre">b&#39;</span></span></a><span class="mpre">
                           then do
                             </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_291_11_291_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_11_291_14&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">)
                             </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.concat</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_307_26_307_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_26_307_28&#39;)"><span class="hl_varref"><span class="mpre">dl</span></span></a><span class="mpre"> [</span><a href="#loc_302_24_302_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_24_302_25&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">]
                           else do
                             </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_291_11_291_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_11_291_14&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">
                             </span><a href="System.IO.Streams.Internal.html#loc_178_1_178_7" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_178_1_178_7&#39;)"><span class="hl_varref"><span class="mpre">unRead</span></span></a><span class="mpre"> </span><a href="#loc_306_31_306_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_306_31_306_33&#39;)"><span class="hl_varref"><span class="mpre">b&#39;</span></span></a><span class="mpre"> </span><a href="#loc_287_11_287_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_11_287_13&#39;)"><span class="hl_varref"><span class="mpre">is</span></span></a><span class="mpre">
                             </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.concat</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_307_26_307_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_26_307_28&#39;)"><span class="hl_varref"><span class="mpre">dl</span></span></a><span class="mpre"> [</span><a href="#loc_302_24_302_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_24_302_25&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">]


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Splits a bytestring &#39;InputStream&#39; into lines. See &#39;splitOn&#39; and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Prelude.lines&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; is \&lt;- Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;Hello,\\n world!\&quot;] &gt;&gt;= Streams.&#39;lines&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; replicateM 3 (Streams.&#39;read&#39; is)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [Just \&quot;Hello\&quot;, Just \&quot;, world!\&quot;, Nothing]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that this may increase the chunk size if the input contains extremely</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- long lines.</span></span><span class="mpre">
</span><a href="#loc_334_1_334_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_334_1_334_6&#39;)"><span class="mpre">lines</span></a><span class="mpre"> :: </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_334_1_334_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_334_1_334_6&#39;)"><span class="hl_vardecl"><span class="mpre">lines</span></span></a><span class="mpre"> = </span><a href="#loc_287_1_287_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_1_287_8&#39;)"><span class="hl_varref"><span class="mpre">splitOn</span></span></a><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Splits a bytestring &#39;InputStream&#39; into words. See &#39;splitOn&#39; and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Prelude.words&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; is \&lt;- Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;Hello, world!\&quot;] &gt;&gt;= Streams.&#39;words&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; replicateM 3 (Streams.&#39;read&#39; is)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [Just \&quot;Hello,\&quot;, Just \&quot;world!\&quot;, Nothing]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that this may increase the chunk size if the input contains extremely</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- long words.</span></span><span class="mpre">
</span><a href="#loc_352_1_352_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_1_352_6&#39;)"><span class="mpre">words</span></a><span class="mpre"> :: </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_352_1_352_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_1_352_6&#39;)"><span class="hl_vardecl"><span class="mpre">words</span></span></a><span class="mpre"> = </span><a href="#loc_287_1_287_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_1_287_8&#39;)"><span class="hl_varref"><span class="mpre">splitOn</span></span></a><span class="mpre"> </span><a href="GHC.Unicode.html#loc_72_1_72_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_72_1_72_8&#39;)"><span class="hl_varref"><span class="mpre">isSpace</span></span></a><span class="mpre"> </span><a href="Control.Monad.html#loc_180_3_180_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_180_3_180_6&#39;)"><span class="hl_infix"><span class="mpre">&gt;=&gt;</span></span></a><span class="mpre"> </span><a href="System.IO.Streams.Combinators.html#loc_445_1_445_8" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Combinators.html#loc_445_1_445_8&#39;)"><span class="hl_varref"><span class="mpre">filterM</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.all</span></span><span class="mpre"> </span><a href="GHC.Unicode.html#loc_72_1_72_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_72_1_72_8&#39;)"><span class="hl_varref"><span class="mpre">isSpace</span></span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Intersperses string chunks sent to the given &#39;OutputStream&#39; with newlines.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- See &#39;intersperse&#39; and &#39;Prelude.unlines&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; os &lt;- Streams.&#39;unlines&#39; Streams.&#39;System.IO.Streams.stdout&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;write&#39; (Just \&quot;Hello,\&quot;) os</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Hello</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;write&#39; Nothing os</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;write&#39; (Just \&quot;world!\&quot;) os</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- world!</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_368_1_368_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_368_1_368_8&#39;)"><span class="mpre">unlines</span></a><span class="mpre"> :: </span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_368_1_368_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_368_1_368_8&#39;)"><span class="hl_fundecl"><span class="mpre">unlines</span></span></a><span class="mpre"> </span><a name="loc_368_9_368_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_368_9_368_11&#39;)"><span class="hl_vardecl"><span class="mpre">os</span></span></a><span class="mpre"> = </span><a href="System.IO.Streams.Internal.html#loc_273_1_273_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_273_1_273_17&#39;)"><span class="hl_varref"><span class="mpre">makeOutputStream</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_368_34_368_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_368_34_368_35&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> -&gt; do
    </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_368_34_368_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_368_34_368_35&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_368_9_368_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_368_9_368_11&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre">
    case </span><a href="#loc_368_34_368_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_368_34_368_35&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> of
        </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
        </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> _  -&gt; </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">) </span><a href="#loc_368_9_368_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_368_9_368_11&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Intersperses string chunks sent to the given &#39;OutputStream&#39; with spaces.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- See &#39;intersperse&#39; and &#39;Prelude.unwords&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; os &lt;- Streams.&#39;unwords&#39; Streams.&#39;System.IO.Streams.stdout&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; forM_ [Just \&quot;Hello,\&quot;, Nothing, Just \&quot;world!\\n\&quot;] $ \w -&gt; Streams.&#39;write&#39; w os</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Hello, world!</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_385_1_385_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_385_1_385_8&#39;)"><span class="mpre">unwords</span></a><span class="mpre"> :: </span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_385_1_385_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_385_1_385_8&#39;)"><span class="hl_vardecl"><span class="mpre">unwords</span></span></a><span class="mpre"> = </span><a href="System.IO.Streams.Combinators.html#loc_502_1_502_12" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Combinators.html#loc_502_1_502_12&#39;)"><span class="hl_varref"><span class="mpre">intersperse</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; &quot;</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Thrown by &#39;throwIfProducesMoreThan&#39; when too many bytes were read from the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- original &#39;InputStream&#39;.</span></span><span class="mpre">
data </span><a name="loc_391_6_391_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_6_391_31&#39;)"><span class="hl_tycondecl"><span class="mpre">TooManyBytesReadException</span></span></a><span class="mpre"> = </span><a name="loc_391_34_391_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_34_391_59&#39;)"><span class="hl_condecl"><span class="mpre">TooManyBytesReadException</span></span></a><span class="mpre"> </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/ByteString.hs&quot;, srcSpanStartLine = 391, srcSpanStartColumn = 60, srcSpanEndLine = 391, srcSpanEndColumn = 79}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/ByteString.hs&quot;, srcSpanStartLine = 391, srcSpanStartColumn = 60, srcSpanEndLine = 391, srcSpanEndColumn = 68},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-"><span class="mpre">deriving (Typeable)</span></span><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Show</span></span><span class="mpre"> </span><a href="#loc_391_6_391_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_6_391_31&#39;)"><span class="hl_tyconref"><span class="mpre">TooManyBytesReadException</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_391_34_391_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_34_391_59&#39;)"><span class="hl_conref"><span class="mpre">TooManyBytesReadException</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;Too many bytes read&quot;</span></span><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Exception</span></span><span class="mpre"> </span><a href="#loc_391_6_391_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_6_391_31&#39;)"><span class="hl_tyconref"><span class="mpre">TooManyBytesReadException</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Thrown by &#39;giveExactly&#39; when too few bytes were written to the produced</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;OutputStream&#39;.</span></span><span class="mpre">
data </span><a name="loc_402_6_402_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_402_6_402_33&#39;)"><span class="hl_tycondecl"><span class="mpre">TooFewBytesWrittenException</span></span></a><span class="mpre"> = </span><a name="loc_402_36_402_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_402_36_402_63&#39;)"><span class="hl_condecl"><span class="mpre">TooFewBytesWrittenException</span></span></a><span class="mpre"> </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/ByteString.hs&quot;, srcSpanStartLine = 402, srcSpanStartColumn = 64, srcSpanEndLine = 402, srcSpanEndColumn = 83}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/ByteString.hs&quot;, srcSpanStartLine = 402, srcSpanStartColumn = 64, srcSpanEndLine = 402, srcSpanEndColumn = 72},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-"><span class="mpre">deriving (Typeable)</span></span><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Show</span></span><span class="mpre"> </span><a href="#loc_402_6_402_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_402_6_402_33&#39;)"><span class="hl_tyconref"><span class="mpre">TooFewBytesWrittenException</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_402_36_402_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_402_36_402_63&#39;)"><span class="hl_conref"><span class="mpre">TooFewBytesWrittenException</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;Too few bytes written&quot;</span></span><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Exception</span></span><span class="mpre"> </span><a href="#loc_402_6_402_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_402_6_402_33&#39;)"><span class="hl_tyconref"><span class="mpre">TooFewBytesWrittenException</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Thrown by &#39;throwIfConsumesMoreThan&#39; when too many bytes were sent to the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- produced &#39;OutputStream&#39;.</span></span><span class="mpre">
data </span><a name="loc_413_6_413_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_413_6_413_34&#39;)"><span class="hl_tycondecl"><span class="mpre">TooManyBytesWrittenException</span></span></a><span class="mpre"> =
    </span><a name="loc_414_5_414_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_414_5_414_33&#39;)"><span class="hl_condecl"><span class="mpre">TooManyBytesWrittenException</span></span></a><span class="mpre"> </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/ByteString.hs&quot;, srcSpanStartLine = 414, srcSpanStartColumn = 34, srcSpanEndLine = 414, srcSpanEndColumn = 53}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/ByteString.hs&quot;, srcSpanStartLine = 414, srcSpanStartColumn = 34, srcSpanEndLine = 414, srcSpanEndColumn = 42},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-"><span class="mpre">deriving (Typeable)</span></span><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Show</span></span><span class="mpre"> </span><a href="#loc_413_6_413_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_413_6_413_34&#39;)"><span class="hl_tyconref"><span class="mpre">TooManyBytesWrittenException</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_414_5_414_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_414_5_414_33&#39;)"><span class="hl_conref"><span class="mpre">TooManyBytesWrittenException</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;Too many bytes written&quot;</span></span><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Exception</span></span><span class="mpre"> </span><a href="#loc_413_6_413_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_413_6_413_34&#39;)"><span class="hl_tyconref"><span class="mpre">TooManyBytesWrittenException</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Thrown by &#39;readExactly&#39; and &#39;takeExactly&#39; when not enough bytes were</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- available on the input.</span></span><span class="mpre">
data </span><a name="loc_425_6_425_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_425_6_425_27&#39;)"><span class="hl_tycondecl"><span class="mpre">ReadTooShortException</span></span></a><span class="mpre"> = </span><a name="loc_425_30_425_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_425_30_425_51&#39;)"><span class="hl_condecl"><span class="mpre">ReadTooShortException</span></span></a><span class="mpre"> </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre"> </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/ByteString.hs&quot;, srcSpanStartLine = 425, srcSpanStartColumn = 58, srcSpanEndLine = 425, srcSpanEndColumn = 77}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/ByteString.hs&quot;, srcSpanStartLine = 425, srcSpanStartColumn = 58, srcSpanEndLine = 425, srcSpanEndColumn = 66},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-"><span class="mpre">deriving (Typeable)</span></span><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Show</span></span><span class="mpre"> </span><a href="#loc_425_6_425_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_425_6_425_27&#39;)"><span class="hl_tyconref"><span class="mpre">ReadTooShortException</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">show</span></span><span class="mpre"> (</span><a href="#loc_425_30_425_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_425_30_425_51&#39;)"><span class="hl_conref"><span class="mpre">ReadTooShortException</span></span></a><span class="mpre"> </span><a name="loc_428_33_428_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_33_428_34&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">) = </span><span class="hl_string"><span class="mpre">&quot;Short read, expected &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_428_33_428_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_33_428_34&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
                                     </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; bytes&quot;</span></span><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Exception</span></span><span class="mpre"> </span><a href="#loc_425_6_425_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_425_6_425_27&#39;)"><span class="hl_tyconref"><span class="mpre">ReadTooShortException</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Wraps an &#39;InputStream&#39;. If more than @n@ bytes are produced by this</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- stream, &#39;read&#39; will throw a &#39;TooManyBytesReadException&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If a chunk yielded by the input stream would result in more than @n@ bytes</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- being produced, &#39;throwIfProducesMoreThan&#39; will cut the generated string such</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- that exactly @n@ bytes are yielded by the returned stream, and the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /subsequent/ read will throw an exception. Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; is \&lt;- Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;abc\&quot;, \&quot;def\&quot;, \&quot;ghi\&quot;] &gt;&gt;=</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--             Streams.&#39;throwIfProducesMoreThan&#39; 5</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; &#39;Control.Monad.replicateM&#39; 2 (&#39;read&#39; is)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [Just \&quot;abc\&quot;,Just \&quot;de\&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;read&#39; is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- *** Exception: Too many bytes read</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Strings pushed back to the returned &#39;InputStream&#39; will be propagated</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- upstream, modifying the count of taken bytes accordingly. Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; is  &lt;- Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;abc\&quot;, \&quot;def\&quot;, \&quot;ghi\&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; is&#39; &lt;- Streams.&#39;throwIfProducesMoreThan&#39; 5 is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;read&#39; is&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just \&quot;abc\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;unRead&#39; \&quot;xyz\&quot; is&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.peek&#39; is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just \&quot;xyz\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;read&#39; is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just \&quot;xyz\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;read&#39; is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just \&quot;de\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;read&#39; is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- *** Exception: Too many bytes read</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_475_1_475_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_1_475_24&#39;)"><span class="mpre">throwIfProducesMoreThan</span></a><span class="mpre">
    :: </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre">                    </span><span class="hl_comment"><span class="mpre">-- ^ maximum number of bytes to read</span></span><span class="mpre">
    -&gt; </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">   </span><span class="hl_comment"><span class="mpre">-- ^ input stream</span></span><span class="mpre">
    -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_475_1_475_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_1_475_24&#39;)"><span class="hl_fundecl"><span class="mpre">throwIfProducesMoreThan</span></span></a><span class="mpre"> </span><a name="loc_475_25_475_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_25_475_27&#39;)"><span class="hl_vardecl"><span class="mpre">k0</span></span></a><span class="mpre"> </span><a name="loc_475_28_475_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_28_475_31&#39;)"><span class="hl_vardecl"><span class="mpre">src</span></span></a><span class="mpre"> = do
    </span><a name="loc_476_5_476_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_476_5_476_9&#39;)"><span class="hl_vardecl"><span class="mpre">kref</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_475_25_475_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_25_475_27&#39;)"><span class="hl_varref"><span class="mpre">k0</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">InputStream</span></span><span class="mpre"> (</span><a href="#loc_479_5_479_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_479_5_479_9&#39;)"><span class="hl_varref"><span class="mpre">prod</span></span></a><span class="mpre"> </span><a href="#loc_476_5_476_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_476_5_476_9&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre">) (</span><a href="#loc_495_5_495_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_495_5_495_7&#39;)"><span class="hl_varref"><span class="mpre">pb</span></span></a><span class="mpre"> </span><a href="#loc_476_5_476_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_476_5_476_9&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre">)
  where
    </span><a name="loc_479_5_479_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_479_5_479_9&#39;)"><span class="hl_fundecl"><span class="mpre">prod</span></span></a><span class="mpre"> </span><a name="loc_479_10_479_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_479_10_479_14&#39;)"><span class="hl_vardecl"><span class="mpre">kref</span></span></a><span class="mpre"> = </span><a href="System.IO.Streams.Internal.html#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_475_28_475_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_28_475_31&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">) </span><a href="#loc_481_9_481_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_481_9_481_14&#39;)"><span class="hl_varref"><span class="mpre">chunk</span></span></a><span class="mpre">
      where
        </span><a name="loc_481_9_481_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_481_9_481_14&#39;)"><span class="hl_fundecl"><span class="mpre">chunk</span></span></a><span class="mpre"> </span><a name="loc_481_15_481_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_481_15_481_16&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = do
            </span><a name="loc_482_13_482_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_482_13_482_14&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_479_10_479_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_479_10_479_14&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre">
            let </span><a name="loc_483_17_483_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_483_17_483_19&#39;)"><span class="hl_vardecl"><span class="mpre">k&#39;</span></span></a><span class="mpre">    = </span><a href="#loc_482_13_482_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_482_13_482_14&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_493_13_493_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_493_13_493_14&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
            case </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> of !_ | </span><a href="#loc_493_13_493_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_493_13_493_14&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_481_15_481_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_481_15_481_16&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)
                          | </span><a href="#loc_482_13_482_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_482_13_482_14&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">  -&gt; </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="#loc_391_34_391_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_34_391_59&#39;)"><span class="hl_conref"><span class="mpre">TooManyBytesReadException</span></span></a><span class="mpre">
                          | </span><a href="#loc_483_17_483_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_483_17_483_19&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> -&gt; </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_479_10_479_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_479_10_479_14&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre"> </span><a href="#loc_483_17_483_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_483_17_483_19&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_481_15_481_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_481_15_481_16&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)
                          | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> -&gt; do
                                let (!</span><a name="loc_488_39_488_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_488_39_488_40&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">,!</span><a name="loc_488_42_488_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_488_42_488_43&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">S.splitAt</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromEnum</span></span><span class="mpre"> </span><a href="#loc_482_13_482_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_482_13_482_14&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">) </span><a href="#loc_481_15_481_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_481_15_481_16&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
                                </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_479_10_479_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_479_10_479_14&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
                                </span><a href="System.IO.Streams.Internal.html#loc_178_1_178_7" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_178_1_178_7&#39;)"><span class="hl_varref"><span class="mpre">unRead</span></span></a><span class="mpre"> </span><a href="#loc_488_42_488_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_488_42_488_43&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><a href="#loc_475_28_475_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_28_475_31&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre">
                                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_488_39_488_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_488_39_488_40&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
          where
            </span><a name="loc_493_13_493_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_493_13_493_14&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">     = </span><span class="hl_varref"><span class="mpre">toEnum</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_481_15_481_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_481_15_481_16&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">

    </span><a name="loc_495_5_495_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_495_5_495_7&#39;)"><span class="hl_fundecl"><span class="mpre">pb</span></span></a><span class="mpre"> </span><a name="loc_495_8_495_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_495_8_495_12&#39;)"><span class="hl_vardecl"><span class="mpre">kref</span></span></a><span class="mpre"> </span><a name="loc_495_13_495_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_495_13_495_14&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = do
        </span><a href="System.IO.Streams.Internal.html#loc_178_1_178_7" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_178_1_178_7&#39;)"><span class="hl_varref"><span class="mpre">unRead</span></span></a><span class="mpre"> </span><a href="#loc_495_13_495_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_495_13_495_14&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_475_28_475_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_28_475_31&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre">
        </span><a href="#loc_75_1_75_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_10&#39;)"><span class="hl_varref"><span class="mpre">modifyRef</span></span></a><span class="mpre"> </span><a href="#loc_495_8_495_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_495_8_495_12&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_495_13_495_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_495_13_495_14&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">))


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Reads an @n@-byte ByteString from an input stream. Throws a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;ReadTooShortException&#39; if fewer than @n@ bytes were available.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;long string\&quot;] &gt;&gt;= Streams.&#39;readExactly&#39; 6</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- \&quot;long s\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;short\&quot;] &gt;&gt;= Streams.&#39;readExactly&#39; 6</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- *** Exception: Short read, expected 6 bytes</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_516_1_516_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_516_1_516_12&#39;)"><span class="mpre">readExactly</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">                     </span><span class="hl_comment"><span class="mpre">-- ^ number of bytes to read</span></span><span class="mpre">
            -&gt; </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^ input stream</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_516_1_516_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_516_1_516_12&#39;)"><span class="hl_fundecl"><span class="mpre">readExactly</span></span></a><span class="mpre"> </span><a name="loc_516_13_516_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_516_13_516_14&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> </span><a name="loc_516_15_516_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_516_15_516_20&#39;)"><span class="hl_vardecl"><span class="mpre">input</span></span></a><span class="mpre"> = </span><a href="#loc_518_5_518_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_518_5_518_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre"> </span><a href="#loc_516_13_516_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_516_13_516_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
  where
    </span><a name="loc_518_5_518_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_518_5_518_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> !</span><a name="loc_518_9_518_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_518_9_518_11&#39;)"><span class="hl_vardecl"><span class="mpre">dl</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.concat</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_518_9_518_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_518_9_518_11&#39;)"><span class="hl_varref"><span class="mpre">dl</span></span></a><span class="mpre"> []
    </span><a href="#loc_518_5_518_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_518_5_518_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> !</span><a name="loc_519_9_519_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_519_9_519_11&#39;)"><span class="hl_vardecl"><span class="mpre">dl</span></span></a><span class="mpre"> </span><a name="loc_519_12_519_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_519_12_519_13&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre">  =
        </span><a href="System.IO.Streams.Internal.html#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_516_15_516_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_516_15_516_20&#39;)"><span class="hl_varref"><span class="mpre">input</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre">
        </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_425_30_425_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_425_30_425_51&#39;)"><span class="hl_conref"><span class="mpre">ReadTooShortException</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_516_13_516_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_516_13_516_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">))
              (\</span><a name="loc_522_17_522_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_522_17_522_18&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; do
                 let </span><a name="loc_523_22_523_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_523_22_523_23&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_522_17_522_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_522_17_522_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
                 if </span><a href="#loc_523_22_523_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_523_22_523_23&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="#loc_519_12_519_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_519_12_519_13&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">
                   then do
                     let (</span><a name="loc_526_27_526_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_526_27_526_28&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">,</span><a name="loc_526_29_526_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_526_29_526_30&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">S.splitAt</span></span><span class="mpre"> </span><a href="#loc_519_12_519_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_519_12_519_13&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_522_17_522_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_522_17_522_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
                     </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_526_29_526_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_526_29_526_30&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="System.IO.Streams.Internal.html#loc_178_1_178_7" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_178_1_178_7&#39;)"><span class="hl_varref"><span class="mpre">unRead</span></span></a><span class="mpre"> </span><a href="#loc_526_29_526_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_526_29_526_30&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><a href="#loc_516_15_516_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_516_15_516_20&#39;)"><span class="hl_varref"><span class="mpre">input</span></span></a><span class="mpre">
                     </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.concat</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_519_9_519_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_519_9_519_11&#39;)"><span class="hl_varref"><span class="mpre">dl</span></span></a><span class="mpre"> [</span><a href="#loc_526_27_526_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_526_27_526_28&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">]
                   else </span><a href="#loc_518_5_518_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_518_5_518_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><a href="#loc_519_9_519_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_519_9_519_11&#39;)"><span class="hl_varref"><span class="mpre">dl</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (</span><a href="#loc_522_17_522_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_522_17_522_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">)) (</span><a href="#loc_519_12_519_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_519_12_519_13&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_523_22_523_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_523_22_523_23&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">))


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Takes from a stream until the given predicate is no longer satisfied.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Returns Nothing on end-of-stream, or @Just \&quot;\&quot;@ if the predicate is never</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- satisfied. See &#39;Prelude.takeWhile&#39; and &#39;Data.ByteString.Char8.takeWhile&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;Hello, world!\&quot;] &gt;&gt;= Streams.&#39;takeBytesWhile&#39; (/= &#39;,&#39;)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just \&quot;Hello\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; import Data.Char</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;7 Samurai\&quot;] &gt;&gt;= Streams.&#39;takeBytesWhile&#39; isAlpha</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just \&quot;\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.fromList&#39; [] &gt;&gt;= Streams.&#39;takeBytesWhile&#39; isAlpha</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Nothing</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_551_1_551_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_1_551_15&#39;)"><span class="mpre">takeBytesWhile</span></a><span class="mpre"> :: (</span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">)          </span><span class="hl_comment"><span class="mpre">-- ^ predicate</span></span><span class="mpre">
               -&gt; </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^ input stream</span></span><span class="mpre">
               -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_551_1_551_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_1_551_15&#39;)"><span class="hl_fundecl"><span class="mpre">takeBytesWhile</span></span></a><span class="mpre"> </span><a name="loc_551_16_551_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_16_551_17&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_551_18_551_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_18_551_23&#39;)"><span class="hl_vardecl"><span class="mpre">input</span></span></a><span class="mpre"> = </span><a href="System.IO.Streams.Internal.html#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_551_18_551_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_18_551_23&#39;)"><span class="hl_varref"><span class="mpre">input</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">) (</span><a href="#loc_553_5_553_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_553_5_553_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">)
  where
    </span><a name="loc_553_5_553_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_553_5_553_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_553_8_553_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_553_8_553_10&#39;)"><span class="hl_vardecl"><span class="mpre">dl</span></span></a><span class="mpre"> !</span><a name="loc_553_12_553_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_553_12_553_13&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> | </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_556_13_556_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_556_13_556_14&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">  = </span><a href="System.IO.Streams.Internal.html#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_551_18_551_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_18_551_23&#39;)"><span class="hl_varref"><span class="mpre">input</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> </span><a href="#loc_558_9_558_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_558_9_558_15&#39;)"><span class="hl_varref"><span class="mpre">finish</span></span></a><span class="mpre"> (</span><a href="#loc_553_5_553_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_553_5_553_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_557_9_557_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_557_9_557_12&#39;)"><span class="hl_varref"><span class="mpre">dl&#39;</span></span></a><span class="mpre">)
             | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="System.IO.Streams.Internal.html#loc_178_1_178_7" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_178_1_178_7&#39;)"><span class="hl_varref"><span class="mpre">unRead</span></span></a><span class="mpre"> </span><a href="#loc_556_13_556_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_556_13_556_14&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><a href="#loc_551_18_551_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_18_551_23&#39;)"><span class="hl_varref"><span class="mpre">input</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_558_9_558_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_558_9_558_15&#39;)"><span class="hl_varref"><span class="mpre">finish</span></span></a><span class="mpre">
      where
        (</span><a name="loc_556_10_556_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_556_10_556_11&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">, </span><a name="loc_556_13_556_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_556_13_556_14&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">S.span</span></span><span class="mpre"> </span><a href="#loc_551_16_551_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_16_551_17&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_553_12_553_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_553_12_553_13&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
        </span><a name="loc_557_9_557_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_557_9_557_12&#39;)"><span class="hl_vardecl"><span class="mpre">dl&#39;</span></span></a><span class="mpre">    = </span><a href="#loc_553_8_553_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_553_8_553_10&#39;)"><span class="hl_varref"><span class="mpre">dl</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (</span><a href="#loc_556_10_556_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_556_10_556_11&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">)
        </span><a name="loc_558_9_558_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_558_9_558_15&#39;)"><span class="hl_vardecl"><span class="mpre">finish</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.concat</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_553_8_553_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_553_8_553_10&#39;)"><span class="hl_varref"><span class="mpre">dl</span></span></a><span class="mpre"> [</span><a href="#loc_556_10_556_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_556_10_556_11&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">]


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Wraps an &#39;OutputStream&#39;, producing a new stream that will pass along at</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- most @n@ bytes to the wrapped stream, throwing any subsequent input away.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; (os :: OutputStream ByteString, getList) &lt;- Streams.&#39;System.IO.Streams.listOutputStream&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; os&#39; &lt;- Streams.&#39;giveBytes&#39; 6 os</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;long \&quot;, \&quot;string\&quot;] &gt;&gt;= Streams.&#39;System.IO.Streams.connectTo&#39; os&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; getList</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [\&quot;long \&quot;,\&quot;s\&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_578_1_578_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_578_1_578_10&#39;)"><span class="mpre">giveBytes</span></a><span class="mpre"> :: </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre">                        </span><span class="hl_comment"><span class="mpre">-- ^ maximum number of bytes to send</span></span><span class="mpre">
                                          </span><span class="hl_comment"><span class="mpre">-- to the wrapped stream</span></span><span class="mpre">
          -&gt; </span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">      </span><span class="hl_comment"><span class="mpre">-- ^ output stream to wrap</span></span><span class="mpre">
          -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_578_1_578_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_578_1_578_10&#39;)"><span class="hl_fundecl"><span class="mpre">giveBytes</span></span></a><span class="mpre"> </span><a name="loc_578_11_578_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_578_11_578_13&#39;)"><span class="hl_vardecl"><span class="mpre">k0</span></span></a><span class="mpre"> </span><a name="loc_578_14_578_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_578_14_578_17&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> = do
    </span><a name="loc_579_5_579_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_579_5_579_9&#39;)"><span class="hl_vardecl"><span class="mpre">kref</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_578_11_578_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_578_11_578_13&#39;)"><span class="hl_varref"><span class="mpre">k0</span></span></a><span class="mpre">
    </span><a href="System.IO.Streams.Internal.html#loc_273_1_273_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_273_1_273_17&#39;)"><span class="hl_varref"><span class="mpre">makeOutputStream</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_582_5_582_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_5_582_9&#39;)"><span class="hl_varref"><span class="mpre">sink</span></span></a><span class="mpre"> </span><a href="#loc_579_5_579_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_579_5_579_9&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre">
  where
    </span><a name="loc_582_5_582_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_5_582_9&#39;)"><span class="hl_fundecl"><span class="mpre">sink</span></span></a><span class="mpre"> _ </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">        = </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="#loc_578_14_578_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_578_14_578_17&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
    </span><a href="#loc_582_5_582_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_5_582_9&#39;)"><span class="hl_fundecl"><span class="mpre">sink</span></span></a><span class="mpre"> </span><a name="loc_583_10_583_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_583_10_583_14&#39;)"><span class="hl_vardecl"><span class="mpre">kref</span></span></a><span class="mpre"> </span><a name="loc_583_15_583_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_583_15_583_17&#39;)"><span class="hl_specname"><span class="mpre">mb</span></span></a><span class="mpre">@(</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_583_24_583_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_583_24_583_25&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">) = do
        </span><a name="loc_584_9_584_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_584_9_584_10&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_583_10_583_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_583_10_583_14&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre">
        let </span><a name="loc_585_13_585_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_585_13_585_14&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_583_24_583_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_583_24_583_25&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
        let </span><a name="loc_586_13_586_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_586_13_586_15&#39;)"><span class="hl_vardecl"><span class="mpre">k&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_584_9_584_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_584_9_584_10&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_585_13_585_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_585_13_585_14&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
        if </span><a href="#loc_586_13_586_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_586_13_586_15&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
          then do let </span><a name="loc_588_23_588_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_23_588_24&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.take</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_584_9_584_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_584_9_584_10&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">) </span><a href="#loc_583_24_583_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_583_24_583_25&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
                  </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_588_23_588_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_23_588_24&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_588_23_588_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_23_588_24&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">) </span><a href="#loc_578_14_578_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_578_14_578_17&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
                  </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_583_10_583_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_583_10_583_14&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
          else </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_583_10_583_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_583_10_583_14&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre"> </span><a href="#loc_586_13_586_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_586_13_586_15&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_583_15_583_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_583_15_583_17&#39;)"><span class="hl_varref"><span class="mpre">mb</span></span></a><span class="mpre"> </span><a href="#loc_578_14_578_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_578_14_578_17&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Wraps an &#39;OutputStream&#39;, producing a new stream that will pass along</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exactly @n@ bytes to the wrapped stream. If the stream is sent more or fewer</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- than the given number of bytes, the resulting stream will throw an exception</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (either &#39;TooFewBytesWrittenException&#39; or &#39;TooManyBytesWrittenException&#39;)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- during a call to &#39;write&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; is &lt;- Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;ok\&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.outputToList&#39; (Streams.&#39;giveExactly&#39; 2 &gt;=&gt; Streams.&#39;System.IO.Streams.connect&#39; is)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [\&quot;ok\&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; is &lt;- Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;ok\&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.outputToList&#39; (Streams.&#39;giveExactly&#39; 1 &gt;=&gt; Streams.&#39;System.IO.Streams.connect&#39; is)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- *** Exception: Too many bytes written</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; is &lt;- Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;ok\&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.outputToList&#39; (Streams.&#39;giveExactly&#39; 3 &gt;=&gt; Streams.&#39;System.IO.Streams.connect&#39; is)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- *** Exception: Too few bytes written</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_617_1_617_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_617_1_617_12&#39;)"><span class="mpre">giveExactly</span></a><span class="mpre"> :: </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre">
            -&gt; </span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_617_1_617_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_617_1_617_12&#39;)"><span class="hl_fundecl"><span class="mpre">giveExactly</span></span></a><span class="mpre"> </span><a name="loc_617_13_617_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_617_13_617_15&#39;)"><span class="hl_vardecl"><span class="mpre">k0</span></span></a><span class="mpre"> </span><a name="loc_617_16_617_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_617_16_617_18&#39;)"><span class="hl_vardecl"><span class="mpre">os</span></span></a><span class="mpre"> = do
    </span><a name="loc_618_5_618_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_5_618_8&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_617_13_617_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_617_13_617_15&#39;)"><span class="hl_varref"><span class="mpre">k0</span></span></a><span class="mpre">
    </span><a href="System.IO.Streams.Internal.html#loc_273_1_273_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_273_1_273_17&#39;)"><span class="hl_varref"><span class="mpre">makeOutputStream</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_621_5_621_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_621_5_621_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_618_5_618_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_5_618_8&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">
  where
    </span><a name="loc_621_5_621_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_621_5_621_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_621_8_621_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_621_8_621_11&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> </span><a name="loc_621_12_621_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_621_12_621_17&#39;)"><span class="hl_vardecl"><span class="mpre">chunk</span></span></a><span class="mpre"> = do
        !</span><a name="loc_622_10_622_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_622_10_622_11&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_621_8_621_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_621_8_621_11&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">
        case </span><a href="#loc_621_12_621_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_621_12_621_17&#39;)"><span class="hl_varref"><span class="mpre">chunk</span></span></a><span class="mpre"> of
          </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; if </span><a href="#loc_622_10_622_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_622_10_622_11&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
                       then </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="#loc_402_36_402_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_402_36_402_63&#39;)"><span class="hl_conref"><span class="mpre">TooFewBytesWrittenException</span></span></a><span class="mpre">
                       else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
          </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_627_16_627_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_16_627_17&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">  -&gt; let </span><a name="loc_627_26_627_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_26_627_28&#39;)"><span class="hl_vardecl"><span class="mpre">n&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_622_10_622_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_622_10_622_11&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_627_16_627_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_16_627_17&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)
                     in if </span><a href="#loc_627_26_627_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_26_627_28&#39;)"><span class="hl_varref"><span class="mpre">n&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
                          then </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="#loc_414_5_414_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_414_5_414_33&#39;)"><span class="hl_conref"><span class="mpre">TooManyBytesWrittenException</span></span></a><span class="mpre">
                          else do </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_621_8_621_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_621_8_621_11&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><a href="#loc_627_26_627_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_26_627_28&#39;)"><span class="hl_varref"><span class="mpre">n&#39;</span></span></a><span class="mpre">
        </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_621_12_621_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_621_12_621_17&#39;)"><span class="hl_varref"><span class="mpre">chunk</span></span></a><span class="mpre"> </span><a href="#loc_617_16_617_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_617_16_617_18&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Wraps an &#39;OutputStream&#39;, producing a new stream that will pass along at</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- most @n@ bytes to the wrapped stream. If more than @n@ bytes are sent to the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- outer stream, a &#39;TooManyBytesWrittenException&#39; will be thrown.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /Note/: if more than @n@ bytes are sent to the outer stream,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;throwIfConsumesMoreThan&#39; will not necessarily send the first @n@ bytes</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- through to the wrapped stream before throwing the exception.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; (os :: OutputStream ByteString, getList) &lt;- Streams.&#39;System.IO.Streams.listOutputStream&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; os&#39; &lt;- Streams.&#39;throwIfConsumesMoreThan&#39; 5 os</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;short\&quot;] &gt;&gt;= Streams.&#39;System.IO.Streams.connectTo&#39; os&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; getList</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [\&quot;short\&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; os&#39;&#39; &lt;- Streams.&#39;throwIfConsumesMoreThan&#39; 5 os</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.fromList&#39; [\&quot;long\&quot;, \&quot;string\&quot;] &gt;&gt;= Streams.&#39;System.IO.Streams.connectTo&#39; os&#39;&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- *** Exception: Too many bytes written</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_660_1_660_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_660_1_660_24&#39;)"><span class="mpre">throwIfConsumesMoreThan</span></a><span class="mpre">
    :: </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre">                    </span><span class="hl_comment"><span class="mpre">-- ^ maximum number of bytes to send to the</span></span><span class="mpre">
                                </span><span class="hl_comment"><span class="mpre">--   wrapped stream</span></span><span class="mpre">
    -&gt; </span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^ output stream to wrap</span></span><span class="mpre">
    -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_660_1_660_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_660_1_660_24&#39;)"><span class="hl_fundecl"><span class="mpre">throwIfConsumesMoreThan</span></span></a><span class="mpre"> </span><a name="loc_660_25_660_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_660_25_660_27&#39;)"><span class="hl_vardecl"><span class="mpre">k0</span></span></a><span class="mpre"> </span><a name="loc_660_28_660_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_660_28_660_31&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> = do
    </span><a name="loc_661_5_661_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_5_661_9&#39;)"><span class="hl_vardecl"><span class="mpre">kref</span></span></a><span class="mpre">   &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_660_25_660_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_660_25_660_27&#39;)"><span class="hl_varref"><span class="mpre">k0</span></span></a><span class="mpre">
    </span><a href="System.IO.Streams.Internal.html#loc_273_1_273_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_273_1_273_17&#39;)"><span class="hl_varref"><span class="mpre">makeOutputStream</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_664_5_664_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_664_5_664_9&#39;)"><span class="hl_varref"><span class="mpre">sink</span></span></a><span class="mpre"> </span><a href="#loc_661_5_661_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_5_661_9&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre">
  where
    </span><a name="loc_664_5_664_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_664_5_664_9&#39;)"><span class="hl_fundecl"><span class="mpre">sink</span></span></a><span class="mpre"> _ </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">        = </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="#loc_660_28_660_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_660_28_660_31&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">

    </span><a href="#loc_664_5_664_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_664_5_664_9&#39;)"><span class="hl_fundecl"><span class="mpre">sink</span></span></a><span class="mpre"> </span><a name="loc_666_10_666_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_10_666_14&#39;)"><span class="hl_vardecl"><span class="mpre">kref</span></span></a><span class="mpre"> </span><a name="loc_666_15_666_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_15_666_17&#39;)"><span class="hl_specname"><span class="mpre">mb</span></span></a><span class="mpre">@(</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_666_24_666_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_24_666_25&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">) = do
        </span><a name="loc_667_9_667_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_667_9_667_10&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_666_10_666_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_10_666_14&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre">
        let </span><a name="loc_668_13_668_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_668_13_668_14&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">toEnum</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_666_24_666_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_24_666_25&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
        let </span><a name="loc_669_13_669_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_669_13_669_15&#39;)"><span class="hl_vardecl"><span class="mpre">k&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_667_9_667_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_667_9_667_10&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_668_13_668_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_668_13_668_14&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
        if </span><a href="#loc_669_13_669_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_669_13_669_15&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
          then </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="#loc_414_5_414_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_414_5_414_33&#39;)"><span class="hl_conref"><span class="mpre">TooManyBytesWrittenException</span></span></a><span class="mpre">
          else </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_666_10_666_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_10_666_14&#39;)"><span class="hl_varref"><span class="mpre">kref</span></span></a><span class="mpre"> </span><a href="#loc_669_13_669_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_669_13_669_15&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_666_15_666_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_15_666_17&#39;)"><span class="hl_varref"><span class="mpre">mb</span></span></a><span class="mpre"> </span><a href="#loc_660_28_660_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_660_28_660_31&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Gets the current posix time</span></span><span class="mpre">
</span><a href="#loc_678_1_678_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_678_1_678_8&#39;)"><span class="mpre">getTime</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Double</span></span><span class="mpre">
</span><a name="loc_678_1_678_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_678_1_678_8&#39;)"><span class="hl_vardecl"><span class="mpre">getTime</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">realToFrac</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><a href="Data.Time.Clock.POSIX.html#loc_51_1_51_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Time.Clock.POSIX.html#loc_51_1_51_13&#39;)"><span class="hl_varref"><span class="mpre">getPOSIXTime</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Thrown by &#39;throwIfTooSlow&#39; if input is not being produced fast enough by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the given &#39;InputStream&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
data </span><a name="loc_685_6_685_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_685_6_685_26&#39;)"><span class="hl_tycondecl"><span class="mpre">RateTooSlowException</span></span></a><span class="mpre"> = </span><a name="loc_685_29_685_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_685_29_685_49&#39;)"><span class="hl_condecl"><span class="mpre">RateTooSlowException</span></span></a><span class="mpre"> </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/ByteString.hs&quot;, srcSpanStartLine = 685, srcSpanStartColumn = 50, srcSpanEndLine = 685, srcSpanEndColumn = 69}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/ByteString.hs&quot;, srcSpanStartLine = 685, srcSpanStartColumn = 50, srcSpanEndLine = 685, srcSpanEndColumn = 58},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-"><span class="mpre">deriving (Typeable)</span></span><span class="mpre">
instance </span><span class="hl_classref"><span class="mpre">Show</span></span><span class="mpre"> </span><a href="#loc_685_6_685_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_685_6_685_26&#39;)"><span class="hl_tyconref"><span class="mpre">RateTooSlowException</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_685_29_685_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_685_29_685_49&#39;)"><span class="hl_conref"><span class="mpre">RateTooSlowException</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;Input rate too slow&quot;</span></span><span class="mpre">
instance </span><span class="hl_classref"><span class="mpre">Exception</span></span><span class="mpre"> </span><a href="#loc_685_6_685_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_685_6_685_26&#39;)"><span class="hl_tyconref"><span class="mpre">RateTooSlowException</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Rate-limits an input stream. If the input stream is not read from faster</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- than the given rate, reading from the wrapped stream will throw a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;RateTooSlowException&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Strings pushed back to the returned &#39;InputStream&#39; will be propagated up to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the original stream.</span></span><span class="mpre">
</span><a href="#loc_705_1_705_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_705_1_705_15&#39;)"><span class="mpre">throwIfTooSlow</span></a><span class="mpre">
    :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">                   </span><span class="hl_comment"><span class="mpre">-- ^ action to bump timeout</span></span><span class="mpre">
    -&gt; </span><span class="hl_tyconref"><span class="mpre">Double</span></span><span class="mpre">                  </span><span class="hl_comment"><span class="mpre">-- ^ minimum data rate, in bytes per second</span></span><span class="mpre">
    -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">                     </span><span class="hl_comment"><span class="mpre">-- ^ amount of time in seconds to wait before</span></span><span class="mpre">
                               </span><span class="hl_comment"><span class="mpre">--   data rate calculation takes effect</span></span><span class="mpre">
    -&gt; </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^ input stream</span></span><span class="mpre">
    -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_705_1_705_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_705_1_705_15&#39;)"><span class="hl_fundecl"><span class="mpre">throwIfTooSlow</span></span></a><span class="mpre"> !</span><a name="loc_705_17_705_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_705_17_705_21&#39;)"><span class="hl_vardecl"><span class="mpre">bump</span></span></a><span class="mpre"> !</span><a name="loc_705_23_705_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_705_23_705_30&#39;)"><span class="hl_vardecl"><span class="mpre">minRate</span></span></a><span class="mpre"> !</span><a name="loc_705_32_705_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_705_32_705_43&#39;)"><span class="hl_vardecl"><span class="mpre">minSeconds&#39;</span></span></a><span class="mpre"> !</span><a name="loc_705_45_705_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_705_45_705_51&#39;)"><span class="hl_vardecl"><span class="mpre">stream</span></span></a><span class="mpre"> = do
    !_        &lt;- </span><a href="#loc_705_17_705_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_705_17_705_21&#39;)"><span class="hl_varref"><span class="mpre">bump</span></span></a><span class="mpre">
    </span><a name="loc_707_5_707_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_707_5_707_14&#39;)"><span class="hl_vardecl"><span class="mpre">startTime</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_678_1_678_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_678_1_678_8&#39;)"><span class="hl_varref"><span class="mpre">getTime</span></span></a><span class="mpre">
    </span><a name="loc_708_5_708_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_708_5_708_14&#39;)"><span class="hl_vardecl"><span class="mpre">bytesRead</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> (</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> :: </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">InputStream</span></span><span class="mpre"> (</span><a href="#loc_712_5_712_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_712_5_712_9&#39;)"><span class="hl_varref"><span class="mpre">prod</span></span></a><span class="mpre"> </span><a href="#loc_707_5_707_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_707_5_707_14&#39;)"><span class="hl_varref"><span class="mpre">startTime</span></span></a><span class="mpre"> </span><a href="#loc_708_5_708_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_708_5_708_14&#39;)"><span class="hl_varref"><span class="mpre">bytesRead</span></span></a><span class="mpre">) (</span><a href="#loc_729_5_729_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_729_5_729_7&#39;)"><span class="hl_varref"><span class="mpre">pb</span></span></a><span class="mpre"> </span><a href="#loc_708_5_708_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_708_5_708_14&#39;)"><span class="hl_varref"><span class="mpre">bytesRead</span></span></a><span class="mpre">)

  where
    </span><a name="loc_712_5_712_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_712_5_712_9&#39;)"><span class="hl_fundecl"><span class="mpre">prod</span></span></a><span class="mpre"> </span><a name="loc_712_10_712_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_712_10_712_19&#39;)"><span class="hl_vardecl"><span class="mpre">startTime</span></span></a><span class="mpre"> </span><a name="loc_712_20_712_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_712_20_712_32&#39;)"><span class="hl_vardecl"><span class="mpre">bytesReadRef</span></span></a><span class="mpre"> = </span><a href="System.IO.Streams.Internal.html#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_705_45_705_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_705_45_705_51&#39;)"><span class="hl_varref"><span class="mpre">stream</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">) </span><a href="#loc_714_9_714_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_714_9_714_14&#39;)"><span class="hl_varref"><span class="mpre">chunk</span></span></a><span class="mpre">
      where
        </span><a name="loc_714_9_714_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_714_9_714_14&#39;)"><span class="hl_fundecl"><span class="mpre">chunk</span></span></a><span class="mpre"> </span><a name="loc_714_15_714_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_714_15_714_16&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = do
            let </span><a name="loc_715_17_715_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_715_17_715_21&#39;)"><span class="hl_vardecl"><span class="mpre">slen</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_714_15_714_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_714_15_714_16&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
            </span><a name="loc_716_13_716_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_716_13_716_16&#39;)"><span class="hl_vardecl"><span class="mpre">now</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_678_1_678_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_678_1_678_8&#39;)"><span class="hl_varref"><span class="mpre">getTime</span></span></a><span class="mpre">
            let !</span><a name="loc_717_18_717_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_717_18_717_23&#39;)"><span class="hl_vardecl"><span class="mpre">delta</span></span></a><span class="mpre"> = </span><a href="#loc_716_13_716_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_716_13_716_16&#39;)"><span class="hl_varref"><span class="mpre">now</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_712_10_712_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_712_10_712_19&#39;)"><span class="hl_varref"><span class="mpre">startTime</span></span></a><span class="mpre">
            </span><a name="loc_718_13_718_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_718_13_718_15&#39;)"><span class="hl_vardecl"><span class="mpre">nb</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_712_20_712_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_712_20_712_32&#39;)"><span class="hl_varref"><span class="mpre">bytesReadRef</span></span></a><span class="mpre">
            let </span><a name="loc_719_17_719_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_719_17_719_25&#39;)"><span class="hl_vardecl"><span class="mpre">newBytes</span></span></a><span class="mpre"> = </span><a href="#loc_718_13_718_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_718_13_718_15&#39;)"><span class="hl_varref"><span class="mpre">nb</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_715_17_715_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_715_17_715_21&#39;)"><span class="hl_varref"><span class="mpre">slen</span></span></a><span class="mpre">
            </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_717_18_717_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_717_18_717_23&#39;)"><span class="hl_varref"><span class="mpre">delta</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><a href="#loc_733_5_733_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_733_5_733_15&#39;)"><span class="hl_varref"><span class="mpre">minSeconds</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre">
                  (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_719_17_719_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_719_17_719_25&#39;)"><span class="hl_varref"><span class="mpre">newBytes</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/</span></span><span class="mpre">
                    (</span><a href="#loc_717_18_717_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_717_18_717_23&#39;)"><span class="hl_varref"><span class="mpre">delta</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_733_5_733_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_733_5_733_15&#39;)"><span class="hl_varref"><span class="mpre">minSeconds</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_705_23_705_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_705_23_705_30&#39;)"><span class="hl_varref"><span class="mpre">minRate</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
                </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="#loc_685_29_685_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_685_29_685_49&#39;)"><span class="hl_conref"><span class="mpre">RateTooSlowException</span></span></a><span class="mpre">
            </span><span class="hl_comment"><span class="mpre">-- otherwise, bump the timeout and return the input</span></span><span class="mpre">
            !_ &lt;- </span><a href="#loc_705_17_705_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_705_17_705_21&#39;)"><span class="hl_varref"><span class="mpre">bump</span></span></a><span class="mpre">
            </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_712_20_712_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_712_20_712_32&#39;)"><span class="hl_varref"><span class="mpre">bytesReadRef</span></span></a><span class="mpre"> </span><a href="#loc_719_17_719_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_719_17_719_25&#39;)"><span class="hl_varref"><span class="mpre">newBytes</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_714_15_714_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_714_15_714_16&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">

    </span><a name="loc_729_5_729_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_729_5_729_7&#39;)"><span class="hl_fundecl"><span class="mpre">pb</span></span></a><span class="mpre"> </span><a name="loc_729_8_729_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_729_8_729_20&#39;)"><span class="hl_vardecl"><span class="mpre">bytesReadRef</span></span></a><span class="mpre"> </span><a name="loc_729_21_729_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_729_21_729_22&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = do
        </span><a href="#loc_75_1_75_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_10&#39;)"><span class="hl_varref"><span class="mpre">modifyRef</span></span></a><span class="mpre"> </span><a href="#loc_729_8_729_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_729_8_729_20&#39;)"><span class="hl_varref"><span class="mpre">bytesReadRef</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_730_35_730_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_730_35_730_36&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_730_35_730_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_730_35_730_36&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_729_21_729_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_729_21_729_22&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)
        </span><a href="System.IO.Streams.Internal.html#loc_178_1_178_7" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_178_1_178_7&#39;)"><span class="hl_varref"><span class="mpre">unRead</span></span></a><span class="mpre"> </span><a href="#loc_729_21_729_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_729_21_729_22&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_705_45_705_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_705_45_705_51&#39;)"><span class="hl_varref"><span class="mpre">stream</span></span></a><span class="mpre">

    </span><a name="loc_733_5_733_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_733_5_733_15&#39;)"><span class="hl_vardecl"><span class="mpre">minSeconds</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_705_32_705_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_705_32_705_43&#39;)"><span class="hl_varref"><span class="mpre">minSeconds&#39;</span></span></a><span class="mpre">
</span></div></body></html>