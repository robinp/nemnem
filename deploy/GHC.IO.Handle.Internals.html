<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Trustworthy #-}
{-# LANGUAGE NoImplicitPrelude
           , RecordWildCards
           , BangPatterns
           , NondecreasingIndentation
           , RankNTypes
  #-}
{-# OPTIONS_GHC -fno-warn-unused-matches #-}
{-# OPTIONS_GHC -fno-warn-name-shadowing #-}
{-# OPTIONS_HADDOCK hide #-}

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  GHC.IO.Handle.Internals</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow, 1994-2001</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  see libraries/base/LICENSE</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  libraries@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  internal</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This module defines the basic operations on I\/O \&quot;handles\&quot;.  All</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- of the operations defined here are independent of the underlying</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- device.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module GHC.IO.Handle.Internals (
  withHandle, withHandle&#39;, withHandle_,
  withHandle__&#39;, withHandle_&#39;, withAllHandles__,
  wantWritableHandle, wantReadableHandle, wantReadableHandle_, 
  wantSeekableHandle,

  mkHandle, mkFileHandle, mkDuplexHandle,
  openTextEncoding, closeTextCodecs, initBufferState,
  dEFAULT_CHAR_BUFFER_SIZE,

  flushBuffer, flushWriteBuffer, flushCharReadBuffer,
  flushCharBuffer, flushByteReadBuffer, flushByteWriteBuffer,

  readTextDevice, writeCharBuffer, readTextDeviceNonBlocking,
  decodeByteBuf,

  augmentIOError,
  ioe_closedHandle, ioe_EOF, ioe_notReadable, ioe_notWritable,
  ioe_finalizedHandle, ioe_bufsiz,

  hClose_help, hLookAhead_,

  HandleFinalizer, handleFinalizer,

  debugIO,
 ) where

import GHC.IO
import GHC.IO.IOMode
import GHC.IO.Encoding as Encoding
import GHC.IO.Encoding.Types (CodeBuffer)
import GHC.IO.Handle.Types
import GHC.IO.Buffer
import GHC.IO.BufferedIO (</span><a href="GHC.IO.BufferedIO.html#loc_39_7_39_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_39_7_39_17&#39;)"><span class="mpre">BufferedIO</span></a><span class="mpre">)
import GHC.IO.Exception
import GHC.IO.Device (</span><a href="GHC.IO.Device.html#loc_61_7_61_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_61_7_61_15&#39;)"><span class="mpre">IODevice</span></a><span class="mpre">, </span><a href="GHC.IO.Device.html#loc_164_6_164_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_164_6_164_14&#39;)"><span class="mpre">SeekMode</span></a><span class="mpre">(..))
import qualified GHC.IO.Device as IODevice
import qualified GHC.IO.BufferedIO as Buffered

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 67, srcSpanStartColumn = 8, srcSpanEndLine = 67, srcSpanEndColumn = 21}, srcInfoPoints = []}) &quot;GHC.Conc.Sync&quot;"><span class="mpre">GHC.Conc.Sync</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 68, srcSpanStartColumn = 8, srcSpanEndLine = 68, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Real&quot;"><span class="mpre">GHC.Real</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 69, srcSpanStartColumn = 8, srcSpanEndLine = 69, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 70, srcSpanStartColumn = 8, srcSpanEndLine = 70, srcSpanEndColumn = 21}, srcInfoPoints = []}) &quot;GHC.Exception&quot;"><span class="mpre">GHC.Exception</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 71, srcSpanStartColumn = 8, srcSpanEndLine = 71, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;GHC.Num&quot;"><span class="mpre">GHC.Num</span></span><span class="mpre">          ( Num(..) )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 72, srcSpanStartColumn = 8, srcSpanEndLine = 72, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Show&quot;"><span class="mpre">GHC.Show</span></span><span class="mpre">
import GHC.IORef
import GHC.MVar
import Data.Typeable
import Control.Monad
import Data.Maybe
import Foreign.Safe
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 79, srcSpanStartColumn = 8, srcSpanEndLine = 79, srcSpanEndColumn = 30}, srcInfoPoints = []}) &quot;System.Posix.Internals&quot;"><span class="mpre">System.Posix.Internals</span></span><span class="mpre"> hiding (FD)

import Foreign.C

</span><a href="#loc_84_1_84_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_13&#39;)"><span class="mpre">c_DEBUG_DUMP</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_84_1_84_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_13&#39;)"><span class="hl_vardecl"><span class="mpre">c_DEBUG_DUMP</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Creating a new handle</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 89, srcSpanStartColumn = 1, srcSpanEndLine = 89, srcSpanEndColumn = 58}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 89, srcSpanStartColumn = 1, srcSpanEndLine = 89, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpa"><span class="mpre">type HandleFinalizer = FilePath -&gt; MVar Handle__ -&gt; IO ()</span></span><span class="mpre">

</span><a href="#loc_92_1_92_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_14&#39;)"><span class="mpre">newFileHandle</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HandleFinalizer</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre">
</span><a name="loc_92_1_92_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_14&#39;)"><span class="hl_fundecl"><span class="mpre">newFileHandle</span></span></a><span class="mpre"> </span><a name="loc_92_15_92_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_15_92_23&#39;)"><span class="hl_vardecl"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a name="loc_92_24_92_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_24_92_36&#39;)"><span class="hl_vardecl"><span class="mpre">mb_finalizer</span></span></a><span class="mpre"> </span><a name="loc_92_37_92_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_37_92_39&#39;)"><span class="hl_vardecl"><span class="mpre">hc</span></span></a><span class="mpre"> = do
  </span><a name="loc_93_3_93_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_3_93_4&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="hl_varref"><span class="mpre">newMVar</span></span></a><span class="mpre"> </span><a href="#loc_92_37_92_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_37_92_39&#39;)"><span class="hl_varref"><span class="mpre">hc</span></span></a><span class="mpre">
  case </span><a href="#loc_92_24_92_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_24_92_36&#39;)"><span class="hl_varref"><span class="mpre">mb_finalizer</span></span></a><span class="mpre"> of
    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_95_10_95_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_10_95_19&#39;)"><span class="hl_vardecl"><span class="mpre">finalizer</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.MVar.html#loc_181_1_181_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_181_1_181_17&#39;)"><span class="hl_varref"><span class="mpre">addMVarFinalizer</span></span></a><span class="mpre"> </span><a href="#loc_93_3_93_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_3_93_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> (</span><a href="#loc_95_10_95_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_10_95_19&#39;)"><span class="hl_varref"><span class="mpre">finalizer</span></span></a><span class="mpre"> </span><a href="#loc_92_15_92_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_15_92_23&#39;)"><span class="hl_varref"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a href="#loc_93_3_93_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_3_93_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">)
    </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">        -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="GHC.IO.Handle.Types.html#loc_101_5_101_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_101_5_101_15&#39;)"><span class="hl_conref"><span class="mpre">FileHandle</span></span></a><span class="mpre"> </span><a href="#loc_92_15_92_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_15_92_23&#39;)"><span class="hl_varref"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a href="#loc_93_3_93_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_3_93_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Working with Handles</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-
In the concurrent world, handles are locked during use.  This is done
by wrapping an MVar around the handle which acts as a mutex over
operations on the handle.

To avoid races, we use the following bracketing operations.  The idea
is to obtain the lock, do some operation and replace the lock again,
whether the operation succeeded or failed.  We also want to handle the
case where the thread receives an exception while processing the IO
operation: in these cases we also want to relinquish the lock.

There are three versions of @withHandle@: corresponding to the three
possible combinations of:

        - the operation may side-effect the handle
        - the operation may return a result

If the operation generates an error or an exception is raised, the
original handle is always replaced.
-}</span></span><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_125_1_125_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_1_125_11&#39;)"><span class="mpre">withHandle</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_125_1_125_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_1_125_11&#39;)"><span class="mpre">withHandle</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre">,</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_125_1_125_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_1_125_11&#39;)"><span class="hl_fundecl"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a name="loc_125_12_125_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_12_125_15&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_125_16_125_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_16_125_17&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><a href="GHC.IO.Handle.Types.html#loc_101_5_101_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_101_5_101_15&#39;)"><span class="hl_conref"><span class="mpre">FileHandle</span></span></a><span class="mpre"> _ </span><a name="loc_125_32_125_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_32_125_33&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">)     </span><a name="loc_125_39_125_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_39_125_42&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> = </span><a href="#loc_130_1_130_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_12&#39;)"><span class="hl_varref"><span class="mpre">withHandle&#39;</span></span></a><span class="mpre"> </span><a href="#loc_125_12_125_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_12_125_15&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_125_16_125_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_16_125_17&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_125_32_125_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_32_125_33&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_125_39_125_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_39_125_42&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre">
</span><a href="#loc_125_1_125_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_1_125_11&#39;)"><span class="hl_fundecl"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a name="loc_126_12_126_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_12_126_15&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_126_16_126_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_16_126_17&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><a href="GHC.IO.Handle.Types.html#loc_106_5_106_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_106_5_106_17&#39;)"><span class="hl_conref"><span class="mpre">DuplexHandle</span></span></a><span class="mpre"> _ </span><a name="loc_126_34_126_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_34_126_35&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> _) </span><a name="loc_126_39_126_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_39_126_42&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> = </span><a href="#loc_130_1_130_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_12&#39;)"><span class="hl_varref"><span class="mpre">withHandle&#39;</span></span></a><span class="mpre"> </span><a href="#loc_126_12_126_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_12_126_15&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_126_16_126_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_16_126_17&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_126_34_126_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_34_126_35&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_126_39_126_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_39_126_42&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre">

</span><a href="#loc_130_1_130_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_12&#39;)"><span class="mpre">withHandle&#39;</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre">
   -&gt; (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre">,</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_130_1_130_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_12&#39;)"><span class="hl_fundecl"><span class="mpre">withHandle&#39;</span></span></a><span class="mpre"> </span><a name="loc_130_13_130_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_13_130_16&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_130_17_130_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_17_130_18&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_130_19_130_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_19_130_20&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><a name="loc_130_21_130_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_21_130_24&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> =
 </span><a href="GHC.IO.html#loc_426_1_426_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_426_1_426_6&#39;)"><span class="hl_varref"><span class="mpre">mask_</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
   (</span><a name="loc_132_5_132_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_5_132_7&#39;)"><span class="hl_vardecl"><span class="mpre">h&#39;</span></span></a><span class="mpre">,</span><a name="loc_132_8_132_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_8_132_9&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre">)  &lt;- </span><a href="#loc_163_1_163_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_1_163_13&#39;)"><span class="hl_varref"><span class="mpre">do_operation</span></span></a><span class="mpre"> </span><a href="#loc_130_13_130_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_13_130_16&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_130_17_130_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_17_130_18&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_130_21_130_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_21_130_24&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre"> </span><a href="#loc_130_19_130_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_19_130_20&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
   </span><a href="GHC.IO.Handle.Types.html#loc_187_1_187_22" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_187_1_187_22&#39;)"><span class="hl_varref"><span class="mpre">checkHandleInvariants</span></span></a><span class="mpre"> </span><a href="#loc_132_5_132_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_5_132_7&#39;)"><span class="hl_varref"><span class="mpre">h&#39;</span></span></a><span class="mpre">
   </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_130_19_130_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_19_130_20&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_132_5_132_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_5_132_7&#39;)"><span class="hl_varref"><span class="mpre">h&#39;</span></span></a><span class="mpre">
   </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_132_8_132_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_8_132_9&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_139_1_139_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_12&#39;)"><span class="mpre">withHandle_</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_139_1_139_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_12&#39;)"><span class="mpre">withHandle_</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_139_1_139_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_12&#39;)"><span class="hl_fundecl"><span class="mpre">withHandle_</span></span></a><span class="mpre"> </span><a name="loc_139_13_139_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_13_139_16&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_139_17_139_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_17_139_18&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><a href="GHC.IO.Handle.Types.html#loc_101_5_101_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_101_5_101_15&#39;)"><span class="hl_conref"><span class="mpre">FileHandle</span></span></a><span class="mpre"> _ </span><a name="loc_139_33_139_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_33_139_34&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">)     </span><a name="loc_139_40_139_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_40_139_43&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> = </span><a href="#loc_143_1_143_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_13&#39;)"><span class="hl_varref"><span class="mpre">withHandle_&#39;</span></span></a><span class="mpre"> </span><a href="#loc_139_13_139_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_13_139_16&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_139_17_139_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_17_139_18&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_139_33_139_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_33_139_34&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_139_40_139_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_40_139_43&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre">
</span><a href="#loc_139_1_139_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_12&#39;)"><span class="hl_fundecl"><span class="mpre">withHandle_</span></span></a><span class="mpre"> </span><a name="loc_140_13_140_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_13_140_16&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_140_17_140_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_17_140_18&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><a href="GHC.IO.Handle.Types.html#loc_106_5_106_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_106_5_106_17&#39;)"><span class="hl_conref"><span class="mpre">DuplexHandle</span></span></a><span class="mpre"> _ </span><a name="loc_140_35_140_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_35_140_36&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> _) </span><a name="loc_140_40_140_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_40_140_43&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> = </span><a href="#loc_143_1_143_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_13&#39;)"><span class="hl_varref"><span class="mpre">withHandle_&#39;</span></span></a><span class="mpre"> </span><a href="#loc_140_13_140_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_13_140_16&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_140_17_140_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_17_140_18&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_140_35_140_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_35_140_36&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_140_40_140_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_40_140_43&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre">

</span><a href="#loc_143_1_143_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_13&#39;)"><span class="mpre">withHandle_&#39;</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_143_1_143_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_13&#39;)"><span class="hl_fundecl"><span class="mpre">withHandle_&#39;</span></span></a><span class="mpre"> </span><a name="loc_143_14_143_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_14_143_17&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_143_18_143_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_18_143_19&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_143_20_143_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_20_143_21&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><a name="loc_143_22_143_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_22_143_25&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> = </span><a href="#loc_130_1_130_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_12&#39;)"><span class="hl_varref"><span class="mpre">withHandle&#39;</span></span></a><span class="mpre"> </span><a href="#loc_143_14_143_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_14_143_17&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_143_18_143_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_18_143_19&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_143_20_143_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_20_143_21&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_143_51_143_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_51_143_53&#39;)"><span class="hl_vardecl"><span class="mpre">h_</span></span></a><span class="mpre"> -&gt; do
                              </span><a name="loc_144_31_144_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_31_144_32&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_143_22_143_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_22_143_25&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre"> </span><a href="#loc_143_51_143_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_51_143_53&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
                              </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_143_51_143_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_51_143_53&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">,</span><a href="#loc_144_31_144_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_31_144_32&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)

</span><a href="#loc_148_1_148_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_1_148_17&#39;)"><span class="mpre">withAllHandles__</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_148_1_148_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_1_148_17&#39;)"><span class="hl_fundecl"><span class="mpre">withAllHandles__</span></span></a><span class="mpre"> </span><a name="loc_148_18_148_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_18_148_21&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_148_22_148_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_22_148_23&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><a href="GHC.IO.Handle.Types.html#loc_101_5_101_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_101_5_101_15&#39;)"><span class="hl_conref"><span class="mpre">FileHandle</span></span></a><span class="mpre"> _ </span><a name="loc_148_38_148_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_38_148_39&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">)     </span><a name="loc_148_45_148_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_45_148_48&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> = </span><a href="#loc_155_1_155_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_14&#39;)"><span class="hl_varref"><span class="mpre">withHandle__&#39;</span></span></a><span class="mpre"> </span><a href="#loc_148_18_148_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_18_148_21&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_148_22_148_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_22_148_23&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_148_38_148_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_38_148_39&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_148_45_148_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_45_148_48&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre">
</span><a href="#loc_148_1_148_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_1_148_17&#39;)"><span class="hl_fundecl"><span class="mpre">withAllHandles__</span></span></a><span class="mpre"> </span><a name="loc_149_18_149_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_18_149_21&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_149_22_149_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_22_149_23&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><a href="GHC.IO.Handle.Types.html#loc_106_5_106_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_106_5_106_17&#39;)"><span class="hl_conref"><span class="mpre">DuplexHandle</span></span></a><span class="mpre"> _ </span><a name="loc_149_40_149_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_40_149_41&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> </span><a name="loc_149_42_149_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_42_149_43&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre">) </span><a name="loc_149_45_149_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_45_149_48&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> = do
  </span><a href="#loc_155_1_155_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_14&#39;)"><span class="hl_varref"><span class="mpre">withHandle__&#39;</span></span></a><span class="mpre"> </span><a href="#loc_149_18_149_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_18_149_21&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_149_22_149_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_22_149_23&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_149_40_149_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_40_149_41&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><a href="#loc_149_45_149_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_45_149_48&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre">
  </span><a href="#loc_155_1_155_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_14&#39;)"><span class="hl_varref"><span class="mpre">withHandle__&#39;</span></span></a><span class="mpre"> </span><a href="#loc_149_18_149_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_18_149_21&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_149_22_149_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_22_149_23&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_149_42_149_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_42_149_43&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><a href="#loc_149_45_149_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_45_149_48&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre">

</span><a href="#loc_155_1_155_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_14&#39;)"><span class="mpre">withHandle__&#39;</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre">)
              -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_155_1_155_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_14&#39;)"><span class="hl_fundecl"><span class="mpre">withHandle__&#39;</span></span></a><span class="mpre"> </span><a name="loc_155_15_155_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_15_155_18&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_155_19_155_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_19_155_20&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_155_21_155_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_21_155_22&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><a name="loc_155_23_155_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_23_155_26&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> =
 </span><a href="GHC.IO.html#loc_426_1_426_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_426_1_426_6&#39;)"><span class="hl_varref"><span class="mpre">mask_</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
   </span><a name="loc_157_4_157_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_4_157_6&#39;)"><span class="hl_vardecl"><span class="mpre">h&#39;</span></span></a><span class="mpre">  &lt;- </span><a href="#loc_163_1_163_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_1_163_13&#39;)"><span class="hl_varref"><span class="mpre">do_operation</span></span></a><span class="mpre"> </span><a href="#loc_155_15_155_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_15_155_18&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_155_19_155_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_19_155_20&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_155_23_155_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_23_155_26&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre"> </span><a href="#loc_155_21_155_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_21_155_22&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
   </span><a href="GHC.IO.Handle.Types.html#loc_187_1_187_22" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_187_1_187_22&#39;)"><span class="hl_varref"><span class="mpre">checkHandleInvariants</span></span></a><span class="mpre"> </span><a href="#loc_157_4_157_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_4_157_6&#39;)"><span class="hl_varref"><span class="mpre">h&#39;</span></span></a><span class="mpre">
   </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_155_21_155_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_21_155_22&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_157_4_157_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_4_157_6&#39;)"><span class="hl_varref"><span class="mpre">h&#39;</span></span></a><span class="mpre">
   </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><a href="#loc_163_1_163_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_1_163_13&#39;)"><span class="mpre">do_operation</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_163_1_163_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_1_163_13&#39;)"><span class="hl_fundecl"><span class="mpre">do_operation</span></span></a><span class="mpre"> </span><a name="loc_163_14_163_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_14_163_17&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_163_18_163_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_18_163_19&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_163_20_163_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_20_163_23&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> </span><a name="loc_163_24_163_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_24_163_25&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = do
  </span><a name="loc_164_3_164_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_3_164_5&#39;)"><span class="hl_vardecl"><span class="mpre">h_</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="hl_varref"><span class="mpre">takeMVar</span></span></a><span class="mpre"> </span><a href="#loc_163_24_163_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_24_163_25&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
  </span><a href="GHC.IO.Handle.Types.html#loc_187_1_187_22" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_187_1_187_22&#39;)"><span class="hl_varref"><span class="mpre">checkHandleInvariants</span></span></a><span class="mpre"> </span><a href="#loc_164_3_164_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_3_164_5&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
  </span><a href="#loc_163_20_163_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_20_163_23&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre"> </span><a href="#loc_164_3_164_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_3_164_5&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="GHC.IO.html#loc_279_1_279_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_279_1_279_15&#39;)"><span class="hl_infix"><span class="mpre">`catchException`</span></span></a><span class="mpre"> </span><a href="#loc_168_5_168_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_5_168_12&#39;)"><span class="hl_varref"><span class="mpre">handler</span></span></a><span class="mpre"> </span><a href="#loc_164_3_164_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_3_164_5&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
  where
    </span><a name="loc_168_5_168_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_5_168_12&#39;)"><span class="hl_fundecl"><span class="mpre">handler</span></span></a><span class="mpre"> </span><a name="loc_168_13_168_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_13_168_15&#39;)"><span class="hl_vardecl"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a name="loc_168_16_168_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_16_168_17&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> = do
      </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_163_24_163_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_24_163_25&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_168_13_168_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_13_168_15&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
      case </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> of
        _ | </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_171_18_171_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_18_171_21&#39;)"><span class="hl_vardecl"><span class="mpre">ioe</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">fromException</span></span><span class="mpre"> </span><a href="#loc_168_16_168_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_16_168_17&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> -&gt;
            </span><a href="GHC.IO.Exception.html#loc_221_1_221_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_221_1_221_8&#39;)"><span class="hl_varref"><span class="mpre">ioError</span></span></a><span class="mpre"> (</span><a href="#loc_213_1_213_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_1_213_15&#39;)"><span class="hl_varref"><span class="mpre">augmentIOError</span></span></a><span class="mpre"> </span><a href="#loc_171_18_171_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_18_171_21&#39;)"><span class="hl_varref"><span class="mpre">ioe</span></span></a><span class="mpre"> </span><a href="#loc_163_14_163_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_14_163_17&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_163_18_163_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_18_163_19&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">)
        _ | </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_173_18_173_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_18_173_26&#39;)"><span class="hl_vardecl"><span class="mpre">async_ex</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">fromException</span></span><span class="mpre"> </span><a href="#loc_168_16_168_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_16_168_17&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; do </span><span class="hl_comment"><span class="mpre">-- see Note [async]</span></span><span class="mpre">
            let _ = </span><a href="#loc_173_18_173_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_18_173_26&#39;)"><span class="hl_varref"><span class="mpre">async_ex</span></span></a><span class="mpre"> :: </span><a href="GHC.IO.Exception.html#loc_116_6_116_24" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_116_6_116_24&#39;)"><span class="hl_tyconref"><span class="mpre">SomeAsyncException</span></span></a><span class="mpre">
            </span><a name="loc_175_13_175_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_13_175_14&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">myThreadId</span></span><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">throwTo</span></span><span class="mpre"> </span><a href="#loc_175_13_175_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_13_175_14&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><a href="#loc_168_16_168_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_16_168_17&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
            </span><a href="#loc_163_1_163_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_1_163_13&#39;)"><span class="hl_varref"><span class="mpre">do_operation</span></span></a><span class="mpre"> </span><a href="#loc_163_14_163_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_14_163_17&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_163_18_163_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_18_163_19&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_163_20_163_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_20_163_23&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre"> </span><a href="#loc_163_24_163_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_24_163_25&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
        </span><span class="hl_vardecl"><span class="mpre">_otherwise</span></span><span class="mpre"> -&gt;
            </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="#loc_168_16_168_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_16_168_17&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Note [async]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If an asynchronous exception is raised during an I/O operation,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- normally it is fine to just re-throw the exception synchronously.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- However, if we are inside an unsafePerformIO or an</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- unsafeInterleaveIO, this would replace the enclosing thunk with the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exception raised, which is wrong (#3997).  We have to release the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- lock on the Handle, but what do we replace the thunk with?  What</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- should happen when the thunk is subsequently demanded again?</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The only sensible choice we have is to re-do the IO operation on</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- resumption, but then we have to be careful in the IO library that</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- this is always safe to do.  In particular we should</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    never perform any side-effects before an interruptible operation</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- because the interruptible operation may raise an asynchronous</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exception, which may cause the operation and its side effects to be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- subsequently performed again.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Re-doing the IO operation is achieved by:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   - using throwTo to re-throw the asynchronous exception asynchronously</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     in the current thread</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   - on resumption, it will be as if throwTo returns.  In that case, we</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     recursively invoke the original operation (see do_operation above).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Interruptible operations in the I/O library are:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    - threadWaitRead/threadWaitWrite</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    - fillReadBuffer/flushWriteBuffer</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    - readTextDevice/writeTextDevice</span></span><span class="mpre">

</span><a href="#loc_213_1_213_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_1_213_15&#39;)"><span class="mpre">augmentIOError</span></a><span class="mpre"> :: </span><a href="GHC.IO.Exception.html#loc_238_6_238_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_238_6_238_17&#39;)"><span class="hl_tyconref"><span class="mpre">IOException</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.IO.Exception.html#loc_238_6_238_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_238_6_238_17&#39;)"><span class="hl_tyconref"><span class="mpre">IOException</span></span></a><span class="mpre">
</span><a name="loc_213_1_213_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_1_213_15&#39;)"><span class="hl_fundecl"><span class="mpre">augmentIOError</span></span></a><span class="mpre"> </span><span class="hl_specname"><span class="mpre">ioe</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 213, srcSpanStartColumn = 20, srcSpanEndLine = 213, srcSpanEndColumn = 48}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 213, srcSpanStartColumn = 27, srcSpanEndLine = 213, srcSpanEndColumn = 28},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">IOError{ ioe_filename = fp }</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">fun</span></span><span class="mpre"> </span><a name="loc_213_53_213_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_53_213_54&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre">
  = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 214, srcSpanStartColumn = 5, srcSpanEndLine = 214, srcSpanEndColumn = 77}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 214, srcSpanStartColumn = 9, srcSpanEndLine = 214, srcSpanEndColumn = 10},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, "><span class="mpre">ioe { ioe_handle = Just h, ioe_location = fun, ioe_filename = filepath }</span></span><span class="mpre">
  where </span><span class="hl_vardecl"><span class="mpre">filepath</span></span><span class="mpre">
          | </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> _ &lt;- </span><span class="hl_varref"><span class="mpre">fp</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fp</span></span><span class="mpre">
          | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = case </span><a href="#loc_213_53_213_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_53_213_54&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> of
                          </span><a href="GHC.IO.Handle.Types.html#loc_101_5_101_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_101_5_101_15&#39;)"><span class="hl_conref"><span class="mpre">FileHandle</span></span></a><span class="mpre"> </span><a name="loc_218_38_218_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_38_218_42&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> _     -&gt; </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_218_38_218_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_38_218_42&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre">
                          </span><a href="GHC.IO.Handle.Types.html#loc_106_5_106_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_106_5_106_17&#39;)"><span class="hl_conref"><span class="mpre">DuplexHandle</span></span></a><span class="mpre"> </span><a name="loc_219_40_219_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_40_219_44&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> _ _ -&gt; </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_219_40_219_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_40_219_44&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Wrapper for write operations.</span></span><span class="mpre">

</span><a href="#loc_225_1_225_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_1_225_19&#39;)"><span class="mpre">wantWritableHandle</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_225_1_225_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_1_225_19&#39;)"><span class="hl_fundecl"><span class="mpre">wantWritableHandle</span></span></a><span class="mpre"> </span><a name="loc_225_20_225_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_20_225_23&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_225_24_225_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_24_225_25&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><a href="GHC.IO.Handle.Types.html#loc_101_5_101_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_101_5_101_15&#39;)"><span class="hl_conref"><span class="mpre">FileHandle</span></span></a><span class="mpre"> _ </span><a name="loc_225_40_225_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_40_225_41&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) </span><a name="loc_225_43_225_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_43_225_46&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre">
  = </span><a href="#loc_235_1_235_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_1_235_20&#39;)"><span class="hl_varref"><span class="mpre">wantWritableHandle&#39;</span></span></a><span class="mpre"> </span><a href="#loc_225_20_225_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_20_225_23&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_225_24_225_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_24_225_25&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_225_40_225_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_40_225_41&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_225_43_225_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_43_225_46&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre">
</span><a href="#loc_225_1_225_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_1_225_19&#39;)"><span class="hl_fundecl"><span class="mpre">wantWritableHandle</span></span></a><span class="mpre"> </span><a name="loc_227_20_227_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_20_227_23&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_227_24_227_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_24_227_25&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><a href="GHC.IO.Handle.Types.html#loc_106_5_106_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_106_5_106_17&#39;)"><span class="hl_conref"><span class="mpre">DuplexHandle</span></span></a><span class="mpre"> _ _ </span><a name="loc_227_44_227_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_44_227_45&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) </span><a name="loc_227_47_227_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_47_227_50&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre">
  = </span><a href="#loc_235_1_235_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_1_235_20&#39;)"><span class="hl_varref"><span class="mpre">wantWritableHandle&#39;</span></span></a><span class="mpre"> </span><a href="#loc_227_20_227_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_20_227_23&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_227_24_227_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_24_227_25&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_227_44_227_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_44_227_45&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_227_47_227_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_47_227_50&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- we know it&#39;s not a ReadHandle or ReadWriteHandle, but we have to</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- check for ClosedHandle/SemiClosedHandle. (#4808)</span></span><span class="mpre">

</span><a href="#loc_235_1_235_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_1_235_20&#39;)"><span class="mpre">wantWritableHandle&#39;</span></a><span class="mpre">
        :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre">
        -&gt; (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_235_1_235_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_1_235_20&#39;)"><span class="hl_fundecl"><span class="mpre">wantWritableHandle&#39;</span></span></a><span class="mpre"> </span><a name="loc_235_21_235_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_21_235_24&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_235_25_235_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_25_235_26&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_235_27_235_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_27_235_28&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><a name="loc_235_29_235_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_29_235_32&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre">
   = </span><a href="#loc_143_1_143_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_13&#39;)"><span class="hl_varref"><span class="mpre">withHandle_&#39;</span></span></a><span class="mpre"> </span><a href="#loc_235_21_235_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_21_235_24&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_235_25_235_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_25_235_26&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_235_27_235_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_27_235_28&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> (</span><a href="#loc_239_1_239_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_20&#39;)"><span class="hl_varref"><span class="mpre">checkWritableHandle</span></span></a><span class="mpre"> </span><a href="#loc_235_29_235_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_29_235_32&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre">)

</span><a href="#loc_239_1_239_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_20&#39;)"><span class="mpre">checkWritableHandle</span></a><span class="mpre"> :: (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_239_1_239_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_20&#39;)"><span class="hl_fundecl"><span class="mpre">checkWritableHandle</span></span></a><span class="mpre"> </span><a name="loc_239_21_239_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_21_239_24&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> </span><a name="loc_239_25_239_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_25_239_27&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 239, srcSpanStartColumn = 28, srcSpanEndLine = 239, srcSpanEndColumn = 40}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 239, srcSpanStartColumn = 36, srcSpanEndLine = 239, srcSpanEndColumn = 37},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{..}</span></span><span class="mpre">
  = case </span><a href="GHC.IO.Handle.Types.html#loc_128_7_128_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_128_7_128_13&#39;)"><span class="hl_varref"><span class="mpre">haType</span></span></a><span class="mpre"> of
      </span><a href="GHC.IO.Handle.Types.html#loc_155_4_155_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_155_4_155_16&#39;)"><span class="hl_conref"><span class="mpre">ClosedHandle</span></span></a><span class="mpre">         -&gt; </span><a href="#loc_324_1_324_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_17&#39;)"><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span></a><span class="mpre">
      </span><a href="GHC.IO.Handle.Types.html#loc_156_4_156_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_156_4_156_20&#39;)"><span class="hl_conref"><span class="mpre">SemiClosedHandle</span></span></a><span class="mpre">     -&gt; </span><a href="#loc_324_1_324_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_17&#39;)"><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span></a><span class="mpre">
      </span><a href="GHC.IO.Handle.Types.html#loc_157_4_157_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_157_4_157_14&#39;)"><span class="hl_conref"><span class="mpre">ReadHandle</span></span></a><span class="mpre">           -&gt; </span><a href="#loc_332_1_332_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_1_332_16&#39;)"><span class="hl_varref"><span class="mpre">ioe_notWritable</span></span></a><span class="mpre">
      </span><a href="GHC.IO.Handle.Types.html#loc_160_4_160_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_160_4_160_19&#39;)"><span class="hl_conref"><span class="mpre">ReadWriteHandle</span></span></a><span class="mpre">      -&gt; do
        </span><a name="loc_245_9_245_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_9_245_12&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre">
        </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_218_1_218_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_218_1_218_14&#39;)"><span class="hl_varref"><span class="mpre">isWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_245_9_245_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_9_245_12&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
           </span><a href="#loc_543_1_543_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_1_543_20&#39;)"><span class="hl_varref"><span class="mpre">flushCharReadBuffer</span></span></a><span class="mpre"> </span><a href="#loc_239_25_239_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_25_239_27&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
           </span><a href="#loc_590_1_590_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_590_1_590_20&#39;)"><span class="hl_varref"><span class="mpre">flushByteReadBuffer</span></span></a><span class="mpre"> </span><a href="#loc_239_25_239_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_25_239_27&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
           </span><span class="hl_vardecl"><span class="mpre">buf</span></span><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre">
           </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 250, srcSpanStartColumn = 36, srcSpanEndLine = 250, srcSpanEndColumn = 65}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 250, srcSpanStartColumn = 39, srcSpanEndLine = 250, srcSpanEndColumn = 40},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;"><span class="mpre">buf{ bufState = WriteBuffer }</span></span><span class="mpre">
           </span><a name="loc_251_12_251_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_251_12_251_15&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre">
           </span><a name="loc_252_12_252_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_12_252_16&#39;)"><span class="hl_vardecl"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.BufferedIO.html#loc_63_3_63_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_63_3_63_19&#39;)"><span class="hl_varref"><span class="mpre">Buffered.emptyWriteBuffer</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre"> </span><a href="#loc_251_12_251_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_251_12_251_15&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
           </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_252_12_252_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_12_252_16&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">
        </span><a href="#loc_239_21_239_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_21_239_24&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre"> </span><a href="#loc_239_25_239_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_25_239_27&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
      </span><span class="hl_vardecl"><span class="mpre">_other</span></span><span class="mpre">               -&gt; </span><a href="#loc_239_21_239_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_21_239_24&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre"> </span><a href="#loc_239_25_239_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_25_239_27&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Wrapper for read operations.</span></span><span class="mpre">

</span><a href="#loc_261_1_261_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_1_261_19&#39;)"><span class="mpre">wantReadableHandle</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre">,</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_261_1_261_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_1_261_19&#39;)"><span class="hl_fundecl"><span class="mpre">wantReadableHandle</span></span></a><span class="mpre"> </span><a name="loc_261_20_261_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_20_261_23&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_261_24_261_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_24_261_25&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_261_26_261_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_26_261_29&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> = </span><a href="#loc_125_1_125_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_1_125_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_261_20_261_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_20_261_23&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_261_24_261_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_24_261_25&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> (</span><a href="#loc_278_1_278_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_1_278_20&#39;)"><span class="hl_varref"><span class="mpre">checkReadableHandle</span></span></a><span class="mpre"> </span><a href="#loc_261_26_261_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_26_261_29&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre">)

</span><a href="#loc_264_1_264_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_1_264_20&#39;)"><span class="mpre">wantReadableHandle_</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_264_1_264_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_1_264_20&#39;)"><span class="hl_fundecl"><span class="mpre">wantReadableHandle_</span></span></a><span class="mpre"> </span><a name="loc_264_21_264_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_21_264_24&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_264_25_264_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_25_264_26&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><a href="GHC.IO.Handle.Types.html#loc_101_5_101_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_101_5_101_15&#39;)"><span class="hl_conref"><span class="mpre">FileHandle</span></span></a><span class="mpre">  _ </span><a name="loc_264_42_264_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_42_264_43&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">)   </span><a name="loc_264_47_264_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_47_264_50&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre">
  = </span><a href="#loc_274_1_274_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_1_274_20&#39;)"><span class="hl_varref"><span class="mpre">wantReadableHandle&#39;</span></span></a><span class="mpre"> </span><a href="#loc_264_21_264_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_21_264_24&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_264_25_264_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_25_264_26&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_264_42_264_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_42_264_43&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_264_47_264_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_47_264_50&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre">
</span><a href="#loc_264_1_264_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_1_264_20&#39;)"><span class="hl_fundecl"><span class="mpre">wantReadableHandle_</span></span></a><span class="mpre"> </span><a name="loc_266_21_266_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_21_266_24&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_266_25_266_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_25_266_26&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><a href="GHC.IO.Handle.Types.html#loc_106_5_106_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_106_5_106_17&#39;)"><span class="hl_conref"><span class="mpre">DuplexHandle</span></span></a><span class="mpre"> _ </span><a name="loc_266_43_266_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_43_266_44&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> _) </span><a name="loc_266_48_266_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_48_266_51&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre">
  = </span><a href="#loc_274_1_274_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_1_274_20&#39;)"><span class="hl_varref"><span class="mpre">wantReadableHandle&#39;</span></span></a><span class="mpre"> </span><a href="#loc_266_21_266_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_21_266_24&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_266_25_266_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_25_266_26&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_266_43_266_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_43_266_44&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_266_48_266_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_48_266_51&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- we know it&#39;s not a WriteHandle or ReadWriteHandle, but we have to</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- check for ClosedHandle/SemiClosedHandle. (#4808)</span></span><span class="mpre">

</span><a href="#loc_274_1_274_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_1_274_20&#39;)"><span class="mpre">wantReadableHandle&#39;</span></a><span class="mpre">
        :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre">
        -&gt; (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_274_1_274_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_1_274_20&#39;)"><span class="hl_fundecl"><span class="mpre">wantReadableHandle&#39;</span></span></a><span class="mpre"> </span><a name="loc_274_21_274_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_21_274_24&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_274_25_274_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_25_274_26&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_274_27_274_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_27_274_28&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><a name="loc_274_29_274_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_29_274_32&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre">
  = </span><a href="#loc_143_1_143_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_13&#39;)"><span class="hl_varref"><span class="mpre">withHandle_&#39;</span></span></a><span class="mpre"> </span><a href="#loc_274_21_274_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_21_274_24&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_274_25_274_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_25_274_26&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_274_27_274_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_27_274_28&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> (</span><a href="#loc_278_1_278_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_1_278_20&#39;)"><span class="hl_varref"><span class="mpre">checkReadableHandle</span></span></a><span class="mpre"> </span><a href="#loc_274_29_274_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_29_274_32&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre">)

</span><a href="#loc_278_1_278_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_1_278_20&#39;)"><span class="mpre">checkReadableHandle</span></a><span class="mpre"> :: (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_278_1_278_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_1_278_20&#39;)"><span class="hl_fundecl"><span class="mpre">checkReadableHandle</span></span></a><span class="mpre"> </span><a name="loc_278_21_278_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_21_278_24&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> </span><a name="loc_278_25_278_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_25_278_27&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 278, srcSpanStartColumn = 28, srcSpanEndLine = 278, srcSpanEndColumn = 40}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 278, srcSpanStartColumn = 36, srcSpanEndLine = 278, srcSpanEndColumn = 37},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{..}</span></span><span class="mpre"> =
    case </span><a href="GHC.IO.Handle.Types.html#loc_128_7_128_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_128_7_128_13&#39;)"><span class="hl_varref"><span class="mpre">haType</span></span></a><span class="mpre"> of
      </span><a href="GHC.IO.Handle.Types.html#loc_155_4_155_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_155_4_155_16&#39;)"><span class="hl_conref"><span class="mpre">ClosedHandle</span></span></a><span class="mpre">         -&gt; </span><a href="#loc_324_1_324_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_17&#39;)"><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span></a><span class="mpre">
      </span><a href="GHC.IO.Handle.Types.html#loc_156_4_156_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_156_4_156_20&#39;)"><span class="hl_conref"><span class="mpre">SemiClosedHandle</span></span></a><span class="mpre">     -&gt; </span><a href="#loc_324_1_324_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_17&#39;)"><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span></a><span class="mpre">
      </span><a href="GHC.IO.Handle.Types.html#loc_159_4_159_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_159_4_159_16&#39;)"><span class="hl_conref"><span class="mpre">AppendHandle</span></span></a><span class="mpre">         -&gt; </span><a href="#loc_329_1_329_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_1_329_16&#39;)"><span class="hl_varref"><span class="mpre">ioe_notReadable</span></span></a><span class="mpre">
      </span><a href="GHC.IO.Handle.Types.html#loc_158_4_158_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_158_4_158_15&#39;)"><span class="hl_conref"><span class="mpre">WriteHandle</span></span></a><span class="mpre">          -&gt; </span><a href="#loc_329_1_329_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_1_329_16&#39;)"><span class="hl_varref"><span class="mpre">ioe_notReadable</span></span></a><span class="mpre">
      </span><a href="GHC.IO.Handle.Types.html#loc_160_4_160_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_160_4_160_19&#39;)"><span class="hl_conref"><span class="mpre">ReadWriteHandle</span></span></a><span class="mpre">      -&gt; do
          </span><span class="hl_comment"><span class="mpre">-- a read/write handle and we want to read from it.  We must</span></span><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- flush all buffered write data first.</span></span><span class="mpre">
          </span><a name="loc_287_11_287_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_11_287_15&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre">
          </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_218_1_218_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_218_1_218_14&#39;)"><span class="hl_varref"><span class="mpre">isWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_287_11_287_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_11_287_15&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
             </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_287_11_287_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_11_287_15&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_495_1_495_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_495_1_495_21&#39;)"><span class="hl_varref"><span class="mpre">flushByteWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_278_25_278_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_25_278_27&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
             </span><span class="hl_vardecl"><span class="mpre">cbuf&#39;</span></span><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre">
             </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 291, srcSpanStartColumn = 38, srcSpanEndLine = 291, srcSpanEndColumn = 68}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 291, srcSpanStartColumn = 43, srcSpanEndLine = 291, srcSpanEndColumn = 44},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;"><span class="mpre">cbuf&#39;{ bufState = ReadBuffer }</span></span><span class="mpre">
             </span><span class="hl_vardecl"><span class="mpre">bbuf</span></span><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre">
             </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 293, srcSpanStartColumn = 38, srcSpanEndLine = 293, srcSpanEndColumn = 67}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 293, srcSpanStartColumn = 42, srcSpanEndLine = 293, srcSpanEndColumn = 43},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;"><span class="mpre">bbuf{ bufState = ReadBuffer }</span></span><span class="mpre">
          </span><a href="#loc_278_21_278_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_21_278_24&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre"> </span><a href="#loc_278_25_278_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_25_278_27&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
      </span><span class="hl_vardecl"><span class="mpre">_other</span></span><span class="mpre">               -&gt; </span><a href="#loc_278_21_278_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_21_278_24&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre"> </span><a href="#loc_278_25_278_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_25_278_27&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Wrapper for seek operations.</span></span><span class="mpre">

</span><a href="#loc_301_1_301_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_301_1_301_19&#39;)"><span class="mpre">wantSeekableHandle</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_301_1_301_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_301_1_301_19&#39;)"><span class="hl_fundecl"><span class="mpre">wantSeekableHandle</span></span></a><span class="mpre"> </span><a name="loc_301_20_301_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_301_20_301_23&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_301_24_301_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_301_24_301_25&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><a href="GHC.IO.Handle.Types.html#loc_106_5_106_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_106_5_106_17&#39;)"><span class="hl_conref"><span class="mpre">DuplexHandle</span></span></a><span class="mpre"> _ _ _) </span><span class="hl_vardecl"><span class="mpre">_act</span></span><span class="mpre"> =
  </span><a href="GHC.IO.Exception.html#loc_217_1_217_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_217_1_217_12&#39;)"><span class="hl_varref"><span class="mpre">ioException</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">IOError</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_301_24_301_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_301_24_301_25&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">) </span><a href="GHC.IO.Exception.html#loc_264_5_264_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_264_5_264_21&#39;)"><span class="hl_conref"><span class="mpre">IllegalOperation</span></span></a><span class="mpre"> </span><a href="#loc_301_20_301_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_301_20_301_23&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre">
                   </span><span class="hl_string"><span class="mpre">&quot;handle is not seekable&quot;</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">)
</span><a href="#loc_301_1_301_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_301_1_301_19&#39;)"><span class="hl_fundecl"><span class="mpre">wantSeekableHandle</span></span></a><span class="mpre"> </span><a name="loc_304_20_304_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_20_304_23&#39;)"><span class="hl_vardecl"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a name="loc_304_24_304_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_24_304_25&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><a href="GHC.IO.Handle.Types.html#loc_101_5_101_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_101_5_101_15&#39;)"><span class="hl_conref"><span class="mpre">FileHandle</span></span></a><span class="mpre"> _ </span><a name="loc_304_40_304_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_40_304_41&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) </span><a name="loc_304_43_304_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_43_304_46&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> =
  </span><a href="#loc_143_1_143_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_13&#39;)"><span class="hl_varref"><span class="mpre">withHandle_&#39;</span></span></a><span class="mpre"> </span><a href="#loc_304_20_304_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_20_304_23&#39;)"><span class="hl_varref"><span class="mpre">fun</span></span></a><span class="mpre"> </span><a href="#loc_304_24_304_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_24_304_25&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_304_40_304_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_40_304_41&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> (</span><a href="#loc_308_1_308_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_308_1_308_20&#39;)"><span class="hl_varref"><span class="mpre">checkSeekableHandle</span></span></a><span class="mpre"> </span><a href="#loc_304_43_304_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_43_304_46&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre">)

</span><a href="#loc_308_1_308_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_308_1_308_20&#39;)"><span class="mpre">checkSeekableHandle</span></a><span class="mpre"> :: (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_308_1_308_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_308_1_308_20&#39;)"><span class="hl_fundecl"><span class="mpre">checkSeekableHandle</span></span></a><span class="mpre"> </span><a name="loc_308_21_308_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_308_21_308_24&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> </span><a name="loc_308_25_308_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_308_25_308_32&#39;)"><span class="hl_specname"><span class="mpre">handle_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 308, srcSpanStartColumn = 33, srcSpanEndLine = 308, srcSpanEndColumn = 55}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 308, srcSpanStartColumn = 41, srcSpanEndLine = 308, srcSpanEndColumn = 42},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{haDevice=dev}</span></span><span class="mpre"> =
    case </span><a href="GHC.IO.Handle.Types.html#loc_128_7_128_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_128_7_128_13&#39;)"><span class="hl_varref"><span class="mpre">haType</span></span></a><span class="mpre"> </span><a href="#loc_308_25_308_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_308_25_308_32&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> of
      </span><a href="GHC.IO.Handle.Types.html#loc_155_4_155_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_155_4_155_16&#39;)"><span class="hl_conref"><span class="mpre">ClosedHandle</span></span></a><span class="mpre">      -&gt; </span><a href="#loc_324_1_324_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_17&#39;)"><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span></a><span class="mpre">
      </span><a href="GHC.IO.Handle.Types.html#loc_156_4_156_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_156_4_156_20&#39;)"><span class="hl_conref"><span class="mpre">SemiClosedHandle</span></span></a><span class="mpre">  -&gt; </span><a href="#loc_324_1_324_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_17&#39;)"><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span></a><span class="mpre">
      </span><a href="GHC.IO.Handle.Types.html#loc_159_4_159_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_159_4_159_16&#39;)"><span class="hl_conref"><span class="mpre">AppendHandle</span></span></a><span class="mpre">      -&gt; </span><a href="#loc_335_1_335_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_1_335_16&#39;)"><span class="hl_varref"><span class="mpre">ioe_notSeekable</span></span></a><span class="mpre">
      _ -&gt; do </span><a name="loc_313_15_313_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_15_313_16&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Device.html#loc_78_3_78_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_78_3_78_13&#39;)"><span class="hl_varref"><span class="mpre">IODevice.isSeekable</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">dev</span></span><span class="mpre">
              if </span><a href="#loc_313_15_313_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_15_313_16&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> then </span><a href="#loc_308_21_308_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_308_21_308_24&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre"> </span><a href="#loc_308_25_308_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_308_25_308_32&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">
                   else </span><a href="#loc_335_1_335_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_1_335_16&#39;)"><span class="hl_varref"><span class="mpre">ioe_notSeekable</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Handy IOErrors</span></span><span class="mpre">

</span><a href="#loc_324_1_324_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_17&#39;)"><span class="mpre">ioe_closedHandle</span></a><span class="mpre">, </span><a href="#loc_327_1_327_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_1_327_8&#39;)"><span class="mpre">ioe_EOF</span></a><span class="mpre">,
  </span><a href="#loc_329_1_329_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_1_329_16&#39;)"><span class="mpre">ioe_notReadable</span></a><span class="mpre">, </span><a href="#loc_332_1_332_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_1_332_16&#39;)"><span class="mpre">ioe_notWritable</span></a><span class="mpre">, </span><a href="#loc_338_1_338_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_1_338_27&#39;)"><span class="mpre">ioe_cannotFlushNotSeekable</span></a><span class="mpre">,
  </span><a href="#loc_335_1_335_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_1_335_16&#39;)"><span class="mpre">ioe_notSeekable</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">

</span><a name="loc_324_1_324_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_17&#39;)"><span class="hl_vardecl"><span class="mpre">ioe_closedHandle</span></span></a><span class="mpre"> = </span><a href="GHC.IO.Exception.html#loc_217_1_217_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_217_1_217_12&#39;)"><span class="hl_varref"><span class="mpre">ioException</span></span></a><span class="mpre">
   (</span><span class="hl_conref"><span class="mpre">IOError</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_264_5_264_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_264_5_264_21&#39;)"><span class="hl_conref"><span class="mpre">IllegalOperation</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
        </span><span class="hl_string"><span class="mpre">&quot;handle is closed&quot;</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">)
</span><a name="loc_327_1_327_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_1_327_8&#39;)"><span class="hl_vardecl"><span class="mpre">ioe_EOF</span></span></a><span class="mpre"> = </span><a href="GHC.IO.Exception.html#loc_217_1_217_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_217_1_217_12&#39;)"><span class="hl_varref"><span class="mpre">ioException</span></span></a><span class="mpre">
   (</span><span class="hl_conref"><span class="mpre">IOError</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_263_5_263_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_263_5_263_8&#39;)"><span class="hl_conref"><span class="mpre">EOF</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">)
</span><a name="loc_329_1_329_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_1_329_16&#39;)"><span class="hl_vardecl"><span class="mpre">ioe_notReadable</span></span></a><span class="mpre"> = </span><a href="GHC.IO.Exception.html#loc_217_1_217_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_217_1_217_12&#39;)"><span class="hl_varref"><span class="mpre">ioException</span></span></a><span class="mpre">
   (</span><span class="hl_conref"><span class="mpre">IOError</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_264_5_264_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_264_5_264_21&#39;)"><span class="hl_conref"><span class="mpre">IllegalOperation</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
        </span><span class="hl_string"><span class="mpre">&quot;handle is not open for reading&quot;</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">)
</span><a name="loc_332_1_332_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_1_332_16&#39;)"><span class="hl_vardecl"><span class="mpre">ioe_notWritable</span></span></a><span class="mpre"> = </span><a href="GHC.IO.Exception.html#loc_217_1_217_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_217_1_217_12&#39;)"><span class="hl_varref"><span class="mpre">ioException</span></span></a><span class="mpre">
   (</span><span class="hl_conref"><span class="mpre">IOError</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_264_5_264_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_264_5_264_21&#39;)"><span class="hl_conref"><span class="mpre">IllegalOperation</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
        </span><span class="hl_string"><span class="mpre">&quot;handle is not open for writing&quot;</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">)
</span><a name="loc_335_1_335_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_1_335_16&#39;)"><span class="hl_vardecl"><span class="mpre">ioe_notSeekable</span></span></a><span class="mpre"> = </span><a href="GHC.IO.Exception.html#loc_217_1_217_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_217_1_217_12&#39;)"><span class="hl_varref"><span class="mpre">ioException</span></span></a><span class="mpre">
   (</span><span class="hl_conref"><span class="mpre">IOError</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_264_5_264_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_264_5_264_21&#39;)"><span class="hl_conref"><span class="mpre">IllegalOperation</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
        </span><span class="hl_string"><span class="mpre">&quot;handle is not seekable&quot;</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">)
</span><a name="loc_338_1_338_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_1_338_27&#39;)"><span class="hl_vardecl"><span class="mpre">ioe_cannotFlushNotSeekable</span></span></a><span class="mpre"> = </span><a href="GHC.IO.Exception.html#loc_217_1_217_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_217_1_217_12&#39;)"><span class="hl_varref"><span class="mpre">ioException</span></span></a><span class="mpre">
   (</span><span class="hl_conref"><span class="mpre">IOError</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_264_5_264_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_264_5_264_21&#39;)"><span class="hl_conref"><span class="mpre">IllegalOperation</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
      </span><span class="hl_string"><span class="mpre">&quot;cannot flush the read buffer: underlying device is not seekable&quot;</span></span><span class="mpre">
        </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">)

</span><a href="#loc_344_1_344_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_1_344_20&#39;)"><span class="mpre">ioe_finalizedHandle</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre">
</span><a name="loc_344_1_344_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_1_344_20&#39;)"><span class="hl_fundecl"><span class="mpre">ioe_finalizedHandle</span></span></a><span class="mpre"> </span><a name="loc_344_21_344_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_21_344_23&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">throw</span></span><span class="mpre">
   (</span><span class="hl_conref"><span class="mpre">IOError</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_264_5_264_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_264_5_264_21&#39;)"><span class="hl_conref"><span class="mpre">IllegalOperation</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
        </span><span class="hl_string"><span class="mpre">&quot;handle is finalized&quot;</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_344_21_344_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_21_344_23&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">))

</span><a href="#loc_349_1_349_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_1_349_11&#39;)"><span class="mpre">ioe_bufsiz</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_349_1_349_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_1_349_11&#39;)"><span class="hl_fundecl"><span class="mpre">ioe_bufsiz</span></span></a><span class="mpre"> </span><a name="loc_349_12_349_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_12_349_13&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><a href="GHC.IO.Exception.html#loc_217_1_217_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_217_1_217_12&#39;)"><span class="hl_varref"><span class="mpre">ioException</span></span></a><span class="mpre">
   (</span><span class="hl_conref"><span class="mpre">IOError</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_272_5_272_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_272_5_272_20&#39;)"><span class="hl_conref"><span class="mpre">InvalidArgument</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hSetBuffering&quot;</span></span><span class="mpre">
        (</span><span class="hl_string"><span class="mpre">&quot;illegal buffer size &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">showsPrec</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">9</span></span><span class="mpre"> </span><a href="#loc_349_12_349_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_12_349_13&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> []) </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">)
                                </span><span class="hl_comment"><span class="mpre">-- 9 =&gt; should be parens&#39;ified.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Wrapper for Handle encoding/decoding.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- The interface for TextEncoding changed so that a TextEncoding doesn&#39;t raise</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- an exception if it encounters an invalid sequnce. Furthermore, encoding</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- returns a reason as to why encoding stopped, letting us know if it was due</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to input/output underflow or an invalid sequence.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This code adapts this elaborated interface back to the original TextEncoding</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- interface.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- FIXME: it is possible that Handle code using the haDecoder/haEncoder fields</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- could be made clearer by using the &#39;encode&#39; interface directly. I have not</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- looked into this.</span></span><span class="mpre">

</span><a href="#loc_372_1_372_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_1_372_13&#39;)"><span class="mpre">streamEncode</span></a><span class="mpre"> :: </span><a href="GHC.IO.Encoding.Types.html#loc_36_6_36_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.Types.html#loc_36_6_36_17&#39;)"><span class="hl_tyconref"><span class="mpre">BufferCodec</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">from</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">to</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">state</span></span><span class="mpre">
             -&gt; </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">from</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">to</span></span><span class="mpre">
             -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">from</span></span><span class="mpre">, </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">to</span></span><span class="mpre">)
</span><a name="loc_372_1_372_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_1_372_13&#39;)"><span class="hl_fundecl"><span class="mpre">streamEncode</span></span></a><span class="mpre"> </span><a name="loc_372_14_372_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_14_372_19&#39;)"><span class="hl_vardecl"><span class="mpre">codec</span></span></a><span class="mpre"> </span><a name="loc_372_20_372_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_20_372_24&#39;)"><span class="hl_vardecl"><span class="mpre">from</span></span></a><span class="mpre"> </span><a name="loc_372_25_372_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_25_372_27&#39;)"><span class="hl_vardecl"><span class="mpre">to</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> (\(_, </span><a name="loc_372_41_372_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_41_372_46&#39;)"><span class="hl_vardecl"><span class="mpre">from&#39;</span></span></a><span class="mpre">, </span><a name="loc_372_48_372_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_48_372_51&#39;)"><span class="hl_vardecl"><span class="mpre">to&#39;</span></span></a><span class="mpre">) -&gt; (</span><a href="#loc_372_41_372_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_41_372_46&#39;)"><span class="hl_varref"><span class="mpre">from&#39;</span></span></a><span class="mpre">, </span><a href="#loc_372_48_372_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_48_372_51&#39;)"><span class="hl_varref"><span class="mpre">to&#39;</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_376_1_376_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_376_1_376_17&#39;)"><span class="hl_varref"><span class="mpre">recoveringEncode</span></span></a><span class="mpre"> </span><a href="#loc_372_14_372_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_14_372_19&#39;)"><span class="hl_varref"><span class="mpre">codec</span></span></a><span class="mpre"> </span><a href="#loc_372_20_372_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_20_372_24&#39;)"><span class="hl_varref"><span class="mpre">from</span></span></a><span class="mpre"> </span><a href="#loc_372_25_372_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_25_372_27&#39;)"><span class="hl_varref"><span class="mpre">to</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Just like &#39;encode&#39;, but interleaves calls to &#39;encode&#39; with calls to &#39;recover&#39; in order to make as much progress as possible</span></span><span class="mpre">
</span><a href="#loc_376_1_376_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_376_1_376_17&#39;)"><span class="mpre">recoveringEncode</span></a><span class="mpre"> :: </span><a href="GHC.IO.Encoding.Types.html#loc_36_6_36_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.Types.html#loc_36_6_36_17&#39;)"><span class="hl_tyconref"><span class="mpre">BufferCodec</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">from</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">to</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">state</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">CodeBuffer</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">from</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">to</span></span><span class="mpre">
</span><a name="loc_376_1_376_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_376_1_376_17&#39;)"><span class="hl_fundecl"><span class="mpre">recoveringEncode</span></span></a><span class="mpre"> </span><a name="loc_376_18_376_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_376_18_376_23&#39;)"><span class="hl_vardecl"><span class="mpre">codec</span></span></a><span class="mpre"> </span><a name="loc_376_24_376_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_376_24_376_28&#39;)"><span class="hl_vardecl"><span class="mpre">from</span></span></a><span class="mpre"> </span><a name="loc_376_29_376_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_376_29_376_31&#39;)"><span class="hl_vardecl"><span class="mpre">to</span></span></a><span class="mpre"> = </span><a href="#loc_378_5_378_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_5_378_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_376_24_376_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_376_24_376_28&#39;)"><span class="hl_varref"><span class="mpre">from</span></span></a><span class="mpre"> </span><a href="#loc_376_29_376_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_376_29_376_31&#39;)"><span class="hl_varref"><span class="mpre">to</span></span></a><span class="mpre">
  where
    </span><a name="loc_378_5_378_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_5_378_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_378_8_378_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_8_378_12&#39;)"><span class="hl_vardecl"><span class="mpre">from</span></span></a><span class="mpre"> </span><a name="loc_378_13_378_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_13_378_15&#39;)"><span class="hl_vardecl"><span class="mpre">to</span></span></a><span class="mpre"> = do
      (</span><a name="loc_379_8_379_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_379_8_379_11&#39;)"><span class="hl_vardecl"><span class="mpre">why</span></span></a><span class="mpre">, </span><a name="loc_379_13_379_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_379_13_379_18&#39;)"><span class="hl_vardecl"><span class="mpre">from&#39;</span></span></a><span class="mpre">, </span><a name="loc_379_20_379_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_379_20_379_23&#39;)"><span class="hl_vardecl"><span class="mpre">to&#39;</span></span></a><span class="mpre">) &lt;- </span><span class="hl_varref"><span class="mpre">encode</span></span><span class="mpre"> </span><a href="#loc_376_18_376_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_376_18_376_23&#39;)"><span class="hl_varref"><span class="mpre">codec</span></span></a><span class="mpre"> </span><a href="#loc_378_8_378_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_8_378_12&#39;)"><span class="hl_varref"><span class="mpre">from</span></span></a><span class="mpre"> </span><a href="#loc_378_13_378_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_13_378_15&#39;)"><span class="hl_varref"><span class="mpre">to</span></span></a><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">-- When we are dealing with Handles, we don&#39;t care about input/output</span></span><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">-- underflow particularly, and we want to delay errors about invalid</span></span><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">-- sequences as far as possible.</span></span><span class="mpre">
      case </span><a href="#loc_379_8_379_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_379_8_379_11&#39;)"><span class="hl_varref"><span class="mpre">why</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">InvalidSequence</span></span><span class="mpre"> | </span><a href="GHC.IO.Buffer.html#loc_185_9_185_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_185_9_185_13&#39;)"><span class="hl_varref"><span class="mpre">bufL</span></span></a><span class="mpre"> </span><a href="#loc_378_8_378_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_8_378_12&#39;)"><span class="hl_varref"><span class="mpre">from</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_185_9_185_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_185_9_185_13&#39;)"><span class="hl_varref"><span class="mpre">bufL</span></span></a><span class="mpre"> </span><a href="#loc_379_13_379_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_379_13_379_18&#39;)"><span class="hl_varref"><span class="mpre">from&#39;</span></span></a><span class="mpre"> -&gt; do
          </span><span class="hl_comment"><span class="mpre">-- NB: it is OK to call recover here. Because we saw InvalidSequence, by the invariants</span></span><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- on &quot;encode&quot; it must be the case that there is at least one elements available in the output</span></span><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- buffer. Furthermore, clearly there is at least one element in the input buffer since we found</span></span><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- something invalid there!</span></span><span class="mpre">
          (</span><a name="loc_389_12_389_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_12_389_17&#39;)"><span class="hl_vardecl"><span class="mpre">from&#39;</span></span></a><span class="mpre">, </span><a name="loc_389_19_389_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_19_389_22&#39;)"><span class="hl_vardecl"><span class="mpre">to&#39;</span></span></a><span class="mpre">) &lt;- </span><span class="hl_varref"><span class="mpre">recover</span></span><span class="mpre"> </span><a href="#loc_376_18_376_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_376_18_376_23&#39;)"><span class="hl_varref"><span class="mpre">codec</span></span></a><span class="mpre"> </span><a href="#loc_379_13_379_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_379_13_379_18&#39;)"><span class="hl_varref"><span class="mpre">from&#39;</span></span></a><span class="mpre"> </span><a href="#loc_379_20_379_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_379_20_379_23&#39;)"><span class="hl_varref"><span class="mpre">to&#39;</span></span></a><span class="mpre">
          </span><a href="#loc_378_5_378_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_5_378_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_389_12_389_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_12_389_17&#39;)"><span class="hl_varref"><span class="mpre">from&#39;</span></span></a><span class="mpre"> </span><a href="#loc_389_19_389_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_19_389_22&#39;)"><span class="hl_varref"><span class="mpre">to&#39;</span></span></a><span class="mpre">
        _ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_379_8_379_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_379_8_379_11&#39;)"><span class="hl_varref"><span class="mpre">why</span></span></a><span class="mpre">, </span><a href="#loc_379_13_379_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_379_13_379_18&#39;)"><span class="hl_varref"><span class="mpre">from&#39;</span></span></a><span class="mpre">, </span><a href="#loc_379_20_379_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_379_20_379_23&#39;)"><span class="hl_varref"><span class="mpre">to&#39;</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Handle Finalizers</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- For a duplex handle, we arrange that the read side points to the write side</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (and hence keeps it alive if the read side is alive).  This is done by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- having the haOtherSide field of the read side point to the read side.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The finalizer is then placed on the write side, and the handle only gets</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- finalized once, when both sides are no longer required.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- NOTE about finalized handles: It&#39;s possible that a handle can be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- finalized and then we try to use it later, for example if the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- handle is referenced from another finalizer, or from a thread that</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- has become unreferenced and then resurrected (arguably in the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- latter case we shouldn&#39;t finalize the Handle...).  Anyway,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- we try to emit a helpful message which is better than nothing.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [later; 8/2010] However, a program like this can yield a strange</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- error message:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   main = writeFile &quot;out&quot; loop</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   loop = let x = x in x</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- because the main thread and the Handle are both unreachable at the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- same time, the Handle may get finalized before the main thread</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- receives the NonTermination exception, and the exception handler</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- will then report an error.  We&#39;d rather this was not an error and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the program just prints &quot;&lt;&lt;loop&gt;&gt;&quot;.</span></span><span class="mpre">

</span><a href="#loc_422_1_422_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_1_422_16&#39;)"><span class="mpre">handleFinalizer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_422_1_422_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_1_422_16&#39;)"><span class="hl_fundecl"><span class="mpre">handleFinalizer</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">fp</span></span><span class="mpre"> </span><a name="loc_422_20_422_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_20_422_21&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = do
  </span><a name="loc_423_3_423_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_423_3_423_10&#39;)"><span class="hl_vardecl"><span class="mpre">handle_</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="hl_varref"><span class="mpre">takeMVar</span></span></a><span class="mpre"> </span><a href="#loc_422_20_422_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_20_422_21&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
  (</span><a name="loc_424_4_424_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_424_4_424_12&#39;)"><span class="hl_vardecl"><span class="mpre">handle_&#39;</span></span></a><span class="mpre">, _) &lt;- </span><a href="#loc_732_1_732_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_1_732_12&#39;)"><span class="hl_varref"><span class="mpre">hClose_help</span></span></a><span class="mpre"> </span><a href="#loc_423_3_423_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_423_3_423_10&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">
  </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_422_20_422_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_20_422_21&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_424_4_424_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_424_4_424_12&#39;)"><span class="hl_varref"><span class="mpre">handle_&#39;</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Allocating buffers</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- using an 8k char buffer instead of 32k improved performance for a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- basic &quot;cat&quot; program by ~30% for me.  --SDM</span></span><span class="mpre">
</span><a href="#loc_434_1_434_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_1_434_25&#39;)"><span class="mpre">dEFAULT_CHAR_BUFFER_SIZE</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_434_1_434_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_1_434_25&#39;)"><span class="hl_vardecl"><span class="mpre">dEFAULT_CHAR_BUFFER_SIZE</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">2048</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- 8k/sizeof(HsChar)</span></span><span class="mpre">

</span><a href="#loc_438_1_438_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_438_1_438_14&#39;)"><span class="mpre">getCharBuffer</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 436, srcSpanStartColumn = 18, srcSpanEndLine = 436, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 436, srcSpanStartColumn = 31, srcSpanEndLine = 436, srcSpanEndColumn = 33}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/ba"><span class="mpre">IODevice dev =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">dev</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Buffer.html#loc_195_6_195_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_195_6_195_17&#39;)"><span class="hl_tyconref"><span class="mpre">BufferState</span></span></a><span class="mpre">
              -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre">, </span><a href="GHC.IO.Handle.Types.html#loc_246_6_246_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_246_6_246_16&#39;)"><span class="hl_tyconref"><span class="mpre">BufferMode</span></span></a><span class="mpre">)
</span><a name="loc_438_1_438_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_438_1_438_14&#39;)"><span class="hl_fundecl"><span class="mpre">getCharBuffer</span></span></a><span class="mpre"> </span><a name="loc_438_15_438_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_438_15_438_18&#39;)"><span class="hl_vardecl"><span class="mpre">dev</span></span></a><span class="mpre"> </span><a name="loc_438_19_438_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_438_19_438_24&#39;)"><span class="hl_vardecl"><span class="mpre">state</span></span></a><span class="mpre"> = do
  </span><a name="loc_439_3_439_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_3_439_9&#39;)"><span class="hl_vardecl"><span class="mpre">buffer</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Buffer.html#loc_247_1_247_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_247_1_247_14&#39;)"><span class="hl_varref"><span class="mpre">newCharBuffer</span></span></a><span class="mpre"> </span><a href="#loc_434_1_434_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_1_434_25&#39;)"><span class="hl_varref"><span class="mpre">dEFAULT_CHAR_BUFFER_SIZE</span></span></a><span class="mpre"> </span><a href="#loc_438_19_438_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_438_19_438_24&#39;)"><span class="hl_varref"><span class="mpre">state</span></span></a><span class="mpre">
  </span><a name="loc_440_3_440_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_440_3_440_8&#39;)"><span class="hl_vardecl"><span class="mpre">ioref</span></span></a><span class="mpre">  &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_439_3_439_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_3_439_9&#39;)"><span class="hl_varref"><span class="mpre">buffer</span></span></a><span class="mpre">
  </span><a name="loc_441_3_441_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_441_3_441_9&#39;)"><span class="hl_vardecl"><span class="mpre">is_tty</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Device.html#loc_74_3_74_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_74_3_74_13&#39;)"><span class="hl_varref"><span class="mpre">IODevice.isTerminal</span></span></a><span class="mpre"> </span><a href="#loc_438_15_438_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_438_15_438_18&#39;)"><span class="hl_varref"><span class="mpre">dev</span></span></a><span class="mpre">

  let </span><a name="loc_443_7_443_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_443_7_443_18&#39;)"><span class="hl_vardecl"><span class="mpre">buffer_mode</span></span></a><span class="mpre"> 
         | </span><a href="#loc_441_3_441_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_441_3_441_9&#39;)"><span class="hl_varref"><span class="mpre">is_tty</span></span></a><span class="mpre">    = </span><a href="GHC.IO.Handle.Types.html#loc_248_4_248_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_248_4_248_17&#39;)"><span class="hl_conref"><span class="mpre">LineBuffering</span></span></a><span class="mpre"> 
         | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="GHC.IO.Handle.Types.html#loc_250_4_250_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_250_4_250_18&#39;)"><span class="hl_conref"><span class="mpre">BlockBuffering</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">

  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_440_3_440_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_440_3_440_8&#39;)"><span class="hl_varref"><span class="mpre">ioref</span></span></a><span class="mpre">, </span><a href="#loc_443_7_443_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_443_7_443_18&#39;)"><span class="hl_varref"><span class="mpre">buffer_mode</span></span></a><span class="mpre">)

</span><a href="#loc_450_1_450_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_450_1_450_11&#39;)"><span class="mpre">mkUnBuffer</span></a><span class="mpre"> :: </span><a href="GHC.IO.Buffer.html#loc_195_6_195_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_195_6_195_17&#39;)"><span class="hl_tyconref"><span class="mpre">BufferState</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre">, </span><a href="GHC.IO.Handle.Types.html#loc_246_6_246_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_246_6_246_16&#39;)"><span class="hl_tyconref"><span class="mpre">BufferMode</span></span></a><span class="mpre">)
</span><a name="loc_450_1_450_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_450_1_450_11&#39;)"><span class="hl_fundecl"><span class="mpre">mkUnBuffer</span></span></a><span class="mpre"> </span><a name="loc_450_12_450_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_450_12_450_17&#39;)"><span class="hl_vardecl"><span class="mpre">state</span></span></a><span class="mpre"> = do
  </span><a name="loc_451_3_451_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_451_3_451_9&#39;)"><span class="hl_vardecl"><span class="mpre">buffer</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Buffer.html#loc_247_1_247_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_247_1_247_14&#39;)"><span class="hl_varref"><span class="mpre">newCharBuffer</span></span></a><span class="mpre"> </span><a href="#loc_434_1_434_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_1_434_25&#39;)"><span class="hl_varref"><span class="mpre">dEFAULT_CHAR_BUFFER_SIZE</span></span></a><span class="mpre"> </span><a href="#loc_450_12_450_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_450_12_450_17&#39;)"><span class="hl_varref"><span class="mpre">state</span></span></a><span class="mpre">
              </span><span class="hl_comment"><span class="mpre">--  See [note Buffer Sizing], GHC.IO.Handle.Types</span></span><span class="mpre">
  </span><a name="loc_453_3_453_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_453_3_453_6&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_451_3_451_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_451_3_451_9&#39;)"><span class="hl_varref"><span class="mpre">buffer</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_453_3_453_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_453_3_453_6&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">, </span><a href="GHC.IO.Handle.Types.html#loc_247_4_247_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_247_4_247_15&#39;)"><span class="hl_conref"><span class="mpre">NoBuffering</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Flushing buffers</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | syncs the file with the buffer, including moving the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- file pointer backwards in the case of a read buffer.  This can fail</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- on a non-seekable read Handle.</span></span><span class="mpre">
</span><a href="#loc_463_1_463_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_1_463_12&#39;)"><span class="mpre">flushBuffer</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_463_1_463_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_1_463_12&#39;)"><span class="hl_fundecl"><span class="mpre">flushBuffer</span></span></a><span class="mpre"> </span><a name="loc_463_13_463_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_13_463_15&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 463, srcSpanStartColumn = 16, srcSpanEndLine = 463, srcSpanEndColumn = 28}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 463, srcSpanStartColumn = 24, srcSpanEndLine = 463, srcSpanEndColumn = 25},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{..}</span></span><span class="mpre"> = do
  </span><a name="loc_464_3_464_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_3_464_6&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre">
  case </span><a href="GHC.IO.Buffer.html#loc_183_9_183_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_183_9_183_17&#39;)"><span class="hl_varref"><span class="mpre">bufState</span></span></a><span class="mpre"> </span><a href="#loc_464_3_464_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_3_464_6&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> of
    </span><a href="GHC.IO.Buffer.html#loc_195_20_195_30" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_195_20_195_30&#39;)"><span class="hl_conref"><span class="mpre">ReadBuffer</span></span></a><span class="mpre">  -&gt; do
        </span><a href="#loc_543_1_543_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_1_543_20&#39;)"><span class="hl_varref"><span class="mpre">flushCharReadBuffer</span></span></a><span class="mpre"> </span><a href="#loc_463_13_463_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_13_463_15&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
        </span><a href="#loc_590_1_590_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_590_1_590_20&#39;)"><span class="hl_varref"><span class="mpre">flushByteReadBuffer</span></span></a><span class="mpre"> </span><a href="#loc_463_13_463_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_13_463_15&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
    </span><a href="GHC.IO.Buffer.html#loc_195_33_195_44" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_195_33_195_44&#39;)"><span class="hl_conref"><span class="mpre">WriteBuffer</span></span></a><span class="mpre"> -&gt; do
        </span><a href="#loc_495_1_495_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_495_1_495_21&#39;)"><span class="hl_varref"><span class="mpre">flushByteWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_463_13_463_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_13_463_15&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | flushes the Char buffer only.  Works on all Handles.</span></span><span class="mpre">
</span><a href="#loc_474_1_474_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_474_1_474_16&#39;)"><span class="mpre">flushCharBuffer</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_474_1_474_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_474_1_474_16&#39;)"><span class="hl_fundecl"><span class="mpre">flushCharBuffer</span></span></a><span class="mpre"> </span><a name="loc_474_17_474_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_474_17_474_19&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 474, srcSpanStartColumn = 20, srcSpanEndLine = 474, srcSpanEndColumn = 32}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 474, srcSpanStartColumn = 28, srcSpanEndLine = 474, srcSpanEndColumn = 29},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{..}</span></span><span class="mpre"> = do
  </span><a name="loc_475_3_475_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_3_475_7&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre">
  case </span><a href="GHC.IO.Buffer.html#loc_183_9_183_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_183_9_183_17&#39;)"><span class="hl_varref"><span class="mpre">bufState</span></span></a><span class="mpre"> </span><a href="#loc_475_3_475_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_3_475_7&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre"> of
    </span><a href="GHC.IO.Buffer.html#loc_195_20_195_30" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_195_20_195_30&#39;)"><span class="hl_conref"><span class="mpre">ReadBuffer</span></span></a><span class="mpre">  -&gt; do
        </span><a href="#loc_543_1_543_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_1_543_20&#39;)"><span class="hl_varref"><span class="mpre">flushCharReadBuffer</span></span></a><span class="mpre"> </span><a href="#loc_474_17_474_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_474_17_474_19&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
    </span><a href="GHC.IO.Buffer.html#loc_195_33_195_44" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_195_33_195_44&#39;)"><span class="hl_conref"><span class="mpre">WriteBuffer</span></span></a><span class="mpre"> -&gt;
        </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_475_3_475_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_3_475_7&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
           </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;internal IO library error: Char buffer non-empty&quot;</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Writing data (flushing write buffers)</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- flushWriteBuffer flushes the buffer iff it contains pending write</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- data.  Flushes both the Char and the byte buffer, leaving both</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- empty.</span></span><span class="mpre">
</span><a href="#loc_490_1_490_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_490_1_490_17&#39;)"><span class="mpre">flushWriteBuffer</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_490_1_490_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_490_1_490_17&#39;)"><span class="hl_fundecl"><span class="mpre">flushWriteBuffer</span></span></a><span class="mpre"> </span><a name="loc_490_18_490_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_490_18_490_20&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 490, srcSpanStartColumn = 21, srcSpanEndLine = 490, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 490, srcSpanStartColumn = 29, srcSpanEndLine = 490, srcSpanEndColumn = 30},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{..}</span></span><span class="mpre"> = do
  </span><a name="loc_491_3_491_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_491_3_491_6&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre">
  </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_218_1_218_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_218_1_218_14&#39;)"><span class="hl_varref"><span class="mpre">isWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_491_3_491_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_491_3_491_6&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_495_1_495_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_495_1_495_21&#39;)"><span class="hl_varref"><span class="mpre">flushByteWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_490_18_490_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_490_18_490_20&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">

</span><a href="#loc_495_1_495_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_495_1_495_21&#39;)"><span class="mpre">flushByteWriteBuffer</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_495_1_495_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_495_1_495_21&#39;)"><span class="hl_fundecl"><span class="mpre">flushByteWriteBuffer</span></span></a><span class="mpre"> </span><span class="hl_specname"><span class="mpre">h_</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 495, srcSpanStartColumn = 25, srcSpanEndLine = 495, srcSpanEndColumn = 37}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 495, srcSpanStartColumn = 33, srcSpanEndLine = 495, srcSpanEndColumn = 34},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{..}</span></span><span class="mpre"> = do
  </span><a name="loc_496_3_496_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_496_3_496_7&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre">
  </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_496_3_496_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_496_3_496_7&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a name="loc_498_5_498_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_498_5_498_10&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.BufferedIO.html#loc_69_3_69_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_69_3_69_19&#39;)"><span class="hl_varref"><span class="mpre">Buffered.flushWriteBuffer</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre"> </span><a href="#loc_496_3_496_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_496_3_496_7&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre">
    </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_498_5_498_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_498_5_498_10&#39;)"><span class="hl_varref"><span class="mpre">bbuf&#39;</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- write the contents of the CharBuffer to the Handle__.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The data will be encoded and pushed to the byte buffer,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- flushing if the buffer becomes full.</span></span><span class="mpre">
</span><a href="#loc_505_1_505_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_505_1_505_16&#39;)"><span class="mpre">writeCharBuffer</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_505_1_505_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_505_1_505_16&#39;)"><span class="hl_fundecl"><span class="mpre">writeCharBuffer</span></span></a><span class="mpre"> </span><a name="loc_505_17_505_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_505_17_505_19&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 505, srcSpanStartColumn = 20, srcSpanEndLine = 505, srcSpanEndColumn = 32}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 505, srcSpanStartColumn = 28, srcSpanEndLine = 505, srcSpanEndColumn = 29},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{..}</span></span><span class="mpre"> !</span><a name="loc_505_34_505_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_505_34_505_38&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf</span></span></a><span class="mpre"> = do
  </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
  </span><a name="loc_507_3_507_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_507_3_507_7&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre">

  </span><a href="#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;writeCharBuffer: cbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_505_34_505_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_505_34_505_38&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">
        </span><span class="hl_string"><span class="mpre">&quot; bbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_507_3_507_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_507_3_507_7&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre">)

  (</span><a name="loc_512_4_512_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_4_512_9&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre">,</span><a name="loc_512_10_512_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_10_512_15&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf&#39;</span></span></a><span class="mpre">) &lt;- case </span><a href="GHC.IO.Handle.Types.html#loc_134_7_134_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_134_7_134_16&#39;)"><span class="hl_varref"><span class="mpre">haEncoder</span></span></a><span class="mpre"> of
    </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">      -&gt; </span><a href="GHC.IO.Encoding.html#loc_255_1_255_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.html#loc_255_1_255_14&#39;)"><span class="hl_varref"><span class="mpre">latin1_encode</span></span></a><span class="mpre"> </span><a href="#loc_505_34_505_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_505_34_505_38&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre"> </span><a href="#loc_507_3_507_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_507_3_507_7&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre">
    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_514_10_514_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_514_10_514_17&#39;)"><span class="hl_vardecl"><span class="mpre">encoder</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_372_1_372_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_1_372_13&#39;)"><span class="hl_varref"><span class="mpre">streamEncode</span></span></a><span class="mpre"> </span><a href="#loc_514_10_514_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_514_10_514_17&#39;)"><span class="hl_varref"><span class="mpre">encoder</span></span></a><span class="mpre">) </span><a href="#loc_505_34_505_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_505_34_505_38&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre"> </span><a href="#loc_507_3_507_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_507_3_507_7&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre">

  </span><a href="#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;writeCharBuffer after encoding: cbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_512_4_512_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_4_512_9&#39;)"><span class="hl_varref"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">
        </span><span class="hl_string"><span class="mpre">&quot; bbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_512_10_512_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_10_512_15&#39;)"><span class="hl_varref"><span class="mpre">bbuf&#39;</span></span></a><span class="mpre">)

          </span><span class="hl_comment"><span class="mpre">-- flush if the write buffer is full</span></span><span class="mpre">
  if </span><a href="GHC.IO.Buffer.html#loc_207_1_207_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_207_1_207_13&#39;)"><span class="hl_varref"><span class="mpre">isFullBuffer</span></span></a><span class="mpre"> </span><a href="#loc_512_10_512_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_10_512_15&#39;)"><span class="hl_varref"><span class="mpre">bbuf&#39;</span></span></a><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">--  or we made no progress</span></span><span class="mpre">
     </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_512_4_512_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_4_512_9&#39;)"><span class="hl_varref"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_185_9_185_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_185_9_185_13&#39;)"><span class="hl_varref"><span class="mpre">bufL</span></span></a><span class="mpre"> </span><a href="#loc_512_4_512_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_4_512_9&#39;)"><span class="hl_varref"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_185_9_185_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_185_9_185_13&#39;)"><span class="hl_varref"><span class="mpre">bufL</span></span></a><span class="mpre"> </span><a href="#loc_505_34_505_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_505_34_505_38&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- or the byte buffer has more elements than the user wanted buffered</span></span><span class="mpre">
     </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> (case </span><a href="GHC.IO.Handle.Types.html#loc_130_7_130_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_130_7_130_19&#39;)"><span class="hl_varref"><span class="mpre">haBufferMode</span></span></a><span class="mpre"> of
          </span><a href="GHC.IO.Handle.Types.html#loc_250_4_250_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_250_4_250_18&#39;)"><span class="hl_conref"><span class="mpre">BlockBuffering</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_525_32_525_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_525_32_525_33&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">) -&gt; </span><a href="GHC.IO.Buffer.html#loc_223_1_223_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_223_1_223_12&#39;)"><span class="hl_varref"><span class="mpre">bufferElems</span></span></a><span class="mpre"> </span><a href="#loc_512_10_512_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_10_512_15&#39;)"><span class="hl_varref"><span class="mpre">bbuf&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="#loc_525_32_525_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_525_32_525_33&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
          </span><a href="GHC.IO.Handle.Types.html#loc_247_4_247_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_247_4_247_15&#39;)"><span class="hl_conref"><span class="mpre">NoBuffering</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
          </span><span class="hl_vardecl"><span class="mpre">_other</span></span><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">)
    then do
      </span><a name="loc_529_7_529_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_529_7_529_13&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf&#39;&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.BufferedIO.html#loc_69_3_69_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_69_3_69_19&#39;)"><span class="hl_varref"><span class="mpre">Buffered.flushWriteBuffer</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre"> </span><a href="#loc_512_10_512_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_10_512_15&#39;)"><span class="hl_varref"><span class="mpre">bbuf&#39;</span></span></a><span class="mpre">
      </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_529_7_529_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_529_7_529_13&#39;)"><span class="hl_varref"><span class="mpre">bbuf&#39;&#39;</span></span></a><span class="mpre">
    else
      </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_512_10_512_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_10_512_15&#39;)"><span class="hl_varref"><span class="mpre">bbuf&#39;</span></span></a><span class="mpre">

  if </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_512_4_512_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_4_512_9&#39;)"><span class="hl_varref"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre">)
     then </span><a href="#loc_505_1_505_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_505_1_505_16&#39;)"><span class="hl_varref"><span class="mpre">writeCharBuffer</span></span></a><span class="mpre"> </span><a href="#loc_505_17_505_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_505_17_505_19&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_512_4_512_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_4_512_9&#39;)"><span class="hl_varref"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre">
     else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Flushing read buffers</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- It is always possible to flush the Char buffer back to the byte buffer.</span></span><span class="mpre">
</span><a href="#loc_543_1_543_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_1_543_20&#39;)"><span class="mpre">flushCharReadBuffer</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_543_1_543_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_1_543_20&#39;)"><span class="hl_fundecl"><span class="mpre">flushCharReadBuffer</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 543, srcSpanStartColumn = 21, srcSpanEndLine = 543, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 543, srcSpanStartColumn = 29, srcSpanEndLine = 543, srcSpanEndColumn = 30},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{..}</span></span><span class="mpre"> = do
  </span><a name="loc_544_3_544_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_3_544_7&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre">
  if </span><a href="GHC.IO.Buffer.html#loc_218_1_218_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_218_1_218_14&#39;)"><span class="hl_varref"><span class="mpre">isWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_544_3_544_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_3_544_7&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_544_3_544_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_3_544_7&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre"> then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> else do

  </span><span class="hl_comment"><span class="mpre">-- haLastDecode is the byte buffer just before we did our last batch of</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- decoding.  We&#39;re going to re-decode the bytes up to the current char,</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- to find out where we should revert the byte buffer to.</span></span><span class="mpre">
  (</span><a name="loc_550_4_550_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_4_550_15&#39;)"><span class="hl_vardecl"><span class="mpre">codec_state</span></span></a><span class="mpre">, </span><a name="loc_550_17_550_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_17_550_22&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf0</span></span></a><span class="mpre">) &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_131_7_131_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_131_7_131_19&#39;)"><span class="hl_varref"><span class="mpre">haLastDecode</span></span></a><span class="mpre">

  </span><a name="loc_552_3_552_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_552_3_552_8&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf0</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre">
  </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 553, srcSpanStartColumn = 27, srcSpanEndLine = 553, srcSpanEndColumn = 50}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 553, srcSpanStartColumn = 32, srcSpanEndLine = 553, srcSpanEndColumn = 33},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;"><span class="mpre">cbuf0{ bufL=0, bufR=0 }</span></span><span class="mpre">

  </span><span class="hl_comment"><span class="mpre">-- if we haven&#39;t used any characters from the char buffer, then just</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- re-install the old byte buffer.</span></span><span class="mpre">
  if </span><a href="GHC.IO.Buffer.html#loc_185_9_185_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_185_9_185_13&#39;)"><span class="hl_varref"><span class="mpre">bufL</span></span></a><span class="mpre"> </span><a href="#loc_552_3_552_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_552_3_552_8&#39;)"><span class="hl_varref"><span class="mpre">cbuf0</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
     then do </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_550_17_550_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_17_550_22&#39;)"><span class="hl_varref"><span class="mpre">bbuf0</span></span></a><span class="mpre">
             </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
     else do

  case </span><a href="GHC.IO.Handle.Types.html#loc_135_7_135_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_135_7_135_16&#39;)"><span class="hl_varref"><span class="mpre">haDecoder</span></span></a><span class="mpre"> of
    </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; do
      </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 564, srcSpanStartColumn = 31, srcSpanEndLine = 564, srcSpanEndColumn = 71}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 564, srcSpanStartColumn = 37, srcSpanEndLine = 564, srcSpanEndColumn = 38},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;"><span class="mpre">bbuf0 { bufL = bufL bbuf0 + bufL cbuf0 }</span></span><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">-- no decoder: the number of bytes to decode is the same as the</span></span><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">-- number of chars we have used up.</span></span><span class="mpre">

    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_568_10_568_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_568_10_568_17&#39;)"><span class="hl_vardecl"><span class="mpre">decoder</span></span></a><span class="mpre"> -&gt; do
      </span><a href="#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;flushCharReadBuffer re-decode, bbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_550_17_550_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_17_550_22&#39;)"><span class="hl_varref"><span class="mpre">bbuf0</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">
               </span><span class="hl_string"><span class="mpre">&quot; cbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_552_3_552_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_552_3_552_8&#39;)"><span class="hl_varref"><span class="mpre">cbuf0</span></span></a><span class="mpre">)

      </span><span class="hl_comment"><span class="mpre">-- restore the codec state</span></span><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">setState</span></span><span class="mpre"> </span><a href="#loc_568_10_568_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_568_10_568_17&#39;)"><span class="hl_varref"><span class="mpre">decoder</span></span></a><span class="mpre"> </span><a href="#loc_550_4_550_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_4_550_15&#39;)"><span class="hl_varref"><span class="mpre">codec_state</span></span></a><span class="mpre">
    
      (</span><a name="loc_575_8_575_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_575_8_575_13&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf1</span></span></a><span class="mpre">,</span><a name="loc_575_14_575_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_575_14_575_19&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf1</span></span></a><span class="mpre">) &lt;- (</span><a href="#loc_372_1_372_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_1_372_13&#39;)"><span class="hl_varref"><span class="mpre">streamEncode</span></span></a><span class="mpre"> </span><a href="#loc_568_10_568_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_568_10_568_17&#39;)"><span class="hl_varref"><span class="mpre">decoder</span></span></a><span class="mpre">) </span><a href="#loc_550_17_550_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_17_550_22&#39;)"><span class="hl_varref"><span class="mpre">bbuf0</span></span></a><span class="mpre">
                               </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 576, srcSpanStartColumn = 32, srcSpanEndLine = 576, srcSpanEndColumn = 77}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 576, srcSpanStartColumn = 37, srcSpanEndLine = 576, srcSpanEndColumn = 38},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;"><span class="mpre">cbuf0{ bufL=0, bufR=0, bufSize = bufL cbuf0 }</span></span><span class="mpre">
    
      </span><a href="#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;finished, bbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_575_8_575_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_575_8_575_13&#39;)"><span class="hl_varref"><span class="mpre">bbuf1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">
               </span><span class="hl_string"><span class="mpre">&quot; cbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_575_14_575_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_575_14_575_19&#39;)"><span class="hl_varref"><span class="mpre">cbuf1</span></span></a><span class="mpre">)

      </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_575_8_575_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_575_8_575_13&#39;)"><span class="hl_varref"><span class="mpre">bbuf1</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- When flushing the byte read buffer, we seek backwards by the number</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- of characters in the buffer.  The file descriptor must therefore be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- seekable: attempting to flush the read buffer on an unseekable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- handle is not allowed.</span></span><span class="mpre">

</span><a href="#loc_590_1_590_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_590_1_590_20&#39;)"><span class="mpre">flushByteReadBuffer</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_590_1_590_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_590_1_590_20&#39;)"><span class="hl_fundecl"><span class="mpre">flushByteReadBuffer</span></span></a><span class="mpre"> </span><span class="hl_specname"><span class="mpre">h_</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 590, srcSpanStartColumn = 24, srcSpanEndLine = 590, srcSpanEndColumn = 36}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 590, srcSpanStartColumn = 32, srcSpanEndLine = 590, srcSpanEndColumn = 33},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{..}</span></span><span class="mpre"> = do
  </span><a name="loc_591_3_591_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_591_3_591_7&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre">

  if </span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_591_3_591_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_591_3_591_7&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre"> then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> else do

  </span><a name="loc_595_3_595_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_3_595_11&#39;)"><span class="hl_vardecl"><span class="mpre">seekable</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Device.html#loc_78_3_78_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_78_3_78_13&#39;)"><span class="hl_varref"><span class="mpre">IODevice.isSeekable</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre">
  </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><a href="#loc_595_3_595_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_3_595_11&#39;)"><span class="hl_varref"><span class="mpre">seekable</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_338_1_338_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_1_338_27&#39;)"><span class="hl_varref"><span class="mpre">ioe_cannotFlushNotSeekable</span></span></a><span class="mpre">

  let </span><a name="loc_598_7_598_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_598_7_598_11&#39;)"><span class="hl_vardecl"><span class="mpre">seek</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">negate</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_186_9_186_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_186_9_186_13&#39;)"><span class="hl_varref"><span class="mpre">bufR</span></span></a><span class="mpre"> </span><a href="#loc_591_3_591_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_591_3_591_7&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_185_9_185_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_185_9_185_13&#39;)"><span class="hl_varref"><span class="mpre">bufL</span></span></a><span class="mpre"> </span><a href="#loc_591_3_591_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_591_3_591_7&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre">)

  </span><a href="#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;flushByteReadBuffer: new file offset = &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_598_7_598_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_598_7_598_11&#39;)"><span class="hl_varref"><span class="mpre">seek</span></span></a><span class="mpre">)
  </span><a href="GHC.IO.Device.html#loc_82_3_82_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_82_3_82_7&#39;)"><span class="hl_varref"><span class="mpre">IODevice.seek</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre"> </span><a href="GHC.IO.Device.html#loc_166_5_166_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_166_5_166_17&#39;)"><span class="hl_conref"><span class="mpre">RelativeSeek</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_598_7_598_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_598_7_598_11&#39;)"><span class="hl_varref"><span class="mpre">seek</span></span></a><span class="mpre">)

  </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 603, srcSpanStartColumn = 27, srcSpanEndLine = 603, srcSpanEndColumn = 49}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 603, srcSpanStartColumn = 31, srcSpanEndLine = 603, srcSpanEndColumn = 32},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;"><span class="mpre">bbuf{ bufL=0, bufR=0 }</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Making Handles</span></span><span class="mpre">

</span><a href="#loc_618_1_618_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_1_618_9&#39;)"><span class="mpre">mkHandle</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxTuple (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 608, srcSpanStartColumn = 13, srcSpanEndLine = 608, srcSpanEndColumn = 60}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 608, srcSpanStartColumn = 13, srcSpanEndLine = 608, srcSpanEndColumn = 14},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, "><span class="mpre">(IODevice dev, BufferedIO dev, Typeable dev) =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">dev</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre">
            -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_154_6_154_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_154_6_154_16&#39;)"><span class="hl_tyconref"><span class="mpre">HandleType</span></span></a><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">                     </span><span class="hl_comment"><span class="mpre">-- buffered?</span></span><span class="mpre">
            -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><a href="GHC.IO.Encoding.Types.html#loc_107_6_107_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.Types.html#loc_107_6_107_18&#39;)"><span class="hl_tyconref"><span class="mpre">TextEncoding</span></span></a><span class="mpre">
            -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_363_6_363_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_363_6_363_17&#39;)"><span class="hl_tyconref"><span class="mpre">NewlineMode</span></span></a><span class="mpre">
            -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HandleFinalizer</span></span><span class="mpre">
            -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> (</span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre">)
            -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre">

</span><a name="loc_618_1_618_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_1_618_9&#39;)"><span class="hl_fundecl"><span class="mpre">mkHandle</span></span></a><span class="mpre"> </span><a name="loc_618_10_618_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_10_618_13&#39;)"><span class="hl_vardecl"><span class="mpre">dev</span></span></a><span class="mpre"> </span><a name="loc_618_14_618_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_14_618_22&#39;)"><span class="hl_vardecl"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a name="loc_618_23_618_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_23_618_30&#39;)"><span class="hl_vardecl"><span class="mpre">ha_type</span></span></a><span class="mpre"> </span><a name="loc_618_31_618_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_31_618_39&#39;)"><span class="hl_vardecl"><span class="mpre">buffered</span></span></a><span class="mpre"> </span><a name="loc_618_40_618_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_40_618_48&#39;)"><span class="hl_vardecl"><span class="mpre">mb_codec</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">nl</span></span><span class="mpre"> </span><a name="loc_618_52_618_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_52_618_61&#39;)"><span class="hl_vardecl"><span class="mpre">finalizer</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">other_side</span></span><span class="mpre"> = do
   </span><a href="#loc_703_1_703_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_703_1_703_17&#39;)"><span class="hl_varref"><span class="mpre">openTextEncoding</span></span></a><span class="mpre"> </span><a href="#loc_618_40_618_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_40_618_48&#39;)"><span class="hl_varref"><span class="mpre">mb_codec</span></span></a><span class="mpre"> </span><a href="#loc_618_23_618_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_23_618_30&#39;)"><span class="hl_varref"><span class="mpre">ha_type</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><span class="hl_vardecl"><span class="mpre">mb_encoder</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">mb_decoder</span></span><span class="mpre"> -&gt; do

   let </span><a name="loc_621_8_621_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_621_8_621_17&#39;)"><span class="hl_vardecl"><span class="mpre">buf_state</span></span></a><span class="mpre"> = </span><a href="#loc_694_1_694_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_694_1_694_16&#39;)"><span class="hl_varref"><span class="mpre">initBufferState</span></span></a><span class="mpre"> </span><a href="#loc_618_23_618_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_23_618_30&#39;)"><span class="hl_varref"><span class="mpre">ha_type</span></span></a><span class="mpre">
   </span><a name="loc_622_4_622_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_622_4_622_8&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.BufferedIO.html#loc_43_3_43_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_43_3_43_12&#39;)"><span class="hl_varref"><span class="mpre">Buffered.newBuffer</span></span></a><span class="mpre"> </span><a href="#loc_618_10_618_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_10_618_13&#39;)"><span class="hl_varref"><span class="mpre">dev</span></span></a><span class="mpre"> </span><a href="#loc_621_8_621_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_621_8_621_17&#39;)"><span class="hl_varref"><span class="mpre">buf_state</span></span></a><span class="mpre">
   </span><span class="hl_vardecl"><span class="mpre">bbufref</span></span><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_622_4_622_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_622_4_622_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre">
   </span><span class="hl_vardecl"><span class="mpre">last_decode</span></span><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;codec_state&quot;</span></span><span class="mpre">, </span><a href="#loc_622_4_622_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_622_4_622_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre">)

   (</span><span class="hl_vardecl"><span class="mpre">cbufref</span></span><span class="mpre">,</span><span class="hl_vardecl"><span class="mpre">bmode</span></span><span class="mpre">) &lt;- 
         if </span><a href="#loc_618_31_618_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_31_618_39&#39;)"><span class="hl_varref"><span class="mpre">buffered</span></span></a><span class="mpre"> then </span><a href="#loc_438_1_438_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_438_1_438_14&#39;)"><span class="hl_varref"><span class="mpre">getCharBuffer</span></span></a><span class="mpre"> </span><a href="#loc_618_10_618_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_10_618_13&#39;)"><span class="hl_varref"><span class="mpre">dev</span></span></a><span class="mpre"> </span><a href="#loc_621_8_621_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_621_8_621_17&#39;)"><span class="hl_varref"><span class="mpre">buf_state</span></span></a><span class="mpre">
                     else </span><a href="#loc_450_1_450_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_450_1_450_11&#39;)"><span class="hl_varref"><span class="mpre">mkUnBuffer</span></span></a><span class="mpre"> </span><a href="#loc_621_8_621_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_621_8_621_17&#39;)"><span class="hl_varref"><span class="mpre">buf_state</span></span></a><span class="mpre">

   </span><span class="hl_vardecl"><span class="mpre">spares</span></span><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_148_5_148_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_148_5_148_18&#39;)"><span class="hl_conref"><span class="mpre">BufferListNil</span></span></a><span class="mpre">
   </span><a href="#loc_92_1_92_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_14&#39;)"><span class="hl_varref"><span class="mpre">newFileHandle</span></span></a><span class="mpre"> </span><a href="#loc_618_14_618_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_14_618_22&#39;)"><span class="hl_varref"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a href="#loc_618_52_618_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_52_618_61&#39;)"><span class="hl_varref"><span class="mpre">finalizer</span></span></a><span class="mpre">
            (</span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 632, srcSpanStartColumn = 14, srcSpanEndLine = 645, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 632, srcSpanStartColumn = 23, srcSpanEndLine = 632, srcSpanEndColumn = 24},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;"><span class="mpre">Handle__ { haDevice = dev,
                        haType = ha_type,
                        haBufferMode = bmode,
                        haByteBuffer = bbufref,
                        haLastDecode = last_decode,
                        haCharBuffer = cbufref,
                        haBuffers = spares,
                        haEncoder = mb_encoder,
                        haDecoder = mb_decoder,
                        haCodec = mb_codec,
                        haInputNL = inputNL nl,
                        haOutputNL = outputNL nl,
                        haOtherSide = other_side
                      }</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | makes a new &#39;Handle&#39;</span></span><span class="mpre">
</span><a href="#loc_661_1_661_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_1_661_13&#39;)"><span class="mpre">mkFileHandle</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxTuple (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 648, srcSpanStartColumn = 17, srcSpanEndLine = 649, srcSpanEndColumn = 16}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 648, srcSpanStartColumn = 17, srcSpanEndLine = 648, srcSpanEndColumn = 18},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, "><span class="mpre">(IODevice dev, BufferedIO dev, Typeable dev)
             =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">dev</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ the underlying IO device, which must support </span></span><span class="mpre">
                    </span><span class="hl_comment"><span class="mpre">-- &#39;IODevice&#39;, &#39;BufferedIO&#39; and &#39;Typeable&#39;</span></span><span class="mpre">
             -&gt; </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre">
                    </span><span class="hl_comment"><span class="mpre">-- ^ a string describing the &#39;Handle&#39;, e.g. the file</span></span><span class="mpre">
                    </span><span class="hl_comment"><span class="mpre">-- path for a file.  Used in error messages.</span></span><span class="mpre">
             -&gt; </span><a href="GHC.IO.IOMode.html#loc_28_6_28_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.IOMode.html#loc_28_6_28_12&#39;)"><span class="hl_tyconref"><span class="mpre">IOMode</span></span></a><span class="mpre">
                    </span><span class="hl_comment"><span class="mpre">-- The mode in which the &#39;Handle&#39; is to be used</span></span><span class="mpre">
             -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><a href="GHC.IO.Encoding.Types.html#loc_107_6_107_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.Types.html#loc_107_6_107_18&#39;)"><span class="hl_tyconref"><span class="mpre">TextEncoding</span></span></a><span class="mpre">
                    </span><span class="hl_comment"><span class="mpre">-- Create the &#39;Handle&#39; with no text encoding?</span></span><span class="mpre">
             -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_363_6_363_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_363_6_363_17&#39;)"><span class="hl_tyconref"><span class="mpre">NewlineMode</span></span></a><span class="mpre">
                    </span><span class="hl_comment"><span class="mpre">-- Translate newlines?</span></span><span class="mpre">
             -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre">
</span><a name="loc_661_1_661_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_1_661_13&#39;)"><span class="hl_fundecl"><span class="mpre">mkFileHandle</span></span></a><span class="mpre"> </span><a name="loc_661_14_661_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_14_661_17&#39;)"><span class="hl_vardecl"><span class="mpre">dev</span></span></a><span class="mpre"> </span><a name="loc_661_18_661_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_18_661_26&#39;)"><span class="hl_vardecl"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a name="loc_661_27_661_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_27_661_33&#39;)"><span class="hl_vardecl"><span class="mpre">iomode</span></span></a><span class="mpre"> </span><a name="loc_661_34_661_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_34_661_42&#39;)"><span class="hl_vardecl"><span class="mpre">mb_codec</span></span></a><span class="mpre"> </span><a name="loc_661_43_661_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_43_661_54&#39;)"><span class="hl_vardecl"><span class="mpre">tr_newlines</span></span></a><span class="mpre"> = do
   </span><a href="#loc_618_1_618_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_1_618_9&#39;)"><span class="hl_varref"><span class="mpre">mkHandle</span></span></a><span class="mpre"> </span><a href="#loc_661_14_661_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_14_661_17&#39;)"><span class="hl_varref"><span class="mpre">dev</span></span></a><span class="mpre"> </span><a href="#loc_661_18_661_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_18_661_26&#39;)"><span class="hl_varref"><span class="mpre">filepath</span></span></a><span class="mpre"> (</span><a href="#loc_688_1_688_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_688_1_688_19&#39;)"><span class="hl_varref"><span class="mpre">ioModeToHandleType</span></span></a><span class="mpre"> </span><a href="#loc_661_27_661_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_27_661_33&#39;)"><span class="hl_varref"><span class="mpre">iomode</span></span></a><span class="mpre">) </span><span class="hl_conref"><span class="mpre">True</span></span><span class="hl_comment"><span class="mpre">{-buffered-}</span></span><span class="mpre"> </span><a href="#loc_661_34_661_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_34_661_42&#39;)"><span class="hl_varref"><span class="mpre">mb_codec</span></span></a><span class="mpre">
            </span><a href="#loc_661_43_661_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_43_661_54&#39;)"><span class="hl_varref"><span class="mpre">tr_newlines</span></span></a><span class="mpre">
            (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_422_1_422_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_1_422_16&#39;)"><span class="hl_varref"><span class="mpre">handleFinalizer</span></span></a><span class="mpre">) </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="hl_comment"><span class="mpre">{-other_side-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | like &#39;mkFileHandle&#39;, except that a &#39;Handle&#39; is created with two</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- independent buffers, one for reading and one for writing.  Used for</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- full-duplex streams, such as network sockets.</span></span><span class="mpre">
</span><a href="#loc_671_1_671_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_1_671_15&#39;)"><span class="mpre">mkDuplexHandle</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxTuple (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 669, srcSpanStartColumn = 19, srcSpanEndLine = 669, srcSpanEndColumn = 66}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 669, srcSpanStartColumn = 19, srcSpanEndLine = 669, srcSpanEndColumn = 20},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, "><span class="mpre">(IODevice dev, BufferedIO dev, Typeable dev) =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">dev</span></span><span class="mpre">
               -&gt; </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><a href="GHC.IO.Encoding.Types.html#loc_107_6_107_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.Types.html#loc_107_6_107_18&#39;)"><span class="hl_tyconref"><span class="mpre">TextEncoding</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_363_6_363_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_363_6_363_17&#39;)"><span class="hl_tyconref"><span class="mpre">NewlineMode</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre">
</span><a name="loc_671_1_671_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_1_671_15&#39;)"><span class="hl_fundecl"><span class="mpre">mkDuplexHandle</span></span></a><span class="mpre"> </span><a name="loc_671_16_671_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_16_671_19&#39;)"><span class="hl_vardecl"><span class="mpre">dev</span></span></a><span class="mpre"> </span><a name="loc_671_20_671_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_20_671_28&#39;)"><span class="hl_vardecl"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a name="loc_671_29_671_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_29_671_37&#39;)"><span class="hl_vardecl"><span class="mpre">mb_codec</span></span></a><span class="mpre"> </span><a name="loc_671_38_671_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_38_671_49&#39;)"><span class="hl_vardecl"><span class="mpre">tr_newlines</span></span></a><span class="mpre"> = do

  </span><span class="hl_specname"><span class="mpre">write_side</span></span><span class="mpre">@(</span><a href="GHC.IO.Handle.Types.html#loc_101_5_101_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_101_5_101_15&#39;)"><span class="hl_conref"><span class="mpre">FileHandle</span></span></a><span class="mpre"> _ </span><a name="loc_673_28_673_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_673_28_673_35&#39;)"><span class="hl_vardecl"><span class="mpre">write_m</span></span></a><span class="mpre">) &lt;- 
       </span><a href="#loc_618_1_618_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_1_618_9&#39;)"><span class="hl_varref"><span class="mpre">mkHandle</span></span></a><span class="mpre"> </span><a href="#loc_671_16_671_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_16_671_19&#39;)"><span class="hl_varref"><span class="mpre">dev</span></span></a><span class="mpre"> </span><a href="#loc_671_20_671_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_20_671_28&#39;)"><span class="hl_varref"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_158_4_158_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_158_4_158_15&#39;)"><span class="hl_conref"><span class="mpre">WriteHandle</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> </span><a href="#loc_671_29_671_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_29_671_37&#39;)"><span class="hl_varref"><span class="mpre">mb_codec</span></span></a><span class="mpre">
                        </span><a href="#loc_671_38_671_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_38_671_49&#39;)"><span class="hl_varref"><span class="mpre">tr_newlines</span></span></a><span class="mpre">
                        (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_422_1_422_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_1_422_16&#39;)"><span class="hl_varref"><span class="mpre">handleFinalizer</span></span></a><span class="mpre">)
                        </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- no othersie</span></span><span class="mpre">

  </span><span class="hl_specname"><span class="mpre">read_side</span></span><span class="mpre">@(</span><a href="GHC.IO.Handle.Types.html#loc_101_5_101_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_101_5_101_15&#39;)"><span class="hl_conref"><span class="mpre">FileHandle</span></span></a><span class="mpre"> _ </span><a name="loc_679_27_679_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_679_27_679_33&#39;)"><span class="hl_vardecl"><span class="mpre">read_m</span></span></a><span class="mpre">) &lt;- 
      </span><a href="#loc_618_1_618_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_618_1_618_9&#39;)"><span class="hl_varref"><span class="mpre">mkHandle</span></span></a><span class="mpre"> </span><a href="#loc_671_16_671_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_16_671_19&#39;)"><span class="hl_varref"><span class="mpre">dev</span></span></a><span class="mpre"> </span><a href="#loc_671_20_671_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_20_671_28&#39;)"><span class="hl_varref"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_157_4_157_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_157_4_157_14&#39;)"><span class="hl_conref"><span class="mpre">ReadHandle</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> </span><a href="#loc_671_29_671_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_29_671_37&#39;)"><span class="hl_varref"><span class="mpre">mb_codec</span></span></a><span class="mpre">
                        </span><a href="#loc_671_38_671_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_38_671_49&#39;)"><span class="hl_varref"><span class="mpre">tr_newlines</span></span></a><span class="mpre">
                        </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- no finalizer</span></span><span class="mpre">
                        (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_673_28_673_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_673_28_673_35&#39;)"><span class="hl_varref"><span class="mpre">write_m</span></span></a><span class="mpre">)

  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="GHC.IO.Handle.Types.html#loc_106_5_106_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_106_5_106_17&#39;)"><span class="hl_conref"><span class="mpre">DuplexHandle</span></span></a><span class="mpre"> </span><a href="#loc_671_20_671_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_20_671_28&#39;)"><span class="hl_varref"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a href="#loc_679_27_679_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_679_27_679_33&#39;)"><span class="hl_varref"><span class="mpre">read_m</span></span></a><span class="mpre"> </span><a href="#loc_673_28_673_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_673_28_673_35&#39;)"><span class="hl_varref"><span class="mpre">write_m</span></span></a><span class="mpre">)

</span><a href="#loc_688_1_688_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_688_1_688_19&#39;)"><span class="mpre">ioModeToHandleType</span></a><span class="mpre"> :: </span><a href="GHC.IO.IOMode.html#loc_28_6_28_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.IOMode.html#loc_28_6_28_12&#39;)"><span class="hl_tyconref"><span class="mpre">IOMode</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_154_6_154_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_154_6_154_16&#39;)"><span class="hl_tyconref"><span class="mpre">HandleType</span></span></a><span class="mpre">
</span><a name="loc_688_1_688_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_688_1_688_19&#39;)"><span class="hl_fundecl"><span class="mpre">ioModeToHandleType</span></span></a><span class="mpre"> </span><a href="GHC.IO.IOMode.html#loc_28_21_28_29" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.IOMode.html#loc_28_21_28_29&#39;)"><span class="hl_conref"><span class="mpre">ReadMode</span></span></a><span class="mpre">      = </span><a href="GHC.IO.Handle.Types.html#loc_157_4_157_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_157_4_157_14&#39;)"><span class="hl_conref"><span class="mpre">ReadHandle</span></span></a><span class="mpre">
</span><a href="#loc_688_1_688_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_688_1_688_19&#39;)"><span class="hl_fundecl"><span class="mpre">ioModeToHandleType</span></span></a><span class="mpre"> </span><a href="GHC.IO.IOMode.html#loc_28_32_28_41" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.IOMode.html#loc_28_32_28_41&#39;)"><span class="hl_conref"><span class="mpre">WriteMode</span></span></a><span class="mpre">     = </span><a href="GHC.IO.Handle.Types.html#loc_158_4_158_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_158_4_158_15&#39;)"><span class="hl_conref"><span class="mpre">WriteHandle</span></span></a><span class="mpre">
</span><a href="#loc_688_1_688_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_688_1_688_19&#39;)"><span class="hl_fundecl"><span class="mpre">ioModeToHandleType</span></span></a><span class="mpre"> </span><a href="GHC.IO.IOMode.html#loc_28_57_28_70" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.IOMode.html#loc_28_57_28_70&#39;)"><span class="hl_conref"><span class="mpre">ReadWriteMode</span></span></a><span class="mpre"> = </span><a href="GHC.IO.Handle.Types.html#loc_160_4_160_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_160_4_160_19&#39;)"><span class="hl_conref"><span class="mpre">ReadWriteHandle</span></span></a><span class="mpre">
</span><a href="#loc_688_1_688_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_688_1_688_19&#39;)"><span class="hl_fundecl"><span class="mpre">ioModeToHandleType</span></span></a><span class="mpre"> </span><a href="GHC.IO.IOMode.html#loc_28_44_28_54" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.IOMode.html#loc_28_44_28_54&#39;)"><span class="hl_conref"><span class="mpre">AppendMode</span></span></a><span class="mpre">    = </span><a href="GHC.IO.Handle.Types.html#loc_159_4_159_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_159_4_159_16&#39;)"><span class="hl_conref"><span class="mpre">AppendHandle</span></span></a><span class="mpre">

</span><a href="#loc_694_1_694_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_694_1_694_16&#39;)"><span class="mpre">initBufferState</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_154_6_154_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_154_6_154_16&#39;)"><span class="hl_tyconref"><span class="mpre">HandleType</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.IO.Buffer.html#loc_195_6_195_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_195_6_195_17&#39;)"><span class="hl_tyconref"><span class="mpre">BufferState</span></span></a><span class="mpre">
</span><a name="loc_694_1_694_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_694_1_694_16&#39;)"><span class="hl_fundecl"><span class="mpre">initBufferState</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_157_4_157_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_157_4_157_14&#39;)"><span class="hl_conref"><span class="mpre">ReadHandle</span></span></a><span class="mpre"> = </span><a href="GHC.IO.Buffer.html#loc_195_20_195_30" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_195_20_195_30&#39;)"><span class="hl_conref"><span class="mpre">ReadBuffer</span></span></a><span class="mpre">
</span><a href="#loc_694_1_694_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_694_1_694_16&#39;)"><span class="hl_fundecl"><span class="mpre">initBufferState</span></span></a><span class="mpre"> _          = </span><a href="GHC.IO.Buffer.html#loc_195_33_195_44" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_195_33_195_44&#39;)"><span class="hl_conref"><span class="mpre">WriteBuffer</span></span></a><span class="mpre">

</span><a href="#loc_703_1_703_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_703_1_703_17&#39;)"><span class="mpre">openTextEncoding</span></a><span class="mpre">
   :: </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><a href="GHC.IO.Encoding.Types.html#loc_107_6_107_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.Types.html#loc_107_6_107_18&#39;)"><span class="hl_tyconref"><span class="mpre">TextEncoding</span></span></a><span class="mpre">
   -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_154_6_154_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_154_6_154_16&#39;)"><span class="hl_tyconref"><span class="mpre">HandleType</span></span></a><span class="mpre">
   -&gt; (forall </span><span class="hl_tyvar"><span class="mpre">es</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ds</span></span><span class="mpre"> . </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">TextEncoder</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">es</span></span><span class="mpre">) -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">TextDecoder</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ds</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
   -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">

</span><a name="loc_703_1_703_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_703_1_703_17&#39;)"><span class="hl_fundecl"><span class="mpre">openTextEncoding</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">   </span><span class="hl_vardecl"><span class="mpre">ha_type</span></span><span class="mpre"> </span><a name="loc_703_36_703_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_703_36_703_40&#39;)"><span class="hl_vardecl"><span class="mpre">cont</span></span></a><span class="mpre"> = </span><a href="#loc_703_36_703_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_703_36_703_40&#39;)"><span class="hl_varref"><span class="mpre">cont</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
</span><a href="#loc_703_1_703_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_703_1_703_17&#39;)"><span class="hl_fundecl"><span class="mpre">openTextEncoding</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 704, srcSpanStartColumn = 24, srcSpanEndLine = 704, srcSpanEndColumn = 40}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 704, srcSpanStartColumn = 36, srcSpanEndLine = 704, srcSpanEndColumn = 37},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">TextEncoding{..}</span></span><span class="mpre">) </span><a name="loc_704_42_704_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_704_42_704_49&#39;)"><span class="hl_vardecl"><span class="mpre">ha_type</span></span></a><span class="mpre"> </span><a name="loc_704_50_704_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_704_50_704_54&#39;)"><span class="hl_vardecl"><span class="mpre">cont</span></span></a><span class="mpre"> = do
    </span><a name="loc_705_5_705_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_705_5_705_15&#39;)"><span class="hl_vardecl"><span class="mpre">mb_decoder</span></span></a><span class="mpre"> &lt;- if </span><a href="GHC.IO.Handle.Types.html#loc_163_1_163_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_163_1_163_21&#39;)"><span class="hl_varref"><span class="mpre">isReadableHandleType</span></span></a><span class="mpre"> </span><a href="#loc_704_42_704_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_704_42_704_49&#39;)"><span class="hl_varref"><span class="mpre">ha_type</span></span></a><span class="mpre"> then do
                     </span><a name="loc_706_22_706_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_706_22_706_29&#39;)"><span class="hl_vardecl"><span class="mpre">decoder</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">mkTextDecoder</span></span><span class="mpre">
                     </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_706_22_706_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_706_22_706_29&#39;)"><span class="hl_varref"><span class="mpre">decoder</span></span></a><span class="mpre">)
                  else
                     </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
    </span><a name="loc_710_5_710_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_710_5_710_15&#39;)"><span class="hl_vardecl"><span class="mpre">mb_encoder</span></span></a><span class="mpre"> &lt;- if </span><a href="GHC.IO.Handle.Types.html#loc_168_1_168_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_168_1_168_21&#39;)"><span class="hl_varref"><span class="mpre">isWritableHandleType</span></span></a><span class="mpre"> </span><a href="#loc_704_42_704_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_704_42_704_49&#39;)"><span class="hl_varref"><span class="mpre">ha_type</span></span></a><span class="mpre"> then do
                     </span><a name="loc_711_22_711_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_711_22_711_29&#39;)"><span class="hl_vardecl"><span class="mpre">encoder</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">mkTextEncoder</span></span><span class="mpre">
                     </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_711_22_711_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_711_22_711_29&#39;)"><span class="hl_varref"><span class="mpre">encoder</span></span></a><span class="mpre">)
                  else 
                     </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
    </span><a href="#loc_704_50_704_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_704_50_704_54&#39;)"><span class="hl_varref"><span class="mpre">cont</span></span></a><span class="mpre"> </span><a href="#loc_710_5_710_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_710_5_710_15&#39;)"><span class="hl_varref"><span class="mpre">mb_encoder</span></span></a><span class="mpre"> </span><a href="#loc_705_5_705_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_705_5_705_15&#39;)"><span class="hl_varref"><span class="mpre">mb_decoder</span></span></a><span class="mpre">

</span><a href="#loc_718_1_718_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_718_1_718_16&#39;)"><span class="mpre">closeTextCodecs</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_718_1_718_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_718_1_718_16&#39;)"><span class="hl_fundecl"><span class="mpre">closeTextCodecs</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 718, srcSpanStartColumn = 17, srcSpanEndLine = 718, srcSpanEndColumn = 29}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 718, srcSpanStartColumn = 25, srcSpanEndLine = 718, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{..}</span></span><span class="mpre"> = do
  case </span><a href="GHC.IO.Handle.Types.html#loc_135_7_135_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_135_7_135_16&#39;)"><span class="hl_varref"><span class="mpre">haDecoder</span></span></a><span class="mpre"> of </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">; </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_719_48_719_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_719_48_719_49&#39;)"><span class="hl_vardecl"><span class="mpre">d</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">Encoding.close</span></span><span class="mpre"> </span><a href="#loc_719_48_719_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_719_48_719_49&#39;)"><span class="hl_varref"><span class="mpre">d</span></span></a><span class="mpre">
  case </span><a href="GHC.IO.Handle.Types.html#loc_134_7_134_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_134_7_134_16&#39;)"><span class="hl_varref"><span class="mpre">haEncoder</span></span></a><span class="mpre"> of </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">; </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_720_48_720_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_720_48_720_49&#39;)"><span class="hl_vardecl"><span class="mpre">d</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">Encoding.close</span></span><span class="mpre"> </span><a href="#loc_720_48_720_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_720_48_720_49&#39;)"><span class="hl_varref"><span class="mpre">d</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- closing Handles</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- hClose_help is also called by lazyRead (in GHC.IO.Handle.Text) when</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- EOF is read or an IO error occurs on a lazy stream.  The</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- semi-closed Handle is then closed immediately.  We have to be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- careful with DuplexHandles though: we have to leave the closing to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the finalizer in that case, because the write side may still be in</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- use.</span></span><span class="mpre">
</span><a href="#loc_732_1_732_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_1_732_12&#39;)"><span class="mpre">hClose_help</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre">, </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">SomeException</span></span><span class="mpre">)
</span><a name="loc_732_1_732_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_1_732_12&#39;)"><span class="hl_fundecl"><span class="mpre">hClose_help</span></span></a><span class="mpre"> </span><a name="loc_732_13_732_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_13_732_20&#39;)"><span class="hl_vardecl"><span class="mpre">handle_</span></span></a><span class="mpre"> =
  case </span><a href="GHC.IO.Handle.Types.html#loc_128_7_128_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_128_7_128_13&#39;)"><span class="hl_varref"><span class="mpre">haType</span></span></a><span class="mpre"> </span><a href="#loc_732_13_732_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_13_732_20&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> of 
      </span><a href="GHC.IO.Handle.Types.html#loc_155_4_155_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_155_4_155_16&#39;)"><span class="hl_conref"><span class="mpre">ClosedHandle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_732_13_732_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_13_732_20&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">,</span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">)
      _ -&gt; do </span><a name="loc_735_15_735_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_735_15_735_22&#39;)"><span class="hl_vardecl"><span class="mpre">mb_exc1</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_744_1_744_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_744_1_744_9&#39;)"><span class="hl_varref"><span class="mpre">trymaybe</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_490_1_490_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_490_1_490_17&#39;)"><span class="hl_varref"><span class="mpre">flushWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_732_13_732_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_13_732_20&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- interruptible</span></span><span class="mpre">
                    </span><span class="hl_comment"><span class="mpre">-- it is important that hClose doesn&#39;t fail and</span></span><span class="mpre">
                    </span><span class="hl_comment"><span class="mpre">-- leave the Handle open (#3128), so we catch</span></span><span class="mpre">
                    </span><span class="hl_comment"><span class="mpre">-- exceptions when flushing the buffer.</span></span><span class="mpre">
              (</span><a name="loc_739_16_739_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_739_16_739_18&#39;)"><span class="hl_vardecl"><span class="mpre">h_</span></span></a><span class="mpre">, </span><a name="loc_739_20_739_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_739_20_739_27&#39;)"><span class="hl_vardecl"><span class="mpre">mb_exc2</span></span></a><span class="mpre">) &lt;- </span><a href="#loc_747_1_747_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_747_1_747_15&#39;)"><span class="hl_varref"><span class="mpre">hClose_handle_</span></span></a><span class="mpre"> </span><a href="#loc_732_13_732_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_13_732_20&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">
              </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_739_16_739_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_739_16_739_18&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">, if </span><a href="Data.Maybe.html#loc_80_1_80_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_80_1_80_7&#39;)"><span class="hl_varref"><span class="mpre">isJust</span></span></a><span class="mpre"> </span><a href="#loc_735_15_735_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_735_15_735_22&#39;)"><span class="hl_varref"><span class="mpre">mb_exc1</span></span></a><span class="mpre"> then </span><a href="#loc_735_15_735_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_735_15_735_22&#39;)"><span class="hl_varref"><span class="mpre">mb_exc1</span></span></a><span class="mpre"> else </span><a href="#loc_739_20_739_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_739_20_739_27&#39;)"><span class="hl_varref"><span class="mpre">mb_exc2</span></span></a><span class="mpre">)


</span><a href="#loc_744_1_744_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_744_1_744_9&#39;)"><span class="mpre">trymaybe</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">SomeException</span></span><span class="mpre">)
</span><a name="loc_744_1_744_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_744_1_744_9&#39;)"><span class="hl_fundecl"><span class="mpre">trymaybe</span></span></a><span class="mpre"> </span><a name="loc_744_10_744_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_744_10_744_12&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> = (do </span><a href="#loc_744_10_744_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_744_10_744_12&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre">; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">) </span><a href="GHC.IO.html#loc_279_1_279_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_279_1_279_15&#39;)"><span class="hl_infix"><span class="mpre">`catchException`</span></span></a><span class="mpre"> \</span><a name="loc_744_57_744_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_744_57_744_58&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_744_57_744_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_744_57_744_58&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">)

</span><a href="#loc_747_1_747_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_747_1_747_15&#39;)"><span class="mpre">hClose_handle_</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre">, </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">SomeException</span></span><span class="mpre">)
</span><a name="loc_747_1_747_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_747_1_747_15&#39;)"><span class="hl_fundecl"><span class="mpre">hClose_handle_</span></span></a><span class="mpre"> </span><a name="loc_747_16_747_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_747_16_747_18&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 747, srcSpanStartColumn = 19, srcSpanEndLine = 747, srcSpanEndColumn = 31}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 747, srcSpanStartColumn = 27, srcSpanEndLine = 747, srcSpanEndColumn = 28},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{..}</span></span><span class="mpre"> = do

    </span><span class="hl_comment"><span class="mpre">-- close the file descriptor, but not when this is the read</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- side of a duplex handle.</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- If an exception is raised by the close(), we want to continue</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- to close the handle and release the lock if it has one, then </span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- we return the exception to the caller of hClose_help which can</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- raise it if necessary.</span></span><span class="mpre">
    </span><a name="loc_755_5_755_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_755_5_755_20&#39;)"><span class="hl_vardecl"><span class="mpre">maybe_exception</span></span></a><span class="mpre"> &lt;- 
      case </span><a href="GHC.IO.Handle.Types.html#loc_139_7_139_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_139_7_139_18&#39;)"><span class="hl_varref"><span class="mpre">haOtherSide</span></span></a><span class="mpre"> of
        </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_744_1_744_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_744_1_744_9&#39;)"><span class="hl_varref"><span class="mpre">trymaybe</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IO.Device.html#loc_71_3_71_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_71_3_71_8&#39;)"><span class="hl_varref"><span class="mpre">IODevice.close</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre">
        </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> _  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">

    </span><span class="hl_comment"><span class="mpre">-- free the spare buffers</span></span><span class="mpre">
    </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_133_7_133_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_133_7_133_16&#39;)"><span class="hl_varref"><span class="mpre">haBuffers</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_148_5_148_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_148_5_148_18&#39;)"><span class="hl_conref"><span class="mpre">BufferListNil</span></span></a><span class="mpre">
    </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre"> </span><a href="#loc_776_1_776_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_776_1_776_13&#39;)"><span class="hl_varref"><span class="mpre">noCharBuffer</span></span></a><span class="mpre">
    </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_780_1_780_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_780_1_780_13&#39;)"><span class="hl_varref"><span class="mpre">noByteBuffer</span></span></a><span class="mpre">
  
    </span><span class="hl_comment"><span class="mpre">-- release our encoder/decoder</span></span><span class="mpre">
    </span><a href="#loc_718_1_718_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_718_1_718_16&#39;)"><span class="hl_varref"><span class="mpre">closeTextCodecs</span></span></a><span class="mpre"> </span><a href="#loc_747_16_747_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_747_16_747_18&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">

    </span><span class="hl_comment"><span class="mpre">-- we must set the fd to -1, because the finalizer is going</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- to run eventually and try to close/unlock it.</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- ToDo: necessary?  the handle will be marked ClosedHandle</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- XXX GHC won&#39;t let us use record update here, hence wildcards</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 772, srcSpanStartColumn = 13, srcSpanEndLine = 772, srcSpanEndColumn = 50}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 772, srcSpanStartColumn = 21, srcSpanEndLine = 772, srcSpanEndColumn = 22},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;"><span class="mpre">Handle__{ haType = ClosedHandle, .. }</span></span><span class="mpre">, </span><a href="#loc_755_5_755_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_755_5_755_20&#39;)"><span class="hl_varref"><span class="mpre">maybe_exception</span></span></a><span class="mpre">)

</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_776_1_776_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_776_1_776_13&#39;)"><span class="mpre">noCharBuffer</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_776_1_776_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_776_1_776_13&#39;)"><span class="mpre">noCharBuffer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre">
</span><a name="loc_776_1_776_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_776_1_776_13&#39;)"><span class="hl_vardecl"><span class="mpre">noCharBuffer</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_247_1_247_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_247_1_247_14&#39;)"><span class="hl_varref"><span class="mpre">newCharBuffer</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_195_20_195_30" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_195_20_195_30&#39;)"><span class="hl_conref"><span class="mpre">ReadBuffer</span></span></a><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_780_1_780_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_780_1_780_13&#39;)"><span class="mpre">noByteBuffer</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_780_1_780_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_780_1_780_13&#39;)"><span class="mpre">noByteBuffer</span></a><span class="mpre"> :: </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">
</span><a name="loc_780_1_780_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_780_1_780_13&#39;)"><span class="hl_vardecl"><span class="mpre">noByteBuffer</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_244_1_244_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_244_1_244_14&#39;)"><span class="hl_varref"><span class="mpre">newByteBuffer</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_195_20_195_30" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_195_20_195_30&#39;)"><span class="hl_conref"><span class="mpre">ReadBuffer</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Looking ahead</span></span><span class="mpre">

</span><a href="#loc_786_1_786_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_786_1_786_12&#39;)"><span class="mpre">hLookAhead_</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">
</span><a name="loc_786_1_786_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_786_1_786_12&#39;)"><span class="hl_fundecl"><span class="mpre">hLookAhead_</span></span></a><span class="mpre"> </span><a name="loc_786_13_786_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_786_13_786_20&#39;)"><span class="hl_specname"><span class="mpre">handle_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 786, srcSpanStartColumn = 21, srcSpanEndLine = 786, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 786, srcSpanStartColumn = 29, srcSpanEndLine = 786, srcSpanEndColumn = 30},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{..}</span></span><span class="mpre"> = do
    </span><a name="loc_787_5_787_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_787_5_787_8&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre">
  
    </span><span class="hl_comment"><span class="mpre">-- fill up the read buffer if necessary</span></span><span class="mpre">
    </span><a name="loc_790_5_790_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_790_5_790_12&#39;)"><span class="hl_vardecl"><span class="mpre">new_buf</span></span></a><span class="mpre"> &lt;- if </span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_787_5_787_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_787_5_787_8&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
                  then </span><a href="#loc_825_1_825_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_825_1_825_15&#39;)"><span class="hl_varref"><span class="mpre">readTextDevice</span></span></a><span class="mpre"> </span><a href="#loc_786_13_786_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_786_13_786_20&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><a href="#loc_787_5_787_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_787_5_787_8&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
                  else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_787_5_787_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_787_5_787_8&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
    </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre"> </span><a href="#loc_790_5_790_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_790_5_790_12&#39;)"><span class="hl_varref"><span class="mpre">new_buf</span></span></a><span class="mpre">
  
    </span><a href="GHC.IO.Buffer.html#loc_113_1_113_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_113_1_113_12&#39;)"><span class="hl_varref"><span class="mpre">peekCharBuf</span></span></a><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_182_9_182_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_182_9_182_15&#39;)"><span class="hl_varref"><span class="mpre">bufRaw</span></span></a><span class="mpre"> </span><a href="#loc_787_5_787_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_787_5_787_8&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">) (</span><a href="GHC.IO.Buffer.html#loc_185_9_185_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_185_9_185_13&#39;)"><span class="hl_varref"><span class="mpre">bufL</span></span></a><span class="mpre"> </span><a href="#loc_787_5_787_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_787_5_787_8&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- debugging</span></span><span class="mpre">

</span><a href="#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_801_1_801_8&#39;)"><span class="mpre">debugIO</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_801_1_801_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_801_1_801_8&#39;)"><span class="hl_fundecl"><span class="mpre">debugIO</span></span></a><span class="mpre"> </span><a name="loc_801_9_801_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_801_9_801_10&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">
 | </span><a href="#loc_84_1_84_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_13&#39;)"><span class="hl_varref"><span class="mpre">c_DEBUG_DUMP</span></span></a><span class="mpre">
    = do _ &lt;- </span><span class="hl_varref"><span class="mpre">withCStringLen</span></span><span class="mpre"> (</span><a href="#loc_801_9_801_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_801_9_801_10&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
                  \(</span><a name="loc_804_21_804_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_804_21_804_22&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre">, </span><a name="loc_804_24_804_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_804_24_804_27&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">) -&gt; </span><span class="hl_varref"><span class="mpre">c_write</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_804_21_804_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_804_21_804_22&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_804_24_804_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_804_24_804_27&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">)
         </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
 | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Text input/output</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Read characters into the provided buffer.  Return when any</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- characters are available; raise an exception if the end of </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- file is reached.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- In uses of readTextDevice within base, the input buffer is either:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   * empty</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   * or contains a single \r (when doing newline translation)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The input character buffer must have a capacity at least 1 greater</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- than the number of elements it currently contains.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Users of this function expect that the buffer returned contains</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- at least 1 more character than the input buffer.</span></span><span class="mpre">
</span><a href="#loc_825_1_825_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_825_1_825_15&#39;)"><span class="mpre">readTextDevice</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre">
</span><a name="loc_825_1_825_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_825_1_825_15&#39;)"><span class="hl_fundecl"><span class="mpre">readTextDevice</span></span></a><span class="mpre"> </span><a name="loc_825_16_825_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_825_16_825_18&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 825, srcSpanStartColumn = 19, srcSpanEndLine = 825, srcSpanEndColumn = 31}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 825, srcSpanStartColumn = 27, srcSpanEndLine = 825, srcSpanEndColumn = 28},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{..}</span></span><span class="mpre"> </span><a name="loc_825_32_825_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_825_32_825_36&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf</span></span></a><span class="mpre"> = do
  </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
  </span><a name="loc_827_3_827_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_827_3_827_8&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf0</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre">

  </span><a href="#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;readTextDevice: cbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_825_32_825_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_825_32_825_36&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> 
        </span><span class="hl_string"><span class="mpre">&quot; bbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_827_3_827_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_827_3_827_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf0</span></span></a><span class="mpre">)

  </span><a name="loc_832_3_832_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_3_832_8&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf1</span></span></a><span class="mpre"> &lt;- if </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_827_3_827_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_827_3_827_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf0</span></span></a><span class="mpre">)
              then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_827_3_827_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_827_3_827_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf0</span></span></a><span class="mpre">
              else do
                   (</span><a name="loc_835_21_835_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_835_21_835_22&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">,</span><a name="loc_835_23_835_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_835_23_835_28&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf1</span></span></a><span class="mpre">) &lt;- </span><a href="GHC.IO.BufferedIO.html#loc_48_3_48_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_48_3_48_17&#39;)"><span class="hl_varref"><span class="mpre">Buffered.fillReadBuffer</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre"> </span><a href="#loc_827_3_827_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_827_3_827_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf0</span></span></a><span class="mpre">
                   if </span><a href="#loc_835_21_835_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_835_21_835_22&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> then </span><a href="#loc_327_1_327_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_1_327_8&#39;)"><span class="hl_varref"><span class="mpre">ioe_EOF</span></span></a><span class="mpre"> else do  </span><span class="hl_comment"><span class="mpre">-- raise EOF</span></span><span class="mpre">
                   </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_835_23_835_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_835_23_835_28&#39;)"><span class="hl_varref"><span class="mpre">bbuf1</span></span></a><span class="mpre">

  </span><a href="#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;readTextDevice after reading: bbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_832_3_832_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_3_832_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf1</span></span></a><span class="mpre">)

  (</span><a name="loc_841_4_841_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_841_4_841_9&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf2</span></span></a><span class="mpre">,</span><a name="loc_841_10_841_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_841_10_841_15&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre">) &lt;- 
      case </span><a href="GHC.IO.Handle.Types.html#loc_135_7_135_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_135_7_135_16&#39;)"><span class="hl_varref"><span class="mpre">haDecoder</span></span></a><span class="mpre"> of
          </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">      -&gt; do
               </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_131_7_131_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_131_7_131_19&#39;)"><span class="hl_varref"><span class="mpre">haLastDecode</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;codec_state&quot;</span></span><span class="mpre">, </span><a href="#loc_832_3_832_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_3_832_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf1</span></span></a><span class="mpre">)
               </span><a href="GHC.IO.Encoding.html#loc_259_1_259_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.html#loc_259_1_259_14&#39;)"><span class="hl_varref"><span class="mpre">latin1_decode</span></span></a><span class="mpre"> </span><a href="#loc_832_3_832_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_3_832_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf1</span></span></a><span class="mpre"> </span><a href="#loc_825_32_825_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_825_32_825_36&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre">
          </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_846_16_846_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_846_16_846_23&#39;)"><span class="hl_vardecl"><span class="mpre">decoder</span></span></a><span class="mpre"> -&gt; do
               </span><a name="loc_847_16_847_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_847_16_847_21&#39;)"><span class="hl_vardecl"><span class="mpre">state</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getState</span></span><span class="mpre"> </span><a href="#loc_846_16_846_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_846_16_846_23&#39;)"><span class="hl_varref"><span class="mpre">decoder</span></span></a><span class="mpre">
               </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_131_7_131_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_131_7_131_19&#39;)"><span class="hl_varref"><span class="mpre">haLastDecode</span></span></a><span class="mpre"> (</span><a href="#loc_847_16_847_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_847_16_847_21&#39;)"><span class="hl_varref"><span class="mpre">state</span></span></a><span class="mpre">, </span><a href="#loc_832_3_832_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_3_832_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf1</span></span></a><span class="mpre">)
               (</span><a href="#loc_372_1_372_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_1_372_13&#39;)"><span class="hl_varref"><span class="mpre">streamEncode</span></span></a><span class="mpre"> </span><a href="#loc_846_16_846_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_846_16_846_23&#39;)"><span class="hl_varref"><span class="mpre">decoder</span></span></a><span class="mpre">) </span><a href="#loc_832_3_832_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_3_832_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf1</span></span></a><span class="mpre"> </span><a href="#loc_825_32_825_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_825_32_825_36&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre">

  </span><a href="#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;readTextDevice after decoding: cbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_841_10_841_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_841_10_841_15&#39;)"><span class="hl_varref"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> 
        </span><span class="hl_string"><span class="mpre">&quot; bbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_841_4_841_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_841_4_841_9&#39;)"><span class="hl_varref"><span class="mpre">bbuf2</span></span></a><span class="mpre">)

  </span><span class="hl_comment"><span class="mpre">-- We can&#39;t return from readTextDevice without reading at least a single extra character,</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- so check that we have managed to achieve that</span></span><span class="mpre">
  </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_841_4_841_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_841_4_841_9&#39;)"><span class="hl_varref"><span class="mpre">bbuf2</span></span></a><span class="mpre">
  if </span><a href="GHC.IO.Buffer.html#loc_186_9_186_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_186_9_186_13&#39;)"><span class="hl_varref"><span class="mpre">bufR</span></span></a><span class="mpre"> </span><a href="#loc_841_10_841_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_841_10_841_15&#39;)"><span class="hl_varref"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_186_9_186_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_186_9_186_13&#39;)"><span class="hl_varref"><span class="mpre">bufR</span></span></a><span class="mpre"> </span><a href="#loc_825_32_825_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_825_32_825_36&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">-- we need more bytes to make a Char. NB: bbuf2 may be empty (even though bbuf1 wasn&#39;t) when we</span></span><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">-- are using an encoding that can skip bytes without outputting characters, such as UTF8//IGNORE</span></span><span class="mpre">
     then </span><a href="#loc_866_1_866_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_866_1_866_16&#39;)"><span class="hl_varref"><span class="mpre">readTextDevice&#39;</span></span></a><span class="mpre"> </span><a href="#loc_825_16_825_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_825_16_825_18&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_841_4_841_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_841_4_841_9&#39;)"><span class="hl_varref"><span class="mpre">bbuf2</span></span></a><span class="mpre"> </span><a href="#loc_825_32_825_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_825_32_825_36&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre">
     else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_841_10_841_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_841_10_841_15&#39;)"><span class="hl_varref"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- we have an incomplete byte sequence at the end of the buffer: try to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- read more bytes.</span></span><span class="mpre">
</span><a href="#loc_866_1_866_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_866_1_866_16&#39;)"><span class="mpre">readTextDevice&#39;</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre">
</span><a name="loc_866_1_866_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_866_1_866_16&#39;)"><span class="hl_fundecl"><span class="mpre">readTextDevice&#39;</span></span></a><span class="mpre"> </span><a name="loc_866_17_866_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_866_17_866_19&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 866, srcSpanStartColumn = 20, srcSpanEndLine = 866, srcSpanEndColumn = 32}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 866, srcSpanStartColumn = 28, srcSpanEndLine = 866, srcSpanEndColumn = 29},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{..}</span></span><span class="mpre"> </span><a name="loc_866_33_866_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_866_33_866_38&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf0</span></span></a><span class="mpre"> </span><a name="loc_866_39_866_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_866_39_866_44&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf0</span></span></a><span class="mpre"> = do
  </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- copy the partial sequence to the beginning of the buffer, so we have</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- room to read more bytes.</span></span><span class="mpre">
  </span><a name="loc_870_3_870_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_3_870_8&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf1</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Buffer.html#loc_256_1_256_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_256_1_256_14&#39;)"><span class="hl_varref"><span class="mpre">slideContents</span></span></a><span class="mpre"> </span><a href="#loc_866_33_866_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_866_33_866_38&#39;)"><span class="hl_varref"><span class="mpre">bbuf0</span></span></a><span class="mpre">

  </span><span class="hl_comment"><span class="mpre">-- readTextDevice only calls us if we got some bytes but not some characters.</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- This can&#39;t occur if haDecoder is Nothing because latin1_decode accepts all bytes.</span></span><span class="mpre">
  let </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_874_12_874_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_874_12_874_19&#39;)"><span class="hl_vardecl"><span class="mpre">decoder</span></span></a><span class="mpre"> = </span><a href="GHC.IO.Handle.Types.html#loc_135_7_135_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_135_7_135_16&#39;)"><span class="hl_varref"><span class="mpre">haDecoder</span></span></a><span class="mpre">
  
  (</span><a name="loc_876_4_876_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_876_4_876_5&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">,</span><a name="loc_876_6_876_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_876_6_876_11&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf2</span></span></a><span class="mpre">) &lt;- </span><a href="GHC.IO.BufferedIO.html#loc_48_3_48_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_48_3_48_17&#39;)"><span class="hl_varref"><span class="mpre">Buffered.fillReadBuffer</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre"> </span><a href="#loc_870_3_870_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_3_870_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf1</span></span></a><span class="mpre">
  if </span><a href="#loc_876_4_876_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_876_4_876_5&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
   then do
     </span><span class="hl_comment"><span class="mpre">-- bbuf2 can be empty here when we encounter an invalid byte sequence at the end of the input</span></span><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">-- with a //IGNORE codec which consumes bytes without outputting characters</span></span><span class="mpre">
     if </span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_876_6_876_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_876_6_876_11&#39;)"><span class="hl_varref"><span class="mpre">bbuf2</span></span></a><span class="mpre"> then </span><a href="#loc_327_1_327_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_1_327_8&#39;)"><span class="hl_varref"><span class="mpre">ioe_EOF</span></span></a><span class="mpre"> else do
     (</span><a name="loc_882_7_882_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_882_7_882_12&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf3</span></span></a><span class="mpre">, </span><a name="loc_882_14_882_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_882_14_882_19&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf1</span></span></a><span class="mpre">) &lt;- </span><span class="hl_varref"><span class="mpre">recover</span></span><span class="mpre"> </span><a href="#loc_874_12_874_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_874_12_874_19&#39;)"><span class="hl_varref"><span class="mpre">decoder</span></span></a><span class="mpre"> </span><a href="#loc_876_6_876_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_876_6_876_11&#39;)"><span class="hl_varref"><span class="mpre">bbuf2</span></span></a><span class="mpre"> </span><a href="#loc_866_39_866_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_866_39_866_44&#39;)"><span class="hl_varref"><span class="mpre">cbuf0</span></span></a><span class="mpre">
     </span><a href="#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;readTextDevice&#39; after recovery: bbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_882_7_882_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_882_7_882_12&#39;)"><span class="hl_varref"><span class="mpre">bbuf3</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;, cbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_882_14_882_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_882_14_882_19&#39;)"><span class="hl_varref"><span class="mpre">cbuf1</span></span></a><span class="mpre">)
     </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_882_7_882_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_882_7_882_12&#39;)"><span class="hl_varref"><span class="mpre">bbuf3</span></span></a><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">-- We should recursively invoke readTextDevice after recovery,</span></span><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">-- if recovery did not add at least one new character to the buffer:</span></span><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">--  1. If we were using IgnoreCodingFailure it might be the case that</span></span><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">--     cbuf1 is the same length as cbuf0 and we need to raise ioe_EOF</span></span><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">--  2. If we were using TransliterateCodingFailure we might have *mutated*</span></span><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">--     the byte buffer without changing the pointers into either buffer.</span></span><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">--     We need to try and decode it again - it might just go through this time.</span></span><span class="mpre">
     if </span><a href="GHC.IO.Buffer.html#loc_186_9_186_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_186_9_186_13&#39;)"><span class="hl_varref"><span class="mpre">bufR</span></span></a><span class="mpre"> </span><a href="#loc_882_14_882_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_882_14_882_19&#39;)"><span class="hl_varref"><span class="mpre">cbuf1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_186_9_186_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_186_9_186_13&#39;)"><span class="hl_varref"><span class="mpre">bufR</span></span></a><span class="mpre"> </span><a href="#loc_866_39_866_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_866_39_866_44&#39;)"><span class="hl_varref"><span class="mpre">cbuf0</span></span></a><span class="mpre">
      then </span><a href="#loc_825_1_825_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_825_1_825_15&#39;)"><span class="hl_varref"><span class="mpre">readTextDevice</span></span></a><span class="mpre"> </span><a href="#loc_866_17_866_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_866_17_866_19&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_882_14_882_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_882_14_882_19&#39;)"><span class="hl_varref"><span class="mpre">cbuf1</span></span></a><span class="mpre">
      else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_882_14_882_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_882_14_882_19&#39;)"><span class="hl_varref"><span class="mpre">cbuf1</span></span></a><span class="mpre">
   else do
    </span><a href="#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;readTextDevice&#39; after reading: bbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_876_6_876_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_876_6_876_11&#39;)"><span class="hl_varref"><span class="mpre">bbuf2</span></span></a><span class="mpre">)
  
    (</span><a name="loc_898_6_898_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_898_6_898_11&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf3</span></span></a><span class="mpre">,</span><a name="loc_898_12_898_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_898_12_898_17&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf1</span></span></a><span class="mpre">) &lt;- do
       </span><a name="loc_899_8_899_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_899_8_899_13&#39;)"><span class="hl_vardecl"><span class="mpre">state</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getState</span></span><span class="mpre"> </span><a href="#loc_874_12_874_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_874_12_874_19&#39;)"><span class="hl_varref"><span class="mpre">decoder</span></span></a><span class="mpre">
       </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_131_7_131_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_131_7_131_19&#39;)"><span class="hl_varref"><span class="mpre">haLastDecode</span></span></a><span class="mpre"> (</span><a href="#loc_899_8_899_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_899_8_899_13&#39;)"><span class="hl_varref"><span class="mpre">state</span></span></a><span class="mpre">, </span><a href="#loc_876_6_876_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_876_6_876_11&#39;)"><span class="hl_varref"><span class="mpre">bbuf2</span></span></a><span class="mpre">)
       (</span><a href="#loc_372_1_372_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_1_372_13&#39;)"><span class="hl_varref"><span class="mpre">streamEncode</span></span></a><span class="mpre"> </span><a href="#loc_874_12_874_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_874_12_874_19&#39;)"><span class="hl_varref"><span class="mpre">decoder</span></span></a><span class="mpre">) </span><a href="#loc_876_6_876_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_876_6_876_11&#39;)"><span class="hl_varref"><span class="mpre">bbuf2</span></span></a><span class="mpre"> </span><a href="#loc_866_39_866_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_866_39_866_44&#39;)"><span class="hl_varref"><span class="mpre">cbuf0</span></span></a><span class="mpre">
  
    </span><a href="#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;readTextDevice&#39; after decoding: cbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_898_12_898_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_898_12_898_17&#39;)"><span class="hl_varref"><span class="mpre">cbuf1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> 
          </span><span class="hl_string"><span class="mpre">&quot; bbuf=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_898_6_898_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_898_6_898_11&#39;)"><span class="hl_varref"><span class="mpre">bbuf3</span></span></a><span class="mpre">)
  
    </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_898_6_898_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_898_6_898_11&#39;)"><span class="hl_varref"><span class="mpre">bbuf3</span></span></a><span class="mpre">
    if </span><a href="GHC.IO.Buffer.html#loc_186_9_186_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_186_9_186_13&#39;)"><span class="hl_varref"><span class="mpre">bufR</span></span></a><span class="mpre"> </span><a href="#loc_866_39_866_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_866_39_866_44&#39;)"><span class="hl_varref"><span class="mpre">cbuf0</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_186_9_186_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_186_9_186_13&#39;)"><span class="hl_varref"><span class="mpre">bufR</span></span></a><span class="mpre"> </span><a href="#loc_898_12_898_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_898_12_898_17&#39;)"><span class="hl_varref"><span class="mpre">cbuf1</span></span></a><span class="mpre">
       then </span><a href="#loc_866_1_866_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_866_1_866_16&#39;)"><span class="hl_varref"><span class="mpre">readTextDevice&#39;</span></span></a><span class="mpre"> </span><a href="#loc_866_17_866_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_866_17_866_19&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_898_6_898_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_898_6_898_11&#39;)"><span class="hl_varref"><span class="mpre">bbuf3</span></span></a><span class="mpre"> </span><a href="#loc_898_12_898_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_898_12_898_17&#39;)"><span class="hl_varref"><span class="mpre">cbuf1</span></span></a><span class="mpre">
       else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_898_12_898_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_898_12_898_17&#39;)"><span class="hl_varref"><span class="mpre">cbuf1</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Read characters into the provided buffer.  Do not block;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- return zero characters instead.  Raises an exception on end-of-file.</span></span><span class="mpre">
</span><a href="#loc_914_1_914_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_914_1_914_26&#39;)"><span class="mpre">readTextDeviceNonBlocking</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre">
</span><a name="loc_914_1_914_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_914_1_914_26&#39;)"><span class="hl_fundecl"><span class="mpre">readTextDeviceNonBlocking</span></span></a><span class="mpre"> </span><a name="loc_914_27_914_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_914_27_914_29&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 914, srcSpanStartColumn = 30, srcSpanEndLine = 914, srcSpanEndColumn = 42}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 914, srcSpanStartColumn = 38, srcSpanEndLine = 914, srcSpanEndColumn = 39},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{..}</span></span><span class="mpre"> </span><a name="loc_914_43_914_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_914_43_914_47&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf</span></span></a><span class="mpre"> = do
  </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
  </span><a name="loc_916_3_916_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_916_3_916_8&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf0</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre">
  </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_916_3_916_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_916_3_916_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf0</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
     (</span><a name="loc_918_7_918_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_918_7_918_8&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">,</span><a name="loc_918_9_918_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_918_9_918_14&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf1</span></span></a><span class="mpre">) &lt;- </span><a href="GHC.IO.BufferedIO.html#loc_53_3_53_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_53_3_53_18&#39;)"><span class="hl_varref"><span class="mpre">Buffered.fillReadBuffer0</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre"> </span><a href="#loc_916_3_916_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_916_3_916_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf0</span></span></a><span class="mpre">
     if </span><a href="Data.Maybe.html#loc_85_1_85_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_85_1_85_10&#39;)"><span class="hl_varref"><span class="mpre">isNothing</span></span></a><span class="mpre"> </span><a href="#loc_918_7_918_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_918_7_918_8&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> then </span><a href="#loc_327_1_327_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_1_327_8&#39;)"><span class="hl_varref"><span class="mpre">ioe_EOF</span></span></a><span class="mpre"> else do  </span><span class="hl_comment"><span class="mpre">-- raise EOF</span></span><span class="mpre">
     </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_918_9_918_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_918_9_918_14&#39;)"><span class="hl_varref"><span class="mpre">bbuf1</span></span></a><span class="mpre">

  </span><a href="#loc_926_1_926_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_926_1_926_14&#39;)"><span class="hl_varref"><span class="mpre">decodeByteBuf</span></span></a><span class="mpre"> </span><a href="#loc_914_27_914_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_914_27_914_29&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_914_43_914_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_914_43_914_47&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Decode bytes from the byte buffer into the supplied CharBuffer.</span></span><span class="mpre">
</span><a href="#loc_926_1_926_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_926_1_926_14&#39;)"><span class="mpre">decodeByteBuf</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre">
</span><a name="loc_926_1_926_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_926_1_926_14&#39;)"><span class="hl_fundecl"><span class="mpre">decodeByteBuf</span></span></a><span class="mpre"> </span><span class="hl_specname"><span class="mpre">h_</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 926, srcSpanStartColumn = 18, srcSpanEndLine = 926, srcSpanEndColumn = 30}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, srcSpanStartLine = 926, srcSpanStartColumn = 26, srcSpanEndLine = 926, srcSpanEndColumn = 27},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Internals.hs&quot;, src"><span class="mpre">Handle__{..}</span></span><span class="mpre"> </span><a name="loc_926_31_926_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_926_31_926_35&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf</span></span></a><span class="mpre"> = do
  </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
  </span><a name="loc_928_3_928_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_928_3_928_8&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf0</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre">

  (</span><a name="loc_930_4_930_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_4_930_9&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf2</span></span></a><span class="mpre">,</span><a name="loc_930_10_930_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_10_930_15&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre">) &lt;-
      case </span><a href="GHC.IO.Handle.Types.html#loc_135_7_135_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_135_7_135_16&#39;)"><span class="hl_varref"><span class="mpre">haDecoder</span></span></a><span class="mpre"> of
          </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">      -&gt; do
               </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_131_7_131_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_131_7_131_19&#39;)"><span class="hl_varref"><span class="mpre">haLastDecode</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;codec_state&quot;</span></span><span class="mpre">, </span><a href="#loc_928_3_928_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_928_3_928_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf0</span></span></a><span class="mpre">)
               </span><a href="GHC.IO.Encoding.html#loc_259_1_259_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.html#loc_259_1_259_14&#39;)"><span class="hl_varref"><span class="mpre">latin1_decode</span></span></a><span class="mpre"> </span><a href="#loc_928_3_928_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_928_3_928_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf0</span></span></a><span class="mpre"> </span><a href="#loc_926_31_926_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_926_31_926_35&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre">
          </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_935_16_935_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_935_16_935_23&#39;)"><span class="hl_vardecl"><span class="mpre">decoder</span></span></a><span class="mpre"> -&gt; do
               </span><a name="loc_936_16_936_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_936_16_936_21&#39;)"><span class="hl_vardecl"><span class="mpre">state</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getState</span></span><span class="mpre"> </span><a href="#loc_935_16_935_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_935_16_935_23&#39;)"><span class="hl_varref"><span class="mpre">decoder</span></span></a><span class="mpre">
               </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_131_7_131_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_131_7_131_19&#39;)"><span class="hl_varref"><span class="mpre">haLastDecode</span></span></a><span class="mpre"> (</span><a href="#loc_936_16_936_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_936_16_936_21&#39;)"><span class="hl_varref"><span class="mpre">state</span></span></a><span class="mpre">, </span><a href="#loc_928_3_928_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_928_3_928_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf0</span></span></a><span class="mpre">)
               (</span><a href="#loc_372_1_372_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_1_372_13&#39;)"><span class="hl_varref"><span class="mpre">streamEncode</span></span></a><span class="mpre"> </span><a href="#loc_935_16_935_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_935_16_935_23&#39;)"><span class="hl_varref"><span class="mpre">decoder</span></span></a><span class="mpre">) </span><a href="#loc_928_3_928_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_928_3_928_8&#39;)"><span class="hl_varref"><span class="mpre">bbuf0</span></span></a><span class="mpre"> </span><a href="#loc_926_31_926_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_926_31_926_35&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre">

  </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_930_4_930_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_4_930_9&#39;)"><span class="hl_varref"><span class="mpre">bbuf2</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_930_10_930_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_10_930_15&#39;)"><span class="hl_varref"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre">

</span></div></body></html>