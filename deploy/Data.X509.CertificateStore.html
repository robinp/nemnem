<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">module Data.X509.CertificateStore
    ( CertificateStore
    , makeCertificateStore
    </span><span class="hl_comment"><span class="mpre">-- * Queries</span></span><span class="mpre">
    , findCertificate
    , listCertificates
    ) where

import Data.List (</span><a href="Data.List.html#loc_993_1_993_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_993_1_993_7&#39;)"><span class="mpre">foldl&#39;</span></a><span class="mpre">)
import Data.Monoid
import Data.X509
import qualified Data.Map as M
import Control.Monad (</span><a href="Control.Monad.html#loc_130_4_130_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_130_4_130_9&#39;)"><span class="mpre">mplus</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | A Collection of certificate or store of certificates.</span></span><span class="mpre">
data </span><a name="loc_16_6_16_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_6_16_22&#39;)"><span class="hl_tycondecl"><span class="mpre">CertificateStore</span></span></a><span class="mpre"> = </span><a name="loc_16_25_16_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_25_16_41&#39;)"><span class="hl_condecl"><span class="mpre">CertificateStore</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">M.Map</span></span><span class="mpre"> </span><a href="Data.X509.DistinguishedName.html#loc_25_9_25_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.DistinguishedName.html#loc_25_9_25_26&#39;)"><span class="hl_tyconref"><span class="mpre">DistinguishedName</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">SignedCertificate</span></span><span class="mpre">)
                      | </span><a name="loc_17_25_17_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_25_17_42&#39;)"><span class="hl_condecl"><span class="mpre">CertificateStores</span></span></a><span class="mpre"> [</span><a href="#loc_16_6_16_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_6_16_22&#39;)"><span class="hl_tyconref"><span class="mpre">CertificateStore</span></span></a><span class="mpre">]

instance </span><a href="Data.Monoid.html#loc_79_7_79_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_79_7_79_13&#39;)"><span class="hl_classref"><span class="mpre">Monoid</span></span></a><span class="mpre"> </span><a href="#loc_16_6_16_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_6_16_22&#39;)"><span class="hl_tyconref"><span class="mpre">CertificateStore</span></span></a><span class="mpre"> where
    </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_vardecl"><span class="mpre">mempty</span></span></a><span class="mpre">  = </span><a href="#loc_16_25_16_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_25_16_41&#39;)"><span class="hl_conref"><span class="mpre">CertificateStore</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">M.empty</span></span><span class="mpre">
    </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_fundecl"><span class="mpre">mappend</span></span></a><span class="mpre"> </span><a name="loc_21_13_21_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_13_21_15&#39;)"><span class="hl_specname"><span class="mpre">s1</span></span></a><span class="mpre">@(</span><a href="#loc_16_25_16_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_25_16_41&#39;)"><span class="hl_conref"><span class="mpre">CertificateStore</span></span></a><span class="mpre"> _)   </span><a name="loc_21_39_21_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_39_21_41&#39;)"><span class="hl_specname"><span class="mpre">s2</span></span></a><span class="mpre">@(</span><a href="#loc_16_25_16_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_25_16_41&#39;)"><span class="hl_conref"><span class="mpre">CertificateStore</span></span></a><span class="mpre"> _) = </span><a href="#loc_17_25_17_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_25_17_42&#39;)"><span class="hl_conref"><span class="mpre">CertificateStores</span></span></a><span class="mpre"> [</span><a href="#loc_21_13_21_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_13_21_15&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre">,</span><a href="#loc_21_39_21_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_39_21_41&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre">]
    </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_fundecl"><span class="mpre">mappend</span></span></a><span class="mpre">    (</span><a href="#loc_17_25_17_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_25_17_42&#39;)"><span class="hl_conref"><span class="mpre">CertificateStores</span></span></a><span class="mpre"> </span><a name="loc_22_35_22_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_35_22_36&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">)  </span><a name="loc_22_39_22_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_39_22_41&#39;)"><span class="hl_specname"><span class="mpre">s2</span></span></a><span class="mpre">@(</span><a href="#loc_16_25_16_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_25_16_41&#39;)"><span class="hl_conref"><span class="mpre">CertificateStore</span></span></a><span class="mpre"> _) = </span><a href="#loc_17_25_17_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_25_17_42&#39;)"><span class="hl_conref"><span class="mpre">CertificateStores</span></span></a><span class="mpre"> (</span><a href="#loc_22_35_22_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_35_22_36&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> [</span><a href="#loc_22_39_22_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_39_22_41&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre">])
    </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_fundecl"><span class="mpre">mappend</span></span></a><span class="mpre"> </span><a name="loc_23_13_23_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_13_23_15&#39;)"><span class="hl_specname"><span class="mpre">s1</span></span></a><span class="mpre">@(</span><a href="#loc_16_25_16_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_25_16_41&#39;)"><span class="hl_conref"><span class="mpre">CertificateStore</span></span></a><span class="mpre"> _)   (</span><a href="#loc_17_25_17_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_25_17_42&#39;)"><span class="hl_conref"><span class="mpre">CertificateStores</span></span></a><span class="mpre"> </span><a name="loc_23_58_23_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_58_23_59&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">)   = </span><a href="#loc_17_25_17_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_25_17_42&#39;)"><span class="hl_conref"><span class="mpre">CertificateStores</span></span></a><span class="mpre"> ([</span><a href="#loc_23_13_23_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_13_23_15&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre">] </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_23_58_23_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_58_23_59&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">)
    </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_fundecl"><span class="mpre">mappend</span></span></a><span class="mpre">    (</span><a href="#loc_17_25_17_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_25_17_42&#39;)"><span class="hl_conref"><span class="mpre">CertificateStores</span></span></a><span class="mpre"> </span><a name="loc_24_35_24_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_35_24_37&#39;)"><span class="hl_vardecl"><span class="mpre">l1</span></span></a><span class="mpre">) (</span><a href="#loc_17_25_17_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_25_17_42&#39;)"><span class="hl_conref"><span class="mpre">CertificateStores</span></span></a><span class="mpre"> </span><a name="loc_24_58_24_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_58_24_60&#39;)"><span class="hl_vardecl"><span class="mpre">l2</span></span></a><span class="mpre">)  = </span><a href="#loc_17_25_17_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_25_17_42&#39;)"><span class="hl_conref"><span class="mpre">CertificateStores</span></span></a><span class="mpre"> (</span><a href="#loc_24_35_24_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_35_24_37&#39;)"><span class="hl_varref"><span class="mpre">l1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_24_58_24_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_58_24_60&#39;)"><span class="hl_varref"><span class="mpre">l2</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Create a certificate store out of a list of X509 certificate</span></span><span class="mpre">
</span><a href="#loc_28_1_28_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_1_28_21&#39;)"><span class="mpre">makeCertificateStore</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">SignedCertificate</span></span><span class="mpre">] -&gt; </span><a href="#loc_16_6_16_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_6_16_22&#39;)"><span class="hl_tyconref"><span class="mpre">CertificateStore</span></span></a><span class="mpre">
</span><a name="loc_28_1_28_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_1_28_21&#39;)"><span class="hl_vardecl"><span class="mpre">makeCertificateStore</span></span></a><span class="mpre"> = </span><a href="#loc_16_25_16_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_25_16_41&#39;)"><span class="hl_conref"><span class="mpre">CertificateStore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.List.html#loc_993_1_993_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_993_1_993_7&#39;)"><span class="hl_varref"><span class="mpre">foldl&#39;</span></span></a><span class="mpre"> </span><a href="#loc_29_11_29_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_11_29_21&#39;)"><span class="hl_varref"><span class="mpre">accumulate</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">M.empty</span></span><span class="mpre">
    where </span><a name="loc_29_11_29_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_11_29_21&#39;)"><span class="hl_fundecl"><span class="mpre">accumulate</span></span></a><span class="mpre"> </span><a name="loc_29_22_29_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_22_29_23&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><a name="loc_29_24_29_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_24_29_28&#39;)"><span class="hl_vardecl"><span class="mpre">x509</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">M.insert</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">certSubjectDN</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.X509.html#loc_87_1_87_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.html#loc_87_1_87_15&#39;)"><span class="hl_varref"><span class="mpre">getCertificate</span></span></a><span class="mpre"> </span><a href="#loc_29_24_29_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_24_29_28&#39;)"><span class="hl_varref"><span class="mpre">x509</span></span></a><span class="mpre">) </span><a href="#loc_29_24_29_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_24_29_28&#39;)"><span class="hl_varref"><span class="mpre">x509</span></span></a><span class="mpre"> </span><a href="#loc_29_22_29_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_22_29_23&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Find a certificate using the subject distinguished name</span></span><span class="mpre">
</span><a href="#loc_33_1_33_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_16&#39;)"><span class="mpre">findCertificate</span></a><span class="mpre"> :: </span><a href="Data.X509.DistinguishedName.html#loc_25_9_25_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.DistinguishedName.html#loc_25_9_25_26&#39;)"><span class="hl_tyconref"><span class="mpre">DistinguishedName</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_16_6_16_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_6_16_22&#39;)"><span class="hl_tyconref"><span class="mpre">CertificateStore</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">SignedCertificate</span></span><span class="mpre">
</span><a name="loc_33_1_33_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_16&#39;)"><span class="hl_fundecl"><span class="mpre">findCertificate</span></span></a><span class="mpre"> </span><a name="loc_33_17_33_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_17_33_19&#39;)"><span class="hl_vardecl"><span class="mpre">dn</span></span></a><span class="mpre"> </span><a name="loc_33_20_33_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_20_33_25&#39;)"><span class="hl_vardecl"><span class="mpre">store</span></span></a><span class="mpre"> = </span><a href="#loc_34_11_34_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_11_34_19&#39;)"><span class="hl_varref"><span class="mpre">lookupIn</span></span></a><span class="mpre"> </span><a href="#loc_33_20_33_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_20_33_25&#39;)"><span class="hl_varref"><span class="mpre">store</span></span></a><span class="mpre">
    where </span><a name="loc_34_11_34_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_11_34_19&#39;)"><span class="hl_fundecl"><span class="mpre">lookupIn</span></span></a><span class="mpre"> (</span><a href="#loc_16_25_16_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_25_16_41&#39;)"><span class="hl_conref"><span class="mpre">CertificateStore</span></span></a><span class="mpre"> </span><a name="loc_34_38_34_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_38_34_39&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">)  = </span><span class="hl_varref"><span class="mpre">M.lookup</span></span><span class="mpre"> </span><a href="#loc_33_17_33_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_17_33_19&#39;)"><span class="hl_varref"><span class="mpre">dn</span></span></a><span class="mpre"> </span><a href="#loc_34_38_34_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_38_34_39&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
          </span><a href="#loc_34_11_34_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_11_34_19&#39;)"><span class="hl_fundecl"><span class="mpre">lookupIn</span></span></a><span class="mpre"> (</span><a href="#loc_17_25_17_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_25_17_42&#39;)"><span class="hl_conref"><span class="mpre">CertificateStores</span></span></a><span class="mpre"> </span><a name="loc_35_39_35_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_39_35_40&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">foldl</span></span><span class="mpre"> </span><a href="Control.Monad.html#loc_130_4_130_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_130_4_130_9&#39;)"><span class="hl_varref"><span class="mpre">mplus</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_34_11_34_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_11_34_19&#39;)"><span class="hl_varref"><span class="mpre">lookupIn</span></span></a><span class="mpre"> </span><a href="#loc_35_39_35_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_39_35_40&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | List all certificates in a store</span></span><span class="mpre">
</span><a href="#loc_39_1_39_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_17&#39;)"><span class="mpre">listCertificates</span></a><span class="mpre"> :: </span><a href="#loc_16_6_16_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_6_16_22&#39;)"><span class="hl_tyconref"><span class="mpre">CertificateStore</span></span></a><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">SignedCertificate</span></span><span class="mpre">]
</span><a name="loc_39_1_39_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_17&#39;)"><span class="hl_fundecl"><span class="mpre">listCertificates</span></span></a><span class="mpre"> (</span><a href="#loc_16_25_16_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_25_16_41&#39;)"><span class="hl_conref"><span class="mpre">CertificateStore</span></span></a><span class="mpre"> </span><a name="loc_39_36_39_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_36_39_41&#39;)"><span class="hl_vardecl"><span class="mpre">store</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">snd</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">M.toList</span></span><span class="mpre"> </span><a href="#loc_39_36_39_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_36_39_41&#39;)"><span class="hl_varref"><span class="mpre">store</span></span></a><span class="mpre">
</span><a href="#loc_39_1_39_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_17&#39;)"><span class="hl_fundecl"><span class="mpre">listCertificates</span></span></a><span class="mpre"> (</span><a href="#loc_17_25_17_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_25_17_42&#39;)"><span class="hl_conref"><span class="mpre">CertificateStores</span></span></a><span class="mpre"> </span><a name="loc_40_37_40_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_37_40_38&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">)    = </span><span class="hl_varref"><span class="mpre">concatMap</span></span><span class="mpre"> </span><a href="#loc_39_1_39_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_17&#39;)"><span class="hl_varref"><span class="mpre">listCertificates</span></span></a><span class="mpre"> </span><a href="#loc_40_37_40_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_37_40_38&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
</span></div></body></html>