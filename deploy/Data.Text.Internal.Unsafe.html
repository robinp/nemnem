<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE CPP, MagicHash, UnboxedTuples #-}
{-# OPTIONS_HADDOCK not-home #-}

</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Data.Text.Internal.Unsafe</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   : (c) 2009, 2010, 2011 Bryan O&#39;Sullivan</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : bos@serpentine.com</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /Warning/: this is an internal module, and does not have a stable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- API or name. Functions in this module may not check or enforce</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- preconditions expected by public modules. Use at your own risk!</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A module containing /unsafe/ operations, for /very very careful/ use</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in /heavily tested/ code.</span></span><span class="mpre">
module Data.Text.Internal.Unsafe
    (
      inlineInterleaveST
    , inlinePerformIO
    ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal/Unsafe.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 8, srcSpanEndLine = 24, srcSpanEndColumn = 14}, srcInfoPoints = []}) &quot;GHC.ST&quot;"><span class="mpre">GHC.ST</span></span><span class="mpre"> (ST(..))
#if defined(__GLASGOW_HASKELL__)
import GHC.IO (IO(IO))
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal/Unsafe.hs&quot;, srcSpanStartLine = 27, srcSpanStartColumn = 8, srcSpanEndLine = 27, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre"> (realWorld#)
#endif


</span><span class="hl_comment"><span class="mpre">-- | Just like unsafePerformIO, but we inline it. Big performance gains as</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- it exposes lots of things to further inlining. /Very unsafe/. In</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- particular, you should do no memory allocation inside an</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;inlinePerformIO&#39; block. On Hugs this is just @unsafePerformIO@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_39_1_39_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_16&#39;)"><span class="mpre">inlinePerformIO</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_39_1_39_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_16&#39;)"><span class="mpre">inlinePerformIO</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
#if defined(__GLASGOW_HASKELL__)
</span><a name="loc_39_1_39_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_16&#39;)"><span class="hl_fundecl"><span class="mpre">inlinePerformIO</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><a name="loc_39_21_39_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_21_39_22&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) = case </span><a href="#loc_39_21_39_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_21_39_22&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">realWorld#</span></span><span class="mpre"> of (# _, </span><a name="loc_39_53_39_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_53_39_54&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> #) -&gt; </span><a href="#loc_39_53_39_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_53_39_54&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
#else
</span><span class="hl_vardecl"><span class="mpre">inlinePerformIO</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span><span class="mpre">
#endif

</span><span class="hl_comment"><span class="mpre">-- | Allow an &#39;ST&#39; computation to be deferred lazily. When passed an</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- action of type &#39;ST&#39; @s@ @a@, the action will only be performed when</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the value of @a@ is demanded.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This function is identical to the normal unsafeInterleaveST, but is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- inlined and hence faster.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /Note/: This operation is highly unsafe, as it can introduce</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- externally visible non-determinism into an &#39;ST&#39; action.</span></span><span class="mpre">
</span><a href="#loc_54_1_54_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_19&#39;)"><span class="mpre">inlineInterleaveST</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ST</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ST</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_54_1_54_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_19&#39;)"><span class="hl_fundecl"><span class="mpre">inlineInterleaveST</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">ST</span></span><span class="mpre"> </span><a name="loc_54_24_54_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_24_54_25&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">ST</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_54_36_54_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_36_54_37&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
    let </span><a name="loc_55_9_55_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_9_55_10&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = case </span><a href="#loc_54_24_54_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_24_54_25&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_54_36_54_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_36_54_37&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of (# _, </span><a name="loc_55_31_55_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_31_55_34&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> #) -&gt; </span><a href="#loc_55_31_55_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_31_55_34&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre"> in (# </span><a href="#loc_54_36_54_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_36_54_37&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">, </span><a href="#loc_55_9_55_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_9_55_10&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> #)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_54_1_54_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_19&#39;)"><span class="mpre">inlineInterleaveST</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span></div></body></html>