<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">module System.Log.FastLogger.File where

import Control.Monad (</span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="mpre">unless</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">)
import System.Directory (</span><a href="System.Directory.html#loc_726_1_726_14" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_726_1_726_14&#39;)"><span class="mpre">doesFileExist</span></a><span class="mpre">, </span><a href="System.Directory.html#loc_717_1_717_19" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_717_1_717_19&#39;)"><span class="mpre">doesDirectoryExist</span></a><span class="mpre">, </span><a href="System.Directory.html#loc_153_1_153_15" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_153_1_153_15&#39;)"><span class="mpre">getPermissions</span></a><span class="mpre">, </span><a href="System.Directory.html#loc_136_17_136_25" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_136_17_136_25&#39;)"><span class="mpre">writable</span></a><span class="mpre">, </span><a href="System.Directory.html#loc_510_1_510_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_510_1_510_11&#39;)"><span class="mpre">renameFile</span></a><span class="mpre">)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fast-logger-2.1.5/System/Log/FastLogger/File.hs&quot;, srcSpanStartLine = 5, srcSpanStartColumn = 8, srcSpanEndLine = 5, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;System.FilePath&quot;"><span class="mpre">System.FilePath</span></span><span class="mpre"> (takeDirectory)

</span><span class="hl_comment"><span class="mpre">-- | The spec for logging files</span></span><span class="mpre">
data </span><a name="loc_8_6_8_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_8_6_8_17&#39;)"><span class="hl_tycondecl"><span class="mpre">FileLogSpec</span></span></a><span class="mpre"> = </span><a name="loc_8_20_8_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_8_20_8_31&#39;)"><span class="hl_condecl"><span class="mpre">FileLogSpec</span></span></a><span class="mpre"> {
    </span><a name="loc_9_5_9_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_9_5_9_13&#39;)"><span class="hl_fielddecl"><span class="mpre">log_file</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre">
  , </span><a name="loc_10_5_10_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_10_5_10_18&#39;)"><span class="hl_fielddecl"><span class="mpre">log_file_size</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">
  , </span><a name="loc_11_5_11_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_11_5_11_22&#39;)"><span class="hl_fielddecl"><span class="mpre">log_backup_number</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
  }

</span><span class="hl_comment"><span class="mpre">-- | Checking if a log file can be written.</span></span><span class="mpre">
</span><a href="#loc_16_1_16_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_6&#39;)"><span class="mpre">check</span></a><span class="mpre"> :: </span><a href="#loc_8_6_8_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_8_6_8_17&#39;)"><span class="hl_tyconref"><span class="mpre">FileLogSpec</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_16_1_16_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_6&#39;)"><span class="hl_fundecl"><span class="mpre">check</span></span></a><span class="mpre"> </span><a name="loc_16_7_16_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_7_16_11&#39;)"><span class="hl_vardecl"><span class="mpre">spec</span></span></a><span class="mpre"> = do
    </span><a name="loc_17_5_17_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_5_17_13&#39;)"><span class="hl_vardecl"><span class="mpre">dirExist</span></span></a><span class="mpre"> &lt;- </span><a href="System.Directory.html#loc_717_1_717_19" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_717_1_717_19&#39;)"><span class="hl_varref"><span class="mpre">doesDirectoryExist</span></span></a><span class="mpre"> </span><a href="#loc_27_5_27_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_5_27_8&#39;)"><span class="hl_varref"><span class="mpre">dir</span></span></a><span class="mpre">
    </span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="hl_varref"><span class="mpre">unless</span></span></a><span class="mpre"> </span><a href="#loc_17_5_17_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_5_17_13&#39;)"><span class="hl_varref"><span class="mpre">dirExist</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fail</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_27_5_27_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_5_27_8&#39;)"><span class="hl_varref"><span class="mpre">dir</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; does not exist or is not a directory.&quot;</span></span><span class="mpre">
    </span><a name="loc_19_5_19_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_5_19_12&#39;)"><span class="hl_vardecl"><span class="mpre">dirPerm</span></span></a><span class="mpre"> &lt;- </span><a href="System.Directory.html#loc_153_1_153_15" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_153_1_153_15&#39;)"><span class="hl_varref"><span class="mpre">getPermissions</span></span></a><span class="mpre"> </span><a href="#loc_27_5_27_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_5_27_8&#39;)"><span class="hl_varref"><span class="mpre">dir</span></span></a><span class="mpre">
    </span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="hl_varref"><span class="mpre">unless</span></span></a><span class="mpre"> (</span><a href="System.Directory.html#loc_136_17_136_25" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_136_17_136_25&#39;)"><span class="hl_varref"><span class="mpre">writable</span></span></a><span class="mpre"> </span><a href="#loc_19_5_19_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_5_19_12&#39;)"><span class="hl_varref"><span class="mpre">dirPerm</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fail</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_27_5_27_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_5_27_8&#39;)"><span class="hl_varref"><span class="mpre">dir</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; is not writable.&quot;</span></span><span class="mpre">
    </span><a name="loc_21_5_21_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_5_21_10&#39;)"><span class="hl_vardecl"><span class="mpre">exist</span></span></a><span class="mpre"> &lt;- </span><a href="System.Directory.html#loc_726_1_726_14" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_726_1_726_14&#39;)"><span class="hl_varref"><span class="mpre">doesFileExist</span></span></a><span class="mpre"> </span><a href="#loc_26_5_26_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_5_26_9&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre">
    </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_21_5_21_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_5_21_10&#39;)"><span class="hl_varref"><span class="mpre">exist</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><a name="loc_23_9_23_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_9_23_13&#39;)"><span class="hl_vardecl"><span class="mpre">perm</span></span></a><span class="mpre"> &lt;- </span><a href="System.Directory.html#loc_153_1_153_15" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_153_1_153_15&#39;)"><span class="hl_varref"><span class="mpre">getPermissions</span></span></a><span class="mpre"> </span><a href="#loc_26_5_26_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_5_26_9&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre">
        </span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="hl_varref"><span class="mpre">unless</span></span></a><span class="mpre"> (</span><a href="System.Directory.html#loc_136_17_136_25" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_136_17_136_25&#39;)"><span class="hl_varref"><span class="mpre">writable</span></span></a><span class="mpre"> </span><a href="#loc_23_9_23_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_9_23_13&#39;)"><span class="hl_varref"><span class="mpre">perm</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fail</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_26_5_26_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_5_26_9&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; is not writable.&quot;</span></span><span class="mpre">
  where
    </span><a name="loc_26_5_26_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_5_26_9&#39;)"><span class="hl_vardecl"><span class="mpre">file</span></span></a><span class="mpre"> = </span><a href="#loc_9_5_9_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_9_5_9_13&#39;)"><span class="hl_varref"><span class="mpre">log_file</span></span></a><span class="mpre"> </span><a href="#loc_16_7_16_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_7_16_11&#39;)"><span class="hl_varref"><span class="mpre">spec</span></span></a><span class="mpre">
    </span><a name="loc_27_5_27_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_5_27_8&#39;)"><span class="hl_vardecl"><span class="mpre">dir</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">takeDirectory</span></span><span class="mpre"> </span><a href="#loc_26_5_26_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_5_26_9&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Rotating log files.</span></span><span class="mpre">
</span><a href="#loc_31_1_31_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_1_31_7&#39;)"><span class="mpre">rotate</span></a><span class="mpre"> :: </span><a href="#loc_8_6_8_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_8_6_8_17&#39;)"><span class="hl_tyconref"><span class="mpre">FileLogSpec</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_31_1_31_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_1_31_7&#39;)"><span class="hl_fundecl"><span class="mpre">rotate</span></span></a><span class="mpre"> </span><a name="loc_31_8_31_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_8_31_12&#39;)"><span class="hl_vardecl"><span class="mpre">spec</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">mapM_</span></span><span class="mpre"> </span><a href="#loc_39_5_39_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_5_39_9&#39;)"><span class="hl_varref"><span class="mpre">move</span></span></a><span class="mpre"> </span><a href="#loc_38_5_38_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_5_38_12&#39;)"><span class="hl_varref"><span class="mpre">srcdsts</span></span></a><span class="mpre">
  where
    </span><a name="loc_33_5_33_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_5_33_9&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> = </span><a href="#loc_9_5_9_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_9_5_9_13&#39;)"><span class="hl_varref"><span class="mpre">log_file</span></span></a><span class="mpre"> </span><a href="#loc_31_8_31_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_8_31_12&#39;)"><span class="hl_varref"><span class="mpre">spec</span></span></a><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">n</span></span><span class="mpre"> = </span><a href="#loc_11_5_11_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_11_5_11_22&#39;)"><span class="hl_varref"><span class="mpre">log_backup_number</span></span></a><span class="mpre"> </span><a href="#loc_31_8_31_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_8_31_12&#39;)"><span class="hl_varref"><span class="mpre">spec</span></span></a><span class="mpre">
    </span><a name="loc_35_5_35_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_5_35_10&#39;)"><span class="hl_vardecl"><span class="mpre">dsts&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">reverse</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> ((</span><span class="hl_char"><span class="mpre">&#39;.&#39;</span></span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">)</span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpEnumFromTo (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fast-logger-2.1.5/System/Log/FastLogger/File.hs&quot;, srcSpanStartLine = 35, srcSpanStartColumn = 52, srcSpanEndLine = 35, srcSpanEndColumn = 60}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fast-logger-2.1.5/System/Log/FastLogger/File.hs&quot;, srcSpanStartLine = 35, srcSpanStartColumn = 52, srcSpanEndLine = 35, srcSpanEndColumn = 53},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fast-logger-2.1.5/System/Lo"><span class="mpre">[0..n-1]</span></span><span class="mpre">
    </span><a name="loc_36_5_36_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_5_36_9&#39;)"><span class="hl_vardecl"><span class="mpre">dsts</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> (</span><a href="#loc_33_5_33_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_5_33_9&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">) </span><a href="#loc_35_5_35_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_5_35_10&#39;)"><span class="hl_varref"><span class="mpre">dsts&#39;</span></span></a><span class="mpre">
    </span><a name="loc_37_5_37_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_5_37_9&#39;)"><span class="hl_vardecl"><span class="mpre">srcs</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">tail</span></span><span class="mpre"> </span><a href="#loc_36_5_36_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_5_36_9&#39;)"><span class="hl_varref"><span class="mpre">dsts</span></span></a><span class="mpre">
    </span><a name="loc_38_5_38_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_5_38_12&#39;)"><span class="hl_vardecl"><span class="mpre">srcdsts</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">zip</span></span><span class="mpre"> </span><a href="#loc_37_5_37_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_5_37_9&#39;)"><span class="hl_varref"><span class="mpre">srcs</span></span></a><span class="mpre"> </span><a href="#loc_36_5_36_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_5_36_9&#39;)"><span class="hl_varref"><span class="mpre">dsts</span></span></a><span class="mpre">
    </span><a name="loc_39_5_39_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_5_39_9&#39;)"><span class="hl_fundecl"><span class="mpre">move</span></span></a><span class="mpre"> (</span><a name="loc_39_11_39_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_11_39_14&#39;)"><span class="hl_vardecl"><span class="mpre">src</span></span></a><span class="mpre">,</span><a name="loc_39_15_39_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_18&#39;)"><span class="hl_vardecl"><span class="mpre">dst</span></span></a><span class="mpre">) = do
        </span><a name="loc_40_9_40_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_9_40_14&#39;)"><span class="hl_vardecl"><span class="mpre">exist</span></span></a><span class="mpre"> &lt;- </span><a href="System.Directory.html#loc_726_1_726_14" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_726_1_726_14&#39;)"><span class="hl_varref"><span class="mpre">doesFileExist</span></span></a><span class="mpre"> </span><a href="#loc_39_11_39_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_11_39_14&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre">
        </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_40_9_40_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_9_40_14&#39;)"><span class="hl_varref"><span class="mpre">exist</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="System.Directory.html#loc_510_1_510_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_510_1_510_11&#39;)"><span class="hl_varref"><span class="mpre">renameFile</span></span></a><span class="mpre"> </span><a href="#loc_39_11_39_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_11_39_14&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre"> </span><a href="#loc_39_15_39_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_18&#39;)"><span class="hl_varref"><span class="mpre">dst</span></span></a><span class="mpre">

</span></div></body></html>