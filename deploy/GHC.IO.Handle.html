<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Trustworthy #-}
{-# LANGUAGE CPP
           , NoImplicitPrelude
           , RecordWildCards
           , NondecreasingIndentation
  #-}
{-# OPTIONS_GHC -fno-warn-unused-matches #-}

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  GHC.IO.Handle</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow, 1994-2009</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  see libraries/base/LICENSE</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  libraries@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  provisional</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- External API for GHC&#39;s Handle implementation</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module GHC.IO.Handle (
   Handle,
   BufferMode(..),
 
   mkFileHandle, mkDuplexHandle,
 
   hFileSize, hSetFileSize, hIsEOF, hLookAhead,
   hSetBuffering, hSetBinaryMode, hSetEncoding, hGetEncoding,
   hFlush, hFlushAll, hDuplicate, hDuplicateTo,
 
   hClose, hClose_help,
 
   HandlePosition, HandlePosn(..), hGetPosn, hSetPosn,
   SeekMode(..), hSeek, hTell,
 
   hIsOpen, hIsClosed, hIsReadable, hIsWritable, hGetBuffering, hIsSeekable,
   hSetEcho, hGetEcho, hIsTerminalDevice,
 
   hSetNewlineMode, Newline(..), NewlineMode(..), nativeNewline,
   noNewlineTranslation, universalNewlineMode, nativeNewlineMode,

   hShow,

   hWaitForInput, hGetChar, hGetLine, hGetContents, hPutChar, hPutStr,

   hGetBuf, hGetBufNonBlocking, hPutBuf, hPutBufNonBlocking
 ) where

import GHC.IO
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 52, srcSpanStartColumn = 8, srcSpanEndLine = 52, srcSpanEndColumn = 24}, srcInfoPoints = []}) &quot;GHC.IO.Exception&quot;"><span class="mpre">GHC.IO.Exception</span></span><span class="mpre">
import GHC.IO.Encoding
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 8, srcSpanEndLine = 54, srcSpanEndColumn = 21}, srcInfoPoints = []}) &quot;GHC.IO.Buffer&quot;"><span class="mpre">GHC.IO.Buffer</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 55, srcSpanStartColumn = 8, srcSpanEndLine = 55, srcSpanEndColumn = 25}, srcInfoPoints = []}) &quot;GHC.IO.BufferedIO&quot;"><span class="mpre">GHC.IO.BufferedIO</span></span><span class="mpre"> ( BufferedIO )
import GHC.IO.Device as IODevice
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 57, srcSpanStartColumn = 8, srcSpanEndLine = 57, srcSpanEndColumn = 27}, srcInfoPoints = []}) &quot;GHC.IO.Handle.Types&quot;"><span class="mpre">GHC.IO.Handle.Types</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 58, srcSpanStartColumn = 8, srcSpanEndLine = 58, srcSpanEndColumn = 31}, srcInfoPoints = []}) &quot;GHC.IO.Handle.Internals&quot;"><span class="mpre">GHC.IO.Handle.Internals</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 59, srcSpanStartColumn = 8, srcSpanEndLine = 59, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;GHC.IO.Handle.Text&quot;"><span class="mpre">GHC.IO.Handle.Text</span></span><span class="mpre">
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 60, srcSpanStartColumn = 18, srcSpanEndLine = 60, srcSpanEndColumn = 35}, srcInfoPoints = []}) &quot;GHC.IO.BufferedIO&quot;"><span class="mpre">GHC.IO.BufferedIO</span></span><span class="mpre"> as Buffered

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 62, srcSpanStartColumn = 8, srcSpanEndLine = 62, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 63, srcSpanStartColumn = 8, srcSpanEndLine = 63, srcSpanEndColumn = 21}, srcInfoPoints = []}) &quot;GHC.Exception&quot;"><span class="mpre">GHC.Exception</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 64, srcSpanStartColumn = 8, srcSpanEndLine = 64, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.MVar&quot;"><span class="mpre">GHC.MVar</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 8, srcSpanEndLine = 65, srcSpanEndColumn = 17}, srcInfoPoints = []}) &quot;GHC.IORef&quot;"><span class="mpre">GHC.IORef</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 66, srcSpanStartColumn = 8, srcSpanEndLine = 66, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Show&quot;"><span class="mpre">GHC.Show</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 67, srcSpanStartColumn = 8, srcSpanEndLine = 67, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;GHC.Num&quot;"><span class="mpre">GHC.Num</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 68, srcSpanStartColumn = 8, srcSpanEndLine = 68, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Real&quot;"><span class="mpre">GHC.Real</span></span><span class="mpre">
import Data.Maybe
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 70, srcSpanStartColumn = 8, srcSpanEndLine = 70, srcSpanEndColumn = 21}, srcInfoPoints = []}) &quot;Data.Typeable&quot;"><span class="mpre">Data.Typeable</span></span><span class="mpre">
import Control.Monad

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Closing a handle</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Computation &#39;hClose&#39; @hdl@ makes handle @hdl@ closed.  Before the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- computation finishes, if @hdl@ is writable its buffer is flushed as</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- for &#39;hFlush&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Performing &#39;hClose&#39; on a handle that has already been closed has no effect; </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- doing so is not an error.  All other operations on a closed handle will fail.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If &#39;hClose&#39; fails for any reason, any further operations (apart from</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;hClose&#39;) on the handle will still fail as if @hdl@ had been successfully</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- closed.</span></span><span class="mpre">

</span><a href="#loc_86_1_86_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_1_86_7&#39;)"><span class="mpre">hClose</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_86_1_86_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_1_86_7&#39;)"><span class="hl_fundecl"><span class="mpre">hClose</span></span></a><span class="mpre"> </span><a name="loc_86_8_86_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_8_86_9&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">FileHandle</span></span><span class="mpre"> _ </span><a name="loc_86_24_86_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_24_86_25&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">)     = do 
  </span><a name="loc_87_3_87_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_3_87_9&#39;)"><span class="hl_vardecl"><span class="mpre">mb_exc</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_104_1_104_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_8&#39;)"><span class="hl_varref"><span class="mpre">hClose&#39;</span></span></a><span class="mpre"> </span><a href="#loc_86_8_86_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_8_86_9&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_86_24_86_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_24_86_25&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
  </span><a href="#loc_94_1_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_18&#39;)"><span class="hl_varref"><span class="mpre">hClose_maybethrow</span></span></a><span class="mpre"> </span><a href="#loc_87_3_87_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_3_87_9&#39;)"><span class="hl_varref"><span class="mpre">mb_exc</span></span></a><span class="mpre"> </span><a href="#loc_86_8_86_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_8_86_9&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
</span><a href="#loc_86_1_86_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_1_86_7&#39;)"><span class="hl_fundecl"><span class="mpre">hClose</span></span></a><span class="mpre"> </span><a name="loc_89_8_89_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_8_89_9&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">DuplexHandle</span></span><span class="mpre"> _ </span><a name="loc_89_26_89_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_26_89_27&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> </span><a name="loc_89_28_89_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_28_89_29&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre">) = do
  </span><a name="loc_90_3_90_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_3_90_7&#39;)"><span class="hl_vardecl"><span class="mpre">excs</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.html#loc_111_1_111_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_111_1_111_5&#39;)"><span class="hl_varref"><span class="mpre">mapM</span></span></a><span class="mpre"> (</span><a href="#loc_104_1_104_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_8&#39;)"><span class="hl_varref"><span class="mpre">hClose&#39;</span></span></a><span class="mpre"> </span><a href="#loc_89_8_89_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_8_89_9&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">) [</span><a href="#loc_89_26_89_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_26_89_27&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">,</span><a href="#loc_89_28_89_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_28_89_29&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">]
  </span><a href="#loc_94_1_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_18&#39;)"><span class="hl_varref"><span class="mpre">hClose_maybethrow</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_109_1_109_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_109_1_109_12&#39;)"><span class="hl_varref"><span class="mpre">listToMaybe</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_115_1_115_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_115_1_115_10&#39;)"><span class="hl_varref"><span class="mpre">catMaybes</span></span></a><span class="mpre"> </span><a href="#loc_90_3_90_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_3_90_7&#39;)"><span class="hl_varref"><span class="mpre">excs</span></span></a><span class="mpre">)) </span><a href="#loc_89_8_89_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_8_89_9&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">

</span><a href="#loc_94_1_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_18&#39;)"><span class="mpre">hClose_maybethrow</span></a><span class="mpre"> :: </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">SomeException</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_94_1_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_18&#39;)"><span class="hl_fundecl"><span class="mpre">hClose_maybethrow</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">  </span><span class="hl_vardecl"><span class="mpre">h</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
</span><a href="#loc_94_1_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_18&#39;)"><span class="hl_fundecl"><span class="mpre">hClose_maybethrow</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_95_25_95_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_25_95_26&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre">) </span><a name="loc_95_28_95_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_28_95_29&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> = </span><a href="#loc_98_1_98_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_15&#39;)"><span class="hl_varref"><span class="mpre">hClose_rethrow</span></span></a><span class="mpre"> </span><a href="#loc_95_25_95_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_25_95_26&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> </span><a href="#loc_95_28_95_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_28_95_29&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">

</span><a href="#loc_98_1_98_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_15&#39;)"><span class="mpre">hClose_rethrow</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">SomeException</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_98_1_98_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_15&#39;)"><span class="hl_fundecl"><span class="mpre">hClose_rethrow</span></span></a><span class="mpre"> </span><a name="loc_98_16_98_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_16_98_17&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> </span><a name="loc_98_18_98_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_18_98_19&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> = 
  case </span><span class="hl_varref"><span class="mpre">fromException</span></span><span class="mpre"> </span><a href="#loc_98_16_98_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_16_98_17&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> of
    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_100_10_100_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_10_100_13&#39;)"><span class="hl_vardecl"><span class="mpre">ioe</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">ioError</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">augmentIOError</span></span><span class="mpre"> </span><a href="#loc_100_10_100_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_10_100_13&#39;)"><span class="hl_varref"><span class="mpre">ioe</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hClose&quot;</span></span><span class="mpre"> </span><a href="#loc_98_18_98_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_18_98_19&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">)
    </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">  -&gt; </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="#loc_98_16_98_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_16_98_17&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">

</span><a href="#loc_104_1_104_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_8&#39;)"><span class="mpre">hClose&#39;</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">MVar</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Handle__</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">SomeException</span></span><span class="mpre">)
</span><a name="loc_104_1_104_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_8&#39;)"><span class="hl_fundecl"><span class="mpre">hClose&#39;</span></span></a><span class="mpre"> </span><a name="loc_104_9_104_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_9_104_10&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_104_11_104_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_11_104_12&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">withHandle&#39;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hClose&quot;</span></span><span class="mpre"> </span><a href="#loc_104_9_104_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_9_104_10&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_104_11_104_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_11_104_12&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">hClose_help</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Detecting and changing the size of a file</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | For a handle @hdl@ which attached to a physical file,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;hFileSize&#39; @hdl@ returns the size of that file in 8-bit bytes.</span></span><span class="mpre">

</span><a href="#loc_113_1_113_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_1_113_10&#39;)"><span class="mpre">hFileSize</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">
</span><a name="loc_113_1_113_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_1_113_10&#39;)"><span class="hl_fundecl"><span class="mpre">hFileSize</span></span></a><span class="mpre"> </span><a name="loc_113_11_113_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_11_113_17&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> =
    </span><span class="hl_varref"><span class="mpre">withHandle_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hFileSize&quot;</span></span><span class="mpre"> </span><a href="#loc_113_11_113_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_11_113_17&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_114_40_114_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_40_114_47&#39;)"><span class="hl_specname"><span class="mpre">handle_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 114, srcSpanStartColumn = 48, srcSpanEndLine = 114, srcSpanEndColumn = 70}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 114, srcSpanStartColumn = 56, srcSpanEndLine = 114, srcSpanEndColumn = 57},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 114, srcSpanSt"><span class="mpre">Handle__{haDevice=dev}</span></span><span class="mpre"> -&gt; do
    case </span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> </span><a href="#loc_114_40_114_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_40_114_47&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> of 
      </span><span class="hl_conref"><span class="mpre">ClosedHandle</span></span><span class="mpre">              -&gt; </span><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span><span class="mpre">
      </span><span class="hl_conref"><span class="mpre">SemiClosedHandle</span></span><span class="mpre">          -&gt; </span><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span><span class="mpre">
      _ -&gt; do </span><span class="hl_varref"><span class="mpre">flushWriteBuffer</span></span><span class="mpre"> </span><a href="#loc_114_40_114_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_40_114_47&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">
              </span><a name="loc_119_15_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_15_119_16&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Device.html#loc_90_3_90_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_90_3_90_10&#39;)"><span class="hl_varref"><span class="mpre">IODevice.getSize</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">dev</span></span><span class="mpre">
              if </span><a href="#loc_119_15_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_15_119_16&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> -</span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
                 then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_119_15_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_15_119_16&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
                 else </span><span class="hl_varref"><span class="mpre">ioException</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">IOError</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">InappropriateType</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hFileSize&quot;</span></span><span class="mpre">
                                   </span><span class="hl_string"><span class="mpre">&quot;not a regular file&quot;</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">-- | &#39;hSetFileSize&#39; @hdl@ @size@ truncates the physical file with handle @hdl@ to @size@ bytes.</span></span><span class="mpre">

</span><a href="#loc_129_1_129_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_13&#39;)"><span class="mpre">hSetFileSize</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_129_1_129_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_13&#39;)"><span class="hl_fundecl"><span class="mpre">hSetFileSize</span></span></a><span class="mpre"> </span><a name="loc_129_14_129_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_14_129_20&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_129_21_129_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_21_129_25&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> =
    </span><span class="hl_varref"><span class="mpre">withHandle_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hSetFileSize&quot;</span></span><span class="mpre"> </span><a href="#loc_129_14_129_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_14_129_20&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_130_43_130_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_43_130_50&#39;)"><span class="hl_specname"><span class="mpre">handle_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 130, srcSpanStartColumn = 51, srcSpanEndLine = 130, srcSpanEndColumn = 73}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 130, srcSpanStartColumn = 59, srcSpanEndLine = 130, srcSpanEndColumn = 60},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 130, srcSpanSt"><span class="mpre">Handle__{haDevice=dev}</span></span><span class="mpre"> -&gt; do
    case </span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> </span><a href="#loc_130_43_130_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_43_130_50&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> of 
      </span><span class="hl_conref"><span class="mpre">ClosedHandle</span></span><span class="mpre">              -&gt; </span><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span><span class="mpre">
      </span><span class="hl_conref"><span class="mpre">SemiClosedHandle</span></span><span class="mpre">          -&gt; </span><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span><span class="mpre">
      _ -&gt; do </span><span class="hl_varref"><span class="mpre">flushWriteBuffer</span></span><span class="mpre"> </span><a href="#loc_130_43_130_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_43_130_50&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">
              </span><a href="GHC.IO.Device.html#loc_94_3_94_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_94_3_94_10&#39;)"><span class="hl_varref"><span class="mpre">IODevice.setSize</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">dev</span></span><span class="mpre"> </span><a href="#loc_129_21_129_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_21_129_25&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">
              </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Detecting the End of Input</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | For a readable handle @hdl@, &#39;hIsEOF&#39; @hdl@ returns</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;True&#39; if no further input can be taken from @hdl@ or for a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- physical file, if the current I\/O position is equal to the length of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the file.  Otherwise, it returns &#39;False&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- NOTE: &#39;hIsEOF&#39; may block, because it has to attempt to read from</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the stream to determine whether there is any more data to be read.</span></span><span class="mpre">

</span><a href="#loc_150_1_150_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_1_150_7&#39;)"><span class="mpre">hIsEOF</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_150_1_150_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_1_150_7&#39;)"><span class="hl_fundecl"><span class="mpre">hIsEOF</span></span></a><span class="mpre"> </span><a name="loc_150_8_150_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_8_150_14&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">wantReadableHandle_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hIsEOF&quot;</span></span><span class="mpre"> </span><a href="#loc_150_8_150_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_8_150_14&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 150, srcSpanStartColumn = 56, srcSpanEndLine = 150, srcSpanEndColumn = 68}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 150, srcSpanStartColumn = 64, srcSpanEndLine = 150, srcSpanEndColumn = 65},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 150, srcSpanSt"><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; do

  </span><a name="loc_152_3_152_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_3_152_7&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readIORef</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haCharBuffer</span></span><span class="mpre">
  if </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span><span class="mpre"> </span><a href="#loc_152_3_152_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_3_152_7&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre">) then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> else do

  </span><a name="loc_155_3_155_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_3_155_7&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readIORef</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haByteBuffer</span></span><span class="mpre">
  if </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span><span class="mpre"> </span><a href="#loc_155_3_155_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_3_155_7&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre">) then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> else do

  </span><span class="hl_comment"><span class="mpre">-- NB. do no decoding, just fill the byte buffer; see #3808</span></span><span class="mpre">
  (</span><a name="loc_159_4_159_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_4_159_5&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">,</span><a name="loc_159_6_159_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_6_159_11&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf&#39;</span></span></a><span class="mpre">) &lt;- </span><span class="hl_varref"><span class="mpre">Buffered.fillReadBuffer</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haDevice</span></span><span class="mpre"> </span><a href="#loc_155_3_155_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_3_155_7&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre">
  if </span><a href="#loc_159_4_159_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_4_159_5&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
     then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
     else do </span><span class="hl_varref"><span class="mpre">writeIORef</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haByteBuffer</span></span><span class="mpre"> </span><a href="#loc_159_6_159_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_6_159_11&#39;)"><span class="hl_varref"><span class="mpre">bbuf&#39;</span></span></a><span class="mpre">
             </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Looking ahead</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Computation &#39;hLookAhead&#39; returns the next character from the handle</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- without removing it from the input buffer, blocking until a character</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is available.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This operation may fail with:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isEOFError&#39; if the end of file has been reached.</span></span><span class="mpre">

</span><a href="#loc_177_1_177_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_11&#39;)"><span class="mpre">hLookAhead</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">
</span><a name="loc_177_1_177_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_11&#39;)"><span class="hl_fundecl"><span class="mpre">hLookAhead</span></span></a><span class="mpre"> </span><a name="loc_177_12_177_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_12_177_18&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> =
  </span><span class="hl_varref"><span class="mpre">wantReadableHandle_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hLookAhead&quot;</span></span><span class="mpre">  </span><a href="#loc_177_12_177_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_12_177_18&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">hLookAhead_</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Buffering Operations</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Three kinds of buffering are supported: line-buffering,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- block-buffering or no-buffering.  See GHC.IO.Handle for definition and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- further explanation of what the type represent.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Computation &#39;hSetBuffering&#39; @hdl mode@ sets the mode of buffering for</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- handle @hdl@ on subsequent reads and writes.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If the buffer mode is changed from &#39;BlockBuffering&#39; or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;LineBuffering&#39; to &#39;NoBuffering&#39;, then</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * if @hdl@ is writable, the buffer is flushed as for &#39;hFlush&#39;;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * if @hdl@ is not writable, the contents of the buffer is discarded.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This operation may fail with:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isPermissionError&#39; if the handle has already been used for reading</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    or writing and the implementation does not allow the buffering mode</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    to be changed.</span></span><span class="mpre">

</span><a href="#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_1_204_14&#39;)"><span class="mpre">hSetBuffering</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">BufferMode</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_204_1_204_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_1_204_14&#39;)"><span class="hl_fundecl"><span class="mpre">hSetBuffering</span></span></a><span class="mpre"> </span><a name="loc_204_15_204_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_15_204_21&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_204_22_204_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_22_204_26&#39;)"><span class="hl_vardecl"><span class="mpre">mode</span></span></a><span class="mpre"> =
  </span><span class="hl_varref"><span class="mpre">withAllHandles__</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hSetBuffering&quot;</span></span><span class="mpre"> </span><a href="#loc_204_15_204_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_15_204_21&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_205_47_205_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_47_205_54&#39;)"><span class="hl_specname"><span class="mpre">handle_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 205, srcSpanStartColumn = 55, srcSpanEndLine = 205, srcSpanEndColumn = 67}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 205, srcSpanStartColumn = 63, srcSpanEndLine = 205, srcSpanEndColumn = 64},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 205, srcSpanSt"><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; do
  case </span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> of
    </span><span class="hl_conref"><span class="mpre">ClosedHandle</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span><span class="mpre">
    _ -&gt; do
         if </span><a href="#loc_204_22_204_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_22_204_26&#39;)"><span class="hl_varref"><span class="mpre">mode</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haBufferMode</span></span><span class="mpre"> then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_205_47_205_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_47_205_54&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> else do

         </span><span class="hl_comment"><span class="mpre">-- See [note Buffer Sizing] in GHC.IO.Handle.Types</span></span><span class="mpre">

          </span><span class="hl_comment"><span class="mpre">-- check for errors:</span></span><span class="mpre">
          case </span><a href="#loc_204_22_204_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_22_204_26&#39;)"><span class="hl_varref"><span class="mpre">mode</span></span></a><span class="mpre"> of
              </span><span class="hl_conref"><span class="mpre">BlockBuffering</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_215_36_215_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_36_215_37&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">) | </span><a href="#loc_215_36_215_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_36_215_37&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">    -&gt; </span><span class="hl_varref"><span class="mpre">ioe_bufsiz</span></span><span class="mpre"> </span><a href="#loc_215_36_215_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_36_215_37&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
              _ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

          </span><span class="hl_comment"><span class="mpre">-- for input terminals we need to put the terminal into</span></span><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- cooked or raw mode depending on the type of buffering.</span></span><span class="mpre">
          </span><a name="loc_220_11_220_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_11_220_17&#39;)"><span class="hl_vardecl"><span class="mpre">is_tty</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Device.html#loc_74_3_74_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_74_3_74_13&#39;)"><span class="hl_varref"><span class="mpre">IODevice.isTerminal</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haDevice</span></span><span class="mpre">
          </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_220_11_220_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_11_220_17&#39;)"><span class="hl_varref"><span class="mpre">is_tty</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">isReadableHandleType</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
                case </span><a href="#loc_204_22_204_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_22_204_26&#39;)"><span class="hl_varref"><span class="mpre">mode</span></span></a><span class="mpre"> of
#ifndef mingw32_HOST_OS
        </span><span class="hl_comment"><span class="mpre">-- &#39;raw&#39; mode under win32 is a bit too specialised (and troublesome</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- for most common uses), so simply disable its use here.</span></span><span class="mpre">
                  </span><span class="hl_conref"><span class="mpre">NoBuffering</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Device.html#loc_109_3_109_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_109_3_109_9&#39;)"><span class="hl_varref"><span class="mpre">IODevice.setRaw</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haDevice</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
#else
                  </span><span class="hl_conref"><span class="mpre">NoBuffering</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
#endif
                  _           -&gt; </span><a href="GHC.IO.Device.html#loc_109_3_109_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_109_3_109_9&#39;)"><span class="hl_varref"><span class="mpre">IODevice.setRaw</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haDevice</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

          </span><span class="hl_comment"><span class="mpre">-- throw away spare buffers, they might be the wrong size</span></span><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">writeIORef</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haBuffers</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">BufferListNil</span></span><span class="mpre">

          </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 235, srcSpanStartColumn = 18, srcSpanEndLine = 235, srcSpanEndColumn = 52}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 235, srcSpanStartColumn = 26, srcSpanEndLine = 235, srcSpanEndColumn = 27},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 235, srcS"><span class="mpre">Handle__{ haBufferMode = mode,.. }</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- hSetEncoding</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | The action &#39;hSetEncoding&#39; @hdl@ @encoding@ changes the text encoding</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- for the handle @hdl@ to @encoding@.  The default encoding when a &#39;Handle&#39; is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- created is &#39;localeEncoding&#39;, namely the default encoding for the current</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- locale.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- To create a &#39;Handle&#39; with no encoding at all, use &#39;openBinaryFile&#39;.  To</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- stop further encoding or decoding on an existing &#39;Handle&#39;, use</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;hSetBinaryMode&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;hSetEncoding&#39; may need to flush buffered data in order to change</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the encoding.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_253_1_253_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_1_253_13&#39;)"><span class="mpre">hSetEncoding</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">TextEncoding</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_253_1_253_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_1_253_13&#39;)"><span class="hl_fundecl"><span class="mpre">hSetEncoding</span></span></a><span class="mpre"> </span><a name="loc_253_14_253_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_14_253_17&#39;)"><span class="hl_vardecl"><span class="mpre">hdl</span></span></a><span class="mpre"> </span><a name="loc_253_18_253_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_18_253_26&#39;)"><span class="hl_vardecl"><span class="mpre">encoding</span></span></a><span class="mpre"> = do
  </span><span class="hl_varref"><span class="mpre">withAllHandles__</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hSetEncoding&quot;</span></span><span class="mpre"> </span><a href="#loc_253_14_253_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_14_253_17&#39;)"><span class="hl_varref"><span class="mpre">hdl</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_254_42_254_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_42_254_44&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 254, srcSpanStartColumn = 45, srcSpanEndLine = 254, srcSpanEndColumn = 57}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 254, srcSpanStartColumn = 53, srcSpanEndLine = 254, srcSpanEndColumn = 54},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 254, srcSpanSt"><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">flushCharBuffer</span></span><span class="mpre"> </span><a href="#loc_254_42_254_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_42_254_44&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">closeTextCodecs</span></span><span class="mpre"> </span><a href="#loc_254_42_254_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_42_254_44&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">openTextEncoding</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_253_18_253_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_18_253_26&#39;)"><span class="hl_varref"><span class="mpre">encoding</span></span></a><span class="mpre">) </span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><span class="hl_vardecl"><span class="mpre">mb_encoder</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">mb_decoder</span></span><span class="mpre"> -&gt; do
    </span><span class="hl_vardecl"><span class="mpre">bbuf</span></span><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readIORef</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haByteBuffer</span></span><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">ref</span></span><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newIORef</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;last_decode&quot;</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 260, srcSpanStartColumn = 13, srcSpanEndLine = 263, srcSpanEndColumn = 54}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 260, srcSpanStartColumn = 21, srcSpanEndLine = 260, srcSpanEndColumn = 22},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 260, srcS"><span class="mpre">Handle__{ haLastDecode = ref, 
                      haDecoder = mb_decoder, 
                      haEncoder = mb_encoder,
                      haCodec   = Just encoding, .. }</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Return the current &#39;TextEncoding&#39; for the specified &#39;Handle&#39;, or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Nothing&#39; if the &#39;Handle&#39; is in binary mode.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that the &#39;TextEncoding&#39; remembers nothing about the state of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the encoder/decoder in use on this &#39;Handle&#39;.  For example, if the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- encoding in use is UTF-16, then using &#39;hGetEncoding&#39; and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;hSetEncoding&#39; to save and restore the encoding may result in an</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- extra byte-order-mark being written to the file.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_275_1_275_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_275_1_275_13&#39;)"><span class="mpre">hGetEncoding</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">TextEncoding</span></span><span class="mpre">)
</span><a name="loc_275_1_275_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_275_1_275_13&#39;)"><span class="hl_fundecl"><span class="mpre">hGetEncoding</span></span></a><span class="mpre"> </span><a name="loc_275_14_275_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_275_14_275_17&#39;)"><span class="hl_vardecl"><span class="mpre">hdl</span></span></a><span class="mpre"> =
  </span><span class="hl_varref"><span class="mpre">withHandle_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hGetEncoding&quot;</span></span><span class="mpre"> </span><a href="#loc_275_14_275_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_275_14_275_17&#39;)"><span class="hl_varref"><span class="mpre">hdl</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><span class="hl_specname"><span class="mpre">h_</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 276, srcSpanStartColumn = 40, srcSpanEndLine = 276, srcSpanEndColumn = 52}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 276, srcSpanStartColumn = 48, srcSpanEndLine = 276, srcSpanEndColumn = 49},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 276, srcSpanSt"><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haCodec</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- hFlush</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | The action &#39;hFlush&#39; @hdl@ causes any items buffered for output</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in handle @hdl@ to be sent immediately to the operating system.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This operation may fail with:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isFullError&#39; if the device is full;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isPermissionError&#39; if a system resource limit would be exceeded.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    It is unspecified whether the characters in the buffer are discarded</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    or retained under these circumstances.</span></span><span class="mpre">

</span><a href="#loc_293_1_293_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_1_293_7&#39;)"><span class="mpre">hFlush</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> 
</span><a name="loc_293_1_293_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_1_293_7&#39;)"><span class="hl_fundecl"><span class="mpre">hFlush</span></span></a><span class="mpre"> </span><a name="loc_293_8_293_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_8_293_14&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">wantWritableHandle</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hFlush&quot;</span></span><span class="mpre"> </span><a href="#loc_293_8_293_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_8_293_14&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">flushWriteBuffer</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | The action &#39;hFlushAll&#39; @hdl@ flushes all buffered data in @hdl@,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- including any buffered read data.  Buffered read data is flushed</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- by seeking the file position back to the point before the bufferred</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- data was read, and hence only works if @hdl@ is seekable (see</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;hIsSeekable&#39;).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This operation may fail with:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isFullError&#39; if the device is full;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isPermissionError&#39; if a system resource limit would be exceeded.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    It is unspecified whether the characters in the buffer are discarded</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    or retained under these circumstances;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isIllegalOperation&#39; if @hdl@ has buffered read data, and is not</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    seekable.</span></span><span class="mpre">

</span><a href="#loc_313_1_313_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_1_313_10&#39;)"><span class="mpre">hFlushAll</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> 
</span><a name="loc_313_1_313_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_1_313_10&#39;)"><span class="hl_fundecl"><span class="mpre">hFlushAll</span></span></a><span class="mpre"> </span><a name="loc_313_11_313_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_11_313_17&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">withHandle_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hFlushAll&quot;</span></span><span class="mpre"> </span><a href="#loc_313_11_313_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_11_313_17&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">flushBuffer</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Repositioning Handles</span></span><span class="mpre">

data </span><a name="loc_318_6_318_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_6_318_16&#39;)"><span class="hl_tycondecl"><span class="mpre">HandlePosn</span></span></a><span class="mpre"> = </span><a name="loc_318_19_318_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_19_318_29&#39;)"><span class="hl_condecl"><span class="mpre">HandlePosn</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HandlePosition</span></span><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Eq</span></span><span class="mpre"> </span><a href="#loc_318_6_318_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_6_318_16&#39;)"><span class="hl_tyconref"><span class="mpre">HandlePosn</span></span></a><span class="mpre"> where
    (</span><a href="#loc_318_19_318_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_19_318_29&#39;)"><span class="hl_conref"><span class="mpre">HandlePosn</span></span></a><span class="mpre"> </span><a name="loc_321_17_321_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_17_321_19&#39;)"><span class="hl_vardecl"><span class="mpre">h1</span></span></a><span class="mpre"> </span><a name="loc_321_20_321_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_20_321_22&#39;)"><span class="hl_vardecl"><span class="mpre">p1</span></span></a><span class="mpre">) </span><span class="hl_fundecl"><span class="mpre">==</span></span><span class="mpre"> (</span><a href="#loc_318_19_318_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_19_318_29&#39;)"><span class="hl_conref"><span class="mpre">HandlePosn</span></span></a><span class="mpre"> </span><a name="loc_321_39_321_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_39_321_41&#39;)"><span class="hl_vardecl"><span class="mpre">h2</span></span></a><span class="mpre"> </span><a name="loc_321_42_321_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_42_321_44&#39;)"><span class="hl_vardecl"><span class="mpre">p2</span></span></a><span class="mpre">) = </span><a href="#loc_321_20_321_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_20_321_22&#39;)"><span class="hl_varref"><span class="mpre">p1</span></span></a><span class="hl_infix"><span class="mpre">==</span></span><a href="#loc_321_42_321_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_42_321_44&#39;)"><span class="hl_varref"><span class="mpre">p2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_321_17_321_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_17_321_19&#39;)"><span class="hl_varref"><span class="mpre">h1</span></span></a><span class="hl_infix"><span class="mpre">==</span></span><a href="#loc_321_39_321_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_39_321_41&#39;)"><span class="hl_varref"><span class="mpre">h2</span></span></a><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Show</span></span><span class="mpre"> </span><a href="#loc_318_6_318_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_6_318_16&#39;)"><span class="hl_tyconref"><span class="mpre">HandlePosn</span></span></a><span class="mpre"> where
   </span><span class="hl_fundecl"><span class="mpre">showsPrec</span></span><span class="mpre"> </span><a name="loc_324_14_324_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_14_324_15&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> (</span><a href="#loc_318_19_318_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_19_318_29&#39;)"><span class="hl_conref"><span class="mpre">HandlePosn</span></span></a><span class="mpre"> </span><a name="loc_324_28_324_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_28_324_29&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_324_30_324_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_30_324_33&#39;)"><span class="hl_vardecl"><span class="mpre">pos</span></span></a><span class="mpre">) = 
        </span><span class="hl_varref"><span class="mpre">showsPrec</span></span><span class="mpre"> </span><a href="#loc_324_14_324_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_14_324_15&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_324_28_324_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_28_324_29&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">showString</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; at position &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">shows</span></span><span class="mpre"> </span><a href="#loc_324_30_324_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_30_324_33&#39;)"><span class="hl_varref"><span class="mpre">pos</span></span></a><span class="mpre">

  </span><span class="hl_comment"><span class="mpre">-- HandlePosition is the Haskell equivalent of POSIX&#39; off_t.</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- We represent it as an Integer on the Haskell side, but</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- cheat slightly in that hGetPosn calls upon a C helper</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- that reports the position back via (merely) an Int.</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 331, srcSpanStartColumn = 1, srcSpanEndLine = 331, srcSpanEndColumn = 30}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 331, srcSpanStartColumn = 1, srcSpanEndLine = 331, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 331, srcSpanS"><span class="mpre">type HandlePosition = Integer</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Computation &#39;hGetPosn&#39; @hdl@ returns the current I\/O position of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @hdl@ as a value of the abstract type &#39;HandlePosn&#39;.</span></span><span class="mpre">

</span><a href="#loc_337_1_337_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_337_1_337_9&#39;)"><span class="mpre">hGetPosn</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_318_6_318_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_6_318_16&#39;)"><span class="hl_tyconref"><span class="mpre">HandlePosn</span></span></a><span class="mpre">
</span><a name="loc_337_1_337_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_337_1_337_9&#39;)"><span class="hl_fundecl"><span class="mpre">hGetPosn</span></span></a><span class="mpre"> </span><a name="loc_337_10_337_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_337_10_337_16&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> = do
    </span><a name="loc_338_5_338_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_5_338_9&#39;)"><span class="hl_vardecl"><span class="mpre">posn</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_417_1_417_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_1_417_6&#39;)"><span class="hl_varref"><span class="mpre">hTell</span></span></a><span class="mpre"> </span><a href="#loc_337_10_337_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_337_10_337_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_318_19_318_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_19_318_29&#39;)"><span class="hl_conref"><span class="mpre">HandlePosn</span></span></a><span class="mpre"> </span><a href="#loc_337_10_337_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_337_10_337_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_338_5_338_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_5_338_9&#39;)"><span class="hl_varref"><span class="mpre">posn</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | If a call to &#39;hGetPosn&#39; @hdl@ returns a position @p@,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- then computation &#39;hSetPosn&#39; @p@ sets the position of @hdl@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to the position it held at the time of the call to &#39;hGetPosn&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This operation may fail with:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isPermissionError&#39; if a system resource limit would be exceeded.</span></span><span class="mpre">

</span><a href="#loc_350_1_350_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_1_350_9&#39;)"><span class="mpre">hSetPosn</span></a><span class="mpre"> :: </span><a href="#loc_318_6_318_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_6_318_16&#39;)"><span class="hl_tyconref"><span class="mpre">HandlePosn</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> 
</span><a name="loc_350_1_350_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_1_350_9&#39;)"><span class="hl_fundecl"><span class="mpre">hSetPosn</span></span></a><span class="mpre"> (</span><a href="#loc_318_19_318_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_19_318_29&#39;)"><span class="hl_conref"><span class="mpre">HandlePosn</span></span></a><span class="mpre"> </span><a name="loc_350_22_350_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_22_350_23&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_350_24_350_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_24_350_25&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">) = </span><a href="#loc_386_1_386_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_1_386_6&#39;)"><span class="hl_varref"><span class="mpre">hSeek</span></span></a><span class="mpre"> </span><a href="#loc_350_22_350_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_22_350_23&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="GHC.IO.Device.html#loc_165_5_165_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_165_5_165_17&#39;)"><span class="hl_conref"><span class="mpre">AbsoluteSeek</span></span></a><span class="mpre"> </span><a href="#loc_350_24_350_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_24_350_25&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- hSeek</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{- Note: 
 - when seeking using `SeekFromEnd&#39;, positive offsets (&gt;=0) means
   seeking at or past EOF.

 - we possibly deviate from the report on the issue of seeking within
   the buffer and whether to flush it or not.  The report isn&#39;t exactly
   clear here.
-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Computation &#39;hSeek&#39; @hdl mode i@ sets the position of handle</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @hdl@ depending on @mode@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The offset @i@ is given in terms of 8-bit bytes.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If @hdl@ is block- or line-buffered, then seeking to a position which is not</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in the current buffer will first cause any items in the output buffer to be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- written to the device, and then cause the input buffer to be discarded.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Some handles may not be seekable (see &#39;hIsSeekable&#39;), or only support a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- subset of the possible positioning operations (for instance, it may only</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- be possible to seek to the end of a tape, or to a positive offset from</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the beginning or current position).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- It is not possible to set a negative I\/O position, or for</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a physical file, an I\/O position beyond the current end-of-file.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This operation may fail with:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isIllegalOperationError&#39; if the Handle is not seekable, or does</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     not support the requested seek mode.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isPermissionError&#39; if a system resource limit would be exceeded.</span></span><span class="mpre">

</span><a href="#loc_386_1_386_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_1_386_6&#39;)"><span class="mpre">hSeek</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Device.html#loc_164_6_164_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_164_6_164_14&#39;)"><span class="hl_tyconref"><span class="mpre">SeekMode</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> 
</span><a name="loc_386_1_386_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_1_386_6&#39;)"><span class="hl_fundecl"><span class="mpre">hSeek</span></span></a><span class="mpre"> </span><a name="loc_386_7_386_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_7_386_13&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_386_14_386_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_14_386_18&#39;)"><span class="hl_vardecl"><span class="mpre">mode</span></span></a><span class="mpre"> </span><a name="loc_386_19_386_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_19_386_25&#39;)"><span class="hl_vardecl"><span class="mpre">offset</span></span></a><span class="mpre"> =
    </span><span class="hl_varref"><span class="mpre">wantSeekableHandle</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hSeek&quot;</span></span><span class="mpre"> </span><a href="#loc_386_7_386_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_7_386_13&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_387_43_387_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_43_387_50&#39;)"><span class="hl_specname"><span class="mpre">handle_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 387, srcSpanStartColumn = 51, srcSpanEndLine = 387, srcSpanEndColumn = 63}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 387, srcSpanStartColumn = 59, srcSpanEndLine = 387, srcSpanEndColumn = 60},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 387, srcSpanSt"><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">debugIO</span></span><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;hSeek &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><a href="#loc_386_14_386_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_14_386_18&#39;)"><span class="hl_varref"><span class="mpre">mode</span></span></a><span class="mpre">,</span><a href="#loc_386_19_386_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_19_386_25&#39;)"><span class="hl_varref"><span class="mpre">offset</span></span></a><span class="mpre">))
    </span><a name="loc_389_5_389_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_5_389_8&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readIORef</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haCharBuffer</span></span><span class="mpre">

    if </span><span class="hl_varref"><span class="mpre">isWriteBuffer</span></span><span class="mpre"> </span><a href="#loc_389_5_389_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_5_389_8&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
        then do </span><span class="hl_varref"><span class="mpre">flushWriteBuffer</span></span><span class="mpre"> </span><a href="#loc_387_43_387_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_43_387_50&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">
                </span><a href="GHC.IO.Device.html#loc_82_3_82_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_82_3_82_7&#39;)"><span class="hl_varref"><span class="mpre">IODevice.seek</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haDevice</span></span><span class="mpre"> </span><a href="#loc_386_14_386_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_14_386_18&#39;)"><span class="hl_varref"><span class="mpre">mode</span></span></a><span class="mpre"> </span><a href="#loc_386_19_386_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_19_386_25&#39;)"><span class="hl_varref"><span class="mpre">offset</span></span></a><span class="mpre">
        else do

    let </span><a name="loc_396_9_396_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_9_396_10&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">bufL</span></span><span class="mpre"> </span><a href="#loc_389_5_389_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_5_389_8&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">; </span><a name="loc_396_23_396_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_23_396_24&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">bufR</span></span><span class="mpre"> </span><a href="#loc_389_5_389_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_5_389_8&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
    if </span><a href="#loc_386_14_386_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_14_386_18&#39;)"><span class="hl_varref"><span class="mpre">mode</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="GHC.IO.Device.html#loc_166_5_166_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_166_5_166_17&#39;)"><span class="hl_conref"><span class="mpre">RelativeSeek</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_85_1_85_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_85_1_85_10&#39;)"><span class="hl_varref"><span class="mpre">isNothing</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haDecoder</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> 
       </span><a href="#loc_386_19_386_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_19_386_25&#39;)"><span class="hl_varref"><span class="mpre">offset</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_386_19_386_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_19_386_25&#39;)"><span class="hl_varref"><span class="mpre">offset</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_396_23_396_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_23_396_24&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_396_9_396_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_9_396_10&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">)
        then </span><span class="hl_varref"><span class="mpre">writeIORef</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haCharBuffer</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 399, srcSpanStartColumn = 38, srcSpanEndLine = 399, srcSpanEndColumn = 75}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 399, srcSpanStartColumn = 41, srcSpanEndLine = 399, srcSpanEndColumn = 42},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 399, srcS"><span class="mpre">buf{ bufL = r + fromIntegral offset }</span></span><span class="mpre">
        else do 

    </span><span class="hl_varref"><span class="mpre">flushCharReadBuffer</span></span><span class="mpre"> </span><a href="#loc_387_43_387_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_43_387_50&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">flushByteReadBuffer</span></span><span class="mpre"> </span><a href="#loc_387_43_387_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_43_387_50&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">
    </span><a href="GHC.IO.Device.html#loc_82_3_82_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_82_3_82_7&#39;)"><span class="hl_varref"><span class="mpre">IODevice.seek</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haDevice</span></span><span class="mpre"> </span><a href="#loc_386_14_386_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_14_386_18&#39;)"><span class="hl_varref"><span class="mpre">mode</span></span></a><span class="mpre"> </span><a href="#loc_386_19_386_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_19_386_25&#39;)"><span class="hl_varref"><span class="mpre">offset</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | Computation &#39;hTell&#39; @hdl@ returns the current position of the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- handle @hdl@, as the number of bytes from the beginning of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the file.  The value returned may be subsequently passed to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;hSeek&#39; to reposition the handle to the current position.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This operation may fail with:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isIllegalOperationError&#39; if the Handle is not seekable.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_417_1_417_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_1_417_6&#39;)"><span class="mpre">hTell</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">
</span><a name="loc_417_1_417_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_1_417_6&#39;)"><span class="hl_fundecl"><span class="mpre">hTell</span></span></a><span class="mpre"> </span><a name="loc_417_7_417_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_7_417_13&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> = 
    </span><span class="hl_varref"><span class="mpre">wantSeekableHandle</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hGetPosn&quot;</span></span><span class="mpre"> </span><a href="#loc_417_7_417_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_7_417_13&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_418_46_418_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_418_46_418_53&#39;)"><span class="hl_specname"><span class="mpre">handle_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 418, srcSpanStartColumn = 54, srcSpanEndLine = 418, srcSpanEndColumn = 66}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 418, srcSpanStartColumn = 62, srcSpanEndLine = 418, srcSpanEndColumn = 63},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 418, srcSpanSt"><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; do

      </span><a name="loc_420_7_420_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_7_420_11&#39;)"><span class="hl_vardecl"><span class="mpre">posn</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Device.html#loc_86_3_86_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_86_3_86_7&#39;)"><span class="hl_varref"><span class="mpre">IODevice.tell</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haDevice</span></span><span class="mpre">

      </span><span class="hl_comment"><span class="mpre">-- we can&#39;t tell the real byte offset if there are buffered</span></span><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">-- Chars, so must flush first:</span></span><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">flushCharBuffer</span></span><span class="mpre"> </span><a href="#loc_418_46_418_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_418_46_418_53&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">

      </span><a name="loc_426_7_426_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_426_7_426_11&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readIORef</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haByteBuffer</span></span><span class="mpre">

      let </span><a name="loc_428_11_428_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_11_428_20&#39;)"><span class="hl_vardecl"><span class="mpre">real_posn</span></span></a><span class="mpre">
           | </span><span class="hl_varref"><span class="mpre">isWriteBuffer</span></span><span class="mpre"> </span><a href="#loc_426_7_426_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_426_7_426_11&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre"> = </span><a href="#loc_420_7_420_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_7_420_11&#39;)"><span class="hl_varref"><span class="mpre">posn</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">bufferElems</span></span><span class="mpre"> </span><a href="#loc_426_7_426_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_426_7_426_11&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre">)
           | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">          = </span><a href="#loc_420_7_420_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_7_420_11&#39;)"><span class="hl_varref"><span class="mpre">posn</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">bufferElems</span></span><span class="mpre"> </span><a href="#loc_426_7_426_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_426_7_426_11&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre">)

      </span><a name="loc_432_7_432_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_432_7_432_11&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readIORef</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haCharBuffer</span></span><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">debugIO</span></span><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;\nhGetPosn: (posn, real_posn) = &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><a href="#loc_420_7_420_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_7_420_11&#39;)"><span class="hl_varref"><span class="mpre">posn</span></span></a><span class="mpre">, </span><a href="#loc_428_11_428_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_11_428_20&#39;)"><span class="hl_varref"><span class="mpre">real_posn</span></span></a><span class="mpre">))
      </span><span class="hl_varref"><span class="mpre">debugIO</span></span><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;   cbuf: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">summaryBuffer</span></span><span class="mpre"> </span><a href="#loc_432_7_432_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_432_7_432_11&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">
            </span><span class="hl_string"><span class="mpre">&quot;   bbuf: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">summaryBuffer</span></span><span class="mpre"> </span><a href="#loc_426_7_426_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_426_7_426_11&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre">)

      </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_428_11_428_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_11_428_20&#39;)"><span class="hl_varref"><span class="mpre">real_posn</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Handle Properties</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- A number of operations return information about the properties of a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- handle.  Each of these operations returns `True&#39; if the handle has</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the specified property, and `False&#39; otherwise.</span></span><span class="mpre">

</span><a href="#loc_447_1_447_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_1_447_8&#39;)"><span class="mpre">hIsOpen</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_447_1_447_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_1_447_8&#39;)"><span class="hl_fundecl"><span class="mpre">hIsOpen</span></span></a><span class="mpre"> </span><a name="loc_447_9_447_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_9_447_15&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> =
    </span><span class="hl_varref"><span class="mpre">withHandle_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hIsOpen&quot;</span></span><span class="mpre"> </span><a href="#loc_447_9_447_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_9_447_15&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_448_38_448_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_38_448_45&#39;)"><span class="hl_vardecl"><span class="mpre">handle_</span></span></a><span class="mpre"> -&gt; do
    case </span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> </span><a href="#loc_448_38_448_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_38_448_45&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> of 
      </span><span class="hl_conref"><span class="mpre">ClosedHandle</span></span><span class="mpre">         -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
      </span><span class="hl_conref"><span class="mpre">SemiClosedHandle</span></span><span class="mpre">     -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
      _                    -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">

</span><a href="#loc_455_1_455_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_1_455_10&#39;)"><span class="mpre">hIsClosed</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_455_1_455_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_1_455_10&#39;)"><span class="hl_fundecl"><span class="mpre">hIsClosed</span></span></a><span class="mpre"> </span><a name="loc_455_11_455_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_11_455_17&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> =
    </span><span class="hl_varref"><span class="mpre">withHandle_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hIsClosed&quot;</span></span><span class="mpre"> </span><a href="#loc_455_11_455_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_11_455_17&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_456_40_456_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_456_40_456_47&#39;)"><span class="hl_vardecl"><span class="mpre">handle_</span></span></a><span class="mpre"> -&gt; do
    case </span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> </span><a href="#loc_456_40_456_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_456_40_456_47&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> of 
      </span><span class="hl_conref"><span class="mpre">ClosedHandle</span></span><span class="mpre">         -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
      _                    -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{- not defined, nor exported, but mentioned
   here for documentation purposes:

    hSemiClosed :: Handle -&gt; IO Bool
    hSemiClosed h = do
       ho &lt;- hIsOpen h
       hc &lt;- hIsClosed h
       return (not (ho || hc))
-}</span></span><span class="mpre">

</span><a href="#loc_472_1_472_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_472_1_472_12&#39;)"><span class="mpre">hIsReadable</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_472_1_472_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_472_1_472_12&#39;)"><span class="hl_fundecl"><span class="mpre">hIsReadable</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">DuplexHandle</span></span><span class="mpre"> _ _ _) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
</span><a href="#loc_472_1_472_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_472_1_472_12&#39;)"><span class="hl_fundecl"><span class="mpre">hIsReadable</span></span></a><span class="mpre"> </span><a name="loc_473_13_473_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_13_473_19&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> =
    </span><span class="hl_varref"><span class="mpre">withHandle_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hIsReadable&quot;</span></span><span class="mpre"> </span><a href="#loc_473_13_473_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_13_473_19&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_474_42_474_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_474_42_474_49&#39;)"><span class="hl_vardecl"><span class="mpre">handle_</span></span></a><span class="mpre"> -&gt; do
    case </span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> </span><a href="#loc_474_42_474_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_474_42_474_49&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> of 
      </span><span class="hl_conref"><span class="mpre">ClosedHandle</span></span><span class="mpre">         -&gt; </span><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span><span class="mpre">
      </span><span class="hl_conref"><span class="mpre">SemiClosedHandle</span></span><span class="mpre">     -&gt; </span><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span><span class="mpre">
      </span><a name="loc_478_7_478_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_478_7_478_12&#39;)"><span class="hl_vardecl"><span class="mpre">htype</span></span></a><span class="mpre">                -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">isReadableHandleType</span></span><span class="mpre"> </span><a href="#loc_478_7_478_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_478_7_478_12&#39;)"><span class="hl_varref"><span class="mpre">htype</span></span></a><span class="mpre">)

</span><a href="#loc_481_1_481_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_481_1_481_12&#39;)"><span class="mpre">hIsWritable</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_481_1_481_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_481_1_481_12&#39;)"><span class="hl_fundecl"><span class="mpre">hIsWritable</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">DuplexHandle</span></span><span class="mpre"> _ _ _) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
</span><a href="#loc_481_1_481_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_481_1_481_12&#39;)"><span class="hl_fundecl"><span class="mpre">hIsWritable</span></span></a><span class="mpre"> </span><a name="loc_482_13_482_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_482_13_482_19&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> =
    </span><span class="hl_varref"><span class="mpre">withHandle_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hIsWritable&quot;</span></span><span class="mpre"> </span><a href="#loc_482_13_482_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_482_13_482_19&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_483_42_483_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_483_42_483_49&#39;)"><span class="hl_vardecl"><span class="mpre">handle_</span></span></a><span class="mpre"> -&gt; do
    case </span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> </span><a href="#loc_483_42_483_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_483_42_483_49&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> of 
      </span><span class="hl_conref"><span class="mpre">ClosedHandle</span></span><span class="mpre">         -&gt; </span><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span><span class="mpre">
      </span><span class="hl_conref"><span class="mpre">SemiClosedHandle</span></span><span class="mpre">     -&gt; </span><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span><span class="mpre">
      </span><a name="loc_487_7_487_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_487_7_487_12&#39;)"><span class="hl_vardecl"><span class="mpre">htype</span></span></a><span class="mpre">                -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">isWritableHandleType</span></span><span class="mpre"> </span><a href="#loc_487_7_487_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_487_7_487_12&#39;)"><span class="hl_varref"><span class="mpre">htype</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Computation &#39;hGetBuffering&#39; @hdl@ returns the current buffering mode</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- for @hdl@.</span></span><span class="mpre">

</span><a href="#loc_493_1_493_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_493_1_493_14&#39;)"><span class="mpre">hGetBuffering</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">BufferMode</span></span><span class="mpre">
</span><a name="loc_493_1_493_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_493_1_493_14&#39;)"><span class="hl_fundecl"><span class="mpre">hGetBuffering</span></span></a><span class="mpre"> </span><a name="loc_493_15_493_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_493_15_493_21&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> = 
    </span><span class="hl_varref"><span class="mpre">withHandle_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hGetBuffering&quot;</span></span><span class="mpre"> </span><a href="#loc_493_15_493_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_493_15_493_21&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_494_44_494_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_44_494_51&#39;)"><span class="hl_vardecl"><span class="mpre">handle_</span></span></a><span class="mpre"> -&gt; do
    case </span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> </span><a href="#loc_494_44_494_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_44_494_51&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> of 
      </span><span class="hl_conref"><span class="mpre">ClosedHandle</span></span><span class="mpre">         -&gt; </span><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span><span class="mpre">
      _ -&gt; 
           </span><span class="hl_comment"><span class="mpre">-- We&#39;re being non-standard here, and allow the buffering</span></span><span class="mpre">
           </span><span class="hl_comment"><span class="mpre">-- of a semi-closed handle to be queried.   -- sof 6/98</span></span><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">haBufferMode</span></span><span class="mpre"> </span><a href="#loc_494_44_494_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_44_494_51&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">)  </span><span class="hl_comment"><span class="mpre">-- could be stricter..</span></span><span class="mpre">

</span><a href="#loc_503_1_503_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_503_1_503_12&#39;)"><span class="mpre">hIsSeekable</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_503_1_503_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_503_1_503_12&#39;)"><span class="hl_fundecl"><span class="mpre">hIsSeekable</span></span></a><span class="mpre"> </span><a name="loc_503_13_503_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_503_13_503_19&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> =
    </span><span class="hl_varref"><span class="mpre">withHandle_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hIsSeekable&quot;</span></span><span class="mpre"> </span><a href="#loc_503_13_503_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_503_13_503_19&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><span class="hl_specname"><span class="mpre">handle_</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 504, srcSpanStartColumn = 50, srcSpanEndLine = 504, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 504, srcSpanStartColumn = 58, srcSpanEndLine = 504, srcSpanEndColumn = 59},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 504, srcSpanSt"><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; do
    case </span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> of 
      </span><span class="hl_conref"><span class="mpre">ClosedHandle</span></span><span class="mpre">         -&gt; </span><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span><span class="mpre">
      </span><span class="hl_conref"><span class="mpre">SemiClosedHandle</span></span><span class="mpre">     -&gt; </span><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span><span class="mpre">
      </span><span class="hl_conref"><span class="mpre">AppendHandle</span></span><span class="mpre">         -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
      _                    -&gt; </span><a href="GHC.IO.Device.html#loc_78_3_78_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_78_3_78_13&#39;)"><span class="hl_varref"><span class="mpre">IODevice.isSeekable</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haDevice</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Changing echo status (Non-standard GHC extensions)</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Set the echoing status of a handle connected to a terminal.</span></span><span class="mpre">

</span><a href="#loc_517_1_517_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_517_1_517_9&#39;)"><span class="mpre">hSetEcho</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_517_1_517_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_517_1_517_9&#39;)"><span class="hl_fundecl"><span class="mpre">hSetEcho</span></span></a><span class="mpre"> </span><a name="loc_517_10_517_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_517_10_517_16&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_517_17_517_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_517_17_517_19&#39;)"><span class="hl_vardecl"><span class="mpre">on</span></span></a><span class="mpre"> = do
    </span><a name="loc_518_5_518_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_518_5_518_8&#39;)"><span class="hl_vardecl"><span class="mpre">isT</span></span></a><span class="mpre">   &lt;- </span><a href="#loc_543_1_543_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_1_543_18&#39;)"><span class="hl_varref"><span class="mpre">hIsTerminalDevice</span></span></a><span class="mpre"> </span><a href="#loc_517_10_517_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_517_10_517_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">
    if </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><a href="#loc_518_5_518_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_518_5_518_8&#39;)"><span class="hl_varref"><span class="mpre">isT</span></span></a><span class="mpre">
     then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
     else
      </span><span class="hl_varref"><span class="mpre">withHandle_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hSetEcho&quot;</span></span><span class="mpre"> </span><a href="#loc_517_10_517_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_517_10_517_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 522, srcSpanStartColumn = 41, srcSpanEndLine = 522, srcSpanEndColumn = 53}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 522, srcSpanStartColumn = 49, srcSpanEndLine = 522, srcSpanEndColumn = 50},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 522, srcSpanSt"><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; do
      case </span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> of 
         </span><span class="hl_conref"><span class="mpre">ClosedHandle</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span><span class="mpre">
         _            -&gt; </span><a href="GHC.IO.Device.html#loc_99_3_99_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_99_3_99_10&#39;)"><span class="hl_varref"><span class="mpre">IODevice.setEcho</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haDevice</span></span><span class="mpre"> </span><a href="#loc_517_17_517_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_517_17_517_19&#39;)"><span class="hl_varref"><span class="mpre">on</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Get the echoing status of a handle connected to a terminal.</span></span><span class="mpre">

</span><a href="#loc_530_1_530_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_530_1_530_9&#39;)"><span class="mpre">hGetEcho</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_530_1_530_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_530_1_530_9&#39;)"><span class="hl_fundecl"><span class="mpre">hGetEcho</span></span></a><span class="mpre"> </span><a name="loc_530_10_530_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_530_10_530_16&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> = do
    </span><a name="loc_531_5_531_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_531_5_531_8&#39;)"><span class="hl_vardecl"><span class="mpre">isT</span></span></a><span class="mpre">   &lt;- </span><a href="#loc_543_1_543_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_1_543_18&#39;)"><span class="hl_varref"><span class="mpre">hIsTerminalDevice</span></span></a><span class="mpre"> </span><a href="#loc_530_10_530_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_530_10_530_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">
    if </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><a href="#loc_531_5_531_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_531_5_531_8&#39;)"><span class="hl_varref"><span class="mpre">isT</span></span></a><span class="mpre">
     then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
     else
       </span><span class="hl_varref"><span class="mpre">withHandle_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hGetEcho&quot;</span></span><span class="mpre"> </span><a href="#loc_530_10_530_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_530_10_530_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 535, srcSpanStartColumn = 42, srcSpanEndLine = 535, srcSpanEndColumn = 54}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 535, srcSpanStartColumn = 50, srcSpanEndLine = 535, srcSpanEndColumn = 51},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 535, srcSpanSt"><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; do
       case </span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> of 
         </span><span class="hl_conref"><span class="mpre">ClosedHandle</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span><span class="mpre">
         _            -&gt; </span><a href="GHC.IO.Device.html#loc_103_3_103_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_103_3_103_10&#39;)"><span class="hl_varref"><span class="mpre">IODevice.getEcho</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haDevice</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Is the handle connected to a terminal?</span></span><span class="mpre">

</span><a href="#loc_543_1_543_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_1_543_18&#39;)"><span class="mpre">hIsTerminalDevice</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_543_1_543_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_1_543_18&#39;)"><span class="hl_fundecl"><span class="mpre">hIsTerminalDevice</span></span></a><span class="mpre"> </span><a name="loc_543_19_543_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_19_543_25&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> = do
    </span><span class="hl_varref"><span class="mpre">withHandle_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hIsTerminalDevice&quot;</span></span><span class="mpre"> </span><a href="#loc_543_19_543_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_19_543_25&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 544, srcSpanStartColumn = 48, srcSpanEndLine = 544, srcSpanEndColumn = 60}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 544, srcSpanStartColumn = 56, srcSpanEndLine = 544, srcSpanEndColumn = 57},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 544, srcSpanSt"><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; do
     case </span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> of 
       </span><span class="hl_conref"><span class="mpre">ClosedHandle</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">ioe_closedHandle</span></span><span class="mpre">
       _            -&gt; </span><a href="GHC.IO.Device.html#loc_74_3_74_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_74_3_74_13&#39;)"><span class="hl_varref"><span class="mpre">IODevice.isTerminal</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haDevice</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- hSetBinaryMode</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Select binary mode (&#39;True&#39;) or text mode (&#39;False&#39;) on a open handle.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (See also &#39;openBinaryFile&#39;.)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This has the same effect as calling &#39;hSetEncoding&#39; with &#39;char8&#39;, together</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- with &#39;hSetNewlineMode&#39; with &#39;noNewlineTranslation&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_559_1_559_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_559_1_559_15&#39;)"><span class="mpre">hSetBinaryMode</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_559_1_559_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_559_1_559_15&#39;)"><span class="hl_fundecl"><span class="mpre">hSetBinaryMode</span></span></a><span class="mpre"> </span><a name="loc_559_16_559_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_559_16_559_22&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_559_23_559_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_559_23_559_26&#39;)"><span class="hl_vardecl"><span class="mpre">bin</span></span></a><span class="mpre"> =
  </span><span class="hl_varref"><span class="mpre">withAllHandles__</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hSetBinaryMode&quot;</span></span><span class="mpre"> </span><a href="#loc_559_16_559_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_559_16_559_22&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_560_48_560_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_560_48_560_50&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 560, srcSpanStartColumn = 51, srcSpanEndLine = 560, srcSpanEndColumn = 63}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 560, srcSpanStartColumn = 59, srcSpanEndLine = 560, srcSpanEndColumn = 60},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 560, srcSpanSt"><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt;
    do 
         </span><span class="hl_varref"><span class="mpre">flushCharBuffer</span></span><span class="mpre"> </span><a href="#loc_560_48_560_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_560_48_560_50&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
         </span><span class="hl_varref"><span class="mpre">closeTextCodecs</span></span><span class="mpre"> </span><a href="#loc_560_48_560_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_560_48_560_50&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">

         </span><a name="loc_565_10_565_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_565_10_565_15&#39;)"><span class="hl_vardecl"><span class="mpre">mb_te</span></span></a><span class="mpre"> &lt;- if </span><a href="#loc_559_23_559_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_559_23_559_26&#39;)"><span class="hl_varref"><span class="mpre">bin</span></span></a><span class="mpre"> then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
                         else </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="GHC.IO.Encoding.html#loc_133_2_133_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.html#loc_133_2_133_19&#39;)"><span class="hl_varref"><span class="mpre">getLocaleEncoding</span></span></a><span class="mpre">

         </span><span class="hl_varref"><span class="mpre">openTextEncoding</span></span><span class="mpre"> </span><a href="#loc_565_10_565_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_565_10_565_15&#39;)"><span class="hl_varref"><span class="mpre">mb_te</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><span class="hl_vardecl"><span class="mpre">mb_encoder</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">mb_decoder</span></span><span class="mpre"> -&gt; do

         </span><span class="hl_comment"><span class="mpre">-- should match the default newline mode, whatever that is</span></span><span class="mpre">
         let </span><span class="hl_vardecl"><span class="mpre">nl</span></span><span class="mpre">    | </span><a href="#loc_559_23_559_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_559_23_559_26&#39;)"><span class="hl_varref"><span class="mpre">bin</span></span></a><span class="mpre">       = </span><span class="hl_varref"><span class="mpre">noNewlineTranslation</span></span><span class="mpre">
                   | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">nativeNewlineMode</span></span><span class="mpre">

         </span><a name="loc_574_10_574_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_574_10_574_14&#39;)"><span class="hl_vardecl"><span class="mpre">bbuf</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readIORef</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haByteBuffer</span></span><span class="mpre">
         </span><span class="hl_vardecl"><span class="mpre">ref</span></span><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newIORef</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;codec_state&quot;</span></span><span class="mpre">, </span><a href="#loc_574_10_574_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_574_10_574_14&#39;)"><span class="hl_varref"><span class="mpre">bbuf</span></span></a><span class="mpre">)

         </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 577, srcSpanStartColumn = 17, srcSpanEndLine = 582, srcSpanEndColumn = 57}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 577, srcSpanStartColumn = 25, srcSpanEndLine = 577, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 577, srcS"><span class="mpre">Handle__{ haLastDecode = ref,
                          haEncoder  = mb_encoder, 
                          haDecoder  = mb_decoder,
                          haCodec    = mb_te,
                          haInputNL  = inputNL nl,
                          haOutputNL = outputNL nl, .. }</span></span><span class="mpre">
  
</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- hSetNewlineMode</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Set the &#39;NewlineMode&#39; on the specified &#39;Handle&#39;.  All buffered</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- data is flushed first.</span></span><span class="mpre">
</span><a href="#loc_590_1_590_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_590_1_590_16&#39;)"><span class="mpre">hSetNewlineMode</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">NewlineMode</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_590_1_590_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_590_1_590_16&#39;)"><span class="hl_fundecl"><span class="mpre">hSetNewlineMode</span></span></a><span class="mpre"> </span><a name="loc_590_17_590_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_590_17_590_23&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 590, srcSpanStartColumn = 24, srcSpanEndLine = 590, srcSpanEndColumn = 60}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 590, srcSpanStartColumn = 35, srcSpanEndLine = 590, srcSpanEndColumn = 36},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 590, srcSpanSt"><span class="mpre">NewlineMode{ inputNL=i, outputNL=o }</span></span><span class="mpre"> =
  </span><span class="hl_varref"><span class="mpre">withAllHandles__</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hSetNewlineMode&quot;</span></span><span class="mpre"> </span><a href="#loc_590_17_590_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_590_17_590_23&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_591_48_591_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_591_48_591_50&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 591, srcSpanStartColumn = 51, srcSpanEndLine = 591, srcSpanEndColumn = 63}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 591, srcSpanStartColumn = 59, srcSpanEndLine = 591, srcSpanEndColumn = 60},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 591, srcSpanSt"><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt;
    do
         </span><span class="hl_varref"><span class="mpre">flushBuffer</span></span><span class="mpre"> </span><a href="#loc_591_48_591_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_591_48_591_50&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
         </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 594, srcSpanStartColumn = 17, srcSpanEndLine = 594, srcSpanEndColumn = 48}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 594, srcSpanStartColumn = 19, srcSpanEndLine = 594, srcSpanEndColumn = 20},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 594, srcS"><span class="mpre">h_{ haInputNL=i, haOutputNL=o }</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Duplicating a Handle</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Returns a duplicate of the original handle, with its own buffer.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The two Handles will share a file pointer, however.  The original</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- handle&#39;s buffer is flushed, including discarding any input data,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- before the handle is duplicated.</span></span><span class="mpre">

</span><a href="#loc_605_1_605_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_1_605_11&#39;)"><span class="mpre">hDuplicate</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre">
</span><a name="loc_605_1_605_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_1_605_11&#39;)"><span class="hl_fundecl"><span class="mpre">hDuplicate</span></span></a><span class="mpre"> </span><a name="loc_605_12_605_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_12_605_13&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">FileHandle</span></span><span class="mpre"> </span><a name="loc_605_26_605_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_26_605_30&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> </span><a name="loc_605_31_605_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_31_605_32&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) = do
  </span><span class="hl_varref"><span class="mpre">withHandle_&#39;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hDuplicate&quot;</span></span><span class="mpre"> </span><a href="#loc_605_12_605_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_12_605_13&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_605_31_605_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_31_605_32&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_606_36_606_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_606_36_606_38&#39;)"><span class="hl_vardecl"><span class="mpre">h_</span></span></a><span class="mpre"> -&gt;
      </span><a href="#loc_623_1_623_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_1_623_10&#39;)"><span class="hl_varref"><span class="mpre">dupHandle</span></span></a><span class="mpre"> </span><a href="#loc_605_26_605_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_26_605_30&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre"> </span><a href="#loc_605_12_605_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_12_605_13&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="#loc_606_36_606_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_606_36_606_38&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">handleFinalizer</span></span><span class="mpre">)
</span><a href="#loc_605_1_605_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_1_605_11&#39;)"><span class="hl_fundecl"><span class="mpre">hDuplicate</span></span></a><span class="mpre"> </span><a name="loc_608_12_608_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_608_12_608_13&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">DuplexHandle</span></span><span class="mpre"> </span><a name="loc_608_28_608_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_608_28_608_32&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> </span><a name="loc_608_33_608_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_608_33_608_34&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> </span><a name="loc_608_35_608_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_608_35_608_36&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre">) = do
  </span><span class="hl_specname"><span class="mpre">write_side</span></span><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">FileHandle</span></span><span class="mpre"> _ </span><a name="loc_609_28_609_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_609_28_609_35&#39;)"><span class="hl_vardecl"><span class="mpre">write_m</span></span></a><span class="mpre">) &lt;- 
     </span><span class="hl_varref"><span class="mpre">withHandle_&#39;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hDuplicate&quot;</span></span><span class="mpre"> </span><a href="#loc_608_12_608_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_608_12_608_13&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_608_35_608_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_608_35_608_36&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_610_39_610_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_610_39_610_41&#39;)"><span class="hl_vardecl"><span class="mpre">h_</span></span></a><span class="mpre"> -&gt;
        </span><a href="#loc_623_1_623_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_1_623_10&#39;)"><span class="hl_varref"><span class="mpre">dupHandle</span></span></a><span class="mpre"> </span><a href="#loc_608_28_608_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_608_28_608_32&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre"> </span><a href="#loc_608_12_608_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_608_12_608_13&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="#loc_610_39_610_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_610_39_610_41&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">handleFinalizer</span></span><span class="mpre">)
  </span><span class="hl_specname"><span class="mpre">read_side</span></span><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">FileHandle</span></span><span class="mpre"> _ </span><a name="loc_612_27_612_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_612_27_612_33&#39;)"><span class="hl_vardecl"><span class="mpre">read_m</span></span></a><span class="mpre">) &lt;- 
    </span><span class="hl_varref"><span class="mpre">withHandle_&#39;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hDuplicate&quot;</span></span><span class="mpre"> </span><a href="#loc_608_12_608_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_608_12_608_13&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_608_33_608_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_608_33_608_34&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_613_38_613_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_38_613_40&#39;)"><span class="hl_vardecl"><span class="mpre">h_</span></span></a><span class="mpre"> -&gt;
        </span><a href="#loc_623_1_623_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_1_623_10&#39;)"><span class="hl_varref"><span class="mpre">dupHandle</span></span></a><span class="mpre"> </span><a href="#loc_608_28_608_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_608_28_608_32&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre"> </span><a href="#loc_608_12_608_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_608_12_608_13&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_609_28_609_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_609_28_609_35&#39;)"><span class="hl_varref"><span class="mpre">write_m</span></span></a><span class="mpre">) </span><a href="#loc_613_38_613_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_38_613_40&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">  </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">DuplexHandle</span></span><span class="mpre"> </span><a href="#loc_608_28_608_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_608_28_608_32&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre"> </span><a href="#loc_612_27_612_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_612_27_612_33&#39;)"><span class="hl_varref"><span class="mpre">read_m</span></span></a><span class="mpre"> </span><a href="#loc_609_28_609_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_609_28_609_35&#39;)"><span class="hl_varref"><span class="mpre">write_m</span></span></a><span class="mpre">)

</span><a href="#loc_623_1_623_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_1_623_10&#39;)"><span class="mpre">dupHandle</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre">
          -&gt; </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre">
          -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">MVar</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Handle__</span></span><span class="mpre">)
          -&gt; </span><span class="hl_tyconref"><span class="mpre">Handle__</span></span><span class="mpre">
          -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HandleFinalizer</span></span><span class="mpre">
          -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre">
</span><a name="loc_623_1_623_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_1_623_10&#39;)"><span class="hl_fundecl"><span class="mpre">dupHandle</span></span></a><span class="mpre"> </span><a name="loc_623_11_623_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_11_623_19&#39;)"><span class="hl_vardecl"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a name="loc_623_20_623_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_20_623_21&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_623_22_623_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_22_623_32&#39;)"><span class="hl_vardecl"><span class="mpre">other_side</span></span></a><span class="mpre"> </span><a name="loc_623_33_623_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_33_623_35&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 623, srcSpanStartColumn = 36, srcSpanEndLine = 623, srcSpanEndColumn = 48}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 623, srcSpanStartColumn = 44, srcSpanEndLine = 623, srcSpanEndColumn = 45},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 623, srcSpanSt"><span class="mpre">Handle__{..}</span></span><span class="mpre"> </span><a name="loc_623_49_623_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_49_623_61&#39;)"><span class="hl_vardecl"><span class="mpre">mb_finalizer</span></span></a><span class="mpre"> = do
  </span><span class="hl_comment"><span class="mpre">-- flush the buffer first, so we don&#39;t have to copy its contents</span></span><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">flushBuffer</span></span><span class="mpre"> </span><a href="#loc_623_33_623_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_33_623_35&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
  case </span><a href="#loc_623_22_623_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_22_623_32&#39;)"><span class="hl_varref"><span class="mpre">other_side</span></span></a><span class="mpre"> of
    </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; do
       </span><a name="loc_628_8_628_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_628_8_628_15&#39;)"><span class="hl_vardecl"><span class="mpre">new_dev</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Device.html#loc_117_3_117_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_117_3_117_6&#39;)"><span class="hl_varref"><span class="mpre">IODevice.dup</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haDevice</span></span><span class="mpre">
       </span><a href="#loc_640_1_640_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_640_1_640_11&#39;)"><span class="hl_varref"><span class="mpre">dupHandle_</span></span></a><span class="mpre"> </span><a href="#loc_628_8_628_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_628_8_628_15&#39;)"><span class="hl_varref"><span class="mpre">new_dev</span></span></a><span class="mpre"> </span><a href="#loc_623_11_623_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_11_623_19&#39;)"><span class="hl_varref"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a href="#loc_623_22_623_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_22_623_32&#39;)"><span class="hl_varref"><span class="mpre">other_side</span></span></a><span class="mpre"> </span><a href="#loc_623_33_623_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_33_623_35&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_623_49_623_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_49_623_61&#39;)"><span class="hl_varref"><span class="mpre">mb_finalizer</span></span></a><span class="mpre">
    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_630_10_630_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_630_10_630_11&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">  -&gt; 
       </span><span class="hl_varref"><span class="mpre">withHandle_&#39;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;dupHandle&quot;</span></span><span class="mpre"> </span><a href="#loc_623_20_623_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_20_623_21&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_630_10_630_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_630_10_630_11&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 631, srcSpanStartColumn = 40, srcSpanEndLine = 631, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 631, srcSpanStartColumn = 48, srcSpanEndLine = 631, srcSpanEndColumn = 49},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 631, srcSpanSt"><span class="mpre">Handle__{haDevice=dev}</span></span><span class="mpre"> -&gt; do
         </span><a href="#loc_640_1_640_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_640_1_640_11&#39;)"><span class="hl_varref"><span class="mpre">dupHandle_</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">dev</span></span><span class="mpre"> </span><a href="#loc_623_11_623_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_11_623_19&#39;)"><span class="hl_varref"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a href="#loc_623_22_623_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_22_623_32&#39;)"><span class="hl_varref"><span class="mpre">other_side</span></span></a><span class="mpre"> </span><a href="#loc_623_33_623_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_33_623_35&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_623_49_623_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_623_49_623_61&#39;)"><span class="hl_varref"><span class="mpre">mb_finalizer</span></span></a><span class="mpre">

</span><a href="#loc_640_1_640_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_640_1_640_11&#39;)"><span class="mpre">dupHandle_</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxTuple (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 634, srcSpanStartColumn = 15, srcSpanEndLine = 634, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 634, srcSpanStartColumn = 15, srcSpanEndLine = 634, srcSpanEndColumn = 16},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 634, srcSpa"><span class="mpre">(IODevice dev, BufferedIO dev, Typeable dev) =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">dev</span></span><span class="mpre">
           -&gt; </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre">
           -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">MVar</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Handle__</span></span><span class="mpre">)
           -&gt; </span><span class="hl_tyconref"><span class="mpre">Handle__</span></span><span class="mpre">
           -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HandleFinalizer</span></span><span class="mpre">
           -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre">
</span><a name="loc_640_1_640_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_640_1_640_11&#39;)"><span class="hl_fundecl"><span class="mpre">dupHandle_</span></span></a><span class="mpre"> </span><a name="loc_640_12_640_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_640_12_640_19&#39;)"><span class="hl_vardecl"><span class="mpre">new_dev</span></span></a><span class="mpre"> </span><a name="loc_640_20_640_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_640_20_640_28&#39;)"><span class="hl_vardecl"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a name="loc_640_29_640_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_640_29_640_39&#39;)"><span class="hl_vardecl"><span class="mpre">other_side</span></span></a><span class="mpre"> </span><span class="hl_specname"><span class="mpre">h_</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 640, srcSpanStartColumn = 43, srcSpanEndLine = 640, srcSpanEndColumn = 55}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 640, srcSpanStartColumn = 51, srcSpanEndLine = 640, srcSpanEndColumn = 52},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 640, srcSpanSt"><span class="mpre">Handle__{..}</span></span><span class="mpre"> </span><a name="loc_640_56_640_68" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_640_56_640_68&#39;)"><span class="hl_vardecl"><span class="mpre">mb_finalizer</span></span></a><span class="mpre"> = do
   </span><span class="hl_comment"><span class="mpre">-- XXX wrong!</span></span><span class="mpre">
  </span><a name="loc_642_3_642_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_642_3_642_11&#39;)"><span class="hl_vardecl"><span class="mpre">mb_codec</span></span></a><span class="mpre"> &lt;- if </span><a href="Data.Maybe.html#loc_80_1_80_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_80_1_80_7&#39;)"><span class="hl_varref"><span class="mpre">isJust</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haEncoder</span></span><span class="mpre"> then </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="GHC.IO.Encoding.html#loc_133_2_133_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.html#loc_133_2_133_19&#39;)"><span class="hl_varref"><span class="mpre">getLocaleEncoding</span></span></a><span class="mpre"> else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">mkHandle</span></span><span class="mpre"> </span><a href="#loc_640_12_640_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_640_12_640_19&#39;)"><span class="hl_varref"><span class="mpre">new_dev</span></span></a><span class="mpre"> </span><a href="#loc_640_20_640_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_640_20_640_28&#39;)"><span class="hl_varref"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="hl_comment"><span class="mpre">{-buffered-}</span></span><span class="mpre"> </span><a href="#loc_642_3_642_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_642_3_642_11&#39;)"><span class="hl_varref"><span class="mpre">mb_codec</span></span></a><span class="mpre">
      </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 644, srcSpanStartColumn = 7, srcSpanEndLine = 644, srcSpanEndColumn = 65}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 644, srcSpanStartColumn = 19, srcSpanEndLine = 644, srcSpanEndColumn = 20},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 644, srcSp"><span class="mpre">NewlineMode { inputNL = haInputNL, outputNL = haOutputNL }</span></span><span class="mpre">
      </span><a href="#loc_640_56_640_68" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_640_56_640_68&#39;)"><span class="hl_varref"><span class="mpre">mb_finalizer</span></span></a><span class="mpre"> </span><a href="#loc_640_29_640_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_640_29_640_39&#39;)"><span class="hl_varref"><span class="mpre">other_side</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Replacing a Handle</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{- |
Makes the second handle a duplicate of the first handle.  The second 
handle will be closed first, if it is not already.

This can be used to retarget the standard Handles, for example:

&gt; do h &lt;- openFile &quot;mystdout&quot; WriteMode
&gt;    hDuplicateTo h stdout
-}</span></span><span class="mpre">

</span><a href="#loc_661_1_661_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_1_661_13&#39;)"><span class="mpre">hDuplicateTo</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_661_1_661_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_1_661_13&#39;)"><span class="hl_fundecl"><span class="mpre">hDuplicateTo</span></span></a><span class="mpre"> </span><a name="loc_661_14_661_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_14_661_16&#39;)"><span class="hl_specname"><span class="mpre">h1</span></span></a><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">FileHandle</span></span><span class="mpre"> </span><a name="loc_661_29_661_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_29_661_33&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> </span><a name="loc_661_34_661_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_34_661_36&#39;)"><span class="hl_vardecl"><span class="mpre">m1</span></span></a><span class="mpre">) </span><a name="loc_661_38_661_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_38_661_40&#39;)"><span class="hl_specname"><span class="mpre">h2</span></span></a><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">FileHandle</span></span><span class="mpre"> _ </span><a name="loc_661_55_661_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_55_661_57&#39;)"><span class="hl_vardecl"><span class="mpre">m2</span></span></a><span class="mpre">)  = do
 </span><span class="hl_varref"><span class="mpre">withHandle__&#39;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hDuplicateTo&quot;</span></span><span class="mpre"> </span><a href="#loc_661_38_661_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_38_661_40&#39;)"><span class="hl_varref"><span class="mpre">h2</span></span></a><span class="mpre"> </span><a href="#loc_661_55_661_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_55_661_57&#39;)"><span class="hl_varref"><span class="mpre">m2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_662_40_662_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_662_40_662_43&#39;)"><span class="hl_vardecl"><span class="mpre">h2_</span></span></a><span class="mpre"> -&gt; do
   _ &lt;- </span><span class="hl_varref"><span class="mpre">hClose_help</span></span><span class="mpre"> </span><a href="#loc_662_40_662_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_662_40_662_43&#39;)"><span class="hl_varref"><span class="mpre">h2_</span></span></a><span class="mpre">
   </span><span class="hl_varref"><span class="mpre">withHandle_&#39;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hDuplicateTo&quot;</span></span><span class="mpre"> </span><a href="#loc_661_14_661_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_14_661_16&#39;)"><span class="hl_varref"><span class="mpre">h1</span></span></a><span class="mpre"> </span><a href="#loc_661_34_661_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_34_661_36&#39;)"><span class="hl_varref"><span class="mpre">m1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_664_41_664_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_664_41_664_44&#39;)"><span class="hl_vardecl"><span class="mpre">h1_</span></span></a><span class="mpre"> -&gt; do
     </span><a href="#loc_691_1_691_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_691_1_691_12&#39;)"><span class="hl_varref"><span class="mpre">dupHandleTo</span></span></a><span class="mpre"> </span><a href="#loc_661_29_661_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_29_661_33&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre"> </span><a href="#loc_661_14_661_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_14_661_16&#39;)"><span class="hl_varref"><span class="mpre">h1</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="#loc_662_40_662_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_662_40_662_43&#39;)"><span class="hl_varref"><span class="mpre">h2_</span></span></a><span class="mpre"> </span><a href="#loc_664_41_664_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_664_41_664_44&#39;)"><span class="hl_varref"><span class="mpre">h1_</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">handleFinalizer</span></span><span class="mpre">)
</span><a href="#loc_661_1_661_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_1_661_13&#39;)"><span class="hl_fundecl"><span class="mpre">hDuplicateTo</span></span></a><span class="mpre"> </span><a name="loc_666_14_666_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_14_666_16&#39;)"><span class="hl_specname"><span class="mpre">h1</span></span></a><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">DuplexHandle</span></span><span class="mpre"> </span><a name="loc_666_31_666_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_31_666_35&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> </span><a name="loc_666_36_666_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_36_666_38&#39;)"><span class="hl_vardecl"><span class="mpre">r1</span></span></a><span class="mpre"> </span><a name="loc_666_39_666_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_39_666_41&#39;)"><span class="hl_vardecl"><span class="mpre">w1</span></span></a><span class="mpre">) </span><a name="loc_666_43_666_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_43_666_45&#39;)"><span class="hl_specname"><span class="mpre">h2</span></span></a><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">DuplexHandle</span></span><span class="mpre"> _ </span><a name="loc_666_62_666_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_62_666_64&#39;)"><span class="hl_vardecl"><span class="mpre">r2</span></span></a><span class="mpre"> </span><a name="loc_666_65_666_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_65_666_67&#39;)"><span class="hl_vardecl"><span class="mpre">w2</span></span></a><span class="mpre">)  = do
 </span><span class="hl_varref"><span class="mpre">withHandle__&#39;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hDuplicateTo&quot;</span></span><span class="mpre"> </span><a href="#loc_666_43_666_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_43_666_45&#39;)"><span class="hl_varref"><span class="mpre">h2</span></span></a><span class="mpre"> </span><a href="#loc_666_65_666_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_65_666_67&#39;)"><span class="hl_varref"><span class="mpre">w2</span></span></a><span class="mpre">  </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_667_41_667_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_667_41_667_44&#39;)"><span class="hl_vardecl"><span class="mpre">w2_</span></span></a><span class="mpre"> -&gt; do
   _ &lt;- </span><span class="hl_varref"><span class="mpre">hClose_help</span></span><span class="mpre"> </span><a href="#loc_667_41_667_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_667_41_667_44&#39;)"><span class="hl_varref"><span class="mpre">w2_</span></span></a><span class="mpre">
   </span><span class="hl_varref"><span class="mpre">withHandle_&#39;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hDuplicateTo&quot;</span></span><span class="mpre"> </span><a href="#loc_666_14_666_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_14_666_16&#39;)"><span class="hl_varref"><span class="mpre">h1</span></span></a><span class="mpre"> </span><a href="#loc_666_39_666_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_39_666_41&#39;)"><span class="hl_varref"><span class="mpre">w1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_669_41_669_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_669_41_669_44&#39;)"><span class="hl_vardecl"><span class="mpre">w1_</span></span></a><span class="mpre"> -&gt; do
     </span><a href="#loc_691_1_691_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_691_1_691_12&#39;)"><span class="hl_varref"><span class="mpre">dupHandleTo</span></span></a><span class="mpre"> </span><a href="#loc_666_31_666_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_31_666_35&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre"> </span><a href="#loc_666_14_666_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_14_666_16&#39;)"><span class="hl_varref"><span class="mpre">h1</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="#loc_667_41_667_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_667_41_667_44&#39;)"><span class="hl_varref"><span class="mpre">w2_</span></span></a><span class="mpre"> </span><a href="#loc_669_41_669_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_669_41_669_44&#39;)"><span class="hl_varref"><span class="mpre">w1_</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">handleFinalizer</span></span><span class="mpre">)
 </span><span class="hl_varref"><span class="mpre">withHandle__&#39;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hDuplicateTo&quot;</span></span><span class="mpre"> </span><a href="#loc_666_43_666_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_43_666_45&#39;)"><span class="hl_varref"><span class="mpre">h2</span></span></a><span class="mpre"> </span><a href="#loc_666_62_666_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_62_666_64&#39;)"><span class="hl_varref"><span class="mpre">r2</span></span></a><span class="mpre">  </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_671_41_671_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_41_671_44&#39;)"><span class="hl_vardecl"><span class="mpre">r2_</span></span></a><span class="mpre"> -&gt; do
   _ &lt;- </span><span class="hl_varref"><span class="mpre">hClose_help</span></span><span class="mpre"> </span><a href="#loc_671_41_671_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_41_671_44&#39;)"><span class="hl_varref"><span class="mpre">r2_</span></span></a><span class="mpre">
   </span><span class="hl_varref"><span class="mpre">withHandle_&#39;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hDuplicateTo&quot;</span></span><span class="mpre"> </span><a href="#loc_666_14_666_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_14_666_16&#39;)"><span class="hl_varref"><span class="mpre">h1</span></span></a><span class="mpre"> </span><a href="#loc_666_36_666_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_36_666_38&#39;)"><span class="hl_varref"><span class="mpre">r1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_673_41_673_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_673_41_673_44&#39;)"><span class="hl_vardecl"><span class="mpre">r1_</span></span></a><span class="mpre"> -&gt; do
     </span><a href="#loc_691_1_691_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_691_1_691_12&#39;)"><span class="hl_varref"><span class="mpre">dupHandleTo</span></span></a><span class="mpre"> </span><a href="#loc_666_31_666_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_31_666_35&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre"> </span><a href="#loc_666_14_666_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_14_666_16&#39;)"><span class="hl_varref"><span class="mpre">h1</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_666_39_666_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_666_39_666_41&#39;)"><span class="hl_varref"><span class="mpre">w1</span></span></a><span class="mpre">) </span><a href="#loc_671_41_671_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_671_41_671_44&#39;)"><span class="hl_varref"><span class="mpre">r2_</span></span></a><span class="mpre"> </span><a href="#loc_673_41_673_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_673_41_673_44&#39;)"><span class="hl_varref"><span class="mpre">r1_</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
</span><a href="#loc_661_1_661_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_1_661_13&#39;)"><span class="hl_fundecl"><span class="mpre">hDuplicateTo</span></span></a><span class="mpre"> </span><a name="loc_675_14_675_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_675_14_675_16&#39;)"><span class="hl_vardecl"><span class="mpre">h1</span></span></a><span class="mpre"> _ = 
  </span><a href="#loc_680_1_680_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_680_1_680_28&#39;)"><span class="hl_varref"><span class="mpre">ioe_dupHandlesNotCompatible</span></span></a><span class="mpre"> </span><a href="#loc_675_14_675_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_675_14_675_16&#39;)"><span class="hl_varref"><span class="mpre">h1</span></span></a><span class="mpre">


</span><a href="#loc_680_1_680_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_680_1_680_28&#39;)"><span class="mpre">ioe_dupHandlesNotCompatible</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_680_1_680_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_680_1_680_28&#39;)"><span class="hl_fundecl"><span class="mpre">ioe_dupHandlesNotCompatible</span></span></a><span class="mpre"> </span><a name="loc_680_29_680_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_680_29_680_30&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> =
   </span><span class="hl_varref"><span class="mpre">ioException</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">IOError</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_680_29_680_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_680_29_680_30&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">) </span><span class="hl_conref"><span class="mpre">IllegalOperation</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hDuplicateTo&quot;</span></span><span class="mpre"> 
                </span><span class="hl_string"><span class="mpre">&quot;handles are incompatible&quot;</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">)

</span><a href="#loc_691_1_691_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_691_1_691_12&#39;)"><span class="mpre">dupHandleTo</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> 
            -&gt; </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre">
            -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">MVar</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Handle__</span></span><span class="mpre">)
            -&gt; </span><span class="hl_tyconref"><span class="mpre">Handle__</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">Handle__</span></span><span class="mpre">
            -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HandleFinalizer</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Handle__</span></span><span class="mpre">
</span><a name="loc_691_1_691_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_691_1_691_12&#39;)"><span class="hl_fundecl"><span class="mpre">dupHandleTo</span></span></a><span class="mpre"> </span><a name="loc_691_13_691_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_691_13_691_21&#39;)"><span class="hl_vardecl"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a name="loc_691_22_691_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_691_22_691_23&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_691_24_691_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_691_24_691_34&#39;)"><span class="hl_vardecl"><span class="mpre">other_side</span></span></a><span class="mpre"> 
            </span><span class="hl_specname"><span class="mpre">hto_</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 692, srcSpanStartColumn = 18, srcSpanEndLine = 692, srcSpanEndColumn = 45}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 692, srcSpanStartColumn = 26, srcSpanEndLine = 692, srcSpanEndColumn = 27},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 692, srcSpanSt"><span class="mpre">Handle__{haDevice=devTo,..}</span></span><span class="mpre">
            </span><a name="loc_693_13_693_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_693_13_693_15&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 693, srcSpanStartColumn = 16, srcSpanEndLine = 693, srcSpanEndColumn = 38}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 693, srcSpanStartColumn = 24, srcSpanEndLine = 693, srcSpanEndColumn = 25},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle.hs&quot;, srcSpanStartLine = 693, srcSpanSt"><span class="mpre">Handle__{haDevice=dev}</span></span><span class="mpre"> </span><a name="loc_693_39_693_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_693_39_693_51&#39;)"><span class="hl_vardecl"><span class="mpre">mb_finalizer</span></span></a><span class="mpre"> = do
  </span><span class="hl_varref"><span class="mpre">flushBuffer</span></span><span class="mpre"> </span><a href="#loc_693_13_693_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_693_13_693_15&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
  case </span><span class="hl_varref"><span class="mpre">cast</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">devTo</span></span><span class="mpre"> of
    </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">   -&gt; </span><a href="#loc_680_1_680_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_680_1_680_28&#39;)"><span class="hl_varref"><span class="mpre">ioe_dupHandlesNotCompatible</span></span></a><span class="mpre"> </span><a href="#loc_691_22_691_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_691_22_691_23&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_697_10_697_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_697_10_697_14&#39;)"><span class="hl_vardecl"><span class="mpre">dev&#39;</span></span></a><span class="mpre"> -&gt; do 
      _ &lt;- </span><a href="GHC.IO.Device.html#loc_123_3_123_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_123_3_123_7&#39;)"><span class="hl_varref"><span class="mpre">IODevice.dup2</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">dev</span></span><span class="mpre"> </span><a href="#loc_697_10_697_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_697_10_697_14&#39;)"><span class="hl_varref"><span class="mpre">dev&#39;</span></span></a><span class="mpre">
      </span><span class="hl_conref"><span class="mpre">FileHandle</span></span><span class="mpre"> _ </span><a name="loc_699_20_699_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_699_20_699_21&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_640_1_640_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_640_1_640_11&#39;)"><span class="hl_varref"><span class="mpre">dupHandle_</span></span></a><span class="mpre"> </span><a href="#loc_697_10_697_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_697_10_697_14&#39;)"><span class="hl_varref"><span class="mpre">dev&#39;</span></span></a><span class="mpre"> </span><a href="#loc_691_13_691_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_691_13_691_21&#39;)"><span class="hl_varref"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a href="#loc_691_24_691_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_691_24_691_34&#39;)"><span class="hl_varref"><span class="mpre">other_side</span></span></a><span class="mpre"> </span><a href="#loc_693_13_693_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_693_13_693_15&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_693_39_693_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_693_39_693_51&#39;)"><span class="hl_varref"><span class="mpre">mb_finalizer</span></span></a><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">takeMVar</span></span><span class="mpre"> </span><a href="#loc_699_20_699_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_699_20_699_21&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- showing Handles.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | &#39;hShow&#39; is in the &#39;IO&#39; monad, and gives more comprehensive output</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- than the (pure) instance of &#39;Show&#39; for &#39;Handle&#39;.</span></span><span class="mpre">

</span><a href="#loc_709_1_709_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_709_1_709_6&#39;)"><span class="mpre">hShow</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_709_1_709_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_709_1_709_6&#39;)"><span class="hl_fundecl"><span class="mpre">hShow</span></span></a><span class="mpre"> </span><a name="loc_709_7_709_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_709_7_709_8&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">FileHandle</span></span><span class="mpre"> </span><a name="loc_709_21_709_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_709_21_709_25&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> _) = </span><a href="#loc_713_1_713_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_1_713_12&#39;)"><span class="hl_varref"><span class="mpre">showHandle&#39;</span></span></a><span class="mpre"> </span><a href="#loc_709_21_709_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_709_21_709_25&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> </span><a href="#loc_709_7_709_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_709_7_709_8&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
</span><a href="#loc_709_1_709_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_709_1_709_6&#39;)"><span class="hl_fundecl"><span class="mpre">hShow</span></span></a><span class="mpre"> </span><a name="loc_710_7_710_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_710_7_710_8&#39;)"><span class="hl_specname"><span class="mpre">h</span></span></a><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">DuplexHandle</span></span><span class="mpre"> </span><a name="loc_710_23_710_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_710_23_710_27&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> _ _) = </span><a href="#loc_713_1_713_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_1_713_12&#39;)"><span class="hl_varref"><span class="mpre">showHandle&#39;</span></span></a><span class="mpre"> </span><a href="#loc_710_23_710_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_710_23_710_27&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> </span><a href="#loc_710_7_710_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_710_7_710_8&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">

</span><a href="#loc_713_1_713_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_1_713_12&#39;)"><span class="mpre">showHandle&#39;</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_713_1_713_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_1_713_12&#39;)"><span class="hl_fundecl"><span class="mpre">showHandle&#39;</span></span></a><span class="mpre"> </span><a name="loc_713_13_713_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_13_713_21&#39;)"><span class="hl_vardecl"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><a name="loc_713_22_713_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_22_713_31&#39;)"><span class="hl_vardecl"><span class="mpre">is_duplex</span></span></a><span class="mpre"> </span><a name="loc_713_32_713_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_32_713_33&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> = 
  </span><span class="hl_varref"><span class="mpre">withHandle_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;showHandle&quot;</span></span><span class="mpre"> </span><a href="#loc_713_32_713_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_32_713_33&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_714_33_714_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_714_33_714_37&#39;)"><span class="hl_vardecl"><span class="mpre">hdl_</span></span></a><span class="mpre"> -&gt;
    let
     </span><a name="loc_716_6_716_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_716_6_716_14&#39;)"><span class="hl_vardecl"><span class="mpre">showType</span></span></a><span class="mpre"> | </span><a href="#loc_713_22_713_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_22_713_31&#39;)"><span class="hl_varref"><span class="mpre">is_duplex</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">showString</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;duplex (read-write)&quot;</span></span><span class="mpre">
              | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">shows</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> </span><a href="#loc_714_33_714_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_714_33_714_37&#39;)"><span class="hl_varref"><span class="mpre">hdl_</span></span></a><span class="mpre">)
    in
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> 
      (( </span><span class="hl_varref"><span class="mpre">showChar</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;{&#39;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> 
        </span><a href="#loc_729_5_729_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_729_5_729_12&#39;)"><span class="hl_varref"><span class="mpre">showHdl</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">haType</span></span><span class="mpre"> </span><a href="#loc_714_33_714_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_714_33_714_37&#39;)"><span class="hl_varref"><span class="mpre">hdl_</span></span></a><span class="mpre">) 
            (</span><span class="hl_varref"><span class="mpre">showString</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;loc=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">showString</span></span><span class="mpre"> </span><a href="#loc_713_13_713_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_13_713_21&#39;)"><span class="hl_varref"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">showChar</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;,&#39;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre">
             </span><span class="hl_varref"><span class="mpre">showString</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;type=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_716_6_716_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_716_6_716_14&#39;)"><span class="hl_varref"><span class="mpre">showType</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">showChar</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;,&#39;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre">
             </span><span class="hl_varref"><span class="mpre">showString</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;buffering=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_735_5_735_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_735_5_735_16&#39;)"><span class="hl_varref"><span class="mpre">showBufMode</span></span></a><span class="mpre"> (</span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">readIORef</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">haCharBuffer</span></span><span class="mpre"> </span><a href="#loc_714_33_714_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_714_33_714_37&#39;)"><span class="hl_varref"><span class="mpre">hdl_</span></span></a><span class="mpre">))) (</span><span class="hl_varref"><span class="mpre">haBufferMode</span></span><span class="mpre"> </span><a href="#loc_714_33_714_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_714_33_714_37&#39;)"><span class="hl_varref"><span class="mpre">hdl_</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">showString</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;}&quot;</span></span><span class="mpre"> )
      ) </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">)
   where

    </span><a href="#loc_729_5_729_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_729_5_729_12&#39;)"><span class="mpre">showHdl</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">HandleType</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ShowS</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ShowS</span></span><span class="mpre">
    </span><a name="loc_729_5_729_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_729_5_729_12&#39;)"><span class="hl_fundecl"><span class="mpre">showHdl</span></span></a><span class="mpre"> </span><a name="loc_729_13_729_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_729_13_729_15&#39;)"><span class="hl_vardecl"><span class="mpre">ht</span></span></a><span class="mpre"> </span><a name="loc_729_16_729_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_729_16_729_20&#39;)"><span class="hl_vardecl"><span class="mpre">cont</span></span></a><span class="mpre"> = 
       case </span><a href="#loc_729_13_729_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_729_13_729_15&#39;)"><span class="hl_varref"><span class="mpre">ht</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">ClosedHandle</span></span><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">shows</span></span><span class="mpre"> </span><a href="#loc_729_13_729_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_729_13_729_15&#39;)"><span class="hl_varref"><span class="mpre">ht</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">showString</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;}&quot;</span></span><span class="mpre">
        _ -&gt; </span><a href="#loc_729_16_729_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_729_16_729_20&#39;)"><span class="hl_varref"><span class="mpre">cont</span></span></a><span class="mpre">

    </span><a href="#loc_735_5_735_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_735_5_735_16&#39;)"><span class="mpre">showBufMode</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Buffer</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">BufferMode</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ShowS</span></span><span class="mpre">
    </span><a name="loc_735_5_735_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_735_5_735_16&#39;)"><span class="hl_fundecl"><span class="mpre">showBufMode</span></span></a><span class="mpre"> </span><a name="loc_735_17_735_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_735_17_735_20&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a name="loc_735_21_735_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_735_21_735_24&#39;)"><span class="hl_vardecl"><span class="mpre">bmo</span></span></a><span class="mpre"> =
      case </span><a href="#loc_735_21_735_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_735_21_735_24&#39;)"><span class="hl_varref"><span class="mpre">bmo</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">NoBuffering</span></span><span class="mpre">   -&gt; </span><span class="hl_varref"><span class="mpre">showString</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;none&quot;</span></span><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">LineBuffering</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">showString</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;line&quot;</span></span><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">BlockBuffering</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_739_30_739_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_739_30_739_31&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">) -&gt; </span><span class="hl_varref"><span class="mpre">showString</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;block &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">showParen</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">shows</span></span><span class="mpre"> </span><a href="#loc_739_30_739_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_739_30_739_31&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">)
        </span><span class="hl_conref"><span class="mpre">BlockBuffering</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">showString</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;block &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">showParen</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">shows</span></span><span class="mpre"> </span><a href="#loc_743_8_743_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_743_8_743_11&#39;)"><span class="hl_varref"><span class="mpre">def</span></span></a><span class="mpre">)
      where
       </span><a href="#loc_743_8_743_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_743_8_743_11&#39;)"><span class="mpre">def</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> 
       </span><a name="loc_743_8_743_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_743_8_743_11&#39;)"><span class="hl_vardecl"><span class="mpre">def</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">bufSize</span></span><span class="mpre"> </span><a href="#loc_735_17_735_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_735_17_735_20&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">

</span></div></body></html>