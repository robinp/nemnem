<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Network.HTTP.HandleStream</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  See LICENSE file</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  Ganesh Sittampalam &lt;ganesh@earth.li&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (not tested)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A &#39;HandleStream&#39;-based version of &quot;Network.HTTP&quot; interface.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- For more detailed information about what the individual exports do, please consult</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the documentation for &quot;Network.HTTP&quot;. /Notice/ however that the functions here do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- not perform any kind of normalization prior to transmission (or receipt); you are</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- responsible for doing any such yourself, or, if you prefer, just switch to using</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;Network.HTTP&quot; function instead.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
module Network.HTTP.HandleStream 
       ( simpleHTTP      </span><span class="hl_comment"><span class="mpre">-- :: Request ty -&gt; IO (Result (Response ty))</span></span><span class="mpre">
       , simpleHTTP_     </span><span class="hl_comment"><span class="mpre">-- :: HStream ty =&gt; HandleStream ty -&gt; Request ty -&gt; IO (Result (Response ty))</span></span><span class="mpre">
       , sendHTTP        </span><span class="hl_comment"><span class="mpre">-- :: HStream ty =&gt; HandleStream ty -&gt; Request ty -&gt; IO (Result (Response ty))</span></span><span class="mpre">
       , sendHTTP_notify </span><span class="hl_comment"><span class="mpre">-- :: HStream ty =&gt; HandleStream ty -&gt; Request ty -&gt; IO () -&gt; IO (Result (Response ty))</span></span><span class="mpre">
       , receiveHTTP     </span><span class="hl_comment"><span class="mpre">-- :: HStream ty =&gt; HandleStream ty -&gt; IO (Result (Request ty))</span></span><span class="mpre">
       , respondHTTP     </span><span class="hl_comment"><span class="mpre">-- :: HStream ty =&gt; HandleStream ty -&gt; Response ty -&gt; IO ()</span></span><span class="mpre">
       
       , simpleHTTP_debug </span><span class="hl_comment"><span class="mpre">-- :: FilePath -&gt; Request DebugString -&gt; IO (Response DebugString)</span></span><span class="mpre">
       ) where

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------ Imports --------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------</span></span><span class="mpre">

import Network.BufferType
import Network.Stream ( </span><a href="Network.Stream.html#loc_65_1_65_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_65_1_65_6&#39;)"><span class="mpre">fmapE</span></a><span class="mpre">, Result )
import Network.StreamDebugger ( </span><a href="Network.StreamDebugger.html#loc_72_1_72_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.StreamDebugger.html#loc_72_1_72_16&#39;)"><span class="mpre">debugByteStream</span></a><span class="mpre"> )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 38, srcSpanStartColumn = 8, srcSpanEndLine = 38, srcSpanEndColumn = 19}, srcInfoPoints = []}) &quot;Network.TCP&quot;"><span class="mpre">Network.TCP</span></span><span class="mpre"> (HStream(..), HandleStream )

import Network.HTTP.Base
import Network.HTTP.Headers
import Network.HTTP.Utils ( </span><a href="Network.HTTP.Utils.html#loc_58_1_58_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Utils.html#loc_58_1_58_5&#39;)"><span class="mpre">trim</span></a><span class="mpre">, </span><a href="Network.HTTP.Utils.html#loc_87_1_87_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Utils.html#loc_87_1_87_9&#39;)"><span class="mpre">readsOne</span></a><span class="mpre"> )

import Data.Char (</span><a href="GHC.Unicode.html#loc_143_1_143_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_143_1_143_8&#39;)"><span class="mpre">toLower</span></a><span class="mpre">)
import Data.Maybe (</span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="mpre">fromMaybe</span></a><span class="mpre">)
import Control.Exception (</span><a href="Control.Exception.Base.html#loc_229_1_229_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_229_1_229_12&#39;)"><span class="mpre">onException</span></a><span class="mpre">)
import Control.Monad (</span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------ Misc -----------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | @simpleHTTP@ transmits a resource across a non-persistent connection.</span></span><span class="mpre">
</span><a href="#loc_55_1_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_11&#39;)"><span class="mpre">simpleHTTP</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 15, srcSpanEndLine = 54, srcSpanEndColumn = 28}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 26, srcSpanEndLine = 54, srcSpanEndColumn = 28}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pul"><span class="mpre">HStream ty =&gt;</span></span><span class="mpre"> </span><a href="Network.HTTP.Base.html#loc_292_6_292_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_292_6_292_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_339_6_339_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_339_6_339_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre">))
</span><a name="loc_55_1_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_11&#39;)"><span class="hl_fundecl"><span class="mpre">simpleHTTP</span></span></a><span class="mpre"> </span><a name="loc_55_12_55_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_12_55_13&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = do 
  </span><a name="loc_56_3_56_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_3_56_7&#39;)"><span class="hl_vardecl"><span class="mpre">auth</span></span></a><span class="mpre"> &lt;- </span><a href="Network.HTTP.Base.html#loc_717_1_717_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_717_1_717_8&#39;)"><span class="hl_varref"><span class="mpre">getAuth</span></span></a><span class="mpre"> </span><a href="#loc_55_12_55_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_12_55_13&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
  </span><a href="Network.HTTP.Base.html#loc_213_1_213_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_213_1_213_10&#39;)"><span class="hl_varref"><span class="mpre">failHTTPS</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_293_16_293_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_293_16_293_21&#39;)"><span class="hl_varref"><span class="mpre">rqURI</span></span></a><span class="mpre"> </span><a href="#loc_55_12_55_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_12_55_13&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">)
  </span><a name="loc_58_3_58_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_3_58_4&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">openStream</span></span><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_140_36_140_40" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_140_36_140_40&#39;)"><span class="hl_varref"><span class="mpre">host</span></span></a><span class="mpre"> </span><a href="#loc_56_3_56_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_3_56_7&#39;)"><span class="hl_varref"><span class="mpre">auth</span></span></a><span class="mpre">) (</span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="hl_varref"><span class="mpre">fromMaybe</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">80</span></span><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_141_36_141_40" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_141_36_141_40&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre"> </span><a href="#loc_56_3_56_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_3_56_7&#39;)"><span class="hl_varref"><span class="mpre">auth</span></span></a><span class="mpre">))
  </span><a href="#loc_73_1_73_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_12&#39;)"><span class="hl_varref"><span class="mpre">simpleHTTP_</span></span></a><span class="mpre"> </span><a href="#loc_58_3_58_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_3_58_4&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><a href="#loc_55_12_55_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_12_55_13&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | @simpleHTTP_debug debugFile req@ behaves like &#39;simpleHTTP&#39;, but logs</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the HTTP operation via the debug file @debugFile@.</span></span><span class="mpre">
</span><a href="#loc_64_1_64_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_17&#39;)"><span class="mpre">simpleHTTP_debug</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 63, srcSpanStartColumn = 21, srcSpanEndLine = 63, srcSpanEndColumn = 34}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 63, srcSpanStartColumn = 32, srcSpanEndLine = 63, srcSpanEndColumn = 34}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pul"><span class="mpre">HStream ty =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><a href="Network.HTTP.Base.html#loc_292_6_292_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_292_6_292_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_339_6_339_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_339_6_339_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre">))
</span><a name="loc_64_1_64_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_17&#39;)"><span class="hl_fundecl"><span class="mpre">simpleHTTP_debug</span></span></a><span class="mpre"> </span><a name="loc_64_18_64_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_18_64_29&#39;)"><span class="hl_vardecl"><span class="mpre">httpLogFile</span></span></a><span class="mpre"> </span><a name="loc_64_30_64_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_30_64_31&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = do 
  </span><a name="loc_65_3_65_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_3_65_7&#39;)"><span class="hl_vardecl"><span class="mpre">auth</span></span></a><span class="mpre"> &lt;- </span><a href="Network.HTTP.Base.html#loc_717_1_717_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_717_1_717_8&#39;)"><span class="hl_varref"><span class="mpre">getAuth</span></span></a><span class="mpre"> </span><a href="#loc_64_30_64_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_30_64_31&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
  </span><a href="Network.HTTP.Base.html#loc_213_1_213_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_213_1_213_10&#39;)"><span class="hl_varref"><span class="mpre">failHTTPS</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_293_16_293_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_293_16_293_21&#39;)"><span class="hl_varref"><span class="mpre">rqURI</span></span></a><span class="mpre"> </span><a href="#loc_64_30_64_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_30_64_31&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">)
  </span><a name="loc_67_3_67_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_3_67_5&#39;)"><span class="hl_vardecl"><span class="mpre">c0</span></span></a><span class="mpre">   &lt;- </span><span class="hl_varref"><span class="mpre">openStream</span></span><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_140_36_140_40" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_140_36_140_40&#39;)"><span class="hl_varref"><span class="mpre">host</span></span></a><span class="mpre"> </span><a href="#loc_65_3_65_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_3_65_7&#39;)"><span class="hl_varref"><span class="mpre">auth</span></span></a><span class="mpre">) (</span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="hl_varref"><span class="mpre">fromMaybe</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">80</span></span><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_141_36_141_40" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_141_36_141_40&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre"> </span><a href="#loc_65_3_65_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_3_65_7&#39;)"><span class="hl_varref"><span class="mpre">auth</span></span></a><span class="mpre">))
  </span><a name="loc_68_3_68_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_3_68_4&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre">    &lt;- </span><a href="Network.StreamDebugger.html#loc_72_1_72_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.StreamDebugger.html#loc_72_1_72_16&#39;)"><span class="hl_varref"><span class="mpre">debugByteStream</span></span></a><span class="mpre"> </span><a href="#loc_64_18_64_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_18_64_29&#39;)"><span class="hl_varref"><span class="mpre">httpLogFile</span></span></a><span class="mpre"> </span><a href="#loc_67_3_67_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_3_67_5&#39;)"><span class="hl_varref"><span class="mpre">c0</span></span></a><span class="mpre">
  </span><a href="#loc_73_1_73_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_12&#39;)"><span class="hl_varref"><span class="mpre">simpleHTTP_</span></span></a><span class="mpre"> </span><a href="#loc_68_3_68_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_3_68_4&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><a href="#loc_64_30_64_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_30_64_31&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Like &#39;simpleHTTP&#39;, but acting on an already opened stream.</span></span><span class="mpre">
</span><a href="#loc_73_1_73_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_12&#39;)"><span class="mpre">simpleHTTP_</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 72, srcSpanStartColumn = 16, srcSpanEndLine = 72, srcSpanEndColumn = 29}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 72, srcSpanStartColumn = 27, srcSpanEndLine = 72, srcSpanEndColumn = 29}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pul"><span class="mpre">HStream ty =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HandleStream</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre"> -&gt; </span><a href="Network.HTTP.Base.html#loc_292_6_292_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_292_6_292_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_339_6_339_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_339_6_339_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre">))
</span><a name="loc_73_1_73_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_12&#39;)"><span class="hl_fundecl"><span class="mpre">simpleHTTP_</span></span></a><span class="mpre"> </span><a name="loc_73_13_73_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_13_73_14&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_73_15_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_15_73_16&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = </span><a href="#loc_79_1_79_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_9&#39;)"><span class="hl_varref"><span class="mpre">sendHTTP</span></span></a><span class="mpre"> </span><a href="#loc_73_13_73_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_13_73_14&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_73_15_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_15_73_16&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | @sendHTTP hStream httpRequest@ transmits @httpRequest@ over</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @hStream@, but does not alter the status of the connection, nor request it to be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- closed upon receiving the response.</span></span><span class="mpre">
</span><a href="#loc_79_1_79_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_9&#39;)"><span class="mpre">sendHTTP</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 78, srcSpanStartColumn = 13, srcSpanEndLine = 78, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 78, srcSpanStartColumn = 24, srcSpanEndLine = 78, srcSpanEndColumn = 26}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pul"><span class="mpre">HStream ty =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HandleStream</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre"> -&gt; </span><a href="Network.HTTP.Base.html#loc_292_6_292_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_292_6_292_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_339_6_339_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_339_6_339_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre">))
</span><a name="loc_79_1_79_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_9&#39;)"><span class="hl_fundecl"><span class="mpre">sendHTTP</span></span></a><span class="mpre"> </span><a name="loc_79_10_79_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_10_79_14&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_79_15_79_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_15_79_17&#39;)"><span class="hl_vardecl"><span class="mpre">rq</span></span></a><span class="mpre"> = </span><a href="#loc_90_1_90_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_16&#39;)"><span class="hl_varref"><span class="mpre">sendHTTP_notify</span></span></a><span class="mpre"> </span><a href="#loc_79_10_79_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_10_79_14&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_79_15_79_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_15_79_17&#39;)"><span class="hl_varref"><span class="mpre">rq</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | @sendHTTP_notify hStream httpRequest action@ behaves like &#39;sendHTTP&#39;, but</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- lets you supply an IO @action@ to execute once the request has been successfully</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- transmitted over the connection. Useful when you want to set up tracing of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- request transmission and its performance.</span></span><span class="mpre">
</span><a href="#loc_90_1_90_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_16&#39;)"><span class="mpre">sendHTTP_notify</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 85, srcSpanStartColumn = 20, srcSpanEndLine = 86, srcSpanEndColumn = 19}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 86, srcSpanStartColumn = 17, srcSpanEndLine = 86, srcSpanEndColumn = 19}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pul"><span class="mpre">HStream ty
                =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HandleStream</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre">
                -&gt; </span><a href="Network.HTTP.Base.html#loc_292_6_292_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_292_6_292_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre">
                -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
                -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_339_6_339_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_339_6_339_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre">))
</span><a name="loc_90_1_90_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_16&#39;)"><span class="hl_fundecl"><span class="mpre">sendHTTP_notify</span></span></a><span class="mpre"> </span><a name="loc_90_17_90_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_17_90_21&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_90_22_90_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_22_90_24&#39;)"><span class="hl_vardecl"><span class="mpre">rq</span></span></a><span class="mpre"> </span><a name="loc_90_25_90_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_25_90_39&#39;)"><span class="hl_vardecl"><span class="mpre">onSendComplete</span></span></a><span class="mpre"> = do
  </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_95_3_95_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_3_95_16&#39;)"><span class="hl_varref"><span class="mpre">providedClose</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">closeOnEnd</span></span><span class="mpre"> </span><a href="#loc_90_17_90_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_17_90_21&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">)
  </span><a href="Control.Exception.Base.html#loc_229_1_229_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_229_1_229_12&#39;)"><span class="hl_varref"><span class="mpre">onException</span></span></a><span class="mpre"> (</span><a href="#loc_112_1_112_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_1_112_9&#39;)"><span class="hl_varref"><span class="mpre">sendMain</span></span></a><span class="mpre"> </span><a href="#loc_90_17_90_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_17_90_21&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_90_22_90_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_22_90_24&#39;)"><span class="hl_varref"><span class="mpre">rq</span></span></a><span class="mpre"> </span><a href="#loc_90_25_90_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_25_90_39&#39;)"><span class="hl_varref"><span class="mpre">onSendComplete</span></span></a><span class="mpre">)
              (</span><span class="hl_varref"><span class="mpre">close</span></span><span class="mpre"> </span><a href="#loc_90_17_90_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_17_90_21&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">)
 where
  </span><a name="loc_95_3_95_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_3_95_16&#39;)"><span class="hl_vardecl"><span class="mpre">providedClose</span></span></a><span class="mpre"> = </span><a href="Network.HTTP.Base.html#loc_877_1_877_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_877_1_877_14&#39;)"><span class="hl_varref"><span class="mpre">findConnClose</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_299_16_299_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_299_16_299_25&#39;)"><span class="hl_varref"><span class="mpre">rqHeaders</span></span></a><span class="mpre"> </span><a href="#loc_90_22_90_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_22_90_24&#39;)"><span class="hl_varref"><span class="mpre">rq</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- From RFC 2616, section 8.2.3:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Because of the presence of older implementations, the protocol allows</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ambiguous situations in which a client may send &quot;Expect: 100-</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- continue&quot; without receiving either a 417 (Expectation Failed) status</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- or a 100 (Continue) status. Therefore, when a client sends this</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- header field to an origin server (possibly via a proxy) from which it</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- has never seen a 100 (Continue) status, the client SHOULD NOT wait</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- for an indefinite period before sending the request body.&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Since we would wait forever, I have disabled use of 100-continue for now.</span></span><span class="mpre">
</span><a href="#loc_112_1_112_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_1_112_9&#39;)"><span class="mpre">sendMain</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 107, srcSpanStartColumn = 13, srcSpanEndLine = 108, srcSpanEndColumn = 12}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 108, srcSpanStartColumn = 10, srcSpanEndLine = 108, srcSpanEndColumn = 12}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem"><span class="mpre">HStream ty
         =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HandleStream</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre">
         -&gt; </span><a href="Network.HTTP.Base.html#loc_292_6_292_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_292_6_292_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre">
         -&gt; (</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)
         -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_339_6_339_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_339_6_339_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre">))
</span><a name="loc_112_1_112_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_1_112_9&#39;)"><span class="hl_fundecl"><span class="mpre">sendMain</span></span></a><span class="mpre"> </span><a name="loc_112_10_112_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_10_112_14&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_112_15_112_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_15_112_19&#39;)"><span class="hl_vardecl"><span class="mpre">rqst</span></span></a><span class="mpre"> </span><a name="loc_112_20_112_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_20_112_34&#39;)"><span class="hl_vardecl"><span class="mpre">onSendComplete</span></span></a><span class="mpre"> = do
      </span><span class="hl_comment"><span class="mpre">--let str = if null (rqBody rqst)</span></span><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">--              then show rqst</span></span><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">--              else show (insertHeader HdrExpect &quot;100-continue&quot; rqst)</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- TODO review throwing away of result</span></span><span class="mpre">
  _ &lt;- </span><span class="hl_varref"><span class="mpre">writeBlock</span></span><span class="mpre"> </span><a href="#loc_112_10_112_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_10_112_14&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> (</span><a href="Network.BufferType.html#loc_80_8_80_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_80_8_80_19&#39;)"><span class="hl_varref"><span class="mpre">buf_fromStr</span></span></a><span class="mpre"> </span><a href="Network.BufferType.html#loc_49_4_49_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_49_4_49_13&#39;)"><span class="hl_varref"><span class="mpre">bufferOps</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_112_15_112_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_15_112_19&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">)
    </span><span class="hl_comment"><span class="mpre">-- write body immediately, don&#39;t wait for 100 CONTINUE</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- TODO review throwing away of result</span></span><span class="mpre">
  _ &lt;- </span><span class="hl_varref"><span class="mpre">writeBlock</span></span><span class="mpre"> </span><a href="#loc_112_10_112_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_10_112_14&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_300_16_300_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_300_16_300_22&#39;)"><span class="hl_varref"><span class="mpre">rqBody</span></span></a><span class="mpre"> </span><a href="#loc_112_15_112_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_15_112_19&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">)
  </span><a href="#loc_112_20_112_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_20_112_34&#39;)"><span class="hl_varref"><span class="mpre">onSendComplete</span></span></a><span class="mpre">
  </span><a name="loc_122_3_122_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_3_122_6&#39;)"><span class="hl_vardecl"><span class="mpre">rsp</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_198_1_198_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_1_198_16&#39;)"><span class="hl_varref"><span class="mpre">getResponseHead</span></span></a><span class="mpre"> </span><a href="#loc_112_10_112_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_10_112_14&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
  </span><a href="#loc_136_1_136_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_1_136_15&#39;)"><span class="hl_varref"><span class="mpre">switchResponse</span></span></a><span class="mpre"> </span><a href="#loc_112_10_112_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_10_112_14&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> </span><a href="#loc_122_3_122_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_3_122_6&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre"> </span><a href="#loc_112_15_112_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_15_112_19&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">

   </span><span class="hl_comment"><span class="mpre">-- Hmmm, this could go bad if we keep getting &quot;100 Continue&quot;</span></span><span class="mpre">
   </span><span class="hl_comment"><span class="mpre">-- responses...  Except this should never happen according</span></span><span class="mpre">
   </span><span class="hl_comment"><span class="mpre">-- to the RFC.</span></span><span class="mpre">

</span><a href="#loc_136_1_136_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_1_136_15&#39;)"><span class="mpre">switchResponse</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 129, srcSpanStartColumn = 19, srcSpanEndLine = 130, srcSpanEndColumn = 18}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 130, srcSpanStartColumn = 16, srcSpanEndLine = 130, srcSpanEndColumn = 18}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem"><span class="mpre">HStream ty
               =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HandleStream</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre">
               -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">{- allow retry? -}</span></span><span class="mpre">
               -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">{- is body sent? -}</span></span><span class="mpre">
               -&gt; </span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ResponseData</span></span><span class="mpre">
               -&gt; </span><a href="Network.HTTP.Base.html#loc_292_6_292_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_292_6_292_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre">
               -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_339_6_339_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_339_6_339_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre">))
</span><a name="loc_136_1_136_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_1_136_15&#39;)"><span class="hl_fundecl"><span class="mpre">switchResponse</span></span></a><span class="mpre"> _ _ _ (</span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_136_28_136_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_28_136_29&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre">) _ = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_136_28_136_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_28_136_29&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">)
                </span><span class="hl_comment"><span class="mpre">-- retry on connreset?</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- if we attempt to use the same socket then there is an excellent</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- chance that the socket is not in a completely closed state.</span></span><span class="mpre">

</span><a href="#loc_136_1_136_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_1_136_15&#39;)"><span class="hl_fundecl"><span class="mpre">switchResponse</span></span></a><span class="mpre"> </span><a name="loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_141_21_141_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_21_141_32&#39;)"><span class="hl_vardecl"><span class="mpre">allow_retry</span></span></a><span class="mpre"> </span><a name="loc_141_33_141_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_33_141_41&#39;)"><span class="hl_vardecl"><span class="mpre">bdy_sent</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a name="loc_141_50_141_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_50_141_52&#39;)"><span class="hl_vardecl"><span class="mpre">cd</span></span></a><span class="mpre">,</span><a name="loc_141_53_141_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_53_141_55&#39;)"><span class="hl_vardecl"><span class="mpre">rn</span></span></a><span class="mpre">,</span><a name="loc_141_56_141_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_56_141_60&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre">)) </span><a name="loc_141_63_141_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_63_141_67&#39;)"><span class="hl_vardecl"><span class="mpre">rqst</span></span></a><span class="mpre"> = 
   case </span><a href="Network.HTTP.Base.html#loc_560_1_560_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_560_1_560_14&#39;)"><span class="hl_varref"><span class="mpre">matchResponse</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_298_16_298_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_298_16_298_24&#39;)"><span class="hl_varref"><span class="mpre">rqMethod</span></span></a><span class="mpre"> </span><a href="#loc_141_63_141_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_63_141_67&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">) </span><a href="#loc_141_50_141_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_50_141_52&#39;)"><span class="hl_varref"><span class="mpre">cd</span></span></a><span class="mpre"> of
     </span><a href="Network.HTTP.Base.html#loc_553_4_553_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_553_4_553_12&#39;)"><span class="hl_conref"><span class="mpre">Continue</span></span></a><span class="mpre">
      | </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><a href="#loc_141_33_141_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_33_141_41&#39;)"><span class="hl_varref"><span class="mpre">bdy_sent</span></span></a><span class="mpre"> -&gt; do </span><span class="hl_comment"><span class="mpre">{- Time to send the body -}</span></span><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">writeBlock</span></span><span class="mpre"> </span><a href="#loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_300_16_300_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_300_16_300_22&#39;)"><span class="hl_varref"><span class="mpre">rqBody</span></span></a><span class="mpre"> </span><a href="#loc_141_63_141_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_63_141_67&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">either</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre">)
           (\ _ -&gt; do
              </span><a name="loc_147_15_147_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_15_147_18&#39;)"><span class="hl_vardecl"><span class="mpre">rsp</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_198_1_198_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_1_198_16&#39;)"><span class="hl_varref"><span class="mpre">getResponseHead</span></span></a><span class="mpre"> </span><a href="#loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
              </span><a href="#loc_136_1_136_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_1_136_15&#39;)"><span class="hl_varref"><span class="mpre">switchResponse</span></span></a><span class="mpre"> </span><a href="#loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_141_21_141_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_21_141_32&#39;)"><span class="hl_varref"><span class="mpre">allow_retry</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> </span><a href="#loc_147_15_147_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_15_147_18&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre"> </span><a href="#loc_141_63_141_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_63_141_67&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">)
      | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">    -&gt; do </span><span class="hl_comment"><span class="mpre">{- keep waiting -}</span></span><span class="mpre">
        </span><a name="loc_150_9_150_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_9_150_12&#39;)"><span class="hl_vardecl"><span class="mpre">rsp</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_198_1_198_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_1_198_16&#39;)"><span class="hl_varref"><span class="mpre">getResponseHead</span></span></a><span class="mpre"> </span><a href="#loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
        </span><a href="#loc_136_1_136_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_1_136_15&#39;)"><span class="hl_varref"><span class="mpre">switchResponse</span></span></a><span class="mpre"> </span><a href="#loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_141_21_141_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_21_141_32&#39;)"><span class="hl_varref"><span class="mpre">allow_retry</span></span></a><span class="mpre"> </span><a href="#loc_141_33_141_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_33_141_41&#39;)"><span class="hl_varref"><span class="mpre">bdy_sent</span></span></a><span class="mpre"> </span><a href="#loc_150_9_150_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_9_150_12&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre"> </span><a href="#loc_141_63_141_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_63_141_67&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">

     </span><a href="Network.HTTP.Base.html#loc_554_4_554_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_554_4_554_9&#39;)"><span class="hl_conref"><span class="mpre">Retry</span></span></a><span class="mpre"> -&gt; do </span><span class="hl_comment"><span class="mpre">{- Request with &quot;Expect&quot; header failed.
                    Trouble is the request contains Expects
                    other than &quot;100-Continue&quot; -}</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- TODO review throwing away of result</span></span><span class="mpre">
        _ &lt;- </span><span class="hl_varref"><span class="mpre">writeBlock</span></span><span class="mpre"> </span><a href="#loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> ((</span><a href="Network.BufferType.html#loc_78_8_78_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_78_8_78_18&#39;)"><span class="hl_varref"><span class="mpre">buf_append</span></span></a><span class="mpre"> </span><a href="Network.BufferType.html#loc_49_4_49_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_49_4_49_13&#39;)"><span class="hl_varref"><span class="mpre">bufferOps</span></span></a><span class="mpre">)
                                     (</span><a href="Network.BufferType.html#loc_80_8_80_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_80_8_80_19&#39;)"><span class="hl_varref"><span class="mpre">buf_fromStr</span></span></a><span class="mpre"> </span><a href="Network.BufferType.html#loc_49_4_49_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_49_4_49_13&#39;)"><span class="hl_varref"><span class="mpre">bufferOps</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_141_63_141_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_63_141_67&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">))
                                     (</span><a href="Network.HTTP.Base.html#loc_300_16_300_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_300_16_300_22&#39;)"><span class="hl_varref"><span class="mpre">rqBody</span></span></a><span class="mpre"> </span><a href="#loc_141_63_141_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_63_141_67&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">))
        </span><a name="loc_160_9_160_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_9_160_12&#39;)"><span class="hl_vardecl"><span class="mpre">rsp</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_198_1_198_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_1_198_16&#39;)"><span class="hl_varref"><span class="mpre">getResponseHead</span></span></a><span class="mpre"> </span><a href="#loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
        </span><a href="#loc_136_1_136_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_1_136_15&#39;)"><span class="hl_varref"><span class="mpre">switchResponse</span></span></a><span class="mpre"> </span><a href="#loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> </span><a href="#loc_141_33_141_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_33_141_41&#39;)"><span class="hl_varref"><span class="mpre">bdy_sent</span></span></a><span class="mpre"> </span><a href="#loc_160_9_160_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_9_160_12&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre"> </span><a href="#loc_141_63_141_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_63_141_67&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">
                     
     </span><a href="Network.HTTP.Base.html#loc_555_4_555_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_555_4_555_8&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> -&gt; do
       </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_877_1_877_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_877_1_877_14&#39;)"><span class="hl_varref"><span class="mpre">findConnClose</span></span></a><span class="mpre"> </span><a href="#loc_141_56_141_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_56_141_60&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">)
            (</span><span class="hl_varref"><span class="mpre">closeOnEnd</span></span><span class="mpre"> </span><a href="#loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">)
       </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Response</span></span><span class="mpre"> </span><a href="#loc_141_50_141_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_50_141_52&#39;)"><span class="hl_varref"><span class="mpre">cd</span></span></a><span class="mpre"> </span><a href="#loc_141_53_141_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_53_141_55&#39;)"><span class="hl_varref"><span class="mpre">rn</span></span></a><span class="mpre"> </span><a href="#loc_141_56_141_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_56_141_60&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre"> (</span><a href="Network.BufferType.html#loc_77_8_77_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_77_8_77_17&#39;)"><span class="hl_varref"><span class="mpre">buf_empty</span></span></a><span class="mpre"> </span><a href="Network.BufferType.html#loc_49_4_49_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_49_4_49_13&#39;)"><span class="hl_varref"><span class="mpre">bufferOps</span></span></a><span class="mpre">))

     </span><a href="Network.HTTP.Base.html#loc_557_4_557_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_557_4_557_15&#39;)"><span class="hl_conref"><span class="mpre">DieHorribly</span></span></a><span class="mpre"> </span><a name="loc_168_18_168_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_18_168_21&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> -&gt; do
       </span><span class="hl_varref"><span class="mpre">close</span></span><span class="mpre"> </span><a href="#loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
       </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_994_1_994_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_994_1_994_19&#39;)"><span class="hl_varref"><span class="mpre">responseParseError</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Invalid response:&quot;</span></span><span class="mpre"> </span><a href="#loc_168_18_168_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_18_168_21&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">)
     </span><a href="Network.HTTP.Base.html#loc_556_4_556_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_556_4_556_16&#39;)"><span class="hl_conref"><span class="mpre">ExpectEntity</span></span></a><span class="mpre"> -&gt; do
       </span><a name="loc_172_8_172_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_8_172_9&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Stream.html#loc_65_1_65_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_65_1_65_6&#39;)"><span class="hl_varref"><span class="mpre">fmapE</span></span></a><span class="mpre"> (\ (</span><a name="loc_172_23_172_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_23_172_27&#39;)"><span class="hl_vardecl"><span class="mpre">ftrs</span></span></a><span class="mpre">,</span><a name="loc_172_28_172_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_28_172_31&#39;)"><span class="hl_vardecl"><span class="mpre">bdy</span></span></a><span class="mpre">) -&gt; </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Response</span></span><span class="mpre"> </span><a href="#loc_141_50_141_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_50_141_52&#39;)"><span class="hl_varref"><span class="mpre">cd</span></span></a><span class="mpre"> </span><a href="#loc_141_53_141_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_53_141_55&#39;)"><span class="hl_varref"><span class="mpre">rn</span></span></a><span class="mpre"> (</span><a href="#loc_141_56_141_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_56_141_60&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="hl_infix"><span class="mpre">++</span></span><a href="#loc_172_23_172_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_23_172_27&#39;)"><span class="hl_varref"><span class="mpre">ftrs</span></span></a><span class="mpre">) </span><a href="#loc_172_28_172_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_28_172_31&#39;)"><span class="hl_varref"><span class="mpre">bdy</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
             </span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_894_1_894_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_894_1_894_16&#39;)"><span class="hl_varref"><span class="mpre">hopefulTransfer</span></span></a><span class="mpre"> </span><a href="#loc_194_8_194_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_8_194_10&#39;)"><span class="hl_varref"><span class="mpre">bo</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">readLine</span></span><span class="mpre"> </span><a href="#loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">) [])
                       (\ </span><a name="loc_174_27_174_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_27_174_28&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; 
                          </span><a href="Network.HTTP.Utils.html#loc_87_1_87_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Utils.html#loc_87_1_87_9&#39;)"><span class="hl_varref"><span class="mpre">readsOne</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_884_1_884_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_884_1_884_15&#39;)"><span class="hl_varref"><span class="mpre">linearTransfer</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">readBlock</span></span><span class="mpre"> </span><a href="#loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">))
                                   (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="hl_infix"><span class="mpre">$</span></span><a href="Network.HTTP.Base.html#loc_994_1_994_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_994_1_994_19&#39;)"><span class="hl_varref"><span class="mpre">responseParseError</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;unrecognized content-length value&quot;</span></span><span class="mpre"> </span><a href="#loc_174_27_174_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_27_174_28&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)
                                     </span><a href="#loc_174_27_174_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_27_174_28&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)
                        </span><a href="#loc_193_8_193_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_8_193_10&#39;)"><span class="hl_varref"><span class="mpre">cl</span></span></a><span class="mpre">)
                   (</span><a href="#loc_248_1_248_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_1_248_10&#39;)"><span class="hl_varref"><span class="mpre">ifChunked</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_908_1_908_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_908_1_908_16&#39;)"><span class="hl_varref"><span class="mpre">chunkedTransfer</span></span></a><span class="mpre"> </span><a href="#loc_194_8_194_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_8_194_10&#39;)"><span class="hl_varref"><span class="mpre">bo</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">readLine</span></span><span class="mpre"> </span><a href="#loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">readBlock</span></span><span class="mpre"> </span><a href="#loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">))
                              (</span><a href="Network.HTTP.Base.html#loc_950_1_950_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_950_1_950_18&#39;)"><span class="hl_varref"><span class="mpre">uglyDeathTransfer</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;sendHTTP&quot;</span></span><span class="mpre">))
                   </span><a href="#loc_192_8_192_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_8_192_10&#39;)"><span class="hl_varref"><span class="mpre">tc</span></span></a><span class="mpre">
       case </span><a href="#loc_172_8_172_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_8_172_9&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> of
         </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 183, srcSpanStartColumn = 10, srcSpanEndLine = 183, srcSpanEndColumn = 16}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 183, srcSpanStartColumn = 14, srcSpanEndLine = 183, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStr"><span class="mpre">Left{}</span></span><span class="mpre"> -&gt; do
           </span><span class="hl_varref"><span class="mpre">close</span></span><span class="mpre"> </span><a href="#loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
           </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_172_8_172_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_8_172_9&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
         </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Response</span></span><span class="mpre"> _ _ </span><a name="loc_186_30_186_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_30_186_32&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> _) -&gt; do
           </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_877_1_877_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_877_1_877_14&#39;)"><span class="hl_varref"><span class="mpre">findConnClose</span></span></a><span class="mpre"> </span><a href="#loc_186_30_186_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_30_186_32&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">)
                (</span><span class="hl_varref"><span class="mpre">closeOnEnd</span></span><span class="mpre"> </span><a href="#loc_141_16_141_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_16_141_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">)
           </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_172_8_172_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_8_172_9&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

      where
       </span><a name="loc_192_8_192_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_8_192_10&#39;)"><span class="hl_vardecl"><span class="mpre">tc</span></span></a><span class="mpre"> = </span><a href="Network.HTTP.Headers.html#loc_255_1_255_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Headers.html#loc_255_1_255_13&#39;)"><span class="hl_varref"><span class="mpre">lookupHeader</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Headers.html#loc_80_4_80_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Headers.html#loc_80_4_80_23&#39;)"><span class="hl_conref"><span class="mpre">HdrTransferEncoding</span></span></a><span class="mpre"> </span><a href="#loc_141_56_141_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_56_141_60&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">
       </span><a name="loc_193_8_193_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_8_193_10&#39;)"><span class="hl_vardecl"><span class="mpre">cl</span></span></a><span class="mpre"> = </span><a href="Network.HTTP.Headers.html#loc_255_1_255_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Headers.html#loc_255_1_255_13&#39;)"><span class="hl_varref"><span class="mpre">lookupHeader</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Headers.html#loc_121_4_121_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Headers.html#loc_121_4_121_20&#39;)"><span class="hl_conref"><span class="mpre">HdrContentLength</span></span></a><span class="mpre"> </span><a href="#loc_141_56_141_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_56_141_60&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">
       </span><a name="loc_194_8_194_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_8_194_10&#39;)"><span class="hl_vardecl"><span class="mpre">bo</span></span></a><span class="mpre"> = </span><a href="Network.BufferType.html#loc_49_4_49_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_49_4_49_13&#39;)"><span class="hl_varref"><span class="mpre">bufferOps</span></span></a><span class="mpre">
                    
</span><span class="hl_comment"><span class="mpre">-- reads and parses headers</span></span><span class="mpre">
</span><a href="#loc_198_1_198_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_1_198_16&#39;)"><span class="mpre">getResponseHead</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 197, srcSpanStartColumn = 20, srcSpanEndLine = 197, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 197, srcSpanStartColumn = 31, srcSpanEndLine = 197, srcSpanEndColumn = 33}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem"><span class="mpre">HStream ty =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HandleStream</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ResponseData</span></span><span class="mpre">)
</span><a name="loc_198_1_198_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_1_198_16&#39;)"><span class="hl_fundecl"><span class="mpre">getResponseHead</span></span></a><span class="mpre"> </span><a name="loc_198_17_198_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_17_198_21&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> = 
   </span><a href="Network.Stream.html#loc_65_1_65_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_65_1_65_6&#39;)"><span class="hl_varref"><span class="mpre">fmapE</span></span></a><span class="mpre"> (\</span><a name="loc_199_12_199_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_12_199_14&#39;)"><span class="hl_vardecl"><span class="mpre">es</span></span></a><span class="mpre"> -&gt; </span><a href="Network.HTTP.Base.html#loc_463_1_463_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_463_1_463_18&#39;)"><span class="hl_varref"><span class="mpre">parseResponseHead</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> (</span><a href="Network.BufferType.html#loc_81_8_81_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_81_8_81_17&#39;)"><span class="hl_varref"><span class="mpre">buf_toStr</span></span></a><span class="mpre"> </span><a href="Network.BufferType.html#loc_49_4_49_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_49_4_49_13&#39;)"><span class="hl_varref"><span class="mpre">bufferOps</span></span></a><span class="mpre">) </span><a href="#loc_199_12_199_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_12_199_14&#39;)"><span class="hl_varref"><span class="mpre">es</span></span></a><span class="mpre">))
         (</span><a href="Network.HTTP.Base.html#loc_956_1_956_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_956_1_956_15&#39;)"><span class="hl_varref"><span class="mpre">readTillEmpty1</span></span></a><span class="mpre"> </span><a href="Network.BufferType.html#loc_49_4_49_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_49_4_49_13&#39;)"><span class="hl_varref"><span class="mpre">bufferOps</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">readLine</span></span><span class="mpre"> </span><a href="#loc_198_17_198_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_17_198_21&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">))

</span><span class="hl_comment"><span class="mpre">-- | @receiveHTTP hStream@ reads a &#39;Request&#39; from the &#39;HandleStream&#39; @hStream@</span></span><span class="mpre">
</span><a href="#loc_204_1_204_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_1_204_12&#39;)"><span class="mpre">receiveHTTP</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 203, srcSpanStartColumn = 16, srcSpanEndLine = 203, srcSpanEndColumn = 32}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 203, srcSpanStartColumn = 30, srcSpanEndLine = 203, srcSpanEndColumn = 32}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem"><span class="mpre">HStream bufTy =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HandleStream</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">bufTy</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_292_6_292_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_292_6_292_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">bufTy</span></span><span class="mpre">))
</span><a name="loc_204_1_204_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_1_204_12&#39;)"><span class="hl_fundecl"><span class="mpre">receiveHTTP</span></span></a><span class="mpre"> </span><a name="loc_204_13_204_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_13_204_17&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> = </span><a href="#loc_208_4_208_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_4_208_18&#39;)"><span class="hl_varref"><span class="mpre">getRequestHead</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">either</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre">) </span><a href="#loc_212_4_212_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_4_212_18&#39;)"><span class="hl_varref"><span class="mpre">processRequest</span></span></a><span class="mpre">
  where
    </span><span class="hl_comment"><span class="mpre">-- reads and parses headers</span></span><span class="mpre">
   </span><a href="#loc_208_4_208_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_4_208_18&#39;)"><span class="mpre">getRequestHead</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">RequestData</span></span><span class="mpre">)
   </span><a name="loc_208_4_208_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_4_208_18&#39;)"><span class="hl_vardecl"><span class="mpre">getRequestHead</span></span></a><span class="mpre"> = do
      </span><a href="Network.Stream.html#loc_65_1_65_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_65_1_65_6&#39;)"><span class="hl_varref"><span class="mpre">fmapE</span></span></a><span class="mpre"> (\</span><a name="loc_209_15_209_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_15_209_17&#39;)"><span class="hl_vardecl"><span class="mpre">es</span></span></a><span class="mpre"> -&gt; </span><a href="Network.HTTP.Base.html#loc_440_1_440_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_440_1_440_17&#39;)"><span class="hl_varref"><span class="mpre">parseRequestHead</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> (</span><a href="Network.BufferType.html#loc_81_8_81_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_81_8_81_17&#39;)"><span class="hl_varref"><span class="mpre">buf_toStr</span></span></a><span class="mpre"> </span><a href="Network.BufferType.html#loc_49_4_49_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_49_4_49_13&#39;)"><span class="hl_varref"><span class="mpre">bufferOps</span></span></a><span class="mpre">) </span><a href="#loc_209_15_209_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_15_209_17&#39;)"><span class="hl_varref"><span class="mpre">es</span></span></a><span class="mpre">))
            (</span><a href="Network.HTTP.Base.html#loc_956_1_956_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_956_1_956_15&#39;)"><span class="hl_varref"><span class="mpre">readTillEmpty1</span></span></a><span class="mpre"> </span><a href="Network.BufferType.html#loc_49_4_49_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_49_4_49_13&#39;)"><span class="hl_varref"><span class="mpre">bufferOps</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">readLine</span></span><span class="mpre"> </span><a href="#loc_204_13_204_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_13_204_17&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">))
        
   </span><a name="loc_212_4_212_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_4_212_18&#39;)"><span class="hl_fundecl"><span class="mpre">processRequest</span></span></a><span class="mpre"> (</span><a name="loc_212_20_212_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_20_212_22&#39;)"><span class="hl_vardecl"><span class="mpre">rm</span></span></a><span class="mpre">,</span><a name="loc_212_23_212_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_23_212_26&#39;)"><span class="hl_vardecl"><span class="mpre">uri</span></span></a><span class="mpre">,</span><a name="loc_212_27_212_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_27_212_31&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre">) =
      </span><a href="Network.Stream.html#loc_65_1_65_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_65_1_65_6&#39;)"><span class="hl_varref"><span class="mpre">fmapE</span></span></a><span class="mpre"> (\ (</span><a name="loc_213_17_213_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_17_213_21&#39;)"><span class="hl_vardecl"><span class="mpre">ftrs</span></span></a><span class="mpre">,</span><a name="loc_213_22_213_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_22_213_25&#39;)"><span class="hl_vardecl"><span class="mpre">bdy</span></span></a><span class="mpre">) -&gt; </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Request</span></span><span class="mpre"> </span><a href="#loc_212_23_212_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_23_212_26&#39;)"><span class="hl_varref"><span class="mpre">uri</span></span></a><span class="mpre"> </span><a href="#loc_212_20_212_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_20_212_22&#39;)"><span class="hl_varref"><span class="mpre">rm</span></span></a><span class="mpre"> (</span><a href="#loc_212_27_212_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_27_212_31&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="hl_infix"><span class="mpre">++</span></span><a href="#loc_213_17_213_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_17_213_21&#39;)"><span class="hl_varref"><span class="mpre">ftrs</span></span></a><span class="mpre">) </span><a href="#loc_213_22_213_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_22_213_25&#39;)"><span class="hl_varref"><span class="mpre">bdy</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
             </span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> 
              (</span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> ([], </span><a href="Network.BufferType.html#loc_77_8_77_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_77_8_77_17&#39;)"><span class="hl_varref"><span class="mpre">buf_empty</span></span></a><span class="mpre"> </span><a href="#loc_228_6_228_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_6_228_8&#39;)"><span class="hl_varref"><span class="mpre">bo</span></span></a><span class="mpre">))) </span><span class="hl_comment"><span class="mpre">-- hopefulTransfer &quot;&quot;</span></span><span class="mpre">
                     (\ </span><a name="loc_216_25_216_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_25_216_26&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; </span><a href="Network.HTTP.Utils.html#loc_87_1_87_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Utils.html#loc_87_1_87_9&#39;)"><span class="hl_varref"><span class="mpre">readsOne</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_884_1_884_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_884_1_884_15&#39;)"><span class="hl_varref"><span class="mpre">linearTransfer</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">readBlock</span></span><span class="mpre"> </span><a href="#loc_204_13_204_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_13_204_17&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">))
                                      (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="hl_infix"><span class="mpre">$</span></span><a href="Network.HTTP.Base.html#loc_994_1_994_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_994_1_994_19&#39;)"><span class="hl_varref"><span class="mpre">responseParseError</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;unrecognized Content-Length value&quot;</span></span><span class="mpre"> </span><a href="#loc_216_25_216_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_25_216_26&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)
                                      </span><a href="#loc_216_25_216_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_25_216_26&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)
                                      
                     </span><a href="#loc_227_6_227_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_6_227_8&#39;)"><span class="hl_varref"><span class="mpre">cl</span></span></a><span class="mpre">)
                (</span><a href="#loc_248_1_248_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_1_248_10&#39;)"><span class="hl_varref"><span class="mpre">ifChunked</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_908_1_908_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_908_1_908_16&#39;)"><span class="hl_varref"><span class="mpre">chunkedTransfer</span></span></a><span class="mpre"> </span><a href="#loc_228_6_228_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_6_228_8&#39;)"><span class="hl_varref"><span class="mpre">bo</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">readLine</span></span><span class="mpre"> </span><a href="#loc_204_13_204_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_13_204_17&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">readBlock</span></span><span class="mpre"> </span><a href="#loc_204_13_204_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_13_204_17&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">))
                         (</span><a href="Network.HTTP.Base.html#loc_950_1_950_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_950_1_950_18&#39;)"><span class="hl_varref"><span class="mpre">uglyDeathTransfer</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;receiveHTTP&quot;</span></span><span class="mpre">))
              </span><a href="#loc_226_6_226_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_6_226_8&#39;)"><span class="hl_varref"><span class="mpre">tc</span></span></a><span class="mpre">
    where
     </span><span class="hl_comment"><span class="mpre">-- FIXME : Also handle 100-continue.</span></span><span class="mpre">
     </span><a name="loc_226_6_226_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_6_226_8&#39;)"><span class="hl_vardecl"><span class="mpre">tc</span></span></a><span class="mpre"> = </span><a href="Network.HTTP.Headers.html#loc_255_1_255_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Headers.html#loc_255_1_255_13&#39;)"><span class="hl_varref"><span class="mpre">lookupHeader</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Headers.html#loc_80_4_80_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Headers.html#loc_80_4_80_23&#39;)"><span class="hl_conref"><span class="mpre">HdrTransferEncoding</span></span></a><span class="mpre"> </span><a href="#loc_212_27_212_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_27_212_31&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">
     </span><a name="loc_227_6_227_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_6_227_8&#39;)"><span class="hl_vardecl"><span class="mpre">cl</span></span></a><span class="mpre"> = </span><a href="Network.HTTP.Headers.html#loc_255_1_255_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Headers.html#loc_255_1_255_13&#39;)"><span class="hl_varref"><span class="mpre">lookupHeader</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Headers.html#loc_121_4_121_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Headers.html#loc_121_4_121_20&#39;)"><span class="hl_conref"><span class="mpre">HdrContentLength</span></span></a><span class="mpre"> </span><a href="#loc_212_27_212_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_27_212_31&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">
     </span><a name="loc_228_6_228_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_6_228_8&#39;)"><span class="hl_vardecl"><span class="mpre">bo</span></span></a><span class="mpre"> = </span><a href="Network.BufferType.html#loc_49_4_49_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_49_4_49_13&#39;)"><span class="hl_varref"><span class="mpre">bufferOps</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | @respondHTTP hStream httpResponse@ transmits an HTTP &#39;Response&#39; over</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the &#39;HandleStream&#39; @hStream@. It could be used to implement simple web</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- server interactions, performing the dual role to &#39;sendHTTP&#39;.</span></span><span class="mpre">
</span><a href="#loc_234_1_234_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_234_1_234_12&#39;)"><span class="mpre">respondHTTP</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 233, srcSpanStartColumn = 16, srcSpanEndLine = 233, srcSpanEndColumn = 29}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/HandleStream.hs&quot;, srcSpanStartLine = 233, srcSpanStartColumn = 27, srcSpanEndLine = 233, srcSpanEndColumn = 29}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem"><span class="mpre">HStream ty =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HandleStream</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre"> -&gt; </span><a href="Network.HTTP.Base.html#loc_339_6_339_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_339_6_339_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_234_1_234_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_234_1_234_12&#39;)"><span class="hl_fundecl"><span class="mpre">respondHTTP</span></span></a><span class="mpre"> </span><a name="loc_234_13_234_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_234_13_234_17&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_234_18_234_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_234_18_234_21&#39;)"><span class="hl_vardecl"><span class="mpre">rsp</span></span></a><span class="mpre"> = do 
  </span><span class="hl_comment"><span class="mpre">-- TODO: review throwing away of result</span></span><span class="mpre">
  _ &lt;- </span><span class="hl_varref"><span class="mpre">writeBlock</span></span><span class="mpre"> </span><a href="#loc_234_13_234_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_234_13_234_17&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> (</span><a href="Network.BufferType.html#loc_80_8_80_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_80_8_80_19&#39;)"><span class="hl_varref"><span class="mpre">buf_fromStr</span></span></a><span class="mpre"> </span><a href="Network.BufferType.html#loc_49_4_49_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_49_4_49_13&#39;)"><span class="hl_varref"><span class="mpre">bufferOps</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_234_18_234_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_234_18_234_21&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre">)
   </span><span class="hl_comment"><span class="mpre">-- write body immediately, don&#39;t wait for 100 CONTINUE</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- TODO: review throwing away of result</span></span><span class="mpre">
  _ &lt;- </span><span class="hl_varref"><span class="mpre">writeBlock</span></span><span class="mpre"> </span><a href="#loc_234_13_234_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_234_13_234_17&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_343_16_343_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_343_16_343_23&#39;)"><span class="hl_varref"><span class="mpre">rspBody</span></span></a><span class="mpre"> </span><a href="#loc_234_18_234_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_234_18_234_21&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre">)
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_245_1_245_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_1_245_11&#39;)"><span class="mpre">headerName</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_245_1_245_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_1_245_11&#39;)"><span class="hl_fundecl"><span class="mpre">headerName</span></span></a><span class="mpre"> </span><a name="loc_245_12_245_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_12_245_13&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="GHC.Unicode.html#loc_143_1_143_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_143_1_143_8&#39;)"><span class="hl_varref"><span class="mpre">toLower</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Utils.html#loc_58_1_58_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Utils.html#loc_58_1_58_5&#39;)"><span class="hl_varref"><span class="mpre">trim</span></span></a><span class="mpre"> </span><a href="#loc_245_12_245_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_12_245_13&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)

</span><a href="#loc_248_1_248_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_1_248_10&#39;)"><span class="mpre">ifChunked</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_248_1_248_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_1_248_10&#39;)"><span class="hl_fundecl"><span class="mpre">ifChunked</span></span></a><span class="mpre"> </span><a name="loc_248_11_248_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_11_248_12&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> </span><a name="loc_248_13_248_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_13_248_14&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> </span><a name="loc_248_15_248_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_15_248_16&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = 
  case </span><a href="#loc_245_1_245_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_1_245_11&#39;)"><span class="hl_varref"><span class="mpre">headerName</span></span></a><span class="mpre"> </span><a href="#loc_248_15_248_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_15_248_16&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
    </span><span class="hl_string"><span class="mpre">&quot;chunked&quot;</span></span><span class="mpre"> -&gt; </span><a href="#loc_248_11_248_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_11_248_12&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
    _ -&gt; </span><a href="#loc_248_13_248_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_13_248_14&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

</span></div></body></html>