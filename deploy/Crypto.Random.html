<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE FlexibleInstances, TypeSynonymInstances, DeriveDataTypeable, CPP,
             BangPatterns #-}
</span><span class="hl_comment"><span class="mpre">{-|
 Maintainer: Thomas.DuBuisson@gmail.com
 Stability: beta
 Portability: portable 


 This module is for instantiating cryptographicly strong
determinitic random bit generators (DRBGs, aka PRNGs) For the simple
use case of using the system random number generator
(&#39;System.Crypto.Random&#39;) to seed the DRBG:

@   g &lt;- newGenIO
@

 Users needing to provide their own entropy can call &#39;newGen&#39; directly
 
@    entropy &lt;- getEntropy nrBytes
    let generator = newGen entropy
@

-}</span></span><span class="mpre">

module Crypto.Random
       ( </span><span class="hl_comment"><span class="mpre">-- * Basic Interface</span></span><span class="mpre">
         CryptoRandomGen(..)
       , GenError (..)
       , ReseedInfo (..)
         </span><span class="hl_comment"><span class="mpre">-- * Helper functions and expanded interface</span></span><span class="mpre">
       , splitGen
       , throwLeft
         </span><span class="hl_comment"><span class="mpre">-- * Instances</span></span><span class="mpre">
       , SystemRandom
       ) where

import Control.Monad (</span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="mpre">liftM</span></a><span class="mpre">)
import Control.Exception
import Crypto.Types
import Crypto.Util
import Data.Bits (</span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="mpre">xor</span></a><span class="mpre">, </span><a href="Data.Bits.html#loc_158_5_158_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_158_5_158_11&#39;)"><span class="mpre">setBit</span></a><span class="mpre">, </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="mpre">shiftR</span></a><span class="mpre">, </span><a href="Data.Bits.html#loc_200_5_200_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_200_5_200_11&#39;)"><span class="mpre">shiftL</span></a><span class="mpre">, (.&amp;.))
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Random.hs&quot;, srcSpanStartLine = 42, srcSpanStartColumn = 8, srcSpanEndLine = 42, srcSpanEndColumn = 17}, srcInfoPoints = []}) &quot;Data.Data&quot;"><span class="mpre">Data.Data</span></span><span class="mpre">
import Data.List (</span><a href="Data.List.html#loc_993_1_993_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_993_1_993_7&#39;)"><span class="mpre">foldl&#39;</span></a><span class="mpre">)
import Data.Tagged
import Data.Typeable
import Data.Word
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Random.hs&quot;, srcSpanStartLine = 47, srcSpanStartColumn = 8, srcSpanEndLine = 47, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;System.Entropy&quot;"><span class="mpre">System.Entropy</span></span><span class="mpre">
import System.IO.Unsafe(</span><a href="GHC.IO.html#loc_213_1_213_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_213_1_213_19&#39;)"><span class="mpre">unsafeInterleaveIO</span></a><span class="mpre">)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Random.hs&quot;, srcSpanStartLine = 49, srcSpanStartColumn = 18, srcSpanEndLine = 49, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Random.hs&quot;, srcSpanStartLine = 50, srcSpanStartColumn = 18, srcSpanEndLine = 50, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L
import qualified Foreign.ForeignPtr as FP

#if MIN_VERSION_tagged(0,2,0)
import Data.Proxy
#endif

</span><span class="hl_comment"><span class="mpre">-- |Generator failures should always return the appropriate GenError.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note &#39;GenError&#39; in an instance of exception but wether or not an</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exception is thrown depends on if the selected generator (read:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- if you don&#39;t want execptions from code that uses &#39;throw&#39; then</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- pass in a generator that never has an error for the used functions)</span></span><span class="mpre">
data </span><a name="loc_62_6_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_14&#39;)"><span class="hl_tycondecl"><span class="mpre">GenError</span></span></a><span class="mpre"> =
          </span><a name="loc_63_11_63_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_11_63_24&#39;)"><span class="hl_condecl"><span class="mpre">GenErrorOther</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^ Misc</span></span><span class="mpre">
        | </span><a name="loc_64_11_64_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_11_64_32&#39;)"><span class="hl_condecl"><span class="mpre">RequestedTooManyBytes</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ Requested more bytes than a</span></span><span class="mpre">
                                </span><span class="hl_comment"><span class="mpre">-- single pass can generate (The</span></span><span class="mpre">
                                </span><span class="hl_comment"><span class="mpre">-- maximum request is generator</span></span><span class="mpre">
                                </span><span class="hl_comment"><span class="mpre">-- dependent)</span></span><span class="mpre">
        | </span><a name="loc_68_11_68_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_11_68_23&#39;)"><span class="hl_condecl"><span class="mpre">RangeInvalid</span></span></a><span class="mpre">          </span><span class="hl_comment"><span class="mpre">-- ^ When using @genInteger g (l,h)@</span></span><span class="mpre">
                                </span><span class="hl_comment"><span class="mpre">-- and @logBase 2 (h - l) &gt; (maxBound</span></span><span class="mpre">
                                </span><span class="hl_comment"><span class="mpre">-- :: Int)@.</span></span><span class="mpre">
        | </span><a name="loc_71_11_71_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_21&#39;)"><span class="hl_condecl"><span class="mpre">NeedReseed</span></span></a><span class="mpre">            </span><span class="hl_comment"><span class="mpre">-- ^ Some generators cease operation</span></span><span class="mpre">
                                </span><span class="hl_comment"><span class="mpre">-- after too high a count without a</span></span><span class="mpre">
                                </span><span class="hl_comment"><span class="mpre">-- reseed (ex: NIST SP 800-90)</span></span><span class="mpre">
        | </span><a name="loc_74_11_74_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_11_74_27&#39;)"><span class="hl_condecl"><span class="mpre">NotEnoughEntropy</span></span></a><span class="mpre">      </span><span class="hl_comment"><span class="mpre">-- ^ For instantiating new generators</span></span><span class="mpre">
                                </span><span class="hl_comment"><span class="mpre">-- (or reseeding)</span></span><span class="mpre">
        | </span><a name="loc_76_11_76_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_11_76_28&#39;)"><span class="hl_condecl"><span class="mpre">NeedsInfiniteSeed</span></span></a><span class="mpre">     </span><span class="hl_comment"><span class="mpre">-- ^ This generator can not be</span></span><span class="mpre">
                                </span><span class="hl_comment"><span class="mpre">-- instantiated or reseeded with a</span></span><span class="mpre">
                                </span><span class="hl_comment"><span class="mpre">-- finite seed (ex: &#39;SystemRandom&#39;)</span></span><span class="mpre">
  </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Random.hs&quot;, srcSpanStartLine = 79, srcSpanStartColumn = 3, srcSpanEndLine = 79, srcSpanEndColumn = 49}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Random.hs&quot;, srcSpanStartLine = 79, srcSpanStartColumn = 3, srcSpanEndLine = 79, srcSpanEndColumn = 11},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Random.hs&quot;, srcSpanStartLine = 79, src"><span class="mpre">deriving (Eq, Ord, Show, Read, Data, Typeable)</span></span><span class="mpre">

data </span><a name="loc_81_6_81_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_6_81_16&#39;)"><span class="hl_tycondecl"><span class="mpre">ReseedInfo</span></span></a><span class="mpre">
    = </span><a name="loc_82_7_82_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_7_82_15&#39;)"><span class="hl_condecl"><span class="mpre">InXBytes</span></span></a><span class="mpre"> {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">Word64</span></span><span class="mpre">   </span><span class="hl_comment"><span class="mpre">-- ^ Generator needs reseeded in X bytes</span></span><span class="mpre">
    | </span><a name="loc_83_7_83_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_7_83_15&#39;)"><span class="hl_condecl"><span class="mpre">InXCalls</span></span></a><span class="mpre"> {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">Word64</span></span><span class="mpre">   </span><span class="hl_comment"><span class="mpre">-- ^ Generator needs reseeded in X calls</span></span><span class="mpre">
    | </span><a name="loc_84_7_84_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_7_84_14&#39;)"><span class="hl_condecl"><span class="mpre">NotSoon</span></span></a><span class="mpre">                           </span><span class="hl_comment"><span class="mpre">-- ^ The bound is over 2^64 bytes or calls</span></span><span class="mpre">
    | </span><a name="loc_85_7_85_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_7_85_12&#39;)"><span class="hl_condecl"><span class="mpre">Never</span></span></a><span class="mpre">                             </span><span class="hl_comment"><span class="mpre">-- ^ This generator never reseeds (ex: &#39;SystemRandom&#39;)</span></span><span class="mpre">
  </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Random.hs&quot;, srcSpanStartLine = 86, srcSpanStartColumn = 3, srcSpanEndLine = 86, srcSpanEndColumn = 49}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Random.hs&quot;, srcSpanStartLine = 86, srcSpanStartColumn = 3, srcSpanEndLine = 86, srcSpanEndColumn = 11},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Random.hs&quot;, srcSpanStartLine = 86, src"><span class="mpre">deriving (Eq, Ord, Show, Read, Data, Typeable)</span></span><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Exception</span></span><span class="mpre"> </span><a href="#loc_62_6_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_14&#39;)"><span class="hl_tyconref"><span class="mpre">GenError</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |A class of random bit generators that allows for the possibility</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- of failure, reseeding, providing entropy at the same time as</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- requesting bytes</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Minimum complete definition: `newGen`, `genSeedLength`, `genBytes`,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- `reseed`, `reseedInfo`, `reseedPeriod`.</span></span><span class="mpre">
class </span><a name="loc_96_7_96_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_7_96_22&#39;)"><span class="hl_classdecl"><span class="mpre">CryptoRandomGen</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre"> where
        </span><span class="hl_comment"><span class="mpre">-- |Instantiate a new random bit generator.  The provided</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- bytestring should be of length &gt;= genSeedLength.  If the</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- bytestring is shorter then the call may fail (suggested</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- error: `NotEnoughEntropy`).  If the bytestring is of</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- sufficent length the call should always succeed.</span></span><span class="mpre">
        </span><a name="loc_102_9_102_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_9_102_15&#39;)"><span class="mpre">newGen</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="#loc_62_6_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_14&#39;)"><span class="hl_tyconref"><span class="mpre">GenError</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">

        </span><span class="hl_comment"><span class="mpre">-- |Length of input entropy necessary to instantiate or reseed</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- a generator</span></span><span class="mpre">
        </span><a name="loc_106_9_106_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_9_106_22&#39;)"><span class="mpre">genSeedLength</span></a><span class="mpre"> :: </span><a href="Data.Tagged.html#loc_59_9_59_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Tagged.html#loc_59_9_59_15&#39;)"><span class="hl_tyconref"><span class="mpre">Tagged</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteLength</span></span><span class="mpre">

        </span><span class="hl_comment"><span class="mpre">-- | @genBytes len g@ generates a random ByteString of length</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- @len@ and new generator.  The &quot;MonadCryptoRandom&quot; package</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- has routines useful for converting the ByteString to</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- commonly needed values (but &quot;cereal&quot; or other</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- deserialization libraries would also work).</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- This routine can fail if the generator has gone too long</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- without a reseed (usually this is in the ball-park of 2^48</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- requests).  Suggested error in this cases is `NeedReseed`</span></span><span class="mpre">
        </span><a name="loc_117_9_117_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_9_117_17&#39;)"><span class="mpre">genBytes</span></a><span class="mpre">        :: </span><span class="hl_tyconref"><span class="mpre">ByteLength</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="#loc_62_6_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_14&#39;)"><span class="hl_tyconref"><span class="mpre">GenError</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">, </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">)

        </span><span class="hl_comment"><span class="mpre">-- | Indicates how soon a reseed is needed</span></span><span class="mpre">
        </span><a name="loc_120_9_120_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_9_120_19&#39;)"><span class="mpre">reseedInfo</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre"> -&gt; </span><a href="#loc_81_6_81_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_6_81_16&#39;)"><span class="hl_tyconref"><span class="mpre">ReseedInfo</span></span></a><span class="mpre">

        </span><span class="hl_comment"><span class="mpre">-- | Indicates the period between reseeds (constant for most generators).</span></span><span class="mpre">
        </span><a name="loc_123_9_123_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_9_123_21&#39;)"><span class="mpre">reseedPeriod</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre"> -&gt; </span><a href="#loc_81_6_81_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_6_81_16&#39;)"><span class="hl_tyconref"><span class="mpre">ReseedInfo</span></span></a><span class="mpre">

        </span><span class="hl_comment"><span class="mpre">-- |@genBytesWithEntropy g i entropy@ generates @i@ random</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- bytes and use the additional input @entropy@ in the</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- generation of the requested data to increase the confidence</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- our generated data is a secure random stream.</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- Some generators use @entropy@ to perturb the state of the</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- generator, meaning:</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--     (_,g2&#39;) &lt;- genBytesWithEntropy len g1 ent</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--     (_,g2 ) &lt;- genBytes len g1</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--     g2 /= g2&#39;</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- But this is not required.</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- Default:</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--     genBytesWithEntropy g bytes entropy = xor entropy (genBytes g bytes)</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
        </span><a name="loc_146_9_146_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_9_146_28&#39;)"><span class="mpre">genBytesWithEntropy</span></a><span class="mpre">     :: </span><span class="hl_tyconref"><span class="mpre">ByteLength</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="#loc_62_6_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_14&#39;)"><span class="hl_tyconref"><span class="mpre">GenError</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">, </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">)
        </span><a href="#loc_146_9_146_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_9_146_28&#39;)"><span class="hl_fundecl"><span class="mpre">genBytesWithEntropy</span></span></a><span class="mpre"> </span><a name="loc_147_29_147_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_29_147_32&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_147_33_147_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_33_147_40&#39;)"><span class="hl_vardecl"><span class="mpre">entropy</span></span></a><span class="mpre"> </span><a name="loc_147_41_147_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_41_147_42&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre"> =
                let </span><a name="loc_148_21_148_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_21_148_24&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> = </span><a href="#loc_117_9_117_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_9_117_17&#39;)"><span class="hl_varref"><span class="mpre">genBytes</span></span></a><span class="mpre"> </span><a href="#loc_147_29_147_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_29_147_32&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><a href="#loc_147_41_147_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_41_147_42&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre">
                in case </span><a href="#loc_148_21_148_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_21_148_24&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre"> of
                        </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_150_30_150_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_30_150_33&#39;)"><span class="hl_vardecl"><span class="mpre">err</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_150_30_150_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_30_150_33&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre">
                        </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a name="loc_151_32_151_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_32_151_34&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">,</span><a name="loc_151_35_151_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_35_151_37&#39;)"><span class="hl_vardecl"><span class="mpre">g&#39;</span></span></a><span class="mpre">) -&gt;
                                let </span><a name="loc_152_37_152_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_37_152_45&#39;)"><span class="hl_vardecl"><span class="mpre">entropy&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.append</span></span><span class="mpre"> </span><a href="#loc_147_33_147_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_33_147_40&#39;)"><span class="hl_varref"><span class="mpre">entropy</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.replicate</span></span><span class="mpre"> (</span><a href="#loc_147_29_147_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_29_147_32&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_147_33_147_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_33_147_40&#39;)"><span class="hl_varref"><span class="mpre">entropy</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">)
                                in </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="Crypto.Util.html#loc_87_1_87_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Util.html#loc_87_1_87_5&#39;)"><span class="hl_varref"><span class="mpre">zwp&#39;</span></span></a><span class="mpre"> </span><a href="#loc_152_37_152_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_37_152_45&#39;)"><span class="hl_varref"><span class="mpre">entropy&#39;</span></span></a><span class="mpre"> </span><a href="#loc_151_32_151_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_32_151_34&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">, </span><a href="#loc_151_35_151_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_35_151_37&#39;)"><span class="hl_varref"><span class="mpre">g&#39;</span></span></a><span class="mpre">)

        </span><span class="hl_comment"><span class="mpre">-- |If the generator has produced too many random bytes on its</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- existing seed it will return `NeedReseed`.  In that case,</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- reseed the generator using this function and a new</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- high-entropy seed of length &gt;= `genSeedLength`.  Using</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- bytestrings that are too short can result in an error</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- (`NotEnoughEntropy`).</span></span><span class="mpre">
        </span><a name="loc_161_9_161_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_9_161_15&#39;)"><span class="mpre">reseed</span></a><span class="mpre">          :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="#loc_62_6_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_14&#39;)"><span class="hl_tyconref"><span class="mpre">GenError</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">

        </span><span class="hl_comment"><span class="mpre">-- |By default this uses &quot;System.Crypto.Random&quot; to obtain</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- entropy for `newGen`.</span></span><span class="mpre">
        </span><a name="loc_165_9_165_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_9_165_17&#39;)"><span class="mpre">newGenIO</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">
        </span><a href="#loc_165_9_165_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_9_165_17&#39;)"><span class="hl_vardecl"><span class="mpre">newGenIO</span></span></a><span class="mpre"> = </span><a href="#loc_168_11_168_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_11_168_13&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
          where
          </span><a name="loc_168_11_168_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_11_168_13&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1000</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">throw</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_63_11_63_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_11_63_24&#39;)"><span class="hl_conref"><span class="mpre">GenErrorOther</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> 
                          </span><span class="hl_string"><span class="mpre">&quot;The generator instance requested by&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">
                          </span><span class="hl_string"><span class="mpre">&quot;newGenIO never instantiates (1000 tries). &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">
                          </span><span class="hl_string"><span class="mpre">&quot;It must be broken.&quot;</span></span><span class="mpre">
          </span><a href="#loc_168_11_168_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_11_168_13&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_172_14_172_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_14_172_15&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> = do
                let </span><a name="loc_173_21_173_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_21_173_22&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = </span><a href="Data.Proxy.html#loc_47_16_47_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Proxy.html#loc_47_16_47_21&#39;)"><span class="hl_conref"><span class="mpre">Proxy</span></span></a><span class="mpre">
                    </span><a href="#loc_175_21_175_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_21_175_32&#39;)"><span class="mpre">getTypedGen</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxParen (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Random.hs&quot;, srcSpanStartLine = 174, srcSpanStartColumn = 36, srcSpanEndLine = 174, srcSpanEndColumn = 58}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Random.hs&quot;, srcSpanStartLine = 174, srcSpanStartColumn = 36, srcSpanEndLine = 174, srcSpanEndColumn = 37},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Random.hs&quot;, srcSpanStartLine = 17"><span class="mpre">(CryptoRandomGen g) =&gt;</span></span><span class="mpre"> </span><a href="Data.Proxy.html#loc_47_6_47_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Proxy.html#loc_47_6_47_11&#39;)"><span class="hl_tyconref"><span class="mpre">Proxy</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="#loc_62_6_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_14&#39;)"><span class="hl_tyconref"><span class="mpre">GenError</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">)
                    </span><a name="loc_175_21_175_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_21_175_32&#39;)"><span class="hl_fundecl"><span class="mpre">getTypedGen</span></span></a><span class="mpre"> </span><a name="loc_175_33_175_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_33_175_35&#39;)"><span class="hl_vardecl"><span class="mpre">pr</span></span></a><span class="mpre"> = </span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="hl_varref"><span class="mpre">liftM</span></span></a><span class="mpre"> </span><a href="#loc_102_9_102_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_9_102_15&#39;)"><span class="hl_varref"><span class="mpre">newGen</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">getEntropy</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Tagged.html#loc_276_1_276_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Tagged.html#loc_276_1_276_6&#39;)"><span class="hl_varref"><span class="mpre">proxy</span></span></a><span class="mpre"> </span><a href="#loc_106_9_106_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_9_106_22&#39;)"><span class="hl_varref"><span class="mpre">genSeedLength</span></span></a><span class="mpre"> </span><a href="#loc_175_33_175_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_33_175_35&#39;)"><span class="hl_varref"><span class="mpre">pr</span></span></a><span class="mpre">)
                </span><a name="loc_176_17_176_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_17_176_20&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_175_21_175_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_21_175_32&#39;)"><span class="hl_varref"><span class="mpre">getTypedGen</span></span></a><span class="mpre"> </span><a href="#loc_173_21_173_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_21_173_22&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">
                case </span><a href="#loc_176_17_176_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_17_176_20&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre"> of
                        </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> _ -&gt; </span><a href="#loc_168_11_168_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_11_168_13&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><a href="#loc_172_14_172_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_14_172_15&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
                        </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a name="loc_179_31_179_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_31_179_32&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_179_31_179_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_31_179_32&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre"> </span><a href="Data.Proxy.html#loc_184_1_184_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Proxy.html#loc_184_1_184_14&#39;)"><span class="hl_infix"><span class="mpre">`asProxyTypeOf`</span></span></a><span class="mpre"> </span><a href="#loc_173_21_173_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_21_173_22&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |Get a random number generator based on the standard system entropy source</span></span><span class="mpre">
</span><a href="#loc_183_1_183_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_13&#39;)"><span class="mpre">getSystemGen</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_204_6_204_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_6_204_18&#39;)"><span class="hl_tyconref"><span class="mpre">SystemRandom</span></span></a><span class="mpre">
</span><a name="loc_183_1_183_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_13&#39;)"><span class="hl_vardecl"><span class="mpre">getSystemGen</span></span></a><span class="mpre"> = do
        </span><a name="loc_184_9_184_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_9_184_11&#39;)"><span class="hl_vardecl"><span class="mpre">ch</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">openHandle</span></span><span class="mpre">
        let </span><a name="loc_185_13_185_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_13_185_18&#39;)"><span class="hl_vardecl"><span class="mpre">getBS</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_213_1_213_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_213_1_213_19&#39;)"><span class="hl_varref"><span class="mpre">unsafeInterleaveIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
                </span><a name="loc_186_17_186_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_17_186_19&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">hGetEntropy</span></span><span class="mpre"> </span><a href="#loc_184_9_184_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_9_184_11&#39;)"><span class="hl_varref"><span class="mpre">ch</span></span></a><span class="mpre"> ((</span><span class="hl_num"><span class="mpre">2</span></span><span class="hl_infix"><span class="mpre">^</span></span><span class="hl_num"><span class="mpre">15</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre">)
                </span><a name="loc_187_17_187_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_17_187_21&#39;)"><span class="hl_vardecl"><span class="mpre">more</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_185_13_185_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_13_185_18&#39;)"><span class="hl_varref"><span class="mpre">getBS</span></span></a><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_186_17_186_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_17_186_19&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_187_17_187_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_17_187_21&#39;)"><span class="hl_varref"><span class="mpre">more</span></span></a><span class="mpre">)
        </span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="hl_varref"><span class="mpre">liftM</span></span></a><span class="mpre"> (</span><a href="#loc_204_21_204_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_21_204_30&#39;)"><span class="hl_conref"><span class="mpre">SysRandom</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.fromChunks</span></span><span class="mpre">) </span><a href="#loc_185_13_185_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_13_185_18&#39;)"><span class="hl_varref"><span class="mpre">getBS</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Not that it is technically correct as an instance of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;CryptoRandomGen&#39;, but simply because it&#39;s a reasonable engineering</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- choice here is a CryptoRandomGen which streams the system</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- randoms. Take note:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * It uses the default definition of &#39;genByteWithEntropy&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;newGen&#39; will always fail!</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;reseed&#39; will always fail!</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * the handle to the system random is never closed</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
data </span><a name="loc_204_6_204_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_6_204_18&#39;)"><span class="hl_tycondecl"><span class="mpre">SystemRandom</span></span></a><span class="mpre"> = </span><a name="loc_204_21_204_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_21_204_30&#39;)"><span class="hl_condecl"><span class="mpre">SysRandom</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre">

instance </span><a href="#loc_96_7_96_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_7_96_22&#39;)"><span class="hl_classref"><span class="mpre">CryptoRandomGen</span></span></a><span class="mpre"> </span><a href="#loc_204_6_204_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_6_204_18&#39;)"><span class="hl_tyconref"><span class="mpre">SystemRandom</span></span></a><span class="mpre"> where
  </span><a href="#loc_102_9_102_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_9_102_15&#39;)"><span class="hl_fundecl"><span class="mpre">newGen</span></span></a><span class="mpre"> _ = </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_76_11_76_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_11_76_28&#39;)"><span class="hl_conref"><span class="mpre">NeedsInfiniteSeed</span></span></a><span class="mpre">
  </span><a href="#loc_106_9_106_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_9_106_22&#39;)"><span class="hl_vardecl"><span class="mpre">genSeedLength</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Tagged</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">maxBound</span></span><span class="mpre">
  </span><a href="#loc_117_9_117_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_9_117_17&#39;)"><span class="hl_fundecl"><span class="mpre">genBytes</span></span></a><span class="mpre"> </span><a name="loc_209_12_209_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_12_209_15&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> (</span><a href="#loc_204_21_204_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_21_204_30&#39;)"><span class="hl_conref"><span class="mpre">SysRandom</span></span></a><span class="mpre"> </span><a name="loc_209_27_209_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_27_209_29&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">) =
    let </span><a name="loc_210_9_210_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_9_210_13&#39;)"><span class="hl_vardecl"><span class="mpre">reqI</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_209_12_209_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_12_209_15&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">
        </span><a name="loc_211_9_211_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_9_211_12&#39;)"><span class="hl_vardecl"><span class="mpre">rnd</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">L.take</span></span><span class="mpre"> </span><a href="#loc_210_9_210_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_9_210_13&#39;)"><span class="hl_varref"><span class="mpre">reqI</span></span></a><span class="mpre"> </span><a href="#loc_209_27_209_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_27_209_29&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
        </span><a name="loc_212_9_212_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_9_212_13&#39;)"><span class="hl_vardecl"><span class="mpre">rest</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">L.drop</span></span><span class="mpre"> </span><a href="#loc_210_9_210_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_9_210_13&#39;)"><span class="hl_varref"><span class="mpre">reqI</span></span></a><span class="mpre"> </span><a href="#loc_209_27_209_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_27_209_29&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
    in if </span><span class="hl_varref"><span class="mpre">L.length</span></span><span class="mpre"> </span><a href="#loc_211_9_211_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_9_211_12&#39;)"><span class="hl_varref"><span class="mpre">rnd</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_210_9_210_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_9_210_13&#39;)"><span class="hl_varref"><span class="mpre">reqI</span></span></a><span class="mpre">
        then </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.toChunks</span></span><span class="mpre"> </span><a href="#loc_211_9_211_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_9_211_12&#39;)"><span class="hl_varref"><span class="mpre">rnd</span></span></a><span class="mpre">, </span><a href="#loc_204_21_204_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_21_204_30&#39;)"><span class="hl_conref"><span class="mpre">SysRandom</span></span></a><span class="mpre"> </span><a href="#loc_212_9_212_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_9_212_13&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre">)
        else </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_64_11_64_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_11_64_32&#39;)"><span class="hl_conref"><span class="mpre">RequestedTooManyBytes</span></span></a><span class="mpre">
  </span><a href="#loc_161_9_161_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_9_161_15&#39;)"><span class="hl_fundecl"><span class="mpre">reseed</span></span></a><span class="mpre"> _ _ = </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_76_11_76_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_11_76_28&#39;)"><span class="hl_conref"><span class="mpre">NeedsInfiniteSeed</span></span></a><span class="mpre">
  </span><a href="#loc_165_9_165_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_9_165_17&#39;)"><span class="hl_vardecl"><span class="mpre">newGenIO</span></span></a><span class="mpre"> = </span><a href="#loc_183_1_183_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_13&#39;)"><span class="hl_varref"><span class="mpre">getSystemGen</span></span></a><span class="mpre">
  </span><a href="#loc_120_9_120_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_9_120_19&#39;)"><span class="hl_fundecl"><span class="mpre">reseedInfo</span></span></a><span class="mpre"> _ = </span><a href="#loc_85_7_85_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_7_85_12&#39;)"><span class="hl_conref"><span class="mpre">Never</span></span></a><span class="mpre">
  </span><a href="#loc_123_9_123_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_9_123_21&#39;)"><span class="hl_fundecl"><span class="mpre">reseedPeriod</span></span></a><span class="mpre"> _ = </span><a href="#loc_85_7_85_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_7_85_12&#39;)"><span class="hl_conref"><span class="mpre">Never</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | While the safety and wisdom of a splitting function depends on the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- properties of the generator being split, several arguments from</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- informed people indicate such a function is safe for NIST SP 800-90</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- generators.  (see libraries\@haskell.org discussion around Sept, Oct</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 2010).  You can find implementations of such generators in the &#39;DRBG&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- package.</span></span><span class="mpre">
</span><a href="#loc_228_1_228_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_1_228_9&#39;)"><span class="mpre">splitGen</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Random.hs&quot;, srcSpanStartLine = 227, srcSpanStartColumn = 13, srcSpanEndLine = 227, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Random.hs&quot;, srcSpanStartLine = 227, srcSpanStartColumn = 31, srcSpanEndLine = 227, srcSpanEndColumn = 33}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/"><span class="mpre">CryptoRandomGen g =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="#loc_62_6_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_14&#39;)"><span class="hl_tyconref"><span class="mpre">GenError</span></span></a><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">,</span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">)
</span><a name="loc_228_1_228_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_1_228_9&#39;)"><span class="hl_fundecl"><span class="mpre">splitGen</span></span></a><span class="mpre"> </span><a name="loc_228_10_228_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_10_228_11&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre"> =
  let </span><a name="loc_229_7_229_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_7_229_8&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> = </span><a href="#loc_117_9_117_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_9_117_17&#39;)"><span class="hl_varref"><span class="mpre">genBytes</span></span></a><span class="mpre"> (</span><a href="#loc_106_9_106_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_9_106_22&#39;)"><span class="hl_varref"><span class="mpre">genSeedLength</span></span></a><span class="mpre"> </span><a href="Crypto.Util.html#loc_46_1_46_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Util.html#loc_46_1_46_4&#39;)"><span class="hl_infix"><span class="mpre">`for`</span></span></a><span class="mpre"> </span><a href="#loc_228_10_228_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_10_228_11&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre">) </span><a href="#loc_228_10_228_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_10_228_11&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre">
  in case </span><a href="#loc_229_7_229_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_7_229_8&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> of
    </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_231_10_231_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_10_231_11&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_231_10_231_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_10_231_11&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
    </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a name="loc_232_12_232_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_12_232_15&#39;)"><span class="hl_vardecl"><span class="mpre">ent</span></span></a><span class="mpre">,</span><a name="loc_232_16_232_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_16_232_18&#39;)"><span class="hl_vardecl"><span class="mpre">g&#39;</span></span></a><span class="mpre">) -&gt; 
       case </span><a href="#loc_102_9_102_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_9_102_15&#39;)"><span class="hl_varref"><span class="mpre">newGen</span></span></a><span class="mpre"> </span><a href="#loc_232_12_232_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_12_232_15&#39;)"><span class="hl_varref"><span class="mpre">ent</span></span></a><span class="mpre"> of
                </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a name="loc_234_23_234_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_234_23_234_26&#39;)"><span class="hl_vardecl"><span class="mpre">new</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="#loc_232_16_232_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_16_232_18&#39;)"><span class="hl_varref"><span class="mpre">g&#39;</span></span></a><span class="mpre">,</span><a href="#loc_234_23_234_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_234_23_234_26&#39;)"><span class="hl_varref"><span class="mpre">new</span></span></a><span class="mpre">)
                </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_235_22_235_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_22_235_23&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_235_22_235_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_22_235_23&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
</span></div></body></html>