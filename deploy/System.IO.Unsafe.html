<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Unsafe #-}
{-# LANGUAGE NoImplicitPrelude #-}

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  System.IO.Unsafe</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow 2001</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD-style (see the file libraries/base/LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  libraries@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  provisional</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- \&quot;Unsafe\&quot; IO operations.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module System.IO.Unsafe (
   </span><span class="hl_comment"><span class="mpre">-- * Unsafe &#39;System.IO.IO&#39; operations</span></span><span class="mpre">
   unsafePerformIO,
   unsafeDupablePerformIO,
   unsafeInterleaveIO,
   unsafeFixIO,
  ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/System/IO/Unsafe.hs&quot;, srcSpanStartLine = 26, srcSpanStartColumn = 8, srcSpanEndLine = 26, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">
import GHC.IO
import GHC.IORef
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/System/IO/Unsafe.hs&quot;, srcSpanStartLine = 29, srcSpanStartColumn = 8, srcSpanEndLine = 29, srcSpanEndColumn = 21}, srcInfoPoints = []}) &quot;GHC.Exception&quot;"><span class="mpre">GHC.Exception</span></span><span class="mpre">
import Control.Exception

</span><span class="hl_comment"><span class="mpre">-- | A slightly faster version of `System.IO.fixIO` that may not be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- safe to use with multiple threads.  The unsafety arises when used</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- like this:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;  unsafeFixIO $ \r -&gt; do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;     forkIO (print r)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;     return (...)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- In this case, the child thread will receive a @NonTermination@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exception instead of waiting for the value of @r@ to be computed.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /Since: 4.5.0.0/</span></span><span class="mpre">
</span><a href="#loc_45_1_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_12&#39;)"><span class="mpre">unsafeFixIO</span></a><span class="mpre"> :: (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_45_1_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_12&#39;)"><span class="hl_fundecl"><span class="mpre">unsafeFixIO</span></span></a><span class="mpre"> </span><a name="loc_45_13_45_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_13_45_14&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = do
  </span><a name="loc_46_3_46_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_3_46_6&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">throw</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">NonTermination</span></span><span class="mpre">)
  </span><a name="loc_47_3_47_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_3_47_6&#39;)"><span class="hl_vardecl"><span class="mpre">ans</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.html#loc_235_1_235_26" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_235_1_235_26&#39;)"><span class="hl_varref"><span class="mpre">unsafeDupableInterleaveIO</span></span></a><span class="mpre"> (</span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_46_3_46_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_3_46_6&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">)
  </span><a name="loc_48_3_48_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_3_48_9&#39;)"><span class="hl_vardecl"><span class="mpre">result</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_45_13_45_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_13_45_14&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_47_3_47_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_3_47_6&#39;)"><span class="hl_varref"><span class="mpre">ans</span></span></a><span class="mpre">
  </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_46_3_46_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_3_46_6&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><a href="#loc_48_3_48_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_3_48_9&#39;)"><span class="hl_varref"><span class="mpre">result</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_48_3_48_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_3_48_9&#39;)"><span class="hl_varref"><span class="mpre">result</span></span></a><span class="mpre">
</span></div></body></html>