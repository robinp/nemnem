<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">{-|
  Maintainer: Thomas.DuBuisson@gmail.com
  Stability: beta
  Portability: portable

PKCS5 (RFC 1423) and IPSec ESP (RFC 4303)
padding methods are implemented both as trivial functions operating on
bytestrings and as &#39;Put&#39; routines usable from the &quot;Data.Serialize&quot;
module.  These methods do not work for algorithms or pad sizes in
excess of 255 bytes (2040 bits, so extremely large as far as cipher
needs are concerned).

-}</span></span><span class="mpre">

module Crypto.Padding
        (
        </span><span class="hl_comment"><span class="mpre">-- * PKCS5 (RFC 1423) based [un]padding routines</span></span><span class="mpre">
          padPKCS5
        , padBlockSize
        , putPaddedPKCS5
        , unpadPKCS5safe
        , unpadPKCS5
        </span><span class="hl_comment"><span class="mpre">-- * ESP (RFC 4303) [un]padding routines</span></span><span class="mpre">
        , padESP, unpadESP
        , padESPBlockSize
        , putPadESPBlockSize, putPadESP
        ) where

import Data.Serialize.Put
import Crypto.Classes
import Crypto.Types
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Padding.hs&quot;, srcSpanStartLine = 32, srcSpanStartColumn = 18, srcSpanEndLine = 32, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Padding.hs&quot;, srcSpanStartLine = 33, srcSpanStartColumn = 18, srcSpanEndLine = 33, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L

</span><span class="hl_comment"><span class="mpre">-- |PKCS5 (aka RFC1423) padding method.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This method will not work properly for pad modulos &gt; 256</span></span><span class="mpre">
</span><a href="#loc_38_1_38_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_1_38_9&#39;)"><span class="mpre">padPKCS5</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteLength</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_38_1_38_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_1_38_9&#39;)"><span class="hl_fundecl"><span class="mpre">padPKCS5</span></span></a><span class="mpre"> </span><a name="loc_38_10_38_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_10_38_13&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_38_14_38_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_14_38_16&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="Data.Serialize.Put.html#loc_148_1_148_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Serialize.Put.html#loc_148_1_148_7&#39;)"><span class="hl_varref"><span class="mpre">runPut</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_50_1_50_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_15&#39;)"><span class="hl_varref"><span class="mpre">putPaddedPKCS5</span></span></a><span class="mpre"> </span><a href="#loc_38_10_38_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_10_38_13&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><a href="#loc_38_14_38_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_14_38_16&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Ex:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     putPaddedPKCS5 m bs</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Will pad out `bs` to a byte multiple</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- of `m` and put both the bytestring and it&#39;s padding via &#39;Put&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (this saves on copying if you are already using Cereal).</span></span><span class="mpre">
</span><a href="#loc_50_1_50_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_15&#39;)"><span class="mpre">putPaddedPKCS5</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteLength</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Put</span></span><span class="mpre">
</span><a name="loc_50_1_50_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_15&#39;)"><span class="hl_fundecl"><span class="mpre">putPaddedPKCS5</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a name="loc_50_18_50_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_18_50_20&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="Data.Serialize.Put.html#loc_182_1_182_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Serialize.Put.html#loc_182_1_182_14&#39;)"><span class="hl_varref"><span class="mpre">putByteString</span></span></a><span class="mpre"> </span><a href="#loc_50_18_50_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_18_50_20&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="Data.Serialize.Put.html#loc_176_1_176_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Serialize.Put.html#loc_176_1_176_9&#39;)"><span class="hl_varref"><span class="mpre">putWord8</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
</span><a href="#loc_50_1_50_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_15&#39;)"><span class="hl_fundecl"><span class="mpre">putPaddedPKCS5</span></span></a><span class="mpre"> </span><a name="loc_51_16_51_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_16_51_19&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_51_20_51_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_20_51_22&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="Data.Serialize.Put.html#loc_182_1_182_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Serialize.Put.html#loc_182_1_182_14&#39;)"><span class="hl_varref"><span class="mpre">putByteString</span></span></a><span class="mpre"> </span><a href="#loc_51_20_51_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_20_51_22&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="Data.Serialize.Put.html#loc_182_1_182_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Serialize.Put.html#loc_182_1_182_14&#39;)"><span class="hl_varref"><span class="mpre">putByteString</span></span></a><span class="mpre"> </span><a href="#loc_53_3_53_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_3_53_6&#39;)"><span class="hl_varref"><span class="mpre">pad</span></span></a><span class="mpre">
  where
  </span><a name="loc_53_3_53_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_3_53_6&#39;)"><span class="hl_vardecl"><span class="mpre">pad</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.replicate</span></span><span class="mpre"> </span><a href="#loc_55_3_55_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_3_55_9&#39;)"><span class="hl_varref"><span class="mpre">padLen</span></span></a><span class="mpre"> </span><a href="#loc_56_3_56_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_3_56_11&#39;)"><span class="hl_varref"><span class="mpre">padValue</span></span></a><span class="mpre">
  </span><a name="loc_54_3_54_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_3_54_4&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">   = </span><a href="#loc_51_16_51_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_16_51_19&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_51_20_51_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_20_51_22&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`rem`</span></span><span class="mpre"> </span><a href="#loc_51_16_51_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_16_51_19&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">)
  </span><a name="loc_55_3_55_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_3_55_9&#39;)"><span class="hl_vardecl"><span class="mpre">padLen</span></span></a><span class="mpre"> = if </span><a href="#loc_54_3_54_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_3_54_4&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> then </span><a href="#loc_51_16_51_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_16_51_19&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> else </span><a href="#loc_54_3_54_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_3_54_4&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
  </span><a name="loc_56_3_56_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_3_56_11&#39;)"><span class="hl_vardecl"><span class="mpre">padValue</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_55_3_55_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_3_55_9&#39;)"><span class="hl_varref"><span class="mpre">padLen</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |PKCS5 (aka RFC1423) padding method using the BlockCipher instance</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to determine the pad size.</span></span><span class="mpre">
</span><a href="#loc_61_1_61_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_13&#39;)"><span class="mpre">padBlockSize</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Padding.hs&quot;, srcSpanStartLine = 60, srcSpanStartColumn = 17, srcSpanEndLine = 60, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Padding.hs&quot;, srcSpanStartLine = 60, srcSpanStartColumn = 31, srcSpanEndLine = 60, srcSpanEndColumn = 33}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Cr"><span class="mpre">BlockCipher k =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">k</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_61_1_61_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_13&#39;)"><span class="hl_fundecl"><span class="mpre">padBlockSize</span></span></a><span class="mpre"> </span><a name="loc_61_14_61_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_14_61_15&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = </span><a href="Data.Serialize.Put.html#loc_148_1_148_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Serialize.Put.html#loc_148_1_148_7&#39;)"><span class="hl_varref"><span class="mpre">runPut</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_66_1_66_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_19&#39;)"><span class="hl_varref"><span class="mpre">putPaddedBlockSize</span></span></a><span class="mpre"> </span><a href="#loc_61_14_61_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_14_61_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Leverages &#39;putPaddedPKCS5&#39; to put the bytestring and padding</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- of sufficient length for use by the specified block cipher.</span></span><span class="mpre">
</span><a href="#loc_66_1_66_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_19&#39;)"><span class="mpre">putPaddedBlockSize</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Padding.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 23, srcSpanEndLine = 65, srcSpanEndColumn = 39}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Padding.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 37, srcSpanEndLine = 65, srcSpanEndColumn = 39}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Cr"><span class="mpre">BlockCipher k =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">k</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Put</span></span><span class="mpre">
</span><a name="loc_66_1_66_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_19&#39;)"><span class="hl_fundecl"><span class="mpre">putPaddedBlockSize</span></span></a><span class="mpre"> </span><a name="loc_66_20_66_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_20_66_21&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> </span><a name="loc_66_22_66_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_22_66_24&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="#loc_50_1_50_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_15&#39;)"><span class="hl_varref"><span class="mpre">putPaddedPKCS5</span></span></a><span class="mpre"> (</span><a href="Crypto.Classes.html#loc_455_1_455_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Classes.html#loc_455_1_455_15&#39;)"><span class="hl_varref"><span class="mpre">blockSizeBytes</span></span></a><span class="mpre"> </span><a href="Crypto.Util.html#loc_46_1_46_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Util.html#loc_46_1_46_4&#39;)"><span class="hl_infix"><span class="mpre">`for`</span></span></a><span class="mpre"> </span><a href="#loc_66_20_66_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_20_66_21&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">) </span><a href="#loc_66_22_66_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_22_66_24&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | unpad a strict bytestring padded in the typical PKCS5 manner.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This routine verifies all pad bytes and pad length match correctly.</span></span><span class="mpre">
</span><a href="#loc_71_1_71_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_15&#39;)"><span class="mpre">unpadPKCS5safe</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_71_1_71_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_15&#39;)"><span class="hl_fundecl"><span class="mpre">unpadPKCS5safe</span></span></a><span class="mpre"> </span><a name="loc_71_16_71_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_16_71_18&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">
        | </span><a href="#loc_75_3_75_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_3_75_8&#39;)"><span class="hl_varref"><span class="mpre">bsLen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.all</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_76_3_76_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_3_76_9&#39;)"><span class="hl_varref"><span class="mpre">padLen</span></span></a><span class="mpre">) </span><a href="#loc_78_8_78_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_8_78_11&#39;)"><span class="hl_varref"><span class="mpre">pad</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_78_8_78_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_8_78_11&#39;)"><span class="hl_varref"><span class="mpre">pad</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_77_3_77_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_3_77_7&#39;)"><span class="hl_varref"><span class="mpre">pLen</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_78_4_78_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_4_78_7&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre">
        | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
  where
  </span><a name="loc_75_3_75_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_3_75_8&#39;)"><span class="hl_vardecl"><span class="mpre">bsLen</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_71_16_71_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_16_71_18&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
  </span><a name="loc_76_3_76_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_3_76_9&#39;)"><span class="hl_vardecl"><span class="mpre">padLen</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.last</span></span><span class="mpre"> </span><a href="#loc_71_16_71_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_16_71_18&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
  </span><a name="loc_77_3_77_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_3_77_7&#39;)"><span class="hl_vardecl"><span class="mpre">pLen</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_76_3_76_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_3_76_9&#39;)"><span class="hl_varref"><span class="mpre">padLen</span></span></a><span class="mpre">
  (</span><a name="loc_78_4_78_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_4_78_7&#39;)"><span class="hl_vardecl"><span class="mpre">msg</span></span></a><span class="mpre">,</span><a name="loc_78_8_78_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_8_78_11&#39;)"><span class="hl_vardecl"><span class="mpre">pad</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">B.splitAt</span></span><span class="mpre"> (</span><a href="#loc_75_3_75_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_3_75_8&#39;)"><span class="hl_varref"><span class="mpre">bsLen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_77_3_77_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_3_77_7&#39;)"><span class="hl_varref"><span class="mpre">pLen</span></span></a><span class="mpre">) </span><a href="#loc_71_16_71_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_16_71_18&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |unpad a strict bytestring without checking the pad bytes and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- length any more than necessary.</span></span><span class="mpre">
</span><a href="#loc_83_1_83_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_11&#39;)"><span class="mpre">unpadPKCS5</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_83_1_83_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_11&#39;)"><span class="hl_fundecl"><span class="mpre">unpadPKCS5</span></span></a><span class="mpre"> </span><a name="loc_83_12_83_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_12_83_14&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = if </span><a href="#loc_85_3_85_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_3_85_8&#39;)"><span class="hl_varref"><span class="mpre">bsLen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> then </span><a href="#loc_83_12_83_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_12_83_14&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> else </span><a href="#loc_88_4_88_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_4_88_7&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre">
  where
  </span><a name="loc_85_3_85_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_3_85_8&#39;)"><span class="hl_vardecl"><span class="mpre">bsLen</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_83_12_83_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_12_83_14&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
  </span><a name="loc_86_3_86_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_3_86_9&#39;)"><span class="hl_vardecl"><span class="mpre">padLen</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.last</span></span><span class="mpre"> </span><a href="#loc_83_12_83_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_12_83_14&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
  </span><a name="loc_87_3_87_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_3_87_7&#39;)"><span class="hl_vardecl"><span class="mpre">pLen</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_86_3_86_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_3_86_9&#39;)"><span class="hl_varref"><span class="mpre">padLen</span></span></a><span class="mpre">
  (</span><a name="loc_88_4_88_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_4_88_7&#39;)"><span class="hl_vardecl"><span class="mpre">msg</span></span></a><span class="mpre">,_) = </span><span class="hl_varref"><span class="mpre">B.splitAt</span></span><span class="mpre"> (</span><a href="#loc_85_3_85_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_3_85_8&#39;)"><span class="hl_varref"><span class="mpre">bsLen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_87_3_87_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_3_87_7&#39;)"><span class="hl_varref"><span class="mpre">pLen</span></span></a><span class="mpre">) </span><a href="#loc_83_12_83_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_12_83_14&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Pad a bytestring to the IPSEC esp specification</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; padESP m payload</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is equivilent to:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--               (msg)       (padding)       (length field)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     B.concat [payload, B.pack [1,2,3,4..], B.pack [padLen]]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Where:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * the msg is any payload, including TFC.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * the padding is &lt;= 255</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * the length field is one byte.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  Notice the result bytesting length remainder `r` equals zero.  The lack</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  of a \&quot;next header\&quot; field means this function is not directly useable for</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  an IPSec implementation (copy/paste the 4 line function and add in a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  \&quot;next header\&quot; field if you are making IPSec ESP).</span></span><span class="mpre">
</span><a href="#loc_114_1_114_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_1_114_7&#39;)"><span class="mpre">padESP</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_114_1_114_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_1_114_7&#39;)"><span class="hl_fundecl"><span class="mpre">padESP</span></span></a><span class="mpre"> </span><a name="loc_114_8_114_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_8_114_9&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> </span><a name="loc_114_10_114_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_10_114_12&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="Data.Serialize.Put.html#loc_148_1_148_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Serialize.Put.html#loc_148_1_148_7&#39;)"><span class="hl_varref"><span class="mpre">runPut</span></span></a><span class="mpre"> (</span><a href="#loc_127_1_127_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_1_127_10&#39;)"><span class="hl_varref"><span class="mpre">putPadESP</span></span></a><span class="mpre"> </span><a href="#loc_114_8_114_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_8_114_9&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="#loc_114_10_114_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_10_114_12&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Like padESP but use the BlockCipher instance to determine padding size</span></span><span class="mpre">
</span><a href="#loc_118_1_118_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_1_118_16&#39;)"><span class="mpre">padESPBlockSize</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Padding.hs&quot;, srcSpanStartLine = 117, srcSpanStartColumn = 20, srcSpanEndLine = 117, srcSpanEndColumn = 36}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Padding.hs&quot;, srcSpanStartLine = 117, srcSpanStartColumn = 34, srcSpanEndLine = 117, srcSpanEndColumn = 36}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.1"><span class="mpre">BlockCipher k =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">k</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_118_1_118_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_1_118_16&#39;)"><span class="hl_fundecl"><span class="mpre">padESPBlockSize</span></span></a><span class="mpre"> </span><a name="loc_118_17_118_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_17_118_18&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> </span><a name="loc_118_19_118_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_19_118_21&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="Data.Serialize.Put.html#loc_148_1_148_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Serialize.Put.html#loc_148_1_148_7&#39;)"><span class="hl_varref"><span class="mpre">runPut</span></span></a><span class="mpre"> (</span><a href="#loc_122_1_122_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_1_122_19&#39;)"><span class="hl_varref"><span class="mpre">putPadESPBlockSize</span></span></a><span class="mpre"> </span><a href="#loc_118_17_118_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_17_118_18&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_118_19_118_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_19_118_21&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Like putPadESP but using the BlockCipher instance to determine padding size</span></span><span class="mpre">
</span><a href="#loc_122_1_122_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_1_122_19&#39;)"><span class="mpre">putPadESPBlockSize</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Padding.hs&quot;, srcSpanStartLine = 121, srcSpanStartColumn = 23, srcSpanEndLine = 121, srcSpanEndColumn = 39}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Padding.hs&quot;, srcSpanStartLine = 121, srcSpanStartColumn = 37, srcSpanEndLine = 121, srcSpanEndColumn = 39}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.1"><span class="mpre">BlockCipher k =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">k</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Put</span></span><span class="mpre">
</span><a name="loc_122_1_122_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_1_122_19&#39;)"><span class="hl_fundecl"><span class="mpre">putPadESPBlockSize</span></span></a><span class="mpre"> </span><a name="loc_122_20_122_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_20_122_21&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> </span><a name="loc_122_22_122_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_22_122_24&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="#loc_127_1_127_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_1_127_10&#39;)"><span class="hl_varref"><span class="mpre">putPadESP</span></span></a><span class="mpre"> (</span><a href="Crypto.Classes.html#loc_455_1_455_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Classes.html#loc_455_1_455_15&#39;)"><span class="hl_varref"><span class="mpre">blockSizeBytes</span></span></a><span class="mpre"> </span><a href="Crypto.Util.html#loc_46_1_46_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Util.html#loc_46_1_46_4&#39;)"><span class="hl_infix"><span class="mpre">`for`</span></span></a><span class="mpre"> </span><a href="#loc_122_20_122_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_20_122_21&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">) </span><a href="#loc_122_22_122_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_22_122_24&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Pad a bytestring to the IPSEC ESP specification using &#39;Put&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This can reduce copying if you are already using &#39;Put&#39;.</span></span><span class="mpre">
</span><a href="#loc_127_1_127_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_1_127_10&#39;)"><span class="mpre">putPadESP</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Put</span></span><span class="mpre">
</span><a name="loc_127_1_127_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_1_127_10&#39;)"><span class="hl_fundecl"><span class="mpre">putPadESP</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a name="loc_127_13_127_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_13_127_15&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="Data.Serialize.Put.html#loc_182_1_182_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Serialize.Put.html#loc_182_1_182_14&#39;)"><span class="hl_varref"><span class="mpre">putByteString</span></span></a><span class="mpre"> </span><a href="#loc_127_13_127_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_13_127_15&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="Data.Serialize.Put.html#loc_176_1_176_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Serialize.Put.html#loc_176_1_176_9&#39;)"><span class="hl_varref"><span class="mpre">putWord8</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
</span><a href="#loc_127_1_127_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_1_127_10&#39;)"><span class="hl_fundecl"><span class="mpre">putPadESP</span></span></a><span class="mpre"> </span><a name="loc_128_11_128_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_11_128_12&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> </span><a name="loc_128_13_128_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_13_128_15&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = do
        </span><a href="Data.Serialize.Put.html#loc_182_1_182_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Serialize.Put.html#loc_182_1_182_14&#39;)"><span class="hl_varref"><span class="mpre">putByteString</span></span></a><span class="mpre"> </span><a href="#loc_128_13_128_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_13_128_15&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
        </span><a href="Data.Serialize.Put.html#loc_182_1_182_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Serialize.Put.html#loc_182_1_182_14&#39;)"><span class="hl_varref"><span class="mpre">putByteString</span></span></a><span class="mpre"> </span><a href="#loc_133_3_133_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_3_133_6&#39;)"><span class="hl_varref"><span class="mpre">pad</span></span></a><span class="mpre">
        </span><a href="Data.Serialize.Put.html#loc_176_1_176_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Serialize.Put.html#loc_176_1_176_9&#39;)"><span class="hl_varref"><span class="mpre">putWord8</span></span></a><span class="mpre"> </span><a href="#loc_135_3_135_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_3_135_7&#39;)"><span class="hl_varref"><span class="mpre">pLen</span></span></a><span class="mpre">
  where
  </span><a name="loc_133_3_133_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_3_133_6&#39;)"><span class="hl_vardecl"><span class="mpre">pad</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.take</span></span><span class="mpre"> </span><a href="#loc_134_3_134_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_3_134_9&#39;)"><span class="hl_varref"><span class="mpre">padLen</span></span></a><span class="mpre"> </span><a href="#loc_138_1_138_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_7&#39;)"><span class="hl_varref"><span class="mpre">espPad</span></span></a><span class="mpre">
  </span><a name="loc_134_3_134_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_3_134_9&#39;)"><span class="hl_vardecl"><span class="mpre">padLen</span></span></a><span class="mpre"> = </span><a href="#loc_128_11_128_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_11_128_12&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> ((</span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_128_13_128_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_13_128_15&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">`rem`</span></span><span class="mpre"> </span><a href="#loc_128_11_128_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_11_128_12&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">)
  </span><a name="loc_135_3_135_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_3_135_7&#39;)"><span class="hl_vardecl"><span class="mpre">pLen</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_134_3_134_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_3_134_9&#39;)"><span class="hl_varref"><span class="mpre">padLen</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |A static espPad allows reuse of a single B.pack&#39;ed pad for all calls to padESP</span></span><span class="mpre">
</span><a name="loc_138_1_138_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_7&#39;)"><span class="hl_vardecl"><span class="mpre">espPad</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.pack</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpEnumFromTo (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Padding.hs&quot;, srcSpanStartLine = 138, srcSpanStartColumn = 17, srcSpanEndLine = 138, srcSpanEndColumn = 25}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Padding.hs&quot;, srcSpanStartLine = 138, srcSpanStartColumn = 17, srcSpanEndLine = 138, srcSpanEndColumn = 18},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Padding.hs&quot;, srcSpanStartLin"><span class="mpre">[1..255]</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | unpad and return the padded message (&#39;Nothing&#39; is returned if the padding is invalid)</span></span><span class="mpre">
</span><a href="#loc_142_1_142_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_9&#39;)"><span class="mpre">unpadESP</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_142_1_142_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_9&#39;)"><span class="hl_fundecl"><span class="mpre">unpadESP</span></span></a><span class="mpre"> </span><a name="loc_142_10_142_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_10_142_12&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> =
        if </span><a href="#loc_147_3_147_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_3_147_8&#39;)"><span class="hl_varref"><span class="mpre">bsLen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><a href="Crypto.Util.html#loc_66_1_66_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Util.html#loc_66_1_66_12&#39;)"><span class="hl_varref"><span class="mpre">constTimeEq</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.take</span></span><span class="mpre"> </span><a href="#loc_149_3_149_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_3_149_7&#39;)"><span class="hl_varref"><span class="mpre">pLen</span></span></a><span class="mpre"> </span><a href="#loc_150_8_150_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_8_150_11&#39;)"><span class="hl_varref"><span class="mpre">pad</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">B.take</span></span><span class="mpre"> </span><a href="#loc_149_3_149_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_3_149_7&#39;)"><span class="hl_varref"><span class="mpre">pLen</span></span></a><span class="mpre"> </span><a href="#loc_138_1_138_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_7&#39;)"><span class="hl_varref"><span class="mpre">espPad</span></span></a><span class="mpre">))
                then </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
                else </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_150_4_150_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_4_150_7&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre">
  where
  </span><a name="loc_147_3_147_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_3_147_8&#39;)"><span class="hl_vardecl"><span class="mpre">bsLen</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_142_10_142_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_10_142_12&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
  </span><a name="loc_148_3_148_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_3_148_9&#39;)"><span class="hl_vardecl"><span class="mpre">padLen</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.last</span></span><span class="mpre"> </span><a href="#loc_142_10_142_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_10_142_12&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
  </span><a name="loc_149_3_149_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_3_149_7&#39;)"><span class="hl_vardecl"><span class="mpre">pLen</span></span></a><span class="mpre">   = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_148_3_148_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_3_148_9&#39;)"><span class="hl_varref"><span class="mpre">padLen</span></span></a><span class="mpre">
  (</span><a name="loc_150_4_150_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_4_150_7&#39;)"><span class="hl_vardecl"><span class="mpre">msg</span></span></a><span class="mpre">,</span><a name="loc_150_8_150_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_8_150_11&#39;)"><span class="hl_vardecl"><span class="mpre">pad</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">B.splitAt</span></span><span class="mpre"> (</span><a href="#loc_147_3_147_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_3_147_8&#39;)"><span class="hl_varref"><span class="mpre">bsLen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> (</span><a href="#loc_149_3_149_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_3_149_7&#39;)"><span class="hl_varref"><span class="mpre">pLen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)) </span><a href="#loc_142_10_142_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_10_142_12&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
</span></div></body></html>