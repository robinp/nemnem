<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Distribution.Simple.PackageIndex</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) David Himmelstrup 2005,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--                    Bjorn Bringert 2007,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--                    Duncan Coutts 2008-2009</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  cabal-devel@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- An index of packages.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Distribution.Simple.PackageIndex (
  </span><span class="hl_comment"><span class="mpre">-- * Package index data type</span></span><span class="mpre">
  PackageIndex,

  </span><span class="hl_comment"><span class="mpre">-- * Creating an index</span></span><span class="mpre">
  fromList,

  </span><span class="hl_comment"><span class="mpre">-- * Updates</span></span><span class="mpre">
  merge,

  insert,

  deleteInstalledPackageId,
  deleteSourcePackageId,
  deletePackageName,
</span><span class="hl_comment"><span class="mpre">--  deleteDependency,</span></span><span class="mpre">

  </span><span class="hl_comment"><span class="mpre">-- * Queries</span></span><span class="mpre">

  </span><span class="hl_comment"><span class="mpre">-- ** Precise lookups</span></span><span class="mpre">
  lookupInstalledPackageId,
  lookupSourcePackageId,
  lookupPackageName,
  lookupDependency,

  </span><span class="hl_comment"><span class="mpre">-- ** Case-insensitive searches</span></span><span class="mpre">
  searchByName,
  SearchResult(..),
  searchByNameSubstring,

  </span><span class="hl_comment"><span class="mpre">-- ** Bulk queries</span></span><span class="mpre">
  allPackages,
  allPackagesByName,
  allPackagesBySourcePackageId,

  </span><span class="hl_comment"><span class="mpre">-- ** Special queries</span></span><span class="mpre">
  brokenPackages,
  dependencyClosure,
  reverseDependencyClosure,
  topologicalOrder,
  reverseTopologicalOrder,
  dependencyInconsistencies,
  dependencyCycles,
  dependencyGraph,
  moduleNameIndex,
  ) where

import Prelude hiding (lookup)
import Control.Exception (assert)
import qualified Data.Map as Map
import Data.Map (Map)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/Cabal-1.18.1.3/Distribution/Simple/PackageIndex.hs&quot;, srcSpanStartLine = 64, srcSpanStartColumn = 18, srcSpanEndLine = 64, srcSpanEndColumn = 27}, srcInfoPoints = []}) &quot;Data.Tree&quot;"><span class="mpre">Data.Tree</span></span><span class="mpre">  as Tree
import qualified Data.Graph as Graph
import qualified Data.Array as Array
import Data.Array ((!))
import Data.List as List
         ( null, </span><a href="Data.List.html#loc_993_1_993_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_993_1_993_7&#39;)"><span class="mpre">foldl&#39;</span></a><span class="mpre">, </span><a href="Data.List.html#loc_809_1_809_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_809_1_809_5&#39;)"><span class="mpre">sort</span></a><span class="mpre">
         , </span><a href="Data.List.html#loc_739_1_739_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_739_1_739_8&#39;)"><span class="mpre">groupBy</span></a><span class="mpre">, </span><a href="Data.List.html#loc_810_1_810_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_810_1_810_7&#39;)"><span class="mpre">sortBy</span></a><span class="mpre">, </span><a href="Data.List.html#loc_261_1_261_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_261_1_261_5&#39;)"><span class="mpre">find</span></a><span class="mpre">, </span><a href="Data.List.html#loc_305_1_305_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_305_1_305_10&#39;)"><span class="mpre">isInfixOf</span></a><span class="mpre">, </span><a href="Data.List.html#loc_330_1_330_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_330_1_330_6&#39;)"><span class="mpre">nubBy</span></a><span class="mpre">, </span><a href="Data.List.html#loc_365_1_365_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_365_1_365_9&#39;)"><span class="mpre">deleteBy</span></a><span class="mpre">, </span><a href="Data.List.html#loc_724_1_724_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_724_1_724_15&#39;)"><span class="mpre">deleteFirstsBy</span></a><span class="mpre"> )
import Data.Monoid (</span><a href="Data.Monoid.html#loc_79_7_79_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_79_7_79_13&#39;)"><span class="mpre">Monoid</span></a><span class="mpre">(..))
import Data.Maybe (</span><a href="Data.Maybe.html#loc_85_1_85_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_85_1_85_10&#39;)"><span class="mpre">isNothing</span></a><span class="mpre">, </span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="mpre">fromMaybe</span></a><span class="mpre">)

import Distribution.Package
         ( </span><a href="Distribution.Package.html#loc_80_9_80_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_80_9_80_20&#39;)"><span class="mpre">PackageName</span></a><span class="mpre">(..), PackageId
         , </span><a href="Distribution.Package.html#loc_183_7_183_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_183_7_183_14&#39;)"><span class="mpre">Package</span></a><span class="mpre">(..), </span><a href="Distribution.Package.html#loc_187_1_187_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_187_1_187_12&#39;)"><span class="mpre">packageName</span></a><span class="mpre">, </span><a href="Distribution.Package.html#loc_190_1_190_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_190_1_190_15&#39;)"><span class="mpre">packageVersion</span></a><span class="mpre">
         , </span><a href="Distribution.Package.html#loc_145_6_145_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_145_6_145_16&#39;)"><span class="mpre">Dependency</span></a><span class="mpre">(</span><a href="Distribution.Package.html#loc_145_19_145_29" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_145_19_145_29&#39;)"><span class="mpre">Dependency</span></a><span class="mpre">)</span><span class="hl_comment"><span class="mpre">--, --PackageFixedDeps(..)</span></span><span class="mpre">
         , </span><a href="Distribution.Package.html#loc_130_9_130_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_130_9_130_27&#39;)"><span class="mpre">InstalledPackageId</span></a><span class="mpre">(..) )
import Distribution.ModuleName
         ( </span><a href="Distribution.ModuleName.html#loc_67_9_67_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.ModuleName.html#loc_67_9_67_19&#39;)"><span class="mpre">ModuleName</span></a><span class="mpre"> )
import Distribution.InstalledPackageInfo
         ( InstalledPackageInfo, </span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="mpre">installedPackageId</span></a><span class="mpre"> )
import qualified Distribution.InstalledPackageInfo as IPI
import Distribution.Version
         ( </span><a href="Data.Version.html#loc_68_6_68_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Version.html#loc_68_6_68_13&#39;)"><span class="mpre">Version</span></a><span class="mpre">, </span><a href="Distribution.Version.html#loc_317_1_317_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Version.html#loc_317_1_317_12&#39;)"><span class="mpre">withinRange</span></a><span class="mpre"> )
import Distribution.Simple.Utils (</span><a href="Distribution.Simple.Utils.html#loc_1283_1_1283_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Utils.html#loc_1283_1_1283_10&#39;)"><span class="mpre">lowercase</span></a><span class="mpre">, </span><a href="Distribution.Simple.Utils.html#loc_1277_1_1277_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Utils.html#loc_1277_1_1277_10&#39;)"><span class="mpre">comparing</span></a><span class="mpre">, </span><a href="Distribution.Simple.Utils.html#loc_1274_1_1274_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Utils.html#loc_1274_1_1274_9&#39;)"><span class="mpre">equating</span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">-- | The collection of information about packages from one or more &#39;PackageDB&#39;s.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Packages are uniquely identified in by their &#39;InstalledPackageId&#39;, they can</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- also be effeciently looked up by package name or by name and version.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
data </span><a name="loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tycondecl"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> = </span><a name="loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_condecl"><span class="mpre">PackageIndex</span></span></a><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- The primary index. Each InstalledPackageInfo record is uniquely identified</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- by its InstalledPackageId.</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
  !(</span><span class="hl_tyconref"><span class="mpre">Map</span></span><span class="mpre"> </span><a href="Distribution.Package.html#loc_130_9_130_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_130_9_130_27&#39;)"><span class="hl_tyconref"><span class="mpre">InstalledPackageId</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">)

  </span><span class="hl_comment"><span class="mpre">-- This auxillary index maps package names (case-sensitively) to all the</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- versions and instances of that package. This allows us to find all</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- versions satisfying a dependency.</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- It is a three-level index. The first level is the package name,</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- the second is the package version and the final level is instances</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- of the same package version. These are unique by InstalledPackageId</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- and are kept in preference order.</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- FIXME: Clarify what &quot;preference order&quot; means. Check that this invariant is</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- preserved. See #1463 for discussion.</span></span><span class="mpre">
  !(</span><span class="hl_tyconref"><span class="mpre">Map</span></span><span class="mpre"> </span><a href="Distribution.Package.html#loc_80_9_80_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_80_9_80_20&#39;)"><span class="hl_tyconref"><span class="mpre">PackageName</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Map</span></span><span class="mpre"> </span><a href="Data.Version.html#loc_68_6_68_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Version.html#loc_68_6_68_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">]))

  </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/Cabal-1.18.1.3/Distribution/Simple/PackageIndex.hs&quot;, srcSpanStartLine = 113, srcSpanStartColumn = 3, srcSpanEndLine = 113, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/Cabal-1.18.1.3/Distribution/Simple/PackageIndex.hs&quot;, srcSpanStartLine = 113, srcSpanStartColumn = 3, srcSpanEndLine = 113, srcSpanEndColumn = 11},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/Cabal-1.18.1.3/Distri"><span class="mpre">deriving (Show, Read)</span></span><span class="mpre">

instance </span><a href="Data.Monoid.html#loc_79_7_79_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_79_7_79_13&#39;)"><span class="hl_classref"><span class="mpre">Monoid</span></span></a><span class="mpre"> </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> where
  </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_vardecl"><span class="mpre">mempty</span></span></a><span class="mpre">  = </span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">Map.empty</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">Map.empty</span></span><span class="mpre">
  </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_vardecl"><span class="mpre">mappend</span></span></a><span class="mpre"> = </span><a href="#loc_192_1_192_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_1_192_6&#39;)"><span class="hl_varref"><span class="mpre">merge</span></span></a><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--save one mappend with empty in the common case:</span></span><span class="mpre">
  </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_fundecl"><span class="mpre">mconcat</span></span></a><span class="mpre"> [] = </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">
  </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_fundecl"><span class="mpre">mconcat</span></span></a><span class="mpre"> </span><a name="loc_120_11_120_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_11_120_13&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">foldr1</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_varref"><span class="mpre">mappend</span></span></a><span class="mpre"> </span><a href="#loc_120_11_120_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_11_120_13&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">

</span><a href="#loc_123_1_123_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_10&#39;)"><span class="mpre">invariant</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_123_1_123_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_10&#39;)"><span class="hl_fundecl"><span class="mpre">invariant</span></span></a><span class="mpre"> (</span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> </span><a name="loc_123_25_123_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_25_123_29&#39;)"><span class="hl_vardecl"><span class="mpre">pids</span></span></a><span class="mpre"> </span><a name="loc_123_30_123_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_30_123_36&#39;)"><span class="hl_vardecl"><span class="mpre">pnames</span></span></a><span class="mpre">) =
     </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Map.elems</span></span><span class="mpre"> </span><a href="#loc_123_25_123_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_25_123_29&#39;)"><span class="hl_varref"><span class="mpre">pids</span></span></a><span class="mpre">)
  </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="Data.List.html#loc_809_1_809_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_809_1_809_5&#39;)"><span class="hl_varref"><span class="mpre">sort</span></span></a><span class="mpre">
     [ </span><span class="hl_varref"><span class="mpre">assert</span></span><span class="mpre"> </span><a href="#loc_134_12_134_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_12_134_19&#39;)"><span class="hl_varref"><span class="mpre">pinstOk</span></span></a><span class="mpre"> (</span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre"> </span><a href="#loc_133_8_133_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_8_133_13&#39;)"><span class="hl_varref"><span class="mpre">pinst</span></span></a><span class="mpre">)
     | (</span><a name="loc_127_9_127_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_9_127_14&#39;)"><span class="hl_vardecl"><span class="mpre">pname</span></span></a><span class="mpre">, </span><a name="loc_127_16_127_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_16_127_21&#39;)"><span class="hl_vardecl"><span class="mpre">pvers</span></span></a><span class="mpre">)  &lt;- </span><span class="hl_varref"><span class="mpre">Map.toList</span></span><span class="mpre"> </span><a href="#loc_123_30_123_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_30_123_36&#39;)"><span class="hl_varref"><span class="mpre">pnames</span></span></a><span class="mpre">
     , let </span><a name="loc_128_12_128_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_12_128_19&#39;)"><span class="hl_vardecl"><span class="mpre">pversOk</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Map.null</span></span><span class="mpre"> </span><a href="#loc_127_16_127_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_16_127_21&#39;)"><span class="hl_varref"><span class="mpre">pvers</span></span></a><span class="mpre">)
     , (</span><a name="loc_129_9_129_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_9_129_13&#39;)"><span class="hl_vardecl"><span class="mpre">pver</span></span></a><span class="mpre">,  </span><a name="loc_129_16_129_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_16_129_22&#39;)"><span class="hl_vardecl"><span class="mpre">pinsts</span></span></a><span class="mpre">) &lt;- </span><span class="hl_varref"><span class="mpre">assert</span></span><span class="mpre"> </span><a href="#loc_128_12_128_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_12_128_19&#39;)"><span class="hl_varref"><span class="mpre">pversOk</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">Map.toList</span></span><span class="mpre"> </span><a href="#loc_127_16_127_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_16_127_21&#39;)"><span class="hl_varref"><span class="mpre">pvers</span></span></a><span class="mpre">
     , let </span><a name="loc_130_12_130_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_12_130_19&#39;)"><span class="hl_vardecl"><span class="mpre">pinsts&#39;</span></span></a><span class="mpre">  = </span><a href="Data.List.html#loc_810_1_810_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_810_1_810_7&#39;)"><span class="hl_varref"><span class="mpre">sortBy</span></span></a><span class="mpre"> (</span><a href="Distribution.Simple.Utils.html#loc_1277_1_1277_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Utils.html#loc_1277_1_1277_10&#39;)"><span class="hl_varref"><span class="mpre">comparing</span></span></a><span class="mpre"> </span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre">) </span><a href="#loc_129_16_129_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_16_129_22&#39;)"><span class="hl_varref"><span class="mpre">pinsts</span></span></a><span class="mpre">
           </span><a name="loc_131_12_131_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_12_131_20&#39;)"><span class="hl_vardecl"><span class="mpre">pinstsOk</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">all</span></span><span class="mpre"> (\</span><a name="loc_131_29_131_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_29_131_30&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">length</span></span><span class="mpre"> </span><a href="#loc_131_29_131_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_29_131_30&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
                          (</span><a href="Data.List.html#loc_739_1_739_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_739_1_739_8&#39;)"><span class="hl_varref"><span class="mpre">groupBy</span></span></a><span class="mpre"> (</span><a href="Distribution.Simple.Utils.html#loc_1274_1_1274_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Utils.html#loc_1274_1_1274_9&#39;)"><span class="hl_varref"><span class="mpre">equating</span></span></a><span class="mpre"> </span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre">) </span><a href="#loc_130_12_130_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_12_130_19&#39;)"><span class="hl_varref"><span class="mpre">pinsts&#39;</span></span></a><span class="mpre">)
     , </span><a name="loc_133_8_133_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_8_133_13&#39;)"><span class="hl_vardecl"><span class="mpre">pinst</span></span></a><span class="mpre">           &lt;- </span><span class="hl_varref"><span class="mpre">assert</span></span><span class="mpre"> </span><a href="#loc_131_12_131_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_12_131_20&#39;)"><span class="hl_varref"><span class="mpre">pinstsOk</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_130_12_130_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_12_130_19&#39;)"><span class="hl_varref"><span class="mpre">pinsts&#39;</span></span></a><span class="mpre">
     , let </span><a name="loc_134_12_134_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_12_134_19&#39;)"><span class="hl_vardecl"><span class="mpre">pinstOk</span></span></a><span class="mpre"> = </span><a href="Distribution.Package.html#loc_187_1_187_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_187_1_187_12&#39;)"><span class="hl_varref"><span class="mpre">packageName</span></span></a><span class="mpre">    </span><a href="#loc_133_8_133_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_8_133_13&#39;)"><span class="hl_varref"><span class="mpre">pinst</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_127_9_127_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_9_127_14&#39;)"><span class="hl_varref"><span class="mpre">pname</span></span></a><span class="mpre">
                  </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="Distribution.Package.html#loc_190_1_190_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_190_1_190_15&#39;)"><span class="hl_varref"><span class="mpre">packageVersion</span></span></a><span class="mpre"> </span><a href="#loc_133_8_133_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_8_133_13&#39;)"><span class="hl_varref"><span class="mpre">pinst</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_129_9_129_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_9_129_13&#39;)"><span class="hl_varref"><span class="mpre">pver</span></span></a><span class="mpre">
     ]


</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Internal helpers</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">

</span><a href="#loc_146_1_146_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_1_146_15&#39;)"><span class="mpre">mkPackageIndex</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Map</span></span><span class="mpre"> </span><a href="Distribution.Package.html#loc_130_9_130_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_130_9_130_27&#39;)"><span class="hl_tyconref"><span class="mpre">InstalledPackageId</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">
               -&gt; </span><span class="hl_tyconref"><span class="mpre">Map</span></span><span class="mpre"> </span><a href="Distribution.Package.html#loc_80_9_80_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_80_9_80_20&#39;)"><span class="hl_tyconref"><span class="mpre">PackageName</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Map</span></span><span class="mpre"> </span><a href="Data.Version.html#loc_68_6_68_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Version.html#loc_68_6_68_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">])
               -&gt; </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre">
</span><a name="loc_146_1_146_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_1_146_15&#39;)"><span class="hl_fundecl"><span class="mpre">mkPackageIndex</span></span></a><span class="mpre"> </span><a name="loc_146_16_146_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_16_146_20&#39;)"><span class="hl_vardecl"><span class="mpre">pids</span></span></a><span class="mpre"> </span><a name="loc_146_21_146_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_21_146_27&#39;)"><span class="hl_vardecl"><span class="mpre">pnames</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">assert</span></span><span class="mpre"> (</span><a href="#loc_123_1_123_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_10&#39;)"><span class="hl_varref"><span class="mpre">invariant</span></span></a><span class="mpre"> </span><a href="#loc_147_9_147_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_9_147_14&#39;)"><span class="hl_varref"><span class="mpre">index</span></span></a><span class="mpre">) </span><a href="#loc_147_9_147_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_9_147_14&#39;)"><span class="hl_varref"><span class="mpre">index</span></span></a><span class="mpre">
  where </span><a name="loc_147_9_147_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_9_147_14&#39;)"><span class="hl_vardecl"><span class="mpre">index</span></span></a><span class="mpre"> = </span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> </span><a href="#loc_146_16_146_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_16_146_20&#39;)"><span class="hl_varref"><span class="mpre">pids</span></span></a><span class="mpre"> </span><a href="#loc_146_21_146_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_21_146_27&#39;)"><span class="hl_varref"><span class="mpre">pnames</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Construction</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Build an index out of a bunch of packages.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If there are duplicates by &#39;InstalledPackageId&#39; then later ones mask earlier</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ones.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_160_1_160_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_1_160_9&#39;)"><span class="mpre">fromList</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">] -&gt; </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre">
</span><a name="loc_160_1_160_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_1_160_9&#39;)"><span class="hl_fundecl"><span class="mpre">fromList</span></span></a><span class="mpre"> </span><a name="loc_160_10_160_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_10_160_14&#39;)"><span class="hl_vardecl"><span class="mpre">pkgs</span></span></a><span class="mpre"> = </span><a href="#loc_146_1_146_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_1_146_15&#39;)"><span class="hl_varref"><span class="mpre">mkPackageIndex</span></span></a><span class="mpre"> </span><a href="#loc_162_5_162_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_5_162_9&#39;)"><span class="hl_varref"><span class="mpre">pids</span></span></a><span class="mpre"> </span><a href="#loc_163_5_163_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_5_163_11&#39;)"><span class="hl_varref"><span class="mpre">pnames</span></span></a><span class="mpre">
  where
    </span><a name="loc_162_5_162_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_5_162_9&#39;)"><span class="hl_vardecl"><span class="mpre">pids</span></span></a><span class="mpre">      = </span><span class="hl_varref"><span class="mpre">Map.fromList</span></span><span class="mpre"> [ (</span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre"> </span><a href="#loc_162_64_162_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_64_162_67&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">, </span><a href="#loc_162_64_162_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_64_162_67&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">) | </span><a name="loc_162_64_162_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_64_162_67&#39;)"><span class="hl_vardecl"><span class="mpre">pkg</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_160_10_160_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_10_160_14&#39;)"><span class="hl_varref"><span class="mpre">pkgs</span></span></a><span class="mpre"> ]
    </span><a name="loc_163_5_163_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_5_163_11&#39;)"><span class="hl_vardecl"><span class="mpre">pnames</span></span></a><span class="mpre">    =
      </span><span class="hl_varref"><span class="mpre">Map.fromList</span></span><span class="mpre">
        [ (</span><a href="Distribution.Package.html#loc_187_1_187_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_187_1_187_12&#39;)"><span class="hl_varref"><span class="mpre">packageName</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">head</span></span><span class="mpre"> </span><a href="#loc_166_11_166_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_11_166_16&#39;)"><span class="hl_varref"><span class="mpre">pkgsN</span></span></a><span class="mpre">), </span><a href="#loc_169_15_169_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_15_169_20&#39;)"><span class="hl_varref"><span class="mpre">pvers</span></span></a><span class="mpre">)
        | </span><a name="loc_166_11_166_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_11_166_16&#39;)"><span class="hl_vardecl"><span class="mpre">pkgsN</span></span></a><span class="mpre"> &lt;- </span><a href="Data.List.html#loc_739_1_739_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_739_1_739_8&#39;)"><span class="hl_varref"><span class="mpre">groupBy</span></span></a><span class="mpre"> (</span><a href="Distribution.Simple.Utils.html#loc_1274_1_1274_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Utils.html#loc_1274_1_1274_9&#39;)"><span class="hl_varref"><span class="mpre">equating</span></span></a><span class="mpre">  </span><a href="Distribution.Package.html#loc_187_1_187_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_187_1_187_12&#39;)"><span class="hl_varref"><span class="mpre">packageName</span></span></a><span class="mpre">)
                 </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.List.html#loc_810_1_810_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_810_1_810_7&#39;)"><span class="hl_varref"><span class="mpre">sortBy</span></span></a><span class="mpre">  (</span><a href="Distribution.Simple.Utils.html#loc_1277_1_1277_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Utils.html#loc_1277_1_1277_10&#39;)"><span class="hl_varref"><span class="mpre">comparing</span></span></a><span class="mpre"> </span><a href="Distribution.Package.html#loc_184_3_184_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_184_3_184_12&#39;)"><span class="hl_varref"><span class="mpre">packageId</span></span></a><span class="mpre">)
                 </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_160_10_160_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_10_160_14&#39;)"><span class="hl_varref"><span class="mpre">pkgs</span></span></a><span class="mpre">
        , let </span><a name="loc_169_15_169_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_15_169_20&#39;)"><span class="hl_vardecl"><span class="mpre">pvers</span></span></a><span class="mpre"> =
                </span><span class="hl_varref"><span class="mpre">Map.fromList</span></span><span class="mpre">
                [ (</span><a href="Distribution.Package.html#loc_190_1_190_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_190_1_190_15&#39;)"><span class="hl_varref"><span class="mpre">packageVersion</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">head</span></span><span class="mpre"> </span><a href="#loc_173_19_173_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_19_173_25&#39;)"><span class="hl_varref"><span class="mpre">pkgsNV</span></span></a><span class="mpre">),
                   </span><a href="Data.List.html#loc_330_1_330_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_330_1_330_6&#39;)"><span class="hl_varref"><span class="mpre">nubBy</span></span></a><span class="mpre"> (</span><a href="Distribution.Simple.Utils.html#loc_1274_1_1274_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Utils.html#loc_1274_1_1274_9&#39;)"><span class="hl_varref"><span class="mpre">equating</span></span></a><span class="mpre"> </span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">reverse</span></span><span class="mpre"> </span><a href="#loc_173_19_173_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_19_173_25&#39;)"><span class="hl_varref"><span class="mpre">pkgsNV</span></span></a><span class="mpre">))
                | </span><a name="loc_173_19_173_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_19_173_25&#39;)"><span class="hl_vardecl"><span class="mpre">pkgsNV</span></span></a><span class="mpre"> &lt;- </span><a href="Data.List.html#loc_739_1_739_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_739_1_739_8&#39;)"><span class="hl_varref"><span class="mpre">groupBy</span></span></a><span class="mpre"> (</span><a href="Distribution.Simple.Utils.html#loc_1274_1_1274_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Utils.html#loc_1274_1_1274_9&#39;)"><span class="hl_varref"><span class="mpre">equating</span></span></a><span class="mpre"> </span><a href="Distribution.Package.html#loc_190_1_190_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_190_1_190_15&#39;)"><span class="hl_varref"><span class="mpre">packageVersion</span></span></a><span class="mpre">) </span><a href="#loc_166_11_166_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_11_166_16&#39;)"><span class="hl_varref"><span class="mpre">pkgsN</span></span></a><span class="mpre">
                ]
        ]

</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Updates</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Merge two indexes.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Packages from the second mask packages from the first if they have the exact</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- same &#39;InstalledPackageId&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- For packages with the same source &#39;PackageId&#39;, packages from the second are</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- \&quot;preferred\&quot; over those from the first. Being preferred means they are top</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- result when we do a lookup by source &#39;PackageId&#39;. This is the mechanism we</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- use to prefer user packages over global packages.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_192_1_192_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_1_192_6&#39;)"><span class="mpre">merge</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre">
</span><a name="loc_192_1_192_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_1_192_6&#39;)"><span class="hl_fundecl"><span class="mpre">merge</span></span></a><span class="mpre"> (</span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> </span><a name="loc_192_21_192_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_21_192_26&#39;)"><span class="hl_vardecl"><span class="mpre">pids1</span></span></a><span class="mpre"> </span><a name="loc_192_27_192_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_27_192_34&#39;)"><span class="hl_vardecl"><span class="mpre">pnames1</span></span></a><span class="mpre">) (</span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> </span><a name="loc_192_50_192_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_50_192_55&#39;)"><span class="hl_vardecl"><span class="mpre">pids2</span></span></a><span class="mpre"> </span><a name="loc_192_56_192_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_56_192_63&#39;)"><span class="hl_vardecl"><span class="mpre">pnames2</span></span></a><span class="mpre">) =
  </span><a href="#loc_146_1_146_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_1_146_15&#39;)"><span class="hl_varref"><span class="mpre">mkPackageIndex</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Map.union</span></span><span class="mpre"> </span><a href="#loc_192_21_192_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_21_192_26&#39;)"><span class="hl_varref"><span class="mpre">pids1</span></span></a><span class="mpre"> </span><a href="#loc_192_50_192_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_50_192_55&#39;)"><span class="hl_varref"><span class="mpre">pids2</span></span></a><span class="mpre">)
                 (</span><span class="hl_varref"><span class="mpre">Map.unionWith</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Map.unionWith</span></span><span class="mpre"> </span><a href="#loc_198_5_198_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_5_198_17&#39;)"><span class="hl_varref"><span class="mpre">mergeBuckets</span></span></a><span class="mpre">) </span><a href="#loc_192_27_192_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_27_192_34&#39;)"><span class="hl_varref"><span class="mpre">pnames1</span></span></a><span class="mpre"> </span><a href="#loc_192_56_192_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_56_192_63&#39;)"><span class="hl_varref"><span class="mpre">pnames2</span></span></a><span class="mpre">)
  where
    </span><span class="hl_comment"><span class="mpre">-- Packages in the second list mask those in the first, however preferred</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- packages go first in the list.</span></span><span class="mpre">
    </span><a name="loc_198_5_198_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_5_198_17&#39;)"><span class="hl_fundecl"><span class="mpre">mergeBuckets</span></span></a><span class="mpre"> </span><a name="loc_198_18_198_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_18_198_20&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre"> </span><a name="loc_198_21_198_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_21_198_23&#39;)"><span class="hl_vardecl"><span class="mpre">ys</span></span></a><span class="mpre"> = </span><a href="#loc_198_21_198_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_21_198_23&#39;)"><span class="hl_varref"><span class="mpre">ys</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> (</span><a href="#loc_198_18_198_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_18_198_20&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre"> </span><a href="#loc_199_5_199_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_5_199_9&#39;)"><span class="hl_infix"><span class="mpre">\\</span></span></a><span class="mpre"> </span><a href="#loc_198_21_198_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_21_198_23&#39;)"><span class="hl_varref"><span class="mpre">ys</span></span></a><span class="mpre">)
    </span><a name="loc_199_5_199_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_5_199_9&#39;)"><span class="hl_vardecl"><span class="mpre">(\\)</span></span></a><span class="mpre"> = </span><a href="Data.List.html#loc_724_1_724_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_724_1_724_15&#39;)"><span class="hl_varref"><span class="mpre">deleteFirstsBy</span></span></a><span class="mpre"> (</span><a href="Distribution.Simple.Utils.html#loc_1274_1_1274_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Utils.html#loc_1274_1_1274_9&#39;)"><span class="hl_varref"><span class="mpre">equating</span></span></a><span class="mpre"> </span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">-- | Inserts a single package into the index.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This is equivalent to (but slightly quicker than) using &#39;mappend&#39; or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;merge&#39; with a singleton index.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_208_1_208_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_1_208_7&#39;)"><span class="mpre">insert</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre"> -&gt; </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre">
</span><a name="loc_208_1_208_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_1_208_7&#39;)"><span class="hl_fundecl"><span class="mpre">insert</span></span></a><span class="mpre"> </span><a name="loc_208_8_208_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_8_208_11&#39;)"><span class="hl_vardecl"><span class="mpre">pkg</span></span></a><span class="mpre"> (</span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> </span><a name="loc_208_26_208_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_26_208_30&#39;)"><span class="hl_vardecl"><span class="mpre">pids</span></span></a><span class="mpre"> </span><a name="loc_208_31_208_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_31_208_37&#39;)"><span class="hl_vardecl"><span class="mpre">pnames</span></span></a><span class="mpre">) =
    </span><a href="#loc_146_1_146_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_1_146_15&#39;)"><span class="hl_varref"><span class="mpre">mkPackageIndex</span></span></a><span class="mpre"> </span><a href="#loc_212_5_212_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_5_212_10&#39;)"><span class="hl_varref"><span class="mpre">pids&#39;</span></span></a><span class="mpre"> </span><a href="#loc_213_5_213_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_5_213_12&#39;)"><span class="hl_varref"><span class="mpre">pnames&#39;</span></span></a><span class="mpre">

  where
    </span><a name="loc_212_5_212_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_5_212_10&#39;)"><span class="hl_vardecl"><span class="mpre">pids&#39;</span></span></a><span class="mpre">   = </span><span class="hl_varref"><span class="mpre">Map.insert</span></span><span class="mpre"> (</span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre"> </span><a href="#loc_208_8_208_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_8_208_11&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">) </span><a href="#loc_208_8_208_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_8_208_11&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre"> </span><a href="#loc_208_26_208_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_26_208_30&#39;)"><span class="hl_varref"><span class="mpre">pids</span></span></a><span class="mpre">
    </span><a name="loc_213_5_213_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_5_213_12&#39;)"><span class="hl_vardecl"><span class="mpre">pnames&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_214_5_214_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_5_214_22&#39;)"><span class="hl_varref"><span class="mpre">insertPackageName</span></span></a><span class="mpre"> </span><a href="#loc_208_31_208_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_31_208_37&#39;)"><span class="hl_varref"><span class="mpre">pnames</span></span></a><span class="mpre">
    </span><a name="loc_214_5_214_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_5_214_22&#39;)"><span class="hl_vardecl"><span class="mpre">insertPackageName</span></span></a><span class="mpre"> =
      </span><a href="Data.Map.html#loc_73_1_73_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Map.html#loc_73_1_73_12&#39;)"><span class="hl_varref"><span class="mpre">Map.insertWith&#39;</span></span></a><span class="mpre"> (\_ -&gt; </span><a href="#loc_219_5_219_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_5_219_25&#39;)"><span class="hl_varref"><span class="mpre">insertPackageVersion</span></span></a><span class="mpre">)
                     (</span><a href="Distribution.Package.html#loc_187_1_187_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_187_1_187_12&#39;)"><span class="hl_varref"><span class="mpre">packageName</span></span></a><span class="mpre"> </span><a href="#loc_208_8_208_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_8_208_11&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">)
                     (</span><span class="hl_varref"><span class="mpre">Map.singleton</span></span><span class="mpre"> (</span><a href="Distribution.Package.html#loc_190_1_190_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_190_1_190_15&#39;)"><span class="hl_varref"><span class="mpre">packageVersion</span></span></a><span class="mpre"> </span><a href="#loc_208_8_208_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_8_208_11&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">) [</span><a href="#loc_208_8_208_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_8_208_11&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">])

    </span><a name="loc_219_5_219_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_5_219_25&#39;)"><span class="hl_vardecl"><span class="mpre">insertPackageVersion</span></span></a><span class="mpre"> =
      </span><a href="Data.Map.html#loc_73_1_73_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Map.html#loc_73_1_73_12&#39;)"><span class="hl_varref"><span class="mpre">Map.insertWith&#39;</span></span></a><span class="mpre"> (\_ -&gt; </span><a href="#loc_223_5_223_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_5_223_26&#39;)"><span class="hl_varref"><span class="mpre">insertPackageInstance</span></span></a><span class="mpre">)
                     (</span><a href="Distribution.Package.html#loc_190_1_190_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_190_1_190_15&#39;)"><span class="hl_varref"><span class="mpre">packageVersion</span></span></a><span class="mpre"> </span><a href="#loc_208_8_208_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_8_208_11&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">) [</span><a href="#loc_208_8_208_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_8_208_11&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">]

    </span><a name="loc_223_5_223_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_5_223_26&#39;)"><span class="hl_fundecl"><span class="mpre">insertPackageInstance</span></span></a><span class="mpre"> </span><a name="loc_223_27_223_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_27_223_31&#39;)"><span class="hl_vardecl"><span class="mpre">pkgs</span></span></a><span class="mpre"> =
      </span><a href="#loc_208_8_208_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_8_208_11&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="Data.List.html#loc_365_1_365_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_365_1_365_9&#39;)"><span class="hl_varref"><span class="mpre">deleteBy</span></span></a><span class="mpre"> (</span><a href="Distribution.Simple.Utils.html#loc_1274_1_1274_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Utils.html#loc_1274_1_1274_9&#39;)"><span class="hl_varref"><span class="mpre">equating</span></span></a><span class="mpre"> </span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre">) </span><a href="#loc_208_8_208_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_8_208_11&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre"> </span><a href="#loc_223_27_223_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_27_223_31&#39;)"><span class="hl_varref"><span class="mpre">pkgs</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | Removes a single installed package from the index.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_230_1_230_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_1_230_25&#39;)"><span class="mpre">deleteInstalledPackageId</span></a><span class="mpre"> :: </span><a href="Distribution.Package.html#loc_130_9_130_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_130_9_130_27&#39;)"><span class="hl_tyconref"><span class="mpre">InstalledPackageId</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre">
</span><a name="loc_230_1_230_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_1_230_25&#39;)"><span class="hl_fundecl"><span class="mpre">deleteInstalledPackageId</span></span></a><span class="mpre"> </span><a name="loc_230_26_230_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_26_230_32&#39;)"><span class="hl_vardecl"><span class="mpre">ipkgid</span></span></a><span class="mpre"> </span><a name="loc_230_33_230_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_33_230_41&#39;)"><span class="hl_specname"><span class="mpre">original</span></span></a><span class="mpre">@(</span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> </span><a name="loc_230_56_230_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_56_230_60&#39;)"><span class="hl_vardecl"><span class="mpre">pids</span></span></a><span class="mpre"> </span><a name="loc_230_61_230_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_61_230_67&#39;)"><span class="hl_vardecl"><span class="mpre">pnames</span></span></a><span class="mpre">) =
  case </span><span class="hl_varref"><span class="mpre">Map.updateLookupWithKey</span></span><span class="mpre"> (\_ _ -&gt; </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">) </span><a href="#loc_230_26_230_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_26_230_32&#39;)"><span class="hl_varref"><span class="mpre">ipkgid</span></span></a><span class="mpre"> </span><a href="#loc_230_56_230_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_56_230_60&#39;)"><span class="hl_varref"><span class="mpre">pids</span></span></a><span class="mpre"> of
    (</span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">,     _)     -&gt; </span><a href="#loc_230_33_230_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_33_230_41&#39;)"><span class="hl_varref"><span class="mpre">original</span></span></a><span class="mpre">
    (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_233_11_233_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_11_233_17&#39;)"><span class="hl_vardecl"><span class="mpre">spkgid</span></span></a><span class="mpre">, </span><a name="loc_233_19_233_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_19_233_24&#39;)"><span class="hl_vardecl"><span class="mpre">pids&#39;</span></span></a><span class="mpre">) -&gt; </span><a href="#loc_146_1_146_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_1_146_15&#39;)"><span class="hl_varref"><span class="mpre">mkPackageIndex</span></span></a><span class="mpre"> </span><a href="#loc_233_19_233_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_19_233_24&#39;)"><span class="hl_varref"><span class="mpre">pids&#39;</span></span></a><span class="mpre">
                                          (</span><a href="#loc_237_5_237_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_5_237_18&#39;)"><span class="hl_varref"><span class="mpre">deletePkgName</span></span></a><span class="mpre"> </span><a href="#loc_233_11_233_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_11_233_17&#39;)"><span class="hl_varref"><span class="mpre">spkgid</span></span></a><span class="mpre"> </span><a href="#loc_230_61_230_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_61_230_67&#39;)"><span class="hl_varref"><span class="mpre">pnames</span></span></a><span class="mpre">)

  where
    </span><a name="loc_237_5_237_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_5_237_18&#39;)"><span class="hl_fundecl"><span class="mpre">deletePkgName</span></span></a><span class="mpre"> </span><a name="loc_237_19_237_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_19_237_25&#39;)"><span class="hl_vardecl"><span class="mpre">spkgid</span></span></a><span class="mpre"> =
      </span><span class="hl_varref"><span class="mpre">Map.update</span></span><span class="mpre"> (</span><a href="#loc_240_5_240_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_5_240_21&#39;)"><span class="hl_varref"><span class="mpre">deletePkgVersion</span></span></a><span class="mpre"> </span><a href="#loc_237_19_237_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_19_237_25&#39;)"><span class="hl_varref"><span class="mpre">spkgid</span></span></a><span class="mpre">) (</span><a href="Distribution.Package.html#loc_187_1_187_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_187_1_187_12&#39;)"><span class="hl_varref"><span class="mpre">packageName</span></span></a><span class="mpre"> </span><a href="#loc_237_19_237_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_19_237_25&#39;)"><span class="hl_varref"><span class="mpre">spkgid</span></span></a><span class="mpre">)

    </span><a name="loc_240_5_240_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_5_240_21&#39;)"><span class="hl_fundecl"><span class="mpre">deletePkgVersion</span></span></a><span class="mpre"> </span><a name="loc_240_22_240_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_22_240_28&#39;)"><span class="hl_vardecl"><span class="mpre">spkgid</span></span></a><span class="mpre"> =
        (\</span><a name="loc_241_11_241_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_11_241_12&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> -&gt; if </span><span class="hl_varref"><span class="mpre">Map.null</span></span><span class="mpre"> </span><a href="#loc_241_11_241_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_11_241_12&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> then </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> else </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_241_11_241_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_11_241_12&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">)
      </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">Map.update</span></span><span class="mpre"> </span><a href="#loc_244_5_244_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_5_244_22&#39;)"><span class="hl_varref"><span class="mpre">deletePkgInstance</span></span></a><span class="mpre"> (</span><a href="Distribution.Package.html#loc_190_1_190_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_190_1_190_15&#39;)"><span class="hl_varref"><span class="mpre">packageVersion</span></span></a><span class="mpre"> </span><a href="#loc_240_22_240_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_22_240_28&#39;)"><span class="hl_varref"><span class="mpre">spkgid</span></span></a><span class="mpre">)

    </span><a name="loc_244_5_244_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_5_244_22&#39;)"><span class="hl_vardecl"><span class="mpre">deletePkgInstance</span></span></a><span class="mpre"> =
        (\</span><a name="loc_245_11_245_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_11_245_13&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre"> -&gt; if </span><span class="hl_varref"><span class="mpre">List.null</span></span><span class="mpre"> </span><a href="#loc_245_11_245_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_11_245_13&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre"> then </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> else </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_245_11_245_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_11_245_13&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">)
      </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.List.html#loc_365_1_365_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_365_1_365_9&#39;)"><span class="hl_varref"><span class="mpre">List.deleteBy</span></span></a><span class="mpre"> (\_ </span><a name="loc_246_27_246_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_246_27_246_30&#39;)"><span class="hl_vardecl"><span class="mpre">pkg</span></span></a><span class="mpre"> -&gt; </span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre"> </span><a href="#loc_246_27_246_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_246_27_246_30&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_230_26_230_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_26_230_32&#39;)"><span class="hl_varref"><span class="mpre">ipkgid</span></span></a><span class="mpre">) </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | Removes all packages with this source &#39;PackageId&#39; from the index.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_252_1_252_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_1_252_22&#39;)"><span class="mpre">deleteSourcePackageId</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">PackageId</span></span><span class="mpre"> -&gt; </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre">
</span><a name="loc_252_1_252_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_1_252_22&#39;)"><span class="hl_fundecl"><span class="mpre">deleteSourcePackageId</span></span></a><span class="mpre"> </span><a name="loc_252_23_252_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_23_252_28&#39;)"><span class="hl_vardecl"><span class="mpre">pkgid</span></span></a><span class="mpre"> </span><a name="loc_252_29_252_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_29_252_37&#39;)"><span class="hl_specname"><span class="mpre">original</span></span></a><span class="mpre">@(</span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> </span><a name="loc_252_52_252_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_52_252_56&#39;)"><span class="hl_vardecl"><span class="mpre">pids</span></span></a><span class="mpre"> </span><a name="loc_252_57_252_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_57_252_63&#39;)"><span class="hl_vardecl"><span class="mpre">pnames</span></span></a><span class="mpre">) =
  case </span><span class="hl_varref"><span class="mpre">Map.lookup</span></span><span class="mpre"> (</span><a href="Distribution.Package.html#loc_187_1_187_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_187_1_187_12&#39;)"><span class="hl_varref"><span class="mpre">packageName</span></span></a><span class="mpre"> </span><a href="#loc_252_23_252_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_23_252_28&#39;)"><span class="hl_varref"><span class="mpre">pkgid</span></span></a><span class="mpre">) </span><a href="#loc_252_57_252_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_57_252_63&#39;)"><span class="hl_varref"><span class="mpre">pnames</span></span></a><span class="mpre"> of
    </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">     -&gt; </span><a href="#loc_252_29_252_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_29_252_37&#39;)"><span class="hl_varref"><span class="mpre">original</span></span></a><span class="mpre">
    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_255_10_255_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_255_10_255_15&#39;)"><span class="hl_vardecl"><span class="mpre">pvers</span></span></a><span class="mpre">  -&gt; case </span><span class="hl_varref"><span class="mpre">Map.lookup</span></span><span class="mpre"> (</span><a href="Distribution.Package.html#loc_190_1_190_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_190_1_190_15&#39;)"><span class="hl_varref"><span class="mpre">packageVersion</span></span></a><span class="mpre"> </span><a href="#loc_252_23_252_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_23_252_28&#39;)"><span class="hl_varref"><span class="mpre">pkgid</span></span></a><span class="mpre">) </span><a href="#loc_255_10_255_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_255_10_255_15&#39;)"><span class="hl_varref"><span class="mpre">pvers</span></span></a><span class="mpre"> of
      </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">   -&gt; </span><a href="#loc_252_29_252_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_29_252_37&#39;)"><span class="hl_varref"><span class="mpre">original</span></span></a><span class="mpre">
      </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_257_12_257_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_12_257_16&#39;)"><span class="hl_vardecl"><span class="mpre">pkgs</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_146_1_146_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_1_146_15&#39;)"><span class="hl_varref"><span class="mpre">mkPackageIndex</span></span></a><span class="mpre">
                     (</span><a href="Data.List.html#loc_993_1_993_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_993_1_993_7&#39;)"><span class="hl_varref"><span class="mpre">foldl&#39;</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">flip</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Map.delete</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre">)) </span><a href="#loc_252_52_252_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_52_252_56&#39;)"><span class="hl_varref"><span class="mpre">pids</span></span></a><span class="mpre"> </span><a href="#loc_257_12_257_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_12_257_16&#39;)"><span class="hl_varref"><span class="mpre">pkgs</span></span></a><span class="mpre">)
                     (</span><a href="#loc_261_5_261_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_5_261_18&#39;)"><span class="hl_varref"><span class="mpre">deletePkgName</span></span></a><span class="mpre"> </span><a href="#loc_252_57_252_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_57_252_63&#39;)"><span class="hl_varref"><span class="mpre">pnames</span></span></a><span class="mpre">)
  where
    </span><a name="loc_261_5_261_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_5_261_18&#39;)"><span class="hl_vardecl"><span class="mpre">deletePkgName</span></span></a><span class="mpre"> =
      </span><span class="hl_varref"><span class="mpre">Map.update</span></span><span class="mpre"> </span><a href="#loc_264_5_264_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_5_264_21&#39;)"><span class="hl_varref"><span class="mpre">deletePkgVersion</span></span></a><span class="mpre"> (</span><a href="Distribution.Package.html#loc_187_1_187_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_187_1_187_12&#39;)"><span class="hl_varref"><span class="mpre">packageName</span></span></a><span class="mpre"> </span><a href="#loc_252_23_252_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_23_252_28&#39;)"><span class="hl_varref"><span class="mpre">pkgid</span></span></a><span class="mpre">)

    </span><a name="loc_264_5_264_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_5_264_21&#39;)"><span class="hl_vardecl"><span class="mpre">deletePkgVersion</span></span></a><span class="mpre"> =
        (\</span><a name="loc_265_11_265_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_11_265_12&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> -&gt; if </span><span class="hl_varref"><span class="mpre">Map.null</span></span><span class="mpre"> </span><a href="#loc_265_11_265_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_11_265_12&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> then </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> else </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_265_11_265_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_11_265_12&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">)
      </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">Map.delete</span></span><span class="mpre"> (</span><a href="Distribution.Package.html#loc_190_1_190_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_190_1_190_15&#39;)"><span class="hl_varref"><span class="mpre">packageVersion</span></span></a><span class="mpre"> </span><a href="#loc_252_23_252_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_23_252_28&#39;)"><span class="hl_varref"><span class="mpre">pkgid</span></span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">-- | Removes all packages with this (case-sensitive) name from the index.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_272_1_272_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_272_1_272_18&#39;)"><span class="mpre">deletePackageName</span></a><span class="mpre"> :: </span><a href="Distribution.Package.html#loc_80_9_80_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_80_9_80_20&#39;)"><span class="hl_tyconref"><span class="mpre">PackageName</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre">
</span><a name="loc_272_1_272_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_272_1_272_18&#39;)"><span class="hl_fundecl"><span class="mpre">deletePackageName</span></span></a><span class="mpre"> </span><a name="loc_272_19_272_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_272_19_272_23&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre"> </span><a name="loc_272_24_272_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_272_24_272_32&#39;)"><span class="hl_specname"><span class="mpre">original</span></span></a><span class="mpre">@(</span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> </span><a name="loc_272_47_272_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_272_47_272_51&#39;)"><span class="hl_vardecl"><span class="mpre">pids</span></span></a><span class="mpre"> </span><a name="loc_272_52_272_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_272_52_272_58&#39;)"><span class="hl_vardecl"><span class="mpre">pnames</span></span></a><span class="mpre">) =
  case </span><span class="hl_varref"><span class="mpre">Map.lookup</span></span><span class="mpre"> </span><a href="#loc_272_19_272_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_272_19_272_23&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre"> </span><a href="#loc_272_52_272_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_272_52_272_58&#39;)"><span class="hl_varref"><span class="mpre">pnames</span></span></a><span class="mpre"> of
    </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">     -&gt; </span><a href="#loc_272_24_272_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_272_24_272_32&#39;)"><span class="hl_varref"><span class="mpre">original</span></span></a><span class="mpre">
    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_275_10_275_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_275_10_275_15&#39;)"><span class="hl_vardecl"><span class="mpre">pvers</span></span></a><span class="mpre">  -&gt; </span><a href="#loc_146_1_146_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_1_146_15&#39;)"><span class="hl_varref"><span class="mpre">mkPackageIndex</span></span></a><span class="mpre">
                     (</span><a href="Data.List.html#loc_993_1_993_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_993_1_993_7&#39;)"><span class="hl_varref"><span class="mpre">foldl&#39;</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">flip</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Map.delete</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre">)) </span><a href="#loc_272_47_272_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_272_47_272_51&#39;)"><span class="hl_varref"><span class="mpre">pids</span></span></a><span class="mpre">
                             (</span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Map.elems</span></span><span class="mpre"> </span><a href="#loc_275_10_275_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_275_10_275_15&#39;)"><span class="hl_varref"><span class="mpre">pvers</span></span></a><span class="mpre">)))
                     (</span><span class="hl_varref"><span class="mpre">Map.delete</span></span><span class="mpre"> </span><a href="#loc_272_19_272_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_272_19_272_23&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre"> </span><a href="#loc_272_52_272_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_272_52_272_58&#39;)"><span class="hl_varref"><span class="mpre">pnames</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">{-
-- | Removes all packages satisfying this dependency from the index.
--
deleteDependency :: Dependency -&gt; PackageIndex -&gt; PackageIndex
deleteDependency (Dependency name verstionRange) =
  delete&#39; name (\pkg -&gt; packageVersion pkg `withinRange` verstionRange)
-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Bulk queries</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Get all the packages from the index.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_295_1_295_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_295_1_295_12&#39;)"><span class="mpre">allPackages</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">]
</span><a name="loc_295_1_295_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_295_1_295_12&#39;)"><span class="hl_fundecl"><span class="mpre">allPackages</span></span></a><span class="mpre"> (</span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> </span><a name="loc_295_27_295_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_295_27_295_31&#39;)"><span class="hl_vardecl"><span class="mpre">pids</span></span></a><span class="mpre"> _) = </span><span class="hl_varref"><span class="mpre">Map.elems</span></span><span class="mpre"> </span><a href="#loc_295_27_295_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_295_27_295_31&#39;)"><span class="hl_varref"><span class="mpre">pids</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Get all the packages from the index.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- They are grouped by package name (case-sensitively).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_302_1_302_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_1_302_18&#39;)"><span class="mpre">allPackagesByName</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; [(</span><a href="Distribution.Package.html#loc_80_9_80_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_80_9_80_20&#39;)"><span class="hl_tyconref"><span class="mpre">PackageName</span></span></a><span class="mpre">, [</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">])]
</span><a name="loc_302_1_302_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_1_302_18&#39;)"><span class="hl_fundecl"><span class="mpre">allPackagesByName</span></span></a><span class="mpre"> (</span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> _ </span><a name="loc_302_35_302_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_35_302_41&#39;)"><span class="hl_vardecl"><span class="mpre">pnames</span></span></a><span class="mpre">) =
  [ (</span><a href="#loc_304_6_304_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_6_304_13&#39;)"><span class="hl_varref"><span class="mpre">pkgname</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Map.elems</span></span><span class="mpre"> </span><a href="#loc_304_15_304_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_15_304_20&#39;)"><span class="hl_varref"><span class="mpre">pvers</span></span></a><span class="mpre">))
  | (</span><a name="loc_304_6_304_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_6_304_13&#39;)"><span class="hl_vardecl"><span class="mpre">pkgname</span></span></a><span class="mpre">, </span><a name="loc_304_15_304_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_15_304_20&#39;)"><span class="hl_vardecl"><span class="mpre">pvers</span></span></a><span class="mpre">) &lt;- </span><span class="hl_varref"><span class="mpre">Map.toList</span></span><span class="mpre"> </span><a href="#loc_302_35_302_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_35_302_41&#39;)"><span class="hl_varref"><span class="mpre">pnames</span></span></a><span class="mpre"> ]

</span><span class="hl_comment"><span class="mpre">-- | Get all the packages from the index.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- They are grouped by source package id (package name and version).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_311_1_311_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_1_311_29&#39;)"><span class="mpre">allPackagesBySourcePackageId</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; [(</span><span class="hl_tyconref"><span class="mpre">PackageId</span></span><span class="mpre">, [</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">])]
</span><a name="loc_311_1_311_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_1_311_29&#39;)"><span class="hl_fundecl"><span class="mpre">allPackagesBySourcePackageId</span></span></a><span class="mpre"> (</span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> _ </span><a name="loc_311_46_311_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_46_311_52&#39;)"><span class="hl_vardecl"><span class="mpre">pnames</span></span></a><span class="mpre">) =
  [ (</span><a href="Distribution.Package.html#loc_184_3_184_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_184_3_184_12&#39;)"><span class="hl_varref"><span class="mpre">packageId</span></span></a><span class="mpre"> </span><a href="#loc_314_12_314_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_314_12_314_16&#39;)"><span class="hl_varref"><span class="mpre">ipkg</span></span></a><span class="mpre">, </span><a href="#loc_314_5_314_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_314_5_314_10&#39;)"><span class="hl_varref"><span class="mpre">ipkgs</span></span></a><span class="mpre">)
  | </span><a name="loc_313_5_313_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_5_313_10&#39;)"><span class="hl_vardecl"><span class="mpre">pvers</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">Map.elems</span></span><span class="mpre"> </span><a href="#loc_311_46_311_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_46_311_52&#39;)"><span class="hl_varref"><span class="mpre">pnames</span></span></a><span class="mpre">
  , </span><a name="loc_314_5_314_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_314_5_314_10&#39;)"><span class="hl_specname"><span class="mpre">ipkgs</span></span></a><span class="mpre">@(</span><a name="loc_314_12_314_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_314_12_314_16&#39;)"><span class="hl_vardecl"><span class="mpre">ipkg</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_) &lt;- </span><span class="hl_varref"><span class="mpre">Map.elems</span></span><span class="mpre"> </span><a href="#loc_313_5_313_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_5_313_10&#39;)"><span class="hl_varref"><span class="mpre">pvers</span></span></a><span class="mpre"> ]

</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Lookups</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Does a lookup by source package id (name &amp; version).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Since multiple package DBs mask each other by &#39;InstalledPackageId&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- then we get back at most one package.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_327_1_327_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_1_327_25&#39;)"><span class="mpre">lookupInstalledPackageId</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; </span><a href="Distribution.Package.html#loc_130_9_130_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_130_9_130_27&#39;)"><span class="hl_tyconref"><span class="mpre">InstalledPackageId</span></span></a><span class="mpre">
                         -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">
</span><a name="loc_327_1_327_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_1_327_25&#39;)"><span class="hl_fundecl"><span class="mpre">lookupInstalledPackageId</span></span></a><span class="mpre"> (</span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> </span><a name="loc_327_40_327_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_40_327_44&#39;)"><span class="hl_vardecl"><span class="mpre">pids</span></span></a><span class="mpre"> _) </span><a name="loc_327_48_327_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_48_327_51&#39;)"><span class="hl_vardecl"><span class="mpre">pid</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">Map.lookup</span></span><span class="mpre"> </span><a href="#loc_327_48_327_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_48_327_51&#39;)"><span class="hl_varref"><span class="mpre">pid</span></span></a><span class="mpre"> </span><a href="#loc_327_40_327_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_40_327_44&#39;)"><span class="hl_varref"><span class="mpre">pids</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | Does a lookup by source package id (name &amp; version).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- There can be multiple installed packages with the same source &#39;PackageId&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- but different &#39;InstalledPackageId&#39;. They are returned in order of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- preference, with the most preferred first.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_337_1_337_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_337_1_337_22&#39;)"><span class="mpre">lookupSourcePackageId</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">PackageId</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">]
</span><a name="loc_337_1_337_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_337_1_337_22&#39;)"><span class="hl_fundecl"><span class="mpre">lookupSourcePackageId</span></span></a><span class="mpre"> (</span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> _ </span><a name="loc_337_39_337_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_337_39_337_45&#39;)"><span class="hl_vardecl"><span class="mpre">pnames</span></span></a><span class="mpre">) </span><a name="loc_337_47_337_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_337_47_337_52&#39;)"><span class="hl_vardecl"><span class="mpre">pkgid</span></span></a><span class="mpre"> =
  case </span><span class="hl_varref"><span class="mpre">Map.lookup</span></span><span class="mpre"> (</span><a href="Distribution.Package.html#loc_187_1_187_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_187_1_187_12&#39;)"><span class="hl_varref"><span class="mpre">packageName</span></span></a><span class="mpre"> </span><a href="#loc_337_47_337_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_337_47_337_52&#39;)"><span class="hl_varref"><span class="mpre">pkgid</span></span></a><span class="mpre">) </span><a href="#loc_337_39_337_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_337_39_337_45&#39;)"><span class="hl_varref"><span class="mpre">pnames</span></span></a><span class="mpre"> of
    </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">     -&gt; []
    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_340_10_340_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_340_10_340_15&#39;)"><span class="hl_vardecl"><span class="mpre">pvers</span></span></a><span class="mpre">  -&gt; case </span><span class="hl_varref"><span class="mpre">Map.lookup</span></span><span class="mpre"> (</span><a href="Distribution.Package.html#loc_190_1_190_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_190_1_190_15&#39;)"><span class="hl_varref"><span class="mpre">packageVersion</span></span></a><span class="mpre"> </span><a href="#loc_337_47_337_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_337_47_337_52&#39;)"><span class="hl_varref"><span class="mpre">pkgid</span></span></a><span class="mpre">) </span><a href="#loc_340_10_340_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_340_10_340_15&#39;)"><span class="hl_varref"><span class="mpre">pvers</span></span></a><span class="mpre"> of
      </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">   -&gt; []
      </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_342_12_342_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_12_342_16&#39;)"><span class="hl_vardecl"><span class="mpre">pkgs</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_342_12_342_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_12_342_16&#39;)"><span class="hl_varref"><span class="mpre">pkgs</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- in preference order</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | Does a lookup by source package name.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_349_1_349_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_1_349_18&#39;)"><span class="mpre">lookupPackageName</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; </span><a href="Distribution.Package.html#loc_80_9_80_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_80_9_80_20&#39;)"><span class="hl_tyconref"><span class="mpre">PackageName</span></span></a><span class="mpre">
                  -&gt; [(</span><a href="Data.Version.html#loc_68_6_68_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Version.html#loc_68_6_68_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre">, [</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">])]
</span><a name="loc_349_1_349_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_1_349_18&#39;)"><span class="hl_fundecl"><span class="mpre">lookupPackageName</span></span></a><span class="mpre"> (</span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> _ </span><a name="loc_349_35_349_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_35_349_41&#39;)"><span class="hl_vardecl"><span class="mpre">pnames</span></span></a><span class="mpre">) </span><a name="loc_349_43_349_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_43_349_47&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre"> =
  case </span><span class="hl_varref"><span class="mpre">Map.lookup</span></span><span class="mpre"> </span><a href="#loc_349_43_349_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_43_349_47&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre"> </span><a href="#loc_349_35_349_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_35_349_41&#39;)"><span class="hl_varref"><span class="mpre">pnames</span></span></a><span class="mpre"> of
    </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">     -&gt; []
    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_352_10_352_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_10_352_15&#39;)"><span class="hl_vardecl"><span class="mpre">pvers</span></span></a><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">Map.toList</span></span><span class="mpre"> </span><a href="#loc_352_10_352_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_10_352_15&#39;)"><span class="hl_varref"><span class="mpre">pvers</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | Does a lookup by source package name and a range of versions.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- We get back any number of versions of the specified package name, all</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- satisfying the version range constraint.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_362_1_362_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_362_1_362_17&#39;)"><span class="mpre">lookupDependency</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; </span><a href="Distribution.Package.html#loc_145_6_145_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_145_6_145_16&#39;)"><span class="hl_tyconref"><span class="mpre">Dependency</span></span></a><span class="mpre">
                 -&gt; [(</span><a href="Data.Version.html#loc_68_6_68_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Version.html#loc_68_6_68_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre">, [</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">])]
</span><a name="loc_362_1_362_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_362_1_362_17&#39;)"><span class="hl_fundecl"><span class="mpre">lookupDependency</span></span></a><span class="mpre"> (</span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> _ </span><a name="loc_362_34_362_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_362_34_362_40&#39;)"><span class="hl_vardecl"><span class="mpre">pnames</span></span></a><span class="mpre">) (</span><a href="Distribution.Package.html#loc_145_19_145_29" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_145_19_145_29&#39;)"><span class="hl_conref"><span class="mpre">Dependency</span></span></a><span class="mpre"> </span><a name="loc_362_54_362_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_362_54_362_58&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre"> </span><a name="loc_362_59_362_71" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_362_59_362_71&#39;)"><span class="hl_vardecl"><span class="mpre">versionRange</span></span></a><span class="mpre">) =
  case </span><span class="hl_varref"><span class="mpre">Map.lookup</span></span><span class="mpre"> </span><a href="#loc_362_54_362_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_362_54_362_58&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre"> </span><a href="#loc_362_34_362_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_362_34_362_40&#39;)"><span class="hl_varref"><span class="mpre">pnames</span></span></a><span class="mpre"> of
    </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">    -&gt; []
    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_365_10_365_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_365_10_365_15&#39;)"><span class="hl_vardecl"><span class="mpre">pvers</span></span></a><span class="mpre"> -&gt; [ </span><a href="#loc_366_21_366_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_366_21_366_26&#39;)"><span class="hl_varref"><span class="mpre">entry</span></span></a><span class="mpre">
                  | </span><a name="loc_366_21_366_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_366_21_366_26&#39;)"><span class="hl_specname"><span class="mpre">entry</span></span></a><span class="mpre">@(</span><a name="loc_366_28_366_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_366_28_366_31&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre">, _) &lt;- </span><span class="hl_varref"><span class="mpre">Map.toList</span></span><span class="mpre"> </span><a href="#loc_365_10_365_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_365_10_365_15&#39;)"><span class="hl_varref"><span class="mpre">pvers</span></span></a><span class="mpre">
                  , </span><a href="#loc_366_28_366_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_366_28_366_31&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="Distribution.Version.html#loc_317_1_317_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Version.html#loc_317_1_317_12&#39;)"><span class="hl_infix"><span class="mpre">`withinRange`</span></span></a><span class="mpre"> </span><a href="#loc_362_59_362_71" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_362_59_362_71&#39;)"><span class="hl_varref"><span class="mpre">versionRange</span></span></a><span class="mpre"> ]

</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Case insensitive name lookups</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Does a case-insensitive search by package name.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If there is only one package that compares case-insentiviely to this name</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- then the search is unambiguous and we get back all versions of that package.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If several match case-insentiviely but one matches exactly then it is also</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- unambiguous.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If however several match case-insentiviely and none match exactly then we</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- have an ambiguous result, and we get back all the versions of all the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- packages. The list of ambiguous results is split by exact package name. So</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- it is a non-empty list of non-empty lists.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_386_1_386_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_1_386_13&#39;)"><span class="mpre">searchByName</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="#loc_396_6_396_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_6_396_18&#39;)"><span class="hl_tyconref"><span class="mpre">SearchResult</span></span></a><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">]
</span><a name="loc_386_1_386_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_1_386_13&#39;)"><span class="hl_fundecl"><span class="mpre">searchByName</span></span></a><span class="mpre"> (</span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> _ </span><a name="loc_386_30_386_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_30_386_36&#39;)"><span class="hl_vardecl"><span class="mpre">pnames</span></span></a><span class="mpre">) </span><a name="loc_386_38_386_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_38_386_42&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre"> =
  case [ </span><a href="#loc_387_17_387_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_17_387_21&#39;)"><span class="hl_varref"><span class="mpre">pkgs</span></span></a><span class="mpre"> | </span><a name="loc_387_17_387_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_17_387_21&#39;)"><span class="hl_specname"><span class="mpre">pkgs</span></span></a><span class="mpre">@(</span><a href="Distribution.Package.html#loc_80_23_80_34" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_80_23_80_34&#39;)"><span class="hl_conref"><span class="mpre">PackageName</span></span></a><span class="mpre"> </span><a name="loc_387_35_387_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_35_387_40&#39;)"><span class="hl_vardecl"><span class="mpre">name&#39;</span></span></a><span class="mpre">,_) &lt;- </span><span class="hl_varref"><span class="mpre">Map.toList</span></span><span class="mpre"> </span><a href="#loc_386_30_386_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_30_386_36&#39;)"><span class="hl_varref"><span class="mpre">pnames</span></span></a><span class="mpre">
              , </span><a href="Distribution.Simple.Utils.html#loc_1283_1_1283_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Utils.html#loc_1283_1_1283_10&#39;)"><span class="hl_varref"><span class="mpre">lowercase</span></span></a><span class="mpre"> </span><a href="#loc_387_35_387_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_35_387_40&#39;)"><span class="hl_varref"><span class="mpre">name&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_394_9_394_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_394_9_394_14&#39;)"><span class="hl_varref"><span class="mpre">lname</span></span></a><span class="mpre"> ] of
    []               -&gt; </span><a href="#loc_396_23_396_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_23_396_27&#39;)"><span class="hl_conref"><span class="mpre">None</span></span></a><span class="mpre">
    [(_,</span><a name="loc_390_9_390_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_390_9_390_14&#39;)"><span class="hl_vardecl"><span class="mpre">pvers</span></span></a><span class="mpre">)]      -&gt; </span><a href="#loc_396_30_396_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_30_396_41&#39;)"><span class="hl_conref"><span class="mpre">Unambiguous</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Map.elems</span></span><span class="mpre"> </span><a href="#loc_390_9_390_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_390_9_390_14&#39;)"><span class="hl_varref"><span class="mpre">pvers</span></span></a><span class="mpre">))
    </span><a name="loc_391_5_391_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_5_391_10&#39;)"><span class="hl_vardecl"><span class="mpre">pkgss</span></span></a><span class="mpre">            -&gt; case </span><a href="Data.List.html#loc_261_1_261_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_261_1_261_5&#39;)"><span class="hl_varref"><span class="mpre">find</span></span></a><span class="mpre"> ((</span><a href="Distribution.Package.html#loc_80_23_80_34" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_80_23_80_34&#39;)"><span class="hl_conref"><span class="mpre">PackageName</span></span></a><span class="mpre"> </span><a href="#loc_386_38_386_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_38_386_42&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.Tuple.html#loc_48_1_48_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Tuple.html#loc_48_1_48_4&#39;)"><span class="hl_varref"><span class="mpre">fst</span></span></a><span class="mpre">) </span><a href="#loc_391_5_391_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_5_391_10&#39;)"><span class="hl_varref"><span class="mpre">pkgss</span></span></a><span class="mpre"> of
      </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (_,</span><a name="loc_392_15_392_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_392_15_392_20&#39;)"><span class="hl_vardecl"><span class="mpre">pvers</span></span></a><span class="mpre">) -&gt; </span><a href="#loc_396_30_396_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_30_396_41&#39;)"><span class="hl_conref"><span class="mpre">Unambiguous</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Map.elems</span></span><span class="mpre"> </span><a href="#loc_392_15_392_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_392_15_392_20&#39;)"><span class="hl_varref"><span class="mpre">pvers</span></span></a><span class="mpre">))
      </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">        -&gt; </span><a href="#loc_396_46_396_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_46_396_55&#39;)"><span class="hl_conref"><span class="mpre">Ambiguous</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">Map.elems</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.Tuple.html#loc_52_1_52_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Tuple.html#loc_52_1_52_4&#39;)"><span class="hl_varref"><span class="mpre">snd</span></span></a><span class="mpre">) </span><a href="#loc_391_5_391_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_5_391_10&#39;)"><span class="hl_varref"><span class="mpre">pkgss</span></span></a><span class="mpre">)
  where </span><a name="loc_394_9_394_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_394_9_394_14&#39;)"><span class="hl_vardecl"><span class="mpre">lname</span></span></a><span class="mpre"> = </span><a href="Distribution.Simple.Utils.html#loc_1283_1_1283_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Utils.html#loc_1283_1_1283_10&#39;)"><span class="hl_varref"><span class="mpre">lowercase</span></span></a><span class="mpre"> </span><a href="#loc_386_38_386_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_38_386_42&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre">

data </span><a name="loc_396_6_396_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_6_396_18&#39;)"><span class="hl_tycondecl"><span class="mpre">SearchResult</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_396_23_396_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_23_396_27&#39;)"><span class="hl_condecl"><span class="mpre">None</span></span></a><span class="mpre"> | </span><a name="loc_396_30_396_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_30_396_41&#39;)"><span class="hl_condecl"><span class="mpre">Unambiguous</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> | </span><a name="loc_396_46_396_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_46_396_55&#39;)"><span class="hl_condecl"><span class="mpre">Ambiguous</span></span></a><span class="mpre"> [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">]

</span><span class="hl_comment"><span class="mpre">-- | Does a case-insensitive substring search by package name.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- That is, all packages that contain the given string in their name.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_403_1_403_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_1_403_22&#39;)"><span class="mpre">searchByNameSubstring</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">]
</span><a name="loc_403_1_403_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_1_403_22&#39;)"><span class="hl_fundecl"><span class="mpre">searchByNameSubstring</span></span></a><span class="mpre"> (</span><a href="#loc_94_21_94_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_33&#39;)"><span class="hl_conref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> _ </span><a name="loc_403_39_403_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_39_403_45&#39;)"><span class="hl_vardecl"><span class="mpre">pnames</span></span></a><span class="mpre">) </span><a name="loc_403_47_403_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_47_403_57&#39;)"><span class="hl_vardecl"><span class="mpre">searchterm</span></span></a><span class="mpre"> =
  [ </span><a href="#loc_408_5_408_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_408_5_408_8&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">
  | (</span><a href="Distribution.Package.html#loc_80_23_80_34" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_80_23_80_34&#39;)"><span class="hl_conref"><span class="mpre">PackageName</span></span></a><span class="mpre"> </span><a name="loc_405_18_405_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_18_405_22&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre">, </span><a name="loc_405_24_405_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_24_405_29&#39;)"><span class="hl_vardecl"><span class="mpre">pvers</span></span></a><span class="mpre">) &lt;- </span><span class="hl_varref"><span class="mpre">Map.toList</span></span><span class="mpre"> </span><a href="#loc_403_39_403_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_39_403_45&#39;)"><span class="hl_varref"><span class="mpre">pnames</span></span></a><span class="mpre">
  , </span><a href="#loc_409_9_409_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_409_9_409_20&#39;)"><span class="hl_varref"><span class="mpre">lsearchterm</span></span></a><span class="mpre"> </span><a href="Data.List.html#loc_305_1_305_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_305_1_305_10&#39;)"><span class="hl_infix"><span class="mpre">`isInfixOf`</span></span></a><span class="mpre"> </span><a href="Distribution.Simple.Utils.html#loc_1283_1_1283_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Utils.html#loc_1283_1_1283_10&#39;)"><span class="hl_varref"><span class="mpre">lowercase</span></span></a><span class="mpre"> </span><a href="#loc_405_18_405_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_18_405_22&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre">
  , </span><a name="loc_407_5_407_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_407_5_407_9&#39;)"><span class="hl_vardecl"><span class="mpre">pkgs</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">Map.elems</span></span><span class="mpre"> </span><a href="#loc_405_24_405_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_24_405_29&#39;)"><span class="hl_varref"><span class="mpre">pvers</span></span></a><span class="mpre">
  , </span><a name="loc_408_5_408_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_408_5_408_8&#39;)"><span class="hl_vardecl"><span class="mpre">pkg</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_407_5_407_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_407_5_407_9&#39;)"><span class="hl_varref"><span class="mpre">pkgs</span></span></a><span class="mpre"> ]
  where </span><a name="loc_409_9_409_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_409_9_409_20&#39;)"><span class="hl_vardecl"><span class="mpre">lsearchterm</span></span></a><span class="mpre"> = </span><a href="Distribution.Simple.Utils.html#loc_1283_1_1283_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Utils.html#loc_1283_1_1283_10&#39;)"><span class="hl_varref"><span class="mpre">lowercase</span></span></a><span class="mpre"> </span><a href="#loc_403_47_403_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_47_403_57&#39;)"><span class="hl_varref"><span class="mpre">searchterm</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Special queries</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- None of the stuff below depends on the internal representation of the index.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Find if there are any cycles in the dependency graph. If there are no</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- cycles the result is @[]@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This actually computes the strongly connected components. So it gives us a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- list of groups of packages where within each group they all depend on each</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- other, directly or indirectly.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_427_1_427_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_427_1_427_17&#39;)"><span class="mpre">dependencyCycles</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; [[</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">]]
</span><a name="loc_427_1_427_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_427_1_427_17&#39;)"><span class="hl_fundecl"><span class="mpre">dependencyCycles</span></span></a><span class="mpre"> </span><a name="loc_427_18_427_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_427_18_427_23&#39;)"><span class="hl_vardecl"><span class="mpre">index</span></span></a><span class="mpre"> =
  [ </span><a href="#loc_428_26_428_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_26_428_28&#39;)"><span class="hl_varref"><span class="mpre">vs</span></span></a><span class="mpre"> | </span><a href="Data.Graph.html#loc_90_19_90_28" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Graph.html#loc_90_19_90_28&#39;)"><span class="hl_conref"><span class="mpre">Graph.CyclicSCC</span></span></a><span class="mpre"> </span><a name="loc_428_26_428_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_26_428_28&#39;)"><span class="hl_vardecl"><span class="mpre">vs</span></span></a><span class="mpre"> &lt;- </span><a href="Data.Graph.html#loc_121_1_121_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Graph.html#loc_121_1_121_17&#39;)"><span class="hl_varref"><span class="mpre">Graph.stronglyConnComp</span></span></a><span class="mpre"> </span><a href="#loc_430_5_430_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_430_5_430_18&#39;)"><span class="hl_varref"><span class="mpre">adjacencyList</span></span></a><span class="mpre"> ]
  where
    </span><a name="loc_430_5_430_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_430_5_430_18&#39;)"><span class="hl_vardecl"><span class="mpre">adjacencyList</span></span></a><span class="mpre"> = [ (</span><a href="#loc_431_23_431_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_23_431_26&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">, </span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre"> </span><a href="#loc_431_23_431_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_23_431_26&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">, </span><a href="Distribution.InstalledPackageInfo.html#loc_119_9_119_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_119_9_119_16&#39;)"><span class="hl_varref"><span class="mpre">IPI.depends</span></span></a><span class="mpre"> </span><a href="#loc_431_23_431_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_23_431_26&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">)
                    | </span><a name="loc_431_23_431_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_23_431_26&#39;)"><span class="hl_vardecl"><span class="mpre">pkg</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_295_1_295_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_295_1_295_12&#39;)"><span class="hl_varref"><span class="mpre">allPackages</span></span></a><span class="mpre"> </span><a href="#loc_427_18_427_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_427_18_427_23&#39;)"><span class="hl_varref"><span class="mpre">index</span></span></a><span class="mpre"> ]


</span><span class="hl_comment"><span class="mpre">-- | All packages that have immediate dependencies that are not in the index.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Returns such packages along with the dependencies that they&#39;re missing.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_439_1_439_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_1_439_15&#39;)"><span class="mpre">brokenPackages</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; [(</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">, [</span><a href="Distribution.Package.html#loc_130_9_130_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_130_9_130_27&#39;)"><span class="hl_tyconref"><span class="mpre">InstalledPackageId</span></span></a><span class="mpre">])]
</span><a name="loc_439_1_439_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_1_439_15&#39;)"><span class="hl_fundecl"><span class="mpre">brokenPackages</span></span></a><span class="mpre"> </span><a name="loc_439_16_439_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_16_439_21&#39;)"><span class="hl_vardecl"><span class="mpre">index</span></span></a><span class="mpre"> =
  [ (</span><a href="#loc_441_5_441_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_441_5_441_8&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">, </span><a href="#loc_442_9_442_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_442_9_442_16&#39;)"><span class="hl_varref"><span class="mpre">missing</span></span></a><span class="mpre">)
  | </span><a name="loc_441_5_441_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_441_5_441_8&#39;)"><span class="hl_vardecl"><span class="mpre">pkg</span></span></a><span class="mpre">  &lt;- </span><a href="#loc_295_1_295_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_295_1_295_12&#39;)"><span class="hl_varref"><span class="mpre">allPackages</span></span></a><span class="mpre"> </span><a href="#loc_439_16_439_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_16_439_21&#39;)"><span class="hl_varref"><span class="mpre">index</span></span></a><span class="mpre">
  , let </span><a name="loc_442_9_442_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_442_9_442_16&#39;)"><span class="hl_vardecl"><span class="mpre">missing</span></span></a><span class="mpre"> = [ </span><a href="#loc_442_28_442_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_442_28_442_32&#39;)"><span class="hl_varref"><span class="mpre">pkg&#39;</span></span></a><span class="mpre"> | </span><a name="loc_442_28_442_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_442_28_442_32&#39;)"><span class="hl_vardecl"><span class="mpre">pkg&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="Distribution.InstalledPackageInfo.html#loc_119_9_119_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_119_9_119_16&#39;)"><span class="hl_varref"><span class="mpre">IPI.depends</span></span></a><span class="mpre"> </span><a href="#loc_441_5_441_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_441_5_441_8&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">
                         , </span><a href="Data.Maybe.html#loc_85_1_85_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_85_1_85_10&#39;)"><span class="hl_varref"><span class="mpre">isNothing</span></span></a><span class="mpre"> (</span><a href="#loc_327_1_327_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_1_327_25&#39;)"><span class="hl_varref"><span class="mpre">lookupInstalledPackageId</span></span></a><span class="mpre"> </span><a href="#loc_439_16_439_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_16_439_21&#39;)"><span class="hl_varref"><span class="mpre">index</span></span></a><span class="mpre"> </span><a href="#loc_442_28_442_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_442_28_442_32&#39;)"><span class="hl_varref"><span class="mpre">pkg&#39;</span></span></a><span class="mpre">) ]
  , </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_442_9_442_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_442_9_442_16&#39;)"><span class="hl_varref"><span class="mpre">missing</span></span></a><span class="mpre">) ]


</span><span class="hl_comment"><span class="mpre">-- | Tries to take the transitive closure of the package dependencies.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If the transitive closure is complete then it returns that subset of the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- index. Otherwise it returns the broken packages as in &#39;brokenPackages&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Note that if the result is @Right []@ it is because at least one of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the original given &#39;PackageId&#39;s do not occur in the index.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_459_1_459_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_459_1_459_18&#39;)"><span class="mpre">dependencyClosure</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre">
                  -&gt; [</span><a href="Distribution.Package.html#loc_130_9_130_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_130_9_130_27&#39;)"><span class="hl_tyconref"><span class="mpre">InstalledPackageId</span></span></a><span class="mpre">]
                  -&gt; </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre">
                            [(</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">, [</span><a href="Distribution.Package.html#loc_130_9_130_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_130_9_130_27&#39;)"><span class="hl_tyconref"><span class="mpre">InstalledPackageId</span></span></a><span class="mpre">])]
</span><a name="loc_459_1_459_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_459_1_459_18&#39;)"><span class="hl_fundecl"><span class="mpre">dependencyClosure</span></span></a><span class="mpre"> </span><a name="loc_459_19_459_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_459_19_459_24&#39;)"><span class="hl_vardecl"><span class="mpre">index</span></span></a><span class="mpre"> </span><a name="loc_459_25_459_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_459_25_459_32&#39;)"><span class="hl_vardecl"><span class="mpre">pkgids0</span></span></a><span class="mpre"> = case </span><a href="#loc_463_5_463_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_5_463_12&#39;)"><span class="hl_varref"><span class="mpre">closure</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre"> [] </span><a href="#loc_459_25_459_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_459_25_459_32&#39;)"><span class="hl_varref"><span class="mpre">pkgids0</span></span></a><span class="mpre"> of
  (</span><a name="loc_460_4_460_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_460_4_460_13&#39;)"><span class="hl_vardecl"><span class="mpre">completed</span></span></a><span class="mpre">, []) -&gt; </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_460_4_460_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_460_4_460_13&#39;)"><span class="hl_varref"><span class="mpre">completed</span></span></a><span class="mpre">
  (</span><a name="loc_461_4_461_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_461_4_461_13&#39;)"><span class="hl_vardecl"><span class="mpre">completed</span></span></a><span class="mpre">, _)  -&gt; </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="#loc_439_1_439_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_1_439_15&#39;)"><span class="hl_varref"><span class="mpre">brokenPackages</span></span></a><span class="mpre"> </span><a href="#loc_461_4_461_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_461_4_461_13&#39;)"><span class="hl_varref"><span class="mpre">completed</span></span></a><span class="mpre">)
 where
    </span><a name="loc_463_5_463_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_5_463_12&#39;)"><span class="hl_fundecl"><span class="mpre">closure</span></span></a><span class="mpre"> </span><a name="loc_463_13_463_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_13_463_22&#39;)"><span class="hl_vardecl"><span class="mpre">completed</span></span></a><span class="mpre"> </span><a name="loc_463_23_463_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_23_463_29&#39;)"><span class="hl_vardecl"><span class="mpre">failed</span></span></a><span class="mpre"> []             = (</span><a href="#loc_463_13_463_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_13_463_22&#39;)"><span class="hl_varref"><span class="mpre">completed</span></span></a><span class="mpre">, </span><a href="#loc_463_23_463_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_23_463_29&#39;)"><span class="hl_varref"><span class="mpre">failed</span></span></a><span class="mpre">)
    </span><a href="#loc_463_5_463_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_5_463_12&#39;)"><span class="hl_fundecl"><span class="mpre">closure</span></span></a><span class="mpre"> </span><a name="loc_464_13_464_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_13_464_22&#39;)"><span class="hl_vardecl"><span class="mpre">completed</span></span></a><span class="mpre"> </span><a name="loc_464_23_464_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_23_464_29&#39;)"><span class="hl_vardecl"><span class="mpre">failed</span></span></a><span class="mpre"> (</span><a name="loc_464_31_464_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_31_464_36&#39;)"><span class="hl_vardecl"><span class="mpre">pkgid</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_464_37_464_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_37_464_43&#39;)"><span class="hl_vardecl"><span class="mpre">pkgids</span></span></a><span class="mpre">) = case </span><a href="#loc_327_1_327_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_1_327_25&#39;)"><span class="hl_varref"><span class="mpre">lookupInstalledPackageId</span></span></a><span class="mpre"> </span><a href="#loc_459_19_459_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_459_19_459_24&#39;)"><span class="hl_varref"><span class="mpre">index</span></span></a><span class="mpre"> </span><a href="#loc_464_31_464_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_31_464_36&#39;)"><span class="hl_varref"><span class="mpre">pkgid</span></span></a><span class="mpre"> of
      </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">   -&gt; </span><a href="#loc_463_5_463_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_5_463_12&#39;)"><span class="hl_varref"><span class="mpre">closure</span></span></a><span class="mpre"> </span><a href="#loc_464_13_464_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_13_464_22&#39;)"><span class="hl_varref"><span class="mpre">completed</span></span></a><span class="mpre"> (</span><a href="#loc_464_31_464_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_31_464_36&#39;)"><span class="hl_varref"><span class="mpre">pkgid</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_464_23_464_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_23_464_29&#39;)"><span class="hl_varref"><span class="mpre">failed</span></span></a><span class="mpre">) </span><a href="#loc_464_37_464_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_37_464_43&#39;)"><span class="hl_varref"><span class="mpre">pkgids</span></span></a><span class="mpre">
      </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_466_12_466_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_466_12_466_15&#39;)"><span class="hl_vardecl"><span class="mpre">pkg</span></span></a><span class="mpre">  -&gt; case </span><a href="#loc_327_1_327_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_1_327_25&#39;)"><span class="hl_varref"><span class="mpre">lookupInstalledPackageId</span></span></a><span class="mpre"> </span><a href="#loc_464_13_464_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_13_464_22&#39;)"><span class="hl_varref"><span class="mpre">completed</span></span></a><span class="mpre"> (</span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre"> </span><a href="#loc_466_12_466_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_466_12_466_15&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">) of
        </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> _  -&gt; </span><a href="#loc_463_5_463_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_5_463_12&#39;)"><span class="hl_varref"><span class="mpre">closure</span></span></a><span class="mpre"> </span><a href="#loc_464_13_464_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_13_464_22&#39;)"><span class="hl_varref"><span class="mpre">completed</span></span></a><span class="mpre">  </span><a href="#loc_464_23_464_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_23_464_29&#39;)"><span class="hl_varref"><span class="mpre">failed</span></span></a><span class="mpre"> </span><a href="#loc_464_37_464_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_37_464_43&#39;)"><span class="hl_varref"><span class="mpre">pkgids</span></span></a><span class="mpre">
        </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_463_5_463_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_5_463_12&#39;)"><span class="hl_varref"><span class="mpre">closure</span></span></a><span class="mpre"> </span><a href="#loc_469_17_469_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_469_17_469_27&#39;)"><span class="hl_varref"><span class="mpre">completed&#39;</span></span></a><span class="mpre"> </span><a href="#loc_464_23_464_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_23_464_29&#39;)"><span class="hl_varref"><span class="mpre">failed</span></span></a><span class="mpre"> </span><a href="#loc_470_17_470_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_17_470_24&#39;)"><span class="hl_varref"><span class="mpre">pkgids&#39;</span></span></a><span class="mpre">
          where </span><a name="loc_469_17_469_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_469_17_469_27&#39;)"><span class="hl_vardecl"><span class="mpre">completed&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_208_1_208_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_1_208_7&#39;)"><span class="hl_varref"><span class="mpre">insert</span></span></a><span class="mpre"> </span><a href="#loc_466_12_466_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_466_12_466_15&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre"> </span><a href="#loc_464_13_464_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_13_464_22&#39;)"><span class="hl_varref"><span class="mpre">completed</span></span></a><span class="mpre">
                </span><a name="loc_470_17_470_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_17_470_24&#39;)"><span class="hl_vardecl"><span class="mpre">pkgids&#39;</span></span></a><span class="mpre">    = </span><a href="Distribution.InstalledPackageInfo.html#loc_119_9_119_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_119_9_119_16&#39;)"><span class="hl_varref"><span class="mpre">IPI.depends</span></span></a><span class="mpre"> </span><a href="#loc_466_12_466_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_466_12_466_15&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_464_37_464_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_37_464_43&#39;)"><span class="hl_varref"><span class="mpre">pkgids</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Takes the transitive closure of the packages reverse dependencies.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * The given &#39;PackageId&#39;s must be in the index.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_479_1_479_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_479_1_479_25&#39;)"><span class="mpre">reverseDependencyClosure</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre">
                         -&gt; [</span><a href="Distribution.Package.html#loc_130_9_130_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_130_9_130_27&#39;)"><span class="hl_tyconref"><span class="mpre">InstalledPackageId</span></span></a><span class="mpre">]
                         -&gt; [</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">]
</span><a name="loc_479_1_479_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_479_1_479_25&#39;)"><span class="hl_fundecl"><span class="mpre">reverseDependencyClosure</span></span></a><span class="mpre"> </span><a name="loc_479_26_479_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_479_26_479_31&#39;)"><span class="hl_vardecl"><span class="mpre">index</span></span></a><span class="mpre"> =
    </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_486_16_486_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_486_16_486_27&#39;)"><span class="hl_varref"><span class="mpre">vertexToPkg</span></span></a><span class="mpre">
  </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">concatMap</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">Tree.flatten</span></span><span class="mpre">
  </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.Graph.html#loc_264_1_264_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Graph.html#loc_264_1_264_4&#39;)"><span class="hl_varref"><span class="mpre">Graph.dfs</span></span></a><span class="mpre"> </span><a href="#loc_487_5_487_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_487_5_487_20&#39;)"><span class="hl_varref"><span class="mpre">reverseDepGraph</span></span></a><span class="mpre">
  </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="hl_varref"><span class="mpre">fromMaybe</span></span></a><span class="mpre"> </span><a href="#loc_488_5_488_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_488_5_488_16&#39;)"><span class="hl_varref"><span class="mpre">noSuchPkgId</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_486_29_486_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_486_29_486_42&#39;)"><span class="hl_varref"><span class="mpre">pkgIdToVertex</span></span></a><span class="mpre">)

  where
    (</span><a name="loc_486_6_486_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_486_6_486_14&#39;)"><span class="hl_vardecl"><span class="mpre">depGraph</span></span></a><span class="mpre">, </span><a name="loc_486_16_486_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_486_16_486_27&#39;)"><span class="hl_vardecl"><span class="mpre">vertexToPkg</span></span></a><span class="mpre">, </span><a name="loc_486_29_486_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_486_29_486_42&#39;)"><span class="hl_vardecl"><span class="mpre">pkgIdToVertex</span></span></a><span class="mpre">) = </span><a href="#loc_512_1_512_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_1_512_16&#39;)"><span class="hl_varref"><span class="mpre">dependencyGraph</span></span></a><span class="mpre"> </span><a href="#loc_479_26_479_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_479_26_479_31&#39;)"><span class="hl_varref"><span class="mpre">index</span></span></a><span class="mpre">
    </span><a name="loc_487_5_487_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_487_5_487_20&#39;)"><span class="hl_vardecl"><span class="mpre">reverseDepGraph</span></span></a><span class="mpre"> = </span><a href="Data.Graph.html#loc_190_1_190_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Graph.html#loc_190_1_190_11&#39;)"><span class="hl_varref"><span class="mpre">Graph.transposeG</span></span></a><span class="mpre"> </span><a href="#loc_486_6_486_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_486_6_486_14&#39;)"><span class="hl_varref"><span class="mpre">depGraph</span></span></a><span class="mpre">
    </span><a name="loc_488_5_488_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_488_5_488_16&#39;)"><span class="hl_vardecl"><span class="mpre">noSuchPkgId</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;reverseDependencyClosure: package is not in the graph&quot;</span></span><span class="mpre">

</span><a href="#loc_491_1_491_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_491_1_491_17&#39;)"><span class="mpre">topologicalOrder</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">]
</span><a name="loc_491_1_491_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_491_1_491_17&#39;)"><span class="hl_fundecl"><span class="mpre">topologicalOrder</span></span></a><span class="mpre"> </span><a name="loc_491_18_491_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_491_18_491_23&#39;)"><span class="hl_vardecl"><span class="mpre">index</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_494_17_494_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_17_494_24&#39;)"><span class="hl_varref"><span class="mpre">toPkgId</span></span></a><span class="mpre">
                       </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.Graph.html#loc_393_1_393_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Graph.html#loc_393_1_393_8&#39;)"><span class="hl_varref"><span class="mpre">Graph.topSort</span></span></a><span class="mpre">
                       </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_494_10_494_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_10_494_15&#39;)"><span class="hl_varref"><span class="mpre">graph</span></span></a><span class="mpre">
  where (</span><a name="loc_494_10_494_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_10_494_15&#39;)"><span class="hl_vardecl"><span class="mpre">graph</span></span></a><span class="mpre">, </span><a name="loc_494_17_494_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_17_494_24&#39;)"><span class="hl_vardecl"><span class="mpre">toPkgId</span></span></a><span class="mpre">, _) = </span><a href="#loc_512_1_512_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_1_512_16&#39;)"><span class="hl_varref"><span class="mpre">dependencyGraph</span></span></a><span class="mpre"> </span><a href="#loc_491_18_491_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_491_18_491_23&#39;)"><span class="hl_varref"><span class="mpre">index</span></span></a><span class="mpre">

</span><a href="#loc_497_1_497_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_497_1_497_24&#39;)"><span class="mpre">reverseTopologicalOrder</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">]
</span><a name="loc_497_1_497_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_497_1_497_24&#39;)"><span class="hl_fundecl"><span class="mpre">reverseTopologicalOrder</span></span></a><span class="mpre"> </span><a name="loc_497_25_497_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_497_25_497_30&#39;)"><span class="hl_vardecl"><span class="mpre">index</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_501_17_501_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_501_17_501_24&#39;)"><span class="hl_varref"><span class="mpre">toPkgId</span></span></a><span class="mpre">
                              </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.Graph.html#loc_393_1_393_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Graph.html#loc_393_1_393_8&#39;)"><span class="hl_varref"><span class="mpre">Graph.topSort</span></span></a><span class="mpre">
                              </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.Graph.html#loc_190_1_190_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Graph.html#loc_190_1_190_11&#39;)"><span class="hl_varref"><span class="mpre">Graph.transposeG</span></span></a><span class="mpre">
                              </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_501_10_501_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_501_10_501_15&#39;)"><span class="hl_varref"><span class="mpre">graph</span></span></a><span class="mpre">
  where (</span><a name="loc_501_10_501_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_501_10_501_15&#39;)"><span class="hl_vardecl"><span class="mpre">graph</span></span></a><span class="mpre">, </span><a name="loc_501_17_501_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_501_17_501_24&#39;)"><span class="hl_vardecl"><span class="mpre">toPkgId</span></span></a><span class="mpre">, _) = </span><a href="#loc_512_1_512_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_1_512_16&#39;)"><span class="hl_varref"><span class="mpre">dependencyGraph</span></span></a><span class="mpre"> </span><a href="#loc_497_25_497_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_497_25_497_30&#39;)"><span class="hl_varref"><span class="mpre">index</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Builds a graph of the package dependencies.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Dependencies on other packages that are not in the index are discarded.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- You can check if there are any such dependencies with &#39;brokenPackages&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_512_1_512_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_1_512_16&#39;)"><span class="mpre">dependencyGraph</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre">
                -&gt; (</span><span class="hl_tyconref"><span class="mpre">Graph.Graph</span></span><span class="mpre">,
                    </span><span class="hl_tyconref"><span class="mpre">Graph.Vertex</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">,
                    </span><a href="Distribution.Package.html#loc_130_9_130_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_130_9_130_27&#39;)"><span class="hl_tyconref"><span class="mpre">InstalledPackageId</span></span></a><span class="mpre"> -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Graph.Vertex</span></span><span class="mpre">)
</span><a name="loc_512_1_512_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_1_512_16&#39;)"><span class="hl_fundecl"><span class="mpre">dependencyGraph</span></span></a><span class="mpre"> </span><a name="loc_512_17_512_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_17_512_22&#39;)"><span class="hl_vardecl"><span class="mpre">index</span></span></a><span class="mpre"> = (</span><a href="#loc_514_5_514_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_514_5_514_10&#39;)"><span class="hl_varref"><span class="mpre">graph</span></span></a><span class="mpre">, </span><a href="#loc_523_5_523_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_523_5_523_18&#39;)"><span class="hl_varref"><span class="mpre">vertex_to_pkg</span></span></a><span class="mpre">, </span><a href="#loc_521_5_521_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_521_5_521_17&#39;)"><span class="hl_varref"><span class="mpre">id_to_vertex</span></span></a><span class="mpre">)
  where
    </span><a name="loc_514_5_514_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_514_5_514_10&#39;)"><span class="hl_vardecl"><span class="mpre">graph</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">Array.listArray</span></span><span class="mpre"> </span><a href="#loc_527_5_527_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_527_5_527_11&#39;)"><span class="hl_varref"><span class="mpre">bounds</span></span></a><span class="mpre">
              [ [ </span><a href="#loc_515_28_515_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_515_28_515_29&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre"> | </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_515_28_515_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_515_28_515_29&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_521_5_521_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_521_5_521_17&#39;)"><span class="hl_varref"><span class="mpre">id_to_vertex</span></span></a><span class="mpre"> (</span><a href="Distribution.InstalledPackageInfo.html#loc_119_9_119_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_119_9_119_16&#39;)"><span class="hl_varref"><span class="mpre">IPI.depends</span></span></a><span class="mpre"> </span><a href="#loc_516_17_516_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_516_17_516_20&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">) ]
              | </span><a name="loc_516_17_516_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_516_17_516_20&#39;)"><span class="hl_vardecl"><span class="mpre">pkg</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_518_5_518_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_518_5_518_9&#39;)"><span class="hl_varref"><span class="mpre">pkgs</span></span></a><span class="mpre"> ]

    </span><a name="loc_518_5_518_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_518_5_518_9&#39;)"><span class="hl_vardecl"><span class="mpre">pkgs</span></span></a><span class="mpre">             = </span><a href="Data.List.html#loc_810_1_810_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_810_1_810_7&#39;)"><span class="hl_varref"><span class="mpre">sortBy</span></span></a><span class="mpre"> (</span><a href="Distribution.Simple.Utils.html#loc_1277_1_1277_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Utils.html#loc_1277_1_1277_10&#39;)"><span class="hl_varref"><span class="mpre">comparing</span></span></a><span class="mpre"> </span><a href="Distribution.Package.html#loc_184_3_184_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_184_3_184_12&#39;)"><span class="hl_varref"><span class="mpre">packageId</span></span></a><span class="mpre">) (</span><a href="#loc_295_1_295_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_295_1_295_12&#39;)"><span class="hl_varref"><span class="mpre">allPackages</span></span></a><span class="mpre"> </span><a href="#loc_512_17_512_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_17_512_22&#39;)"><span class="hl_varref"><span class="mpre">index</span></span></a><span class="mpre">)
    </span><a name="loc_519_5_519_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_519_5_519_13&#39;)"><span class="hl_vardecl"><span class="mpre">vertices</span></span></a><span class="mpre">         = </span><span class="hl_varref"><span class="mpre">zip</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre"> </span><a href="#loc_518_5_518_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_518_5_518_9&#39;)"><span class="hl_varref"><span class="mpre">pkgs</span></span></a><span class="mpre">) </span><span class="warning" data-warning="ExpEnumFrom (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/Cabal-1.18.1.3/Distribution/Simple/PackageIndex.hs&quot;, srcSpanStartLine = 519, srcSpanStartColumn = 58, srcSpanEndLine = 519, srcSpanEndColumn = 63}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/Cabal-1.18.1.3/Distribution/Simple/PackageIndex.hs&quot;, srcSpanStartLine = 519, srcSpanStartColumn = 58, srcSpanEndLine = 519, srcSpanEndColumn = 59},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/Cabal-1.18.1.3/Dist"><span class="mpre">[0..]</span></span><span class="mpre">
    </span><a name="loc_520_5_520_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_520_5_520_15&#39;)"><span class="hl_vardecl"><span class="mpre">vertex_map</span></span></a><span class="mpre">       = </span><span class="hl_varref"><span class="mpre">Map.fromList</span></span><span class="mpre"> </span><a href="#loc_519_5_519_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_519_5_519_13&#39;)"><span class="hl_varref"><span class="mpre">vertices</span></span></a><span class="mpre">
    </span><a name="loc_521_5_521_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_521_5_521_17&#39;)"><span class="hl_fundecl"><span class="mpre">id_to_vertex</span></span></a><span class="mpre"> </span><a name="loc_521_18_521_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_521_18_521_21&#39;)"><span class="hl_vardecl"><span class="mpre">pid</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">Map.lookup</span></span><span class="mpre"> </span><a href="#loc_521_18_521_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_521_18_521_21&#39;)"><span class="hl_varref"><span class="mpre">pid</span></span></a><span class="mpre"> </span><a href="#loc_520_5_520_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_520_5_520_15&#39;)"><span class="hl_varref"><span class="mpre">vertex_map</span></span></a><span class="mpre">

    </span><a name="loc_523_5_523_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_523_5_523_18&#39;)"><span class="hl_fundecl"><span class="mpre">vertex_to_pkg</span></span></a><span class="mpre"> </span><a name="loc_523_19_523_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_523_19_523_25&#39;)"><span class="hl_vardecl"><span class="mpre">vertex</span></span></a><span class="mpre"> = </span><a href="#loc_525_5_525_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_525_5_525_13&#39;)"><span class="hl_varref"><span class="mpre">pkgTable</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="#loc_523_19_523_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_523_19_523_25&#39;)"><span class="hl_varref"><span class="mpre">vertex</span></span></a><span class="mpre">

    </span><a name="loc_525_5_525_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_525_5_525_13&#39;)"><span class="hl_vardecl"><span class="mpre">pkgTable</span></span></a><span class="mpre">   = </span><span class="hl_varref"><span class="mpre">Array.listArray</span></span><span class="mpre"> </span><a href="#loc_527_5_527_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_527_5_527_11&#39;)"><span class="hl_varref"><span class="mpre">bounds</span></span></a><span class="mpre"> </span><a href="#loc_518_5_518_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_518_5_518_9&#39;)"><span class="hl_varref"><span class="mpre">pkgs</span></span></a><span class="mpre">
    </span><a name="loc_526_5_526_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_526_5_526_13&#39;)"><span class="hl_vardecl"><span class="mpre">topBound</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">length</span></span><span class="mpre"> </span><a href="#loc_518_5_518_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_518_5_518_9&#39;)"><span class="hl_varref"><span class="mpre">pkgs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
    </span><a name="loc_527_5_527_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_527_5_527_11&#39;)"><span class="hl_vardecl"><span class="mpre">bounds</span></span></a><span class="mpre"> = (</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">, </span><a href="#loc_526_5_526_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_526_5_526_13&#39;)"><span class="hl_varref"><span class="mpre">topBound</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Given a package index where we assume we want to use all the packages</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (use &#39;dependencyClosure&#39; if you need to get such a index subset) find out</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- if the dependencies within it use consistent versions of each package.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Return all cases where multiple packages depend on different versions of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- some other package.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Each element in the result is a package name along with the packages that</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- depend on it and the versions they require. These are guaranteed to be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- distinct.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_541_1_541_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_541_1_541_26&#39;)"><span class="mpre">dependencyInconsistencies</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre">
                          -&gt; [(</span><a href="Distribution.Package.html#loc_80_9_80_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_80_9_80_20&#39;)"><span class="hl_tyconref"><span class="mpre">PackageName</span></span></a><span class="mpre">, [(</span><span class="hl_tyconref"><span class="mpre">PackageId</span></span><span class="mpre">, </span><a href="Data.Version.html#loc_68_6_68_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Version.html#loc_68_6_68_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre">)])]
</span><a name="loc_541_1_541_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_541_1_541_26&#39;)"><span class="hl_fundecl"><span class="mpre">dependencyInconsistencies</span></span></a><span class="mpre"> </span><a name="loc_541_27_541_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_541_27_541_32&#39;)"><span class="hl_vardecl"><span class="mpre">index</span></span></a><span class="mpre"> =
  [ (</span><a href="#loc_543_6_543_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_6_543_10&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre">, [ (</span><a href="#loc_542_61_542_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_542_61_542_64&#39;)"><span class="hl_varref"><span class="mpre">pid</span></span></a><span class="mpre">,</span><a href="Distribution.Package.html#loc_190_1_190_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_190_1_190_15&#39;)"><span class="hl_varref"><span class="mpre">packageVersion</span></span></a><span class="mpre"> </span><a href="#loc_542_42_542_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_542_42_542_45&#39;)"><span class="hl_varref"><span class="mpre">dep</span></span></a><span class="mpre">) | (</span><a name="loc_542_42_542_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_542_42_542_45&#39;)"><span class="hl_vardecl"><span class="mpre">dep</span></span></a><span class="mpre">,</span><a name="loc_542_46_542_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_542_46_542_50&#39;)"><span class="hl_vardecl"><span class="mpre">pids</span></span></a><span class="mpre">) &lt;- </span><a href="#loc_544_9_544_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_9_544_13&#39;)"><span class="hl_varref"><span class="mpre">uses</span></span></a><span class="mpre">, </span><a name="loc_542_61_542_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_542_61_542_64&#39;)"><span class="hl_vardecl"><span class="mpre">pid</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_542_46_542_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_542_46_542_50&#39;)"><span class="hl_varref"><span class="mpre">pids</span></span></a><span class="mpre">])
  | (</span><a name="loc_543_6_543_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_6_543_10&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre">, </span><a name="loc_543_12_543_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_12_543_20&#39;)"><span class="hl_vardecl"><span class="mpre">ipid_map</span></span></a><span class="mpre">) &lt;- </span><span class="hl_varref"><span class="mpre">Map.toList</span></span><span class="mpre"> </span><a href="#loc_554_9_554_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_554_9_554_21&#39;)"><span class="hl_varref"><span class="mpre">inverseIndex</span></span></a><span class="mpre">
  , let </span><a name="loc_544_9_544_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_9_544_13&#39;)"><span class="hl_vardecl"><span class="mpre">uses</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">Map.elems</span></span><span class="mpre"> </span><a href="#loc_543_12_543_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_12_543_20&#39;)"><span class="hl_varref"><span class="mpre">ipid_map</span></span></a><span class="mpre">
  , </span><a href="#loc_563_9_563_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_563_9_563_29&#39;)"><span class="hl_varref"><span class="mpre">reallyIsInconsistent</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="Data.Tuple.html#loc_48_1_48_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Tuple.html#loc_48_1_48_4&#39;)"><span class="hl_varref"><span class="mpre">fst</span></span></a><span class="mpre"> </span><a href="#loc_544_9_544_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_9_544_13&#39;)"><span class="hl_varref"><span class="mpre">uses</span></span></a><span class="mpre">) ]

  where </span><span class="hl_comment"><span class="mpre">-- for each PackageName,</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--   for each package with that name,</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--     the InstalledPackageInfo and the package Ids of packages</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--     that depend on it.</span></span><span class="mpre">
        </span><a href="#loc_554_9_554_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_554_9_554_21&#39;)"><span class="mpre">inverseIndex</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Map</span></span><span class="mpre"> </span><a href="Distribution.Package.html#loc_80_9_80_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_80_9_80_20&#39;)"><span class="hl_tyconref"><span class="mpre">PackageName</span></span></a><span class="mpre">
                            (</span><span class="hl_tyconref"><span class="mpre">Map</span></span><span class="mpre"> </span><a href="Distribution.Package.html#loc_130_9_130_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_130_9_130_27&#39;)"><span class="hl_tyconref"><span class="mpre">InstalledPackageId</span></span></a><span class="mpre">
                                 (</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">, [</span><span class="hl_tyconref"><span class="mpre">PackageId</span></span><span class="mpre">]))
        </span><a name="loc_554_9_554_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_554_9_554_21&#39;)"><span class="hl_vardecl"><span class="mpre">inverseIndex</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">Map.fromListWith</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Map.unionWith</span></span><span class="mpre"> (\(</span><a name="loc_554_59_554_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_554_59_554_60&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">,</span><a name="loc_554_61_554_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_554_61_554_62&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">) (_,</span><a name="loc_554_67_554_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_554_67_554_69&#39;)"><span class="hl_vardecl"><span class="mpre">b&#39;</span></span></a><span class="mpre">) -&gt; (</span><a href="#loc_554_59_554_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_554_59_554_60&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">,</span><a href="#loc_554_61_554_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_554_61_554_62&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="hl_infix"><span class="mpre">++</span></span><a href="#loc_554_67_554_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_554_67_554_69&#39;)"><span class="hl_varref"><span class="mpre">b&#39;</span></span></a><span class="mpre">)))
          [ (</span><a href="Distribution.Package.html#loc_187_1_187_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_187_1_187_12&#39;)"><span class="hl_varref"><span class="mpre">packageName</span></span></a><span class="mpre"> </span><a href="#loc_559_18_559_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_559_18_559_21&#39;)"><span class="hl_varref"><span class="mpre">dep</span></span></a><span class="mpre">,
             </span><span class="hl_varref"><span class="mpre">Map.fromList</span></span><span class="mpre"> [(</span><a href="#loc_558_13_558_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_558_13_558_17&#39;)"><span class="hl_varref"><span class="mpre">ipid</span></span></a><span class="mpre">,(</span><a href="#loc_559_18_559_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_559_18_559_21&#39;)"><span class="hl_varref"><span class="mpre">dep</span></span></a><span class="mpre">,[</span><a href="Distribution.Package.html#loc_184_3_184_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Package.html#loc_184_3_184_12&#39;)"><span class="hl_varref"><span class="mpre">packageId</span></span></a><span class="mpre"> </span><a href="#loc_557_13_557_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_557_13_557_16&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">]))])
          | </span><a name="loc_557_13_557_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_557_13_557_16&#39;)"><span class="hl_vardecl"><span class="mpre">pkg</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_295_1_295_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_295_1_295_12&#39;)"><span class="hl_varref"><span class="mpre">allPackages</span></span></a><span class="mpre"> </span><a href="#loc_541_27_541_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_541_27_541_32&#39;)"><span class="hl_varref"><span class="mpre">index</span></span></a><span class="mpre">
          , </span><a name="loc_558_13_558_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_558_13_558_17&#39;)"><span class="hl_vardecl"><span class="mpre">ipid</span></span></a><span class="mpre"> &lt;- </span><a href="Distribution.InstalledPackageInfo.html#loc_119_9_119_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_119_9_119_16&#39;)"><span class="hl_varref"><span class="mpre">IPI.depends</span></span></a><span class="mpre"> </span><a href="#loc_557_13_557_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_557_13_557_16&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">
          , </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_559_18_559_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_559_18_559_21&#39;)"><span class="hl_vardecl"><span class="mpre">dep</span></span></a><span class="mpre"> &lt;- [</span><a href="#loc_327_1_327_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_1_327_25&#39;)"><span class="hl_varref"><span class="mpre">lookupInstalledPackageId</span></span></a><span class="mpre"> </span><a href="#loc_541_27_541_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_541_27_541_32&#39;)"><span class="hl_varref"><span class="mpre">index</span></span></a><span class="mpre"> </span><a href="#loc_558_13_558_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_558_13_558_17&#39;)"><span class="hl_varref"><span class="mpre">ipid</span></span></a><span class="mpre">]
          ]

        </span><a href="#loc_563_9_563_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_563_9_563_29&#39;)"><span class="mpre">reallyIsInconsistent</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
        </span><a name="loc_563_9_563_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_563_9_563_29&#39;)"><span class="hl_fundecl"><span class="mpre">reallyIsInconsistent</span></span></a><span class="mpre"> []       = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
        </span><a href="#loc_563_9_563_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_563_9_563_29&#39;)"><span class="hl_fundecl"><span class="mpre">reallyIsInconsistent</span></span></a><span class="mpre"> [</span><span class="hl_vardecl"><span class="mpre">_p</span></span><span class="mpre">]     = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
        </span><a href="#loc_563_9_563_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_563_9_563_29&#39;)"><span class="hl_fundecl"><span class="mpre">reallyIsInconsistent</span></span></a><span class="mpre"> [</span><a name="loc_565_31_565_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_565_31_565_33&#39;)"><span class="hl_vardecl"><span class="mpre">p1</span></span></a><span class="mpre">, </span><a name="loc_565_35_565_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_565_35_565_37&#39;)"><span class="hl_vardecl"><span class="mpre">p2</span></span></a><span class="mpre">] =
             </span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre"> </span><a href="#loc_565_31_565_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_565_31_565_33&#39;)"><span class="hl_varref"><span class="mpre">p1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`notElem`</span></span><span class="mpre"> </span><a href="Distribution.InstalledPackageInfo.html#loc_119_9_119_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_119_9_119_16&#39;)"><span class="hl_varref"><span class="mpre">IPI.depends</span></span></a><span class="mpre"> </span><a href="#loc_565_35_565_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_565_35_565_37&#39;)"><span class="hl_varref"><span class="mpre">p2</span></span></a><span class="mpre">
          </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="Distribution.InstalledPackageInfo.html#loc_95_9_95_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_95_9_95_27&#39;)"><span class="hl_varref"><span class="mpre">installedPackageId</span></span></a><span class="mpre"> </span><a href="#loc_565_35_565_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_565_35_565_37&#39;)"><span class="hl_varref"><span class="mpre">p2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`notElem`</span></span><span class="mpre"> </span><a href="Distribution.InstalledPackageInfo.html#loc_119_9_119_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_119_9_119_16&#39;)"><span class="hl_varref"><span class="mpre">IPI.depends</span></span></a><span class="mpre"> </span><a href="#loc_565_31_565_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_565_31_565_33&#39;)"><span class="hl_varref"><span class="mpre">p1</span></span></a><span class="mpre">
        </span><a href="#loc_563_9_563_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_563_9_563_29&#39;)"><span class="hl_fundecl"><span class="mpre">reallyIsInconsistent</span></span></a><span class="mpre"> _ = </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">


</span><a href="#loc_572_1_572_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_572_1_572_16&#39;)"><span class="mpre">moduleNameIndex</span></a><span class="mpre"> :: </span><a href="#loc_94_6_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_18&#39;)"><span class="hl_tyconref"><span class="mpre">PackageIndex</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Map</span></span><span class="mpre"> </span><a href="Distribution.ModuleName.html#loc_67_9_67_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.ModuleName.html#loc_67_9_67_19&#39;)"><span class="hl_tyconref"><span class="mpre">ModuleName</span></span></a><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">InstalledPackageInfo</span></span><span class="mpre">]
</span><a name="loc_572_1_572_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_572_1_572_16&#39;)"><span class="hl_fundecl"><span class="mpre">moduleNameIndex</span></span></a><span class="mpre"> </span><a name="loc_572_17_572_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_572_17_572_22&#39;)"><span class="hl_vardecl"><span class="mpre">index</span></span></a><span class="mpre"> =
  </span><span class="hl_varref"><span class="mpre">Map.fromListWith</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">(++)</span></span><span class="mpre">
    [ (</span><a href="#loc_576_7_576_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_576_7_576_17&#39;)"><span class="hl_varref"><span class="mpre">moduleName</span></span></a><span class="mpre">, [</span><a href="#loc_575_7_575_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_575_7_575_10&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre">])
    | </span><a name="loc_575_7_575_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_575_7_575_10&#39;)"><span class="hl_vardecl"><span class="mpre">pkg</span></span></a><span class="mpre">        &lt;- </span><a href="#loc_295_1_295_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_295_1_295_12&#39;)"><span class="hl_varref"><span class="mpre">allPackages</span></span></a><span class="mpre"> </span><a href="#loc_572_17_572_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_572_17_572_22&#39;)"><span class="hl_varref"><span class="mpre">index</span></span></a><span class="mpre">
    , </span><a name="loc_576_7_576_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_576_7_576_17&#39;)"><span class="hl_vardecl"><span class="mpre">moduleName</span></span></a><span class="mpre"> &lt;- </span><a href="Distribution.InstalledPackageInfo.html#loc_109_9_109_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.InstalledPackageInfo.html#loc_109_9_109_23&#39;)"><span class="hl_varref"><span class="mpre">IPI.exposedModules</span></span></a><span class="mpre"> </span><a href="#loc_575_7_575_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_575_7_575_10&#39;)"><span class="hl_varref"><span class="mpre">pkg</span></span></a><span class="mpre"> ]
</span></div></body></html>