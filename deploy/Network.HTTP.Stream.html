<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Network.HTTP.Stream</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  See LICENSE file</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  Ganesh Sittampalam &lt;ganesh@earth.li&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (not tested)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Transmitting HTTP requests and responses holding @String@ in their payload bodies.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This is one of the implementation modules for the &quot;Network.HTTP&quot; interface, representing</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- request and response content as @String@s and transmitting them in non-packed form</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (cf. &quot;Network.HTTP.HandleStream&quot; and its use of @ByteString@s.) over &#39;Stream&#39; handles.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- It is mostly here for backwards compatibility, representing how requests and responses</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- were transmitted up until the 4.x releases of the HTTP package.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- For more detailed information about what the individual exports do, please consult</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the documentation for &quot;Network.HTTP&quot;. /Notice/ however that the functions here do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- not perform any kind of normalization prior to transmission (or receipt); you are</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- responsible for doing any such yourself, or, if you prefer, just switch to using</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;Network.HTTP&quot; function instead.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
module Network.HTTP.Stream 
       ( module Network.Stream

       , simpleHTTP      </span><span class="hl_comment"><span class="mpre">-- :: Request_String -&gt; IO (Result Response_String)</span></span><span class="mpre">
       , simpleHTTP_     </span><span class="hl_comment"><span class="mpre">-- :: Stream s =&gt; s -&gt; Request_String -&gt; IO (Result Response_String)</span></span><span class="mpre">
       , sendHTTP        </span><span class="hl_comment"><span class="mpre">-- :: Stream s =&gt; s -&gt; Request_String -&gt; IO (Result Response_String)</span></span><span class="mpre">
       , sendHTTP_notify </span><span class="hl_comment"><span class="mpre">-- :: Stream s =&gt; s -&gt; Request_String -&gt; IO () -&gt; IO (Result Response_String)</span></span><span class="mpre">
       , receiveHTTP     </span><span class="hl_comment"><span class="mpre">-- :: Stream s =&gt; s -&gt; IO (Result Request_String)</span></span><span class="mpre">
       , respondHTTP     </span><span class="hl_comment"><span class="mpre">-- :: Stream s =&gt; s -&gt; Response_String -&gt; IO ()</span></span><span class="mpre">
       
       ) where

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------ Imports --------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------</span></span><span class="mpre">

import Network.Stream
import Network.StreamDebugger (</span><a href="Network.StreamDebugger.html#loc_66_1_66_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.StreamDebugger.html#loc_66_1_66_12&#39;)"><span class="mpre">debugStream</span></a><span class="mpre">)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 43, srcSpanStartColumn = 8, srcSpanEndLine = 43, srcSpanEndColumn = 19}, srcInfoPoints = []}) &quot;Network.TCP&quot;"><span class="mpre">Network.TCP</span></span><span class="mpre"> (openTCPPort)
import Network.BufferType ( </span><a href="Network.BufferType.html#loc_146_1_146_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_146_1_146_15&#39;)"><span class="mpre">stringBufferOp</span></a><span class="mpre"> )

import Network.HTTP.Base
import Network.HTTP.Headers
import Network.HTTP.Utils ( </span><a href="Network.HTTP.Utils.html#loc_58_1_58_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Utils.html#loc_58_1_58_5&#39;)"><span class="mpre">trim</span></a><span class="mpre"> )

import Data.Char     (</span><a href="GHC.Unicode.html#loc_143_1_143_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_143_1_143_8&#39;)"><span class="mpre">toLower</span></a><span class="mpre">)
import Data.Maybe    (</span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="mpre">fromMaybe</span></a><span class="mpre">)
import Control.Exception (</span><a href="Control.Exception.Base.html#loc_229_1_229_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_229_1_229_12&#39;)"><span class="mpre">onException</span></a><span class="mpre">)
import Control.Monad (</span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">-- Turn on to enable HTTP traffic logging</span></span><span class="mpre">
</span><a href="#loc_58_1_58_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_6&#39;)"><span class="mpre">debug</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_58_1_58_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_6&#39;)"><span class="hl_vardecl"><span class="mpre">debug</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- File that HTTP traffic logs go to</span></span><span class="mpre">
</span><a href="#loc_62_1_62_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_12&#39;)"><span class="mpre">httpLogFile</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_62_1_62_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_12&#39;)"><span class="hl_vardecl"><span class="mpre">httpLogFile</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;http-debug.log&quot;</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------ Misc -----------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | Simple way to transmit a resource across a non-persistent connection.</span></span><span class="mpre">
</span><a href="#loc_71_1_71_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_11&#39;)"><span class="mpre">simpleHTTP</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Request_String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Response_String</span></span><span class="mpre">)
</span><a name="loc_71_1_71_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_11&#39;)"><span class="hl_fundecl"><span class="mpre">simpleHTTP</span></span></a><span class="mpre"> </span><a name="loc_71_12_71_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_12_71_13&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = do 
   </span><a name="loc_72_4_72_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_4_72_8&#39;)"><span class="hl_vardecl"><span class="mpre">auth</span></span></a><span class="mpre"> &lt;- </span><a href="Network.HTTP.Base.html#loc_717_1_717_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_717_1_717_8&#39;)"><span class="hl_varref"><span class="mpre">getAuth</span></span></a><span class="mpre"> </span><a href="#loc_71_12_71_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_12_71_13&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
   </span><a name="loc_73_4_73_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_4_73_5&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre">    &lt;- </span><span class="hl_varref"><span class="mpre">openTCPPort</span></span><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_140_36_140_40" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_140_36_140_40&#39;)"><span class="hl_varref"><span class="mpre">host</span></span></a><span class="mpre"> </span><a href="#loc_72_4_72_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_4_72_8&#39;)"><span class="hl_varref"><span class="mpre">auth</span></span></a><span class="mpre">) (</span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="hl_varref"><span class="mpre">fromMaybe</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">80</span></span><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_141_36_141_40" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_141_36_141_40&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre"> </span><a href="#loc_72_4_72_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_4_72_8&#39;)"><span class="hl_varref"><span class="mpre">auth</span></span></a><span class="mpre">))
   </span><a href="#loc_78_1_78_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_12&#39;)"><span class="hl_varref"><span class="mpre">simpleHTTP_</span></span></a><span class="mpre"> </span><a href="#loc_73_4_73_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_4_73_5&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><a href="#loc_71_12_71_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_12_71_13&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Like &#39;simpleHTTP&#39;, but acting on an already opened stream.</span></span><span class="mpre">
</span><a href="#loc_78_1_78_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_12&#39;)"><span class="mpre">simpleHTTP_</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 77, srcSpanStartColumn = 16, srcSpanEndLine = 77, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 77, srcSpanStartColumn = 25, srcSpanEndLine = 77, srcSpanEndColumn = 27}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000."><span class="mpre">Stream s =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Request_String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Response_String</span></span><span class="mpre">)
</span><a name="loc_78_1_78_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_12&#39;)"><span class="hl_fundecl"><span class="mpre">simpleHTTP_</span></span></a><span class="mpre"> </span><a name="loc_78_13_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_13_78_14&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_78_15_78_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_15_78_16&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">
 | </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><a href="#loc_58_1_58_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_6&#39;)"><span class="hl_varref"><span class="mpre">debug</span></span></a><span class="mpre">    = </span><a href="#loc_85_1_85_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_9&#39;)"><span class="hl_varref"><span class="mpre">sendHTTP</span></span></a><span class="mpre"> </span><a href="#loc_78_13_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_13_78_14&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_78_15_78_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_15_78_16&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
 | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">    = do
      </span><a name="loc_81_7_81_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_7_81_9&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="Network.StreamDebugger.html#loc_66_1_66_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.StreamDebugger.html#loc_66_1_66_12&#39;)"><span class="hl_varref"><span class="mpre">debugStream</span></span></a><span class="mpre"> </span><a href="#loc_62_1_62_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_12&#39;)"><span class="hl_varref"><span class="mpre">httpLogFile</span></span></a><span class="mpre"> </span><a href="#loc_78_13_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_13_78_14&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
      </span><a href="#loc_85_1_85_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_9&#39;)"><span class="hl_varref"><span class="mpre">sendHTTP</span></span></a><span class="mpre"> </span><a href="#loc_81_7_81_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_7_81_9&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre"> </span><a href="#loc_78_15_78_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_15_78_16&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

</span><a href="#loc_85_1_85_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_9&#39;)"><span class="mpre">sendHTTP</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 84, srcSpanStartColumn = 13, srcSpanEndLine = 84, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 84, srcSpanStartColumn = 22, srcSpanEndLine = 84, srcSpanEndColumn = 24}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000."><span class="mpre">Stream s =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Request_String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Response_String</span></span><span class="mpre">)
</span><a name="loc_85_1_85_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_9&#39;)"><span class="hl_fundecl"><span class="mpre">sendHTTP</span></span></a><span class="mpre"> </span><a name="loc_85_10_85_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_10_85_14&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_85_15_85_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_15_85_17&#39;)"><span class="hl_vardecl"><span class="mpre">rq</span></span></a><span class="mpre"> = </span><a href="#loc_88_1_88_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_16&#39;)"><span class="hl_varref"><span class="mpre">sendHTTP_notify</span></span></a><span class="mpre"> </span><a href="#loc_85_10_85_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_10_85_14&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_85_15_85_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_15_85_17&#39;)"><span class="hl_varref"><span class="mpre">rq</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)

</span><a href="#loc_88_1_88_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_16&#39;)"><span class="mpre">sendHTTP_notify</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 87, srcSpanStartColumn = 20, srcSpanEndLine = 87, srcSpanEndColumn = 31}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 87, srcSpanStartColumn = 29, srcSpanEndLine = 87, srcSpanEndColumn = 31}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000."><span class="mpre">Stream s =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Request_String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Response_String</span></span><span class="mpre">)
</span><a name="loc_88_1_88_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_16&#39;)"><span class="hl_fundecl"><span class="mpre">sendHTTP_notify</span></span></a><span class="mpre"> </span><a name="loc_88_17_88_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_17_88_21&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_88_22_88_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_22_88_24&#39;)"><span class="hl_vardecl"><span class="mpre">rq</span></span></a><span class="mpre"> </span><a name="loc_88_25_88_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_25_88_39&#39;)"><span class="hl_vardecl"><span class="mpre">onSendComplete</span></span></a><span class="mpre"> = do
   </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_93_3_93_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_3_93_16&#39;)"><span class="hl_varref"><span class="mpre">providedClose</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> (</span><a href="Network.Stream.html#loc_89_5_89_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_89_5_89_15&#39;)"><span class="hl_varref"><span class="mpre">closeOnEnd</span></span></a><span class="mpre"> </span><a href="#loc_88_17_88_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_17_88_21&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">)
   </span><a href="Control.Exception.Base.html#loc_229_1_229_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_229_1_229_12&#39;)"><span class="hl_varref"><span class="mpre">onException</span></span></a><span class="mpre"> (</span><a href="#loc_106_1_106_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_1_106_9&#39;)"><span class="hl_varref"><span class="mpre">sendMain</span></span></a><span class="mpre"> </span><a href="#loc_88_17_88_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_17_88_21&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_88_22_88_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_22_88_24&#39;)"><span class="hl_varref"><span class="mpre">rq</span></span></a><span class="mpre"> </span><a href="#loc_88_25_88_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_25_88_39&#39;)"><span class="hl_varref"><span class="mpre">onSendComplete</span></span></a><span class="mpre">)
               (</span><a href="Network.Stream.html#loc_88_5_88_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_88_5_88_10&#39;)"><span class="hl_varref"><span class="mpre">close</span></span></a><span class="mpre"> </span><a href="#loc_88_17_88_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_17_88_21&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">)
 where
  </span><a name="loc_93_3_93_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_3_93_16&#39;)"><span class="hl_vardecl"><span class="mpre">providedClose</span></span></a><span class="mpre"> = </span><a href="Network.HTTP.Base.html#loc_877_1_877_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_877_1_877_14&#39;)"><span class="hl_varref"><span class="mpre">findConnClose</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_299_16_299_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_299_16_299_25&#39;)"><span class="hl_varref"><span class="mpre">rqHeaders</span></span></a><span class="mpre"> </span><a href="#loc_88_22_88_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_22_88_24&#39;)"><span class="hl_varref"><span class="mpre">rq</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- From RFC 2616, section 8.2.3:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Because of the presence of older implementations, the protocol allows</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ambiguous situations in which a client may send &quot;Expect: 100-</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- continue&quot; without receiving either a 417 (Expectation Failed) status</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- or a 100 (Continue) status. Therefore, when a client sends this</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- header field to an origin server (possibly via a proxy) from which it</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- has never seen a 100 (Continue) status, the client SHOULD NOT wait</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- for an indefinite period before sending the request body.&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Since we would wait forever, I have disabled use of 100-continue for now.</span></span><span class="mpre">
</span><a href="#loc_106_1_106_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_1_106_9&#39;)"><span class="mpre">sendMain</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 105, srcSpanStartColumn = 13, srcSpanEndLine = 105, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 105, srcSpanStartColumn = 22, srcSpanEndLine = 105, srcSpanEndColumn = 24}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4"><span class="mpre">Stream s =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Request_String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Response_String</span></span><span class="mpre">)
</span><a name="loc_106_1_106_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_1_106_9&#39;)"><span class="hl_fundecl"><span class="mpre">sendMain</span></span></a><span class="mpre"> </span><a name="loc_106_10_106_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_10_106_14&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_106_15_106_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_15_106_19&#39;)"><span class="hl_vardecl"><span class="mpre">rqst</span></span></a><span class="mpre"> </span><a name="loc_106_20_106_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_20_106_34&#39;)"><span class="hl_vardecl"><span class="mpre">onSendComplete</span></span></a><span class="mpre"> =  do 
    </span><span class="hl_comment"><span class="mpre">--let str = if null (rqBody rqst)</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">--              then show rqst</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">--              else show (insertHeader HdrExpect &quot;100-continue&quot; rqst)</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- TODO review throwing away of result</span></span><span class="mpre">
   _ &lt;- </span><a href="Network.Stream.html#loc_87_5_87_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_87_5_87_15&#39;)"><span class="hl_varref"><span class="mpre">writeBlock</span></span></a><span class="mpre"> </span><a href="#loc_106_10_106_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_10_106_14&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_106_15_106_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_15_106_19&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">)
    </span><span class="hl_comment"><span class="mpre">-- write body immediately, don&#39;t wait for 100 CONTINUE</span></span><span class="mpre">
   </span><span class="hl_comment"><span class="mpre">-- TODO review throwing away of result</span></span><span class="mpre">
   _ &lt;- </span><a href="Network.Stream.html#loc_87_5_87_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_87_5_87_15&#39;)"><span class="hl_varref"><span class="mpre">writeBlock</span></span></a><span class="mpre"> </span><a href="#loc_106_10_106_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_10_106_14&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_300_16_300_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_300_16_300_22&#39;)"><span class="hl_varref"><span class="mpre">rqBody</span></span></a><span class="mpre"> </span><a href="#loc_106_15_106_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_15_106_19&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">)
   </span><a href="#loc_106_20_106_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_20_106_34&#39;)"><span class="hl_varref"><span class="mpre">onSendComplete</span></span></a><span class="mpre">
   </span><a name="loc_116_4_116_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_4_116_7&#39;)"><span class="hl_vardecl"><span class="mpre">rsp</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_121_1_121_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_1_121_16&#39;)"><span class="hl_varref"><span class="mpre">getResponseHead</span></span></a><span class="mpre"> </span><a href="#loc_106_10_106_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_10_106_14&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
   </span><a href="#loc_135_1_135_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_1_135_15&#39;)"><span class="hl_varref"><span class="mpre">switchResponse</span></span></a><span class="mpre"> </span><a href="#loc_106_10_106_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_10_106_14&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> </span><a href="#loc_116_4_116_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_4_116_7&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre"> </span><a href="#loc_106_15_106_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_15_106_19&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">
        
</span><span class="hl_comment"><span class="mpre">-- reads and parses headers</span></span><span class="mpre">
</span><a href="#loc_121_1_121_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_1_121_16&#39;)"><span class="mpre">getResponseHead</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 120, srcSpanStartColumn = 20, srcSpanEndLine = 120, srcSpanEndColumn = 31}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 120, srcSpanStartColumn = 29, srcSpanEndLine = 120, srcSpanEndColumn = 31}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4"><span class="mpre">Stream s =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ResponseData</span></span><span class="mpre">)
</span><a name="loc_121_1_121_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_1_121_16&#39;)"><span class="hl_fundecl"><span class="mpre">getResponseHead</span></span></a><span class="mpre"> </span><a name="loc_121_17_121_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_17_121_21&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> = do
   </span><a name="loc_122_4_122_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_4_122_7&#39;)"><span class="hl_vardecl"><span class="mpre">lor</span></span></a><span class="mpre"> &lt;- </span><a href="Network.HTTP.Base.html#loc_956_1_956_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_956_1_956_15&#39;)"><span class="hl_varref"><span class="mpre">readTillEmpty1</span></span></a><span class="mpre"> </span><a href="Network.BufferType.html#loc_146_1_146_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_146_1_146_15&#39;)"><span class="hl_varref"><span class="mpre">stringBufferOp</span></span></a><span class="mpre"> (</span><a href="Network.Stream.html#loc_85_5_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_85_5_85_13&#39;)"><span class="hl_varref"><span class="mpre">readLine</span></span></a><span class="mpre"> </span><a href="#loc_121_17_121_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_17_121_21&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">)
   </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_122_4_122_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_4_122_7&#39;)"><span class="hl_varref"><span class="mpre">lor</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Network.HTTP.Base.html#loc_463_1_463_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_463_1_463_18&#39;)"><span class="hl_varref"><span class="mpre">parseResponseHead</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Hmmm, this could go bad if we keep getting &quot;100 Continue&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- responses...  Except this should never happen according</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to the RFC.</span></span><span class="mpre">
</span><a href="#loc_135_1_135_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_1_135_15&#39;)"><span class="mpre">switchResponse</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 128, srcSpanStartColumn = 19, srcSpanEndLine = 129, srcSpanEndColumn = 18}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 129, srcSpanStartColumn = 16, srcSpanEndLine = 129, srcSpanEndColumn = 18}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4"><span class="mpre">Stream s
               =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre">
               -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">{- allow retry? -}</span></span><span class="mpre">
               -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">{- is body sent? -}</span></span><span class="mpre">
               -&gt; </span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ResponseData</span></span><span class="mpre">
               -&gt; </span><span class="hl_tyconref"><span class="mpre">Request_String</span></span><span class="mpre">
               -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Response_String</span></span><span class="mpre">)
</span><a name="loc_135_1_135_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_1_135_15&#39;)"><span class="hl_fundecl"><span class="mpre">switchResponse</span></span></a><span class="mpre"> _ _ _ (</span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_135_28_135_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_28_135_29&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre">) _ = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_135_28_135_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_28_135_29&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">)
        </span><span class="hl_comment"><span class="mpre">-- retry on connreset?</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- if we attempt to use the same socket then there is an excellent</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- chance that the socket is not in a completely closed state.</span></span><span class="mpre">
</span><a href="#loc_135_1_135_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_1_135_15&#39;)"><span class="hl_fundecl"><span class="mpre">switchResponse</span></span></a><span class="mpre"> </span><a name="loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_139_21_139_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_21_139_32&#39;)"><span class="hl_vardecl"><span class="mpre">allow_retry</span></span></a><span class="mpre"> </span><a name="loc_139_33_139_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_33_139_41&#39;)"><span class="hl_vardecl"><span class="mpre">bdy_sent</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a name="loc_139_50_139_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_50_139_52&#39;)"><span class="hl_vardecl"><span class="mpre">cd</span></span></a><span class="mpre">,</span><a name="loc_139_53_139_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_53_139_55&#39;)"><span class="hl_vardecl"><span class="mpre">rn</span></span></a><span class="mpre">,</span><a name="loc_139_56_139_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_56_139_60&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre">)) </span><a name="loc_139_63_139_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_63_139_67&#39;)"><span class="hl_vardecl"><span class="mpre">rqst</span></span></a><span class="mpre"> =
            case </span><a href="Network.HTTP.Base.html#loc_560_1_560_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_560_1_560_14&#39;)"><span class="hl_varref"><span class="mpre">matchResponse</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_298_16_298_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_298_16_298_24&#39;)"><span class="hl_varref"><span class="mpre">rqMethod</span></span></a><span class="mpre"> </span><a href="#loc_139_63_139_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_63_139_67&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">) </span><a href="#loc_139_50_139_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_50_139_52&#39;)"><span class="hl_varref"><span class="mpre">cd</span></span></a><span class="mpre"> of
                </span><a href="Network.HTTP.Base.html#loc_553_4_553_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_553_4_553_12&#39;)"><span class="hl_conref"><span class="mpre">Continue</span></span></a><span class="mpre">
                    | </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><a href="#loc_139_33_139_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_33_139_41&#39;)"><span class="hl_varref"><span class="mpre">bdy_sent</span></span></a><span class="mpre"> -&gt; </span><span class="hl_comment"><span class="mpre">{- Time to send the body -}</span></span><span class="mpre">
                        do { </span><a name="loc_143_30_143_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_30_143_33&#39;)"><span class="hl_vardecl"><span class="mpre">val</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Stream.html#loc_87_5_87_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_87_5_87_15&#39;)"><span class="hl_varref"><span class="mpre">writeBlock</span></span></a><span class="mpre"> </span><a href="#loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_300_16_300_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_300_16_300_22&#39;)"><span class="hl_varref"><span class="mpre">rqBody</span></span></a><span class="mpre"> </span><a href="#loc_139_63_139_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_63_139_67&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">)
                           ; case </span><a href="#loc_143_30_143_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_30_143_33&#39;)"><span class="hl_varref"><span class="mpre">val</span></span></a><span class="mpre"> of
                                </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_145_38_145_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_38_145_39&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_145_38_145_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_38_145_39&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">)
                                </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> _ -&gt;
                                    do { </span><a name="loc_147_42_147_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_42_147_45&#39;)"><span class="hl_vardecl"><span class="mpre">rsp</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_121_1_121_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_1_121_16&#39;)"><span class="hl_varref"><span class="mpre">getResponseHead</span></span></a><span class="mpre"> </span><a href="#loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
                                       ; </span><a href="#loc_135_1_135_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_1_135_15&#39;)"><span class="hl_varref"><span class="mpre">switchResponse</span></span></a><span class="mpre"> </span><a href="#loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_139_21_139_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_21_139_32&#39;)"><span class="hl_varref"><span class="mpre">allow_retry</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> </span><a href="#loc_147_42_147_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_42_147_45&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre"> </span><a href="#loc_139_63_139_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_63_139_67&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">
                                       }
                           }
                    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> -&gt; </span><span class="hl_comment"><span class="mpre">{- keep waiting -}</span></span><span class="mpre">
                        do { </span><a name="loc_152_30_152_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_30_152_33&#39;)"><span class="hl_vardecl"><span class="mpre">rsp</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_121_1_121_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_1_121_16&#39;)"><span class="hl_varref"><span class="mpre">getResponseHead</span></span></a><span class="mpre"> </span><a href="#loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
                           ; </span><a href="#loc_135_1_135_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_1_135_15&#39;)"><span class="hl_varref"><span class="mpre">switchResponse</span></span></a><span class="mpre"> </span><a href="#loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_139_21_139_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_21_139_32&#39;)"><span class="hl_varref"><span class="mpre">allow_retry</span></span></a><span class="mpre"> </span><a href="#loc_139_33_139_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_33_139_41&#39;)"><span class="hl_varref"><span class="mpre">bdy_sent</span></span></a><span class="mpre"> </span><a href="#loc_152_30_152_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_30_152_33&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre"> </span><a href="#loc_139_63_139_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_63_139_67&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">                           
                           }

                </span><a href="Network.HTTP.Base.html#loc_554_4_554_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_554_4_554_9&#39;)"><span class="hl_conref"><span class="mpre">Retry</span></span></a><span class="mpre"> -&gt; </span><span class="hl_comment"><span class="mpre">{- Request with &quot;Expect&quot; header failed.
                                Trouble is the request contains Expects
                                other than &quot;100-Continue&quot; -}</span></span><span class="mpre">
                    do { </span><span class="hl_comment"><span class="mpre">-- TODO review throwing away of result</span></span><span class="mpre">
                         _ &lt;- </span><a href="Network.Stream.html#loc_87_5_87_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_87_5_87_15&#39;)"><span class="hl_varref"><span class="mpre">writeBlock</span></span></a><span class="mpre"> </span><a href="#loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_139_63_139_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_63_139_67&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="Network.HTTP.Base.html#loc_300_16_300_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_300_16_300_22&#39;)"><span class="hl_varref"><span class="mpre">rqBody</span></span></a><span class="mpre"> </span><a href="#loc_139_63_139_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_63_139_67&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">)
                       ; </span><a name="loc_161_26_161_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_26_161_29&#39;)"><span class="hl_vardecl"><span class="mpre">rsp</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_121_1_121_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_1_121_16&#39;)"><span class="hl_varref"><span class="mpre">getResponseHead</span></span></a><span class="mpre"> </span><a href="#loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
                       ; </span><a href="#loc_135_1_135_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_1_135_15&#39;)"><span class="hl_varref"><span class="mpre">switchResponse</span></span></a><span class="mpre"> </span><a href="#loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> </span><a href="#loc_139_33_139_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_33_139_41&#39;)"><span class="hl_varref"><span class="mpre">bdy_sent</span></span></a><span class="mpre"> </span><a href="#loc_161_26_161_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_26_161_29&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre"> </span><a href="#loc_139_63_139_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_63_139_67&#39;)"><span class="hl_varref"><span class="mpre">rqst</span></span></a><span class="mpre">
                       }   
                     
                </span><a href="Network.HTTP.Base.html#loc_555_4_555_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_555_4_555_8&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> -&gt; do
                    </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_877_1_877_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_877_1_877_14&#39;)"><span class="hl_varref"><span class="mpre">findConnClose</span></span></a><span class="mpre"> </span><a href="#loc_139_56_139_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_56_139_60&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">)
                                 (</span><a href="Network.Stream.html#loc_89_5_89_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_89_5_89_15&#39;)"><span class="hl_varref"><span class="mpre">closeOnEnd</span></span></a><span class="mpre"> </span><a href="#loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">)
                    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Response</span></span><span class="mpre"> </span><a href="#loc_139_50_139_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_50_139_52&#39;)"><span class="hl_varref"><span class="mpre">cd</span></span></a><span class="mpre"> </span><a href="#loc_139_53_139_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_53_139_55&#39;)"><span class="hl_varref"><span class="mpre">rn</span></span></a><span class="mpre"> </span><a href="#loc_139_56_139_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_56_139_60&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">)

                </span><a href="Network.HTTP.Base.html#loc_557_4_557_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_557_4_557_15&#39;)"><span class="hl_conref"><span class="mpre">DieHorribly</span></span></a><span class="mpre"> </span><a name="loc_170_29_170_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_29_170_32&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> -&gt; do
                    </span><a href="Network.Stream.html#loc_88_5_88_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_88_5_88_10&#39;)"><span class="hl_varref"><span class="mpre">close</span></span></a><span class="mpre"> </span><a href="#loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
                    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.HTTP.Base.html#loc_994_1_994_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_994_1_994_19&#39;)"><span class="hl_varref"><span class="mpre">responseParseError</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;sendHTTP&quot;</span></span><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;Invalid response: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_170_29_170_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_29_170_32&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">)

                </span><a href="Network.HTTP.Base.html#loc_556_4_556_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_556_4_556_16&#39;)"><span class="hl_conref"><span class="mpre">ExpectEntity</span></span></a><span class="mpre"> -&gt;
                    let </span><a name="loc_175_25_175_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_25_175_27&#39;)"><span class="hl_vardecl"><span class="mpre">tc</span></span></a><span class="mpre"> = </span><a href="Network.HTTP.Headers.html#loc_255_1_255_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Headers.html#loc_255_1_255_13&#39;)"><span class="hl_varref"><span class="mpre">lookupHeader</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Headers.html#loc_80_4_80_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Headers.html#loc_80_4_80_23&#39;)"><span class="hl_conref"><span class="mpre">HdrTransferEncoding</span></span></a><span class="mpre"> </span><a href="#loc_139_56_139_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_56_139_60&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">
                        </span><a name="loc_176_25_176_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_25_176_27&#39;)"><span class="hl_vardecl"><span class="mpre">cl</span></span></a><span class="mpre"> = </span><a href="Network.HTTP.Headers.html#loc_255_1_255_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Headers.html#loc_255_1_255_13&#39;)"><span class="hl_varref"><span class="mpre">lookupHeader</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Headers.html#loc_121_4_121_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Headers.html#loc_121_4_121_20&#39;)"><span class="hl_conref"><span class="mpre">HdrContentLength</span></span></a><span class="mpre"> </span><a href="#loc_139_56_139_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_56_139_60&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">
                    in
                    do { </span><a name="loc_178_26_178_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_26_178_30&#39;)"><span class="hl_vardecl"><span class="mpre">rslt</span></span></a><span class="mpre"> &lt;- case </span><a href="#loc_175_25_175_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_25_175_27&#39;)"><span class="hl_varref"><span class="mpre">tc</span></span></a><span class="mpre"> of
                          </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; 
                              case </span><a href="#loc_176_25_176_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_25_176_27&#39;)"><span class="hl_varref"><span class="mpre">cl</span></span></a><span class="mpre"> of
                                  </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_181_40_181_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_40_181_41&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">  -&gt; </span><a href="Network.HTTP.Base.html#loc_884_1_884_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_884_1_884_15&#39;)"><span class="hl_varref"><span class="mpre">linearTransfer</span></span></a><span class="mpre"> (</span><a href="Network.Stream.html#loc_86_5_86_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_86_5_86_14&#39;)"><span class="hl_varref"><span class="mpre">readBlock</span></span></a><span class="mpre"> </span><a href="#loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">read</span></span><span class="mpre"> </span><a href="#loc_181_40_181_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_40_181_41&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)
                                  </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><a href="Network.HTTP.Base.html#loc_894_1_894_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_894_1_894_16&#39;)"><span class="hl_varref"><span class="mpre">hopefulTransfer</span></span></a><span class="mpre"> </span><a href="Network.BufferType.html#loc_146_1_146_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_146_1_146_15&#39;)"><span class="hl_varref"><span class="mpre">stringBufferOp</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">{-null (++) []-}</span></span><span class="mpre"> (</span><a href="Network.Stream.html#loc_85_5_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_85_5_85_13&#39;)"><span class="hl_varref"><span class="mpre">readLine</span></span></a><span class="mpre"> </span><a href="#loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">) []
                          </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_183_32_183_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_32_183_33&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">  -&gt; 
                              case </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="GHC.Unicode.html#loc_143_1_143_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_143_1_143_8&#39;)"><span class="hl_varref"><span class="mpre">toLower</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Utils.html#loc_58_1_58_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Utils.html#loc_58_1_58_5&#39;)"><span class="hl_varref"><span class="mpre">trim</span></span></a><span class="mpre"> </span><a href="#loc_183_32_183_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_32_183_33&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) of
                                  </span><span class="hl_string"><span class="mpre">&quot;chunked&quot;</span></span><span class="mpre"> -&gt; </span><a href="Network.HTTP.Base.html#loc_908_1_908_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_908_1_908_16&#39;)"><span class="hl_varref"><span class="mpre">chunkedTransfer</span></span></a><span class="mpre"> </span><a href="Network.BufferType.html#loc_146_1_146_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_146_1_146_15&#39;)"><span class="hl_varref"><span class="mpre">stringBufferOp</span></span></a><span class="mpre">
                                                               (</span><a href="Network.Stream.html#loc_85_5_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_85_5_85_13&#39;)"><span class="hl_varref"><span class="mpre">readLine</span></span></a><span class="mpre"> </span><a href="#loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">) (</span><a href="Network.Stream.html#loc_86_5_86_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_86_5_86_14&#39;)"><span class="hl_varref"><span class="mpre">readBlock</span></span></a><span class="mpre"> </span><a href="#loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">)
                                  _         -&gt; </span><a href="Network.HTTP.Base.html#loc_950_1_950_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_950_1_950_18&#39;)"><span class="hl_varref"><span class="mpre">uglyDeathTransfer</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;sendHTTP&quot;</span></span><span class="mpre">
                       ; case </span><a href="#loc_178_26_178_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_26_178_30&#39;)"><span class="hl_varref"><span class="mpre">rslt</span></span></a><span class="mpre"> of
                           </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_189_33_189_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_33_189_34&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; </span><a href="Network.Stream.html#loc_88_5_88_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_88_5_88_10&#39;)"><span class="hl_varref"><span class="mpre">close</span></span></a><span class="mpre"> </span><a href="#loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_189_33_189_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_33_189_34&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">)
                           </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a name="loc_190_35_190_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_35_190_39&#39;)"><span class="hl_vardecl"><span class="mpre">ftrs</span></span></a><span class="mpre">,</span><a name="loc_190_40_190_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_40_190_43&#39;)"><span class="hl_vardecl"><span class="mpre">bdy</span></span></a><span class="mpre">) -&gt; do
                            </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_877_1_877_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_877_1_877_14&#39;)"><span class="hl_varref"><span class="mpre">findConnClose</span></span></a><span class="mpre"> (</span><a href="#loc_139_56_139_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_56_139_60&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="hl_infix"><span class="mpre">++</span></span><a href="#loc_190_35_190_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_35_190_39&#39;)"><span class="hl_varref"><span class="mpre">ftrs</span></span></a><span class="mpre">))
                                     (</span><a href="Network.Stream.html#loc_89_5_89_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_89_5_89_15&#39;)"><span class="hl_varref"><span class="mpre">closeOnEnd</span></span></a><span class="mpre"> </span><a href="#loc_139_16_139_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_16_139_20&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">)
                            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Response</span></span><span class="mpre"> </span><a href="#loc_139_50_139_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_50_139_52&#39;)"><span class="hl_varref"><span class="mpre">cd</span></span></a><span class="mpre"> </span><a href="#loc_139_53_139_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_53_139_55&#39;)"><span class="hl_varref"><span class="mpre">rn</span></span></a><span class="mpre"> (</span><a href="#loc_139_56_139_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_56_139_60&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="hl_infix"><span class="mpre">++</span></span><a href="#loc_190_35_190_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_35_190_39&#39;)"><span class="hl_varref"><span class="mpre">ftrs</span></span></a><span class="mpre">) </span><a href="#loc_190_40_190_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_40_190_43&#39;)"><span class="hl_varref"><span class="mpre">bdy</span></span></a><span class="mpre">))
                       }

</span><span class="hl_comment"><span class="mpre">-- | Receive and parse a HTTP request from the given Stream. Should be used </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   for server side interactions.</span></span><span class="mpre">
</span><a href="#loc_199_1_199_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_1_199_12&#39;)"><span class="mpre">receiveHTTP</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 198, srcSpanStartColumn = 16, srcSpanEndLine = 198, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 198, srcSpanStartColumn = 25, srcSpanEndLine = 198, srcSpanEndColumn = 27}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4"><span class="mpre">Stream s =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Request_String</span></span><span class="mpre">)
</span><a name="loc_199_1_199_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_1_199_12&#39;)"><span class="hl_fundecl"><span class="mpre">receiveHTTP</span></span></a><span class="mpre"> </span><a name="loc_199_13_199_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_13_199_17&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> = </span><a href="#loc_203_9_203_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_9_203_23&#39;)"><span class="hl_varref"><span class="mpre">getRequestHead</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="#loc_208_9_208_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_9_208_23&#39;)"><span class="hl_varref"><span class="mpre">processRequest</span></span></a><span class="mpre">
    where
        </span><span class="hl_comment"><span class="mpre">-- reads and parses headers</span></span><span class="mpre">
        </span><a href="#loc_203_9_203_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_9_203_23&#39;)"><span class="mpre">getRequestHead</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">RequestData</span></span><span class="mpre">)
        </span><a name="loc_203_9_203_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_9_203_23&#39;)"><span class="hl_vardecl"><span class="mpre">getRequestHead</span></span></a><span class="mpre"> =
            do { </span><a name="loc_204_18_204_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_18_204_21&#39;)"><span class="hl_vardecl"><span class="mpre">lor</span></span></a><span class="mpre"> &lt;- </span><a href="Network.HTTP.Base.html#loc_956_1_956_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_956_1_956_15&#39;)"><span class="hl_varref"><span class="mpre">readTillEmpty1</span></span></a><span class="mpre"> </span><a href="Network.BufferType.html#loc_146_1_146_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_146_1_146_15&#39;)"><span class="hl_varref"><span class="mpre">stringBufferOp</span></span></a><span class="mpre"> (</span><a href="Network.Stream.html#loc_85_5_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_85_5_85_13&#39;)"><span class="hl_varref"><span class="mpre">readLine</span></span></a><span class="mpre"> </span><a href="#loc_199_13_199_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_13_199_17&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">)
               ; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_204_18_204_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_18_204_21&#39;)"><span class="hl_varref"><span class="mpre">lor</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Network.HTTP.Base.html#loc_440_1_440_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_440_1_440_17&#39;)"><span class="hl_varref"><span class="mpre">parseRequestHead</span></span></a><span class="mpre">
               }
        
        </span><a name="loc_208_9_208_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_9_208_23&#39;)"><span class="hl_fundecl"><span class="mpre">processRequest</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_208_30_208_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_30_208_31&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_208_30_208_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_30_208_31&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
        </span><a href="#loc_208_9_208_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_9_208_23&#39;)"><span class="hl_fundecl"><span class="mpre">processRequest</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a name="loc_209_32_209_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_32_209_34&#39;)"><span class="hl_vardecl"><span class="mpre">rm</span></span></a><span class="mpre">,</span><a name="loc_209_35_209_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_35_209_38&#39;)"><span class="hl_vardecl"><span class="mpre">uri</span></span></a><span class="mpre">,</span><a name="loc_209_39_209_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_39_209_43&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre">)) = 
            do </span><span class="hl_comment"><span class="mpre">-- FIXME : Also handle 100-continue.</span></span><span class="mpre">
               let </span><a name="loc_211_20_211_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_20_211_22&#39;)"><span class="hl_vardecl"><span class="mpre">tc</span></span></a><span class="mpre"> = </span><a href="Network.HTTP.Headers.html#loc_255_1_255_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Headers.html#loc_255_1_255_13&#39;)"><span class="hl_varref"><span class="mpre">lookupHeader</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Headers.html#loc_80_4_80_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Headers.html#loc_80_4_80_23&#39;)"><span class="hl_conref"><span class="mpre">HdrTransferEncoding</span></span></a><span class="mpre"> </span><a href="#loc_209_39_209_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_39_209_43&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">
                   </span><a name="loc_212_20_212_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_20_212_22&#39;)"><span class="hl_vardecl"><span class="mpre">cl</span></span></a><span class="mpre"> = </span><a href="Network.HTTP.Headers.html#loc_255_1_255_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Headers.html#loc_255_1_255_13&#39;)"><span class="hl_varref"><span class="mpre">lookupHeader</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Headers.html#loc_121_4_121_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Headers.html#loc_121_4_121_20&#39;)"><span class="hl_conref"><span class="mpre">HdrContentLength</span></span></a><span class="mpre"> </span><a href="#loc_209_39_209_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_39_209_43&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">
               </span><a name="loc_213_16_213_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_16_213_20&#39;)"><span class="hl_vardecl"><span class="mpre">rslt</span></span></a><span class="mpre"> &lt;- case </span><a href="#loc_211_20_211_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_20_211_22&#39;)"><span class="hl_varref"><span class="mpre">tc</span></span></a><span class="mpre"> of
                          </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt;
                              case </span><a href="#loc_212_20_212_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_20_212_22&#39;)"><span class="hl_varref"><span class="mpre">cl</span></span></a><span class="mpre"> of
                                  </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_216_40_216_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_40_216_41&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">  -&gt; </span><a href="Network.HTTP.Base.html#loc_884_1_884_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_884_1_884_15&#39;)"><span class="hl_varref"><span class="mpre">linearTransfer</span></span></a><span class="mpre"> (</span><a href="Network.Stream.html#loc_86_5_86_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_86_5_86_14&#39;)"><span class="hl_varref"><span class="mpre">readBlock</span></span></a><span class="mpre"> </span><a href="#loc_199_13_199_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_13_199_17&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">read</span></span><span class="mpre"> </span><a href="#loc_216_40_216_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_40_216_41&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)
                                  </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> ([], </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">)) </span><span class="hl_comment"><span class="mpre">-- hopefulTransfer &quot;&quot;</span></span><span class="mpre">
                          </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_218_32_218_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_32_218_33&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">  -&gt;
                              case </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="GHC.Unicode.html#loc_143_1_143_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_143_1_143_8&#39;)"><span class="hl_varref"><span class="mpre">toLower</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Utils.html#loc_58_1_58_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Utils.html#loc_58_1_58_5&#39;)"><span class="hl_varref"><span class="mpre">trim</span></span></a><span class="mpre"> </span><a href="#loc_218_32_218_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_32_218_33&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) of
                                  </span><span class="hl_string"><span class="mpre">&quot;chunked&quot;</span></span><span class="mpre"> -&gt; </span><a href="Network.HTTP.Base.html#loc_908_1_908_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_908_1_908_16&#39;)"><span class="hl_varref"><span class="mpre">chunkedTransfer</span></span></a><span class="mpre"> </span><a href="Network.BufferType.html#loc_146_1_146_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.BufferType.html#loc_146_1_146_15&#39;)"><span class="hl_varref"><span class="mpre">stringBufferOp</span></span></a><span class="mpre">
                                                               (</span><a href="Network.Stream.html#loc_85_5_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_85_5_85_13&#39;)"><span class="hl_varref"><span class="mpre">readLine</span></span></a><span class="mpre"> </span><a href="#loc_199_13_199_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_13_199_17&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">) (</span><a href="Network.Stream.html#loc_86_5_86_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_86_5_86_14&#39;)"><span class="hl_varref"><span class="mpre">readBlock</span></span></a><span class="mpre"> </span><a href="#loc_199_13_199_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_13_199_17&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">)
                                  _         -&gt; </span><a href="Network.HTTP.Base.html#loc_950_1_950_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_950_1_950_18&#39;)"><span class="hl_varref"><span class="mpre">uglyDeathTransfer</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;receiveHTTP&quot;</span></span><span class="mpre">
               
               </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
                  (</span><a name="loc_225_20_225_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_20_225_24&#39;)"><span class="hl_vardecl"><span class="mpre">ftrs</span></span></a><span class="mpre">,</span><a name="loc_225_25_225_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_25_225_28&#39;)"><span class="hl_vardecl"><span class="mpre">bdy</span></span></a><span class="mpre">) &lt;- </span><a href="#loc_213_16_213_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_16_213_20&#39;)"><span class="hl_varref"><span class="mpre">rslt</span></span></a><span class="mpre">
                  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Request</span></span><span class="mpre"> </span><a href="#loc_209_35_209_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_35_209_38&#39;)"><span class="hl_varref"><span class="mpre">uri</span></span></a><span class="mpre"> </span><a href="#loc_209_32_209_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_32_209_34&#39;)"><span class="hl_varref"><span class="mpre">rm</span></span></a><span class="mpre"> (</span><a href="#loc_209_39_209_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_39_209_43&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="hl_infix"><span class="mpre">++</span></span><a href="#loc_225_20_225_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_20_225_24&#39;)"><span class="hl_varref"><span class="mpre">ftrs</span></span></a><span class="mpre">) </span><a href="#loc_225_25_225_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_25_225_28&#39;)"><span class="hl_varref"><span class="mpre">bdy</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Very simple function, send a HTTP response over the given stream. This </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   could be improved on to use different transfer types.</span></span><span class="mpre">
</span><a href="#loc_231_1_231_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_1_231_12&#39;)"><span class="mpre">respondHTTP</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 230, srcSpanStartColumn = 16, srcSpanEndLine = 230, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Stream.hs&quot;, srcSpanStartLine = 230, srcSpanStartColumn = 25, srcSpanEndLine = 230, srcSpanEndColumn = 27}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4"><span class="mpre">Stream s =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Response_String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_231_1_231_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_1_231_12&#39;)"><span class="hl_fundecl"><span class="mpre">respondHTTP</span></span></a><span class="mpre"> </span><a name="loc_231_13_231_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_13_231_17&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_231_18_231_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_18_231_21&#39;)"><span class="hl_vardecl"><span class="mpre">rsp</span></span></a><span class="mpre"> = do </span><span class="hl_comment"><span class="mpre">-- TODO review throwing away of result</span></span><span class="mpre">
                          _ &lt;- </span><a href="Network.Stream.html#loc_87_5_87_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_87_5_87_15&#39;)"><span class="hl_varref"><span class="mpre">writeBlock</span></span></a><span class="mpre"> </span><a href="#loc_231_13_231_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_13_231_17&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_231_18_231_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_18_231_21&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre">)
                          </span><span class="hl_comment"><span class="mpre">-- write body immediately, don&#39;t wait for 100 CONTINUE</span></span><span class="mpre">
                          </span><span class="hl_comment"><span class="mpre">-- TODO review throwing away of result</span></span><span class="mpre">
                          _ &lt;- </span><a href="Network.Stream.html#loc_87_5_87_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_87_5_87_15&#39;)"><span class="hl_varref"><span class="mpre">writeBlock</span></span></a><span class="mpre"> </span><a href="#loc_231_13_231_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_13_231_17&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Base.html#loc_343_16_343_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_343_16_343_23&#39;)"><span class="hl_varref"><span class="mpre">rspBody</span></span></a><span class="mpre"> </span><a href="#loc_231_18_231_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_18_231_21&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre">)
                          </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
</span></div></body></html>