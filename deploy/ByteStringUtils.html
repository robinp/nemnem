<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE BangPatterns, ForeignFunctionInterface, CPP #-}

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  ByteStringUtils</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow 2001,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--                    David Roundy 2003-2005</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License : GPL (I&#39;m happy to also license this file BSD style but don&#39;t</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--           want to bother distributing two license files with darcs.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  droundy@abridgegame.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- GZIp and MMap IO for ByteStrings, and miscellaneous functions for Data.ByteString</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">

module ByteStringUtils (

        unsafeWithInternals,
        unpackPSfromUTF8,

        </span><span class="hl_comment"><span class="mpre">-- IO with mmap or gzip</span></span><span class="mpre">
        gzReadFilePS,
        mmapFilePS,
        gzWriteFilePS,
        gzWriteFilePSs,

        </span><span class="hl_comment"><span class="mpre">-- list utilities</span></span><span class="mpre">
        ifHeadThenTail,
        dropSpace,
        breakSpace,
        linesPS,
        unlinesPS,
        hashPS,
        breakFirstPS,
        breakLastPS,
        substrPS,
        readIntPS,
        is_funky,
        fromHex2PS,
        fromPS2Hex,
        betweenLinesPS,
        break_after_nth_newline,
        break_before_nth_newline,
        intercalate
    ) where

import Prelude hiding ( catch )
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 50, srcSpanStartColumn = 18, srcSpanEndLine = 50, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre">            as B
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 51, srcSpanStartColumn = 18, srcSpanEndLine = 51, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre">      as BC
import qualified Data.ByteString.Internal   as BI
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 53, srcSpanStartColumn = 8, srcSpanEndLine = 53, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (intercalate, uncons)
import Data.ByteString.Internal (</span><a href="Data.ByteString.Internal.html#loc_400_1_400_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_400_1_400_15&#39;)"><span class="mpre">fromForeignPtr</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- #if defined (HAVE_MMAP) || ! defined (HAVE_HASKELL_ZLIB)</span></span><span class="mpre">
import Control.Exception        ( </span><a href="Control.Exception.Base.html#loc_150_1_150_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_150_1_150_6&#39;)"><span class="mpre">catch</span></a><span class="mpre"> )
</span><span class="hl_comment"><span class="mpre">-- #endif</span></span><span class="mpre">
import System.IO
import System.IO.Unsafe         ( </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="mpre">unsafePerformIO</span></a><span class="mpre"> )

import Foreign.Storable         ( peekElemOff, peek )
import Foreign.Marshal.Alloc    ( </span><a href="Foreign.Marshal.Alloc.html#loc_184_1_184_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_184_1_184_5&#39;)"><span class="mpre">free</span></a><span class="mpre"> )
import Foreign.Marshal.Array    ( </span><a href="Foreign.Marshal.Array.html#loc_83_1_83_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Array.html#loc_83_1_83_12&#39;)"><span class="mpre">mallocArray</span></a><span class="mpre">, </span><a href="Foreign.Marshal.Array.html#loc_134_1_134_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Array.html#loc_134_1_134_10&#39;)"><span class="mpre">peekArray</span></a><span class="mpre">, </span><a href="Foreign.Marshal.Array.html#loc_260_1_260_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Array.html#loc_260_1_260_11&#39;)"><span class="mpre">advancePtr</span></a><span class="mpre"> )
import Foreign.C.Types          ( CInt )

import Data.Bits                ( </span><a href="Data.Bits.html#loc_250_5_250_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_250_5_250_12&#39;)"><span class="mpre">rotateL</span></a><span class="mpre"> )
import Data.Char                ( </span><a href="GHC.Char.html#loc_11_1_11_4" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Char.html#loc_11_1_11_4&#39;)"><span class="mpre">chr</span></a><span class="mpre">, ord, </span><a href="GHC.Unicode.html#loc_72_1_72_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_72_1_72_8&#39;)"><span class="mpre">isSpace</span></a><span class="mpre"> )
import Data.Word                ( Word8 )
import Data.Int                 ( </span><a href="GHC.Int.html#loc_376_30_376_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_376_30_376_35&#39;)"><span class="mpre">Int32</span></a><span class="mpre"> )
import Control.Monad            ( </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre"> )

</span><span class="hl_comment"><span class="mpre">-- #ifndef HAVE_HASKELL_ZLIB</span></span><span class="mpre">
import Foreign.Ptr              ( nullPtr )
import Foreign.ForeignPtr       ( ForeignPtr )
</span><span class="hl_comment"><span class="mpre">-- #endif</span></span><span class="mpre">
import Foreign.Ptr              ( plusPtr, Ptr )
import Foreign.ForeignPtr       ( </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="mpre">withForeignPtr</span></a><span class="mpre"> )

</span><span class="hl_comment"><span class="mpre">-- #ifdef DEBUG_PS</span></span><span class="mpre">
import Foreign.ForeignPtr       ( addForeignPtrFinalizer )
import Foreign.Ptr              ( FunPtr )
</span><span class="hl_comment"><span class="mpre">-- #endif</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- #if HAVE_HASKELL_ZLIB</span></span><span class="mpre">
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 86, srcSpanStartColumn = 18, srcSpanEndLine = 86, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as BL
import qualified Codec.Compression.GZip as GZ
</span><span class="hl_comment"><span class="mpre">-- #else</span></span><span class="mpre">
import Foreign.C.String ( CString, </span><a href="Foreign.C.String.html#loc_176_1_176_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.C.String.html#loc_176_1_176_12&#39;)"><span class="mpre">withCString</span></a><span class="mpre"> )
</span><span class="hl_comment"><span class="mpre">-- #endif</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- #ifdef HAVE_MMAP</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 93, srcSpanStartColumn = 8, srcSpanEndLine = 93, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;System.IO.MMap&quot;"><span class="mpre">System.IO.MMap</span></span><span class="mpre">( mmapFileByteString )
import System.Mem( </span><a href="System.Mem.html#loc_26_1_26_10" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Mem.html#loc_26_1_26_10&#39;)"><span class="mpre">performGC</span></a><span class="mpre"> )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 95, srcSpanStartColumn = 8, srcSpanEndLine = 95, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;System.Posix.Files&quot;"><span class="mpre">System.Posix.Files</span></span><span class="mpre">( fileSize, getSymbolicLinkStatus )
</span><span class="hl_comment"><span class="mpre">-- #endif</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- obsolete debugging code</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- # ifndef HAVE_HASKELL_ZLIB</span></span><span class="mpre">
</span><a href="#loc_108_1_108_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_16&#39;)"><span class="mpre">debugForeignPtr</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #ifdef DEBUG_PS</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 104, srcSpanStartColumn = 1, srcSpanEndLine = 105, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 104, srcSpanStartColumn = 1, srcSpanEndLine = 104, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-"><span class="mpre">foreign import ccall unsafe &quot;static fpstring.h debug_alloc&quot; debug_alloc
    :: Ptr a -&gt; CString -&gt; IO ()</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 106, srcSpanStartColumn = 1, srcSpanEndLine = 107, srcSpanEndColumn = 31}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 106, srcSpanStartColumn = 1, srcSpanEndLine = 106, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-"><span class="mpre">foreign import ccall unsafe &quot;static fpstring.h &amp; debug_free&quot; debug_free
    :: FunPtr (Ptr a -&gt; IO ())</span></span><span class="mpre">
</span><a name="loc_108_1_108_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_16&#39;)"><span class="hl_fundecl"><span class="mpre">debugForeignPtr</span></span></a><span class="mpre"> </span><a name="loc_108_17_108_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_17_108_19&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a name="loc_108_20_108_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_20_108_21&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> =
    </span><a href="Foreign.C.String.html#loc_176_1_176_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.C.String.html#loc_176_1_176_12&#39;)"><span class="hl_varref"><span class="mpre">withCString</span></span></a><span class="mpre"> </span><a href="#loc_108_20_108_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_20_108_21&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_109_22_109_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_22_109_27&#39;)"><span class="hl_vardecl"><span class="mpre">cname</span></span></a><span class="mpre">-&gt; </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="hl_varref"><span class="mpre">withForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_108_17_108_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_17_108_19&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_109_51_109_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_51_109_52&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre">-&gt;
    do </span><span class="hl_varref"><span class="mpre">debug_alloc</span></span><span class="mpre"> </span><a href="#loc_109_51_109_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_51_109_52&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_109_22_109_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_22_109_27&#39;)"><span class="hl_varref"><span class="mpre">cname</span></span></a><span class="mpre">
       </span><span class="hl_varref"><span class="mpre">addForeignPtrFinalizer</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">debug_free</span></span><span class="mpre"> </span><a href="#loc_108_17_108_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_17_108_19&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #else</span></span><span class="mpre">
</span><a href="#loc_108_1_108_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_16&#39;)"><span class="hl_fundecl"><span class="mpre">debugForeignPtr</span></span></a><span class="mpre"> _ _ = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #endif</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #endif</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- unsafeWithInternals</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Do something with the internals of a PackedString. Beware of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- altering the contents!</span></span><span class="mpre">
</span><a href="#loc_123_1_123_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_20&#39;)"><span class="mpre">unsafeWithInternals</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_123_1_123_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_20&#39;)"><span class="hl_fundecl"><span class="mpre">unsafeWithInternals</span></span></a><span class="mpre"> </span><a name="loc_123_21_123_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_21_123_23&#39;)"><span class="hl_vardecl"><span class="mpre">ps</span></span></a><span class="mpre"> </span><a name="loc_123_24_123_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_24_123_25&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre">
 = case </span><a href="Data.ByteString.Internal.html#loc_405_1_405_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_405_1_405_13&#39;)"><span class="hl_varref"><span class="mpre">BI.toForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_123_21_123_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_21_123_23&#39;)"><span class="hl_varref"><span class="mpre">ps</span></span></a><span class="mpre"> of
   (</span><a name="loc_125_5_125_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_5_125_7&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre">,</span><a name="loc_125_8_125_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_8_125_9&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">,</span><a name="loc_125_10_125_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_10_125_11&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) -&gt; </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="hl_varref"><span class="mpre">withForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_125_5_125_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_5_125_7&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_125_37_125_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_37_125_38&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_123_24_123_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_24_123_25&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> (</span><a href="#loc_125_37_125_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_37_125_38&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_125_8_125_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_8_125_9&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) </span><a href="#loc_125_10_125_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_10_125_11&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | readIntPS skips any whitespace at the beginning of its argument, and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- reads an Int from the beginning of the PackedString.  If there is no</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- integer at the beginning of the string, it returns Nothing, otherwise it</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- just returns the int read, along with a B.ByteString containing the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- remainder of its input.</span></span><span class="mpre">

</span><a href="#loc_134_1_134_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_1_134_10&#39;)"><span class="mpre">readIntPS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">)
</span><a name="loc_134_1_134_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_1_134_10&#39;)"><span class="hl_vardecl"><span class="mpre">readIntPS</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">BC.readInt</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">BC.dropWhile</span></span><span class="mpre"> </span><a href="GHC.Unicode.html#loc_72_1_72_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_72_1_72_8&#39;)"><span class="hl_varref"><span class="mpre">isSpace</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Destructor functions (taking PackedStrings apart)</span></span><span class="mpre">

</span><a href="#loc_140_1_140_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_1_140_17&#39;)"><span class="mpre">unpackPSfromUTF8</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_140_1_140_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_1_140_17&#39;)"><span class="hl_fundecl"><span class="mpre">unpackPSfromUTF8</span></span></a><span class="mpre"> </span><a name="loc_140_18_140_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_18_140_20&#39;)"><span class="hl_vardecl"><span class="mpre">ps</span></span></a><span class="mpre"> =
 case </span><a href="Data.ByteString.Internal.html#loc_405_1_405_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_405_1_405_13&#39;)"><span class="hl_varref"><span class="mpre">BI.toForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_140_18_140_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_18_140_20&#39;)"><span class="hl_varref"><span class="mpre">ps</span></span></a><span class="mpre"> of
   (_,_, </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">) -&gt; </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
   (</span><a name="loc_143_5_143_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_5_143_6&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">,</span><a name="loc_143_7_143_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_7_143_8&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">,</span><a name="loc_143_9_143_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_9_143_10&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">)  -&gt;
    </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="hl_varref"><span class="mpre">withForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_143_5_143_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_5_143_6&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_144_43_144_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_43_144_44&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre">-&gt;
    do </span><a name="loc_145_8_145_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_8_145_14&#39;)"><span class="hl_vardecl"><span class="mpre">outbuf</span></span></a><span class="mpre"> &lt;- </span><a href="Foreign.Marshal.Array.html#loc_83_1_83_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Array.html#loc_83_1_83_12&#39;)"><span class="hl_varref"><span class="mpre">mallocArray</span></span></a><span class="mpre"> </span><a href="#loc_143_9_143_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_9_143_10&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
       </span><a name="loc_146_8_146_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_8_146_12&#39;)"><span class="hl_vardecl"><span class="mpre">lout</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre">
               </span><span class="hl_varref"><span class="mpre">utf8_to_ints</span></span><span class="mpre"> </span><a href="#loc_145_8_145_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_8_145_14&#39;)"><span class="hl_varref"><span class="mpre">outbuf</span></span></a><span class="mpre"> (</span><a href="#loc_144_43_144_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_43_144_44&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_143_7_143_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_7_143_8&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_143_9_143_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_9_143_10&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">)
       </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_146_8_146_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_8_146_12&#39;)"><span class="hl_varref"><span class="mpre">lout</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Bad UTF8!&quot;</span></span><span class="mpre">
       </span><a name="loc_149_8_149_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_8_149_11&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> &lt;- (</span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> (</span><a href="GHC.Char.html#loc_11_1_11_4" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Char.html#loc_11_1_11_4&#39;)"><span class="hl_varref"><span class="mpre">chr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><a href="Foreign.Marshal.Array.html#loc_134_1_134_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Array.html#loc_134_1_134_10&#39;)"><span class="hl_varref"><span class="mpre">peekArray</span></span></a><span class="mpre"> </span><a href="#loc_146_8_146_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_8_146_12&#39;)"><span class="hl_varref"><span class="mpre">lout</span></span></a><span class="mpre"> </span><a href="#loc_145_8_145_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_8_145_14&#39;)"><span class="hl_varref"><span class="mpre">outbuf</span></span></a><span class="mpre">
       </span><a href="Foreign.Marshal.Alloc.html#loc_184_1_184_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_184_1_184_5&#39;)"><span class="hl_varref"><span class="mpre">free</span></span></a><span class="mpre"> </span><a href="#loc_145_8_145_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_8_145_14&#39;)"><span class="hl_varref"><span class="mpre">outbuf</span></span></a><span class="mpre">
       </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_149_8_149_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_8_149_11&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 153, srcSpanStartColumn = 1, srcSpanEndLine = 154, srcSpanEndColumn = 47}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 153, srcSpanStartColumn = 1, srcSpanEndLine = 153, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-"><span class="mpre">foreign import ccall unsafe &quot;static fpstring.h utf8_to_ints&quot; utf8_to_ints
    :: Ptr Int -&gt; Ptr Word8 -&gt; CInt -&gt; IO CInt</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- List-mimicking functions for PackedStrings</span></span><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_161_1_161_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_1_161_15&#39;)"><span class="mpre">ifHeadThenTail</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_161_1_161_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_1_161_15&#39;)"><span class="mpre">ifHeadThenTail</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_161_1_161_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_1_161_15&#39;)"><span class="hl_fundecl"><span class="mpre">ifHeadThenTail</span></span></a><span class="mpre"> </span><a name="loc_161_16_161_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_16_161_17&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> </span><a name="loc_161_18_161_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_18_161_19&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = case </span><span class="hl_varref"><span class="mpre">uncons</span></span><span class="mpre"> </span><a href="#loc_161_18_161_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_18_161_19&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a name="loc_162_11_162_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_11_162_12&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre">, </span><a name="loc_162_14_162_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_14_162_15&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre">) | </span><a href="#loc_162_11_162_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_11_162_12&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_161_16_161_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_16_161_17&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">    -&gt; </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_162_14_162_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_14_162_15&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">
    _                       -&gt; </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A reimplementation of Data.ByteString.Char8.dropSpace, but</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- specialised to darcs&#39; need for a 4 way isspace.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- TODO: if it is safe to use the expanded definition of isSpaceWord8</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- provided by Data.ByteString.Char8, then all this can go.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- A locale-independent isspace(3) so patches are interpreted the same everywhere.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ((c) == &#39; &#39; || (c) == &#39;\t&#39; || (c) == &#39;\n&#39; || (c) == &#39;\r&#39;)</span></span><span class="mpre">
</span><a href="#loc_175_1_175_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_1_175_13&#39;)"><span class="mpre">isSpaceWord8</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_175_1_175_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_1_175_13&#39;)"><span class="hl_fundecl"><span class="mpre">isSpaceWord8</span></span></a><span class="mpre"> </span><a name="loc_175_14_175_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_14_175_15&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> =
    </span><a href="#loc_175_14_175_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_14_175_15&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x20</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- &#39; &#39;</span></span><span class="mpre">
    </span><a href="#loc_175_14_175_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_14_175_15&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x09</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- &#39;\t&#39;</span></span><span class="mpre">
    </span><a href="#loc_175_14_175_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_14_175_15&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x0A</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- &#39;\n&#39;</span></span><span class="mpre">
    </span><a href="#loc_175_14_175_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_14_175_15&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x0D</span></span><span class="mpre">       </span><span class="hl_comment"><span class="mpre">-- &#39;\r&#39;</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_175_1_175_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_1_175_13&#39;)"><span class="mpre">isSpaceWord8</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_183_1_183_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_14&#39;)"><span class="mpre">firstnonspace</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_183_1_183_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_14&#39;)"><span class="hl_fundecl"><span class="mpre">firstnonspace</span></span></a><span class="mpre"> !</span><a name="loc_183_16_183_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_16_183_19&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> !</span><a name="loc_183_21_183_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_21_183_22&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> !</span><a name="loc_183_24_183_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_24_183_25&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">
    | </span><a href="#loc_183_21_183_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_21_183_22&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="#loc_183_24_183_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_24_183_25&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">    = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_183_21_183_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_21_183_22&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do </span><a name="loc_185_22_185_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_22_185_23&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekElemOff</span></span><span class="mpre"> </span><a href="#loc_183_16_183_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_16_183_19&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_183_21_183_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_21_183_22&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
                     if </span><a href="#loc_175_1_175_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_1_175_13&#39;)"><span class="hl_varref"><span class="mpre">isSpaceWord8</span></span></a><span class="mpre"> </span><a href="#loc_185_22_185_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_22_185_23&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> then </span><a href="#loc_183_1_183_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_14&#39;)"><span class="hl_varref"><span class="mpre">firstnonspace</span></span></a><span class="mpre"> </span><a href="#loc_183_16_183_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_16_183_19&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> (</span><a href="#loc_183_21_183_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_21_183_22&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_183_24_183_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_24_183_25&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_183_21_183_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_21_183_22&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">

</span><a href="#loc_189_1_189_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_1_189_11&#39;)"><span class="mpre">firstspace</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_189_1_189_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_1_189_11&#39;)"><span class="hl_fundecl"><span class="mpre">firstspace</span></span></a><span class="mpre"> !</span><a name="loc_189_13_189_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_13_189_16&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> !</span><a name="loc_189_18_189_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_18_189_19&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> !</span><a name="loc_189_21_189_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_21_189_22&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">
    | </span><a href="#loc_189_18_189_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_18_189_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="#loc_189_21_189_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_21_189_22&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">    = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_189_18_189_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_18_189_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do </span><a name="loc_191_22_191_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_22_191_23&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekElemOff</span></span><span class="mpre"> </span><a href="#loc_189_13_189_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_13_189_16&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_189_18_189_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_18_189_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
                     if (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_175_1_175_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_1_175_13&#39;)"><span class="hl_varref"><span class="mpre">isSpaceWord8</span></span></a><span class="mpre">) </span><a href="#loc_191_22_191_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_22_191_23&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> then </span><a href="#loc_189_1_189_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_1_189_11&#39;)"><span class="hl_varref"><span class="mpre">firstspace</span></span></a><span class="mpre"> </span><a href="#loc_189_13_189_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_13_189_16&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> (</span><a href="#loc_189_18_189_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_18_189_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_189_21_189_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_21_189_22&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_189_18_189_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_18_189_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | &#39;dropSpace&#39; efficiently returns the &#39;ByteString&#39; argument with</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- white space Chars removed from the front. It is more efficient than</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- calling dropWhile for removing whitespace. I.e.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; dropWhile isSpace == dropSpace</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_201_1_201_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_1_201_10&#39;)"><span class="mpre">dropSpace</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_201_1_201_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_1_201_10&#39;)"><span class="hl_fundecl"><span class="mpre">dropSpace</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">BI.PS</span></span></a><span class="mpre"> </span><a name="loc_201_18_201_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_18_201_19&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> </span><a name="loc_201_20_201_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_20_201_21&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_201_22_201_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_22_201_23&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) = </span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">BI.inlinePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="hl_varref"><span class="mpre">withForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_201_18_201_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_18_201_19&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_201_68_201_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_68_201_69&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_202_5_202_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_5_202_6&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_183_1_183_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_14&#39;)"><span class="hl_varref"><span class="mpre">firstnonspace</span></span></a><span class="mpre"> (</span><a href="#loc_201_68_201_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_68_201_69&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_201_20_201_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_20_201_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_201_22_201_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_22_201_23&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> if </span><a href="#loc_202_5_202_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_5_202_6&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_201_22_201_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_22_201_23&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> then </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre"> else </span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">BI.PS</span></span></a><span class="mpre"> </span><a href="#loc_201_18_201_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_18_201_19&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> (</span><a href="#loc_201_20_201_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_20_201_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_202_5_202_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_5_202_6&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">) (</span><a href="#loc_201_22_201_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_22_201_23&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><a href="#loc_202_5_202_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_5_202_6&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_201_1_201_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_1_201_10&#39;)"><span class="mpre">dropSpace</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | &#39;breakSpace&#39; returns the pair of ByteStrings when the argument is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- broken at the first whitespace byte. I.e.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; break isSpace == breakSpace</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_212_1_212_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_1_212_11&#39;)"><span class="mpre">breakSpace</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">)
</span><a name="loc_212_1_212_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_1_212_11&#39;)"><span class="hl_fundecl"><span class="mpre">breakSpace</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">BI.PS</span></span></a><span class="mpre"> </span><a name="loc_212_19_212_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_19_212_20&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> </span><a name="loc_212_21_212_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_21_212_22&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_212_23_212_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_23_212_24&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) = </span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">BI.inlinePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="hl_varref"><span class="mpre">withForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_212_19_212_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_19_212_20&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_212_69_212_70" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_69_212_70&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_213_5_213_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_5_213_6&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_189_1_189_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_1_189_11&#39;)"><span class="hl_varref"><span class="mpre">firstspace</span></span></a><span class="mpre"> (</span><a href="#loc_212_69_212_70" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_69_212_70&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_212_21_212_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_21_212_22&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_212_23_212_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_23_212_24&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> case </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> of {_
        | </span><a href="#loc_213_5_213_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_5_213_6&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">    -&gt; (</span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">, </span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">BI.PS</span></span></a><span class="mpre"> </span><a href="#loc_212_19_212_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_19_212_20&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="#loc_212_21_212_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_21_212_22&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_212_23_212_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_23_212_24&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">)
        | </span><a href="#loc_213_5_213_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_5_213_6&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_212_23_212_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_23_212_24&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">    -&gt; (</span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">BI.PS</span></span></a><span class="mpre"> </span><a href="#loc_212_19_212_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_19_212_20&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="#loc_212_21_212_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_21_212_22&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_212_23_212_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_23_212_24&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">)
        | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> -&gt; (</span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">BI.PS</span></span></a><span class="mpre"> </span><a href="#loc_212_19_212_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_19_212_20&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="#loc_212_21_212_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_21_212_22&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_213_5_213_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_5_213_6&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">, </span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">BI.PS</span></span></a><span class="mpre"> </span><a href="#loc_212_19_212_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_19_212_20&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> (</span><a href="#loc_212_21_212_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_21_212_22&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_213_5_213_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_5_213_6&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">) (</span><a href="#loc_212_23_212_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_23_212_24&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><a href="#loc_213_5_213_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_5_213_6&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">))
    }
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_212_1_212_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_1_212_11&#39;)"><span class="mpre">breakSpace</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_225_1_225_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_1_225_9&#39;)"><span class="mpre">is_funky</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_225_1_225_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_1_225_9&#39;)"><span class="mpre">is_funky</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_225_1_225_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_1_225_9&#39;)"><span class="hl_fundecl"><span class="mpre">is_funky</span></span></a><span class="mpre"> </span><a name="loc_225_10_225_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_10_225_12&#39;)"><span class="hl_vardecl"><span class="mpre">ps</span></span></a><span class="mpre"> = case </span><a href="Data.ByteString.Internal.html#loc_405_1_405_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_405_1_405_13&#39;)"><span class="hl_varref"><span class="mpre">BI.toForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_225_10_225_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_10_225_12&#39;)"><span class="hl_varref"><span class="mpre">ps</span></span></a><span class="mpre"> of
   (</span><a name="loc_226_5_226_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_5_226_6&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">,</span><a name="loc_226_7_226_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_7_226_8&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">,</span><a name="loc_226_9_226_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_9_226_10&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) -&gt;
    </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="hl_varref"><span class="mpre">withForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_226_5_226_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_5_226_6&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_227_43_227_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_43_227_44&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre">-&gt;
    (</span><span class="hl_infix"><span class="mpre">/=</span></span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">has_funky_char</span></span><span class="mpre"> (</span><a href="#loc_227_43_227_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_43_227_44&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_226_7_226_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_7_226_8&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_226_9_226_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_9_226_10&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">)

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 230, srcSpanStartColumn = 1, srcSpanEndLine = 231, srcSpanEndColumn = 36}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 230, srcSpanStartColumn = 1, srcSpanEndLine = 230, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-"><span class="mpre">foreign import ccall unsafe &quot;fpstring.h has_funky_char&quot; has_funky_char
    :: Ptr Word8 -&gt; CInt -&gt; IO CInt</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ByteString rewrites break (==&#39;x&#39;) to breakByte &#39;x&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  break ((==) x) = breakChar x</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  break (==x) = breakChar x</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-
{-# INLINE breakOnPS #-}
breakOnPS :: Char -&gt; B.ByteString -&gt; (B.ByteString, B.ByteString)
breakOnPS c p = case BC.elemIndex c p of
                Nothing -&gt; (p, BC.empty)
                Just n  -&gt; (B.take n p, B.drop n p)
-}</span></span><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_250_1_250_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_1_250_7&#39;)"><span class="mpre">hashPS</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_250_1_250_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_1_250_7&#39;)"><span class="mpre">hashPS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><a href="GHC.Int.html#loc_376_30_376_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_376_30_376_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int32</span></span></a><span class="mpre">
</span><a name="loc_250_1_250_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_1_250_7&#39;)"><span class="hl_fundecl"><span class="mpre">hashPS</span></span></a><span class="mpre"> </span><a name="loc_250_8_250_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_8_250_10&#39;)"><span class="hl_vardecl"><span class="mpre">ps</span></span></a><span class="mpre"> =
   case </span><a href="Data.ByteString.Internal.html#loc_405_1_405_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_405_1_405_13&#39;)"><span class="hl_varref"><span class="mpre">BI.toForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_250_8_250_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_8_250_10&#39;)"><span class="hl_varref"><span class="mpre">ps</span></span></a><span class="mpre"> of
   (</span><a name="loc_252_5_252_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_5_252_6&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">,</span><a name="loc_252_7_252_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_7_252_8&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">,</span><a name="loc_252_9_252_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_9_252_10&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) -&gt;
    </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="hl_varref"><span class="mpre">withForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_252_5_252_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_5_252_6&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_253_43_253_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_43_253_44&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre">-&gt;
    do </span><a href="#loc_257_1_257_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_1_257_5&#39;)"><span class="hl_varref"><span class="mpre">hash</span></span></a><span class="mpre"> (</span><a href="#loc_253_43_253_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_43_253_44&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_252_7_252_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_7_252_8&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) </span><a href="#loc_252_9_252_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_9_252_10&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">

</span><a href="#loc_257_1_257_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_1_257_5&#39;)"><span class="mpre">hash</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.Int.html#loc_376_30_376_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_376_30_376_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int32</span></span></a><span class="mpre">
</span><a name="loc_257_1_257_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_1_257_5&#39;)"><span class="hl_fundecl"><span class="mpre">hash</span></span></a><span class="mpre"> </span><a name="loc_257_6_257_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_6_257_9&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_257_10_257_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_10_257_13&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = </span><a href="#loc_258_8_258_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_258_8_258_9&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> (</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> :: </span><a href="GHC.Int.html#loc_376_30_376_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_376_30_376_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int32</span></span></a><span class="mpre">) </span><a href="#loc_257_6_257_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_6_257_9&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_257_10_257_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_10_257_13&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
 where </span><a name="loc_258_8_258_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_258_8_258_9&#39;)"><span class="hl_fundecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_258_10_258_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_258_10_258_11&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> _ </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_258_10_258_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_258_10_258_11&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
       </span><a href="#loc_258_8_258_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_258_8_258_9&#39;)"><span class="hl_fundecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_259_10_259_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_10_259_11&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_259_12_259_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_12_259_13&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_259_14_259_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_14_259_15&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = do </span><a name="loc_259_21_259_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_21_259_22&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peek</span></span><span class="mpre"> </span><a href="#loc_259_12_259_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_12_259_13&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">
                    let !</span><a name="loc_260_26_260_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_260_26_260_28&#39;)"><span class="hl_vardecl"><span class="mpre">h&#39;</span></span></a><span class="mpre"> =  (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_259_21_259_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_21_259_22&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> (</span><a href="Data.Bits.html#loc_250_5_250_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_250_5_250_12&#39;)"><span class="hl_varref"><span class="mpre">rotateL</span></span></a><span class="mpre"> </span><a href="#loc_259_10_259_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_10_259_11&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">)
                    </span><a href="#loc_258_8_258_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_258_8_258_9&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_260_26_260_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_260_26_260_28&#39;)"><span class="hl_varref"><span class="mpre">h&#39;</span></span></a><span class="mpre"> (</span><a href="#loc_259_12_259_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_12_259_13&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="Foreign.Marshal.Array.html#loc_260_1_260_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Array.html#loc_260_1_260_11&#39;)"><span class="hl_infix"><span class="mpre">`advancePtr`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><a href="#loc_259_14_259_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_14_259_15&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)

</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_265_1_265_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_1_265_9&#39;)"><span class="mpre">substrPS</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_265_1_265_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_1_265_9&#39;)"><span class="mpre">substrPS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_265_1_265_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_1_265_9&#39;)"><span class="hl_fundecl"><span class="mpre">substrPS</span></span></a><span class="mpre"> </span><a name="loc_265_10_265_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_10_265_13&#39;)"><span class="hl_vardecl"><span class="mpre">tok</span></span></a><span class="mpre"> </span><a name="loc_265_14_265_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_14_265_17&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">B.null</span></span><span class="mpre"> </span><a href="#loc_265_10_265_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_10_265_13&#39;)"><span class="hl_varref"><span class="mpre">tok</span></span></a><span class="mpre"> = </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_265_10_265_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_10_265_13&#39;)"><span class="hl_varref"><span class="mpre">tok</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_265_14_265_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_14_265_17&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre"> = </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do </span><a name="loc_268_22_268_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_268_22_268_23&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">BC.elemIndex</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">BC.head</span></span><span class="mpre"> </span><a href="#loc_265_10_265_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_10_265_13&#39;)"><span class="hl_varref"><span class="mpre">tok</span></span></a><span class="mpre">) </span><a href="#loc_265_14_265_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_14_265_17&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
                     let </span><a name="loc_269_26_269_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_26_269_30&#39;)"><span class="hl_vardecl"><span class="mpre">ttok</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.tail</span></span><span class="mpre"> </span><a href="#loc_265_10_265_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_10_265_13&#39;)"><span class="hl_varref"><span class="mpre">tok</span></span></a><span class="mpre">
                         </span><a name="loc_270_26_270_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_26_270_33&#39;)"><span class="hl_vardecl"><span class="mpre">reststr</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.drop</span></span><span class="mpre"> (</span><a href="#loc_268_22_268_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_268_22_268_23&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_265_14_265_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_14_265_17&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
                     if </span><a href="#loc_269_26_269_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_26_269_30&#39;)"><span class="hl_varref"><span class="mpre">ttok</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.take</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_269_26_269_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_26_269_30&#39;)"><span class="hl_varref"><span class="mpre">ttok</span></span></a><span class="mpre">) </span><a href="#loc_270_26_270_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_26_270_33&#39;)"><span class="hl_varref"><span class="mpre">reststr</span></span></a><span class="mpre">
                        then </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_268_22_268_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_268_22_268_23&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
                        else ((</span><a href="#loc_268_22_268_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_268_22_268_23&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)</span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><a href="#loc_265_1_265_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_1_265_9&#39;)"><span class="hl_varref"><span class="mpre">substrPS</span></span></a><span class="mpre"> </span><a href="#loc_265_10_265_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_10_265_13&#39;)"><span class="hl_varref"><span class="mpre">tok</span></span></a><span class="mpre"> </span><a href="#loc_270_26_270_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_26_270_33&#39;)"><span class="hl_varref"><span class="mpre">reststr</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- TODO: replace breakFirstPS and breakLastPS with definitions based on</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ByteString&#39;s break/breakEnd</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_281_1_281_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_1_281_13&#39;)"><span class="mpre">breakFirstPS</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_281_1_281_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_1_281_13&#39;)"><span class="mpre">breakFirstPS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">)
</span><a name="loc_281_1_281_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_1_281_13&#39;)"><span class="hl_fundecl"><span class="mpre">breakFirstPS</span></span></a><span class="mpre"> </span><a name="loc_281_14_281_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_14_281_15&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> </span><a name="loc_281_16_281_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_16_281_17&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = case </span><span class="hl_varref"><span class="mpre">BC.elemIndex</span></span><span class="mpre"> </span><a href="#loc_281_14_281_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_14_281_15&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><a href="#loc_281_16_281_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_16_281_17&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> of
                   </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
                   </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_283_25_283_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_283_25_283_26&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> -&gt; </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.take</span></span><span class="mpre"> </span><a href="#loc_283_25_283_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_283_25_283_26&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_281_16_281_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_16_281_17&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">B.drop</span></span><span class="mpre"> (</span><a href="#loc_283_25_283_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_283_25_283_26&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_281_16_281_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_16_281_17&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">)

</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_287_1_287_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_1_287_12&#39;)"><span class="mpre">breakLastPS</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_287_1_287_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_1_287_12&#39;)"><span class="mpre">breakLastPS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">)
</span><a name="loc_287_1_287_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_1_287_12&#39;)"><span class="hl_fundecl"><span class="mpre">breakLastPS</span></span></a><span class="mpre"> </span><a name="loc_287_13_287_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_13_287_14&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> </span><a name="loc_287_15_287_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_15_287_16&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = case </span><span class="hl_varref"><span class="mpre">BC.elemIndexEnd</span></span><span class="mpre"> </span><a href="#loc_287_13_287_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_13_287_14&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><a href="#loc_287_15_287_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_15_287_16&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> of
                  </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
                  </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_289_24_289_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_289_24_289_25&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> -&gt; </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.take</span></span><span class="mpre"> </span><a href="#loc_289_24_289_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_289_24_289_25&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_287_15_287_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_15_287_16&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">B.drop</span></span><span class="mpre"> (</span><a href="#loc_289_24_289_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_289_24_289_25&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_287_15_287_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_15_287_16&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- TODO: rename</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_294_1_294_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_1_294_8&#39;)"><span class="mpre">linesPS</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_294_1_294_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_1_294_8&#39;)"><span class="mpre">linesPS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">]
</span><a name="loc_294_1_294_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_1_294_8&#39;)"><span class="hl_fundecl"><span class="mpre">linesPS</span></span></a><span class="mpre"> </span><a name="loc_294_9_294_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_9_294_11&#39;)"><span class="hl_vardecl"><span class="mpre">ps</span></span></a><span class="mpre">
     | </span><span class="hl_varref"><span class="mpre">B.null</span></span><span class="mpre"> </span><a href="#loc_294_9_294_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_9_294_11&#39;)"><span class="hl_varref"><span class="mpre">ps</span></span></a><span class="mpre"> = [</span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">]
     | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">BC.split</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre"> </span><a href="#loc_294_9_294_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_9_294_11&#39;)"><span class="hl_varref"><span class="mpre">ps</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{- QuickCheck property:

import Test.QuickCheck
import qualified Data.ByteString.Char8 as BC
import Data.Char
instance Arbitrary BC.ByteString where
    arbitrary = fmap BC.pack arbitrary
instance Arbitrary Char where
  arbitrary = chr `fmap` choose (32,127)
deepCheck = check (defaultConfig { configMaxTest = 10000})
testLines =  deepCheck (\x -&gt; (linesPS x == linesPSOld x))
linesPSOld ps = case  BC.elemIndex &#39;\n&#39; ps of
             Nothing -&gt; [ps]
             Just n -&gt; B.take n ps : linesPS (B.drop (n+1) ps) -}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-| This function acts exactly like the &quot;Prelude&quot; unlines function, or like
&quot;Data.ByteString.Char8&quot; &#39;unlines&#39;, but with one important difference: it will
produce a string which may not end with a newline! That is:

&gt; unlinesPS [&quot;foo&quot;, &quot;bar&quot;]

evaluates to \&quot;foo\\nbar\&quot;, not \&quot;foo\\nbar\\n\&quot;! This point should hold true for
&#39;linesPS&#39; as well.

TODO: rename this function. -}</span></span><span class="mpre">
</span><a href="#loc_324_1_324_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_10&#39;)"><span class="mpre">unlinesPS</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_324_1_324_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_10&#39;)"><span class="hl_fundecl"><span class="mpre">unlinesPS</span></span></a><span class="mpre"> [] = </span><span class="hl_varref"><span class="mpre">BC.empty</span></span><span class="mpre">
</span><a href="#loc_324_1_324_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_10&#39;)"><span class="hl_fundecl"><span class="mpre">unlinesPS</span></span></a><span class="mpre"> </span><a name="loc_325_11_325_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_325_11_325_12&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">BC.init</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">BC.unlines</span></span><span class="mpre"> </span><a href="#loc_325_11_325_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_325_11_325_12&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_324_1_324_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_10&#39;)"><span class="mpre">unlinesPS</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">{- QuickCheck property:

testUnlines = deepCheck (\x -&gt; (unlinesPS x == unlinesPSOld x))
unlinesPSOld ss = BC.concat $ intersperse_newlines ss
    where intersperse_newlines (a:b:s) = a : newline : intersperse_newlines (b:s)
          intersperse_newlines s = s
          newline = BC.pack &quot;\n&quot; -}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- gzReadFilePS</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Read an entire file, which may or may not be gzip compressed, directly</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- into a &#39;B.ByteString&#39;.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- #ifndef HAVE_HASKELL_ZLIB</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 342, srcSpanStartColumn = 1, srcSpanEndLine = 343, srcSpanEndColumn = 41}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 342, srcSpanStartColumn = 1, srcSpanEndLine = 342, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-"><span class="mpre">foreign import ccall unsafe &quot;static zlib.h gzopen&quot; c_gzopen
    :: CString -&gt; CString -&gt; IO (Ptr ())</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 344, srcSpanStartColumn = 1, srcSpanEndLine = 345, srcSpanEndColumn = 23}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 344, srcSpanStartColumn = 1, srcSpanEndLine = 344, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-"><span class="mpre">foreign import ccall unsafe &quot;static zlib.h gzclose&quot; c_gzclose
    :: Ptr () -&gt; IO ()</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 346, srcSpanStartColumn = 1, srcSpanEndLine = 347, srcSpanEndColumn = 46}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 346, srcSpanStartColumn = 1, srcSpanEndLine = 346, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-"><span class="mpre">foreign import ccall unsafe &quot;static zlib.h gzread&quot; c_gzread
    :: Ptr () -&gt; Ptr Word8 -&gt; CInt -&gt; IO CInt</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 348, srcSpanStartColumn = 1, srcSpanEndLine = 349, srcSpanEndColumn = 46}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 348, srcSpanStartColumn = 1, srcSpanEndLine = 348, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-"><span class="mpre">foreign import ccall unsafe &quot;static zlib.h gzwrite&quot; c_gzwrite
    :: Ptr () -&gt; Ptr Word8 -&gt; CInt -&gt; IO CInt</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #endif</span></span><span class="mpre">

</span><a href="#loc_353_1_353_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_1_353_13&#39;)"><span class="mpre">gzReadFilePS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_353_1_353_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_1_353_13&#39;)"><span class="hl_fundecl"><span class="mpre">gzReadFilePS</span></span></a><span class="mpre"> </span><a name="loc_353_14_353_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_14_353_15&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = do
    </span><a name="loc_354_5_354_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_5_354_6&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Handle.FD.html#loc_177_1_177_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.FD.html#loc_177_1_177_15&#39;)"><span class="hl_varref"><span class="mpre">openBinaryFile</span></span></a><span class="mpre"> </span><a href="#loc_353_14_353_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_14_353_15&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="GHC.IO.IOMode.html#loc_28_21_28_29" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.IOMode.html#loc_28_21_28_29&#39;)"><span class="hl_conref"><span class="mpre">ReadMode</span></span></a><span class="mpre">
    </span><a name="loc_355_5_355_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_355_5_355_11&#39;)"><span class="hl_vardecl"><span class="mpre">header</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">B.hGet</span></span><span class="mpre"> </span><a href="#loc_354_5_354_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_5_354_6&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">
    if </span><a href="#loc_355_5_355_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_355_5_355_11&#39;)"><span class="hl_varref"><span class="mpre">header</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">BC.pack</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;\31\139&quot;</span></span><span class="mpre">
       then do </span><a href="GHC.IO.Handle.html#loc_86_1_86_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_86_1_86_7&#39;)"><span class="hl_varref"><span class="mpre">hClose</span></span></a><span class="mpre"> </span><a href="#loc_354_5_354_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_5_354_6&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
               </span><a href="#loc_444_1_444_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_444_1_444_11&#39;)"><span class="hl_varref"><span class="mpre">mmapFilePS</span></span></a><span class="mpre"> </span><a href="#loc_353_14_353_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_14_353_15&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">
       else do </span><a href="GHC.IO.Handle.html#loc_386_1_386_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_386_1_386_6&#39;)"><span class="hl_varref"><span class="mpre">hSeek</span></span></a><span class="mpre"> </span><a href="#loc_354_5_354_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_5_354_6&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">SeekFromEnd</span></span><span class="mpre"> (-</span><span class="hl_num"><span class="mpre">4</span></span><span class="mpre">)
               </span><a name="loc_360_16_360_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_16_360_19&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_395_1_395_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_1_395_17&#39;)"><span class="hl_varref"><span class="mpre">hGetLittleEndInt</span></span></a><span class="mpre"> </span><a href="#loc_354_5_354_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_5_354_6&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
               </span><a href="GHC.IO.Handle.html#loc_86_1_86_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_86_1_86_7&#39;)"><span class="hl_varref"><span class="mpre">hClose</span></span></a><span class="mpre"> </span><a href="#loc_354_5_354_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_5_354_6&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #ifdef HAVE_HASKELL_ZLIB</span></span><span class="mpre">
               </span><span class="hl_comment"><span class="mpre">-- Passing the length to GZ.decompressWith means</span></span><span class="mpre">
               </span><span class="hl_comment"><span class="mpre">-- that BL.toChunks only produces one chunk, which in turn</span></span><span class="mpre">
               </span><span class="hl_comment"><span class="mpre">-- means that B.concat won&#39;t need to copy data.</span></span><span class="mpre">
               </span><span class="hl_comment"><span class="mpre">-- If the length is wrong this will just affect efficiency, not correctness</span></span><span class="mpre">
               let </span><a name="loc_367_20_367_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_367_20_367_30&#39;)"><span class="hl_vardecl"><span class="mpre">decompress</span></span></a><span class="mpre"> = </span><a href="Codec.Compression.GZip.html#loc_104_1_104_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Codec.Compression.GZip.html#loc_104_1_104_15&#39;)"><span class="hl_varref"><span class="mpre">GZ.decompressWith</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 367, srcSpanStartColumn = 51, srcSpanEndLine = 369, srcSpanEndColumn = 34}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 367, srcSpanStartColumn = 78, srcSpanEndLine = 367, srcSpanEndColumn = 79},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/ha"><span class="mpre">GZ.defaultDecompressParams {
                                  GZ.decompressBufferSize = len
                                }</span></span><span class="mpre">
               </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">BL.toChunks</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_367_20_367_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_367_20_367_30&#39;)"><span class="hl_varref"><span class="mpre">decompress</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #ifdef HAVE_OLD_BYTESTRING</span></span><span class="mpre">
                        </span><span class="hl_comment"><span class="mpre">-- bytestring &lt; 0.9.1 had a bug where it did not know to close handles upon EOF</span></span><span class="mpre">
                        </span><span class="hl_comment"><span class="mpre">-- performance would be better with a newer bytestring and lazy</span></span><span class="mpre">
                        </span><span class="hl_comment"><span class="mpre">-- readFile below -- ratify readFile: comment</span></span><span class="mpre">
                        </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">BL.fromChunks</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">[])) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
                        </span><span class="hl_varref"><span class="mpre">B.readFile</span></span><span class="mpre"> </span><a href="#loc_353_14_353_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_14_353_15&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ratify readFile: immediately consumed</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #else</span></span><span class="mpre">
                        </span><span class="hl_varref"><span class="mpre">BL.readFile</span></span><span class="mpre"> </span><a href="#loc_353_14_353_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_14_353_15&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ratify readFile: immediately consumed by the conversion to a strict bytestring</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #endif</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #else</span></span><span class="mpre">
               </span><a href="Foreign.C.String.html#loc_176_1_176_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.C.String.html#loc_176_1_176_12&#39;)"><span class="hl_varref"><span class="mpre">withCString</span></span></a><span class="mpre"> </span><a href="#loc_353_14_353_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_14_353_15&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_381_33_381_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_381_33_381_37&#39;)"><span class="hl_vardecl"><span class="mpre">fstr</span></span></a><span class="mpre">-&gt; </span><a href="Foreign.C.String.html#loc_176_1_176_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.C.String.html#loc_176_1_176_12&#39;)"><span class="hl_varref"><span class="mpre">withCString</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;rb&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_381_60_381_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_381_60_381_62&#39;)"><span class="hl_vardecl"><span class="mpre">rb</span></span></a><span class="mpre">-&gt; do
                 </span><a name="loc_382_18_382_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_382_18_382_21&#39;)"><span class="hl_vardecl"><span class="mpre">gzf</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">c_gzopen</span></span><span class="mpre"> </span><a href="#loc_381_33_381_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_381_33_381_37&#39;)"><span class="hl_varref"><span class="mpre">fstr</span></span></a><span class="mpre"> </span><a href="#loc_381_60_381_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_381_60_381_62&#39;)"><span class="hl_varref"><span class="mpre">rb</span></span></a><span class="mpre">
                 </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_382_18_382_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_382_18_382_21&#39;)"><span class="hl_varref"><span class="mpre">gzf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">nullPtr</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fail</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;problem opening file &quot;</span></span><span class="hl_infix"><span class="mpre">++</span></span><a href="#loc_353_14_353_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_14_353_15&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">
                 </span><a name="loc_384_18_384_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_18_384_20&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> &lt;- </span><a href="Data.ByteString.Internal.html#loc_489_1_489_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_489_1_489_17&#39;)"><span class="hl_varref"><span class="mpre">BI.mallocByteString</span></span></a><span class="mpre"> </span><a href="#loc_360_16_360_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_16_360_19&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
                 </span><a href="#loc_108_1_108_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_16&#39;)"><span class="hl_varref"><span class="mpre">debugForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_384_18_384_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_18_384_20&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;gzReadFilePS &quot;</span></span><span class="hl_infix"><span class="mpre">++</span></span><a href="#loc_353_14_353_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_14_353_15&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">
                 </span><a name="loc_386_18_386_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_18_386_23&#39;)"><span class="hl_vardecl"><span class="mpre">lread</span></span></a><span class="mpre"> &lt;- </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="hl_varref"><span class="mpre">withForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_384_18_384_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_18_384_20&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_386_48_386_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_48_386_49&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt;
                          </span><span class="hl_varref"><span class="mpre">c_gzread</span></span><span class="mpre"> </span><a href="#loc_382_18_382_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_382_18_382_21&#39;)"><span class="hl_varref"><span class="mpre">gzf</span></span></a><span class="mpre"> </span><a href="#loc_386_48_386_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_48_386_49&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_360_16_360_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_16_360_19&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">)
                 </span><span class="hl_varref"><span class="mpre">c_gzclose</span></span><span class="mpre"> </span><a href="#loc_382_18_382_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_382_18_382_21&#39;)"><span class="hl_varref"><span class="mpre">gzf</span></span></a><span class="mpre">
                 </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_386_18_386_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_18_386_23&#39;)"><span class="hl_varref"><span class="mpre">lread</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="#loc_360_16_360_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_16_360_19&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
                      </span><span class="hl_varref"><span class="mpre">fail</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;problem gzreading file &quot;</span></span><span class="hl_infix"><span class="mpre">++</span></span><a href="#loc_353_14_353_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_14_353_15&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">
                 </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.ByteString.Internal.html#loc_400_1_400_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_400_1_400_15&#39;)"><span class="hl_varref"><span class="mpre">fromForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_384_18_384_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_18_384_20&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_360_16_360_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_16_360_19&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #endif</span></span><span class="mpre">

</span><a href="#loc_395_1_395_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_1_395_17&#39;)"><span class="mpre">hGetLittleEndInt</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_395_1_395_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_1_395_17&#39;)"><span class="hl_fundecl"><span class="mpre">hGetLittleEndInt</span></span></a><span class="mpre"> </span><a name="loc_395_18_395_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_18_395_19&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> = do
    </span><a name="loc_396_5_396_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_5_396_7&#39;)"><span class="hl_vardecl"><span class="mpre">b1</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">ord</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Text.html#loc_133_1_133_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Text.html#loc_133_1_133_9&#39;)"><span class="hl_varref"><span class="mpre">hGetChar</span></span></a><span class="mpre"> </span><a href="#loc_395_18_395_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_18_395_19&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
    </span><a name="loc_397_5_397_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_397_5_397_7&#39;)"><span class="hl_vardecl"><span class="mpre">b2</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">ord</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Text.html#loc_133_1_133_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Text.html#loc_133_1_133_9&#39;)"><span class="hl_varref"><span class="mpre">hGetChar</span></span></a><span class="mpre"> </span><a href="#loc_395_18_395_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_18_395_19&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
    </span><a name="loc_398_5_398_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_398_5_398_7&#39;)"><span class="hl_vardecl"><span class="mpre">b3</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">ord</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Text.html#loc_133_1_133_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Text.html#loc_133_1_133_9&#39;)"><span class="hl_varref"><span class="mpre">hGetChar</span></span></a><span class="mpre"> </span><a href="#loc_395_18_395_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_18_395_19&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
    </span><a name="loc_399_5_399_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_399_5_399_7&#39;)"><span class="hl_vardecl"><span class="mpre">b4</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">ord</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Text.html#loc_133_1_133_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Text.html#loc_133_1_133_9&#39;)"><span class="hl_varref"><span class="mpre">hGetChar</span></span></a><span class="mpre"> </span><a href="#loc_395_18_395_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_18_395_19&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_396_5_396_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_5_396_7&#39;)"><span class="hl_varref"><span class="mpre">b1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">256</span></span><span class="hl_infix"><span class="mpre">*</span></span><a href="#loc_397_5_397_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_397_5_397_7&#39;)"><span class="hl_varref"><span class="mpre">b2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">65536</span></span><span class="hl_infix"><span class="mpre">*</span></span><a href="#loc_398_5_398_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_398_5_398_7&#39;)"><span class="hl_varref"><span class="mpre">b3</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">16777216</span></span><span class="hl_infix"><span class="mpre">*</span></span><a href="#loc_399_5_399_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_399_5_399_7&#39;)"><span class="hl_varref"><span class="mpre">b4</span></span></a><span class="mpre">

</span><a href="#loc_403_1_403_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_1_403_14&#39;)"><span class="mpre">gzWriteFilePS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_403_1_403_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_1_403_14&#39;)"><span class="hl_fundecl"><span class="mpre">gzWriteFilePS</span></span></a><span class="mpre"> </span><a name="loc_403_15_403_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_15_403_16&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_403_17_403_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_17_403_19&#39;)"><span class="hl_vardecl"><span class="mpre">ps</span></span></a><span class="mpre"> = </span><a href="#loc_406_1_406_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_406_1_406_15&#39;)"><span class="hl_varref"><span class="mpre">gzWriteFilePSs</span></span></a><span class="mpre"> </span><a href="#loc_403_15_403_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_15_403_16&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> [</span><a href="#loc_403_17_403_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_17_403_19&#39;)"><span class="hl_varref"><span class="mpre">ps</span></span></a><span class="mpre">]

</span><a href="#loc_406_1_406_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_406_1_406_15&#39;)"><span class="mpre">gzWriteFilePSs</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_406_1_406_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_406_1_406_15&#39;)"><span class="hl_fundecl"><span class="mpre">gzWriteFilePSs</span></span></a><span class="mpre"> </span><a name="loc_406_16_406_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_406_16_406_17&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_406_18_406_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_406_18_406_21&#39;)"><span class="hl_vardecl"><span class="mpre">pss</span></span></a><span class="mpre">  =
</span><span class="hl_comment"><span class="mpre">-- #ifdef HAVE_HASKELL_ZLIB</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">BL.writeFile</span></span><span class="mpre"> </span><a href="#loc_406_16_406_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_406_16_406_17&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Codec.Compression.GZip.html#loc_117_1_117_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Codec.Compression.GZip.html#loc_117_1_117_9&#39;)"><span class="hl_varref"><span class="mpre">GZ.compress</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">BL.fromChunks</span></span><span class="mpre"> </span><a href="#loc_406_18_406_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_406_18_406_21&#39;)"><span class="hl_varref"><span class="mpre">pss</span></span></a><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #else</span></span><span class="mpre">
    </span><a href="Foreign.C.String.html#loc_176_1_176_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.C.String.html#loc_176_1_176_12&#39;)"><span class="hl_varref"><span class="mpre">withCString</span></span></a><span class="mpre"> </span><a href="#loc_406_16_406_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_406_16_406_17&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_410_22_410_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_22_410_26&#39;)"><span class="hl_vardecl"><span class="mpre">fstr</span></span></a><span class="mpre"> -&gt; </span><a href="Foreign.C.String.html#loc_176_1_176_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.C.String.html#loc_176_1_176_12&#39;)"><span class="hl_varref"><span class="mpre">withCString</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;wb&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_410_50_410_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_50_410_52&#39;)"><span class="hl_vardecl"><span class="mpre">wb</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_411_5_411_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_411_5_411_8&#39;)"><span class="hl_vardecl"><span class="mpre">gzf</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">c_gzopen</span></span><span class="mpre"> </span><a href="#loc_410_22_410_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_22_410_26&#39;)"><span class="hl_varref"><span class="mpre">fstr</span></span></a><span class="mpre"> </span><a href="#loc_410_50_410_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_50_410_52&#39;)"><span class="hl_varref"><span class="mpre">wb</span></span></a><span class="mpre">
    </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_411_5_411_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_411_5_411_8&#39;)"><span class="hl_varref"><span class="mpre">gzf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">nullPtr</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fail</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;problem gzopening file for write: &quot;</span></span><span class="hl_infix"><span class="mpre">++</span></span><a href="#loc_406_16_406_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_406_16_406_17&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">
    </span><a href="Control.Monad.html#loc_116_1_116_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_116_1_116_6&#39;)"><span class="hl_varref"><span class="mpre">mapM_</span></span></a><span class="mpre"> (</span><a href="#loc_418_1_418_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_418_1_418_13&#39;)"><span class="hl_varref"><span class="mpre">gzWriteToGzf</span></span></a><span class="mpre"> </span><a href="#loc_411_5_411_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_411_5_411_8&#39;)"><span class="hl_varref"><span class="mpre">gzf</span></span></a><span class="mpre">) </span><a href="#loc_406_18_406_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_406_18_406_21&#39;)"><span class="hl_varref"><span class="mpre">pss</span></span></a><span class="mpre"> </span><a href="Control.Exception.Base.html#loc_150_1_150_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_150_1_150_6&#39;)"><span class="hl_infix"><span class="mpre">`catch`</span></span></a><span class="mpre">
              \_ -&gt; </span><span class="hl_varref"><span class="mpre">fail</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;problem gzwriting file: &quot;</span></span><span class="hl_infix"><span class="mpre">++</span></span><a href="#loc_406_16_406_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_406_16_406_17&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">c_gzclose</span></span><span class="mpre"> </span><a href="#loc_411_5_411_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_411_5_411_8&#39;)"><span class="hl_varref"><span class="mpre">gzf</span></span></a><span class="mpre">

</span><a href="#loc_418_1_418_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_418_1_418_13&#39;)"><span class="mpre">gzWriteToGzf</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_418_1_418_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_418_1_418_13&#39;)"><span class="hl_fundecl"><span class="mpre">gzWriteToGzf</span></span></a><span class="mpre"> </span><a name="loc_418_14_418_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_418_14_418_17&#39;)"><span class="hl_vardecl"><span class="mpre">gzf</span></span></a><span class="mpre"> </span><a name="loc_418_18_418_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_418_18_418_20&#39;)"><span class="hl_vardecl"><span class="mpre">ps</span></span></a><span class="mpre"> = case </span><a href="Data.ByteString.Internal.html#loc_405_1_405_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_405_1_405_13&#39;)"><span class="hl_varref"><span class="mpre">BI.toForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_418_18_418_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_418_18_418_20&#39;)"><span class="hl_varref"><span class="mpre">ps</span></span></a><span class="mpre"> of
 (_,_,</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">) -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- avoid calling gzwrite with 0 length this would</span></span><span class="mpre">
                      </span><span class="hl_comment"><span class="mpre">-- trouble on some versions of zlib, and is always</span></span><span class="mpre">
                      </span><span class="hl_comment"><span class="mpre">-- unnecessary.</span></span><span class="mpre">
 (</span><a name="loc_422_3_422_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_3_422_4&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">,</span><a name="loc_422_5_422_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_5_422_6&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">,</span><a name="loc_422_7_422_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_7_422_8&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) -&gt; do
    </span><a name="loc_423_5_423_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_423_5_423_7&#39;)"><span class="hl_vardecl"><span class="mpre">lw</span></span></a><span class="mpre"> &lt;- </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="hl_varref"><span class="mpre">withForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_422_3_422_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_3_422_4&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_423_31_423_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_423_31_423_32&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">c_gzwrite</span></span><span class="mpre"> </span><a href="#loc_418_14_418_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_418_14_418_17&#39;)"><span class="hl_varref"><span class="mpre">gzf</span></span></a><span class="mpre"> (</span><a href="#loc_423_31_423_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_423_31_423_32&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_422_5_422_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_5_422_6&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)
                                                 (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_422_7_422_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_7_422_8&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">)
    </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_423_5_423_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_423_5_423_7&#39;)"><span class="hl_varref"><span class="mpre">lw</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="#loc_422_7_422_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_7_422_8&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fail</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;problem in gzWriteToGzf&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #endif</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- mmapFilePS</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Like readFilePS, this reads an entire file directly into a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;B.ByteString&#39;, but it is even more efficient.  It involves directly</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- mapping the file to memory.  This has the advantage that the contents of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the file never need to be copied.  Also, under memory pressure the page</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- may simply be discarded, wile in the case of readFilePS it would need to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- be written to swap.  If you read many small files, mmapFilePS will be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- less memory-efficient than readFilePS, since each mmapFilePS takes up a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- separate page of memory.  Also, you can run into bus errors if the file</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is modified.  NOTE: as with &#39;readFilePS&#39;, the string representation in</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the file is assumed to be ISO-8859-1.</span></span><span class="mpre">

</span><a href="#loc_444_1_444_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_444_1_444_11&#39;)"><span class="mpre">mmapFilePS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #ifdef HAVE_MMAP</span></span><span class="mpre">
</span><a name="loc_444_1_444_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_444_1_444_11&#39;)"><span class="hl_fundecl"><span class="mpre">mmapFilePS</span></span></a><span class="mpre"> </span><a name="loc_444_12_444_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_444_12_444_13&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = do
  </span><a name="loc_445_3_445_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_445_3_445_4&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">mmapFileByteString</span></span><span class="mpre"> </span><a href="#loc_444_12_444_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_444_12_444_13&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
   </span><a href="Control.Exception.Base.html#loc_150_1_150_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_150_1_150_6&#39;)"><span class="hl_infix"><span class="mpre">`catch`</span></span></a><span class="mpre"> (\_ -&gt; do
                     </span><a name="loc_447_22_447_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_22_447_26&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">fileSize</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">getSymbolicLinkStatus</span></span><span class="mpre"> </span><a href="#loc_444_12_444_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_444_12_444_13&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">
                     if </span><a href="#loc_447_22_447_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_22_447_26&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
                        then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">
                        else </span><a href="System.Mem.html#loc_26_1_26_10" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Mem.html#loc_26_1_26_10&#39;)"><span class="hl_varref"><span class="mpre">performGC</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">mmapFileByteString</span></span><span class="mpre"> </span><a href="#loc_444_12_444_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_444_12_444_13&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">)
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_445_3_445_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_445_3_445_4&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #else</span></span><span class="mpre">
</span><span class="hl_vardecl"><span class="mpre">mmapFilePS</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.readFile</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #endif</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- fromPS2Hex</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 459, srcSpanStartColumn = 1, srcSpanEndLine = 460, srcSpanEndColumn = 47}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 459, srcSpanStartColumn = 1, srcSpanEndLine = 459, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-"><span class="mpre">foreign import ccall unsafe &quot;static fpstring.h conv_to_hex&quot; conv_to_hex
    :: Ptr Word8 -&gt; Ptr Word8 -&gt; CInt -&gt; IO ()</span></span><span class="mpre">

</span><a href="#loc_463_1_463_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_1_463_11&#39;)"><span class="mpre">fromPS2Hex</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_463_1_463_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_1_463_11&#39;)"><span class="hl_fundecl"><span class="mpre">fromPS2Hex</span></span></a><span class="mpre"> </span><a name="loc_463_12_463_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_12_463_14&#39;)"><span class="hl_vardecl"><span class="mpre">ps</span></span></a><span class="mpre"> = case </span><a href="Data.ByteString.Internal.html#loc_405_1_405_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_405_1_405_13&#39;)"><span class="hl_varref"><span class="mpre">BI.toForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_463_12_463_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_12_463_14&#39;)"><span class="hl_varref"><span class="mpre">ps</span></span></a><span class="mpre"> of
          (</span><a name="loc_464_12_464_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_12_464_13&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">,</span><a name="loc_464_14_464_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_14_464_15&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">,</span><a name="loc_464_16_464_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_16_464_17&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) -&gt;
           </span><a href="Data.ByteString.Internal.html#loc_411_1_411_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_411_1_411_13&#39;)"><span class="hl_varref"><span class="mpre">BI.unsafeCreate</span></span></a><span class="mpre"> (</span><span class="hl_num"><span class="mpre">2</span></span><span class="hl_infix"><span class="mpre">*</span></span><a href="#loc_464_16_464_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_16_464_17&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_465_37_465_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_465_37_465_38&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="hl_varref"><span class="mpre">withForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_464_12_464_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_12_464_13&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_465_62_465_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_465_62_465_63&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> -&gt;
           </span><span class="hl_varref"><span class="mpre">conv_to_hex</span></span><span class="mpre"> </span><a href="#loc_465_37_465_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_465_37_465_38&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> (</span><a href="#loc_465_62_465_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_465_62_465_63&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_464_14_464_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_14_464_15&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_464_16_464_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_16_464_17&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- fromHex2PS</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 471, srcSpanStartColumn = 1, srcSpanEndLine = 472, srcSpanEndColumn = 47}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-src-exts-1.14.0.1/Test/examples/ByteStringUtils.hs&quot;, srcSpanStartLine = 471, srcSpanStartColumn = 1, srcSpanEndLine = 471, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/haskell-"><span class="mpre">foreign import ccall unsafe &quot;static fpstring.h conv_from_hex&quot; conv_from_hex
    :: Ptr Word8 -&gt; Ptr Word8 -&gt; CInt -&gt; IO ()</span></span><span class="mpre">

</span><a href="#loc_475_1_475_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_1_475_11&#39;)"><span class="mpre">fromHex2PS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_475_1_475_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_1_475_11&#39;)"><span class="hl_fundecl"><span class="mpre">fromHex2PS</span></span></a><span class="mpre"> </span><a name="loc_475_12_475_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_12_475_14&#39;)"><span class="hl_vardecl"><span class="mpre">ps</span></span></a><span class="mpre"> = case </span><a href="Data.ByteString.Internal.html#loc_405_1_405_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_405_1_405_13&#39;)"><span class="hl_varref"><span class="mpre">BI.toForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_475_12_475_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_12_475_14&#39;)"><span class="hl_varref"><span class="mpre">ps</span></span></a><span class="mpre"> of
          (</span><a name="loc_476_12_476_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_476_12_476_13&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">,</span><a name="loc_476_14_476_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_476_14_476_15&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">,</span><a name="loc_476_16_476_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_476_16_476_17&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) -&gt;
           </span><a href="Data.ByteString.Internal.html#loc_411_1_411_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_411_1_411_13&#39;)"><span class="hl_varref"><span class="mpre">BI.unsafeCreate</span></span></a><span class="mpre"> (</span><a href="#loc_476_16_476_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_476_16_476_17&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`div`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_477_43_477_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_477_43_477_44&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="hl_varref"><span class="mpre">withForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_476_12_476_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_476_12_476_13&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_477_68_477_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_477_68_477_69&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> -&gt;
           </span><span class="hl_varref"><span class="mpre">conv_from_hex</span></span><span class="mpre"> </span><a href="#loc_477_43_477_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_477_43_477_44&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> (</span><a href="#loc_477_68_477_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_477_68_477_69&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_476_14_476_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_476_14_476_15&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_476_16_476_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_476_16_476_17&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`div`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- -------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- betweenLinesPS</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | betweenLinesPS returns the B.ByteString between the two lines given,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- or Nothing if they do not appear.</span></span><span class="mpre">

</span><a href="#loc_488_1_488_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_488_1_488_15&#39;)"><span class="mpre">betweenLinesPS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
               -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">)
</span><a name="loc_488_1_488_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_488_1_488_15&#39;)"><span class="hl_fundecl"><span class="mpre">betweenLinesPS</span></span></a><span class="mpre"> </span><a name="loc_488_16_488_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_488_16_488_21&#39;)"><span class="hl_vardecl"><span class="mpre">start</span></span></a><span class="mpre"> </span><a name="loc_488_22_488_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_488_22_488_25&#39;)"><span class="hl_vardecl"><span class="mpre">end</span></span></a><span class="mpre"> </span><a name="loc_488_26_488_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_488_26_488_28&#39;)"><span class="hl_vardecl"><span class="mpre">ps</span></span></a><span class="mpre">
 = case </span><span class="hl_varref"><span class="mpre">break</span></span><span class="mpre"> (</span><a href="#loc_488_16_488_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_488_16_488_21&#39;)"><span class="hl_varref"><span class="mpre">start</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre">) (</span><a href="#loc_294_1_294_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_1_294_8&#39;)"><span class="hl_varref"><span class="mpre">linesPS</span></span></a><span class="mpre"> </span><a href="#loc_488_26_488_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_488_26_488_28&#39;)"><span class="hl_varref"><span class="mpre">ps</span></span></a><span class="mpre">) of
       (_, _</span><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_490_14_490_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_490_14_490_18&#39;)"><span class="hl_specname"><span class="mpre">rest</span></span></a><span class="mpre">@(</span><a name="loc_490_20_490_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_490_20_490_23&#39;)"><span class="hl_vardecl"><span class="mpre">bs1</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_)) -&gt;
           case </span><a href="Data.ByteString.Internal.html#loc_405_1_405_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_405_1_405_13&#39;)"><span class="hl_varref"><span class="mpre">BI.toForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_490_20_490_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_490_20_490_23&#39;)"><span class="hl_varref"><span class="mpre">bs1</span></span></a><span class="mpre"> of
            (</span><a name="loc_492_14_492_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_14_492_17&#39;)"><span class="hl_vardecl"><span class="mpre">ps1</span></span></a><span class="mpre">,</span><a name="loc_492_18_492_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_18_492_20&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">,_) -&gt;
             case </span><span class="hl_varref"><span class="mpre">break</span></span><span class="mpre"> (</span><a href="#loc_488_22_488_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_488_22_488_25&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre">) </span><a href="#loc_490_14_490_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_490_14_490_18&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre"> of
               (_, </span><a name="loc_494_20_494_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_20_494_23&#39;)"><span class="hl_vardecl"><span class="mpre">bs2</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_) -&gt; case </span><a href="Data.ByteString.Internal.html#loc_405_1_405_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_405_1_405_13&#39;)"><span class="hl_varref"><span class="mpre">BI.toForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_494_20_494_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_20_494_23&#39;)"><span class="hl_varref"><span class="mpre">bs2</span></span></a><span class="mpre"> of (_,</span><a name="loc_494_61_494_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_61_494_63&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">,_) -&gt; </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.ByteString.Internal.html#loc_400_1_400_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_400_1_400_15&#39;)"><span class="hl_varref"><span class="mpre">fromForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_492_14_492_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_14_492_17&#39;)"><span class="hl_varref"><span class="mpre">ps1</span></span></a><span class="mpre"> </span><a href="#loc_492_18_492_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_18_492_20&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre"> (</span><a href="#loc_494_61_494_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_61_494_63&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_492_18_492_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_18_492_20&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre">)
               _ -&gt; </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
       _ -&gt; </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- break_after_nth_newline</span></span><span class="mpre">

</span><a href="#loc_503_1_503_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_503_1_503_24&#39;)"><span class="mpre">break_after_nth_newline</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
                        -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">)
</span><a name="loc_503_1_503_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_503_1_503_24&#39;)"><span class="hl_fundecl"><span class="mpre">break_after_nth_newline</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a name="loc_503_27_503_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_503_27_503_33&#39;)"><span class="hl_vardecl"><span class="mpre">the_ps</span></span></a><span class="mpre"> | </span><span class="hl_varref"><span class="mpre">B.null</span></span><span class="mpre"> </span><a href="#loc_503_27_503_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_503_27_503_33&#39;)"><span class="hl_varref"><span class="mpre">the_ps</span></span></a><span class="mpre"> = </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">, </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">)
</span><a href="#loc_503_1_503_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_503_1_503_24&#39;)"><span class="hl_fundecl"><span class="mpre">break_after_nth_newline</span></span></a><span class="mpre"> </span><a name="loc_504_25_504_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_504_25_504_26&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> </span><a name="loc_504_27_504_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_504_27_504_33&#39;)"><span class="hl_vardecl"><span class="mpre">the_ps</span></span></a><span class="mpre"> =
  case </span><a href="Data.ByteString.Internal.html#loc_405_1_405_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_405_1_405_13&#39;)"><span class="hl_varref"><span class="mpre">BI.toForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_504_27_504_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_504_27_504_33&#39;)"><span class="hl_varref"><span class="mpre">the_ps</span></span></a><span class="mpre"> of
  (</span><a name="loc_506_4_506_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_506_4_506_6&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre">,</span><a name="loc_506_7_506_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_506_7_506_12&#39;)"><span class="hl_vardecl"><span class="mpre">the_s</span></span></a><span class="mpre">,</span><a name="loc_506_13_506_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_506_13_506_14&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) -&gt;
   </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="hl_varref"><span class="mpre">withForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_506_4_506_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_506_4_506_6&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_507_43_507_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_507_43_507_44&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt;
   do let </span><a name="loc_508_11_508_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_508_11_508_17&#39;)"><span class="hl_fundecl"><span class="mpre">findit</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a name="loc_508_20_508_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_508_20_508_21&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> | </span><a href="#loc_508_20_508_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_508_20_508_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_517_11_517_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_517_11_517_14&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a href="#loc_504_27_504_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_504_27_504_33&#39;)"><span class="hl_varref"><span class="mpre">the_ps</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">)
          </span><a href="#loc_508_11_508_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_508_11_508_17&#39;)"><span class="hl_fundecl"><span class="mpre">findit</span></span></a><span class="mpre"> _ </span><a name="loc_509_20_509_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_509_20_509_21&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> | </span><a href="#loc_509_20_509_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_509_20_509_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_517_11_517_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_517_11_517_14&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
          </span><a href="#loc_508_11_508_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_508_11_508_17&#39;)"><span class="hl_fundecl"><span class="mpre">findit</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a name="loc_510_20_510_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_510_20_510_21&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = let </span><a name="loc_510_28_510_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_510_28_510_34&#39;)"><span class="hl_vardecl"><span class="mpre">left_l</span></span></a><span class="mpre"> = </span><a href="#loc_510_20_510_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_510_20_510_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_506_7_506_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_506_7_506_12&#39;)"><span class="hl_varref"><span class="mpre">the_s</span></span></a><span class="mpre">
                       in </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Internal.html#loc_400_1_400_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_400_1_400_15&#39;)"><span class="hl_varref"><span class="mpre">fromForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_506_4_506_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_506_4_506_6&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a href="#loc_506_7_506_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_506_7_506_12&#39;)"><span class="hl_varref"><span class="mpre">the_s</span></span></a><span class="mpre"> </span><a href="#loc_510_28_510_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_510_28_510_34&#39;)"><span class="hl_varref"><span class="mpre">left_l</span></span></a><span class="mpre">,
                                         </span><a href="Data.ByteString.Internal.html#loc_400_1_400_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_400_1_400_15&#39;)"><span class="hl_varref"><span class="mpre">fromForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_506_4_506_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_506_4_506_6&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a href="#loc_510_20_510_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_510_20_510_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> (</span><a href="#loc_506_13_506_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_506_13_506_14&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_510_28_510_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_510_28_510_34&#39;)"><span class="hl_varref"><span class="mpre">left_l</span></span></a><span class="mpre">))
          </span><a href="#loc_508_11_508_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_508_11_508_17&#39;)"><span class="hl_fundecl"><span class="mpre">findit</span></span></a><span class="mpre"> </span><a name="loc_513_18_513_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_513_18_513_19&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> </span><a name="loc_513_20_513_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_513_20_513_21&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = do </span><a name="loc_513_27_513_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_513_27_513_28&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekElemOff</span></span><span class="mpre"> </span><a href="#loc_507_43_507_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_507_43_507_44&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_513_20_513_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_513_20_513_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
                          if </span><a href="#loc_513_27_513_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_513_27_513_28&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_516_11_516_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_516_11_516_13&#39;)"><span class="hl_varref"><span class="mpre">nl</span></span></a><span class="mpre"> then </span><a href="#loc_508_11_508_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_508_11_508_17&#39;)"><span class="hl_varref"><span class="mpre">findit</span></span></a><span class="mpre"> (</span><a href="#loc_513_18_513_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_513_18_513_19&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><a href="#loc_513_20_513_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_513_20_513_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
                                     else </span><a href="#loc_508_11_508_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_508_11_508_17&#39;)"><span class="hl_varref"><span class="mpre">findit</span></span></a><span class="mpre"> </span><a href="#loc_513_18_513_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_513_18_513_19&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> (</span><a href="#loc_513_20_513_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_513_20_513_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
          </span><a name="loc_516_11_516_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_516_11_516_13&#39;)"><span class="hl_vardecl"><span class="mpre">nl</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Internal.html#loc_554_1_554_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_554_1_554_4&#39;)"><span class="hl_varref"><span class="mpre">BI.c2w</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre">
          </span><a name="loc_517_11_517_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_517_11_517_14&#39;)"><span class="hl_vardecl"><span class="mpre">end</span></span></a><span class="mpre"> = </span><a href="#loc_506_7_506_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_506_7_506_12&#39;)"><span class="hl_varref"><span class="mpre">the_s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_506_13_506_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_506_13_506_14&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
      </span><a href="#loc_508_11_508_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_508_11_508_17&#39;)"><span class="hl_varref"><span class="mpre">findit</span></span></a><span class="mpre"> </span><a href="#loc_504_25_504_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_504_25_504_26&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_506_7_506_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_506_7_506_12&#39;)"><span class="hl_varref"><span class="mpre">the_s</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- break_before_nth_newline</span></span><span class="mpre">

</span><a href="#loc_524_1_524_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_524_1_524_25&#39;)"><span class="mpre">break_before_nth_newline</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">)
</span><a name="loc_524_1_524_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_524_1_524_25&#39;)"><span class="hl_fundecl"><span class="mpre">break_before_nth_newline</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a name="loc_524_28_524_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_524_28_524_34&#39;)"><span class="hl_vardecl"><span class="mpre">the_ps</span></span></a><span class="mpre">
 | </span><span class="hl_varref"><span class="mpre">B.null</span></span><span class="mpre"> </span><a href="#loc_524_28_524_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_524_28_524_34&#39;)"><span class="hl_varref"><span class="mpre">the_ps</span></span></a><span class="mpre"> = (</span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">, </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">)
</span><a href="#loc_524_1_524_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_524_1_524_25&#39;)"><span class="hl_fundecl"><span class="mpre">break_before_nth_newline</span></span></a><span class="mpre"> </span><a name="loc_526_26_526_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_526_26_526_27&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> </span><a name="loc_526_28_526_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_526_28_526_34&#39;)"><span class="hl_vardecl"><span class="mpre">the_ps</span></span></a><span class="mpre"> =
 case </span><a href="Data.ByteString.Internal.html#loc_405_1_405_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_405_1_405_13&#39;)"><span class="hl_varref"><span class="mpre">BI.toForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_526_28_526_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_526_28_526_34&#39;)"><span class="hl_varref"><span class="mpre">the_ps</span></span></a><span class="mpre"> of
 (</span><a name="loc_528_3_528_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_528_3_528_5&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre">,</span><a name="loc_528_6_528_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_528_6_528_11&#39;)"><span class="hl_vardecl"><span class="mpre">the_s</span></span></a><span class="mpre">,</span><a name="loc_528_12_528_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_528_12_528_13&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) -&gt;
   </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="hl_varref"><span class="mpre">withForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_528_3_528_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_528_3_528_5&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_529_43_529_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_529_43_529_44&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt;
   do let </span><a name="loc_530_11_530_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_530_11_530_17&#39;)"><span class="hl_fundecl"><span class="mpre">findit</span></span></a><span class="mpre"> _ </span><a name="loc_530_20_530_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_530_20_530_21&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> | </span><a href="#loc_530_20_530_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_530_20_530_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_540_11_540_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_540_11_540_14&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_526_28_526_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_526_28_526_34&#39;)"><span class="hl_varref"><span class="mpre">the_ps</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">)
          </span><a href="#loc_530_11_530_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_530_11_530_17&#39;)"><span class="hl_fundecl"><span class="mpre">findit</span></span></a><span class="mpre"> </span><a name="loc_531_18_531_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_531_18_531_19&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> </span><a name="loc_531_20_531_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_531_20_531_21&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = do </span><a name="loc_531_27_531_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_531_27_531_28&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekElemOff</span></span><span class="mpre"> </span><a href="#loc_529_43_529_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_529_43_529_44&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_531_20_531_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_531_20_531_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
                          if </span><a href="#loc_531_27_531_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_531_27_531_28&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_539_11_539_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_11_539_13&#39;)"><span class="hl_varref"><span class="mpre">nl</span></span></a><span class="mpre">
                            then if </span><a href="#loc_531_18_531_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_531_18_531_19&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
                                 then let </span><a name="loc_534_43_534_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_43_534_49&#39;)"><span class="hl_vardecl"><span class="mpre">left_l</span></span></a><span class="mpre"> = </span><a href="#loc_531_20_531_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_531_20_531_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_528_6_528_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_528_6_528_11&#39;)"><span class="hl_varref"><span class="mpre">the_s</span></span></a><span class="mpre">
                                      in </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Data.ByteString.Internal.html#loc_400_1_400_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_400_1_400_15&#39;)"><span class="hl_varref"><span class="mpre">fromForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_528_3_528_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_528_3_528_5&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a href="#loc_528_6_528_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_528_6_528_11&#39;)"><span class="hl_varref"><span class="mpre">the_s</span></span></a><span class="mpre"> </span><a href="#loc_534_43_534_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_43_534_49&#39;)"><span class="hl_varref"><span class="mpre">left_l</span></span></a><span class="mpre">,
                                                 </span><a href="Data.ByteString.Internal.html#loc_400_1_400_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_400_1_400_15&#39;)"><span class="hl_varref"><span class="mpre">fromForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_528_3_528_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_528_3_528_5&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a href="#loc_531_20_531_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_531_20_531_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> (</span><a href="#loc_528_12_528_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_528_12_528_13&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_534_43_534_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_43_534_49&#39;)"><span class="hl_varref"><span class="mpre">left_l</span></span></a><span class="mpre">))
                                 else </span><a href="#loc_530_11_530_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_530_11_530_17&#39;)"><span class="hl_varref"><span class="mpre">findit</span></span></a><span class="mpre"> (</span><a href="#loc_531_18_531_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_531_18_531_19&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><a href="#loc_531_20_531_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_531_20_531_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
                            else </span><a href="#loc_530_11_530_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_530_11_530_17&#39;)"><span class="hl_varref"><span class="mpre">findit</span></span></a><span class="mpre"> </span><a href="#loc_531_18_531_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_531_18_531_19&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> (</span><a href="#loc_531_20_531_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_531_20_531_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
          </span><a name="loc_539_11_539_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_11_539_13&#39;)"><span class="hl_vardecl"><span class="mpre">nl</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Internal.html#loc_554_1_554_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_554_1_554_4&#39;)"><span class="hl_varref"><span class="mpre">BI.c2w</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre">
          </span><a name="loc_540_11_540_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_540_11_540_14&#39;)"><span class="hl_vardecl"><span class="mpre">end</span></span></a><span class="mpre"> = </span><a href="#loc_528_6_528_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_528_6_528_11&#39;)"><span class="hl_varref"><span class="mpre">the_s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_528_12_528_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_528_12_528_13&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
      </span><a href="#loc_530_11_530_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_530_11_530_17&#39;)"><span class="hl_varref"><span class="mpre">findit</span></span></a><span class="mpre"> </span><a href="#loc_526_26_526_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_526_26_526_27&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_528_6_528_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_528_6_528_11&#39;)"><span class="hl_varref"><span class="mpre">the_s</span></span></a><span class="mpre">
</span></div></body></html>