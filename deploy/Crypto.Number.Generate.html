<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Crypto.Number.Generate</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : Good</span></span><span class="mpre">

module Crypto.Number.Generate
    ( generateMax
    , generateBetween
    , generateOfSize
    ) where

import Crypto.Number.Serialize
import Crypto.Random.API
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-numbers-0.2.3/Crypto/Number/Generate.hs&quot;, srcSpanStartLine = 16, srcSpanStartColumn = 18, srcSpanEndLine = 16, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import Data.Bits ((.|.))

</span><span class="hl_comment"><span class="mpre">-- | generate a positive integer x, s.t. 0 &lt;= x &lt; m</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that depending on m value, the number distribution</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- generated by this function is not necessarily uniform.</span></span><span class="mpre">
</span><a href="#loc_24_1_24_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_1_24_12&#39;)"><span class="mpre">generateMax</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-numbers-0.2.3/Crypto/Number/Generate.hs&quot;, srcSpanStartLine = 23, srcSpanStartColumn = 16, srcSpanEndLine = 23, srcSpanEndColumn = 25}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-numbers-0.2.3/Crypto/Number/Generate.hs&quot;, srcSpanStartLine = 23, srcSpanStartColumn = 23, srcSpanEndLine = 23, srcSpanEndColumn = 25}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemn"><span class="mpre">CPRG g =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">, </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">)
</span><a name="loc_24_1_24_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_1_24_12&#39;)"><span class="hl_fundecl"><span class="mpre">generateMax</span></span></a><span class="mpre"> </span><a name="loc_24_13_24_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_13_24_16&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a name="loc_24_17_24_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_17_24_18&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><a href="Crypto.Random.html#loc_56_1_56_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.html#loc_56_1_56_16&#39;)"><span class="hl_varref"><span class="mpre">withRandomBytes</span></span></a><span class="mpre"> </span><a href="#loc_24_13_24_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_13_24_16&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre"> (</span><a href="Crypto.Number.Serialize.html#loc_141_1_141_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.Serialize.html#loc_141_1_141_12&#39;)"><span class="hl_varref"><span class="mpre">lengthBytes</span></span></a><span class="mpre"> </span><a href="#loc_24_17_24_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_17_24_18&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_24_60_24_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_60_24_62&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> -&gt;
    </span><a href="Crypto.Number.Serialize.html#loc_49_1_49_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.Serialize.html#loc_49_1_49_6&#39;)"><span class="hl_varref"><span class="mpre">os2ip</span></span></a><span class="mpre"> </span><a href="#loc_24_60_24_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_60_24_62&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`mod`</span></span><span class="mpre"> </span><a href="#loc_24_17_24_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_17_24_18&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | generate a number between the inclusive bound [low,high].</span></span><span class="mpre">
</span><a href="#loc_29_1_29_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_1_29_16&#39;)"><span class="mpre">generateBetween</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-numbers-0.2.3/Crypto/Number/Generate.hs&quot;, srcSpanStartLine = 28, srcSpanStartColumn = 20, srcSpanEndLine = 28, srcSpanEndColumn = 29}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-numbers-0.2.3/Crypto/Number/Generate.hs&quot;, srcSpanStartLine = 28, srcSpanStartColumn = 27, srcSpanEndLine = 28, srcSpanEndColumn = 29}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemn"><span class="mpre">CPRG g =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">, </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">)
</span><a name="loc_29_1_29_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_1_29_16&#39;)"><span class="hl_fundecl"><span class="mpre">generateBetween</span></span></a><span class="mpre"> </span><a name="loc_29_17_29_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_17_29_20&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a name="loc_29_21_29_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_21_29_24&#39;)"><span class="hl_vardecl"><span class="mpre">low</span></span></a><span class="mpre"> </span><a name="loc_29_25_29_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_25_29_29&#39;)"><span class="hl_vardecl"><span class="mpre">high</span></span></a><span class="mpre"> = (</span><a href="#loc_29_21_29_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_21_29_24&#39;)"><span class="hl_varref"><span class="mpre">low</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_30_12_30_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_12_30_13&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">, </span><a href="#loc_30_15_30_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_15_30_19&#39;)"><span class="hl_varref"><span class="mpre">rng&#39;</span></span></a><span class="mpre">)
    where (</span><a name="loc_30_12_30_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_12_30_13&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre">, </span><a name="loc_30_15_30_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_15_30_19&#39;)"><span class="hl_vardecl"><span class="mpre">rng&#39;</span></span></a><span class="mpre">) = </span><a href="#loc_24_1_24_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_1_24_12&#39;)"><span class="hl_varref"><span class="mpre">generateMax</span></span></a><span class="mpre"> </span><a href="#loc_29_17_29_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_17_29_20&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre"> (</span><a href="#loc_29_25_29_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_25_29_29&#39;)"><span class="hl_varref"><span class="mpre">high</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_29_21_29_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_21_29_24&#39;)"><span class="hl_varref"><span class="mpre">low</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | generate a positive integer of a specific size in bits.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the number of bits need to be multiple of 8. It will always returns</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- an integer that is close to 2^(1+bits/8) by setting the 2 highest bits to 1.</span></span><span class="mpre">
</span><a href="#loc_36_1_36_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_15&#39;)"><span class="mpre">generateOfSize</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-numbers-0.2.3/Crypto/Number/Generate.hs&quot;, srcSpanStartLine = 35, srcSpanStartColumn = 19, srcSpanEndLine = 35, srcSpanEndColumn = 28}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-numbers-0.2.3/Crypto/Number/Generate.hs&quot;, srcSpanStartLine = 35, srcSpanStartColumn = 26, srcSpanEndLine = 35, srcSpanEndColumn = 28}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemn"><span class="mpre">CPRG g =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">, </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">)
</span><a name="loc_36_1_36_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_15&#39;)"><span class="hl_fundecl"><span class="mpre">generateOfSize</span></span></a><span class="mpre"> </span><a name="loc_36_16_36_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_16_36_19&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a name="loc_36_20_36_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_20_36_24&#39;)"><span class="hl_vardecl"><span class="mpre">bits</span></span></a><span class="mpre"> = </span><a href="Crypto.Random.html#loc_56_1_56_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.html#loc_56_1_56_16&#39;)"><span class="hl_varref"><span class="mpre">withRandomBytes</span></span></a><span class="mpre"> </span><a href="#loc_36_16_36_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_16_36_19&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre"> (</span><a href="#loc_36_20_36_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_20_36_24&#39;)"><span class="hl_varref"><span class="mpre">bits</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`div`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_36_65_36_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_65_36_67&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> -&gt;
    </span><a href="Crypto.Number.Serialize.html#loc_49_1_49_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.Serialize.html#loc_49_1_49_6&#39;)"><span class="hl_varref"><span class="mpre">os2ip</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">snd</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.mapAccumL</span></span><span class="mpre"> (\</span><a name="loc_37_33_37_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_33_37_36&#39;)"><span class="hl_vardecl"><span class="mpre">acc</span></span></a><span class="mpre"> </span><a name="loc_37_37_37_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_37_37_38&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> -&gt; (</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">, </span><a href="#loc_37_37_37_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_37_37_38&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_37_33_37_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_33_37_36&#39;)"><span class="hl_varref"><span class="mpre">acc</span></span></a><span class="mpre">)) </span><span class="hl_num"><span class="mpre">0xc0</span></span><span class="mpre"> </span><a href="#loc_36_65_36_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_65_36_67&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
</span></div></body></html>