<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE BangPatterns          #-}
{-# LANGUAGE MultiParamTypeClasses #-}
{-# LANGUAGE RankNTypes            #-}

</span><span class="hl_comment"><span class="mpre">-- | Vector conversions and utilities.</span></span><span class="mpre">

module System.IO.Streams.Vector
 ( </span><span class="hl_comment"><span class="mpre">-- * Vector conversions</span></span><span class="mpre">
   fromVector
 , toVector
 , toVectorSized
 , outputToVector
 , outputToVectorSized
 , toMutableVector
 , toMutableVectorSized
 , outputToMutableVector
 , outputToMutableVectorSized
 , writeVector

   </span><span class="hl_comment"><span class="mpre">-- * Utility</span></span><span class="mpre">
 , chunkVector
 , vectorOutputStream
 , vectorOutputStreamSized
 , mutableVectorOutputStream
 , mutableVectorOutputStreamSized
 ) where

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
import           Control.Concurrent.MVar     (</span><a href="Control.Concurrent.MVar.html#loc_228_1_228_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_228_1_228_11&#39;)"><span class="mpre">modifyMVar</span></a><span class="mpre">, </span><a href="Control.Concurrent.MVar.html#loc_216_1_216_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_216_1_216_12&#39;)"><span class="mpre">modifyMVar_</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="mpre">newMVar</span></a><span class="mpre">)
import           Control.Monad               (</span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="mpre">liftM</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_180_3_180_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_180_3_180_6&#39;)"><span class="mpre">(&gt;=&gt;)</span></a><span class="mpre">)
import           Control.Monad.IO.Class      (</span><a href="Control.Monad.IO.Class.html#loc_30_20_30_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_30_20_30_27&#39;)"><span class="mpre">MonadIO</span></a><span class="mpre"> (..))
import           Control.Monad.Primitive     (PrimState (..))
import           Data.IORef                  (</span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="mpre">IORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="mpre">newIORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="mpre">readIORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="mpre">writeIORef</span></a><span class="mpre">)
import           </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 34, srcSpanStartColumn = 18, srcSpanEndLine = 34, srcSpanEndColumn = 37}, srcInfoPoints = []}) &quot;Data.Vector.Generic&quot;"><span class="mpre">Data.Vector.Generic</span></span><span class="mpre">         (Vector (..))
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 35, srcSpanStartColumn = 18, srcSpanEndLine = 35, srcSpanEndColumn = 37}, srcInfoPoints = []}) &quot;Data.Vector.Generic&quot;"><span class="mpre">Data.Vector.Generic</span></span><span class="mpre">         as V
import           </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 36, srcSpanStartColumn = 18, srcSpanEndLine = 36, srcSpanEndColumn = 45}, srcInfoPoints = []}) &quot;Data.Vector.Generic.Mutable&quot;"><span class="mpre">Data.Vector.Generic.Mutable</span></span><span class="mpre"> (MVector)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 37, srcSpanStartColumn = 18, srcSpanEndLine = 37, srcSpanEndColumn = 45}, srcInfoPoints = []}) &quot;Data.Vector.Generic.Mutable&quot;"><span class="mpre">Data.Vector.Generic.Mutable</span></span><span class="mpre"> as VM
import           System.IO.Streams.Internal  (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="mpre">InputStream</span></a><span class="mpre">, </span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="mpre">OutputStream</span></a><span class="mpre">, </span><a href="System.IO.Streams.Internal.html#loc_599_1_599_14" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_599_1_599_14&#39;)"><span class="mpre">fromGenerator</span></a><span class="mpre">, </span><a href="System.IO.Streams.Internal.html#loc_593_1_593_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_593_1_593_6&#39;)"><span class="mpre">yield</span></a><span class="mpre">)
import qualified System.IO.Streams.Internal  as S


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Transforms a vector into an &#39;InputStream&#39; that yields each of the values</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in the vector in turn.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; import &quot;Control.Monad&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; import qualified &quot;System.IO.Streams&quot; as Streams</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; import qualified &quot;Data.Vector&quot; as V</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; let v = V.&#39;Data.Vector.fromList&#39; [1, 2]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; is &lt;- Streams.&#39;fromVector&#39; v</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; &#39;Control.Monad.replicateM&#39; 3 (Streams.&#39;read&#39; is)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [&#39;Just&#39; 1,&#39;Just&#39; 2,&#39;Nothing&#39;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_56_1_56_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_11&#39;)"><span class="mpre">fromVector</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 55, srcSpanStartColumn = 15, srcSpanEndLine = 55, srcSpanEndColumn = 28}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 55, srcSpanStartColumn = 26, srcSpanEndLine = 55, srcSpanEndColumn = 28}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagr"><span class="mpre">Vector v a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_56_1_56_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_11&#39;)"><span class="hl_vardecl"><span class="mpre">fromVector</span></span></a><span class="mpre"> = </span><a href="System.IO.Streams.Internal.html#loc_599_1_599_14" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_599_1_599_14&#39;)"><span class="hl_varref"><span class="mpre">fromGenerator</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">V.mapM_</span></span><span class="mpre"> </span><a href="System.IO.Streams.Internal.html#loc_593_1_593_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_593_1_593_6&#39;)"><span class="hl_varref"><span class="mpre">yield</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_56_1_56_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_11&#39;)"><span class="mpre">fromVector</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Drains an &#39;InputStream&#39;, converting it to a vector. Note that this</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- function reads the entire &#39;InputStream&#39; strictly into memory and as such is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- not recommended for streaming applications or where the size of the input is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- not bounded or known.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; is &lt;- Streams.&#39;System.IO.Streams.fromList&#39; [(1::Int)..4]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;toVector&#39; is :: &#39;IO&#39; (V.&#39;Vector&#39; Int)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- fromList [1,2,3,4]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_72_1_72_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_1_72_9&#39;)"><span class="mpre">toVector</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 71, srcSpanStartColumn = 13, srcSpanEndLine = 71, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 71, srcSpanStartColumn = 24, srcSpanEndLine = 71, srcSpanEndColumn = 26}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagr"><span class="mpre">Vector v a =&gt;</span></span><span class="mpre"> </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_72_1_72_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_1_72_9&#39;)"><span class="hl_vardecl"><span class="mpre">toVector</span></span></a><span class="mpre"> = </span><a href="#loc_80_1_80_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_1_80_14&#39;)"><span class="hl_varref"><span class="mpre">toVectorSized</span></span></a><span class="mpre"> </span><a href="#loc_351_1_351_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_1_351_15&#39;)"><span class="hl_varref"><span class="mpre">dEFAULT_BUFSIZ</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_72_1_72_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_1_72_9&#39;)"><span class="mpre">toVector</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Like &#39;toVector&#39;, but allows control over how large the vector buffer is to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- start with.</span></span><span class="mpre">
</span><a href="#loc_80_1_80_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_1_80_14&#39;)"><span class="mpre">toVectorSized</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 79, srcSpanStartColumn = 18, srcSpanEndLine = 79, srcSpanEndColumn = 31}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 79, srcSpanStartColumn = 29, srcSpanEndLine = 79, srcSpanEndColumn = 31}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagr"><span class="mpre">Vector v a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_80_1_80_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_1_80_14&#39;)"><span class="hl_fundecl"><span class="mpre">toVectorSized</span></span></a><span class="mpre"> </span><a name="loc_80_15_80_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_15_80_16&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><a href="#loc_100_1_100_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_21&#39;)"><span class="hl_varref"><span class="mpre">toMutableVectorSized</span></span></a><span class="mpre"> </span><a href="#loc_80_15_80_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_15_80_16&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="Control.Monad.html#loc_180_3_180_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_180_3_180_6&#39;)"><span class="hl_infix"><span class="mpre">&gt;=&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">V.basicUnsafeFreeze</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_80_1_80_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_1_80_14&#39;)"><span class="mpre">toVectorSized</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Drains an &#39;InputStream&#39;, converting it to a mutable vector. Note that this</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- function reads the entire &#39;InputStream&#39; strictly into memory and as such is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- not recommended for streaming applications or where the size of the input is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- not bounded or known.</span></span><span class="mpre">
</span><a href="#loc_90_1_90_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_16&#39;)"><span class="mpre">toMutableVector</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 89, srcSpanStartColumn = 20, srcSpanEndLine = 89, srcSpanEndColumn = 37}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 89, srcSpanStartColumn = 35, srcSpanEndLine = 89, srcSpanEndColumn = 37}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagr"><span class="mpre">VM.MVector v a =&gt;</span></span><span class="mpre"> </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">PrimState</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_90_1_90_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_16&#39;)"><span class="hl_vardecl"><span class="mpre">toMutableVector</span></span></a><span class="mpre"> = </span><a href="#loc_100_1_100_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_21&#39;)"><span class="hl_varref"><span class="mpre">toMutableVectorSized</span></span></a><span class="mpre"> </span><a href="#loc_351_1_351_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_1_351_15&#39;)"><span class="hl_varref"><span class="mpre">dEFAULT_BUFSIZ</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Like &#39;toMutableVector&#39;, but allows control over how large the vector</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- buffer is to start with.</span></span><span class="mpre">
</span><a href="#loc_100_1_100_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_21&#39;)"><span class="mpre">toMutableVectorSized</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 96, srcSpanStartColumn = 25, srcSpanEndLine = 96, srcSpanEndColumn = 42}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 96, srcSpanStartColumn = 40, srcSpanEndLine = 96, srcSpanEndColumn = 42}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagr"><span class="mpre">VM.MVector v a =&gt;</span></span><span class="mpre">
                        </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">            </span><span class="hl_comment"><span class="mpre">-- ^ initial size of the vector buffer</span></span><span class="mpre">
                     -&gt; </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
                     -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">PrimState</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_100_1_100_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_21&#39;)"><span class="hl_fundecl"><span class="mpre">toMutableVectorSized</span></span></a><span class="mpre"> </span><a name="loc_100_22_100_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_22_100_33&#39;)"><span class="hl_vardecl"><span class="mpre">initialSize</span></span></a><span class="mpre"> </span><a name="loc_100_34_100_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_34_100_39&#39;)"><span class="hl_vardecl"><span class="mpre">input</span></span></a><span class="mpre"> = </span><a href="#loc_154_1_154_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_6&#39;)"><span class="hl_varref"><span class="mpre">vfNew</span></span></a><span class="mpre"> </span><a href="#loc_100_22_100_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_22_100_33&#39;)"><span class="hl_varref"><span class="mpre">initialSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="#loc_102_5_102_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_5_102_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">
  where
    </span><a name="loc_102_5_102_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_5_102_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_102_8_102_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_8_102_11&#39;)"><span class="hl_vardecl"><span class="mpre">vfi</span></span></a><span class="mpre"> = </span><a href="System.IO.Streams.Internal.html#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">S.read</span></span></a><span class="mpre"> </span><a href="#loc_100_34_100_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_34_100_39&#39;)"><span class="hl_varref"><span class="mpre">input</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> (</span><a href="#loc_165_1_165_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_9&#39;)"><span class="hl_varref"><span class="mpre">vfFinish</span></span></a><span class="mpre"> </span><a href="#loc_102_8_102_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_8_102_11&#39;)"><span class="hl_varref"><span class="mpre">vfi</span></span></a><span class="mpre">) (</span><a href="#loc_176_1_176_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_1_176_9&#39;)"><span class="hl_varref"><span class="mpre">vfAppend</span></span></a><span class="mpre"> </span><a href="#loc_102_8_102_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_8_102_11&#39;)"><span class="hl_varref"><span class="mpre">vfi</span></span></a><span class="mpre"> </span><a href="Control.Monad.html#loc_180_3_180_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_180_3_180_6&#39;)"><span class="hl_infix"><span class="mpre">&gt;=&gt;</span></span></a><span class="mpre"> </span><a href="#loc_102_5_102_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_5_102_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_100_1_100_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_21&#39;)"><span class="mpre">toMutableVectorSized</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | &#39;vectorOutputStream&#39; returns an &#39;OutputStream&#39; which stores values fed</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- into it and an action which flushes all stored values to a vector.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The flush action resets the store.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that this function /will/ buffer any input sent to it on the heap.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Please don&#39;t use this unless you&#39;re sure that the amount of input provided</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is bounded and will fit in memory without issues.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; (os, flush) &lt;- Streams.&#39;vectorOutputStream&#39; :: IO (&#39;OutputStream&#39; Int, IO (V.&#39;Vector&#39; Int))</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.write&#39; (Just 1) os</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.write&#39; (Just 2) os</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; flush</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- fromList [1,2]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.write&#39; (Just 3) os</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.write&#39; Nothing  os</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;System.IO.Streams.write&#39; (Just 4) os</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; flush</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- fromList [3]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_129_1_129_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_19&#39;)"><span class="mpre">vectorOutputStream</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 128, srcSpanStartColumn = 23, srcSpanEndLine = 128, srcSpanEndColumn = 36}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 128, srcSpanStartColumn = 34, srcSpanEndLine = 128, srcSpanEndColumn = 36}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/"><span class="mpre">Vector v c =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">))
</span><a name="loc_129_1_129_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_19&#39;)"><span class="hl_vardecl"><span class="mpre">vectorOutputStream</span></span></a><span class="mpre"> = </span><a href="#loc_137_1_137_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_24&#39;)"><span class="hl_varref"><span class="mpre">vectorOutputStreamSized</span></span></a><span class="mpre"> </span><a href="#loc_351_1_351_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_1_351_15&#39;)"><span class="hl_varref"><span class="mpre">dEFAULT_BUFSIZ</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_129_1_129_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_19&#39;)"><span class="mpre">vectorOutputStream</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Like &#39;vectorOutputStream&#39;, but allows control over how large the vector</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- buffer is to start with.</span></span><span class="mpre">
</span><a href="#loc_137_1_137_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_24&#39;)"><span class="mpre">vectorOutputStreamSized</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 136, srcSpanStartColumn = 28, srcSpanEndLine = 136, srcSpanEndColumn = 41}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 136, srcSpanStartColumn = 39, srcSpanEndLine = 136, srcSpanEndColumn = 41}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/"><span class="mpre">Vector v c =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">))
</span><a name="loc_137_1_137_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_24&#39;)"><span class="hl_fundecl"><span class="mpre">vectorOutputStreamSized</span></span></a><span class="mpre"> </span><a name="loc_137_25_137_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_25_137_26&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = do
    (</span><a name="loc_138_6_138_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_6_138_8&#39;)"><span class="hl_vardecl"><span class="mpre">os</span></span></a><span class="mpre">, </span><a name="loc_138_10_138_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_10_138_15&#39;)"><span class="hl_vardecl"><span class="mpre">flush</span></span></a><span class="mpre">) &lt;- </span><a href="#loc_217_1_217_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_1_217_31&#39;)"><span class="hl_varref"><span class="mpre">mutableVectorOutputStreamSized</span></span></a><span class="mpre"> </span><a href="#loc_137_25_137_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_25_137_26&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> (</span><a href="#loc_138_6_138_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_6_138_8&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre">, </span><a href="#loc_138_10_138_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_10_138_15&#39;)"><span class="hl_varref"><span class="mpre">flush</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">V.basicUnsafeFreeze</span></span><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
data </span><a name="loc_143_6_143_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_6_143_20&#39;)"><span class="hl_tycondecl"><span class="mpre">VectorFillInfo</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre"> = </span><a name="loc_143_27_143_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_27_143_41&#39;)"><span class="hl_condecl"><span class="mpre">VectorFillInfo</span></span></a><span class="mpre"> {
      </span><a name="loc_144_7_144_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_7_144_11&#39;)"><span class="hl_fielddecl"><span class="mpre">_vec</span></span></a><span class="mpre"> :: !(</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">PrimState</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">)
    , </span><a name="loc_145_7_145_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_7_145_11&#39;)"><span class="hl_fielddecl"><span class="mpre">_idx</span></span></a><span class="mpre"> :: {-# UNPACK #-} !(</span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)

    </span><span class="hl_comment"><span class="mpre">-- TODO: vector contains its own size</span></span><span class="mpre">
    , </span><a name="loc_148_7_148_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_7_148_10&#39;)"><span class="hl_fielddecl"><span class="mpre">_sz</span></span></a><span class="mpre">  :: {-# UNPACK #-} !(</span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)
    }


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><a href="#loc_154_1_154_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_6&#39;)"><span class="mpre">vfNew</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 153, srcSpanStartColumn = 10, srcSpanEndLine = 153, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 153, srcSpanStartColumn = 22, srcSpanEndLine = 153, srcSpanEndColumn = 24}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/"><span class="mpre">MVector v a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_143_6_143_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_6_143_20&#39;)"><span class="hl_tyconref"><span class="mpre">VectorFillInfo</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_154_1_154_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_6&#39;)"><span class="hl_fundecl"><span class="mpre">vfNew</span></span></a><span class="mpre"> </span><a name="loc_154_7_154_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_7_154_18&#39;)"><span class="hl_vardecl"><span class="mpre">initialSize</span></span></a><span class="mpre"> = do
    </span><a name="loc_155_5_155_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_5_155_6&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre">  &lt;- </span><span class="hl_varref"><span class="mpre">VM.unsafeNew</span></span><span class="mpre"> </span><a href="#loc_154_7_154_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_7_154_18&#39;)"><span class="hl_varref"><span class="mpre">initialSize</span></span></a><span class="mpre">
    </span><a name="loc_156_5_156_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_5_156_6&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">  &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
    </span><a name="loc_157_5_157_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_5_157_7&#39;)"><span class="hl_vardecl"><span class="mpre">sz</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_154_7_154_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_7_154_18&#39;)"><span class="hl_varref"><span class="mpre">initialSize</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="#loc_143_27_143_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_27_143_41&#39;)"><span class="hl_conref"><span class="mpre">VectorFillInfo</span></span></a><span class="mpre"> </span><a href="#loc_155_5_155_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_5_155_6&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre"> </span><a href="#loc_156_5_156_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_5_156_6&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="#loc_157_5_157_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_5_157_7&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><a href="#loc_165_1_165_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_9&#39;)"><span class="mpre">vfFinish</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 162, srcSpanStartColumn = 13, srcSpanEndLine = 162, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 162, srcSpanStartColumn = 25, srcSpanEndLine = 162, srcSpanEndColumn = 27}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/"><span class="mpre">MVector v a =&gt;</span></span><span class="mpre">
            </span><a href="#loc_143_6_143_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_6_143_20&#39;)"><span class="hl_tyconref"><span class="mpre">VectorFillInfo</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
         -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">PrimState</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_165_1_165_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_9&#39;)"><span class="hl_fundecl"><span class="mpre">vfFinish</span></span></a><span class="mpre"> </span><a name="loc_165_10_165_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_10_165_13&#39;)"><span class="hl_vardecl"><span class="mpre">vfi</span></span></a><span class="mpre"> = </span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="hl_varref"><span class="mpre">liftM</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">flip</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">VM.unsafeTake</span></span><span class="mpre"> </span><a href="#loc_167_5_167_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_5_167_6&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_168_5_168_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_5_168_6&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
  where
    </span><a name="loc_167_5_167_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_5_167_6&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> = </span><a href="#loc_144_7_144_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_7_144_11&#39;)"><span class="hl_varref"><span class="mpre">_vec</span></span></a><span class="mpre"> </span><a href="#loc_165_10_165_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_10_165_13&#39;)"><span class="hl_varref"><span class="mpre">vfi</span></span></a><span class="mpre">
    </span><a name="loc_168_5_168_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_5_168_6&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> = </span><a href="#loc_145_7_145_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_7_145_11&#39;)"><span class="hl_varref"><span class="mpre">_idx</span></span></a><span class="mpre"> </span><a href="#loc_165_10_165_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_10_165_13&#39;)"><span class="hl_varref"><span class="mpre">vfi</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><a href="#loc_176_1_176_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_1_176_9&#39;)"><span class="mpre">vfAppend</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 172, srcSpanStartColumn = 13, srcSpanEndLine = 172, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 172, srcSpanStartColumn = 25, srcSpanEndLine = 172, srcSpanEndColumn = 27}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/"><span class="mpre">MVector v a =&gt;</span></span><span class="mpre">
         </span><a href="#loc_143_6_143_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_6_143_20&#39;)"><span class="hl_tyconref"><span class="mpre">VectorFillInfo</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
      -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
      -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_143_6_143_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_6_143_20&#39;)"><span class="hl_tyconref"><span class="mpre">VectorFillInfo</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_176_1_176_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_1_176_9&#39;)"><span class="hl_fundecl"><span class="mpre">vfAppend</span></span></a><span class="mpre"> </span><a name="loc_176_10_176_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_10_176_13&#39;)"><span class="hl_vardecl"><span class="mpre">vfi</span></span></a><span class="mpre"> !</span><a name="loc_176_15_176_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_15_176_16&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = do
    </span><a name="loc_177_5_177_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_5_177_6&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">  &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_182_5_182_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_5_182_9&#39;)"><span class="hl_varref"><span class="mpre">iRef</span></span></a><span class="mpre">
    </span><a name="loc_178_5_178_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_5_178_7&#39;)"><span class="hl_vardecl"><span class="mpre">sz</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_183_5_183_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_5_183_10&#39;)"><span class="hl_varref"><span class="mpre">szRef</span></span></a><span class="mpre">
    if </span><a href="#loc_177_5_177_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_5_177_6&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_178_5_178_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_5_178_7&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre"> then </span><a href="#loc_185_5_185_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_8&#39;)"><span class="hl_varref"><span class="mpre">add</span></span></a><span class="mpre"> </span><a href="#loc_177_5_177_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_5_177_6&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> else </span><a href="#loc_190_5_190_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_5_190_9&#39;)"><span class="hl_varref"><span class="mpre">grow</span></span></a><span class="mpre"> </span><a href="#loc_178_5_178_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_5_178_7&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre">
  where
    </span><a name="loc_181_5_181_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_5_181_6&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre">     = </span><a href="#loc_144_7_144_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_7_144_11&#39;)"><span class="hl_varref"><span class="mpre">_vec</span></span></a><span class="mpre"> </span><a href="#loc_176_10_176_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_10_176_13&#39;)"><span class="hl_varref"><span class="mpre">vfi</span></span></a><span class="mpre">
    </span><a name="loc_182_5_182_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_5_182_9&#39;)"><span class="hl_vardecl"><span class="mpre">iRef</span></span></a><span class="mpre">  = </span><a href="#loc_145_7_145_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_7_145_11&#39;)"><span class="hl_varref"><span class="mpre">_idx</span></span></a><span class="mpre"> </span><a href="#loc_176_10_176_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_10_176_13&#39;)"><span class="hl_varref"><span class="mpre">vfi</span></span></a><span class="mpre">
    </span><a name="loc_183_5_183_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_5_183_10&#39;)"><span class="hl_vardecl"><span class="mpre">szRef</span></span></a><span class="mpre"> = </span><a href="#loc_148_7_148_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_7_148_10&#39;)"><span class="hl_varref"><span class="mpre">_sz</span></span></a><span class="mpre"> </span><a href="#loc_176_10_176_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_10_176_13&#39;)"><span class="hl_varref"><span class="mpre">vfi</span></span></a><span class="mpre">

    </span><a name="loc_185_5_185_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_8&#39;)"><span class="hl_fundecl"><span class="mpre">add</span></span></a><span class="mpre"> </span><a name="loc_185_9_185_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_9_185_10&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> = do
        </span><span class="hl_varref"><span class="mpre">VM.unsafeWrite</span></span><span class="mpre"> </span><a href="#loc_181_5_181_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_5_181_6&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre"> </span><a href="#loc_185_9_185_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_9_185_10&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="#loc_176_15_176_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_15_176_16&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
        </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_182_5_182_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_5_182_9&#39;)"><span class="hl_varref"><span class="mpre">iRef</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="#loc_185_9_185_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_9_185_10&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_176_10_176_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_10_176_13&#39;)"><span class="hl_varref"><span class="mpre">vfi</span></span></a><span class="mpre">

    </span><a name="loc_190_5_190_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_5_190_9&#39;)"><span class="hl_fundecl"><span class="mpre">grow</span></span></a><span class="mpre"> </span><a name="loc_190_10_190_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_10_190_12&#39;)"><span class="hl_vardecl"><span class="mpre">sz</span></span></a><span class="mpre"> = do
        let !</span><a name="loc_191_14_191_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_14_191_17&#39;)"><span class="hl_vardecl"><span class="mpre">sz&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_190_10_190_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_10_190_12&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">
        </span><span class="hl_vardecl"><span class="mpre">v&#39;</span></span><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">VM.unsafeGrow</span></span><span class="mpre"> </span><a href="#loc_181_5_181_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_5_181_6&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre"> </span><a href="#loc_190_10_190_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_10_190_12&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre">
        </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_183_5_183_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_5_183_10&#39;)"><span class="hl_varref"><span class="mpre">szRef</span></span></a><span class="mpre"> </span><a href="#loc_191_14_191_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_14_191_17&#39;)"><span class="hl_varref"><span class="mpre">sz&#39;</span></span></a><span class="mpre">
        </span><a href="#loc_176_1_176_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_1_176_9&#39;)"><span class="hl_varref"><span class="mpre">vfAppend</span></span></a><span class="mpre"> (</span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 194, srcSpanStartColumn = 19, srcSpanEndLine = 194, srcSpanEndColumn = 36}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 194, srcSpanStartColumn = 23, srcSpanEndLine = 194, srcSpanEndColumn = 24},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6"><span class="mpre">vfi { _vec = v&#39; }</span></span><span class="mpre">) </span><a href="#loc_176_15_176_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_15_176_16&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | &#39;mutableVectorOutputStream&#39; returns an &#39;OutputStream&#39; which stores values</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- fed into it and an action which flushes all stored values to a vector.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The flush action resets the store.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that this function /will/ buffer any input sent to it on the heap.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Please don&#39;t use this unless you&#39;re sure that the amount of input provided</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is bounded and will fit in memory without issues.</span></span><span class="mpre">
</span><a href="#loc_208_1_208_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_1_208_26&#39;)"><span class="mpre">mutableVectorOutputStream</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 206, srcSpanStartColumn = 30, srcSpanEndLine = 206, srcSpanEndColumn = 47}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 206, srcSpanStartColumn = 45, srcSpanEndLine = 206, srcSpanEndColumn = 47}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/"><span class="mpre">VM.MVector v c =&gt;</span></span><span class="mpre">
                             </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">PrimState</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">))
</span><a name="loc_208_1_208_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_1_208_26&#39;)"><span class="hl_vardecl"><span class="mpre">mutableVectorOutputStream</span></span></a><span class="mpre"> = </span><a href="#loc_217_1_217_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_1_217_31&#39;)"><span class="hl_varref"><span class="mpre">mutableVectorOutputStreamSized</span></span></a><span class="mpre"> </span><a href="#loc_351_1_351_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_1_351_15&#39;)"><span class="hl_varref"><span class="mpre">dEFAULT_BUFSIZ</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Like &#39;mutableVectorOutputStream&#39;, but allows control over how large the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- vector buffer is to start with.</span></span><span class="mpre">
</span><a href="#loc_217_1_217_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_1_217_31&#39;)"><span class="mpre">mutableVectorOutputStreamSized</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 214, srcSpanStartColumn = 35, srcSpanEndLine = 214, srcSpanEndColumn = 52}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 214, srcSpanStartColumn = 50, srcSpanEndLine = 214, srcSpanEndColumn = 52}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/"><span class="mpre">VM.MVector v c =&gt;</span></span><span class="mpre">
                                  </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
                               -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">PrimState</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">))
</span><a name="loc_217_1_217_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_1_217_31&#39;)"><span class="hl_fundecl"><span class="mpre">mutableVectorOutputStreamSized</span></span></a><span class="mpre"> </span><a name="loc_217_32_217_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_32_217_43&#39;)"><span class="hl_vardecl"><span class="mpre">initialSize</span></span></a><span class="mpre"> = do
    </span><a name="loc_218_5_218_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_5_218_6&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_154_1_154_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_6&#39;)"><span class="hl_varref"><span class="mpre">vfNew</span></span></a><span class="mpre"> </span><a href="#loc_217_32_217_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_32_217_43&#39;)"><span class="hl_varref"><span class="mpre">initialSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="hl_varref"><span class="mpre">newMVar</span></span></a><span class="mpre">
    </span><a name="loc_219_5_219_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_5_219_6&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> &lt;- </span><a href="System.IO.Streams.Internal.html#loc_658_1_658_13" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_658_1_658_13&#39;)"><span class="hl_varref"><span class="mpre">S.fromConsumer</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_223_5_223_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_5_223_13&#39;)"><span class="hl_varref"><span class="mpre">consumer</span></span></a><span class="mpre"> </span><a href="#loc_218_5_218_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_5_218_6&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_219_5_219_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_5_219_6&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">, </span><a href="#loc_230_5_230_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_5_230_10&#39;)"><span class="hl_varref"><span class="mpre">flush</span></span></a><span class="mpre"> </span><a href="#loc_218_5_218_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_5_218_6&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">)

  where
    </span><a name="loc_223_5_223_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_5_223_13&#39;)"><span class="hl_fundecl"><span class="mpre">consumer</span></span></a><span class="mpre"> </span><a name="loc_223_14_223_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_14_223_15&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = </span><a href="#loc_225_9_225_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_9_225_11&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">
      where
        </span><a name="loc_225_9_225_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_9_225_11&#39;)"><span class="hl_vardecl"><span class="mpre">go</span></span></a><span class="mpre"> = </span><a href="System.IO.Streams.Internal.html#loc_653_1_653_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_653_1_653_6&#39;)"><span class="hl_varref"><span class="mpre">S.await</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre">
             (</span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_226_39_226_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_39_226_40&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> -&gt; do
                 </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Concurrent.MVar.html#loc_216_1_216_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_216_1_216_12&#39;)"><span class="hl_varref"><span class="mpre">modifyMVar_</span></span></a><span class="mpre"> </span><a href="#loc_223_14_223_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_14_223_15&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">flip</span></span><span class="mpre"> </span><a href="#loc_176_1_176_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_1_176_9&#39;)"><span class="hl_varref"><span class="mpre">vfAppend</span></span></a><span class="mpre"> </span><a href="#loc_226_39_226_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_39_226_40&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">
                 </span><a href="#loc_225_9_225_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_9_225_11&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">)

    </span><a name="loc_230_5_230_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_5_230_10&#39;)"><span class="hl_fundecl"><span class="mpre">flush</span></span></a><span class="mpre"> </span><a name="loc_230_11_230_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_11_230_12&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = </span><a href="Control.Concurrent.MVar.html#loc_228_1_228_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_228_1_228_11&#39;)"><span class="hl_varref"><span class="mpre">modifyMVar</span></span></a><span class="mpre"> </span><a href="#loc_230_11_230_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_11_230_12&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_230_31_230_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_31_230_34&#39;)"><span class="hl_vardecl"><span class="mpre">vfi</span></span></a><span class="mpre"> -&gt; do
                                !</span><a name="loc_231_34_231_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_34_231_35&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre">   &lt;- </span><a href="#loc_165_1_165_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_9&#39;)"><span class="hl_varref"><span class="mpre">vfFinish</span></span></a><span class="mpre"> </span><a href="#loc_230_31_230_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_31_230_34&#39;)"><span class="hl_varref"><span class="mpre">vfi</span></span></a><span class="mpre">
                                </span><a name="loc_232_33_232_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_33_232_37&#39;)"><span class="hl_vardecl"><span class="mpre">vfi&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_154_1_154_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_6&#39;)"><span class="hl_varref"><span class="mpre">vfNew</span></span></a><span class="mpre"> </span><a href="#loc_217_32_217_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_32_217_43&#39;)"><span class="hl_varref"><span class="mpre">initialSize</span></span></a><span class="mpre">
                                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> (</span><a href="#loc_232_33_232_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_33_232_37&#39;)"><span class="hl_varref"><span class="mpre">vfi&#39;</span></span></a><span class="mpre">, </span><a href="#loc_231_34_231_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_34_231_35&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_217_1_217_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_1_217_31&#39;)"><span class="mpre">mutableVectorOutputStreamSized</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Given an IO action that requires an &#39;OutputStream&#39;, creates one and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- captures all the output the action sends to it as a mutable vector.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; import &quot;Control.Applicative&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; (&#39;connect&#39; \&lt;\$\&gt; &#39;System.IO.Streams.fromList&#39; [1, 2, 3::&#39;Int&#39;])</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--        \&gt;\&gt;= &#39;outputToMutableVector&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--        \&gt;\&gt;= V.&#39;Data.Vector.freeze&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- fromList [1,2,3]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_253_1_253_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_1_253_22&#39;)"><span class="mpre">outputToMutableVector</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 250, srcSpanStartColumn = 26, srcSpanEndLine = 250, srcSpanEndColumn = 40}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 250, srcSpanStartColumn = 38, srcSpanEndLine = 250, srcSpanEndColumn = 40}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/"><span class="mpre">MVector v a =&gt;</span></span><span class="mpre">
                         (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)
                      -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">PrimState</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_253_1_253_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_1_253_22&#39;)"><span class="hl_vardecl"><span class="mpre">outputToMutableVector</span></span></a><span class="mpre"> = </span><a href="#loc_264_1_264_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_1_264_27&#39;)"><span class="hl_varref"><span class="mpre">outputToMutableVectorSized</span></span></a><span class="mpre"> </span><a href="#loc_351_1_351_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_1_351_15&#39;)"><span class="hl_varref"><span class="mpre">dEFAULT_BUFSIZ</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_253_1_253_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_1_253_22&#39;)"><span class="mpre">outputToMutableVector</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Like &#39;outputToMutableVector&#39;, but allows control over how large the vector</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- buffer is to start with.</span></span><span class="mpre">
</span><a href="#loc_264_1_264_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_1_264_27&#39;)"><span class="mpre">outputToMutableVectorSized</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 260, srcSpanStartColumn = 31, srcSpanEndLine = 260, srcSpanEndColumn = 45}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 260, srcSpanStartColumn = 43, srcSpanEndLine = 260, srcSpanEndColumn = 45}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/"><span class="mpre">MVector v a =&gt;</span></span><span class="mpre">
                              </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
                           -&gt; (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)
                           -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">PrimState</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_264_1_264_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_1_264_27&#39;)"><span class="hl_fundecl"><span class="mpre">outputToMutableVectorSized</span></span></a><span class="mpre"> </span><a name="loc_264_28_264_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_28_264_29&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> </span><a name="loc_264_30_264_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_30_264_31&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = do
    (</span><a name="loc_265_6_265_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_6_265_8&#39;)"><span class="hl_vardecl"><span class="mpre">os</span></span></a><span class="mpre">, </span><a name="loc_265_10_265_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_10_265_16&#39;)"><span class="hl_vardecl"><span class="mpre">getVec</span></span></a><span class="mpre">) &lt;- </span><a href="#loc_217_1_217_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_1_217_31&#39;)"><span class="hl_varref"><span class="mpre">mutableVectorOutputStreamSized</span></span></a><span class="mpre"> </span><a href="#loc_264_28_264_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_28_264_29&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
    _ &lt;- </span><a href="#loc_264_30_264_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_30_264_31&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_265_6_265_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_6_265_8&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre">
    </span><a href="#loc_265_10_265_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_10_265_16&#39;)"><span class="hl_varref"><span class="mpre">getVec</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_264_1_264_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_1_264_27&#39;)"><span class="mpre">outputToMutableVectorSized</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Given an IO action that requires an &#39;OutputStream&#39;, creates one and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- captures all the output the action sends to it as a vector.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; ((&#39;connect&#39; &lt;$&gt; &#39;System.IO.Streams.fromList&#39; [1, 2, 3]) &gt;&gt;= &#39;outputToVector&#39;)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--           :: IO (&#39;Data.Vector.Vector&#39; Int)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- fromList [1,2,3]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_283_1_283_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_283_1_283_15&#39;)"><span class="mpre">outputToVector</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 282, srcSpanStartColumn = 19, srcSpanEndLine = 282, srcSpanEndColumn = 32}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 282, srcSpanStartColumn = 30, srcSpanEndLine = 282, srcSpanEndColumn = 32}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/"><span class="mpre">Vector v a =&gt;</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_283_1_283_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_283_1_283_15&#39;)"><span class="hl_vardecl"><span class="mpre">outputToVector</span></span></a><span class="mpre"> = </span><a href="#loc_294_1_294_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_1_294_20&#39;)"><span class="hl_varref"><span class="mpre">outputToVectorSized</span></span></a><span class="mpre"> </span><a href="#loc_351_1_351_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_1_351_15&#39;)"><span class="hl_varref"><span class="mpre">dEFAULT_BUFSIZ</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_283_1_283_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_283_1_283_15&#39;)"><span class="mpre">outputToVector</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Like &#39;outputToVector&#39;, but allows control over how large the vector buffer</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is to start with.</span></span><span class="mpre">
</span><a href="#loc_294_1_294_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_1_294_20&#39;)"><span class="mpre">outputToVectorSized</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 290, srcSpanStartColumn = 24, srcSpanEndLine = 290, srcSpanEndColumn = 37}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 290, srcSpanStartColumn = 35, srcSpanEndLine = 290, srcSpanEndColumn = 37}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/"><span class="mpre">Vector v a =&gt;</span></span><span class="mpre">
                       </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
                    -&gt; (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)
                    -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_294_1_294_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_1_294_20&#39;)"><span class="hl_fundecl"><span class="mpre">outputToVectorSized</span></span></a><span class="mpre"> </span><a name="loc_294_21_294_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_21_294_22&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><a href="#loc_264_1_264_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_1_264_27&#39;)"><span class="hl_varref"><span class="mpre">outputToMutableVectorSized</span></span></a><span class="mpre"> </span><a href="#loc_294_21_294_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_21_294_22&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="Control.Monad.html#loc_180_3_180_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_180_3_180_6&#39;)"><span class="hl_infix"><span class="mpre">&gt;=&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">V.basicUnsafeFreeze</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_294_1_294_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_1_294_20&#39;)"><span class="mpre">outputToVectorSized</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Splits an input stream into chunks of at most size @n@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; (&#39;System.IO.Streams.fromList&#39; [1..14::Int] &gt;&gt;= &#39;chunkVector&#39; 4 &gt;&gt;= &#39;System.IO.Streams.toList&#39;)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--          :: IO [&#39;Data.Vector.Vector&#39; Int]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [fromList [1,2,3,4],fromList [5,6,7,8],fromList [9,10,11,12],fromList [13,14]]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_309_1_309_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_1_309_12&#39;)"><span class="mpre">chunkVector</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 308, srcSpanStartColumn = 16, srcSpanEndLine = 308, srcSpanEndColumn = 29}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 308, srcSpanStartColumn = 27, srcSpanEndLine = 308, srcSpanEndColumn = 29}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/"><span class="mpre">Vector v a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">))
</span><a name="loc_309_1_309_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_1_309_12&#39;)"><span class="hl_fundecl"><span class="mpre">chunkVector</span></span></a><span class="mpre"> </span><a name="loc_309_13_309_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_13_309_14&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> </span><a name="loc_309_15_309_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_15_309_20&#39;)"><span class="hl_vardecl"><span class="mpre">input</span></span></a><span class="mpre"> = if </span><a href="#loc_309_13_309_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_13_309_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
                        then </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;chunkVector: bad size: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_309_13_309_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_13_309_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
                        else </span><a href="#loc_154_1_154_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_6&#39;)"><span class="hl_varref"><span class="mpre">vfNew</span></span></a><span class="mpre"> </span><a href="#loc_309_13_309_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_13_309_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="System.IO.Streams.Internal.html#loc_599_1_599_14" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_599_1_599_14&#39;)"><span class="hl_varref"><span class="mpre">fromGenerator</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_318_5_318_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_5_318_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_309_13_309_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_13_309_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
  where
    </span><a name="loc_313_5_313_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_5_313_14&#39;)"><span class="hl_fundecl"><span class="mpre">doneChunk</span></span></a><span class="mpre"> !</span><a name="loc_313_16_313_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_16_313_19&#39;)"><span class="hl_vardecl"><span class="mpre">vfi</span></span></a><span class="mpre"> = do
        </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> (</span><a href="#loc_165_1_165_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_9&#39;)"><span class="hl_varref"><span class="mpre">vfFinish</span></span></a><span class="mpre"> </span><a href="#loc_313_16_313_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_16_313_19&#39;)"><span class="hl_varref"><span class="mpre">vfi</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">V.unsafeFreeze</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="System.IO.Streams.Internal.html#loc_593_1_593_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_593_1_593_6&#39;)"><span class="hl_varref"><span class="mpre">yield</span></span></a><span class="mpre">
        !</span><a name="loc_315_10_315_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_315_10_315_14&#39;)"><span class="hl_vardecl"><span class="mpre">vfi&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_154_1_154_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_6&#39;)"><span class="hl_varref"><span class="mpre">vfNew</span></span></a><span class="mpre"> </span><a href="#loc_309_13_309_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_13_309_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
        </span><a href="#loc_318_5_318_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_5_318_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_309_13_309_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_13_309_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_315_10_315_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_315_10_315_14&#39;)"><span class="hl_varref"><span class="mpre">vfi&#39;</span></span></a><span class="mpre">

    </span><a name="loc_318_5_318_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_5_318_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> !</span><a name="loc_318_9_318_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_9_318_10&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> !</span><a name="loc_318_12_318_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_12_318_15&#39;)"><span class="hl_vardecl"><span class="mpre">vfi</span></span></a><span class="mpre"> | </span><a href="#loc_318_9_318_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_9_318_10&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">    = </span><a href="#loc_313_5_313_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_5_313_14&#39;)"><span class="hl_varref"><span class="mpre">doneChunk</span></span></a><span class="mpre"> </span><a href="#loc_318_12_318_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_12_318_15&#39;)"><span class="hl_varref"><span class="mpre">vfi</span></span></a><span class="mpre">
               | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">S.read</span></span></a><span class="mpre"> </span><a href="#loc_309_15_309_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_15_309_20&#39;)"><span class="hl_varref"><span class="mpre">input</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> </span><a href="#loc_321_9_321_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_9_321_15&#39;)"><span class="hl_varref"><span class="mpre">finish</span></span></a><span class="mpre"> </span><a href="#loc_325_9_325_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_325_9_325_14&#39;)"><span class="hl_varref"><span class="mpre">chunk</span></span></a><span class="mpre">
      where
        </span><a name="loc_321_9_321_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_9_321_15&#39;)"><span class="hl_vardecl"><span class="mpre">finish</span></span></a><span class="mpre"> = do
            </span><a name="loc_322_13_322_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_322_13_322_14&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> (</span><a href="#loc_165_1_165_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_9&#39;)"><span class="hl_varref"><span class="mpre">vfFinish</span></span></a><span class="mpre"> </span><a href="#loc_318_12_318_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_12_318_15&#39;)"><span class="hl_varref"><span class="mpre">vfi</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">V.unsafeFreeze</span></span><span class="mpre">)
            if </span><span class="hl_varref"><span class="mpre">V.null</span></span><span class="mpre"> </span><a href="#loc_322_13_322_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_322_13_322_14&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre"> then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> else </span><a href="System.IO.Streams.Internal.html#loc_593_1_593_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_593_1_593_6&#39;)"><span class="hl_varref"><span class="mpre">yield</span></span></a><span class="mpre"> </span><a href="#loc_322_13_322_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_322_13_322_14&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">

        </span><a name="loc_325_9_325_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_325_9_325_14&#39;)"><span class="hl_fundecl"><span class="mpre">chunk</span></span></a><span class="mpre"> </span><a name="loc_325_15_325_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_325_15_325_16&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = do
            !</span><a name="loc_326_14_326_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_326_14_326_18&#39;)"><span class="hl_vardecl"><span class="mpre">vfi&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_176_1_176_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_1_176_9&#39;)"><span class="hl_varref"><span class="mpre">vfAppend</span></span></a><span class="mpre"> </span><a href="#loc_318_12_318_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_12_318_15&#39;)"><span class="hl_varref"><span class="mpre">vfi</span></span></a><span class="mpre"> </span><a href="#loc_325_15_325_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_325_15_325_16&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
            </span><a href="#loc_318_5_318_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_5_318_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><a href="#loc_318_9_318_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_9_318_10&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_326_14_326_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_326_14_326_18&#39;)"><span class="hl_varref"><span class="mpre">vfi&#39;</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_309_1_309_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_1_309_12&#39;)"><span class="mpre">chunkVector</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Feeds a vector to an &#39;OutputStream&#39;. Does /not/ write an end-of-stream to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the stream.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; let v = V.&#39;fromList&#39; [1..4] :: V.&#39;Vector&#39; Int</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; os \&lt;- Streams.&#39;unlines&#39; Streams.&#39;stdout&#39; &gt;&gt;= Streams.&#39;System.IO.Streams.contramap&#39; (S.pack . show) :: IO (&#39;OutputStream&#39; Int)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; Streams.&#39;writeVector&#39; v os</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 1</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 2</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 3</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 4</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_345_1_345_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_345_1_345_12&#39;)"><span class="mpre">writeVector</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 344, srcSpanStartColumn = 16, srcSpanEndLine = 344, srcSpanEndColumn = 29}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Vector.hs&quot;, srcSpanStartLine = 344, srcSpanStartColumn = 27, srcSpanEndLine = 344, srcSpanEndColumn = 29}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/"><span class="mpre">Vector v a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_345_1_345_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_345_1_345_12&#39;)"><span class="hl_fundecl"><span class="mpre">writeVector</span></span></a><span class="mpre"> </span><a name="loc_345_13_345_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_345_13_345_14&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> </span><a name="loc_345_15_345_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_345_15_345_18&#39;)"><span class="hl_vardecl"><span class="mpre">out</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">V.mapM_</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">flip</span></span><span class="mpre"> </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">S.write</span></span></a><span class="mpre"> </span><a href="#loc_345_15_345_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_345_15_345_18&#39;)"><span class="hl_varref"><span class="mpre">out</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre">) </span><a href="#loc_345_13_345_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_345_13_345_14&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_345_1_345_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_345_1_345_12&#39;)"><span class="mpre">writeVector</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><a href="#loc_351_1_351_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_1_351_15&#39;)"><span class="mpre">dEFAULT_BUFSIZ</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_351_1_351_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_1_351_15&#39;)"><span class="hl_vardecl"><span class="mpre">dEFAULT_BUFSIZ</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">64</span></span><span class="mpre">
</span></div></body></html>