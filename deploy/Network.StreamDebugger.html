<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Network.StreamDebugger</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  See LICENSE file</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  Ganesh Sittampalam &lt;ganesh@earth.li&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (not tested)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Implements debugging of @Stream@s.  Originally part of Gray&#39;s\/Bringert&#39;s</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- HTTP module.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Changes by Robin Bate Boerop &lt;robin@bateboerop.name&gt;:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      - Created.  Made minor formatting changes.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
module Network.StreamDebugger
   ( StreamDebugger
   , debugStream
   , debugByteStream
   ) where

import Network.Stream (</span><a href="Network.Stream.html#loc_84_7_84_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_84_7_84_13&#39;)"><span class="mpre">Stream</span></a><span class="mpre">(..))
import System.IO
   ( Handle, </span><a href="GHC.IO.Handle.html#loc_293_1_293_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_293_1_293_7&#39;)"><span class="mpre">hFlush</span></a><span class="mpre">, hPutStrLn, </span><a href="GHC.IO.IOMode.html#loc_28_6_28_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.IOMode.html#loc_28_6_28_12&#39;)"><span class="mpre">IOMode</span></a><span class="mpre">(</span><a href="GHC.IO.IOMode.html#loc_28_44_28_54" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.IOMode.html#loc_28_44_28_54&#39;)"><span class="mpre">AppendMode</span></a><span class="mpre">), </span><a href="GHC.IO.Handle.html#loc_86_1_86_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_86_1_86_7&#39;)"><span class="mpre">hClose</span></a><span class="mpre">, </span><a href="GHC.IO.Handle.FD.html#loc_150_1_150_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.FD.html#loc_150_1_150_9&#39;)"><span class="mpre">openFile</span></a><span class="mpre">,
     </span><a href="GHC.IO.Handle.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_204_1_204_14&#39;)"><span class="mpre">hSetBuffering</span></a><span class="mpre">, BufferMode(NoBuffering)
   )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/StreamDebugger.hs&quot;, srcSpanStartLine = 29, srcSpanStartColumn = 8, srcSpanEndLine = 29, srcSpanEndColumn = 19}, srcInfoPoints = []}) &quot;Network.TCP&quot;"><span class="mpre">Network.TCP</span></span><span class="mpre"> ( HandleStream, HStream, 
                            StreamHooks(..), setStreamHooks, getStreamHooks )

</span><span class="hl_comment"><span class="mpre">-- | Allows stream logging.  Refer to &#39;debugStream&#39; below.</span></span><span class="mpre">
data </span><a name="loc_33_6_33_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_6_33_20&#39;)"><span class="hl_tycondecl"><span class="mpre">StreamDebugger</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">x</span></span><span class="mpre">
   = </span><a name="loc_34_6_34_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_6_34_9&#39;)"><span class="hl_condecl"><span class="mpre">Dbg</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">x</span></span><span class="mpre">

instance </span><span class="warning" data-warning="InstDecl ContextCxParen (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/StreamDebugger.hs&quot;, srcSpanStartLine = 36, srcSpanStartColumn = 10, srcSpanEndLine = 36, srcSpanEndColumn = 23}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/StreamDebugger.hs&quot;, srcSpanStartLine = 36, srcSpanStartColumn = 10, srcSpanEndLine = 36, srcSpanEndColumn = 11},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/StreamDebugger.hs&quot;, s"><span class="mpre">(Stream x) =&gt;</span></span><span class="mpre"> </span><a href="Network.Stream.html#loc_84_7_84_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_84_7_84_13&#39;)"><span class="hl_classref"><span class="mpre">Stream</span></span></a><span class="mpre"> (</span><a href="#loc_33_6_33_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_6_33_20&#39;)"><span class="hl_tyconref"><span class="mpre">StreamDebugger</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">x</span></span><span class="mpre">) where
    </span><a href="Network.Stream.html#loc_86_5_86_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_86_5_86_14&#39;)"><span class="hl_fundecl"><span class="mpre">readBlock</span></span></a><span class="mpre"> (</span><a href="#loc_34_6_34_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_6_34_9&#39;)"><span class="hl_conref"><span class="mpre">Dbg</span></span></a><span class="mpre"> </span><a name="loc_37_20_37_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_20_37_21&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_37_22_37_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_22_37_23&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">) </span><a name="loc_37_25_37_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_25_37_26&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> =
        do </span><a name="loc_38_12_38_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_12_38_15&#39;)"><span class="hl_vardecl"><span class="mpre">val</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Stream.html#loc_86_5_86_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_86_5_86_14&#39;)"><span class="hl_varref"><span class="mpre">readBlock</span></span></a><span class="mpre"> </span><a href="#loc_37_22_37_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_22_37_23&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="#loc_37_25_37_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_25_37_26&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
           </span><span class="hl_varref"><span class="mpre">hPutStrLn</span></span><span class="mpre"> </span><a href="#loc_37_20_37_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_20_37_21&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;--readBlock &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_37_25_37_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_25_37_26&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">)
           </span><span class="hl_varref"><span class="mpre">hPutStrLn</span></span><span class="mpre"> </span><a href="#loc_37_20_37_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_20_37_21&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_38_12_38_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_12_38_15&#39;)"><span class="hl_varref"><span class="mpre">val</span></span></a><span class="mpre">)
           </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_38_12_38_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_12_38_15&#39;)"><span class="hl_varref"><span class="mpre">val</span></span></a><span class="mpre">
    </span><a href="Network.Stream.html#loc_85_5_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_85_5_85_13&#39;)"><span class="hl_fundecl"><span class="mpre">readLine</span></span></a><span class="mpre"> (</span><a href="#loc_34_6_34_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_6_34_9&#39;)"><span class="hl_conref"><span class="mpre">Dbg</span></span></a><span class="mpre"> </span><a name="loc_42_19_42_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_19_42_20&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_42_21_42_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_21_42_22&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">) =
        do </span><a name="loc_43_12_43_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_12_43_15&#39;)"><span class="hl_vardecl"><span class="mpre">val</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Stream.html#loc_85_5_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_85_5_85_13&#39;)"><span class="hl_varref"><span class="mpre">readLine</span></span></a><span class="mpre"> </span><a href="#loc_42_21_42_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_21_42_22&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
           </span><span class="hl_varref"><span class="mpre">hPutStrLn</span></span><span class="mpre"> </span><a href="#loc_42_19_42_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_19_42_20&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;--readLine&quot;</span></span><span class="mpre">)
           </span><span class="hl_varref"><span class="mpre">hPutStrLn</span></span><span class="mpre"> </span><a href="#loc_42_19_42_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_19_42_20&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_43_12_43_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_12_43_15&#39;)"><span class="hl_varref"><span class="mpre">val</span></span></a><span class="mpre">)
           </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_43_12_43_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_12_43_15&#39;)"><span class="hl_varref"><span class="mpre">val</span></span></a><span class="mpre">
    </span><a href="Network.Stream.html#loc_87_5_87_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_87_5_87_15&#39;)"><span class="hl_fundecl"><span class="mpre">writeBlock</span></span></a><span class="mpre"> (</span><a href="#loc_34_6_34_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_6_34_9&#39;)"><span class="hl_conref"><span class="mpre">Dbg</span></span></a><span class="mpre"> </span><a name="loc_47_21_47_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_21_47_22&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_47_23_47_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_23_47_24&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">) </span><a name="loc_47_26_47_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_26_47_29&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> =
        do </span><a name="loc_48_12_48_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_12_48_15&#39;)"><span class="hl_vardecl"><span class="mpre">val</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Stream.html#loc_87_5_87_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_87_5_87_15&#39;)"><span class="hl_varref"><span class="mpre">writeBlock</span></span></a><span class="mpre"> </span><a href="#loc_47_23_47_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_23_47_24&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="#loc_47_26_47_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_26_47_29&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
           </span><span class="hl_varref"><span class="mpre">hPutStrLn</span></span><span class="mpre"> </span><a href="#loc_47_21_47_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_21_47_22&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;--writeBlock&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_47_26_47_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_26_47_29&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">)
           </span><span class="hl_varref"><span class="mpre">hPutStrLn</span></span><span class="mpre"> </span><a href="#loc_47_21_47_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_21_47_22&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_48_12_48_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_12_48_15&#39;)"><span class="hl_varref"><span class="mpre">val</span></span></a><span class="mpre">)
           </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_48_12_48_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_12_48_15&#39;)"><span class="hl_varref"><span class="mpre">val</span></span></a><span class="mpre">
    </span><a href="Network.Stream.html#loc_88_5_88_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_88_5_88_10&#39;)"><span class="hl_fundecl"><span class="mpre">close</span></span></a><span class="mpre"> (</span><a href="#loc_34_6_34_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_6_34_9&#39;)"><span class="hl_conref"><span class="mpre">Dbg</span></span></a><span class="mpre"> </span><a name="loc_52_16_52_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_16_52_17&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_52_18_52_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_18_52_19&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">) =
        do </span><span class="hl_varref"><span class="mpre">hPutStrLn</span></span><span class="mpre"> </span><a href="#loc_52_16_52_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_16_52_17&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;--closing...&quot;</span></span><span class="mpre">
           </span><a href="GHC.IO.Handle.html#loc_293_1_293_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_293_1_293_7&#39;)"><span class="hl_varref"><span class="mpre">hFlush</span></span></a><span class="mpre"> </span><a href="#loc_52_16_52_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_16_52_17&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
           </span><a href="Network.Stream.html#loc_88_5_88_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_88_5_88_10&#39;)"><span class="hl_varref"><span class="mpre">close</span></span></a><span class="mpre"> </span><a href="#loc_52_18_52_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_18_52_19&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
           </span><span class="hl_varref"><span class="mpre">hPutStrLn</span></span><span class="mpre"> </span><a href="#loc_52_16_52_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_16_52_17&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;--closed.&quot;</span></span><span class="mpre">
           </span><a href="GHC.IO.Handle.html#loc_86_1_86_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_86_1_86_7&#39;)"><span class="hl_varref"><span class="mpre">hClose</span></span></a><span class="mpre"> </span><a href="#loc_52_16_52_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_16_52_17&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
    </span><a href="Network.Stream.html#loc_89_5_89_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_89_5_89_15&#39;)"><span class="hl_fundecl"><span class="mpre">closeOnEnd</span></span></a><span class="mpre"> (</span><a href="#loc_34_6_34_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_6_34_9&#39;)"><span class="hl_conref"><span class="mpre">Dbg</span></span></a><span class="mpre"> </span><a name="loc_58_21_58_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_21_58_22&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_58_23_58_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_23_58_24&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">) </span><a name="loc_58_26_58_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_26_58_27&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> =
        do </span><span class="hl_varref"><span class="mpre">hPutStrLn</span></span><span class="mpre"> </span><a href="#loc_58_21_58_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_21_58_22&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;--close-on-end..&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_58_26_58_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_26_58_27&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">)
           </span><a href="GHC.IO.Handle.html#loc_293_1_293_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_293_1_293_7&#39;)"><span class="hl_varref"><span class="mpre">hFlush</span></span></a><span class="mpre"> </span><a href="#loc_58_21_58_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_21_58_22&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> 
           </span><a href="Network.Stream.html#loc_89_5_89_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_89_5_89_15&#39;)"><span class="hl_varref"><span class="mpre">closeOnEnd</span></span></a><span class="mpre"> </span><a href="#loc_58_23_58_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_23_58_24&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="#loc_58_26_58_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_26_58_27&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Wraps a stream with logging I\/O.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   The first argument is a filename which is opened in @AppendMode@.</span></span><span class="mpre">
</span><a href="#loc_66_1_66_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_12&#39;)"><span class="mpre">debugStream</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxParen (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/StreamDebugger.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 16, srcSpanEndLine = 65, srcSpanEndColumn = 29}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/StreamDebugger.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 16, srcSpanEndLine = 65, srcSpanEndColumn = 17},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/StreamDebugger.hs&quot;, s"><span class="mpre">(Stream a) =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_33_6_33_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_6_33_20&#39;)"><span class="hl_tyconref"><span class="mpre">StreamDebugger</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_66_1_66_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_12&#39;)"><span class="hl_fundecl"><span class="mpre">debugStream</span></span></a><span class="mpre"> </span><a name="loc_66_13_66_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_13_66_17&#39;)"><span class="hl_vardecl"><span class="mpre">file</span></span></a><span class="mpre"> </span><a name="loc_66_18_66_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_18_66_24&#39;)"><span class="hl_vardecl"><span class="mpre">stream</span></span></a><span class="mpre"> = 
    do </span><a name="loc_67_8_67_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_8_67_9&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Handle.FD.html#loc_150_1_150_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.FD.html#loc_150_1_150_9&#39;)"><span class="hl_varref"><span class="mpre">openFile</span></span></a><span class="mpre"> </span><a href="#loc_66_13_66_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_13_66_17&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre"> </span><a href="GHC.IO.IOMode.html#loc_28_44_28_54" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.IOMode.html#loc_28_44_28_54&#39;)"><span class="hl_conref"><span class="mpre">AppendMode</span></span></a><span class="mpre">
       </span><span class="hl_varref"><span class="mpre">hPutStrLn</span></span><span class="mpre"> </span><a href="#loc_67_8_67_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_8_67_9&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;File \&quot;&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_66_13_66_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_13_66_17&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;\&quot; opened for appending.&quot;</span></span><span class="mpre">)
       </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_34_6_34_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_6_34_9&#39;)"><span class="hl_conref"><span class="mpre">Dbg</span></span></a><span class="mpre"> </span><a href="#loc_67_8_67_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_8_67_9&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_66_18_66_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_18_66_24&#39;)"><span class="hl_varref"><span class="mpre">stream</span></span></a><span class="mpre">)

</span><a href="#loc_72_1_72_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_1_72_16&#39;)"><span class="mpre">debugByteStream</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/StreamDebugger.hs&quot;, srcSpanStartLine = 71, srcSpanStartColumn = 20, srcSpanEndLine = 71, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/StreamDebugger.hs&quot;, srcSpanStartLine = 71, srcSpanStartColumn = 31, srcSpanEndLine = 71, srcSpanEndColumn = 33}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP"><span class="mpre">HStream ty =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">HandleStream</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">HandleStream</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre">)
</span><a name="loc_72_1_72_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_1_72_16&#39;)"><span class="hl_fundecl"><span class="mpre">debugByteStream</span></span></a><span class="mpre"> </span><a name="loc_72_17_72_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_17_72_21&#39;)"><span class="hl_vardecl"><span class="mpre">file</span></span></a><span class="mpre"> </span><a name="loc_72_22_72_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_22_72_28&#39;)"><span class="hl_vardecl"><span class="mpre">stream</span></span></a><span class="mpre"> = do
   </span><a name="loc_73_4_73_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_4_73_6&#39;)"><span class="hl_vardecl"><span class="mpre">sh</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getStreamHooks</span></span><span class="mpre"> </span><a href="#loc_72_22_72_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_22_72_28&#39;)"><span class="hl_varref"><span class="mpre">stream</span></span></a><span class="mpre"> 
   case </span><a href="#loc_73_4_73_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_4_73_6&#39;)"><span class="hl_varref"><span class="mpre">sh</span></span></a><span class="mpre"> of
     </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_75_11_75_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_11_75_12&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> 
      | </span><span class="hl_varref"><span class="mpre">hook_name</span></span><span class="mpre"> </span><a href="#loc_75_11_75_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_11_75_12&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_72_17_72_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_17_72_21&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_72_22_72_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_22_72_28&#39;)"><span class="hl_varref"><span class="mpre">stream</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- reuse the stream hooks.</span></span><span class="mpre">
     _ -&gt; do
       </span><a name="loc_78_8_78_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_8_78_9&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Handle.FD.html#loc_150_1_150_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.FD.html#loc_150_1_150_9&#39;)"><span class="hl_varref"><span class="mpre">openFile</span></span></a><span class="mpre"> </span><a href="#loc_72_17_72_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_17_72_21&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre"> </span><a href="GHC.IO.IOMode.html#loc_28_44_28_54" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.IOMode.html#loc_28_44_28_54&#39;)"><span class="hl_conref"><span class="mpre">AppendMode</span></span></a><span class="mpre">
       </span><a href="GHC.IO.Handle.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">hSetBuffering</span></span></a><span class="mpre"> </span><a href="#loc_78_8_78_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_8_78_9&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">NoBuffering</span></span><span class="mpre">
       </span><span class="hl_varref"><span class="mpre">hPutStrLn</span></span><span class="mpre"> </span><a href="#loc_78_8_78_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_8_78_9&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;File \&quot;&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_72_17_72_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_17_72_21&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;\&quot; opened for appending.&quot;</span></span><span class="mpre">)
       </span><span class="hl_varref"><span class="mpre">setStreamHooks</span></span><span class="mpre"> </span><a href="#loc_72_22_72_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_22_72_28&#39;)"><span class="hl_varref"><span class="mpre">stream</span></span></a><span class="mpre"> (</span><a href="#loc_85_1_85_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_17&#39;)"><span class="hl_varref"><span class="mpre">debugStreamHooks</span></span></a><span class="mpre"> </span><a href="#loc_78_8_78_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_8_78_9&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_72_17_72_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_17_72_21&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre">)
       </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_72_22_72_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_22_72_28&#39;)"><span class="hl_varref"><span class="mpre">stream</span></span></a><span class="mpre">

</span><a href="#loc_85_1_85_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_17&#39;)"><span class="mpre">debugStreamHooks</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/StreamDebugger.hs&quot;, srcSpanStartLine = 84, srcSpanStartColumn = 21, srcSpanEndLine = 84, srcSpanEndColumn = 34}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/StreamDebugger.hs&quot;, srcSpanStartLine = 84, srcSpanStartColumn = 32, srcSpanEndLine = 84, srcSpanEndColumn = 34}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP"><span class="mpre">HStream ty =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">StreamHooks</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ty</span></span><span class="mpre">
</span><a name="loc_85_1_85_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_17&#39;)"><span class="hl_fundecl"><span class="mpre">debugStreamHooks</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">h</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">nm</span></span><span class="mpre"> = 
  </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/StreamDebugger.hs&quot;, srcSpanStartLine = 86, srcSpanStartColumn = 3, srcSpanEndLine = 103, srcSpanEndColumn = 6}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/StreamDebugger.hs&quot;, srcSpanStartLine = 87, srcSpanStartColumn = 5, srcSpanEndLine = 87, srcSpanEndColumn = 6},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/StreamDebugger.hs&quot;, sr"><span class="mpre">StreamHooks
    { hook_readBlock = \ toStr n val -&gt; do
       let eval = case val of { Left e -&gt; Left e ; Right v -&gt; Right $ toStr v}
       hPutStrLn h (&quot;--readBlock &quot; ++ show n)
       hPutStrLn h (either show show eval)
    , hook_readLine = \ toStr val -&gt; do
           let eval = case val of { Left e -&gt; Left e ; Right v -&gt; Right $ toStr v}
           hPutStrLn h (&quot;--readLine&quot;)
           hPutStrLn h (either show show eval)
    , hook_writeBlock = \ toStr str val -&gt; do
           hPutStrLn h (&quot;--writeBlock &quot; ++ show val)
           hPutStrLn h (toStr str)
    , hook_close = do
           hPutStrLn h &quot;--closing...&quot;
           hFlush h
           hClose h
    , hook_name = nm
    }</span></span><span class="mpre">
</span></div></body></html>