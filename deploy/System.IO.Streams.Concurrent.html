<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- | Stream utilities for working with concurrent channels.</span></span><span class="mpre">

{-# LANGUAGE BangPatterns #-}

module System.IO.Streams.Concurrent
 ( </span><span class="hl_comment"><span class="mpre">-- * Channel conversions</span></span><span class="mpre">
   inputToChan
 , chanToInput
 , chanToOutput
 , concurrentMerge
 , makeChanPipe
 ) where

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
import           Control.Applicative        (</span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="mpre">(&lt;$&gt;)</span></a><span class="mpre">, </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="mpre">(&lt;*&gt;)</span></a><span class="mpre">)
import           </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Concurrent.hs&quot;, srcSpanStartLine = 16, srcSpanStartColumn = 18, srcSpanEndLine = 16, srcSpanEndColumn = 36}, srcInfoPoints = []}) &quot;Control.Concurrent&quot;"><span class="mpre">Control.Concurrent</span></span><span class="mpre">         (forkIO)
import           Control.Concurrent.Chan    (</span><a href="Control.Concurrent.Chan.html#loc_51_6_51_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_51_6_51_10&#39;)"><span class="mpre">Chan</span></a><span class="mpre">, </span><a href="Control.Concurrent.Chan.html#loc_71_1_71_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_71_1_71_8&#39;)"><span class="mpre">newChan</span></a><span class="mpre">, </span><a href="Control.Concurrent.Chan.html#loc_103_1_103_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_103_1_103_9&#39;)"><span class="mpre">readChan</span></a><span class="mpre">, </span><a href="Control.Concurrent.Chan.html#loc_84_1_84_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_84_1_84_10&#39;)"><span class="mpre">writeChan</span></a><span class="mpre">)
import           Control.Concurrent.MVar    (</span><a href="Control.Concurrent.MVar.html#loc_228_1_228_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_228_1_228_11&#39;)"><span class="mpre">modifyMVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_64_1_64_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_64_1_64_13&#39;)"><span class="mpre">newEmptyMVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="mpre">newMVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="mpre">putMVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="mpre">takeMVar</span></a><span class="mpre">)
import           Control.Exception          (SomeException, </span><a href="GHC.IO.html#loc_428_1_428_5" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_428_1_428_5&#39;)"><span class="mpre">mask</span></a><span class="mpre">, </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="mpre">throwIO</span></a><span class="mpre">, </span><a href="Control.Exception.Base.html#loc_212_1_212_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_212_1_212_4&#39;)"><span class="mpre">try</span></a><span class="mpre">)
import           Control.Monad              (</span><a href="Control.Monad.html#loc_168_1_168_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_168_1_168_6&#39;)"><span class="mpre">forM_</span></a><span class="mpre">)
import           Prelude                    hiding (</span><a href="Text.Read.html#loc_91_1_91_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Read.html#loc_91_1_91_5&#39;)"><span class="mpre">read</span></a><span class="mpre">)
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
import           System.IO.Streams.Internal (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="mpre">InputStream</span></a><span class="mpre">, </span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="mpre">OutputStream</span></a><span class="mpre">, </span><a href="System.IO.Streams.Internal.html#loc_247_1_247_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_247_1_247_16&#39;)"><span class="mpre">makeInputStream</span></a><span class="mpre">, </span><a href="System.IO.Streams.Internal.html#loc_273_1_273_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_273_1_273_17&#39;)"><span class="mpre">makeOutputStream</span></a><span class="mpre">, </span><a href="System.IO.Streams.Internal.html#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_137_1_137_5&#39;)"><span class="mpre">read</span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Writes the contents of an input stream to a channel until the input stream</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- yields end-of-stream.</span></span><span class="mpre">
</span><a href="#loc_30_1_30_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_1_30_12&#39;)"><span class="mpre">inputToChan</span></a><span class="mpre"> :: </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="Control.Concurrent.Chan.html#loc_51_6_51_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_51_6_51_10&#39;)"><span class="hl_tyconref"><span class="mpre">Chan</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_30_1_30_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_1_30_12&#39;)"><span class="hl_fundecl"><span class="mpre">inputToChan</span></span></a><span class="mpre"> </span><a name="loc_30_13_30_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_13_30_15&#39;)"><span class="hl_vardecl"><span class="mpre">is</span></span></a><span class="mpre"> </span><a name="loc_30_16_30_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_16_30_18&#39;)"><span class="hl_vardecl"><span class="mpre">ch</span></span></a><span class="mpre"> = </span><a href="#loc_32_5_32_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_5_32_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">
  where
    </span><a name="loc_32_5_32_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_5_32_7&#39;)"><span class="hl_vardecl"><span class="mpre">go</span></span></a><span class="mpre"> = do
        </span><a name="loc_33_9_33_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_9_33_11&#39;)"><span class="hl_vardecl"><span class="mpre">mb</span></span></a><span class="mpre"> &lt;- </span><a href="System.IO.Streams.Internal.html#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_30_13_30_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_13_30_15&#39;)"><span class="hl_varref"><span class="mpre">is</span></span></a><span class="mpre">
        </span><a href="Control.Concurrent.Chan.html#loc_84_1_84_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_84_1_84_10&#39;)"><span class="hl_varref"><span class="mpre">writeChan</span></span></a><span class="mpre"> </span><a href="#loc_30_16_30_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_16_30_18&#39;)"><span class="hl_varref"><span class="mpre">ch</span></span></a><span class="mpre"> </span><a href="#loc_33_9_33_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_9_33_11&#39;)"><span class="hl_varref"><span class="mpre">mb</span></span></a><span class="mpre">
        </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> </span><a href="#loc_32_5_32_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_5_32_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">) </span><a href="#loc_33_9_33_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_9_33_11&#39;)"><span class="hl_varref"><span class="mpre">mb</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Turns a &#39;Chan&#39; into an input stream.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_42_1_42_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_12&#39;)"><span class="mpre">chanToInput</span></a><span class="mpre"> :: </span><a href="Control.Concurrent.Chan.html#loc_51_6_51_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_51_6_51_10&#39;)"><span class="hl_tyconref"><span class="mpre">Chan</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_42_1_42_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_12&#39;)"><span class="hl_fundecl"><span class="mpre">chanToInput</span></span></a><span class="mpre"> </span><a name="loc_42_13_42_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_13_42_15&#39;)"><span class="hl_vardecl"><span class="mpre">ch</span></span></a><span class="mpre"> = </span><a href="System.IO.Streams.Internal.html#loc_247_1_247_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_247_1_247_16&#39;)"><span class="hl_varref"><span class="mpre">makeInputStream</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="Control.Concurrent.Chan.html#loc_103_1_103_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_103_1_103_9&#39;)"><span class="hl_varref"><span class="mpre">readChan</span></span></a><span class="mpre"> </span><a href="#loc_42_13_42_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_13_42_15&#39;)"><span class="hl_varref"><span class="mpre">ch</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Turns a &#39;Chan&#39; into an output stream.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_49_1_49_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_1_49_13&#39;)"><span class="mpre">chanToOutput</span></a><span class="mpre"> :: </span><a href="Control.Concurrent.Chan.html#loc_51_6_51_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_51_6_51_10&#39;)"><span class="hl_tyconref"><span class="mpre">Chan</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_49_1_49_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_1_49_13&#39;)"><span class="hl_vardecl"><span class="mpre">chanToOutput</span></span></a><span class="mpre"> = </span><a href="System.IO.Streams.Internal.html#loc_273_1_273_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_273_1_273_17&#39;)"><span class="hl_varref"><span class="mpre">makeOutputStream</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Control.Concurrent.Chan.html#loc_84_1_84_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_84_1_84_10&#39;)"><span class="hl_varref"><span class="mpre">writeChan</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Concurrently merges a list of &#39;InputStream&#39;s, combining values in the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- order they become available.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note: does /not/ forward individual end-of-stream notifications, the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- produced stream does not yield end-of-stream until all of the input streams</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- have finished.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This traps exceptions in each concurrent thread and re-raises them in the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- current thread.</span></span><span class="mpre">
</span><a href="#loc_63_1_63_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_1_63_16&#39;)"><span class="mpre">concurrentMerge</span></a><span class="mpre"> :: [</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_63_1_63_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_1_63_16&#39;)"><span class="hl_fundecl"><span class="mpre">concurrentMerge</span></span></a><span class="mpre"> </span><a name="loc_63_17_63_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_17_63_20&#39;)"><span class="hl_vardecl"><span class="mpre">iss</span></span></a><span class="mpre"> = do
    </span><a name="loc_64_5_64_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_7&#39;)"><span class="hl_vardecl"><span class="mpre">mv</span></span></a><span class="mpre">    &lt;- </span><a href="GHC.MVar.html#loc_64_1_64_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_64_1_64_13&#39;)"><span class="hl_varref"><span class="mpre">newEmptyMVar</span></span></a><span class="mpre">
    </span><a name="loc_65_5_65_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_5_65_10&#39;)"><span class="hl_vardecl"><span class="mpre">nleft</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="hl_varref"><span class="mpre">newMVar</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">length</span></span><span class="mpre"> </span><a href="#loc_63_17_63_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_17_63_20&#39;)"><span class="hl_varref"><span class="mpre">iss</span></span></a><span class="mpre">
    </span><a href="GHC.IO.html#loc_428_1_428_5" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_428_1_428_5&#39;)"><span class="hl_varref"><span class="mpre">mask</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_66_13_66_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_13_66_20&#39;)"><span class="hl_vardecl"><span class="mpre">restore</span></span></a><span class="mpre"> -&gt; </span><a href="Control.Monad.html#loc_168_1_168_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_168_1_168_6&#39;)"><span class="hl_varref"><span class="mpre">forM_</span></span></a><span class="mpre"> </span><a href="#loc_63_17_63_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_17_63_20&#39;)"><span class="hl_varref"><span class="mpre">iss</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_66_37_66_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_37_66_39&#39;)"><span class="hl_vardecl"><span class="mpre">is</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">forkIO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        let </span><a name="loc_67_13_67_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_13_67_21&#39;)"><span class="hl_vardecl"><span class="mpre">producer</span></span></a><span class="mpre"> = do
              </span><a name="loc_68_15_68_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_15_68_18&#39;)"><span class="hl_vardecl"><span class="mpre">emb</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Exception.Base.html#loc_212_1_212_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_212_1_212_4&#39;)"><span class="hl_varref"><span class="mpre">try</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_66_13_66_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_13_66_20&#39;)"><span class="hl_varref"><span class="mpre">restore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="System.IO.Streams.Internal.html#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_66_37_66_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_37_66_39&#39;)"><span class="hl_varref"><span class="mpre">is</span></span></a><span class="mpre">
              case </span><a href="#loc_68_15_68_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_15_68_18&#39;)"><span class="hl_varref"><span class="mpre">emb</span></span></a><span class="mpre"> of
                  </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_70_24_70_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_24_70_27&#39;)"><span class="hl_vardecl"><span class="mpre">exc</span></span></a><span class="mpre">      -&gt; do </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_64_5_64_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_7&#39;)"><span class="hl_varref"><span class="mpre">mv</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> (</span><a href="#loc_70_24_70_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_24_70_27&#39;)"><span class="hl_varref"><span class="mpre">exc</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">SomeException</span></span><span class="mpre">))
                                      </span><a href="#loc_67_13_67_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_13_67_21&#39;)"><span class="hl_varref"><span class="mpre">producer</span></span></a><span class="mpre">
                  </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_64_5_64_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_7&#39;)"><span class="hl_varref"><span class="mpre">mv</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
                  </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a name="loc_73_25_73_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_25_73_26&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">       -&gt; </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_64_5_64_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_7&#39;)"><span class="hl_varref"><span class="mpre">mv</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a href="#loc_73_25_73_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_25_73_26&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_67_13_67_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_13_67_21&#39;)"><span class="hl_varref"><span class="mpre">producer</span></span></a><span class="mpre">
        </span><a href="#loc_67_13_67_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_13_67_21&#39;)"><span class="hl_varref"><span class="mpre">producer</span></span></a><span class="mpre">
    </span><a href="System.IO.Streams.Internal.html#loc_247_1_247_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_247_1_247_16&#39;)"><span class="hl_varref"><span class="mpre">makeInputStream</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_78_5_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_5_78_10&#39;)"><span class="hl_varref"><span class="mpre">chunk</span></span></a><span class="mpre"> </span><a href="#loc_64_5_64_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_7&#39;)"><span class="hl_varref"><span class="mpre">mv</span></span></a><span class="mpre"> </span><a href="#loc_65_5_65_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_5_65_10&#39;)"><span class="hl_varref"><span class="mpre">nleft</span></span></a><span class="mpre">

  where
    </span><a name="loc_78_5_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_5_78_10&#39;)"><span class="hl_fundecl"><span class="mpre">chunk</span></span></a><span class="mpre"> </span><a name="loc_78_11_78_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_11_78_13&#39;)"><span class="hl_vardecl"><span class="mpre">mv</span></span></a><span class="mpre"> </span><a name="loc_78_14_78_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_14_78_19&#39;)"><span class="hl_vardecl"><span class="mpre">nleft</span></span></a><span class="mpre"> = do
        </span><a name="loc_79_9_79_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_9_79_12&#39;)"><span class="hl_vardecl"><span class="mpre">emb</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="hl_varref"><span class="mpre">takeMVar</span></span></a><span class="mpre"> </span><a href="#loc_78_11_78_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_11_78_13&#39;)"><span class="hl_varref"><span class="mpre">mv</span></span></a><span class="mpre">
        case </span><a href="#loc_79_9_79_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_9_79_12&#39;)"><span class="hl_varref"><span class="mpre">emb</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_81_18_81_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_18_81_21&#39;)"><span class="hl_vardecl"><span class="mpre">exc</span></span></a><span class="mpre">      -&gt; </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="#loc_81_18_81_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_18_81_21&#39;)"><span class="hl_varref"><span class="mpre">exc</span></span></a><span class="mpre">
            </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; do </span><a name="loc_82_33_82_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_33_82_34&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Concurrent.MVar.html#loc_228_1_228_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_228_1_228_11&#39;)"><span class="hl_varref"><span class="mpre">modifyMVar</span></span></a><span class="mpre"> </span><a href="#loc_78_14_78_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_14_78_19&#39;)"><span class="hl_varref"><span class="mpre">nleft</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_82_58_82_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_58_82_59&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> -&gt;
                                     let !</span><a name="loc_83_43_83_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_43_83_45&#39;)"><span class="hl_vardecl"><span class="mpre">n&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_82_58_82_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_58_82_59&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
                                     in </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> (</span><a href="#loc_83_43_83_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_43_83_45&#39;)"><span class="hl_varref"><span class="mpre">n&#39;</span></span></a><span class="mpre">, </span><a href="#loc_83_43_83_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_43_83_45&#39;)"><span class="hl_varref"><span class="mpre">n&#39;</span></span></a><span class="mpre">)
                                if </span><a href="#loc_82_33_82_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_33_82_34&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
                                  then </span><a href="#loc_78_5_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_5_78_10&#39;)"><span class="hl_varref"><span class="mpre">chunk</span></span></a><span class="mpre"> </span><a href="#loc_78_11_78_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_11_78_13&#39;)"><span class="hl_varref"><span class="mpre">mv</span></span></a><span class="mpre"> </span><a href="#loc_78_14_78_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_14_78_19&#39;)"><span class="hl_varref"><span class="mpre">nleft</span></span></a><span class="mpre">
                                  else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
            </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a name="loc_88_19_88_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_19_88_20&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">       -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_88_19_88_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_19_88_20&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Create a new pair of streams using an underlying &#39;Chan&#39;. Everything written</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to the &#39;OutputStream&#39; will appear as-is on the &#39;InputStream&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Since reading from the &#39;InputStream&#39; and writing to the &#39;OutputStream&#39; are</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- blocking calls, be sure to do so in different threads.</span></span><span class="mpre">
</span><a href="#loc_98_1_98_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_13&#39;)"><span class="mpre">makeChanPipe</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_98_1_98_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_13&#39;)"><span class="hl_vardecl"><span class="mpre">makeChanPipe</span></span></a><span class="mpre"> = do
    </span><a name="loc_99_5_99_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_5_99_9&#39;)"><span class="hl_vardecl"><span class="mpre">chan</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Concurrent.Chan.html#loc_71_1_71_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_71_1_71_8&#39;)"><span class="hl_varref"><span class="mpre">newChan</span></span></a><span class="mpre">
    </span><span class="hl_conref"><span class="mpre">(,)</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="#loc_42_1_42_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_12&#39;)"><span class="hl_varref"><span class="mpre">chanToInput</span></span></a><span class="mpre"> </span><a href="#loc_99_5_99_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_5_99_9&#39;)"><span class="hl_varref"><span class="mpre">chan</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="#loc_49_1_49_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_1_49_13&#39;)"><span class="hl_varref"><span class="mpre">chanToOutput</span></span></a><span class="mpre"> </span><a href="#loc_99_5_99_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_5_99_9&#39;)"><span class="hl_varref"><span class="mpre">chan</span></span></a><span class="mpre">
</span></div></body></html>