<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- | Asynchronous communication between pipes</span></span><span class="mpre">

{-# LANGUAGE RankNTypes, Trustworthy #-}

</span><span class="hl_comment"><span class="mpre">{- &#39;unsafeIOToSTM&#39; requires the Trustworthy annotation.

    I use &#39;unsafeIOToSTM&#39; to touch IORefs to mark them as still alive. This
    action satisfies the necessary safety requirements because:

    * You can safely repeat it if the transaction rolls back

    * It does not acquire any resources

    * It does not leak any inconsistent view of memory to the outside world

    It appears to be unnecessary to read the IORef to keep it from being garbage
    collected, but I wanted to be absolutely certain since I cannot be sure that
    GHC won&#39;t optimize away the reference to the IORef.

    The other alternative was to make &#39;send&#39; and &#39;recv&#39; use the &#39;IO&#39; monad
    instead of &#39;STM&#39;, but I felt that it was important to preserve the ability
    to combine them into larger transactions.
-}</span></span><span class="mpre">

module Pipes.Concurrent (
    </span><span class="hl_comment"><span class="mpre">-- * Inputs and Outputs</span></span><span class="mpre">
    Input(..),
    Output(..),

    </span><span class="hl_comment"><span class="mpre">-- * Pipe utilities</span></span><span class="mpre">
    fromInput,
    toOutput,

    </span><span class="hl_comment"><span class="mpre">-- * Actors</span></span><span class="mpre">
    spawn,
    spawn&#39;,
    Buffer(..),

    </span><span class="hl_comment"><span class="mpre">-- * Re-exports</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- $reexport</span></span><span class="mpre">
    module Control.Concurrent,
    module Control.Concurrent.STM,
    module System.Mem
    ) where

import Control.Applicative (
    </span><a href="Control.Applicative.html#loc_138_24_138_35" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_138_24_138_35&#39;)"><span class="mpre">Alternative</span></a><span class="mpre">(</span><a href="Control.Applicative.html#loc_140_5_140_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_140_5_140_10&#39;)"><span class="mpre">empty</span></a><span class="mpre">, </span><a href="Control.Applicative.html#loc_142_5_142_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_142_5_142_10&#39;)"><span class="mpre">(&lt;|&gt;)</span></a><span class="mpre">), </span><a href="Control.Applicative.html#loc_113_20_113_31" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_113_20_113_31&#39;)"><span class="mpre">Applicative</span></a><span class="mpre">(</span><a href="Control.Applicative.html#loc_115_5_115_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_115_5_115_9&#39;)"><span class="mpre">pure</span></a><span class="mpre">, </span><a href="Control.Applicative.html#loc_121_5_121_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_121_5_121_9&#39;)"><span class="mpre">(*&gt;)</span></a><span class="mpre">, </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="mpre">(&lt;*&gt;)</span></a><span class="mpre">), </span><a href="Control.Applicative.html#loc_125_5_125_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_125_5_125_9&#39;)"><span class="mpre">(&lt;*)</span></a><span class="mpre">, </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="mpre">(&lt;$&gt;)</span></a><span class="mpre"> )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-concurrency-2.0.2/src/Pipes/Concurrent.hs&quot;, srcSpanStartLine = 48, srcSpanStartColumn = 8, srcSpanEndLine = 48, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;Control.Concurrent&quot;"><span class="mpre">Control.Concurrent</span></span><span class="mpre"> (forkIO)
import Control.Concurrent.STM (</span><a href="Control.Sequential.STM.html#loc_44_1_44_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_44_1_44_11&#39;)"><span class="mpre">atomically</span></a><span class="mpre">, </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="mpre">STM</span></a><span class="mpre">)
import qualified Control.Concurrent.STM as S
import Control.Monad (</span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">)
import Data.IORef (</span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="mpre">newIORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="mpre">readIORef</span></a><span class="mpre">, </span><a href="Data.IORef.html#loc_52_1_52_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_52_1_52_12&#39;)"><span class="mpre">mkWeakIORef</span></a><span class="mpre">)
import Data.Monoid (</span><a href="Data.Monoid.html#loc_79_7_79_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_79_7_79_13&#39;)"><span class="mpre">Monoid</span></a><span class="mpre">(</span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="mpre">mempty</span></a><span class="mpre">, </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="mpre">mappend</span></a><span class="mpre">))
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-concurrency-2.0.2/src/Pipes/Concurrent.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 8, srcSpanEndLine = 54, srcSpanEndColumn = 21}, srcInfoPoints = []}) &quot;GHC.Conc.Sync&quot;"><span class="mpre">GHC.Conc.Sync</span></span><span class="mpre"> (unsafeIOToSTM)
import Pipes (</span><a href="Control.Monad.IO.Class.html#loc_30_20_30_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_30_20_30_27&#39;)"><span class="mpre">MonadIO</span></a><span class="mpre">(</span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="mpre">liftIO</span></a><span class="mpre">), </span><a href="Pipes.html#loc_132_1_132_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.html#loc_132_1_132_6&#39;)"><span class="mpre">yield</span></a><span class="mpre">, </span><a href="Pipes.html#loc_246_1_246_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.html#loc_246_1_246_6&#39;)"><span class="mpre">await</span></a><span class="mpre">, Producer&#39;, Consumer&#39;)
import System.Mem (</span><a href="System.Mem.html#loc_26_1_26_10" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Mem.html#loc_26_1_26_10&#39;)"><span class="mpre">performGC</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">{-| An exhaustible source of values

    &#39;recv&#39; returns &#39;Nothing&#39; if the source is exhausted
-}</span></span><span class="mpre">
newtype </span><a name="loc_62_9_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_9_62_14&#39;)"><span class="hl_tycondecl"><span class="mpre">Input</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_62_19_62_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_19_62_24&#39;)"><span class="hl_condecl"><span class="mpre">Input</span></span></a><span class="mpre"> {
    </span><a name="loc_63_5_63_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_9&#39;)"><span class="hl_fielddecl"><span class="mpre">recv</span></span></a><span class="mpre"> :: </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">S.STM</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) }

instance </span><span class="hl_classref"><span class="mpre">Functor</span></span><span class="mpre"> </span><a href="#loc_62_9_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_9_62_14&#39;)"><span class="hl_tyconref"><span class="mpre">Input</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">fmap</span></span><span class="mpre"> </span><a name="loc_66_10_66_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_10_66_11&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_66_12_66_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_12_66_13&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><a href="#loc_62_19_62_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_19_62_24&#39;)"><span class="hl_conref"><span class="mpre">Input</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> </span><a href="#loc_66_10_66_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_10_66_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">) (</span><a href="#loc_63_5_63_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_9&#39;)"><span class="hl_varref"><span class="mpre">recv</span></span></a><span class="mpre"> </span><a href="#loc_66_12_66_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_12_66_13&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">))

instance </span><a href="Control.Applicative.html#loc_113_20_113_31" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_113_20_113_31&#39;)"><span class="hl_classref"><span class="mpre">Applicative</span></span></a><span class="mpre"> </span><a href="#loc_62_9_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_9_62_14&#39;)"><span class="hl_tyconref"><span class="mpre">Input</span></span></a><span class="mpre"> where
    </span><a href="Control.Applicative.html#loc_115_5_115_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_115_5_115_9&#39;)"><span class="hl_fundecl"><span class="mpre">pure</span></span></a><span class="mpre"> </span><a name="loc_69_10_69_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_10_69_11&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">    = </span><a href="#loc_62_19_62_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_19_62_24&#39;)"><span class="hl_conref"><span class="mpre">Input</span></span></a><span class="mpre"> (</span><a href="Control.Applicative.html#loc_115_5_115_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_115_5_115_9&#39;)"><span class="hl_varref"><span class="mpre">pure</span></span></a><span class="mpre"> (</span><a href="Control.Applicative.html#loc_115_5_115_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_115_5_115_9&#39;)"><span class="hl_varref"><span class="mpre">pure</span></span></a><span class="mpre"> </span><a href="#loc_69_10_69_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_10_69_11&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">))
    </span><a name="loc_70_5_70_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_5_70_7&#39;)"><span class="hl_vardecl"><span class="mpre">mf</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_fundecl"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a name="loc_70_12_70_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_12_70_14&#39;)"><span class="hl_vardecl"><span class="mpre">mx</span></span></a><span class="mpre"> = </span><a href="#loc_62_19_62_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_19_62_24&#39;)"><span class="hl_conref"><span class="mpre">Input</span></span></a><span class="mpre"> (</span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_varref"><span class="mpre">(&lt;*&gt;)</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="#loc_63_5_63_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_9&#39;)"><span class="hl_varref"><span class="mpre">recv</span></span></a><span class="mpre"> </span><a href="#loc_70_5_70_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_5_70_7&#39;)"><span class="hl_varref"><span class="mpre">mf</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="#loc_63_5_63_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_9&#39;)"><span class="hl_varref"><span class="mpre">recv</span></span></a><span class="mpre"> </span><a href="#loc_70_12_70_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_12_70_14&#39;)"><span class="hl_varref"><span class="mpre">mx</span></span></a><span class="mpre">)

instance </span><span class="hl_classref"><span class="mpre">Monad</span></span><span class="mpre"> </span><a href="#loc_62_9_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_9_62_14&#39;)"><span class="hl_tyconref"><span class="mpre">Input</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">return</span></span><span class="mpre"> </span><a name="loc_73_12_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_12_73_13&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = </span><a href="#loc_62_19_62_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_19_62_24&#39;)"><span class="hl_conref"><span class="mpre">Input</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_73_12_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_12_73_13&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">))
    </span><a name="loc_74_5_74_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_5_74_6&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_fundecl"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a name="loc_74_11_74_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_11_74_12&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre">  = </span><a href="#loc_62_19_62_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_19_62_24&#39;)"><span class="hl_conref"><span class="mpre">Input</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><a name="loc_75_9_75_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_9_75_11&#39;)"><span class="hl_vardecl"><span class="mpre">ma</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_63_5_63_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_9&#39;)"><span class="hl_varref"><span class="mpre">recv</span></span></a><span class="mpre"> </span><a href="#loc_74_5_74_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_5_74_6&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
        case </span><a href="#loc_75_9_75_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_9_75_11&#39;)"><span class="hl_varref"><span class="mpre">ma</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
            </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_78_18_78_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_18_78_19&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">  -&gt; </span><a href="#loc_63_5_63_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_9&#39;)"><span class="hl_varref"><span class="mpre">recv</span></span></a><span class="mpre"> (</span><a href="#loc_74_11_74_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_11_74_12&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_78_18_78_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_18_78_19&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)

instance </span><a href="Control.Applicative.html#loc_138_24_138_35" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_138_24_138_35&#39;)"><span class="hl_classref"><span class="mpre">Alternative</span></span></a><span class="mpre"> </span><a href="#loc_62_9_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_9_62_14&#39;)"><span class="hl_tyconref"><span class="mpre">Input</span></span></a><span class="mpre"> where
    </span><a href="Control.Applicative.html#loc_140_5_140_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_140_5_140_10&#39;)"><span class="hl_vardecl"><span class="mpre">empty</span></span></a><span class="mpre">   = </span><a href="#loc_62_19_62_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_19_62_24&#39;)"><span class="hl_conref"><span class="mpre">Input</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">)
    </span><a name="loc_82_5_82_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_5_82_6&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_142_5_142_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_142_5_142_10&#39;)"><span class="hl_fundecl"><span class="mpre">&lt;|&gt;</span></span></a><span class="mpre"> </span><a name="loc_82_11_82_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_11_82_12&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre"> = </span><a href="#loc_62_19_62_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_19_62_24&#39;)"><span class="hl_conref"><span class="mpre">Input</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        (</span><a name="loc_83_10_83_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_10_83_11&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">, </span><a name="loc_83_13_83_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_13_83_15&#39;)"><span class="hl_vardecl"><span class="mpre">ma</span></span></a><span class="mpre">) &lt;- </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">(,)</span></span><span class="mpre"> </span><a href="#loc_82_11_82_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_11_82_12&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">) (</span><a href="#loc_63_5_63_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_9&#39;)"><span class="hl_varref"><span class="mpre">recv</span></span></a><span class="mpre"> </span><a href="#loc_82_5_82_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_5_82_6&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) </span><a href="Control.Applicative.html#loc_142_5_142_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_142_5_142_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;|&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">(,)</span></span><span class="mpre"> </span><a href="#loc_82_5_82_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_5_82_6&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)(</span><a href="#loc_63_5_63_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_9&#39;)"><span class="hl_varref"><span class="mpre">recv</span></span></a><span class="mpre"> </span><a href="#loc_82_11_82_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_11_82_12&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">)
        case </span><a href="#loc_83_13_83_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_13_83_15&#39;)"><span class="hl_varref"><span class="mpre">ma</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><a href="#loc_63_5_63_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_9&#39;)"><span class="hl_varref"><span class="mpre">recv</span></span></a><span class="mpre"> </span><a href="#loc_83_10_83_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_10_83_11&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
            </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_86_18_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_18_86_19&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_86_18_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_18_86_19&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)

instance </span><a href="Data.Monoid.html#loc_79_7_79_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_79_7_79_13&#39;)"><span class="hl_classref"><span class="mpre">Monoid</span></span></a><span class="mpre"> (</span><a href="#loc_62_9_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_9_62_14&#39;)"><span class="hl_tyconref"><span class="mpre">Input</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) where
    </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_vardecl"><span class="mpre">mempty</span></span></a><span class="mpre"> = </span><a href="Control.Applicative.html#loc_140_5_140_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_140_5_140_10&#39;)"><span class="hl_varref"><span class="mpre">empty</span></span></a><span class="mpre">
    </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_vardecl"><span class="mpre">mappend</span></span></a><span class="mpre"> = </span><a href="Control.Applicative.html#loc_142_5_142_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_142_5_142_10&#39;)"><span class="hl_varref"><span class="mpre">(&lt;|&gt;)</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-| An exhaustible sink of values

    &#39;send&#39; returns &#39;False&#39; if the sink is exhausted
-}</span></span><span class="mpre">
newtype </span><a name="loc_96_9_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_9_96_15&#39;)"><span class="hl_tycondecl"><span class="mpre">Output</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_96_20_96_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_20_96_26&#39;)"><span class="hl_condecl"><span class="mpre">Output</span></span></a><span class="mpre"> {
    </span><a name="loc_97_5_97_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_5_97_9&#39;)"><span class="hl_fielddecl"><span class="mpre">send</span></span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">S.STM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> }

instance </span><a href="Data.Monoid.html#loc_79_7_79_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_79_7_79_13&#39;)"><span class="hl_classref"><span class="mpre">Monoid</span></span></a><span class="mpre"> (</span><a href="#loc_96_9_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_9_96_15&#39;)"><span class="hl_tyconref"><span class="mpre">Output</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) where
    </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_vardecl"><span class="mpre">mempty</span></span></a><span class="mpre">  = </span><a href="#loc_96_20_96_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_20_96_26&#39;)"><span class="hl_conref"><span class="mpre">Output</span></span></a><span class="mpre"> (\_ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">)
    </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_fundecl"><span class="mpre">mappend</span></span></a><span class="mpre"> </span><a name="loc_101_13_101_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_13_101_15&#39;)"><span class="hl_vardecl"><span class="mpre">i1</span></span></a><span class="mpre"> </span><a name="loc_101_16_101_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_16_101_18&#39;)"><span class="hl_vardecl"><span class="mpre">i2</span></span></a><span class="mpre"> = </span><a href="#loc_96_20_96_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_20_96_26&#39;)"><span class="hl_conref"><span class="mpre">Output</span></span></a><span class="mpre"> (\</span><a name="loc_101_30_101_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_30_101_31&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">(||)</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="#loc_97_5_97_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_5_97_9&#39;)"><span class="hl_varref"><span class="mpre">send</span></span></a><span class="mpre"> </span><a href="#loc_101_13_101_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_13_101_15&#39;)"><span class="hl_varref"><span class="mpre">i1</span></span></a><span class="mpre"> </span><a href="#loc_101_30_101_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_30_101_31&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="#loc_97_5_97_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_5_97_9&#39;)"><span class="hl_varref"><span class="mpre">send</span></span></a><span class="mpre"> </span><a href="#loc_101_16_101_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_16_101_18&#39;)"><span class="hl_varref"><span class="mpre">i2</span></span></a><span class="mpre"> </span><a href="#loc_101_30_101_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_30_101_31&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">{-| Convert an &#39;Output&#39; to a &#39;Pipes.Consumer&#39;

    &#39;toOutput&#39; terminates when the &#39;Output&#39; is exhausted.
-}</span></span><span class="mpre">
</span><a href="#loc_108_1_108_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_9&#39;)"><span class="mpre">toOutput</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxParen (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-concurrency-2.0.2/src/Pipes/Concurrent.hs&quot;, srcSpanStartLine = 107, srcSpanStartColumn = 13, srcSpanEndLine = 107, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-concurrency-2.0.2/src/Pipes/Concurrent.hs&quot;, srcSpanStartLine = 107, srcSpanStartColumn = 13, srcSpanEndLine = 107, srcSpanEndColumn = 14},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-concurrency-2.0.2/sr"><span class="mpre">(MonadIO m) =&gt;</span></span><span class="mpre"> </span><a href="#loc_96_9_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_9_96_15&#39;)"><span class="hl_tyconref"><span class="mpre">Output</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Consumer&#39;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_108_1_108_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_9&#39;)"><span class="hl_fundecl"><span class="mpre">toOutput</span></span></a><span class="mpre"> </span><a name="loc_108_10_108_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_10_108_16&#39;)"><span class="hl_vardecl"><span class="mpre">output</span></span></a><span class="mpre"> = </span><a href="#loc_110_5_110_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_5_110_9&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre">
  where
    </span><a name="loc_110_5_110_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_5_110_9&#39;)"><span class="hl_vardecl"><span class="mpre">loop</span></span></a><span class="mpre"> = do
        </span><a name="loc_111_9_111_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_9_111_10&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">     &lt;- </span><a href="Pipes.html#loc_246_1_246_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.html#loc_246_1_246_6&#39;)"><span class="hl_varref"><span class="mpre">await</span></span></a><span class="mpre">
        </span><a name="loc_112_9_112_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_9_112_14&#39;)"><span class="hl_vardecl"><span class="mpre">alive</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Sequential.STM.html#loc_44_1_44_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_44_1_44_11&#39;)"><span class="hl_varref"><span class="mpre">S.atomically</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_97_5_97_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_5_97_9&#39;)"><span class="hl_varref"><span class="mpre">send</span></span></a><span class="mpre"> </span><a href="#loc_108_10_108_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_10_108_16&#39;)"><span class="hl_varref"><span class="mpre">output</span></span></a><span class="mpre"> </span><a href="#loc_111_9_111_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_9_111_10&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
        </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_112_9_112_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_9_112_14&#39;)"><span class="hl_varref"><span class="mpre">alive</span></span></a><span class="mpre"> </span><a href="#loc_110_5_110_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_5_110_9&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre">
</span><span class="hl_comment"><span class="mpre">{-# INLINABLE toOutput #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-| Convert an &#39;Input&#39; to a &#39;Pipes.Producer&#39;

    &#39;fromInput&#39; terminates when the &#39;Input&#39; is exhausted.
-}</span></span><span class="mpre">
</span><a href="#loc_121_1_121_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_1_121_10&#39;)"><span class="mpre">fromInput</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxParen (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-concurrency-2.0.2/src/Pipes/Concurrent.hs&quot;, srcSpanStartLine = 120, srcSpanStartColumn = 14, srcSpanEndLine = 120, srcSpanEndColumn = 28}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-concurrency-2.0.2/src/Pipes/Concurrent.hs&quot;, srcSpanStartLine = 120, srcSpanStartColumn = 14, srcSpanEndLine = 120, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pipes-concurrency-2.0.2/sr"><span class="mpre">(MonadIO m) =&gt;</span></span><span class="mpre"> </span><a href="#loc_62_9_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_9_62_14&#39;)"><span class="hl_tyconref"><span class="mpre">Input</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Producer&#39;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_121_1_121_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_1_121_10&#39;)"><span class="hl_fundecl"><span class="mpre">fromInput</span></span></a><span class="mpre"> </span><a name="loc_121_11_121_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_11_121_16&#39;)"><span class="hl_vardecl"><span class="mpre">input</span></span></a><span class="mpre"> = </span><a href="#loc_123_5_123_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_5_123_9&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre">
  where
    </span><a name="loc_123_5_123_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_5_123_9&#39;)"><span class="hl_vardecl"><span class="mpre">loop</span></span></a><span class="mpre"> = do
        </span><a name="loc_124_9_124_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_9_124_11&#39;)"><span class="hl_vardecl"><span class="mpre">ma</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Sequential.STM.html#loc_44_1_44_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_44_1_44_11&#39;)"><span class="hl_varref"><span class="mpre">S.atomically</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_63_5_63_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_9&#39;)"><span class="hl_varref"><span class="mpre">recv</span></span></a><span class="mpre"> </span><a href="#loc_121_11_121_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_11_121_16&#39;)"><span class="hl_varref"><span class="mpre">input</span></span></a><span class="mpre">
        case </span><a href="#loc_124_9_124_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_9_124_11&#39;)"><span class="hl_varref"><span class="mpre">ma</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
            </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_127_18_127_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_18_127_19&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">  -&gt; do
                </span><a href="Pipes.html#loc_132_1_132_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Pipes.html#loc_132_1_132_6&#39;)"><span class="hl_varref"><span class="mpre">yield</span></span></a><span class="mpre"> </span><a href="#loc_127_18_127_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_18_127_19&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
                </span><a href="#loc_123_5_123_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_5_123_9&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre">
</span><span class="hl_comment"><span class="mpre">{-# INLINABLE fromInput #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-| Spawn a mailbox using the specified &#39;Buffer&#39; to store messages

    Using &#39;send&#39; on the &#39;Output&#39;

        * fails and returns &#39;False&#39; if the mailbox is sealed, otherwise it:

        * retries if the mailbox is full, or:

        * adds a message to the mailbox and returns &#39;True&#39;.

    Using &#39;recv&#39; on the &#39;Input&#39;:

        * retrieves a message from the mailbox wrapped in &#39;Just&#39; if the mailbox
          is not empty, otherwise it:

        * retries if the mailbox is not sealed, or:

        * fails and returns &#39;Nothing&#39;.

    If either the &#39;Input&#39; or &#39;Output&#39; is garbage collected the mailbox will
    become sealed.
-}</span></span><span class="mpre">
</span><a href="#loc_155_1_155_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_6&#39;)"><span class="mpre">spawn</span></a><span class="mpre"> :: </span><a href="#loc_221_6_221_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_6_221_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_96_9_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_9_96_15&#39;)"><span class="hl_tyconref"><span class="mpre">Output</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><a href="#loc_62_9_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_9_62_14&#39;)"><span class="hl_tyconref"><span class="mpre">Input</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_155_1_155_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_6&#39;)"><span class="hl_fundecl"><span class="mpre">spawn</span></span></a><span class="mpre"> </span><a name="loc_155_7_155_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_7_155_13&#39;)"><span class="hl_vardecl"><span class="mpre">buffer</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> </span><a href="#loc_157_5_157_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_5_157_13&#39;)"><span class="hl_varref"><span class="mpre">simplify</span></span></a><span class="mpre"> (</span><a href="#loc_170_1_170_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_7&#39;)"><span class="hl_varref"><span class="mpre">spawn&#39;</span></span></a><span class="mpre"> </span><a href="#loc_155_7_155_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_7_155_13&#39;)"><span class="hl_varref"><span class="mpre">buffer</span></span></a><span class="mpre">)
  where
    </span><a name="loc_157_5_157_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_5_157_13&#39;)"><span class="hl_fundecl"><span class="mpre">simplify</span></span></a><span class="mpre"> (</span><a name="loc_157_15_157_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_15_157_21&#39;)"><span class="hl_vardecl"><span class="mpre">output</span></span></a><span class="mpre">, </span><a name="loc_157_23_157_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_23_157_28&#39;)"><span class="hl_vardecl"><span class="mpre">input</span></span></a><span class="mpre">, _) = (</span><a href="#loc_157_15_157_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_15_157_21&#39;)"><span class="hl_varref"><span class="mpre">output</span></span></a><span class="mpre">, </span><a href="#loc_157_23_157_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_23_157_28&#39;)"><span class="hl_varref"><span class="mpre">input</span></span></a><span class="mpre">)
</span><span class="hl_comment"><span class="mpre">{-# INLINABLE spawn #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-| Like &#39;spawn&#39;, but also returns an action to manually @seal@ the mailbox
    early:

&gt; (output, input, seal) &lt;- spawn&#39; buffer
&gt; ...

    Use the @seal@ action to allow early cleanup of readers and writers to the
    mailbox without waiting for the next garbage collection cycle.
-}</span></span><span class="mpre">
</span><a href="#loc_170_1_170_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_7&#39;)"><span class="mpre">spawn&#39;</span></a><span class="mpre"> :: </span><a href="#loc_221_6_221_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_6_221_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_96_9_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_9_96_15&#39;)"><span class="hl_tyconref"><span class="mpre">Output</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><a href="#loc_62_9_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_9_62_14&#39;)"><span class="hl_tyconref"><span class="mpre">Input</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">STM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)
</span><a name="loc_170_1_170_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_7&#39;)"><span class="hl_fundecl"><span class="mpre">spawn&#39;</span></span></a><span class="mpre"> </span><a name="loc_170_8_170_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_8_170_14&#39;)"><span class="hl_vardecl"><span class="mpre">buffer</span></span></a><span class="mpre"> = do
    (</span><a name="loc_171_6_171_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_6_171_11&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre">, </span><a name="loc_171_13_171_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_13_171_17&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre">) &lt;- case </span><a href="#loc_170_8_170_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_8_170_14&#39;)"><span class="hl_varref"><span class="mpre">buffer</span></span></a><span class="mpre"> of
        </span><a href="#loc_225_7_225_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_7_225_14&#39;)"><span class="hl_conref"><span class="mpre">Bounded</span></span></a><span class="mpre"> </span><a name="loc_172_17_172_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_17_172_18&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> -&gt; do
            </span><a name="loc_173_13_173_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_13_173_14&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Concurrent.STM.TBQueue.html#loc_89_1_89_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TBQueue.html#loc_89_1_89_13&#39;)"><span class="hl_varref"><span class="mpre">S.newTBQueueIO</span></span></a><span class="mpre"> </span><a href="#loc_172_17_172_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_17_172_18&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Control.Concurrent.STM.TBQueue.html#loc_98_1_98_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TBQueue.html#loc_98_1_98_13&#39;)"><span class="hl_varref"><span class="mpre">S.writeTBQueue</span></span></a><span class="mpre"> </span><a href="#loc_173_13_173_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_13_173_14&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">, </span><a href="Control.Concurrent.STM.TBQueue.html#loc_113_1_113_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TBQueue.html#loc_113_1_113_12&#39;)"><span class="hl_varref"><span class="mpre">S.readTBQueue</span></span></a><span class="mpre"> </span><a href="#loc_173_13_173_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_13_173_14&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">)
        </span><a href="#loc_223_7_223_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_7_223_16&#39;)"><span class="hl_conref"><span class="mpre">Unbounded</span></span></a><span class="mpre"> -&gt; do
            </span><a name="loc_176_13_176_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_13_176_14&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Concurrent.STM.TQueue.html#loc_71_1_71_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TQueue.html#loc_71_1_71_12&#39;)"><span class="hl_varref"><span class="mpre">S.newTQueueIO</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Control.Concurrent.STM.TQueue.html#loc_78_1_78_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TQueue.html#loc_78_1_78_12&#39;)"><span class="hl_varref"><span class="mpre">S.writeTQueue</span></span></a><span class="mpre"> </span><a href="#loc_176_13_176_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_13_176_14&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">, </span><a href="Control.Concurrent.STM.TQueue.html#loc_84_1_84_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TQueue.html#loc_84_1_84_11&#39;)"><span class="hl_varref"><span class="mpre">S.readTQueue</span></span></a><span class="mpre"> </span><a href="#loc_176_13_176_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_13_176_14&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">)
        </span><a href="#loc_227_7_227_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_7_227_13&#39;)"><span class="hl_conref"><span class="mpre">Single</span></span></a><span class="mpre">    -&gt; do
            </span><a name="loc_179_13_179_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_13_179_14&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Concurrent.STM.TMVar.html#loc_79_1_79_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TMVar.html#loc_79_1_79_16&#39;)"><span class="hl_varref"><span class="mpre">S.newEmptyTMVarIO</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Control.Concurrent.STM.TMVar.html#loc_107_1_107_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TMVar.html#loc_107_1_107_9&#39;)"><span class="hl_varref"><span class="mpre">S.putTMVar</span></span></a><span class="mpre"> </span><a href="#loc_179_13_179_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_13_179_14&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">, </span><a href="Control.Concurrent.STM.TMVar.html#loc_87_1_87_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TMVar.html#loc_87_1_87_10&#39;)"><span class="hl_varref"><span class="mpre">S.takeTMVar</span></span></a><span class="mpre"> </span><a href="#loc_179_13_179_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_13_179_14&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">)
        </span><a href="#loc_232_7_232_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_7_232_13&#39;)"><span class="hl_conref"><span class="mpre">Latest</span></span></a><span class="mpre"> </span><a name="loc_181_16_181_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_16_181_17&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">  -&gt; do
            </span><a name="loc_182_13_182_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_13_182_14&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Sequential.STM.html#loc_75_1_75_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_75_1_75_10&#39;)"><span class="hl_varref"><span class="mpre">S.newTVarIO</span></span></a><span class="mpre"> </span><a href="#loc_181_16_181_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_16_181_17&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Control.Sequential.STM.html#loc_86_1_86_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_86_1_86_10&#39;)"><span class="hl_varref"><span class="mpre">S.writeTVar</span></span></a><span class="mpre"> </span><a href="#loc_182_13_182_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_13_182_14&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">, </span><a href="Control.Sequential.STM.html#loc_80_1_80_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_80_1_80_9&#39;)"><span class="hl_varref"><span class="mpre">S.readTVar</span></span></a><span class="mpre"> </span><a href="#loc_182_13_182_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_13_182_14&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">)
        </span><a href="#loc_238_7_238_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_238_7_238_10&#39;)"><span class="hl_conref"><span class="mpre">New</span></span></a><span class="mpre">       -&gt; do
            </span><a name="loc_185_13_185_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_13_185_14&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Concurrent.STM.TMVar.html#loc_79_1_79_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TMVar.html#loc_79_1_79_16&#39;)"><span class="hl_varref"><span class="mpre">S.newEmptyTMVarIO</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (\</span><a name="loc_186_22_186_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_22_186_23&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; </span><a href="Control.Concurrent.STM.TMVar.html#loc_98_1_98_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TMVar.html#loc_98_1_98_13&#39;)"><span class="hl_varref"><span class="mpre">S.tryTakeTMVar</span></span></a><span class="mpre"> </span><a href="#loc_185_13_185_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_13_185_14&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_121_5_121_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_121_5_121_9&#39;)"><span class="hl_infix"><span class="mpre">*&gt;</span></span></a><span class="mpre"> </span><a href="Control.Concurrent.STM.TMVar.html#loc_107_1_107_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TMVar.html#loc_107_1_107_9&#39;)"><span class="hl_varref"><span class="mpre">S.putTMVar</span></span></a><span class="mpre"> </span><a href="#loc_185_13_185_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_13_185_14&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_186_22_186_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_22_186_23&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">, </span><a href="Control.Concurrent.STM.TMVar.html#loc_87_1_87_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TMVar.html#loc_87_1_87_10&#39;)"><span class="hl_varref"><span class="mpre">S.takeTMVar</span></span></a><span class="mpre"> </span><a href="#loc_185_13_185_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_13_185_14&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">)
        </span><a href="#loc_236_7_236_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_236_7_236_13&#39;)"><span class="hl_conref"><span class="mpre">Newest</span></span></a><span class="mpre"> </span><a name="loc_187_16_187_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_16_187_17&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">  -&gt; do
            </span><a name="loc_188_13_188_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_13_188_14&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Concurrent.STM.TBQueue.html#loc_89_1_89_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TBQueue.html#loc_89_1_89_13&#39;)"><span class="hl_varref"><span class="mpre">S.newTBQueueIO</span></span></a><span class="mpre"> </span><a href="#loc_187_16_187_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_16_187_17&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
            let </span><a name="loc_189_17_189_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_17_189_22&#39;)"><span class="hl_fundecl"><span class="mpre">write</span></span></a><span class="mpre"> </span><a name="loc_189_23_189_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_23_189_24&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="Control.Concurrent.STM.TBQueue.html#loc_98_1_98_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TBQueue.html#loc_98_1_98_13&#39;)"><span class="hl_varref"><span class="mpre">S.writeTBQueue</span></span></a><span class="mpre"> </span><a href="#loc_188_13_188_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_13_188_14&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre"> </span><a href="#loc_189_23_189_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_23_189_24&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_142_5_142_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_142_5_142_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;|&gt;</span></span></a><span class="mpre"> (</span><a href="Control.Concurrent.STM.TBQueue.html#loc_135_1_135_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TBQueue.html#loc_135_1_135_15&#39;)"><span class="hl_varref"><span class="mpre">S.tryReadTBQueue</span></span></a><span class="mpre"> </span><a href="#loc_188_13_188_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_13_188_14&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_121_5_121_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_121_5_121_9&#39;)"><span class="hl_infix"><span class="mpre">*&gt;</span></span></a><span class="mpre"> </span><a href="#loc_189_17_189_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_17_189_22&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_189_23_189_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_23_189_24&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_189_17_189_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_17_189_22&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre">, </span><a href="Control.Concurrent.STM.TBQueue.html#loc_113_1_113_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.STM.TBQueue.html#loc_113_1_113_12&#39;)"><span class="hl_varref"><span class="mpre">S.readTBQueue</span></span></a><span class="mpre"> </span><a href="#loc_188_13_188_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_13_188_14&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">)

    </span><a name="loc_192_5_192_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_5_192_11&#39;)"><span class="hl_vardecl"><span class="mpre">sealed</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Sequential.STM.html#loc_75_1_75_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_75_1_75_10&#39;)"><span class="hl_varref"><span class="mpre">S.newTVarIO</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
    let </span><a name="loc_193_9_193_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_9_193_13&#39;)"><span class="hl_vardecl"><span class="mpre">seal</span></span></a><span class="mpre"> = </span><a href="Control.Sequential.STM.html#loc_86_1_86_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_86_1_86_10&#39;)"><span class="hl_varref"><span class="mpre">S.writeTVar</span></span></a><span class="mpre"> </span><a href="#loc_192_5_192_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_5_192_11&#39;)"><span class="hl_varref"><span class="mpre">sealed</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">

    </span><span class="hl_comment"><span class="mpre">{- Use IORefs to keep track of whether the &#39;Input&#39; or &#39;Output&#39; has been
       garbage collected.  Seal the mailbox when either of them becomes garbage
       collected.
    -}</span></span><span class="mpre">
    </span><a name="loc_199_5_199_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_5_199_10&#39;)"><span class="hl_vardecl"><span class="mpre">rSend</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    </span><a href="Data.IORef.html#loc_52_1_52_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_52_1_52_12&#39;)"><span class="hl_varref"><span class="mpre">mkWeakIORef</span></span></a><span class="mpre"> </span><a href="#loc_199_5_199_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_5_199_10&#39;)"><span class="hl_varref"><span class="mpre">rSend</span></span></a><span class="mpre"> (</span><a href="Control.Sequential.STM.html#loc_44_1_44_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_44_1_44_11&#39;)"><span class="hl_varref"><span class="mpre">S.atomically</span></span></a><span class="mpre"> </span><a href="#loc_193_9_193_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_9_193_13&#39;)"><span class="hl_varref"><span class="mpre">seal</span></span></a><span class="mpre">)
    </span><a name="loc_201_5_201_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_5_201_10&#39;)"><span class="hl_vardecl"><span class="mpre">rRecv</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    </span><a href="Data.IORef.html#loc_52_1_52_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_52_1_52_12&#39;)"><span class="hl_varref"><span class="mpre">mkWeakIORef</span></span></a><span class="mpre"> </span><a href="#loc_201_5_201_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_5_201_10&#39;)"><span class="hl_varref"><span class="mpre">rRecv</span></span></a><span class="mpre"> (</span><a href="Control.Sequential.STM.html#loc_44_1_44_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_44_1_44_11&#39;)"><span class="hl_varref"><span class="mpre">S.atomically</span></span></a><span class="mpre"> </span><a href="#loc_193_9_193_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_9_193_13&#39;)"><span class="hl_varref"><span class="mpre">seal</span></span></a><span class="mpre">)

    let </span><a name="loc_204_9_204_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_9_204_18&#39;)"><span class="hl_fundecl"><span class="mpre">sendOrEnd</span></span></a><span class="mpre"> </span><a name="loc_204_19_204_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_19_204_20&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = do
            </span><a name="loc_205_13_205_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_13_205_14&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Sequential.STM.html#loc_80_1_80_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_80_1_80_9&#39;)"><span class="hl_varref"><span class="mpre">S.readTVar</span></span></a><span class="mpre"> </span><a href="#loc_192_5_192_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_5_192_11&#39;)"><span class="hl_varref"><span class="mpre">sealed</span></span></a><span class="mpre">
            if </span><a href="#loc_205_13_205_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_13_205_14&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
                then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
                else do
                    </span><a href="#loc_171_6_171_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_6_171_11&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_204_19_204_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_19_204_20&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
                    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
        </span><a name="loc_211_9_211_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_9_211_18&#39;)"><span class="hl_vardecl"><span class="mpre">readOrEnd</span></span></a><span class="mpre"> = (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="#loc_171_13_171_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_13_171_17&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre">) </span><a href="Control.Applicative.html#loc_142_5_142_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_142_5_142_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;|&gt;</span></span></a><span class="mpre"> (do
            </span><a name="loc_212_13_212_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_13_212_14&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Sequential.STM.html#loc_80_1_80_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_80_1_80_9&#39;)"><span class="hl_varref"><span class="mpre">S.readTVar</span></span></a><span class="mpre"> </span><a href="#loc_192_5_192_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_5_192_11&#39;)"><span class="hl_varref"><span class="mpre">sealed</span></span></a><span class="mpre">
            </span><a href="Control.Monad.STM.html#loc_82_1_82_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.STM.html#loc_82_1_82_6&#39;)"><span class="hl_varref"><span class="mpre">S.check</span></span></a><span class="mpre"> </span><a href="#loc_212_13_212_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_13_212_14&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> )
        </span><a name="loc_215_9_215_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_9_215_14&#39;)"><span class="hl_fundecl"><span class="mpre">_send</span></span></a><span class="mpre"> </span><a name="loc_215_15_215_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_15_215_16&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = </span><a href="#loc_204_9_204_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_9_204_18&#39;)"><span class="hl_varref"><span class="mpre">sendOrEnd</span></span></a><span class="mpre"> </span><a href="#loc_215_15_215_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_15_215_16&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_125_5_125_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_125_5_125_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;*</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">unsafeIOToSTM</span></span><span class="mpre"> (</span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_199_5_199_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_5_199_10&#39;)"><span class="hl_varref"><span class="mpre">rSend</span></span></a><span class="mpre">)
        </span><a name="loc_216_9_216_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_9_216_14&#39;)"><span class="hl_vardecl"><span class="mpre">_recv</span></span></a><span class="mpre">   = </span><a href="#loc_211_9_211_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_9_211_18&#39;)"><span class="hl_varref"><span class="mpre">readOrEnd</span></span></a><span class="mpre">   </span><a href="Control.Applicative.html#loc_125_5_125_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_125_5_125_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;*</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">unsafeIOToSTM</span></span><span class="mpre"> (</span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_201_5_201_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_5_201_10&#39;)"><span class="hl_varref"><span class="mpre">rRecv</span></span></a><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_96_20_96_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_20_96_26&#39;)"><span class="hl_conref"><span class="mpre">Output</span></span></a><span class="mpre"> </span><a href="#loc_215_9_215_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_9_215_14&#39;)"><span class="hl_varref"><span class="mpre">_send</span></span></a><span class="mpre">, </span><a href="#loc_62_19_62_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_19_62_24&#39;)"><span class="hl_conref"><span class="mpre">Input</span></span></a><span class="mpre"> </span><a href="#loc_216_9_216_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_9_216_14&#39;)"><span class="hl_varref"><span class="mpre">_recv</span></span></a><span class="mpre">, </span><a href="#loc_193_9_193_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_9_193_13&#39;)"><span class="hl_varref"><span class="mpre">seal</span></span></a><span class="mpre">)
</span><span class="hl_comment"><span class="mpre">{-# INLINABLE spawn&#39; #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | &#39;Buffer&#39; specifies how to buffer messages stored within the mailbox</span></span><span class="mpre">
data </span><a name="loc_221_6_221_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_6_221_12&#39;)"><span class="hl_tycondecl"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- | Store an &#39;Unbounded&#39; number of messages in a FIFO queue</span></span><span class="mpre">
    = </span><a name="loc_223_7_223_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_7_223_16&#39;)"><span class="hl_condecl"><span class="mpre">Unbounded</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- | Store a &#39;Bounded&#39; number of messages, specified by the &#39;Int&#39; argument</span></span><span class="mpre">
    | </span><a name="loc_225_7_225_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_7_225_14&#39;)"><span class="hl_condecl"><span class="mpre">Bounded</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- | Store a &#39;Single&#39; message (like @Bounded 1@, but more efficient)</span></span><span class="mpre">
    | </span><a name="loc_227_7_227_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_7_227_13&#39;)"><span class="hl_condecl"><span class="mpre">Single</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">{-| Only store the &#39;Latest&#39; message, beginning with an initial value

        &#39;Latest&#39; is never empty nor full.
    -}</span></span><span class="mpre">
    | </span><a name="loc_232_7_232_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_7_232_13&#39;)"><span class="hl_condecl"><span class="mpre">Latest</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">{-| Like @Bounded@, but &#39;send&#39; never fails (the buffer is never full).
        Instead, old elements are discard to make room for new elements
    -}</span></span><span class="mpre">
    | </span><a name="loc_236_7_236_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_236_7_236_13&#39;)"><span class="hl_condecl"><span class="mpre">Newest</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- | Like @Newest 1@, but more efficient</span></span><span class="mpre">
    | </span><a name="loc_238_7_238_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_238_7_238_10&#39;)"><span class="hl_condecl"><span class="mpre">New</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{- $reexport
    @Control.Concurrent@ re-exports &#39;forkIO&#39;, although I recommend using the
    @async@ library instead.

    @Control.Concurrent.STM@ re-exports &#39;atomically&#39; and &#39;STM&#39;.

    @System.Mem@ re-exports &#39;performGC&#39;.
-}</span></span><span class="mpre">
</span></div></body></html>