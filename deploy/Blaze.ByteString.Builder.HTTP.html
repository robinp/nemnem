<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE BangPatterns, CPP, MagicHash, OverloadedStrings #-}

#ifdef USE_MONO_PAT_BINDS
{-# LANGUAGE MonoPatBinds #-}
#endif

</span><span class="hl_comment"><span class="mpre">-- | Support for HTTP response encoding.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- TODO: Improve documentation.</span></span><span class="mpre">
module Blaze.ByteString.Builder.HTTP (
  </span><span class="hl_comment"><span class="mpre">-- * Chunked HTTP transfer encoding</span></span><span class="mpre">
    chunkedTransferEncoding
  , chunkedTransferTerminator
  ) where

import Data.Monoid
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/Blaze/ByteString/Builder/HTTP.hs&quot;, srcSpanStartLine = 17, srcSpanStartColumn = 18, srcSpanEndLine = 17, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre">       as S
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/Blaze/ByteString/Builder/HTTP.hs&quot;, srcSpanStartLine = 18, srcSpanStartColumn = 8, srcSpanEndLine = 18, srcSpanEndColumn = 29}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> ()

import Foreign

import Blaze.ByteString.Builder.Internal
import Blaze.ByteString.Builder.Internal.Types
import Blaze.ByteString.Builder.Internal.UncheckedShifts
import Blaze.ByteString.Builder.ByteString (</span><a href="Blaze.ByteString.Builder.ByteString.html#loc_127_1_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_127_1_127_15&#39;)"><span class="mpre">copyByteString</span></a><span class="mpre">)

import qualified Blaze.ByteString.Builder.Char8 as Char8

</span><span class="hl_comment"><span class="mpre">-- only required by test-code</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- import qualified Data.ByteString.Lazy as L</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- import qualified Blaze.ByteString.Builder.ByteString  as B</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- import Data.ByteString.Char8 ()</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | Write a CRLF sequence.</span></span><span class="mpre">
</span><a href="#loc_37_1_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_1_37_10&#39;)"><span class="mpre">writeCRLF</span></a><span class="mpre"> :: </span><a href="Blaze.ByteString.Builder.Internal.Write.html#loc_98_6_98_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Write.html#loc_98_6_98_11&#39;)"><span class="hl_tyconref"><span class="mpre">Write</span></span></a><span class="mpre">
</span><a name="loc_37_1_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_1_37_10&#39;)"><span class="hl_vardecl"><span class="mpre">writeCRLF</span></span></a><span class="mpre"> = </span><a href="Blaze.ByteString.Builder.Char8.html#loc_56_1_56_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char8.html#loc_56_1_56_10&#39;)"><span class="hl_varref"><span class="mpre">Char8.writeChar</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\r&#39;</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_infix"><span class="mpre">`mappend`</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Char8.html#loc_56_1_56_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char8.html#loc_56_1_56_10&#39;)"><span class="hl_varref"><span class="mpre">Char8.writeChar</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_37_1_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_1_37_10&#39;)"><span class="mpre">writeCRLF</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Execute a write</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_43_1_43_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_10&#39;)"><span class="mpre">execWrite</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_43_1_43_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_10&#39;)"><span class="mpre">execWrite</span></a><span class="mpre"> :: </span><a href="Blaze.ByteString.Builder.Internal.Write.html#loc_98_6_98_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Write.html#loc_98_6_98_11&#39;)"><span class="hl_tyconref"><span class="mpre">Write</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_43_1_43_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_10&#39;)"><span class="hl_fundecl"><span class="mpre">execWrite</span></span></a><span class="mpre"> </span><a name="loc_43_11_43_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_11_43_12&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> </span><a name="loc_43_13_43_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_13_43_15&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> = do
    _ &lt;- </span><a href="Blaze.ByteString.Builder.Internal.Write.html#loc_82_12_82_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Write.html#loc_82_12_82_19&#39;)"><span class="hl_varref"><span class="mpre">runPoke</span></span></a><span class="mpre"> (</span><a href="Blaze.ByteString.Builder.Internal.Write.html#loc_103_1_103_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Write.html#loc_103_1_103_8&#39;)"><span class="hl_varref"><span class="mpre">getPoke</span></span></a><span class="mpre"> </span><a href="#loc_43_11_43_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_11_43_12&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">) </span><a href="#loc_43_13_43_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_13_43_15&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Hex Encoding Infrastructure</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-
pokeWord16Hex :: Word16 -&gt; Ptr Word8 -&gt; IO ()
pokeWord16Hex x op = do
    pokeNibble 0 12
    pokeNibble 1  8
    pokeNibble 2  4
    pokeNibble 3  0
  where
    pokeNibble off s
        | n &lt;  10   = pokeWord8 off (fromIntegral $ 48 + n)
        | otherwise = pokeWord8 off (fromIntegral $ 55 + n)
        where
          n = shiftr_w16 x s .&amp;. 0xF

    pokeWord8 :: Int -&gt; Word8 -&gt; IO ()
    pokeWord8 off = poke (op `plusPtr` off)

writeWord16Hex :: Word16 -&gt; Write
writeWord16Hex = exactWrite 4 . pokeWord16Hex

-}</span></span><span class="mpre">

</span><a href="#loc_75_1_75_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_15&#39;)"><span class="mpre">pokeWord32HexN</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Word32</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_75_1_75_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_15&#39;)"><span class="hl_fundecl"><span class="mpre">pokeWord32HexN</span></span></a><span class="mpre"> </span><a name="loc_75_16_75_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_16_75_18&#39;)"><span class="hl_vardecl"><span class="mpre">n0</span></span></a><span class="mpre"> </span><a name="loc_75_19_75_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_19_75_21&#39;)"><span class="hl_vardecl"><span class="mpre">w0</span></span></a><span class="mpre"> </span><a name="loc_75_22_75_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_22_75_25&#39;)"><span class="hl_vardecl"><span class="mpre">op0</span></span></a><span class="mpre"> =
    </span><a href="#loc_78_5_78_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_5_78_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_75_19_75_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_19_75_21&#39;)"><span class="hl_varref"><span class="mpre">w0</span></span></a><span class="mpre"> (</span><a href="#loc_75_22_75_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_22_75_25&#39;)"><span class="hl_varref"><span class="mpre">op0</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (</span><a href="#loc_75_16_75_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_16_75_18&#39;)"><span class="hl_varref"><span class="mpre">n0</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">))
  where
    </span><a name="loc_78_5_78_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_5_78_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> !</span><a name="loc_78_9_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_9_78_10&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> !</span><a name="loc_78_12_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_12_78_14&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre">
      | </span><a href="#loc_78_12_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_12_78_14&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_75_22_75_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_22_75_25&#39;)"><span class="hl_varref"><span class="mpre">op0</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
      | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do
          let </span><a href="#loc_82_15_82_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_15_82_21&#39;)"><span class="mpre">nibble</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">
              </span><a name="loc_82_15_82_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_15_82_21&#39;)"><span class="hl_vardecl"><span class="mpre">nibble</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_78_9_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_9_78_10&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xF</span></span><span class="mpre">
              </span><a name="loc_83_15_83_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_15_83_18&#39;)"><span class="hl_vardecl"><span class="mpre">hex</span></span></a><span class="mpre"> | </span><a href="#loc_82_15_82_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_15_82_21&#39;)"><span class="hl_varref"><span class="mpre">nibble</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">10</span></span><span class="mpre"> = </span><span class="hl_num"><span class="mpre">48</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_82_15_82_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_15_82_21&#39;)"><span class="hl_varref"><span class="mpre">nibble</span></span></a><span class="mpre">
                  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">   = </span><span class="hl_num"><span class="mpre">55</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_82_15_82_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_15_82_21&#39;)"><span class="hl_varref"><span class="mpre">nibble</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_78_12_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_12_78_14&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><a href="#loc_83_15_83_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_15_83_18&#39;)"><span class="hl_varref"><span class="mpre">hex</span></span></a><span class="mpre">
          </span><a href="#loc_78_5_78_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_5_78_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><a href="#loc_78_9_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_9_78_10&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.UncheckedShifts.html#loc_58_1_58_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.UncheckedShifts.html#loc_58_1_58_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftr_w32`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">4</span></span><span class="mpre">) (</span><a href="#loc_78_12_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_12_78_14&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (-</span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">))
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_75_1_75_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_15&#39;)"><span class="mpre">pokeWord32HexN</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_90_1_90_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_20&#39;)"><span class="mpre">iterationsUntilZero</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/Blaze/ByteString/Builder/HTTP.hs&quot;, srcSpanStartLine = 89, srcSpanStartColumn = 24, srcSpanEndLine = 89, srcSpanEndColumn = 37}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/Blaze/ByteString/Builder/HTTP.hs&quot;, srcSpanStartLine = 89, srcSpanStartColumn = 35, srcSpanEndLine = 89, srcSpanEndColumn = 37}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/h"><span class="mpre">Integral a =&gt;</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_90_1_90_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_20&#39;)"><span class="hl_fundecl"><span class="mpre">iterationsUntilZero</span></span></a><span class="mpre"> </span><a name="loc_90_21_90_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_21_90_22&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_92_5_92_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
  where
    </span><a name="loc_92_5_92_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> !</span><a name="loc_92_9_92_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_9_92_14&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">  = </span><a href="#loc_92_9_92_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_9_92_14&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
    </span><a href="#loc_92_5_92_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> !</span><a name="loc_93_9_93_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_9_93_14&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> !</span><a name="loc_93_16_93_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_16_93_17&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="#loc_92_5_92_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><a href="#loc_93_9_93_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_9_93_14&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><a href="#loc_90_21_90_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_21_90_22&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_93_16_93_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_16_93_17&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_90_1_90_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_20&#39;)"><span class="mpre">iterationsUntilZero</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Length of the hex-string required to encode the given &#39;Word32&#39;.</span></span><span class="mpre">
</span><a href="#loc_98_1_98_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_16&#39;)"><span class="mpre">word32HexLength</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word32</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_98_1_98_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_16&#39;)"><span class="hl_vardecl"><span class="mpre">word32HexLength</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">max</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_90_1_90_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_20&#39;)"><span class="hl_varref"><span class="mpre">iterationsUntilZero</span></span></a><span class="mpre"> (</span><a href="Blaze.ByteString.Builder.Internal.UncheckedShifts.html#loc_58_1_58_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.UncheckedShifts.html#loc_58_1_58_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftr_w32`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">4</span></span><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_98_1_98_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_16&#39;)"><span class="mpre">word32HexLength</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_102_1_102_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_1_102_15&#39;)"><span class="mpre">writeWord32Hex</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word32</span></span><span class="mpre"> -&gt; </span><a href="Blaze.ByteString.Builder.Internal.Write.html#loc_98_6_98_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Write.html#loc_98_6_98_11&#39;)"><span class="hl_tyconref"><span class="mpre">Write</span></span></a><span class="mpre">
</span><a name="loc_102_1_102_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_1_102_15&#39;)"><span class="hl_fundecl"><span class="mpre">writeWord32Hex</span></span></a><span class="mpre"> </span><a name="loc_102_16_102_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_16_102_17&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> =
    </span><a href="Blaze.ByteString.Builder.Internal.Write.html#loc_169_1_169_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Write.html#loc_169_1_169_13&#39;)"><span class="hl_varref"><span class="mpre">boundedWrite</span></span></a><span class="mpre"> (</span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> </span><a href="#loc_102_16_102_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_16_102_17&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">) (</span><a href="Blaze.ByteString.Builder.Internal.Write.html#loc_153_1_153_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Write.html#loc_153_1_153_6&#39;)"><span class="hl_varref"><span class="mpre">pokeN</span></span></a><span class="mpre"> </span><a href="#loc_105_5_105_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_5_105_8&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_75_1_75_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_15&#39;)"><span class="hl_varref"><span class="mpre">pokeWord32HexN</span></span></a><span class="mpre"> </span><a href="#loc_105_5_105_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_5_105_8&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><a href="#loc_102_16_102_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_16_102_17&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">)
  where
    </span><a name="loc_105_5_105_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_5_105_8&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = </span><a href="#loc_98_1_98_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_16&#39;)"><span class="hl_varref"><span class="mpre">word32HexLength</span></span></a><span class="mpre"> </span><a href="#loc_102_16_102_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_16_102_17&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_102_1_102_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_1_102_15&#39;)"><span class="mpre">writeWord32Hex</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-
test = flip (toLazyByteStringWith 32 32 32) L.empty
    $ chunkedTransferEncoding
    $ mconcat $ map oneLine [0..16] ++
                [B.insertByteString &quot;hello&quot;] ++
                map oneLine [0,1] ++
                [B.insertByteString &quot;&quot;] ++
                map oneLine [0..16]

  where
    oneLine x = fromWriteSingleton writeWord32Hex x `mappend` Char8.fromChar &#39; &#39;

test = print $ toLazyByteString
    $ chunkedTransferEncoding  body `mappend` chunkedTransferTerminator

body = copyByteString &quot;maa&quot; `mappend` copyByteString &quot;foo&quot; `mappend` copyByteString &quot;bar&quot;
-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Chunked transfer encoding</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Transform a builder such that it uses chunked HTTP transfer encoding.</span></span><span class="mpre">
</span><a href="#loc_132_1_132_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_24&#39;)"><span class="mpre">chunkedTransferEncoding</span></a><span class="mpre"> :: </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre"> -&gt; </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_132_1_132_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_24&#39;)"><span class="hl_fundecl"><span class="mpre">chunkedTransferEncoding</span></span></a><span class="mpre"> (</span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_19_69_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_19_69_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><a name="loc_132_34_132_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_34_132_35&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">) =
    </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_124_1_124_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_124_1_124_18&#39;)"><span class="hl_varref"><span class="mpre">fromBuildStepCont</span></span></a><span class="mpre"> </span><a href="#loc_137_5_137_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_5_137_25&#39;)"><span class="hl_varref"><span class="mpre">transferEncodingStep</span></span></a><span class="mpre">
  where
    </span><a name="loc_135_5_135_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_5_135_14&#39;)"><span class="hl_fundecl"><span class="mpre">finalStep</span></span></a><span class="mpre"> !(</span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_35_17_35_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_35_17_35_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_135_26_135_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_26_135_28&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> _) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_38_5_38_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_38_5_38_9&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> </span><a href="#loc_135_26_135_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_26_135_28&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

    </span><a name="loc_137_5_137_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_5_137_25&#39;)"><span class="hl_fundecl"><span class="mpre">transferEncodingStep</span></span></a><span class="mpre"> </span><a name="loc_137_26_137_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_26_137_27&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = </span><a href="#loc_139_9_139_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_9_139_11&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><a href="#loc_132_34_132_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_34_132_35&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> (</span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_63_1_63_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_63_1_63_10&#39;)"><span class="hl_varref"><span class="mpre">buildStep</span></span></a><span class="mpre"> </span><a href="#loc_135_5_135_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_5_135_14&#39;)"><span class="hl_varref"><span class="mpre">finalStep</span></span></a><span class="mpre">))
      where
        </span><a name="loc_139_9_139_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_9_139_11&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_139_12_139_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_12_139_21&#39;)"><span class="hl_vardecl"><span class="mpre">innerStep</span></span></a><span class="mpre"> !(</span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_35_17_35_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_35_17_35_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_139_33_139_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_33_139_35&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> </span><a name="loc_139_36_139_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_36_139_39&#39;)"><span class="hl_vardecl"><span class="mpre">ope</span></span></a><span class="mpre">)
          </span><span class="hl_comment"><span class="mpre">-- FIXME: Assert that outRemaining &lt; maxBound :: Word32</span></span><span class="mpre">
          | </span><a href="#loc_216_13_216_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_13_216_25&#39;)"><span class="hl_varref"><span class="mpre">outRemaining</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_212_13_212_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_13_212_30&#39;)"><span class="hl_varref"><span class="mpre">minimalBufferSize</span></span></a><span class="mpre"> =
              </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_57_1_57_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_57_1_57_11&#39;)"><span class="hl_varref"><span class="mpre">bufferFull</span></span></a><span class="mpre"> </span><a href="#loc_212_13_212_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_13_212_30&#39;)"><span class="hl_varref"><span class="mpre">minimalBufferSize</span></span></a><span class="mpre"> </span><a href="#loc_139_33_139_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_33_139_35&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> (</span><a href="#loc_139_9_139_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_9_139_11&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_139_12_139_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_12_139_21&#39;)"><span class="hl_varref"><span class="mpre">innerStep</span></span></a><span class="mpre">)
          | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do
              let !</span><a name="loc_144_20_144_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_20_144_27&#39;)"><span class="hl_specname"><span class="mpre">brInner</span></span></a><span class="mpre">@(</span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_35_17_35_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_35_17_35_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_144_38_144_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_38_144_45&#39;)"><span class="hl_vardecl"><span class="mpre">opInner</span></span></a><span class="mpre"> _) = </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_35_17_35_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_35_17_35_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre">
                     (</span><a href="#loc_139_33_139_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_33_139_35&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre">  </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (</span><a href="#loc_217_13_217_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_13_217_28&#39;)"><span class="hl_varref"><span class="mpre">chunkSizeLength</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">))     </span><span class="hl_comment"><span class="mpre">-- leave space for chunk header</span></span><span class="mpre">
                     (</span><a href="#loc_139_36_139_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_36_139_39&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (-</span><a href="#loc_207_13_207_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_13_207_35&#39;)"><span class="hl_varref"><span class="mpre">maxAfterBufferOverhead</span></span></a><span class="mpre">)) </span><span class="hl_comment"><span class="mpre">-- leave space at end of data</span></span><span class="mpre">

                  </span><span class="hl_comment"><span class="mpre">-- wraps the chunk, if it is non-empty, and returns the</span></span><span class="mpre">
                  </span><span class="hl_comment"><span class="mpre">-- signal constructed with the correct end-of-data pointer</span></span><span class="mpre">
                  </span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_153_19_153_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_19_153_28&#39;)"><span class="mpre">wrapChunk</span></a><span class="mpre"> #-}</span></span><span class="mpre">
                  </span><a href="#loc_153_19_153_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_19_153_28&#39;)"><span class="mpre">wrapChunk</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_37_6_37_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_37_6_37_17&#39;)"><span class="hl_tyconref"><span class="mpre">BuildSignal</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">))
                            -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_37_6_37_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_37_6_37_17&#39;)"><span class="hl_tyconref"><span class="mpre">BuildSignal</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
                  </span><a name="loc_153_19_153_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_19_153_28&#39;)"><span class="hl_fundecl"><span class="mpre">wrapChunk</span></span></a><span class="mpre"> !</span><a name="loc_153_30_153_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_30_153_38&#39;)"><span class="hl_vardecl"><span class="mpre">opInner&#39;</span></span></a><span class="mpre"> </span><a name="loc_153_39_153_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_39_153_47&#39;)"><span class="hl_vardecl"><span class="mpre">mkSignal</span></span></a><span class="mpre">
                    | </span><a href="#loc_153_30_153_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_30_153_38&#39;)"><span class="hl_varref"><span class="mpre">opInner&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_144_38_144_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_38_144_45&#39;)"><span class="hl_varref"><span class="mpre">opInner</span></span></a><span class="mpre"> = </span><a href="#loc_153_39_153_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_39_153_47&#39;)"><span class="hl_varref"><span class="mpre">mkSignal</span></span></a><span class="mpre"> </span><a href="#loc_139_33_139_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_33_139_35&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre">
                    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">           = do
                        </span><a href="#loc_75_1_75_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_15&#39;)"><span class="hl_varref"><span class="mpre">pokeWord32HexN</span></span></a><span class="mpre"> </span><a href="#loc_217_13_217_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_13_217_28&#39;)"><span class="hl_varref"><span class="mpre">chunkSizeLength</span></span></a><span class="mpre">
                            (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_153_30_153_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_30_153_38&#39;)"><span class="hl_varref"><span class="mpre">opInner&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`minusPtr`</span></span><span class="mpre"> </span><a href="#loc_144_38_144_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_38_144_45&#39;)"><span class="hl_varref"><span class="mpre">opInner</span></span></a><span class="mpre">)
                            </span><a href="#loc_139_33_139_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_33_139_35&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre">
                        </span><a href="#loc_43_1_43_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_10&#39;)"><span class="hl_varref"><span class="mpre">execWrite</span></span></a><span class="mpre"> </span><a href="#loc_37_1_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_1_37_10&#39;)"><span class="hl_varref"><span class="mpre">writeCRLF</span></span></a><span class="mpre"> (</span><a href="#loc_144_38_144_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_38_144_45&#39;)"><span class="hl_varref"><span class="mpre">opInner</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (-</span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">))
                        </span><a href="#loc_43_1_43_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_10&#39;)"><span class="hl_varref"><span class="mpre">execWrite</span></span></a><span class="mpre"> </span><a href="#loc_37_1_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_1_37_10&#39;)"><span class="hl_varref"><span class="mpre">writeCRLF</span></span></a><span class="mpre"> </span><a href="#loc_153_30_153_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_30_153_38&#39;)"><span class="hl_varref"><span class="mpre">opInner&#39;</span></span></a><span class="mpre">
                        </span><a href="#loc_153_39_153_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_39_153_47&#39;)"><span class="hl_varref"><span class="mpre">mkSignal</span></span></a><span class="mpre"> (</span><a href="#loc_153_30_153_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_30_153_38&#39;)"><span class="hl_varref"><span class="mpre">opInner&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">)

              </span><span class="hl_comment"><span class="mpre">-- execute inner builder with reduced boundaries</span></span><span class="mpre">
              </span><a name="loc_164_15_164_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_15_164_21&#39;)"><span class="hl_vardecl"><span class="mpre">signal</span></span></a><span class="mpre"> &lt;- </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_49_17_49_29" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_49_17_49_29&#39;)"><span class="hl_varref"><span class="mpre">runBuildStep</span></span></a><span class="mpre"> </span><a href="#loc_139_12_139_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_12_139_21&#39;)"><span class="hl_varref"><span class="mpre">innerStep</span></span></a><span class="mpre"> </span><a href="#loc_144_20_144_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_20_144_27&#39;)"><span class="hl_varref"><span class="mpre">brInner</span></span></a><span class="mpre">
              case </span><a href="#loc_164_15_164_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_15_164_21&#39;)"><span class="hl_varref"><span class="mpre">signal</span></span></a><span class="mpre"> of
                </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_38_5_38_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_38_5_38_9&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> </span><a name="loc_166_22_166_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_22_166_30&#39;)"><span class="hl_vardecl"><span class="mpre">opInner&#39;</span></span></a><span class="mpre"> _ -&gt;
                    </span><a href="#loc_153_19_153_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_19_153_28&#39;)"><span class="hl_varref"><span class="mpre">wrapChunk</span></span></a><span class="mpre"> </span><a href="#loc_166_22_166_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_22_166_30&#39;)"><span class="hl_varref"><span class="mpre">opInner&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_167_43_167_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_43_167_46&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;</span></span></a><span class="mpre"> -&gt; do
                      let !</span><a name="loc_168_28_168_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_28_168_31&#39;)"><span class="hl_vardecl"><span class="mpre">br&#39;</span></span></a><span class="mpre"> = </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_35_17_35_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_35_17_35_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a href="#loc_167_43_167_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_43_167_46&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a href="#loc_139_36_139_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_36_139_39&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">
                      </span><a href="#loc_137_26_137_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_26_137_27&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_168_28_168_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_28_168_31&#39;)"><span class="hl_varref"><span class="mpre">br&#39;</span></span></a><span class="mpre">

                </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_39_5_39_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_39_5_39_15&#39;)"><span class="hl_conref"><span class="mpre">BufferFull</span></span></a><span class="mpre"> </span><a name="loc_171_28_171_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_28_171_43&#39;)"><span class="hl_vardecl"><span class="mpre">minRequiredSize</span></span></a><span class="mpre"> </span><a name="loc_171_44_171_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_44_171_52&#39;)"><span class="hl_vardecl"><span class="mpre">opInner&#39;</span></span></a><span class="mpre"> </span><a name="loc_171_53_171_66" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_53_171_66&#39;)"><span class="hl_vardecl"><span class="mpre">nextInnerStep</span></span></a><span class="mpre"> -&gt;
                    </span><a href="#loc_153_19_153_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_19_153_28&#39;)"><span class="hl_varref"><span class="mpre">wrapChunk</span></span></a><span class="mpre"> </span><a href="#loc_171_44_171_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_44_171_52&#39;)"><span class="hl_varref"><span class="mpre">opInner&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_172_43_172_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_43_172_46&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;</span></span></a><span class="mpre"> -&gt;
                      </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_57_1_57_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_57_1_57_11&#39;)"><span class="hl_varref"><span class="mpre">bufferFull</span></span></a><span class="mpre">
                        (</span><a href="#loc_171_28_171_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_28_171_43&#39;)"><span class="hl_varref"><span class="mpre">minRequiredSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_210_13_210_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_13_210_32&#39;)"><span class="hl_varref"><span class="mpre">maxEncodingOverhead</span></span></a><span class="mpre">)
                        </span><a href="#loc_172_43_172_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_43_172_46&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre">
                        (</span><a href="#loc_139_9_139_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_9_139_11&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_171_53_171_66" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_53_171_66&#39;)"><span class="hl_varref"><span class="mpre">nextInnerStep</span></span></a><span class="mpre">)

                </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_43_5_43_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_43_5_43_21&#39;)"><span class="hl_conref"><span class="mpre">InsertByteString</span></span></a><span class="mpre"> </span><a name="loc_178_34_178_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_34_178_42&#39;)"><span class="hl_vardecl"><span class="mpre">opInner&#39;</span></span></a><span class="mpre"> </span><a name="loc_178_43_178_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_43_178_45&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a name="loc_178_46_178_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_46_178_59&#39;)"><span class="hl_vardecl"><span class="mpre">nextInnerStep</span></span></a><span class="mpre">
                  | </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_178_43_178_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_43_178_45&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> -&gt;                        </span><span class="hl_comment"><span class="mpre">-- flush</span></span><span class="mpre">
                      </span><a href="#loc_153_19_153_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_19_153_28&#39;)"><span class="hl_varref"><span class="mpre">wrapChunk</span></span></a><span class="mpre"> </span><a href="#loc_178_34_178_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_34_178_42&#39;)"><span class="hl_varref"><span class="mpre">opInner&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_180_45_180_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_45_180_48&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;</span></span></a><span class="mpre"> -&gt;
                        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_60_1_60_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_60_1_60_17&#39;)"><span class="hl_varref"><span class="mpre">insertByteString</span></span></a><span class="mpre">
                          </span><a href="#loc_180_45_180_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_45_180_48&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.empty</span></span><span class="mpre">
                          (</span><a href="#loc_139_9_139_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_9_139_11&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_178_46_178_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_46_178_59&#39;)"><span class="hl_varref"><span class="mpre">nextInnerStep</span></span></a><span class="mpre">)

                  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> -&gt;                        </span><span class="hl_comment"><span class="mpre">-- insert non-empty bytestring</span></span><span class="mpre">
                      </span><a href="#loc_153_19_153_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_19_153_28&#39;)"><span class="hl_varref"><span class="mpre">wrapChunk</span></span></a><span class="mpre"> </span><a href="#loc_178_34_178_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_34_178_42&#39;)"><span class="hl_varref"><span class="mpre">opInner&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_186_45_186_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_45_186_48&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;</span></span></a><span class="mpre"> -&gt; do
                        </span><span class="hl_comment"><span class="mpre">-- add header for inserted bytestring</span></span><span class="mpre">
                        </span><span class="hl_comment"><span class="mpre">-- FIXME: assert(S.length bs &lt; maxBound :: Word32)</span></span><span class="mpre">
                        !</span><a name="loc_189_26_189_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_26_189_30&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;&#39;</span></span></a><span class="mpre"> &lt;- (</span><a href="Blaze.ByteString.Builder.Internal.Write.html#loc_82_12_82_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Write.html#loc_82_12_82_19&#39;)"><span class="hl_infix"><span class="mpre">`runPoke`</span></span></a><span class="mpre"> </span><a href="#loc_186_45_186_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_45_186_48&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Write.html#loc_103_1_103_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Write.html#loc_103_1_103_8&#39;)"><span class="hl_varref"><span class="mpre">getPoke</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
                            </span><a href="#loc_102_1_102_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_1_102_15&#39;)"><span class="hl_varref"><span class="mpre">writeWord32Hex</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_178_43_178_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_43_178_45&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">)
                            </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_infix"><span class="mpre">`mappend`</span></span></a><span class="mpre"> </span><a href="#loc_37_1_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_1_37_10&#39;)"><span class="hl_varref"><span class="mpre">writeCRLF</span></span></a><span class="mpre">
                        </span><span class="hl_comment"><span class="mpre">-- insert bytestring and write CRLF in next buildstep</span></span><span class="mpre">
                        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_43_5_43_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_43_5_43_21&#39;)"><span class="hl_conref"><span class="mpre">InsertByteString</span></span></a><span class="mpre">
                          </span><a href="#loc_189_26_189_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_26_189_30&#39;)"><span class="hl_varref"><span class="mpre">op&#39;&#39;</span></span></a><span class="mpre"> </span><a href="#loc_178_43_178_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_43_178_45&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
                          (</span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_70_5_70_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_70_5_70_14&#39;)"><span class="hl_varref"><span class="mpre">unBuilder</span></span></a><span class="mpre"> (</span><a href="Blaze.ByteString.Builder.Internal.Write.html#loc_221_1_221_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Write.html#loc_221_1_221_10&#39;)"><span class="hl_varref"><span class="mpre">fromWrite</span></span></a><span class="mpre"> </span><a href="#loc_37_1_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_1_37_10&#39;)"><span class="hl_varref"><span class="mpre">writeCRLF</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
                            </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_63_1_63_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_63_1_63_10&#39;)"><span class="hl_varref"><span class="mpre">buildStep</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_139_9_139_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_9_139_11&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_178_46_178_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_46_178_59&#39;)"><span class="hl_varref"><span class="mpre">nextInnerStep</span></span></a><span class="mpre">)

          where
            </span><span class="hl_comment"><span class="mpre">-- minimal size guaranteed for actual data no need to require more</span></span><span class="mpre">
            </span><span class="hl_comment"><span class="mpre">-- than 1 byte to guarantee progress the larger sizes will be</span></span><span class="mpre">
            </span><span class="hl_comment"><span class="mpre">-- hopefully provided by the driver or requested by the wrapped</span></span><span class="mpre">
            </span><span class="hl_comment"><span class="mpre">-- builders.</span></span><span class="mpre">
            </span><a name="loc_203_13_203_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_13_203_29&#39;)"><span class="hl_vardecl"><span class="mpre">minimalChunkSize</span></span></a><span class="mpre">  = </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">

            </span><span class="hl_comment"><span class="mpre">-- overhead computation</span></span><span class="mpre">
            </span><a name="loc_206_13_206_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_13_206_36&#39;)"><span class="hl_vardecl"><span class="mpre">maxBeforeBufferOverhead</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- max chunk size and CRLF after header</span></span><span class="mpre">
            </span><a name="loc_207_13_207_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_13_207_35&#39;)"><span class="hl_vardecl"><span class="mpre">maxAfterBufferOverhead</span></span></a><span class="mpre">  = </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre">                           </span><span class="hl_comment"><span class="mpre">-- CRLF after data</span></span><span class="mpre">
                                      </span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- max bytestring size, CRLF after header</span></span><span class="mpre">

            </span><a name="loc_210_13_210_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_13_210_32&#39;)"><span class="hl_vardecl"><span class="mpre">maxEncodingOverhead</span></span></a><span class="mpre"> = </span><a href="#loc_206_13_206_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_13_206_36&#39;)"><span class="hl_varref"><span class="mpre">maxBeforeBufferOverhead</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_207_13_207_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_13_207_35&#39;)"><span class="hl_varref"><span class="mpre">maxAfterBufferOverhead</span></span></a><span class="mpre">

            </span><a name="loc_212_13_212_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_13_212_30&#39;)"><span class="hl_vardecl"><span class="mpre">minimalBufferSize</span></span></a><span class="mpre"> = </span><a href="#loc_203_13_203_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_13_203_29&#39;)"><span class="hl_varref"><span class="mpre">minimalChunkSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_210_13_210_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_13_210_32&#39;)"><span class="hl_varref"><span class="mpre">maxEncodingOverhead</span></span></a><span class="mpre">

            </span><span class="hl_comment"><span class="mpre">-- remaining and required space computation</span></span><span class="mpre">
            </span><a href="#loc_216_13_216_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_13_216_25&#39;)"><span class="mpre">outRemaining</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
            </span><a name="loc_216_13_216_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_13_216_25&#39;)"><span class="hl_vardecl"><span class="mpre">outRemaining</span></span></a><span class="mpre">    = </span><a href="#loc_139_36_139_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_36_139_39&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`minusPtr`</span></span><span class="mpre"> </span><a href="#loc_139_33_139_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_33_139_35&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre">
            </span><a name="loc_217_13_217_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_13_217_28&#39;)"><span class="hl_vardecl"><span class="mpre">chunkSizeLength</span></span></a><span class="mpre"> = </span><a href="#loc_98_1_98_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_16&#39;)"><span class="hl_varref"><span class="mpre">word32HexLength</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_216_13_216_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_13_216_25&#39;)"><span class="hl_varref"><span class="mpre">outRemaining</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | The zero-length chunk &#39;0\r\n\r\n&#39; signaling the termination of the data transfer.</span></span><span class="mpre">
</span><a href="#loc_222_1_222_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_1_222_26&#39;)"><span class="mpre">chunkedTransferTerminator</span></a><span class="mpre"> :: </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_222_1_222_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_1_222_26&#39;)"><span class="hl_vardecl"><span class="mpre">chunkedTransferTerminator</span></span></a><span class="mpre"> = </span><a href="Blaze.ByteString.Builder.ByteString.html#loc_127_1_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_127_1_127_15&#39;)"><span class="hl_varref"><span class="mpre">copyByteString</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;0\r\n\r\n&quot;</span></span><span class="mpre">


</span></div></body></html>