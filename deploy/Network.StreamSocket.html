<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# OPTIONS_GHC -fno-warn-orphans #-}
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Network.StreamSocket</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  See LICENSE file</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  Ganesh Sittampalam &lt;ganesh@earth.li&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (not tested)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Socket Stream instance. Originally part of Gray&#39;s\/Bringert&#39;s HTTP module.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Changes by Robin Bate Boerop &lt;robin@bateboerop.name&gt;:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      - Made dependencies explicit in import statements.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      - Removed false dependencies in import statements.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      - Created separate module for instance Stream Socket.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Changes by Simon Foster:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      - Split module up into to sepearate Network.[Stream,TCP,HTTP] modules</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
module Network.StreamSocket
   ( handleSocketError
   , myrecv
   ) where

import Network.Stream
   ( </span><a href="Network.Stream.html#loc_84_7_84_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_84_7_84_13&#39;)"><span class="mpre">Stream</span></a><span class="mpre">(..), </span><a href="Network.Stream.html#loc_37_6_37_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_37_6_37_15&#39;)"><span class="mpre">ConnError</span></a><span class="mpre">(</span><a href="Network.Stream.html#loc_38_4_38_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_38_4_38_14&#39;)"><span class="mpre">ErrorReset</span></a><span class="mpre">, </span><a href="Network.Stream.html#loc_41_4_41_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_41_4_41_13&#39;)"><span class="mpre">ErrorMisc</span></a><span class="mpre">), Result
   )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/StreamSocket.hs&quot;, srcSpanStartLine = 31, srcSpanStartColumn = 8, srcSpanEndLine = 31, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre">
   ( Socket, getSocketOption, shutdown, send, recv, sClose
   , ShutdownCmd(ShutdownBoth), SocketOption(SoError)
   )

import Network.HTTP.Base ( </span><a href="Network.HTTP.Base.html#loc_988_1_988_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_988_1_988_8&#39;)"><span class="mpre">catchIO</span></a><span class="mpre"> )
import Control.Monad (</span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="mpre">liftM</span></a><span class="mpre">)
import Control.Exception as Exception (</span><a href="GHC.IO.Exception.html#loc_238_6_238_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_238_6_238_17&#39;)"><span class="mpre">IOException</span></a><span class="mpre">)
import System.IO.Error (</span><a href="System.IO.Error.html#loc_152_1_152_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Error.html#loc_152_1_152_11&#39;)"><span class="mpre">isEOFError</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Exception handler for socket operations.</span></span><span class="mpre">
</span><a href="#loc_43_1_43_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_18&#39;)"><span class="mpre">handleSocketError</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Exception.html#loc_238_6_238_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_238_6_238_17&#39;)"><span class="hl_tyconref"><span class="mpre">IOException</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_43_1_43_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_18&#39;)"><span class="hl_fundecl"><span class="mpre">handleSocketError</span></span></a><span class="mpre"> </span><a name="loc_43_19_43_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_19_43_21&#39;)"><span class="hl_vardecl"><span class="mpre">sk</span></span></a><span class="mpre"> </span><a name="loc_43_22_43_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_22_43_23&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> =
    do </span><a name="loc_44_8_44_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_8_44_10&#39;)"><span class="hl_vardecl"><span class="mpre">se</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getSocketOption</span></span><span class="mpre"> </span><a href="#loc_43_19_43_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_19_43_21&#39;)"><span class="hl_varref"><span class="mpre">sk</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">SoError</span></span><span class="mpre">
       case </span><a href="#loc_44_8_44_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_8_44_10&#39;)"><span class="hl_varref"><span class="mpre">se</span></span></a><span class="mpre"> of
          </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">     -&gt; </span><span class="hl_varref"><span class="mpre">ioError</span></span><span class="mpre"> </span><a href="#loc_43_22_43_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_22_43_23&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
          </span><span class="hl_num"><span class="mpre">10054</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="Network.Stream.html#loc_38_4_38_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_38_4_38_14&#39;)"><span class="hl_conref"><span class="mpre">ErrorReset</span></span></a><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- reset</span></span><span class="mpre">
          _     -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Stream.html#loc_41_4_41_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_41_4_41_13&#39;)"><span class="hl_conref"><span class="mpre">ErrorMisc</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_44_8_44_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_8_44_10&#39;)"><span class="hl_varref"><span class="mpre">se</span></span></a><span class="mpre">

</span><a href="#loc_51_1_51_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_7&#39;)"><span class="mpre">myrecv</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_51_1_51_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_7&#39;)"><span class="hl_fundecl"><span class="mpre">myrecv</span></span></a><span class="mpre"> </span><a name="loc_51_8_51_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_8_51_12&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a name="loc_51_13_51_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_13_51_16&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> =
    let </span><a name="loc_52_9_52_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_9_52_16&#39;)"><span class="hl_fundecl"><span class="mpre">handler</span></span></a><span class="mpre"> </span><a name="loc_52_17_52_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_18&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> = if </span><a href="System.IO.Error.html#loc_152_1_152_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Error.html#loc_152_1_152_11&#39;)"><span class="hl_varref"><span class="mpre">isEOFError</span></span></a><span class="mpre"> </span><a href="#loc_52_17_52_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_18&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> [] else </span><span class="hl_varref"><span class="mpre">ioError</span></span><span class="mpre"> </span><a href="#loc_52_17_52_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_18&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
        in </span><a href="Network.HTTP.Base.html#loc_988_1_988_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_988_1_988_8&#39;)"><span class="hl_varref"><span class="mpre">catchIO</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">recv</span></span><span class="mpre"> </span><a href="#loc_51_8_51_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_8_51_12&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a href="#loc_51_13_51_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_13_51_16&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">) </span><a href="#loc_52_9_52_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_9_52_16&#39;)"><span class="hl_varref"><span class="mpre">handler</span></span></a><span class="mpre">

instance </span><a href="Network.Stream.html#loc_84_7_84_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_84_7_84_13&#39;)"><span class="hl_classref"><span class="mpre">Stream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> where
    </span><a href="Network.Stream.html#loc_86_5_86_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_86_5_86_14&#39;)"><span class="hl_fundecl"><span class="mpre">readBlock</span></span></a><span class="mpre"> </span><a name="loc_56_15_56_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_15_56_17&#39;)"><span class="hl_vardecl"><span class="mpre">sk</span></span></a><span class="mpre"> </span><a name="loc_56_18_56_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_18_56_19&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">    = </span><a href="#loc_66_1_66_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_16&#39;)"><span class="hl_varref"><span class="mpre">readBlockSocket</span></span></a><span class="mpre"> </span><a href="#loc_56_15_56_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_15_56_17&#39;)"><span class="hl_varref"><span class="mpre">sk</span></span></a><span class="mpre"> </span><a href="#loc_56_18_56_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_18_56_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
    </span><a href="Network.Stream.html#loc_85_5_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_85_5_85_13&#39;)"><span class="hl_fundecl"><span class="mpre">readLine</span></span></a><span class="mpre"> </span><a name="loc_57_14_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_14_57_16&#39;)"><span class="hl_vardecl"><span class="mpre">sk</span></span></a><span class="mpre">       = </span><a href="#loc_80_1_80_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_1_80_15&#39;)"><span class="hl_varref"><span class="mpre">readLineSocket</span></span></a><span class="mpre"> </span><a href="#loc_57_14_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_14_57_16&#39;)"><span class="hl_varref"><span class="mpre">sk</span></span></a><span class="mpre">
    </span><a href="Network.Stream.html#loc_87_5_87_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_87_5_87_15&#39;)"><span class="hl_fundecl"><span class="mpre">writeBlock</span></span></a><span class="mpre"> </span><a name="loc_58_16_58_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_16_58_18&#39;)"><span class="hl_vardecl"><span class="mpre">sk</span></span></a><span class="mpre"> </span><a name="loc_58_19_58_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_19_58_22&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> = </span><a href="#loc_89_1_89_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_1_89_17&#39;)"><span class="hl_varref"><span class="mpre">writeBlockSocket</span></span></a><span class="mpre"> </span><a href="#loc_58_16_58_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_16_58_18&#39;)"><span class="hl_varref"><span class="mpre">sk</span></span></a><span class="mpre"> </span><a href="#loc_58_19_58_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_19_58_22&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
    </span><a href="Network.Stream.html#loc_88_5_88_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_88_5_88_10&#39;)"><span class="hl_fundecl"><span class="mpre">close</span></span></a><span class="mpre"> </span><a name="loc_59_11_59_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_11_59_13&#39;)"><span class="hl_vardecl"><span class="mpre">sk</span></span></a><span class="mpre">          = do
        </span><span class="hl_comment"><span class="mpre">-- This slams closed the connection (which is considered rude for TCP\/IP)</span></span><span class="mpre">
         </span><span class="hl_varref"><span class="mpre">shutdown</span></span><span class="mpre"> </span><a href="#loc_59_11_59_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_11_59_13&#39;)"><span class="hl_varref"><span class="mpre">sk</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">ShutdownBoth</span></span><span class="mpre">
         </span><span class="hl_varref"><span class="mpre">sClose</span></span><span class="mpre"> </span><a href="#loc_59_11_59_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_11_59_13&#39;)"><span class="hl_varref"><span class="mpre">sk</span></span></a><span class="mpre">
    </span><a href="Network.Stream.html#loc_89_5_89_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Stream.html#loc_89_5_89_15&#39;)"><span class="hl_fundecl"><span class="mpre">closeOnEnd</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_sk</span></span><span class="mpre"> _  = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- can&#39;t really deal with this, so do run the risk of leaking sockets here.</span></span><span class="mpre">

</span><a href="#loc_66_1_66_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_16&#39;)"><span class="mpre">readBlockSocket</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">)
</span><a name="loc_66_1_66_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_16&#39;)"><span class="hl_fundecl"><span class="mpre">readBlockSocket</span></span></a><span class="mpre"> </span><a name="loc_66_17_66_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_17_66_19&#39;)"><span class="hl_vardecl"><span class="mpre">sk</span></span></a><span class="mpre"> </span><a name="loc_66_20_66_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_20_66_21&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = (</span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="hl_varref"><span class="mpre">liftM</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_68_4_68_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_4_68_6&#39;)"><span class="hl_varref"><span class="mpre">fn</span></span></a><span class="mpre"> </span><a href="#loc_66_20_66_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_20_66_21&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">) </span><a href="Network.HTTP.Base.html#loc_988_1_988_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_988_1_988_8&#39;)"><span class="hl_infix"><span class="mpre">`catchIO`</span></span></a><span class="mpre"> (</span><a href="#loc_43_1_43_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_18&#39;)"><span class="hl_varref"><span class="mpre">handleSocketError</span></span></a><span class="mpre"> </span><a href="#loc_66_17_66_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_17_66_19&#39;)"><span class="hl_varref"><span class="mpre">sk</span></span></a><span class="mpre">)
  where
   </span><a name="loc_68_4_68_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_4_68_6&#39;)"><span class="hl_fundecl"><span class="mpre">fn</span></span></a><span class="mpre"> </span><a name="loc_68_7_68_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_7_68_8&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = do { </span><a name="loc_68_16_68_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_16_68_19&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_51_1_51_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_7&#39;)"><span class="hl_varref"><span class="mpre">myrecv</span></span></a><span class="mpre"> </span><a href="#loc_66_17_66_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_17_66_19&#39;)"><span class="hl_varref"><span class="mpre">sk</span></span></a><span class="mpre"> </span><a href="#loc_68_7_68_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_7_68_8&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
             ; let </span><a name="loc_69_20_69_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_20_69_23&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">length</span></span><span class="mpre"> </span><a href="#loc_68_16_68_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_16_68_19&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
             ; if </span><a href="#loc_69_20_69_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_20_69_23&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_68_7_68_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_7_68_8&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
                then ( </span><a href="#loc_68_4_68_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_4_68_6&#39;)"><span class="hl_varref"><span class="mpre">fn</span></span></a><span class="mpre"> (</span><a href="#loc_68_7_68_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_7_68_8&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><a href="#loc_69_20_69_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_20_69_23&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> \</span><a name="loc_71_40_71_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_40_71_44&#39;)"><span class="hl_vardecl"><span class="mpre">more</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_68_16_68_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_16_68_19&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="hl_infix"><span class="mpre">++</span></span><a href="#loc_71_40_71_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_40_71_44&#39;)"><span class="hl_varref"><span class="mpre">more</span></span></a><span class="mpre">) )
                else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_68_16_68_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_16_68_19&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
             }

</span><span class="hl_comment"><span class="mpre">-- Use of the following function is discouraged.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The function reads in one character at a time, </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- which causes many calls to the kernel recv()</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- hence causes many context switches.</span></span><span class="mpre">
</span><a href="#loc_80_1_80_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_1_80_15&#39;)"><span class="mpre">readLineSocket</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">)
</span><a name="loc_80_1_80_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_1_80_15&#39;)"><span class="hl_fundecl"><span class="mpre">readLineSocket</span></span></a><span class="mpre"> </span><a name="loc_80_16_80_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_16_80_18&#39;)"><span class="hl_vardecl"><span class="mpre">sk</span></span></a><span class="mpre"> = (</span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="hl_varref"><span class="mpre">liftM</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_82_4_82_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_4_82_6&#39;)"><span class="hl_varref"><span class="mpre">fn</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">) </span><a href="Network.HTTP.Base.html#loc_988_1_988_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_988_1_988_8&#39;)"><span class="hl_infix"><span class="mpre">`catchIO`</span></span></a><span class="mpre"> (</span><a href="#loc_43_1_43_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_18&#39;)"><span class="hl_varref"><span class="mpre">handleSocketError</span></span></a><span class="mpre"> </span><a href="#loc_80_16_80_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_16_80_18&#39;)"><span class="hl_varref"><span class="mpre">sk</span></span></a><span class="mpre">)
  where
   </span><a name="loc_82_4_82_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_4_82_6&#39;)"><span class="hl_fundecl"><span class="mpre">fn</span></span></a><span class="mpre"> </span><a name="loc_82_7_82_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_7_82_10&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> = do
     </span><a name="loc_83_6_83_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_6_83_7&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_51_1_51_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_7&#39;)"><span class="hl_varref"><span class="mpre">myrecv</span></span></a><span class="mpre"> </span><a href="#loc_80_16_80_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_16_80_18&#39;)"><span class="hl_varref"><span class="mpre">sk</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- like eating through a straw.</span></span><span class="mpre">
     if </span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_83_6_83_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_6_83_7&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><a href="#loc_83_6_83_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_6_83_7&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">
      then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">reverse</span></span><span class="mpre"> </span><a href="#loc_82_7_82_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_7_82_10&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="hl_infix"><span class="mpre">++</span></span><a href="#loc_83_6_83_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_6_83_7&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">)
      else </span><a href="#loc_82_4_82_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_4_82_6&#39;)"><span class="hl_varref"><span class="mpre">fn</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">head</span></span><span class="mpre"> </span><a href="#loc_83_6_83_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_6_83_7&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_82_7_82_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_7_82_10&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">)
    
</span><a href="#loc_89_1_89_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_1_89_17&#39;)"><span class="mpre">writeBlockSocket</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)
</span><a name="loc_89_1_89_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_1_89_17&#39;)"><span class="hl_fundecl"><span class="mpre">writeBlockSocket</span></span></a><span class="mpre"> </span><a name="loc_89_18_89_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_18_89_20&#39;)"><span class="hl_vardecl"><span class="mpre">sk</span></span></a><span class="mpre"> </span><a name="loc_89_21_89_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_21_89_24&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> = (</span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="hl_varref"><span class="mpre">liftM</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_91_4_91_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_4_91_6&#39;)"><span class="hl_varref"><span class="mpre">fn</span></span></a><span class="mpre"> </span><a href="#loc_89_21_89_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_21_89_24&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">) </span><a href="Network.HTTP.Base.html#loc_988_1_988_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_988_1_988_8&#39;)"><span class="hl_infix"><span class="mpre">`catchIO`</span></span></a><span class="mpre"> (</span><a href="#loc_43_1_43_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_18&#39;)"><span class="hl_varref"><span class="mpre">handleSocketError</span></span></a><span class="mpre"> </span><a href="#loc_89_18_89_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_18_89_20&#39;)"><span class="hl_varref"><span class="mpre">sk</span></span></a><span class="mpre">)
  where
   </span><a name="loc_91_4_91_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_4_91_6&#39;)"><span class="hl_fundecl"><span class="mpre">fn</span></span></a><span class="mpre"> [] = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
   </span><a href="#loc_91_4_91_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_4_91_6&#39;)"><span class="hl_fundecl"><span class="mpre">fn</span></span></a><span class="mpre"> </span><a name="loc_92_7_92_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_7_92_8&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">send</span></span><span class="mpre"> </span><a href="#loc_89_18_89_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_18_89_20&#39;)"><span class="hl_varref"><span class="mpre">sk</span></span></a><span class="mpre"> </span><a href="#loc_92_7_92_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_7_92_8&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> \</span><a name="loc_92_27_92_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_27_92_28&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_91_4_91_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_4_91_6&#39;)"><span class="hl_varref"><span class="mpre">fn</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">drop</span></span><span class="mpre"> </span><a href="#loc_92_27_92_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_27_92_28&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="#loc_92_7_92_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_7_92_8&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)

</span></div></body></html>