<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">{- Benchmark server based upon Jasper van der Jeugt&#39;s &#39;BenchmarkServer.lhs&#39;
   from blaze-html. Modified for network-2.3 by Simon Meier &lt;iridcode@gmail.com&gt;
-}</span></span><span class="mpre">

{-# LANGUAGE OverloadedStrings #-}
module BenchmarkServer where

import Prelude hiding (putStrLn)

import Data.Char   (ord)
import Data.Monoid 
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/BenchmarkServer.hs&quot;, srcSpanStartLine = 12, srcSpanStartColumn = 8, srcSpanEndLine = 12, srcSpanEndColumn = 29}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> () </span><span class="hl_comment"><span class="mpre">-- IsString instance only</span></span><span class="mpre">
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/BenchmarkServer.hs&quot;, srcSpanStartLine = 13, srcSpanStartColumn = 18, srcSpanEndLine = 13, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre">               as S
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/BenchmarkServer.hs&quot;, srcSpanStartLine = 14, srcSpanStartColumn = 18, srcSpanEndLine = 14, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre">          as L
import qualified Data.ByteString.Lazy.Internal as L

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/BenchmarkServer.hs&quot;, srcSpanStartLine = 17, srcSpanStartColumn = 8, srcSpanEndLine = 17, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;Control.Concurrent&quot;"><span class="mpre">Control.Concurrent</span></span><span class="mpre"> (forkIO, putMVar, takeMVar, newEmptyMVar)
import Control.Exception  (</span><a href="Control.Exception.Base.html#loc_259_1_259_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_259_1_259_8&#39;)"><span class="mpre">bracket</span></a><span class="mpre">)
import Control.Monad 

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/BenchmarkServer.hs&quot;, srcSpanStartLine = 21, srcSpanStartColumn = 8, srcSpanEndLine = 21, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre">   (Socket, accept, sClose)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/BenchmarkServer.hs&quot;, srcSpanStartLine = 22, srcSpanStartColumn = 8, srcSpanEndLine = 22, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;Network&quot;"><span class="mpre">Network</span></span><span class="mpre">          (listenOn, PortID (PortNumber))
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/BenchmarkServer.hs&quot;, srcSpanStartLine = 23, srcSpanStartColumn = 8, srcSpanEndLine = 23, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Network.Socket.ByteString&quot;"><span class="mpre">Network.Socket.ByteString</span></span><span class="mpre">      as S
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/BenchmarkServer.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 8, srcSpanEndLine = 24, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Network.Socket.ByteString.Lazy&quot;"><span class="mpre">Network.Socket.ByteString.Lazy</span></span><span class="mpre"> as L

import System (getArgs)

import Blaze.ByteString.Builder
import Blaze.ByteString.Builder.Internal (</span><a href="Blaze.ByteString.Builder.Internal.html#loc_84_1_84_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_84_1_84_18&#39;)"><span class="mpre">defaultBufferSize</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Internal.html#loc_94_1_94_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_94_1_94_25&#39;)"><span class="mpre">defaultMinimalBufferSize</span></a><span class="mpre">)
import Blaze.ByteString.Builder.Char.Utf8

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/BenchmarkServer.hs&quot;, srcSpanStartLine = 32, srcSpanStartColumn = 8, srcSpanEndLine = 32, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Criterion.Main&quot;"><span class="mpre">Criterion.Main</span></span><span class="mpre">

</span><a href="#loc_35_1_35_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_1_35_13&#39;)"><span class="mpre">httpOkHeader</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">S.ByteString</span></span><span class="mpre"> 
</span><a name="loc_35_1_35_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_1_35_13&#39;)"><span class="hl_vardecl"><span class="mpre">httpOkHeader</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.concat</span></span><span class="mpre"> 
    [ </span><span class="hl_string"><span class="mpre">&quot;HTTP/1.1 200 OK\r\n&quot;</span></span><span class="mpre">
    , </span><span class="hl_string"><span class="mpre">&quot;Content-Type: text/html; charset=UTF-8\r\n&quot;</span></span><span class="mpre">
    , </span><span class="hl_string"><span class="mpre">&quot;\r\n&quot;</span></span><span class="mpre"> ]

</span><a href="#loc_41_1_41_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_9&#39;)"><span class="mpre">response</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_41_1_41_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_9&#39;)"><span class="hl_fundecl"><span class="mpre">response</span></span></a><span class="mpre"> </span><a name="loc_41_10_41_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_10_41_11&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = 
  </span><a href="Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15&#39;)"><span class="hl_varref"><span class="mpre">fromByteString</span></span></a><span class="mpre"> </span><a href="#loc_35_1_35_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_1_35_13&#39;)"><span class="hl_varref"><span class="mpre">httpOkHeader</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_infix"><span class="mpre">`mappend`</span></span></a><span class="mpre"> 
  </span><a href="Blaze.ByteString.Builder.Char.Utf8.html#loc_97_1_97_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char.Utf8.html#loc_97_1_97_11&#39;)"><span class="hl_varref"><span class="mpre">fromString</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">take</span></span><span class="mpre"> </span><a href="#loc_41_10_41_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_10_41_11&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">cycle</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hello Î»-world! &quot;</span></span><span class="mpre">)

</span><a href="#loc_46_1_46_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_1_46_23&#39;)"><span class="mpre">sendVectoredBuilderLBS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_46_1_46_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_1_46_23&#39;)"><span class="hl_fundecl"><span class="mpre">sendVectoredBuilderLBS</span></span></a><span class="mpre"> </span><a name="loc_46_24_46_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_24_46_25&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">L.sendAll</span></span><span class="mpre"> </span><a href="#loc_46_24_46_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_24_46_25&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17&#39;)"><span class="hl_varref"><span class="mpre">toLazyByteString</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_46_1_46_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_1_46_23&#39;)"><span class="mpre">sendVectoredBuilderLBS</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_50_1_50_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_15&#39;)"><span class="mpre">sendBuilderLBS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_50_1_50_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_15&#39;)"><span class="hl_fundecl"><span class="mpre">sendBuilderLBS</span></span></a><span class="mpre"> </span><a name="loc_50_16_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_16_50_17&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = 
  </span><span class="hl_comment"><span class="mpre">-- mapM_ (S.sendAll s) . L.toChunks . toLazyByteString</span></span><span class="mpre">
  </span><a href="Data.ByteString.Lazy.Internal.html#loc_179_1_179_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_179_1_179_12&#39;)"><span class="hl_varref"><span class="mpre">L.foldrChunks</span></span></a><span class="mpre"> (\</span><a name="loc_52_19_52_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_19_52_20&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> -&gt; (</span><span class="hl_varref"><span class="mpre">S.sendAll</span></span><span class="mpre"> </span><a href="#loc_50_16_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_16_50_17&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_52_19_52_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_19_52_20&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre">)) (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)</span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17&#39;)"><span class="hl_varref"><span class="mpre">toLazyByteString</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_50_1_50_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_15&#39;)"><span class="mpre">sendBuilderLBS</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_56_1_56_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_16&#39;)"><span class="mpre">sendBuilderBSIO</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_56_1_56_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_16&#39;)"><span class="hl_fundecl"><span class="mpre">sendBuilderBSIO</span></span></a><span class="mpre"> </span><a name="loc_56_17_56_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_17_56_18&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = </span><a href="Blaze.ByteString.Builder.Internal.html#loc_359_1_359_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_359_1_359_15&#39;)"><span class="hl_varref"><span class="mpre">toByteStringIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.sendAll</span></span><span class="mpre"> </span><a href="#loc_56_17_56_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_17_56_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_56_1_56_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_16&#39;)"><span class="mpre">sendBuilderBSIO</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- criterion benchmark determining the speed of response</span></span><span class="mpre">
</span><a name="loc_60_1_60_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_1_60_6&#39;)"><span class="hl_vardecl"><span class="mpre">main2</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">defaultMain</span></span><span class="mpre">
    [ </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;response &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_66_5_66_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_5_66_6&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">whnf</span></span><span class="mpre"> 
        (</span><span class="hl_varref"><span class="mpre">L.length</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17&#39;)"><span class="hl_varref"><span class="mpre">toLazyByteString</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_41_1_41_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_9&#39;)"><span class="hl_varref"><span class="mpre">response</span></span></a><span class="mpre">) </span><a href="#loc_66_5_66_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_5_66_6&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
    ]
  where
    </span><a href="#loc_66_5_66_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_5_66_6&#39;)"><span class="mpre">n</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
    </span><a name="loc_66_5_66_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_5_66_6&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">1000000</span></span><span class="mpre">

</span><a href="#loc_69_1_69_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_1_69_5&#39;)"><span class="mpre">main</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_69_1_69_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_1_69_5&#39;)"><span class="hl_vardecl"><span class="mpre">main</span></span></a><span class="mpre"> = do
    [</span><a name="loc_70_6_70_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_6_70_10&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre">, </span><a name="loc_70_12_70_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_12_70_18&#39;)"><span class="hl_vardecl"><span class="mpre">nChars</span></span></a><span class="mpre">] &lt;- </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="Text.Read.html#loc_91_1_91_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Read.html#loc_91_1_91_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="hl_infix"><span class="mpre">`liftM`</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">getArgs</span></span><span class="mpre">
    </span><a name="loc_71_5_71_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_5_71_15&#39;)"><span class="hl_vardecl"><span class="mpre">killSignal</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newEmptyMVar</span></span><span class="mpre">
    </span><a href="Control.Exception.Base.html#loc_259_1_259_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_259_1_259_8&#39;)"><span class="hl_varref"><span class="mpre">bracket</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">listenOn</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">PortNumber</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_70_6_70_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_6_70_10&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre">) </span><span class="hl_varref"><span class="mpre">sClose</span></span><span class="mpre"> 
        (\</span><a name="loc_73_11_73_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_11_73_17&#39;)"><span class="hl_vardecl"><span class="mpre">socket</span></span></a><span class="mpre"> -&gt; do
            _ &lt;- </span><span class="hl_varref"><span class="mpre">forkIO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_77_5_77_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_5_77_9&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">putMVar</span></span><span class="mpre"> </span><a href="#loc_71_5_71_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_5_71_15&#39;)"><span class="hl_varref"><span class="mpre">killSignal</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">) </span><a href="#loc_70_12_70_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_12_70_18&#39;)"><span class="hl_varref"><span class="mpre">nChars</span></span></a><span class="mpre"> </span><a href="#loc_73_11_73_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_11_73_17&#39;)"><span class="hl_varref"><span class="mpre">socket</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">takeMVar</span></span><span class="mpre"> </span><a href="#loc_71_5_71_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_5_71_15&#39;)"><span class="hl_varref"><span class="mpre">killSignal</span></span></a><span class="mpre">)
  where
    </span><a name="loc_77_5_77_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_5_77_9&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_77_10_77_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_10_77_20&#39;)"><span class="hl_vardecl"><span class="mpre">killServer</span></span></a><span class="mpre"> </span><a name="loc_77_21_77_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_21_77_27&#39;)"><span class="hl_vardecl"><span class="mpre">nChars</span></span></a><span class="mpre"> </span><a name="loc_77_28_77_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_28_77_34&#39;)"><span class="hl_vardecl"><span class="mpre">socket</span></span></a><span class="mpre"> = </span><a href="Control.Monad.html#loc_189_1_189_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_189_1_189_8&#39;)"><span class="hl_varref"><span class="mpre">forever</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do 
        (</span><a name="loc_78_10_78_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_10_78_11&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">, _) &lt;- </span><span class="hl_varref"><span class="mpre">accept</span></span><span class="mpre"> </span><a href="#loc_77_28_77_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_28_77_34&#39;)"><span class="hl_varref"><span class="mpre">socket</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">forkIO</span></span><span class="mpre"> (</span><a href="#loc_81_9_81_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_9_81_16&#39;)"><span class="hl_varref"><span class="mpre">respond</span></span></a><span class="mpre"> </span><a href="#loc_78_10_78_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_10_78_11&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_77_21_77_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_21_77_27&#39;)"><span class="hl_varref"><span class="mpre">nChars</span></span></a><span class="mpre">)
      where
        </span><a name="loc_81_9_81_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_9_81_16&#39;)"><span class="hl_fundecl"><span class="mpre">respond</span></span></a><span class="mpre"> </span><a name="loc_81_17_81_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_17_81_18&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_81_19_81_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_19_81_20&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = do
            </span><a name="loc_82_13_82_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_13_82_18&#39;)"><span class="hl_vardecl"><span class="mpre">input</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">S.recv</span></span><span class="mpre"> </span><a href="#loc_81_17_81_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_17_81_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1024</span></span><span class="mpre">
            let </span><a name="loc_83_17_83_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_17_83_27&#39;)"><span class="hl_vardecl"><span class="mpre">requestUrl</span></span></a><span class="mpre"> = (</span><span class="hl_varref"><span class="mpre">S.split</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">ord</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39; &#39;</span></span><span class="mpre">) </span><a href="#loc_82_13_82_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_13_82_18&#39;)"><span class="hl_varref"><span class="mpre">input</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">!!</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
            case </span><span class="hl_varref"><span class="mpre">tail</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">S.split</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">ord</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;/&#39;</span></span><span class="mpre">) </span><a href="#loc_83_17_83_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_17_83_27&#39;)"><span class="hl_varref"><span class="mpre">requestUrl</span></span></a><span class="mpre">) of
                [</span><span class="hl_string"><span class="mpre">&quot;lbs&quot;</span></span><span class="mpre">]     -&gt; </span><a href="#loc_50_1_50_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_15&#39;)"><span class="hl_varref"><span class="mpre">sendBuilderLBS</span></span></a><span class="mpre"> </span><a href="#loc_81_17_81_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_17_81_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">         </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_41_1_41_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_9&#39;)"><span class="hl_varref"><span class="mpre">response</span></span></a><span class="mpre"> </span><a href="#loc_81_19_81_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_19_81_20&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
                [</span><span class="hl_string"><span class="mpre">&quot;lbs-vec&quot;</span></span><span class="mpre">] -&gt; </span><a href="#loc_46_1_46_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_1_46_23&#39;)"><span class="hl_varref"><span class="mpre">sendVectoredBuilderLBS</span></span></a><span class="mpre"> </span><a href="#loc_81_17_81_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_17_81_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_41_1_41_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_9&#39;)"><span class="hl_varref"><span class="mpre">response</span></span></a><span class="mpre"> </span><a href="#loc_81_19_81_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_19_81_20&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
                [</span><span class="hl_string"><span class="mpre">&quot;bs-io&quot;</span></span><span class="mpre">]   -&gt; </span><a href="#loc_56_1_56_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_16&#39;)"><span class="hl_varref"><span class="mpre">sendBuilderBSIO</span></span></a><span class="mpre">   </span><a href="#loc_81_17_81_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_17_81_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">      </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_41_1_41_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_9&#39;)"><span class="hl_varref"><span class="mpre">response</span></span></a><span class="mpre"> </span><a href="#loc_81_19_81_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_19_81_20&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
                [</span><span class="hl_string"><span class="mpre">&quot;kill&quot;</span></span><span class="mpre">]    -&gt; </span><a href="#loc_92_5_92_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_13&#39;)"><span class="hl_varref"><span class="mpre">notFound</span></span></a><span class="mpre"> </span><a href="#loc_81_17_81_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_17_81_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_77_10_77_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_10_77_20&#39;)"><span class="hl_varref"><span class="mpre">killServer</span></span></a><span class="mpre">
                _           -&gt; </span><a href="#loc_92_5_92_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_13&#39;)"><span class="hl_varref"><span class="mpre">notFound</span></span></a><span class="mpre"> </span><a href="#loc_81_17_81_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_17_81_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">sClose</span></span><span class="mpre"> </span><a href="#loc_81_17_81_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_17_81_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">

    </span><a name="loc_92_5_92_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_13&#39;)"><span class="hl_fundecl"><span class="mpre">notFound</span></span></a><span class="mpre"> </span><a name="loc_92_14_92_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_14_92_15&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = do
        _ &lt;- </span><span class="hl_varref"><span class="mpre">S.sendAll</span></span><span class="mpre"> </span><a href="#loc_92_14_92_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_14_92_15&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;HTTP/1.1 404 Not Found\r\n&quot;</span></span><span class="mpre">
            </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_infix"><span class="mpre">`mappend`</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Content-Type: text/html; charset=UTF-8\r\n&quot;</span></span><span class="mpre">
            </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_infix"><span class="mpre">`mappend`</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;\r\n&quot;</span></span><span class="mpre">
            </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_infix"><span class="mpre">`mappend`</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&lt;h1&gt;Page not found&lt;/h1&gt;&quot;</span></span><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
</span></div></body></html>