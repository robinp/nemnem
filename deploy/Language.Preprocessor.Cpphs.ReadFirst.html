<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  ReadFirst</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  2004 Malcolm Wallace</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Licence     :  LGPL</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  Malcolm Wallace &lt;Malcolm.Wallace@cs.york.ac.uk&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  All</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Read the first file that matches in a list of search paths.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module Language.Preprocessor.Cpphs.ReadFirst
  ( readFirst
  ) where

import System.IO        (hPutStrLn, stderr)
import System.Directory (</span><a href="System.Directory.html#loc_726_1_726_14" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_726_1_726_14&#39;)"><span class="mpre">doesFileExist</span></a><span class="mpre">)
import Data.List      (</span><a href="Data.List.html#loc_427_1_427_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_427_1_427_12&#39;)"><span class="mpre">intersperse</span></a><span class="mpre">)
import Control.Monad     (</span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">)
import Language.Preprocessor.Cpphs.Position  (</span><a href="Language.Preprocessor.Cpphs.Position.html#loc_28_6_28_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Language.Preprocessor.Cpphs.Position.html#loc_28_6_28_10&#39;)"><span class="mpre">Posn</span></a><span class="mpre">,</span><a href="Language.Preprocessor.Cpphs.Position.html#loc_76_1_76_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Language.Preprocessor.Cpphs.Position.html#loc_76_1_76_10&#39;)"><span class="mpre">directory</span></a><span class="mpre">,</span><a href="Language.Preprocessor.Cpphs.Position.html#loc_104_1_104_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Language.Preprocessor.Cpphs.Position.html#loc_104_1_104_10&#39;)"><span class="mpre">cleanPath</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Attempt to read the given file from any location within the search path.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   The first location found is returned, together with the file content.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   (The directory of the calling file is always searched first, then</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    the current directory, finally any specified search path.)</span></span><span class="mpre">
</span><a href="#loc_36_1_36_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_10&#39;)"><span class="mpre">readFirst</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">                </span><span class="hl_comment"><span class="mpre">-- ^ filename</span></span><span class="mpre">
        -&gt; </span><a href="Language.Preprocessor.Cpphs.Position.html#loc_28_6_28_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Language.Preprocessor.Cpphs.Position.html#loc_28_6_28_10&#39;)"><span class="hl_tyconref"><span class="mpre">Posn</span></span></a><span class="mpre">                        </span><span class="hl_comment"><span class="mpre">-- ^ inclusion point</span></span><span class="mpre">
        -&gt; [</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">]                </span><span class="hl_comment"><span class="mpre">-- ^ search path</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">                        </span><span class="hl_comment"><span class="mpre">-- ^ report warnings?</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> ( </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre">
              , </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
              )                        </span><span class="hl_comment"><span class="mpre">-- ^ discovered filepath, and file contents</span></span><span class="mpre">

</span><a name="loc_36_1_36_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_10&#39;)"><span class="hl_fundecl"><span class="mpre">readFirst</span></span></a><span class="mpre"> </span><a name="loc_36_11_36_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_15&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre"> </span><a name="loc_36_16_36_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_16_36_22&#39;)"><span class="hl_vardecl"><span class="mpre">demand</span></span></a><span class="mpre"> </span><a name="loc_36_23_36_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_23_36_27&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> </span><a name="loc_36_28_36_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_28_36_32&#39;)"><span class="hl_vardecl"><span class="mpre">warn</span></span></a><span class="mpre"> =
    </span><a href="#loc_41_5_41_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_5_41_8&#39;)"><span class="hl_varref"><span class="mpre">try</span></span></a><span class="mpre"> (</span><a href="#loc_40_5_40_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_5_40_9&#39;)"><span class="hl_varref"><span class="mpre">cons</span></span></a><span class="mpre"> </span><a href="#loc_39_5_39_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_5_39_7&#39;)"><span class="hl_varref"><span class="mpre">dd</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;.&quot;</span></span><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_36_23_36_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_23_36_27&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre">))
  where
    </span><a name="loc_39_5_39_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_5_39_7&#39;)"><span class="hl_vardecl"><span class="mpre">dd</span></span></a><span class="mpre"> = </span><a href="Language.Preprocessor.Cpphs.Position.html#loc_76_1_76_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Language.Preprocessor.Cpphs.Position.html#loc_76_1_76_10&#39;)"><span class="hl_varref"><span class="mpre">directory</span></span></a><span class="mpre"> </span><a href="#loc_36_16_36_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_16_36_22&#39;)"><span class="hl_varref"><span class="mpre">demand</span></span></a><span class="mpre">
    </span><a name="loc_40_5_40_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_5_40_9&#39;)"><span class="hl_fundecl"><span class="mpre">cons</span></span></a><span class="mpre"> </span><a name="loc_40_10_40_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_10_40_11&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> </span><a name="loc_40_12_40_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_12_40_14&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre"> = if </span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_40_10_40_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_10_40_11&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> then </span><a href="#loc_40_12_40_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_12_40_14&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre"> else </span><a href="#loc_40_10_40_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_10_40_11&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_40_12_40_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_12_40_14&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">
    </span><a name="loc_41_5_41_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_5_41_8&#39;)"><span class="hl_fundecl"><span class="mpre">try</span></span></a><span class="mpre"> [] = do
        </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_36_28_36_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_28_36_32&#39;)"><span class="hl_varref"><span class="mpre">warn</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">hPutStrLn</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">stderr</span></span><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;Warning: Can&#39;t find file \&quot;&quot;</span></span><span class="hl_infix"><span class="mpre">++</span></span><a href="#loc_36_11_36_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_15&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre">
                           </span><span class="hl_infix"><span class="mpre">++</span></span><span class="hl_string"><span class="mpre">&quot;\&quot; in directories\n\t&quot;</span></span><span class="mpre">
                           </span><span class="hl_infix"><span class="mpre">++</span></span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre"> (</span><a href="Data.List.html#loc_427_1_427_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_427_1_427_12&#39;)"><span class="hl_varref"><span class="mpre">intersperse</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;\n\t&quot;</span></span><span class="mpre"> (</span><a href="#loc_40_5_40_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_5_40_9&#39;)"><span class="hl_varref"><span class="mpre">cons</span></span></a><span class="mpre"> </span><a href="#loc_39_5_39_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_5_39_7&#39;)"><span class="hl_varref"><span class="mpre">dd</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;.&quot;</span></span><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_36_23_36_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_23_36_27&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre">)))
                           </span><span class="hl_infix"><span class="mpre">++</span></span><span class="hl_string"><span class="mpre">&quot;\n  Asked for by: &quot;</span></span><span class="hl_infix"><span class="mpre">++</span></span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_36_16_36_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_16_36_22&#39;)"><span class="hl_varref"><span class="mpre">demand</span></span></a><span class="mpre">)
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;missing file: &quot;</span></span><span class="hl_infix"><span class="mpre">++</span></span><a href="#loc_36_11_36_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_15&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre">,</span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">)
    </span><a href="#loc_41_5_41_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_5_41_8&#39;)"><span class="hl_fundecl"><span class="mpre">try</span></span></a><span class="mpre"> (</span><a name="loc_48_10_48_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_10_48_11&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_48_12_48_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_12_48_14&#39;)"><span class="hl_vardecl"><span class="mpre">ps</span></span></a><span class="mpre">) = do
        let </span><a name="loc_49_13_49_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_13_49_17&#39;)"><span class="hl_vardecl"><span class="mpre">file</span></span></a><span class="mpre"> = </span><a href="Language.Preprocessor.Cpphs.Position.html#loc_104_1_104_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Language.Preprocessor.Cpphs.Position.html#loc_104_1_104_10&#39;)"><span class="hl_varref"><span class="mpre">cleanPath</span></span></a><span class="mpre"> </span><a href="#loc_48_10_48_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_10_48_11&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="hl_infix"><span class="mpre">++</span></span><span class="hl_char"><span class="mpre">&#39;/&#39;</span></span><span class="hl_infix"><span class="mpre">:</span></span><a href="Language.Preprocessor.Cpphs.Position.html#loc_104_1_104_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Language.Preprocessor.Cpphs.Position.html#loc_104_1_104_10&#39;)"><span class="hl_varref"><span class="mpre">cleanPath</span></span></a><span class="mpre"> </span><a href="#loc_36_11_36_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_15&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre">
        </span><a name="loc_50_9_50_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_9_50_11&#39;)"><span class="hl_vardecl"><span class="mpre">ok</span></span></a><span class="mpre"> &lt;- </span><a href="System.Directory.html#loc_726_1_726_14" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_726_1_726_14&#39;)"><span class="hl_varref"><span class="mpre">doesFileExist</span></span></a><span class="mpre"> </span><a href="#loc_49_13_49_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_13_49_17&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre">
        if </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><a href="#loc_50_9_50_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_9_50_11&#39;)"><span class="hl_varref"><span class="mpre">ok</span></span></a><span class="mpre"> then </span><a href="#loc_41_5_41_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_5_41_8&#39;)"><span class="hl_varref"><span class="mpre">try</span></span></a><span class="mpre"> </span><a href="#loc_48_12_48_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_12_48_14&#39;)"><span class="hl_varref"><span class="mpre">ps</span></span></a><span class="mpre">
          else do </span><a name="loc_52_19_52_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_19_52_26&#39;)"><span class="hl_vardecl"><span class="mpre">content</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readFile</span></span><span class="mpre"> </span><a href="#loc_49_13_49_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_13_49_17&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre">
                  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_49_13_49_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_13_49_17&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre">,</span><a href="#loc_52_19_52_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_19_52_26&#39;)"><span class="hl_varref"><span class="mpre">content</span></span></a><span class="mpre">)

</span></div></body></html>