<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Crypto.PubKey.RSA</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : Good</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Crypto.PubKey.RSA
    ( Error(..)
    , PublicKey(..)
    , PrivateKey(..)
    , Blinder(..)
    </span><span class="hl_comment"><span class="mpre">-- * generation function</span></span><span class="mpre">
    , generateWith
    , generate
    , generateBlinder
    ) where

import Crypto.Random
import Crypto.Types.PubKey.RSA
import Crypto.Number.ModArithmetic (</span><a href="Crypto.Number.ModArithmetic.html#loc_126_1_126_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.ModArithmetic.html#loc_126_1_126_8&#39;)"><span class="mpre">inverse</span></a><span class="mpre">, </span><a href="Crypto.Number.ModArithmetic.html#loc_144_1_144_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.ModArithmetic.html#loc_144_1_144_16&#39;)"><span class="mpre">inverseCoprimes</span></a><span class="mpre">)
import Crypto.Number.Generate (</span><a href="Crypto.Number.Generate.html#loc_24_1_24_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.Generate.html#loc_24_1_24_12&#39;)"><span class="mpre">generateMax</span></a><span class="mpre">)
import Crypto.Number.Prime (</span><a href="Crypto.Number.Prime.html#loc_52_1_52_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.Prime.html#loc_52_1_52_14&#39;)"><span class="mpre">generatePrime</span></a><span class="mpre">)
import Crypto.PubKey.RSA.Types

</span><span class="hl_comment"><span class="mpre">-- | Generate a key pair given p and q.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- p and q need to be distinct prime numbers.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- e need to be coprime to phi=(p-1)*(q-1). If that&#39;s not the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- case, the function will not return a key pair.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A small hamming weight results in better performance.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * e=0x10001 is a popular choice</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * e=3 is popular as well, but proven to not be as secure for some cases.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_42_1_42_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_13&#39;)"><span class="mpre">generateWith</span></a><span class="mpre"> :: (</span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">) </span><span class="hl_comment"><span class="mpre">-- ^ chosen distinct primes p and q</span></span><span class="mpre">
             -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">                </span><span class="hl_comment"><span class="mpre">-- ^ size in bytes</span></span><span class="mpre">
             -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">            </span><span class="hl_comment"><span class="mpre">-- ^ RSA public exponant &#39;e&#39;</span></span><span class="mpre">
             -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> (</span><a href="Crypto.Types.PubKey.RSA.html#loc_25_6_25_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.RSA.html#loc_25_6_25_15&#39;)"><span class="hl_tyconref"><span class="mpre">PublicKey</span></span></a><span class="mpre">, </span><a href="Crypto.Types.PubKey.RSA.html#loc_60_6_60_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.RSA.html#loc_60_6_60_16&#39;)"><span class="hl_tyconref"><span class="mpre">PrivateKey</span></span></a><span class="mpre">)
</span><a name="loc_42_1_42_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_13&#39;)"><span class="hl_fundecl"><span class="mpre">generateWith</span></span></a><span class="mpre"> (</span><a name="loc_42_15_42_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_15_42_16&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre">,</span><a name="loc_42_17_42_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_17_42_18&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre">) </span><span class="hl_vardecl"><span class="mpre">size</span></span><span class="mpre"> </span><a name="loc_42_25_42_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_25_42_26&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> =
    case </span><a href="Crypto.Number.ModArithmetic.html#loc_126_1_126_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.ModArithmetic.html#loc_126_1_126_8&#39;)"><span class="hl_varref"><span class="mpre">inverse</span></span></a><span class="mpre"> </span><a href="#loc_42_25_42_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_25_42_26&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> </span><a href="#loc_47_9_47_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_9_47_12&#39;)"><span class="hl_varref"><span class="mpre">phi</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_45_14_45_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_14_45_15&#39;)"><span class="hl_vardecl"><span class="mpre">d</span></span></a><span class="mpre">  -&gt; </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a href="#loc_50_9_50_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_9_50_12&#39;)"><span class="hl_varref"><span class="mpre">pub</span></span></a><span class="mpre">,</span><a href="#loc_54_9_54_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_9_54_13&#39;)"><span class="hl_varref"><span class="mpre">priv</span></span></a><span class="mpre"> </span><a href="#loc_45_14_45_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_14_45_15&#39;)"><span class="hl_varref"><span class="mpre">d</span></span></a><span class="mpre">)
  where </span><span class="hl_vardecl"><span class="mpre">n</span></span><span class="mpre">   = </span><a href="#loc_42_15_42_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_15_42_16&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="hl_infix"><span class="mpre">*</span></span><a href="#loc_42_17_42_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_17_42_18&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">
        </span><a name="loc_47_9_47_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_9_47_12&#39;)"><span class="hl_vardecl"><span class="mpre">phi</span></span></a><span class="mpre"> = (</span><a href="#loc_42_15_42_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_15_42_16&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)</span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre">(</span><a href="#loc_42_17_42_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_17_42_18&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
        </span><span class="hl_comment"><span class="mpre">-- q and p should be *distinct* *prime* numbers, hence always coprime</span></span><span class="mpre">
        </span><span class="hl_vardecl"><span class="mpre">qinv</span></span><span class="mpre"> = </span><a href="Crypto.Number.ModArithmetic.html#loc_144_1_144_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.ModArithmetic.html#loc_144_1_144_16&#39;)"><span class="hl_varref"><span class="mpre">inverseCoprimes</span></span></a><span class="mpre"> </span><a href="#loc_42_17_42_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_17_42_18&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre"> </span><a href="#loc_42_15_42_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_15_42_16&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">
        </span><a name="loc_50_9_50_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_9_50_12&#39;)"><span class="hl_vardecl"><span class="mpre">pub</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA.hs&quot;, srcSpanStartLine = 50, srcSpanStartColumn = 15, srcSpanEndLine = 53, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA.hs&quot;, srcSpanStartLine = 50, srcSpanStartColumn = 25, srcSpanEndLine = 50, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA.hs&quot;,"><span class="mpre">PublicKey { public_size = size
                        , public_n    = n
                        , public_e    = e
                        }</span></span><span class="mpre">
        </span><a name="loc_54_9_54_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_9_54_13&#39;)"><span class="hl_fundecl"><span class="mpre">priv</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">d</span></span><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 18, srcSpanEndLine = 61, srcSpanEndColumn = 30}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 29, srcSpanEndLine = 54, srcSpanEndColumn = 30},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA.hs&quot;,"><span class="mpre">PrivateKey { private_pub  = pub
                            , private_d    = d
                            , private_p    = p
                            , private_q    = q
                            , private_dP   = d `mod` (p-1)
                            , private_dQ   = d `mod` (q-1)
                            , private_qinv = qinv
                            }</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | generate a pair of (private, public) key of size in bytes.</span></span><span class="mpre">
</span><a href="#loc_69_1_69_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_1_69_9&#39;)"><span class="mpre">generate</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA.hs&quot;, srcSpanStartLine = 64, srcSpanStartColumn = 13, srcSpanEndLine = 65, srcSpanEndColumn = 12}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 10, srcSpanEndLine = 65, srcSpanEndColumn = 12}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cryp"><span class="mpre">CPRG g
         =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">       </span><span class="hl_comment"><span class="mpre">-- ^ CPRG</span></span><span class="mpre">
         -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">     </span><span class="hl_comment"><span class="mpre">-- ^ size in bytes</span></span><span class="mpre">
         -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ RSA public exponant &#39;e&#39;</span></span><span class="mpre">
         -&gt; ((</span><a href="Crypto.Types.PubKey.RSA.html#loc_25_6_25_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.RSA.html#loc_25_6_25_15&#39;)"><span class="hl_tyconref"><span class="mpre">PublicKey</span></span></a><span class="mpre">, </span><a href="Crypto.Types.PubKey.RSA.html#loc_60_6_60_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.RSA.html#loc_60_6_60_16&#39;)"><span class="hl_tyconref"><span class="mpre">PrivateKey</span></span></a><span class="mpre">), </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">)
</span><a name="loc_69_1_69_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_1_69_9&#39;)"><span class="hl_fundecl"><span class="mpre">generate</span></span></a><span class="mpre"> </span><a name="loc_69_10_69_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_10_69_13&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a name="loc_69_14_69_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_14_69_18&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> </span><a name="loc_69_19_69_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_19_69_20&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> = </span><a href="#loc_70_9_70_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_9_70_13&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_69_10_69_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_10_69_13&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre">
  where </span><a name="loc_70_9_70_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_9_70_13&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_70_14_70_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_14_70_15&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre"> = </span><span class="hl_comment"><span class="mpre">-- loop until we find a valid key pair given e</span></span><span class="mpre">
            let (</span><a name="loc_71_18_71_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_18_71_20&#39;)"><span class="hl_vardecl"><span class="mpre">pq</span></span></a><span class="mpre">, </span><a name="loc_71_22_71_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_22_71_24&#39;)"><span class="hl_vardecl"><span class="mpre">g&#39;</span></span></a><span class="mpre">) = </span><a href="#loc_75_9_75_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_9_75_19&#39;)"><span class="hl_varref"><span class="mpre">generatePQ</span></span></a><span class="mpre"> </span><a href="#loc_70_14_70_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_14_70_15&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre">
             in case </span><a href="#loc_42_1_42_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_13&#39;)"><span class="hl_varref"><span class="mpre">generateWith</span></span></a><span class="mpre"> </span><a href="#loc_71_18_71_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_18_71_20&#39;)"><span class="hl_varref"><span class="mpre">pq</span></span></a><span class="mpre"> </span><a href="#loc_69_14_69_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_14_69_18&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_69_19_69_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_19_69_20&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> of
                    </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><a href="#loc_70_9_70_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_9_70_13&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_71_22_71_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_22_71_24&#39;)"><span class="hl_varref"><span class="mpre">g&#39;</span></span></a><span class="mpre">
                    </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_74_26_74_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_26_74_28&#39;)"><span class="hl_vardecl"><span class="mpre">pp</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_74_26_74_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_26_74_28&#39;)"><span class="hl_varref"><span class="mpre">pp</span></span></a><span class="mpre">, </span><a href="#loc_71_22_71_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_22_71_24&#39;)"><span class="hl_varref"><span class="mpre">g&#39;</span></span></a><span class="mpre">)
        </span><a name="loc_75_9_75_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_9_75_19&#39;)"><span class="hl_fundecl"><span class="mpre">generatePQ</span></span></a><span class="mpre"> </span><a name="loc_75_20_75_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_20_75_21&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre"> =
            let (</span><a name="loc_76_18_76_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_18_76_19&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre">, </span><a name="loc_76_21_76_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_21_76_23&#39;)"><span class="hl_vardecl"><span class="mpre">g&#39;</span></span></a><span class="mpre">)  = </span><a href="Crypto.Number.Prime.html#loc_52_1_52_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.Prime.html#loc_52_1_52_14&#39;)"><span class="hl_varref"><span class="mpre">generatePrime</span></span></a><span class="mpre"> </span><a href="#loc_75_20_75_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_20_75_21&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre"> (</span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> (</span><a href="#loc_69_14_69_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_14_69_18&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`div`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">))
                (</span><a name="loc_77_18_77_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_18_77_19&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre">, </span><a name="loc_77_21_77_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_21_77_24&#39;)"><span class="hl_vardecl"><span class="mpre">g&#39;&#39;</span></span></a><span class="mpre">) = </span><a href="#loc_79_9_79_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_9_79_18&#39;)"><span class="hl_varref"><span class="mpre">generateQ</span></span></a><span class="mpre"> </span><a href="#loc_76_18_76_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_18_76_19&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_76_21_76_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_21_76_23&#39;)"><span class="hl_varref"><span class="mpre">g&#39;</span></span></a><span class="mpre">
             in ((</span><a href="#loc_76_18_76_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_18_76_19&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">,</span><a href="#loc_77_18_77_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_18_77_19&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">), </span><a href="#loc_77_21_77_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_21_77_24&#39;)"><span class="hl_varref"><span class="mpre">g&#39;&#39;</span></span></a><span class="mpre">)
        </span><a name="loc_79_9_79_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_9_79_18&#39;)"><span class="hl_fundecl"><span class="mpre">generateQ</span></span></a><span class="mpre"> </span><a name="loc_79_19_79_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_19_79_20&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_79_21_79_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_21_79_22&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> =
            let (</span><a name="loc_80_18_80_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_18_80_19&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre">, </span><a name="loc_80_21_80_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_21_80_23&#39;)"><span class="hl_vardecl"><span class="mpre">h&#39;</span></span></a><span class="mpre">) = </span><a href="Crypto.Number.Prime.html#loc_52_1_52_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.Prime.html#loc_52_1_52_14&#39;)"><span class="hl_varref"><span class="mpre">generatePrime</span></span></a><span class="mpre"> </span><a href="#loc_79_21_79_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_21_79_22&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> (</span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> (</span><a href="#loc_69_14_69_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_14_69_18&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> (</span><a href="#loc_69_14_69_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_14_69_18&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`div`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">)))
             in if </span><a href="#loc_79_19_79_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_19_79_20&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_80_18_80_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_18_80_19&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre"> then </span><a href="#loc_79_9_79_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_9_79_18&#39;)"><span class="hl_varref"><span class="mpre">generateQ</span></span></a><span class="mpre"> </span><a href="#loc_79_19_79_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_19_79_20&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_80_21_80_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_21_80_23&#39;)"><span class="hl_varref"><span class="mpre">h&#39;</span></span></a><span class="mpre"> else (</span><a href="#loc_80_18_80_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_18_80_19&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">, </span><a href="#loc_80_21_80_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_21_80_23&#39;)"><span class="hl_varref"><span class="mpre">h&#39;</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Generate a blinder to use with decryption and signing operation</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the unique parameter apart from the random number generator is the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- public key value N.</span></span><span class="mpre">
</span><a href="#loc_91_1_91_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_1_91_16&#39;)"><span class="mpre">generateBlinder</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA.hs&quot;, srcSpanStartLine = 87, srcSpanStartColumn = 20, srcSpanEndLine = 88, srcSpanEndColumn = 19}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA.hs&quot;, srcSpanStartLine = 88, srcSpanStartColumn = 17, srcSpanEndLine = 88, srcSpanEndColumn = 19}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cryp"><span class="mpre">CPRG g
                =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">       </span><span class="hl_comment"><span class="mpre">-- ^ CPRG to use.</span></span><span class="mpre">
                -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ RSA public N parameter.</span></span><span class="mpre">
                -&gt; (</span><a href="Crypto.PubKey.RSA.Types.html#loc_15_6_15_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.PubKey.RSA.Types.html#loc_15_6_15_13&#39;)"><span class="hl_tyconref"><span class="mpre">Blinder</span></span></a><span class="mpre">, </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">)
</span><a name="loc_91_1_91_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_1_91_16&#39;)"><span class="hl_fundecl"><span class="mpre">generateBlinder</span></span></a><span class="mpre"> </span><a name="loc_91_17_91_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_17_91_20&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a name="loc_91_21_91_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_21_91_22&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = (</span><a href="Crypto.PubKey.RSA.Types.html#loc_15_16_15_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.PubKey.RSA.Types.html#loc_15_16_15_23&#39;)"><span class="hl_conref"><span class="mpre">Blinder</span></span></a><span class="mpre"> </span><a href="#loc_92_10_92_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_10_92_11&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> (</span><a href="Crypto.Number.ModArithmetic.html#loc_144_1_144_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.ModArithmetic.html#loc_144_1_144_16&#39;)"><span class="hl_varref"><span class="mpre">inverseCoprimes</span></span></a><span class="mpre"> </span><a href="#loc_92_10_92_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_10_92_11&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><a href="#loc_91_21_91_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_21_91_22&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">), </span><a href="#loc_92_13_92_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_13_92_17&#39;)"><span class="hl_varref"><span class="mpre">rng&#39;</span></span></a><span class="mpre">)
  where (</span><a name="loc_92_10_92_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_10_92_11&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">, </span><a name="loc_92_13_92_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_13_92_17&#39;)"><span class="hl_vardecl"><span class="mpre">rng&#39;</span></span></a><span class="mpre">) = </span><a href="Crypto.Number.Generate.html#loc_24_1_24_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.Generate.html#loc_24_1_24_12&#39;)"><span class="hl_varref"><span class="mpre">generateMax</span></span></a><span class="mpre"> </span><a href="#loc_91_17_91_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_17_91_20&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a href="#loc_91_21_91_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_21_91_22&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
</span></div></body></html>