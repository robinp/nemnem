<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE CPP, DeriveDataTypeable #-}

#if __GLASGOW_HASKELL__ &gt;= 701
{-# LANGUAGE Trustworthy #-}
#endif

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Control.Concurrent.STM.TMVar</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow 2004</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD-style (see the file libraries/base/LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  libraries@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (requires STM)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- TMVar: Transactional MVars, for use in the STM monad</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (GHC only)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module Control.Concurrent.STM.TMVar (
#ifdef __GLASGOW_HASKELL__
        </span><span class="hl_comment"><span class="mpre">-- * TMVars</span></span><span class="mpre">
        TMVar,
        newTMVar,
        newEmptyTMVar,
        newTMVarIO,
        newEmptyTMVarIO,
        takeTMVar,
        putTMVar,
        readTMVar,        
        tryReadTMVar,
        swapTMVar,
        tryTakeTMVar,
        tryPutTMVar,
        isEmptyTMVar
#endif
  ) where

#ifdef __GLASGOW_HASKELL__
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TMVar.hs&quot;, srcSpanStartLine = 42, srcSpanStartColumn = 8, srcSpanEndLine = 42, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Conc&quot;"><span class="mpre">GHC.Conc</span></span><span class="mpre">

import Data.Typeable (</span><a href="Data.Typeable.Internal.html#loc_196_7_196_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Typeable.Internal.html#loc_196_7_196_15&#39;)"><span class="mpre">Typeable</span></a><span class="mpre">)

newtype </span><a name="loc_46_9_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_14&#39;)"><span class="hl_tycondecl"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_46_19_46_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_24&#39;)"><span class="hl_condecl"><span class="mpre">TMVar</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">TVar</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)) </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TMVar.hs&quot;, srcSpanStartLine = 46, srcSpanStartColumn = 42, srcSpanEndLine = 46, srcSpanEndColumn = 65}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TMVar.hs&quot;, srcSpanStartLine = 46, srcSpanStartColumn = 42, srcSpanEndLine = 46, srcSpanEndColumn = 50},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TMVar.hs"><span class="mpre">deriving (Eq, Typeable)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">{- ^
A &#39;TMVar&#39; is a synchronising variable, used
for communication between concurrent threads.  It can be thought of
as a box, which may be empty or full.
-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Create a &#39;TMVar&#39; which contains the supplied value.</span></span><span class="mpre">
</span><a href="#loc_55_1_55_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_9&#39;)"><span class="mpre">newTMVar</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> (</span><a href="#loc_46_9_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_14&#39;)"><span class="hl_tyconref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_55_1_55_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_9&#39;)"><span class="hl_fundecl"><span class="mpre">newTMVar</span></span></a><span class="mpre"> </span><a name="loc_55_10_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_10_55_11&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = do
  </span><a name="loc_56_3_56_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_3_56_4&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVar</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_55_10_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_10_55_11&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_46_19_46_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_24&#39;)"><span class="hl_conref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><a href="#loc_56_3_56_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_3_56_4&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |@IO@ version of &#39;newTMVar&#39;.  This is useful for creating top-level</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;TMVar&#39;s using &#39;System.IO.Unsafe.unsafePerformIO&#39;, because using</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;atomically&#39; inside &#39;System.IO.Unsafe.unsafePerformIO&#39; isn&#39;t</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- possible.</span></span><span class="mpre">
</span><a href="#loc_64_1_64_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_11&#39;)"><span class="mpre">newTMVarIO</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_46_9_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_14&#39;)"><span class="hl_tyconref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_64_1_64_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_11&#39;)"><span class="hl_fundecl"><span class="mpre">newTMVarIO</span></span></a><span class="mpre"> </span><a name="loc_64_12_64_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_12_64_13&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = do
  </span><a name="loc_65_3_65_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_3_65_4&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVarIO</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_64_12_64_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_12_64_13&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_46_19_46_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_24&#39;)"><span class="hl_conref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><a href="#loc_65_3_65_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_3_65_4&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |Create a &#39;TMVar&#39; which is initially empty.</span></span><span class="mpre">
</span><a href="#loc_70_1_70_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_1_70_14&#39;)"><span class="mpre">newEmptyTMVar</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> (</span><a href="#loc_46_9_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_14&#39;)"><span class="hl_tyconref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_70_1_70_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_1_70_14&#39;)"><span class="hl_vardecl"><span class="mpre">newEmptyTMVar</span></span></a><span class="mpre"> = do
  </span><a name="loc_71_3_71_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_3_71_4&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVar</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_46_19_46_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_24&#39;)"><span class="hl_conref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><a href="#loc_71_3_71_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_3_71_4&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |@IO@ version of &#39;newEmptyTMVar&#39;.  This is useful for creating top-level</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;TMVar&#39;s using &#39;System.IO.Unsafe.unsafePerformIO&#39;, because using</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;atomically&#39; inside &#39;System.IO.Unsafe.unsafePerformIO&#39; isn&#39;t</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- possible.</span></span><span class="mpre">
</span><a href="#loc_79_1_79_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_16&#39;)"><span class="mpre">newEmptyTMVarIO</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_46_9_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_14&#39;)"><span class="hl_tyconref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_79_1_79_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_16&#39;)"><span class="hl_vardecl"><span class="mpre">newEmptyTMVarIO</span></span></a><span class="mpre"> = do
  </span><a name="loc_80_3_80_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_3_80_4&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVarIO</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_46_19_46_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_24&#39;)"><span class="hl_conref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><a href="#loc_80_3_80_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_3_80_4&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |Return the contents of the &#39;TMVar&#39;.  If the &#39;TMVar&#39; is currently</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- empty, the transaction will &#39;retry&#39;.  After a &#39;takeTMVar&#39;, </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the &#39;TMVar&#39; is left empty.</span></span><span class="mpre">
</span><a href="#loc_87_1_87_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_1_87_10&#39;)"><span class="mpre">takeTMVar</span></a><span class="mpre"> :: </span><a href="#loc_46_9_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_14&#39;)"><span class="hl_tyconref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_87_1_87_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_1_87_10&#39;)"><span class="hl_fundecl"><span class="mpre">takeTMVar</span></span></a><span class="mpre"> (</span><a href="#loc_46_19_46_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_24&#39;)"><span class="hl_conref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><a name="loc_87_18_87_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_18_87_19&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre">) = do
  </span><a name="loc_88_3_88_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_3_88_4&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_87_18_87_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_18_87_19&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">
  case </span><a href="#loc_88_3_88_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_3_88_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> of
    </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">retry</span></span><span class="mpre">
    </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_91_10_91_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_10_91_11&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">  -&gt; do </span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_87_18_87_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_18_87_19&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_91_10_91_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_10_91_11&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A version of &#39;takeTMVar&#39; that does not &#39;retry&#39;.  The &#39;tryTakeTMVar&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- function returns &#39;Nothing&#39; if the &#39;TMVar&#39; was empty, or @&#39;Just&#39; a@ if</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the &#39;TMVar&#39; was full with contents @a@.  After &#39;tryTakeTMVar&#39;, the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;TMVar&#39; is left empty.</span></span><span class="mpre">
</span><a href="#loc_98_1_98_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_13&#39;)"><span class="mpre">tryTakeTMVar</span></a><span class="mpre"> :: </span><a href="#loc_46_9_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_14&#39;)"><span class="hl_tyconref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_98_1_98_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_13&#39;)"><span class="hl_fundecl"><span class="mpre">tryTakeTMVar</span></span></a><span class="mpre"> (</span><a href="#loc_46_19_46_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_24&#39;)"><span class="hl_conref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><a name="loc_98_21_98_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_21_98_22&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre">) = do
  </span><a name="loc_99_3_99_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_3_99_4&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_98_21_98_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_21_98_22&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">
  case </span><a href="#loc_99_3_99_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_3_99_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> of
    </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
    </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_102_10_102_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_10_102_11&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">  -&gt; do </span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_98_21_98_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_21_98_22&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_102_10_102_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_10_102_11&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |Put a value into a &#39;TMVar&#39;.  If the &#39;TMVar&#39; is currently full,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;putTMVar&#39; will &#39;retry&#39;.</span></span><span class="mpre">
</span><a href="#loc_107_1_107_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_1_107_9&#39;)"><span class="mpre">putTMVar</span></a><span class="mpre"> :: </span><a href="#loc_46_9_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_14&#39;)"><span class="hl_tyconref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_107_1_107_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_1_107_9&#39;)"><span class="hl_fundecl"><span class="mpre">putTMVar</span></span></a><span class="mpre"> (</span><a href="#loc_46_19_46_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_24&#39;)"><span class="hl_conref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><a name="loc_107_17_107_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_17_107_18&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre">) </span><a name="loc_107_20_107_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_20_107_21&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = do
  </span><a name="loc_108_3_108_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_3_108_4&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_107_17_107_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_17_107_18&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">
  case </span><a href="#loc_108_3_108_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_3_108_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> of
    </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; do </span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_107_17_107_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_17_107_18&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_107_20_107_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_20_107_21&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">); </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> _  -&gt; </span><span class="hl_varref"><span class="mpre">retry</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A version of &#39;putTMVar&#39; that does not &#39;retry&#39;.  The &#39;tryPutTMVar&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- function attempts to put the value @a@ into the &#39;TMVar&#39;, returning</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;True&#39; if it was successful, or &#39;False&#39; otherwise.</span></span><span class="mpre">
</span><a href="#loc_117_1_117_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_12&#39;)"><span class="mpre">tryPutTMVar</span></a><span class="mpre"> :: </span><a href="#loc_46_9_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_14&#39;)"><span class="hl_tyconref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_117_1_117_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_12&#39;)"><span class="hl_fundecl"><span class="mpre">tryPutTMVar</span></span></a><span class="mpre"> (</span><a href="#loc_46_19_46_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_24&#39;)"><span class="hl_conref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><a name="loc_117_20_117_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_20_117_21&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre">) </span><a name="loc_117_23_117_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_23_117_24&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = do
  </span><a name="loc_118_3_118_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_3_118_4&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_117_20_117_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_20_117_21&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">
  case </span><a href="#loc_118_3_118_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_3_118_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> of
    </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; do </span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_117_20_117_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_20_117_21&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_117_23_117_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_23_117_24&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">); </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
    </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> _  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | This is a combination of &#39;takeTMVar&#39; and &#39;putTMVar&#39;; ie. it</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- takes the value from the &#39;TMVar&#39;, puts it back, and also returns</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- it.</span></span><span class="mpre">
</span><a href="#loc_127_1_127_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_1_127_10&#39;)"><span class="mpre">readTMVar</span></a><span class="mpre"> :: </span><a href="#loc_46_9_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_14&#39;)"><span class="hl_tyconref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_127_1_127_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_1_127_10&#39;)"><span class="hl_fundecl"><span class="mpre">readTMVar</span></span></a><span class="mpre"> (</span><a href="#loc_46_19_46_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_24&#39;)"><span class="hl_conref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><a name="loc_127_18_127_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_18_127_19&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre">) = do
  </span><a name="loc_128_3_128_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_3_128_4&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_127_18_127_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_18_127_19&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">
  case </span><a href="#loc_128_3_128_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_3_128_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> of
    </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">retry</span></span><span class="mpre">
    </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_131_10_131_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_10_131_11&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_131_10_131_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_10_131_11&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A version of &#39;readTMVar&#39; which does not retry. Instead it</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- returns @Nothing@ if no value is available.</span></span><span class="mpre">
</span><a href="#loc_136_1_136_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_1_136_13&#39;)"><span class="mpre">tryReadTMVar</span></a><span class="mpre"> :: </span><a href="#loc_46_9_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_14&#39;)"><span class="hl_tyconref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_136_1_136_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_1_136_13&#39;)"><span class="hl_fundecl"><span class="mpre">tryReadTMVar</span></span></a><span class="mpre"> (</span><a href="#loc_46_19_46_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_24&#39;)"><span class="hl_conref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><a name="loc_136_21_136_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_21_136_22&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_136_21_136_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_21_136_22&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Swap the contents of a &#39;TMVar&#39; for a new value.</span></span><span class="mpre">
</span><a href="#loc_140_1_140_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_1_140_10&#39;)"><span class="mpre">swapTMVar</span></a><span class="mpre"> :: </span><a href="#loc_46_9_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_14&#39;)"><span class="hl_tyconref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_140_1_140_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_1_140_10&#39;)"><span class="hl_fundecl"><span class="mpre">swapTMVar</span></span></a><span class="mpre"> (</span><a href="#loc_46_19_46_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_24&#39;)"><span class="hl_conref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><a name="loc_140_18_140_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_18_140_19&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre">) </span><a name="loc_140_21_140_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_21_140_24&#39;)"><span class="hl_vardecl"><span class="mpre">new</span></span></a><span class="mpre"> = do
  </span><a name="loc_141_3_141_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_3_141_4&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_140_18_140_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_18_140_19&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">
  case </span><a href="#loc_141_3_141_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_3_141_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> of
    </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">retry</span></span><span class="mpre">
    </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_144_10_144_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_10_144_13&#39;)"><span class="hl_vardecl"><span class="mpre">old</span></span></a><span class="mpre"> -&gt; do </span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_140_18_140_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_18_140_19&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_140_21_140_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_21_140_24&#39;)"><span class="hl_varref"><span class="mpre">new</span></span></a><span class="mpre">); </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_144_10_144_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_10_144_13&#39;)"><span class="hl_varref"><span class="mpre">old</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Check whether a given &#39;TMVar&#39; is empty.</span></span><span class="mpre">
</span><a href="#loc_148_1_148_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_1_148_13&#39;)"><span class="mpre">isEmptyTMVar</span></a><span class="mpre"> :: </span><a href="#loc_46_9_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_14&#39;)"><span class="hl_tyconref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_148_1_148_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_1_148_13&#39;)"><span class="hl_fundecl"><span class="mpre">isEmptyTMVar</span></span></a><span class="mpre"> (</span><a href="#loc_46_19_46_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_24&#39;)"><span class="hl_conref"><span class="mpre">TMVar</span></span></a><span class="mpre"> </span><a name="loc_148_21_148_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_21_148_22&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre">) = do
  </span><a name="loc_149_3_149_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_3_149_4&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_148_21_148_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_21_148_22&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">
  case </span><a href="#loc_149_3_149_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_3_149_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> of
    </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
    </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> _  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
#endif
</span></div></body></html>