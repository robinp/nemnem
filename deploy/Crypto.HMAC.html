<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">{-|
 Maintainer: Thomas.DuBuisson@gmail.com
 Stability: beta
 Portability: portable
-}</span></span><span class="mpre">

module Crypto.HMAC
        ( hmac
        , hmac&#39;
        , MacKey(..)
        ) where

import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/HMAC.hs&quot;, srcSpanStartLine = 13, srcSpanStartColumn = 18, srcSpanEndLine = 13, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/HMAC.hs&quot;, srcSpanStartLine = 14, srcSpanStartColumn = 18, srcSpanEndLine = 14, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L
import Crypto.Classes
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/HMAC.hs&quot;, srcSpanStartLine = 16, srcSpanStartColumn = 8, srcSpanEndLine = 16, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Data.Serialize&quot;"><span class="mpre">Data.Serialize</span></span><span class="mpre"> (encode)
import Data.Bits (</span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="mpre">xor</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | A key carrying phantom types @c@ and @d@, forcing the key data to only be used</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- by particular hash algorithms.</span></span><span class="mpre">
newtype </span><a name="loc_21_9_21_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_9_21_15&#39;)"><span class="hl_tycondecl"><span class="mpre">MacKey</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">d</span></span><span class="mpre"> = </span><a name="loc_21_22_21_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_22_21_28&#39;)"><span class="hl_condecl"><span class="mpre">MacKey</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/HMAC.hs&quot;, srcSpanStartLine = 21, srcSpanStartColumn = 42, srcSpanEndLine = 21, srcSpanEndColumn = 66}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/HMAC.hs&quot;, srcSpanStartLine = 21, srcSpanStartColumn = 42, srcSpanEndLine = 21, srcSpanEndColumn = 50},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/HMAC.hs&quot;, srcSpanStartLine = 21, srcSpan"><span class="mpre">deriving (Eq, Ord, Show)</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Message authentication code calculation for lazy bytestrings.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @hmac k msg@ will compute an authentication code for @msg@ using key @k@</span></span><span class="mpre">
</span><a href="#loc_26_1_26_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_1_26_5&#39;)"><span class="mpre">hmac</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxParen (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/HMAC.hs&quot;, srcSpanStartLine = 25, srcSpanStartColumn = 9, srcSpanEndLine = 25, srcSpanEndColumn = 22}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/HMAC.hs&quot;, srcSpanStartLine = 25, srcSpanStartColumn = 9, srcSpanEndLine = 25, srcSpanEndColumn = 10},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/HMAC.hs&quot;, srcSpanStartLine = 25, srcSpanSta"><span class="mpre">(Hash c d) =&gt;</span></span><span class="mpre"> </span><a href="#loc_21_9_21_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_9_21_15&#39;)"><span class="hl_tyconref"><span class="mpre">MacKey</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">d</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">d</span></span><span class="mpre">
</span><a name="loc_26_1_26_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_1_26_5&#39;)"><span class="hl_fundecl"><span class="mpre">hmac</span></span></a><span class="mpre"> (</span><a href="#loc_21_22_21_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_22_21_28&#39;)"><span class="hl_conref"><span class="mpre">MacKey</span></span></a><span class="mpre"> </span><a name="loc_26_14_26_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_14_26_15&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre">) </span><a name="loc_26_17_26_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_17_26_20&#39;)"><span class="hl_vardecl"><span class="mpre">msg</span></span></a><span class="mpre"> = </span><a href="#loc_28_3_28_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_3_28_6&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">
  where
  </span><a name="loc_28_3_28_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_3_28_6&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> = </span><a href="Crypto.Classes.html#loc_102_3_102_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Classes.html#loc_102_3_102_8&#39;)"><span class="hl_varref"><span class="mpre">hash&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.append</span></span><span class="mpre"> </span><a href="#loc_36_3_36_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_3_36_5&#39;)"><span class="hl_varref"><span class="mpre">ko</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">encode</span></span><span class="mpre">  </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_29_3_29_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_3_29_4&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.append</span></span><span class="mpre"> </span><a href="#loc_37_3_37_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_3_37_5&#39;)"><span class="hl_varref"><span class="mpre">ki</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_26_17_26_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_17_26_20&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre">
  </span><a name="loc_29_3_29_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_3_29_4&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="Crypto.Classes.html#loc_114_1_114_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Classes.html#loc_114_1_114_9&#39;)"><span class="hl_varref"><span class="mpre">hashFunc</span></span></a><span class="mpre"> </span><a href="#loc_28_3_28_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_3_28_6&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">
  </span><a name="loc_30_3_30_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_3_30_9&#39;)"><span class="hl_vardecl"><span class="mpre">keylen</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_26_14_26_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_14_26_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">
  </span><a name="loc_31_3_31_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_3_31_7&#39;)"><span class="hl_vardecl"><span class="mpre">blen</span></span></a><span class="mpre"> = </span><a href="Crypto.Classes.html#loc_86_3_86_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Classes.html#loc_86_3_86_14&#39;)"><span class="hl_varref"><span class="mpre">blockLength</span></span></a><span class="mpre"> </span><a href="Crypto.Util.html#loc_50_1_50_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Util.html#loc_50_1_50_7&#39;)"><span class="hl_infix"><span class="mpre">.::.</span></span></a><span class="mpre"> </span><a href="#loc_28_3_28_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_3_28_6&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`div`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">
  </span><a name="loc_32_3_32_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_3_32_5&#39;)"><span class="hl_vardecl"><span class="mpre">k&#39;</span></span></a><span class="mpre"> = case </span><span class="hl_varref"><span class="mpre">compare</span></span><span class="mpre"> </span><a href="#loc_30_3_30_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_3_30_9&#39;)"><span class="hl_varref"><span class="mpre">keylen</span></span></a><span class="mpre"> </span><a href="#loc_31_3_31_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_3_31_7&#39;)"><span class="hl_varref"><span class="mpre">blen</span></span></a><span class="mpre"> of
         </span><span class="hl_conref"><span class="mpre">GT</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">B.append</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">encode</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_29_3_29_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_3_29_4&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_38_3_38_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_3_38_5&#39;)"><span class="hl_varref"><span class="mpre">fc</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_26_14_26_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_14_26_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">B.replicate</span></span><span class="mpre"> (</span><a href="#loc_31_3_31_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_3_31_7&#39;)"><span class="hl_varref"><span class="mpre">blen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> (</span><a href="Crypto.Classes.html#loc_85_3_85_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Classes.html#loc_85_3_85_15&#39;)"><span class="hl_varref"><span class="mpre">outputLength</span></span></a><span class="mpre"> </span><a href="Crypto.Util.html#loc_50_1_50_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Util.html#loc_50_1_50_7&#39;)"><span class="hl_infix"><span class="mpre">.::.</span></span></a><span class="mpre"> </span><a href="#loc_28_3_28_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_3_28_6&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`div`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">) ) </span><span class="hl_num"><span class="mpre">0x00</span></span><span class="mpre">)
         </span><span class="hl_conref"><span class="mpre">EQ</span></span><span class="mpre"> -&gt; </span><a href="#loc_26_14_26_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_14_26_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">
         </span><span class="hl_conref"><span class="mpre">LT</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">B.append</span></span><span class="mpre"> </span><a href="#loc_26_14_26_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_14_26_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.replicate</span></span><span class="mpre"> (</span><a href="#loc_31_3_31_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_3_31_7&#39;)"><span class="hl_varref"><span class="mpre">blen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_30_3_30_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_3_30_9&#39;)"><span class="hl_varref"><span class="mpre">keylen</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0x00</span></span><span class="mpre">)
  </span><a name="loc_36_3_36_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_3_36_5&#39;)"><span class="hl_vardecl"><span class="mpre">ko</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.map</span></span><span class="mpre"> (</span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="hl_infix"><span class="mpre">`xor`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x5c</span></span><span class="mpre">) </span><a href="#loc_32_3_32_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_3_32_5&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre">
  </span><a name="loc_37_3_37_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_3_37_5&#39;)"><span class="hl_vardecl"><span class="mpre">ki</span></span></a><span class="mpre"> = </span><a href="#loc_38_3_38_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_3_38_5&#39;)"><span class="hl_varref"><span class="mpre">fc</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.map</span></span><span class="mpre"> (</span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="hl_infix"><span class="mpre">`xor`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x36</span></span><span class="mpre">) </span><a href="#loc_32_3_32_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_3_32_5&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre">
  </span><a name="loc_38_3_38_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_3_38_5&#39;)"><span class="hl_vardecl"><span class="mpre">fc</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">L.fromChunks</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (\</span><a name="loc_38_25_38_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_25_38_26&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; [</span><a href="#loc_38_25_38_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_25_38_26&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">])

</span><span class="hl_comment"><span class="mpre">-- | @hmac k msg@ will compute an authentication code for @msg@ using key @k@</span></span><span class="mpre">
</span><a href="#loc_42_1_42_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_6&#39;)"><span class="mpre">hmac&#39;</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxParen (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/HMAC.hs&quot;, srcSpanStartLine = 41, srcSpanStartColumn = 10, srcSpanEndLine = 41, srcSpanEndColumn = 23}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/HMAC.hs&quot;, srcSpanStartLine = 41, srcSpanStartColumn = 10, srcSpanEndLine = 41, srcSpanEndColumn = 11},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/HMAC.hs&quot;, srcSpanStartLine = 41, srcSpanS"><span class="mpre">(Hash c d) =&gt;</span></span><span class="mpre"> </span><a href="#loc_21_9_21_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_9_21_15&#39;)"><span class="hl_tyconref"><span class="mpre">MacKey</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">d</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">d</span></span><span class="mpre">
</span><a name="loc_42_1_42_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_6&#39;)"><span class="hl_fundecl"><span class="mpre">hmac&#39;</span></span></a><span class="mpre"> </span><a name="loc_42_7_42_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_7_42_8&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = </span><a href="#loc_26_1_26_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_1_26_5&#39;)"><span class="hl_varref"><span class="mpre">hmac</span></span></a><span class="mpre"> </span><a href="#loc_42_7_42_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_7_42_8&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.fromChunks</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre">
</span></div></body></html>