<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE MagicHash #-}
{-# LANGUAGE BangPatterns #-}

</span><span class="hl_comment"><span class="mpre">-- Copyright     : Erik de Castro Lopo &lt;erikd@mega-nerd.com&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License       : BSD3</span></span><span class="mpre">

module Network.Wai.Handler.Warp.ReadInt (
    readInt
  , readInt64
  ) where

</span><span class="hl_comment"><span class="mpre">-- This function lives in its own file because the MagicHash pragma interacts</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- poorly with the CPP pragma.</span></span><span class="mpre">

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/ReadInt.hs&quot;, srcSpanStartLine = 16, srcSpanStartColumn = 8, srcSpanEndLine = 16, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/ReadInt.hs&quot;, srcSpanStartLine = 17, srcSpanStartColumn = 18, srcSpanEndLine = 17, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as S
import Data.Int (</span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="mpre">Int64</span></a><span class="mpre">)
import GHC.Prim
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/ReadInt.hs&quot;, srcSpanStartLine = 20, srcSpanStartColumn = 8, srcSpanEndLine = 20, srcSpanEndColumn = 17}, srcInfoPoints = []}) &quot;GHC.Types&quot;"><span class="mpre">GHC.Types</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/ReadInt.hs&quot;, srcSpanStartLine = 21, srcSpanStartColumn = 8, srcSpanEndLine = 21, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Word&quot;"><span class="mpre">GHC.Word</span></span><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_25_1_25_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_1_25_8&#39;)"><span class="mpre">readInt</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_25_1_25_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_1_25_8&#39;)"><span class="mpre">readInt</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/ReadInt.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 12, srcSpanEndLine = 24, srcSpanEndColumn = 25}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/ReadInt.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 23, srcSpanEndLine = 24, srcSpanEndColumn = 25}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/"><span class="mpre">Integral a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_25_1_25_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_1_25_8&#39;)"><span class="hl_fundecl"><span class="mpre">readInt</span></span></a><span class="mpre"> </span><a name="loc_25_9_25_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_9_25_11&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_37_1_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_1_37_10&#39;)"><span class="hl_varref"><span class="mpre">readInt64</span></span></a><span class="mpre"> </span><a href="#loc_25_9_25_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_9_25_11&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- This function is used to parse the Content-Length field of HTTP headers and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is a performance hot spot. It should only be replaced with something</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- significantly and provably faster.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- It needs to be able work correctly on 32 bit CPUs for file sizes &gt; 2G so we</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- use Int64 here and then make a generic &#39;readInt&#39; that allows conversion to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Int and Integer.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{- NOINLINE readInt64MH #-}</span></span><span class="mpre">
</span><a href="#loc_37_1_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_1_37_10&#39;)"><span class="mpre">readInt64</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre">
</span><a name="loc_37_1_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_1_37_10&#39;)"><span class="hl_fundecl"><span class="mpre">readInt64</span></span></a><span class="mpre"> </span><a name="loc_37_11_37_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_11_37_13&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.foldl&#39;</span></span><span class="mpre"> (\ !</span><a name="loc_37_29_37_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_29_37_30&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> !</span><a name="loc_37_32_37_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_32_37_33&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_37_29_37_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_29_37_30&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">10</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_44_1_44_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_13&#39;)"><span class="hl_varref"><span class="mpre">mhDigitToInt</span></span></a><span class="mpre"> </span><a href="#loc_37_32_37_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_32_37_33&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">)) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
             </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.takeWhile</span></span><span class="mpre"> </span><a href="#loc_67_1_67_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_8&#39;)"><span class="hl_varref"><span class="mpre">isDigit</span></span></a><span class="mpre"> </span><a href="#loc_37_11_37_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_11_37_13&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">

data </span><a name="loc_40_6_40_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_6_40_11&#39;)"><span class="hl_tycondecl"><span class="mpre">Table</span></span></a><span class="mpre"> = </span><a name="loc_40_14_40_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_14_40_19&#39;)"><span class="hl_condecl"><span class="mpre">Table</span></span></a><span class="mpre"> !</span><a href="GHC.Prim.html#loc_2279_6_2279_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2279_6_2279_11&#39;)"><span class="hl_tyconref"><span class="mpre">Addr#</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{- NOINLINE mhDigitToInt #-}</span></span><span class="mpre">
</span><a href="#loc_44_1_44_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_13&#39;)"><span class="mpre">mhDigitToInt</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_44_1_44_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_13&#39;)"><span class="hl_fundecl"><span class="mpre">mhDigitToInt</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">W8#</span></span><span class="mpre"> </span><a name="loc_44_19_44_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_19_44_20&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> (</span><a href="GHC.Prim.html#loc_1580_1_1580_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_1580_1_1580_10&#39;)"><span class="hl_varref"><span class="mpre">word2Int#</span></span></a><span class="mpre"> (</span><a href="GHC.Prim.html#loc_2370_1_2370_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2370_1_2370_19&#39;)"><span class="hl_varref"><span class="mpre">indexWord8OffAddr#</span></span></a><span class="mpre"> </span><a href="#loc_46_13_46_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_13_46_17&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre"> (</span><a href="GHC.Prim.html#loc_1580_1_1580_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_1580_1_1580_10&#39;)"><span class="hl_varref"><span class="mpre">word2Int#</span></span></a><span class="mpre"> </span><a href="#loc_44_19_44_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_19_44_20&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">)))
  where
    !(</span><a href="#loc_40_14_40_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_14_40_19&#39;)"><span class="hl_conref"><span class="mpre">Table</span></span></a><span class="mpre"> </span><a name="loc_46_13_46_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_13_46_17&#39;)"><span class="hl_vardecl"><span class="mpre">addr</span></span></a><span class="mpre">) = </span><a href="#loc_48_5_48_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_5_48_10&#39;)"><span class="hl_varref"><span class="mpre">table</span></span></a><span class="mpre">
    </span><a href="#loc_48_5_48_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_5_48_10&#39;)"><span class="mpre">table</span></a><span class="mpre"> :: </span><a href="#loc_40_6_40_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_6_40_11&#39;)"><span class="hl_tyconref"><span class="mpre">Table</span></span></a><span class="mpre">
    </span><a name="loc_48_5_48_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_5_48_10&#39;)"><span class="hl_vardecl"><span class="mpre">table</span></span></a><span class="mpre"> = </span><a href="#loc_40_14_40_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_14_40_19&#39;)"><span class="hl_conref"><span class="mpre">Table</span></span></a><span class="mpre">
        &quot;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
        \\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
        \\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
        \\x00\x01\x02\x03\x04\x05\x06\x07\x08\x09\x00\x00\x00\x00\x00\x00\
        \\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
        \\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
        \\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
        \\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
        \\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
        \\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
        \\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
        \\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
        \\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
        \\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
        \\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\
        \\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&quot;#

</span><a href="#loc_67_1_67_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_8&#39;)"><span class="mpre">isDigit</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_67_1_67_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_8&#39;)"><span class="hl_fundecl"><span class="mpre">isDigit</span></span></a><span class="mpre"> </span><a name="loc_67_9_67_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_9_67_10&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> = </span><a href="#loc_67_9_67_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_9_67_10&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">48</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_67_9_67_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_9_67_10&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">57</span></span><span class="mpre">
</span></div></body></html>