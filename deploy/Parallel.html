<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">{-
The parallel function (specialised to lists) is equivalent to:

import Control.Parallel.Strategies
parallel :: [IO [a]] -&gt; IO [[a]]
parallel = return . withStrategy (parList $ seqList r0) . map unsafePerformIO

However, this version performs about 10% slower with 2 processors in GHC 6.12.1
-}</span></span><span class="mpre">

module Parallel(parallel) where

import System.IO.Unsafe
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hlint-1.9/src/Parallel.hs&quot;, srcSpanStartLine = 14, srcSpanStartColumn = 8, srcSpanEndLine = 14, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Conc&quot;"><span class="mpre">GHC.Conc</span></span><span class="mpre">(numCapabilities)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hlint-1.9/src/Parallel.hs&quot;, srcSpanStartLine = 15, srcSpanStartColumn = 8, srcSpanEndLine = 15, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;Control.Concurrent&quot;"><span class="mpre">Control.Concurrent</span></span><span class="mpre">
import Control.Monad


</span><a href="#loc_20_1_20_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_1_20_9&#39;)"><span class="mpre">parallel</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">]
</span><a name="loc_20_1_20_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_1_20_9&#39;)"><span class="hl_vardecl"><span class="mpre">parallel</span></span></a><span class="mpre"> = if </span><span class="hl_varref"><span class="mpre">numCapabilities</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> then </span><a href="#loc_24_1_24_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_1_24_10&#39;)"><span class="hl_varref"><span class="mpre">parallel1</span></span></a><span class="mpre"> else </span><a href="#loc_32_1_32_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_1_32_10&#39;)"><span class="hl_varref"><span class="mpre">parallelN</span></span></a><span class="mpre">


</span><a href="#loc_24_1_24_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_1_24_10&#39;)"><span class="mpre">parallel1</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">]
</span><a name="loc_24_1_24_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_1_24_10&#39;)"><span class="hl_fundecl"><span class="mpre">parallel1</span></span></a><span class="mpre"> [] = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> []
</span><a href="#loc_24_1_24_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_1_24_10&#39;)"><span class="hl_fundecl"><span class="mpre">parallel1</span></span></a><span class="mpre"> (</span><a name="loc_25_12_25_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_12_25_13&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_25_14_25_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_14_25_16&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre">) = do
    </span><a name="loc_26_5_26_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_5_26_7&#39;)"><span class="hl_vardecl"><span class="mpre">x2</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_25_12_25_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_12_25_13&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
    </span><a name="loc_27_5_27_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_5_27_8&#39;)"><span class="hl_vardecl"><span class="mpre">xs2</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.html#loc_213_1_213_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_213_1_213_19&#39;)"><span class="hl_varref"><span class="mpre">unsafeInterleaveIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_24_1_24_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_1_24_10&#39;)"><span class="hl_varref"><span class="mpre">parallel1</span></span></a><span class="mpre"> </span><a href="#loc_25_14_25_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_14_25_16&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_26_5_26_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_5_26_7&#39;)"><span class="hl_varref"><span class="mpre">x2</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_27_5_27_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_5_27_8&#39;)"><span class="hl_varref"><span class="mpre">xs2</span></span></a><span class="mpre">


</span><a href="#loc_32_1_32_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_1_32_10&#39;)"><span class="mpre">parallelN</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">]
</span><a name="loc_32_1_32_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_1_32_10&#39;)"><span class="hl_fundecl"><span class="mpre">parallelN</span></span></a><span class="mpre"> </span><a name="loc_32_11_32_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_11_32_13&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre"> = do
    </span><a name="loc_33_5_33_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_5_33_7&#39;)"><span class="hl_vardecl"><span class="mpre">ms</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.html#loc_111_1_111_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_111_1_111_5&#39;)"><span class="hl_varref"><span class="mpre">mapM</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">newEmptyMVar</span></span><span class="mpre">) </span><a href="#loc_32_11_32_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_11_32_13&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">
    </span><a name="loc_34_5_34_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_5_34_9&#39;)"><span class="hl_vardecl"><span class="mpre">chan</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newChan</span></span><span class="mpre">
    </span><a href="Control.Monad.html#loc_116_1_116_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_116_1_116_6&#39;)"><span class="hl_varref"><span class="mpre">mapM_</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">writeChan</span></span><span class="mpre"> </span><a href="#loc_34_5_34_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_5_34_9&#39;)"><span class="hl_varref"><span class="mpre">chan</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">zip</span></span><span class="mpre"> </span><a href="#loc_33_5_33_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_5_33_7&#39;)"><span class="hl_varref"><span class="mpre">ms</span></span></a><span class="mpre"> </span><a href="#loc_32_11_32_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_11_32_13&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">
    </span><a href="Control.Monad.html#loc_254_1_254_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_254_1_254_12&#39;)"><span class="hl_varref"><span class="mpre">replicateM_</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">numCapabilities</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">writeChan</span></span><span class="mpre"> </span><a href="#loc_34_5_34_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_5_34_9&#39;)"><span class="hl_varref"><span class="mpre">chan</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">forkIO</span></span><span class="mpre"> (</span><a href="#loc_39_9_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_9_39_10&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_34_5_34_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_5_34_9&#39;)"><span class="hl_varref"><span class="mpre">chan</span></span></a><span class="mpre">))
    </span><a href="#loc_24_1_24_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_1_24_10&#39;)"><span class="hl_varref"><span class="mpre">parallel1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">takeMVar</span></span><span class="mpre"> </span><a href="#loc_33_5_33_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_5_33_7&#39;)"><span class="hl_varref"><span class="mpre">ms</span></span></a><span class="mpre">
    where
        </span><a name="loc_39_9_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_9_39_10&#39;)"><span class="hl_fundecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_39_11_39_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_11_39_15&#39;)"><span class="hl_vardecl"><span class="mpre">chan</span></span></a><span class="mpre"> = do
            </span><a name="loc_40_13_40_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_13_40_14&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readChan</span></span><span class="mpre"> </span><a href="#loc_39_11_39_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_11_39_15&#39;)"><span class="hl_varref"><span class="mpre">chan</span></span></a><span class="mpre">
            case </span><a href="#loc_40_13_40_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_13_40_14&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre"> of
                </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
                </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a name="loc_43_23_43_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_23_43_24&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">,</span><a name="loc_43_25_43_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_25_43_26&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">) -&gt; do
                    </span><a name="loc_44_21_44_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_21_44_23&#39;)"><span class="hl_vardecl"><span class="mpre">x&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_43_25_43_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_25_43_26&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
                    </span><span class="hl_varref"><span class="mpre">putMVar</span></span><span class="mpre"> </span><a href="#loc_43_23_43_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_23_43_24&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_44_21_44_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_21_44_23&#39;)"><span class="hl_varref"><span class="mpre">x&#39;</span></span></a><span class="mpre">
                    </span><a href="#loc_39_9_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_9_39_10&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_39_11_39_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_11_39_15&#39;)"><span class="hl_varref"><span class="mpre">chan</span></span></a><span class="mpre">
</span></div></body></html>