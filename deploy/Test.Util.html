<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE PatternGuards, ScopedTypeVariables, RecordWildCards, ViewPatterns #-}

module Test.Util(
        withTests, tested, passed, failed, progress
    ) where

import Data.IORef
import System.IO.Unsafe
import Control.Monad


data </span><a name="loc_12_6_12_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_6_12_12&#39;)"><span class="hl_tycondecl"><span class="mpre">Result</span></span></a><span class="mpre"> = </span><a name="loc_12_15_12_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_15_12_21&#39;)"><span class="hl_condecl"><span class="mpre">Result</span></span></a><span class="mpre"> {</span><a name="loc_12_23_12_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_23_12_31&#39;)"><span class="hl_fielddecl"><span class="mpre">failures</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">, </span><a name="loc_12_40_12_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_40_12_45&#39;)"><span class="hl_fielddecl"><span class="mpre">total</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">} </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hlint-1.9/src/Test/Util.hs&quot;, srcSpanStartLine = 12, srcSpanStartColumn = 54, srcSpanEndLine = 12, srcSpanEndColumn = 67}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hlint-1.9/src/Test/Util.hs&quot;, srcSpanStartLine = 12, srcSpanStartColumn = 54, srcSpanEndLine = 12, srcSpanEndColumn = 62}]}) [IHead (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hlint-1.9/src/Test/Util.hs&quot;, srcS"><span class="mpre">deriving Show</span></span><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_16_1_16_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_4&#39;)"><span class="mpre">ref</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_16_1_16_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_4&#39;)"><span class="mpre">ref</span></a><span class="mpre"> :: </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> [</span><a href="#loc_12_6_12_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_6_12_12&#39;)"><span class="hl_tyconref"><span class="mpre">Result</span></span></a><span class="mpre">]
</span><a name="loc_16_1_16_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_4&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> []


</span><span class="hl_comment"><span class="mpre">-- | Returns the number of failing tests.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   Warning: Not multithread safe, but is reenterant</span></span><span class="mpre">
</span><a href="#loc_22_1_22_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_1_22_10&#39;)"><span class="mpre">withTests</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_22_1_22_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_1_22_10&#39;)"><span class="hl_fundecl"><span class="mpre">withTests</span></span></a><span class="mpre"> </span><a name="loc_22_11_22_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_11_22_14&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> = do
    </span><a href="Data.IORef.html#loc_101_1_101_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_101_1_101_18&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef</span></span></a><span class="mpre"> </span><a href="#loc_16_1_16_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_4&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_23_30_23_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_30_23_31&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_12_15_12_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_15_12_21&#39;)"><span class="hl_conref"><span class="mpre">Result</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_23_30_23_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_30_23_31&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)
    </span><a href="#loc_22_11_22_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_11_22_14&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre">
    </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hlint-1.9/src/Test/Util.hs&quot;, srcSpanStartLine = 25, srcSpanStartColumn = 5, srcSpanEndLine = 25, srcSpanEndColumn = 15}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hlint-1.9/src/Test/Util.hs&quot;, srcSpanStartLine = 25, srcSpanStartColumn = 11, srcSpanEndLine = 25, srcSpanEndColumn = 12},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hlint-1.9/src/Test/Util.hs&quot;, srcSpanStartLine = 25, srcSpanStartColumn = 14,"><span class="mpre">Result{..}</span></span><span class="mpre"> &lt;- </span><a href="Data.IORef.html#loc_101_1_101_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_101_1_101_18&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef</span></span></a><span class="mpre"> </span><a href="#loc_16_1_16_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_4&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_25_45_25_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_45_25_46&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_25_47_25_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_47_25_49&#39;)"><span class="hl_vardecl"><span class="mpre">rs</span></span></a><span class="mpre">) -&gt; (</span><a href="#loc_25_47_25_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_47_25_49&#39;)"><span class="hl_varref"><span class="mpre">rs</span></span></a><span class="mpre">, </span><a href="#loc_25_45_25_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_45_25_46&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">putStrLn</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">putStrLn</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> if </span><a href="#loc_12_23_12_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_23_12_31&#39;)"><span class="hl_varref"><span class="mpre">failures</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
        then </span><span class="hl_string"><span class="mpre">&quot;Tests passed (&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_12_40_12_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_40_12_45&#39;)"><span class="hl_varref"><span class="mpre">total</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;)&quot;</span></span><span class="mpre">
        else </span><span class="hl_string"><span class="mpre">&quot;Tests failed (&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_12_23_12_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_23_12_31&#39;)"><span class="hl_varref"><span class="mpre">failures</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; of &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_12_40_12_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_40_12_45&#39;)"><span class="hl_varref"><span class="mpre">total</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;)&quot;</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_12_23_12_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_23_12_31&#39;)"><span class="hl_varref"><span class="mpre">failures</span></span></a><span class="mpre">

</span><a href="#loc_33_1_33_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_9&#39;)"><span class="mpre">progress</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_33_1_33_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_9&#39;)"><span class="hl_vardecl"><span class="mpre">progress</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">putChar</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;.&#39;</span></span><span class="mpre">

</span><a href="#loc_36_1_36_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_7&#39;)"><span class="mpre">passed</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_36_1_36_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_7&#39;)"><span class="hl_vardecl"><span class="mpre">passed</span></span></a><span class="mpre"> = do
        </span><a href="Data.IORef.html#loc_101_1_101_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_101_1_101_18&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef</span></span></a><span class="mpre"> </span><a href="#loc_16_1_16_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_4&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><span class="hl_vardecl"><span class="mpre">r</span></span><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_37_37_37_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_37_37_39&#39;)"><span class="hl_vardecl"><span class="mpre">rs</span></span></a><span class="mpre">) -&gt; (</span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hlint-1.9/src/Test/Util.hs&quot;, srcSpanStartLine = 37, srcSpanStartColumn = 45, srcSpanEndLine = 37, srcSpanEndColumn = 63}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hlint-1.9/src/Test/Util.hs&quot;, srcSpanStartLine = 37, srcSpanStartColumn = 46, srcSpanEndLine = 37, srcSpanEndColumn = 47},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hlint-1.9/src/Test/Util.hs&quot;, srcSpanStartLine = 37, srcSpanStartColumn"><span class="mpre">r{total=total r+1}</span></span><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_37_37_37_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_37_37_39&#39;)"><span class="hl_varref"><span class="mpre">rs</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)

</span><a href="#loc_40_1_40_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_1_40_7&#39;)"><span class="mpre">failed</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_40_1_40_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_1_40_7&#39;)"><span class="hl_fundecl"><span class="mpre">failed</span></span></a><span class="mpre"> </span><a name="loc_40_8_40_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_8_40_10&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre"> = do
        </span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="hl_varref"><span class="mpre">unless</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_40_8_40_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_8_40_10&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">putStrLn</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">unlines</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_40_8_40_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_8_40_10&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">
        </span><a href="Data.IORef.html#loc_101_1_101_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_101_1_101_18&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef</span></span></a><span class="mpre"> </span><a href="#loc_16_1_16_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_4&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><span class="hl_vardecl"><span class="mpre">r</span></span><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_42_37_42_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_37_42_39&#39;)"><span class="hl_vardecl"><span class="mpre">rs</span></span></a><span class="mpre">) -&gt; (</span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hlint-1.9/src/Test/Util.hs&quot;, srcSpanStartLine = 42, srcSpanStartColumn = 45, srcSpanEndLine = 42, srcSpanEndColumn = 86}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hlint-1.9/src/Test/Util.hs&quot;, srcSpanStartLine = 42, srcSpanStartColumn = 46, srcSpanEndLine = 42, srcSpanEndColumn = 47},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hlint-1.9/src/Test/Util.hs&quot;, srcSpanStartLine = 42, srcSpanStartColumn"><span class="mpre">r{total=total r+1, failures=failures r+1}</span></span><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_42_37_42_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_37_42_39&#39;)"><span class="hl_varref"><span class="mpre">rs</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)

</span><a href="#loc_45_1_45_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_7&#39;)"><span class="mpre">tested</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_45_1_45_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_7&#39;)"><span class="hl_fundecl"><span class="mpre">tested</span></span></a><span class="mpre"> </span><a name="loc_45_8_45_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_8_45_9&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = if </span><a href="#loc_45_8_45_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_8_45_9&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> then </span><a href="#loc_36_1_36_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_7&#39;)"><span class="hl_varref"><span class="mpre">passed</span></span></a><span class="mpre"> else </span><a href="#loc_40_1_40_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_1_40_7&#39;)"><span class="hl_varref"><span class="mpre">failed</span></span></a><span class="mpre"> []
</span></div></body></html>