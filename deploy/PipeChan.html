<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- create a similar concept than a unix pipe.</span></span><span class="mpre">
module PipeChan
    ( PipeChan(..)
    , newPipe
    , runPipe
    , readPipeA
    , readPipeB
    , writePipeA
    , writePipeB
    ) where

import Control.Applicative
import Control.Concurrent.Chan
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/PipeChan.hs&quot;, srcSpanStartLine = 14, srcSpanStartColumn = 8, srcSpanEndLine = 14, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;Control.Concurrent&quot;"><span class="mpre">Control.Concurrent</span></span><span class="mpre">
import Control.Monad (</span><a href="Control.Monad.html#loc_189_1_189_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_189_1_189_8&#39;)"><span class="mpre">forever</span></a><span class="mpre">)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/PipeChan.hs&quot;, srcSpanStartLine = 16, srcSpanStartColumn = 8, srcSpanEndLine = 16, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import Data.IORef
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/PipeChan.hs&quot;, srcSpanStartLine = 18, srcSpanStartColumn = 18, srcSpanEndLine = 18, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B

</span><span class="hl_comment"><span class="mpre">-- | represent a unidirectional pipe with a buffered read channel and a write channel</span></span><span class="mpre">
data </span><a name="loc_21_6_21_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_6_21_17&#39;)"><span class="hl_tycondecl"><span class="mpre">UniPipeChan</span></span></a><span class="mpre"> = </span><a name="loc_21_20_21_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_20_21_31&#39;)"><span class="hl_condecl"><span class="mpre">UniPipeChan</span></span></a><span class="mpre"> (</span><a href="Control.Concurrent.Chan.html#loc_51_6_51_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_51_6_51_10&#39;)"><span class="hl_tyconref"><span class="mpre">Chan</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">) (</span><a href="Control.Concurrent.Chan.html#loc_51_6_51_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_51_6_51_10&#39;)"><span class="hl_tyconref"><span class="mpre">Chan</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)

</span><a name="loc_23_1_23_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_15&#39;)"><span class="hl_vardecl"><span class="mpre">newUniPipeChan</span></span></a><span class="mpre"> = </span><a href="#loc_21_20_21_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_20_21_31&#39;)"><span class="hl_conref"><span class="mpre">UniPipeChan</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Control.Concurrent.Chan.html#loc_71_1_71_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_71_1_71_8&#39;)"><span class="hl_varref"><span class="mpre">newChan</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="Control.Concurrent.Chan.html#loc_71_1_71_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_71_1_71_8&#39;)"><span class="hl_varref"><span class="mpre">newChan</span></span></a><span class="mpre">

</span><a name="loc_25_1_25_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_1_25_11&#39;)"><span class="hl_fundecl"><span class="mpre">runUniPipe</span></span></a><span class="mpre"> (</span><a href="#loc_21_20_21_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_20_21_31&#39;)"><span class="hl_conref"><span class="mpre">UniPipeChan</span></span></a><span class="mpre"> </span><a name="loc_25_25_25_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_25_25_26&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> </span><a name="loc_25_27_25_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_27_25_28&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">forkIO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Monad.html#loc_189_1_189_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_189_1_189_8&#39;)"><span class="hl_varref"><span class="mpre">forever</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Concurrent.Chan.html#loc_103_1_103_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_103_1_103_9&#39;)"><span class="hl_varref"><span class="mpre">readChan</span></span></a><span class="mpre"> </span><a href="#loc_25_25_25_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_25_25_26&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Control.Concurrent.Chan.html#loc_84_1_84_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_84_1_84_10&#39;)"><span class="hl_varref"><span class="mpre">writeChan</span></span></a><span class="mpre"> </span><a href="#loc_25_27_25_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_27_25_28&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">

</span><a name="loc_27_1_27_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_1_27_15&#39;)"><span class="hl_fundecl"><span class="mpre">getReadUniPipe</span></span></a><span class="mpre"> (</span><a href="#loc_21_20_21_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_20_21_31&#39;)"><span class="hl_conref"><span class="mpre">UniPipeChan</span></span></a><span class="mpre"> </span><a name="loc_27_29_27_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_29_27_30&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> _)  = </span><a href="#loc_27_29_27_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_29_27_30&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
</span><a name="loc_28_1_28_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_1_28_16&#39;)"><span class="hl_fundecl"><span class="mpre">getWriteUniPipe</span></span></a><span class="mpre"> (</span><a href="#loc_21_20_21_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_20_21_31&#39;)"><span class="hl_conref"><span class="mpre">UniPipeChan</span></span></a><span class="mpre"> _ </span><a name="loc_28_32_28_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_32_28_33&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre">) = </span><a href="#loc_28_32_28_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_32_28_33&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Represent a bidirectional pipe with 2 nodes A and B</span></span><span class="mpre">
data </span><a name="loc_31_6_31_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_6_31_14&#39;)"><span class="hl_tycondecl"><span class="mpre">PipeChan</span></span></a><span class="mpre"> = </span><a name="loc_31_17_31_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_17_31_25&#39;)"><span class="hl_condecl"><span class="mpre">PipeChan</span></span></a><span class="mpre"> (</span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">) (</span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">) </span><a href="#loc_21_6_21_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_6_21_17&#39;)"><span class="hl_tyconref"><span class="mpre">UniPipeChan</span></span></a><span class="mpre"> </span><a href="#loc_21_6_21_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_6_21_17&#39;)"><span class="hl_tyconref"><span class="mpre">UniPipeChan</span></span></a><span class="mpre">

</span><a name="loc_33_1_33_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_8&#39;)"><span class="hl_vardecl"><span class="mpre">newPipe</span></span></a><span class="mpre"> = </span><a href="#loc_31_17_31_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_17_31_25&#39;)"><span class="hl_conref"><span class="mpre">PipeChan</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="#loc_23_1_23_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_15&#39;)"><span class="hl_varref"><span class="mpre">newUniPipeChan</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="#loc_23_1_23_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_15&#39;)"><span class="hl_varref"><span class="mpre">newUniPipeChan</span></span></a><span class="mpre">

</span><a name="loc_35_1_35_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_1_35_8&#39;)"><span class="hl_fundecl"><span class="mpre">runPipe</span></span></a><span class="mpre"> (</span><a href="#loc_31_17_31_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_17_31_25&#39;)"><span class="hl_conref"><span class="mpre">PipeChan</span></span></a><span class="mpre"> _ _ </span><a name="loc_35_23_35_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_23_35_27&#39;)"><span class="hl_vardecl"><span class="mpre">cToS</span></span></a><span class="mpre"> </span><a name="loc_35_28_35_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_28_35_32&#39;)"><span class="hl_vardecl"><span class="mpre">sToC</span></span></a><span class="mpre">) = </span><a href="#loc_25_1_25_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_1_25_11&#39;)"><span class="hl_varref"><span class="mpre">runUniPipe</span></span></a><span class="mpre"> </span><a href="#loc_35_23_35_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_23_35_27&#39;)"><span class="hl_varref"><span class="mpre">cToS</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_25_1_25_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_1_25_11&#39;)"><span class="hl_varref"><span class="mpre">runUniPipe</span></span></a><span class="mpre"> </span><a href="#loc_35_28_35_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_28_35_32&#39;)"><span class="hl_varref"><span class="mpre">sToC</span></span></a><span class="mpre">

</span><a name="loc_37_1_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_1_37_10&#39;)"><span class="hl_fundecl"><span class="mpre">readPipeA</span></span></a><span class="mpre"> (</span><a href="#loc_31_17_31_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_17_31_25&#39;)"><span class="hl_conref"><span class="mpre">PipeChan</span></span></a><span class="mpre"> _ </span><a name="loc_37_23_37_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_23_37_24&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> _ </span><a name="loc_37_27_37_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_27_37_28&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">) </span><a name="loc_37_30_37_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_30_37_32&#39;)"><span class="hl_vardecl"><span class="mpre">sz</span></span></a><span class="mpre"> = </span><a href="#loc_44_1_44_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_13&#39;)"><span class="hl_varref"><span class="mpre">readBuffered</span></span></a><span class="mpre"> </span><a href="#loc_37_23_37_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_23_37_24&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> (</span><a href="#loc_28_1_28_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_1_28_16&#39;)"><span class="hl_varref"><span class="mpre">getWriteUniPipe</span></span></a><span class="mpre"> </span><a href="#loc_37_27_37_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_27_37_28&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) </span><a href="#loc_37_30_37_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_30_37_32&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre">
</span><a name="loc_38_1_38_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_1_38_11&#39;)"><span class="hl_fundecl"><span class="mpre">writePipeA</span></span></a><span class="mpre"> (</span><a href="#loc_31_17_31_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_17_31_25&#39;)"><span class="hl_conref"><span class="mpre">PipeChan</span></span></a><span class="mpre"> _ _ </span><a name="loc_38_26_38_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_26_38_27&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> _)   = </span><a href="Control.Concurrent.Chan.html#loc_84_1_84_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_84_1_84_10&#39;)"><span class="hl_varref"><span class="mpre">writeChan</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_28_1_28_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_1_28_16&#39;)"><span class="hl_varref"><span class="mpre">getWriteUniPipe</span></span></a><span class="mpre"> </span><a href="#loc_38_26_38_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_26_38_27&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">

</span><a name="loc_40_1_40_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_1_40_10&#39;)"><span class="hl_fundecl"><span class="mpre">readPipeB</span></span></a><span class="mpre"> (</span><a href="#loc_31_17_31_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_17_31_25&#39;)"><span class="hl_conref"><span class="mpre">PipeChan</span></span></a><span class="mpre"> </span><a name="loc_40_21_40_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_21_40_22&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> _ </span><a name="loc_40_25_40_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_25_40_26&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> _) </span><a name="loc_40_30_40_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_30_40_32&#39;)"><span class="hl_vardecl"><span class="mpre">sz</span></span></a><span class="mpre"> = </span><a href="#loc_44_1_44_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_13&#39;)"><span class="hl_varref"><span class="mpre">readBuffered</span></span></a><span class="mpre"> </span><a href="#loc_40_21_40_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_21_40_22&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> (</span><a href="#loc_28_1_28_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_1_28_16&#39;)"><span class="hl_varref"><span class="mpre">getWriteUniPipe</span></span></a><span class="mpre"> </span><a href="#loc_40_25_40_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_25_40_26&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">) </span><a href="#loc_40_30_40_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_30_40_32&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre">
</span><a name="loc_41_1_41_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_11&#39;)"><span class="hl_fundecl"><span class="mpre">writePipeB</span></span></a><span class="mpre"> (</span><a href="#loc_31_17_31_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_17_31_25&#39;)"><span class="hl_conref"><span class="mpre">PipeChan</span></span></a><span class="mpre"> _ _ _ </span><a name="loc_41_28_41_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_28_41_29&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">)   = </span><a href="Control.Concurrent.Chan.html#loc_84_1_84_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_84_1_84_10&#39;)"><span class="hl_varref"><span class="mpre">writeChan</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_27_1_27_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_1_27_15&#39;)"><span class="hl_varref"><span class="mpre">getReadUniPipe</span></span></a><span class="mpre"> </span><a href="#loc_41_28_41_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_28_41_29&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- helper to read buffered data.</span></span><span class="mpre">
</span><a name="loc_44_1_44_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_13&#39;)"><span class="hl_fundecl"><span class="mpre">readBuffered</span></span></a><span class="mpre"> </span><a name="loc_44_14_44_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_14_44_17&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a name="loc_44_18_44_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_18_44_22&#39;)"><span class="hl_vardecl"><span class="mpre">chan</span></span></a><span class="mpre"> </span><a name="loc_44_23_44_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_23_44_25&#39;)"><span class="hl_vardecl"><span class="mpre">sz</span></span></a><span class="mpre"> = do
    </span><a name="loc_45_5_45_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_5_45_9&#39;)"><span class="hl_vardecl"><span class="mpre">left</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_44_14_44_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_14_44_17&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
    if </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_45_5_45_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_5_45_9&#39;)"><span class="hl_varref"><span class="mpre">left</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="#loc_44_23_44_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_23_44_25&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre">
        then do
            let (</span><a name="loc_48_18_48_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_18_48_21&#39;)"><span class="hl_vardecl"><span class="mpre">ret</span></span></a><span class="mpre">, </span><a name="loc_48_23_48_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_23_48_28&#39;)"><span class="hl_vardecl"><span class="mpre">nleft</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">B.splitAt</span></span><span class="mpre"> </span><a href="#loc_44_23_44_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_23_44_25&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre"> </span><a href="#loc_45_5_45_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_5_45_9&#39;)"><span class="hl_varref"><span class="mpre">left</span></span></a><span class="mpre">
            </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_44_14_44_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_14_44_17&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a href="#loc_48_23_48_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_23_48_28&#39;)"><span class="hl_varref"><span class="mpre">nleft</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_48_18_48_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_18_48_21&#39;)"><span class="hl_varref"><span class="mpre">ret</span></span></a><span class="mpre">
        else do
            let </span><a name="loc_52_17_52_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_24&#39;)"><span class="hl_vardecl"><span class="mpre">newSize</span></span></a><span class="mpre"> = (</span><a href="#loc_44_23_44_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_23_44_25&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_45_5_45_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_5_45_9&#39;)"><span class="hl_varref"><span class="mpre">left</span></span></a><span class="mpre">)
            </span><a name="loc_53_13_53_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_13_53_20&#39;)"><span class="hl_vardecl"><span class="mpre">newData</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Concurrent.Chan.html#loc_103_1_103_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_103_1_103_9&#39;)"><span class="hl_varref"><span class="mpre">readChan</span></span></a><span class="mpre"> </span><a href="#loc_44_18_44_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_18_44_22&#39;)"><span class="hl_varref"><span class="mpre">chan</span></span></a><span class="mpre">
            </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_44_14_44_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_14_44_17&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a href="#loc_53_13_53_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_13_53_20&#39;)"><span class="hl_varref"><span class="mpre">newData</span></span></a><span class="mpre">
            </span><a name="loc_55_13_55_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_13_55_19&#39;)"><span class="hl_vardecl"><span class="mpre">remain</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_44_1_44_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_13&#39;)"><span class="hl_varref"><span class="mpre">readBuffered</span></span></a><span class="mpre"> </span><a href="#loc_44_14_44_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_14_44_17&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a href="#loc_44_18_44_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_18_44_22&#39;)"><span class="hl_varref"><span class="mpre">chan</span></span></a><span class="mpre"> </span><a href="#loc_52_17_52_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_24&#39;)"><span class="hl_varref"><span class="mpre">newSize</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_45_5_45_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_5_45_9&#39;)"><span class="hl_varref"><span class="mpre">left</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`B.append`</span></span><span class="mpre"> </span><a href="#loc_55_13_55_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_13_55_19&#39;)"><span class="hl_varref"><span class="mpre">remain</span></span></a><span class="mpre">)
</span></div></body></html>