<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# OPTIONS -fglasgow-exts #-}

module GMapQAssoc (tests) where

</span><span class="hl_comment"><span class="mpre">{-

This example demonstrates the inadequacy of an apparently simpler
variation on gmapQ. To this end, let us first recall a few facts.
Firstly, function application (including constructor application) is
left-associative. This is the reason why we had preferred our generic
fold to be left-associative too. (In &quot;The Sketch Of a Polymorphic
Symphony&quot; you can find a right-associative generic fold.)  Secondly,
lists are right-associative. Because of these inverse associativities
queries for the synthesis of lists require some extra effort to
reflect the left-to-right of immediate subterms in the queried list.
In the module Data.Generics, we solve the problem by a common
higher-order trick, that is, we do not cons lists during folding but
we pass functions on lists starting from the identity function and
passing [] to the resulting function. The following example
illustrates that we get indeed an undesirable right-to-left order if
we just apply the simple constant datatype constructor CONST instead
of the higher-order trick.

Contributed by Ralf Laemmel, ralf@cwi.nl

-}</span></span><span class="mpre">

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GMapQAssoc.hs&quot;, srcSpanStartLine = 28, srcSpanStartColumn = 8, srcSpanEndLine = 28, srcSpanEndColumn = 18}, srcInfoPoints = []}) &quot;Test.HUnit&quot;"><span class="mpre">Test.HUnit</span></span><span class="mpre">

import Data.Generics


</span><span class="hl_comment"><span class="mpre">-- The plain constant type constructor</span></span><span class="mpre">
newtype </span><span class="hl_tycondecl"><span class="mpre">CONST</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">x</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">y</span></span><span class="mpre"> = </span><a name="loc_34_21_34_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_21_34_26&#39;)"><span class="hl_condecl"><span class="mpre">CONST</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">x</span></span><span class="mpre">
</span><a name="loc_35_1_35_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_1_35_8&#39;)"><span class="hl_fundecl"><span class="mpre">unCONST</span></span></a><span class="mpre"> (</span><a href="#loc_34_21_34_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_21_34_26&#39;)"><span class="hl_conref"><span class="mpre">CONST</span></span></a><span class="mpre"> </span><a name="loc_35_16_35_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_16_35_17&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">) = </span><a href="#loc_35_16_35_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_16_35_17&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- A variation on the gmapQ combinator using CONST and not Q</span></span><span class="mpre">
</span><a href="#loc_40_1_40_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_1_40_7&#39;)"><span class="mpre">gmapQ&#39;</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GMapQAssoc.hs&quot;, srcSpanStartLine = 39, srcSpanStartColumn = 11, srcSpanEndLine = 39, srcSpanEndColumn = 20}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GMapQAssoc.hs&quot;, srcSpanStartLine = 39, srcSpanStartColumn = 18, srcSpanEndLine = 39, srcSpanEndColumn = 20}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GMapQAssoc"><span class="mpre">Data a =&gt;</span></span><span class="mpre"> (forall </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">. </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GMapQAssoc.hs&quot;, srcSpanStartLine = 39, srcSpanStartColumn = 32, srcSpanEndLine = 39, srcSpanEndColumn = 41}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GMapQAssoc.hs&quot;, srcSpanStartLine = 39, srcSpanStartColumn = 39, srcSpanEndLine = 39, srcSpanEndColumn = 41}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GMapQAssoc"><span class="mpre">Data a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">u</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyvar"><span class="mpre">u</span></span><span class="mpre">]
</span><a name="loc_40_1_40_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_1_40_7&#39;)"><span class="hl_fundecl"><span class="mpre">gmapQ&#39;</span></span></a><span class="mpre"> </span><a name="loc_40_8_40_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_8_40_9&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_35_1_35_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_1_35_8&#39;)"><span class="hl_varref"><span class="mpre">unCONST</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">gfoldl</span></span><span class="mpre"> </span><a href="#loc_42_5_42_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_5_42_7&#39;)"><span class="hl_varref"><span class="mpre">f&#39;</span></span></a><span class="mpre"> </span><a href="#loc_43_5_43_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_5_43_6&#39;)"><span class="hl_varref"><span class="mpre">z</span></span></a><span class="mpre">
  where
    </span><a name="loc_42_5_42_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_5_42_7&#39;)"><span class="hl_fundecl"><span class="mpre">f&#39;</span></span></a><span class="mpre"> </span><a name="loc_42_8_42_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_8_42_9&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> </span><a name="loc_42_10_42_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_10_42_11&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = </span><a href="#loc_34_21_34_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_21_34_26&#39;)"><span class="hl_conref"><span class="mpre">CONST</span></span></a><span class="mpre"> (</span><a href="#loc_40_8_40_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_8_40_9&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_42_10_42_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_10_42_11&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_35_1_35_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_1_35_8&#39;)"><span class="hl_varref"><span class="mpre">unCONST</span></span></a><span class="mpre"> </span><a href="#loc_42_8_42_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_8_42_9&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">)
    </span><a name="loc_43_5_43_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_5_43_6&#39;)"><span class="hl_vardecl"><span class="mpre">z</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> (</span><a href="#loc_34_21_34_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_21_34_26&#39;)"><span class="hl_conref"><span class="mpre">CONST</span></span></a><span class="mpre"> [])


</span><span class="hl_comment"><span class="mpre">-- A trivial datatype used for this test case</span></span><span class="mpre">
data </span><a name="loc_47_6_47_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_6_47_13&#39;)"><span class="hl_tycondecl"><span class="mpre">IntTree</span></span></a><span class="mpre"> = </span><a name="loc_47_16_47_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_16_47_20&#39;)"><span class="hl_condecl"><span class="mpre">Leaf</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> | </span><a name="loc_47_27_47_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_27_47_31&#39;)"><span class="hl_condecl"><span class="mpre">Fork</span></span></a><span class="mpre"> </span><a href="#loc_47_6_47_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_6_47_13&#39;)"><span class="hl_tyconref"><span class="mpre">IntTree</span></span></a><span class="mpre"> </span><a href="#loc_47_6_47_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_6_47_13&#39;)"><span class="hl_tyconref"><span class="mpre">IntTree</span></span></a><span class="mpre">
               </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GMapQAssoc.hs&quot;, srcSpanStartLine = 48, srcSpanStartColumn = 16, srcSpanEndLine = 48, srcSpanEndColumn = 41}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GMapQAssoc.hs&quot;, srcSpanStartLine = 48, srcSpanStartColumn = 16, srcSpanEndLine = 48, srcSpanEndColumn = 24},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GMapQAssoc.hs&quot;, srcSpanStartLine = 48, srcSpanSta"><span class="mpre">deriving (Typeable, Data)</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- Select int if faced with a leaf </span></span><span class="mpre">
</span><a name="loc_52_1_52_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_5&#39;)"><span class="hl_fundecl"><span class="mpre">leaf</span></span></a><span class="mpre"> (</span><a href="#loc_47_16_47_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_16_47_20&#39;)"><span class="hl_conref"><span class="mpre">Leaf</span></span></a><span class="mpre"> </span><a name="loc_52_12_52_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_12_52_13&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">) = [</span><a href="#loc_52_12_52_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_12_52_13&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">]
</span><a href="#loc_52_1_52_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_5&#39;)"><span class="hl_fundecl"><span class="mpre">leaf</span></span></a><span class="mpre"> _        = []


</span><span class="hl_comment"><span class="mpre">-- A test term</span></span><span class="mpre">
</span><a name="loc_57_1_57_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_5&#39;)"><span class="hl_vardecl"><span class="mpre">term</span></span></a><span class="mpre"> = </span><a href="#loc_47_27_47_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_27_47_31&#39;)"><span class="hl_conref"><span class="mpre">Fork</span></span></a><span class="mpre"> (</span><a href="#loc_47_16_47_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_16_47_20&#39;)"><span class="hl_conref"><span class="mpre">Leaf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><a href="#loc_47_16_47_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_16_47_20&#39;)"><span class="hl_conref"><span class="mpre">Leaf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">-- Process test term</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  gmapQ  gives left-to-right order</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  gmapQ&#39; gives right-to-left order</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a name="loc_64_1_64_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_6&#39;)"><span class="hl_vardecl"><span class="mpre">tests</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> ( </span><span class="hl_varref"><span class="mpre">gmapQ</span></span><span class="mpre">   ([] </span><a href="Data.Generics.Aliases.html#loc_100_4_100_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Generics.Aliases.html#loc_100_4_100_9&#39;)"><span class="hl_infix"><span class="mpre">`mkQ`</span></span></a><span class="mpre"> </span><a href="#loc_52_1_52_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_5&#39;)"><span class="hl_varref"><span class="mpre">leaf</span></span></a><span class="mpre">) </span><a href="#loc_57_1_57_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_5&#39;)"><span class="hl_varref"><span class="mpre">term</span></span></a><span class="mpre">
             , </span><a href="#loc_40_1_40_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_1_40_7&#39;)"><span class="hl_varref"><span class="mpre">gmapQ&#39;</span></span></a><span class="mpre">  ([] </span><a href="Data.Generics.Aliases.html#loc_100_4_100_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Generics.Aliases.html#loc_100_4_100_9&#39;)"><span class="hl_infix"><span class="mpre">`mkQ`</span></span></a><span class="mpre"> </span><a href="#loc_52_1_52_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_5&#39;)"><span class="hl_varref"><span class="mpre">leaf</span></span></a><span class="mpre">) </span><a href="#loc_57_1_57_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_5&#39;)"><span class="hl_varref"><span class="mpre">term</span></span></a><span class="mpre">
             ) </span><span class="hl_infix"><span class="mpre">~=?</span></span><span class="mpre"> </span><a href="#loc_68_1_68_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_1_68_7&#39;)"><span class="hl_varref"><span class="mpre">output</span></span></a><span class="mpre">

</span><a name="loc_68_1_68_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_1_68_7&#39;)"><span class="hl_vardecl"><span class="mpre">output</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> ([[</span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">],[</span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">]],[[</span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">],[</span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">]])
</span></div></body></html>