<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE CPP #-}

module FdCacheSpec where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/test/FdCacheSpec.hs&quot;, srcSpanStartLine = 5, srcSpanStartColumn = 8, srcSpanEndLine = 5, srcSpanEndColumn = 18}, srcInfoPoints = []}) &quot;Test.Hspec&quot;"><span class="mpre">Test.Hspec</span></span><span class="mpre">
#ifdef SENDFILEFD
import Data.IORef
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/test/FdCacheSpec.hs&quot;, srcSpanStartLine = 8, srcSpanStartColumn = 8, srcSpanEndLine = 8, srcSpanEndColumn = 40}, srcInfoPoints = []}) &quot;Network.Wai.Handler.Warp.FdCache&quot;"><span class="mpre">Network.Wai.Handler.Warp.FdCache</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/test/FdCacheSpec.hs&quot;, srcSpanStartLine = 9, srcSpanStartColumn = 8, srcSpanEndLine = 9, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;System.Posix.IO&quot;"><span class="mpre">System.Posix.IO</span></span><span class="mpre"> (fdRead)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/test/FdCacheSpec.hs&quot;, srcSpanStartLine = 10, srcSpanStartColumn = 8, srcSpanEndLine = 10, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;System.Posix.Types&quot;"><span class="mpre">System.Posix.Types</span></span><span class="mpre"> (Fd(..))

</span><a href="#loc_13_1_13_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_13_1_13_5&#39;)"><span class="mpre">main</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_13_1_13_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_13_1_13_5&#39;)"><span class="hl_vardecl"><span class="mpre">main</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">hspec</span></span><span class="mpre"> </span><a href="#loc_16_1_16_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_5&#39;)"><span class="hl_varref"><span class="mpre">spec</span></span></a><span class="mpre">

</span><a href="#loc_16_1_16_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_5&#39;)"><span class="mpre">spec</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Spec</span></span><span class="mpre">
</span><a name="loc_16_1_16_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_5&#39;)"><span class="hl_vardecl"><span class="mpre">spec</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">describe</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;withFdCache&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;clean up Fd&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><a name="loc_18_9_18_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_9_18_12&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Fd</span></span><span class="mpre"> (-</span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">))
        </span><span class="hl_varref"><span class="mpre">withFdCache</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">30000000</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_19_39_19_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_39_19_42&#39;)"><span class="hl_vardecl"><span class="mpre">mfc</span></span></a><span class="mpre">) -&gt; do
            (</span><a name="loc_20_14_20_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_14_20_16&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre">,_) &lt;- </span><span class="hl_varref"><span class="mpre">getFd</span></span><span class="mpre"> </span><a href="#loc_19_39_19_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_39_19_42&#39;)"><span class="hl_varref"><span class="mpre">mfc</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;warp.cabal&quot;</span></span><span class="mpre">
            </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_18_9_18_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_9_18_12&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><a href="#loc_20_14_20_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_14_20_16&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">
        </span><a name="loc_22_9_22_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_9_22_12&#39;)"><span class="hl_vardecl"><span class="mpre">nfd</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_18_9_18_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_9_18_12&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">fdRead</span></span><span class="mpre"> </span><a href="#loc_22_9_22_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_9_22_12&#39;)"><span class="hl_varref"><span class="mpre">nfd</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldThrow`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">anyIOException</span></span><span class="mpre">
#else
</span><a href="#loc_16_1_16_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_5&#39;)"><span class="mpre">spec</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Spec</span></span><span class="mpre">
</span><span class="hl_vardecl"><span class="mpre">spec</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
#endif
</span></div></body></html>