<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE CPP #-}
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Network.HTTP.Proxy</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  See LICENSE file</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  Ganesh Sittampalam &lt;ganesh@earth.li&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (not tested)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Handling proxy server settings and their resolution.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
module Network.HTTP.Proxy
       ( Proxy(..)
       , noProxy     </span><span class="hl_comment"><span class="mpre">-- :: Proxy</span></span><span class="mpre">
       , fetchProxy  </span><span class="hl_comment"><span class="mpre">-- :: Bool -&gt; IO Proxy</span></span><span class="mpre">
       , parseProxy  </span><span class="hl_comment"><span class="mpre">-- :: String -&gt; Maybe Proxy</span></span><span class="mpre">
       ) where

</span><span class="hl_comment"><span class="mpre">{-
#if !defined(WIN32) &amp;&amp; defined(mingw32_HOST_OS)
#define WIN32 1
#endif
-}</span></span><span class="mpre">

import Control.Monad ( </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_130_4_130_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_130_4_130_9&#39;)"><span class="mpre">mplus</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_204_1_204_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_204_1_204_5&#39;)"><span class="mpre">join</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_283_1_283_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_283_1_283_7&#39;)"><span class="mpre">liftM2</span></a><span class="mpre">)

#if defined(WIN32)
import Network.HTTP.Base ( </span><a href="Network.HTTP.Base.html#loc_988_1_988_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_988_1_988_8&#39;)"><span class="mpre">catchIO</span></a><span class="mpre"> )
#endif
import Network.HTTP.Utils ( </span><a href="Network.HTTP.Utils.html#loc_96_1_96_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Utils.html#loc_96_1_96_14&#39;)"><span class="mpre">dropWhileTail</span></a><span class="mpre">, </span><a href="Network.HTTP.Utils.html#loc_108_1_108_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Utils.html#loc_108_1_108_12&#39;)"><span class="mpre">chopAtDelim</span></a><span class="mpre"> )
import Network.HTTP.Auth
import Network.URI
   ( </span><a href="Network.URI.html#loc_153_6_153_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.URI.html#loc_153_6_153_9&#39;)"><span class="mpre">URI</span></a><span class="mpre">(..), </span><a href="Network.URI.html#loc_162_6_162_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.URI.html#loc_162_6_162_13&#39;)"><span class="mpre">URIAuth</span></a><span class="mpre">(..), </span><a href="Network.URI.html#loc_246_1_246_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.URI.html#loc_246_1_246_17&#39;)"><span class="mpre">parseAbsoluteURI</span></a><span class="mpre">, </span><a href="Network.URI.html#loc_944_1_944_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.URI.html#loc_944_1_944_15&#39;)"><span class="mpre">unEscapeString</span></a><span class="mpre"> )
import System.IO ( hPutStrLn, </span><a href="GHC.IO.Handle.FD.html#loc_74_1_74_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.FD.html#loc_74_1_74_7&#39;)"><span class="mpre">stderr</span></a><span class="mpre"> )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpanStartLine = 38, srcSpanStartColumn = 8, srcSpanEndLine = 38, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;System.Environment&quot;"><span class="mpre">System.Environment</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-
#if !defined(WIN32) &amp;&amp; defined(mingw32_HOST_OS)
#define WIN32 1
#endif
-}</span></span><span class="mpre">

#if defined(WIN32)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpanStartLine = 47, srcSpanStartColumn = 8, srcSpanEndLine = 47, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;System.Win32.Types&quot;"><span class="mpre">System.Win32.Types</span></span><span class="mpre">   ( DWORD, HKEY )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpanStartLine = 48, srcSpanStartColumn = 8, srcSpanEndLine = 48, srcSpanEndColumn = 29}, srcInfoPoints = []}) &quot;System.Win32.Registry&quot;"><span class="mpre">System.Win32.Registry</span></span><span class="mpre">( hKEY_CURRENT_USER, regOpenKey, regCloseKey, regQueryValue, regQueryValueEx )
import Control.Exception    ( </span><a href="Control.Exception.Base.html#loc_259_1_259_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_259_1_259_8&#39;)"><span class="mpre">bracket</span></a><span class="mpre"> )
import Foreign              ( </span><a href="Foreign.Marshal.Utils.html#loc_103_1_103_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Utils.html#loc_103_1_103_7&#39;)"><span class="mpre">toBool</span></a><span class="mpre">, Storable(peek, sizeOf), castPtr, </span><a href="Foreign.Marshal.Alloc.html#loc_107_1_107_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_107_1_107_7&#39;)"><span class="mpre">alloca</span></a><span class="mpre"> )
#endif

</span><span class="hl_comment"><span class="mpre">-- | HTTP proxies (or not) are represented via &#39;Proxy&#39;, specifying if a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- proxy should be used for the request (see &#39;Network.Browser.setProxy&#39;)</span></span><span class="mpre">
data </span><a name="loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tycondecl"><span class="mpre">Proxy</span></span></a><span class="mpre"> 
 = </span><a name="loc_56_4_56_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_4_56_11&#39;)"><span class="hl_condecl"><span class="mpre">NoProxy</span></span></a><span class="mpre">                 </span><span class="hl_comment"><span class="mpre">-- ^ Don&#39;t use a proxy.</span></span><span class="mpre">
 | </span><a name="loc_57_4_57_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_4_57_9&#39;)"><span class="hl_condecl"><span class="mpre">Proxy</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
         (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.HTTP.Auth.html#loc_41_6_41_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Auth.html#loc_41_6_41_15&#39;)"><span class="hl_tyconref"><span class="mpre">Authority</span></span></a><span class="mpre">) </span><span class="hl_comment"><span class="mpre">-- ^ Use the proxy given. Should be of the</span></span><span class="mpre">
                           </span><span class="hl_comment"><span class="mpre">-- form &quot;http:\/\/host:port&quot;, &quot;host&quot;, &quot;host:port&quot;, or &quot;http:\/\/host&quot;.</span></span><span class="mpre">
                           </span><span class="hl_comment"><span class="mpre">-- Additionally, an optional &#39;Authority&#39; for authentication with the proxy.</span></span><span class="mpre">


</span><a href="#loc_64_1_64_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_8&#39;)"><span class="mpre">noProxy</span></a><span class="mpre"> :: </span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">Proxy</span></span></a><span class="mpre">
</span><a name="loc_64_1_64_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_8&#39;)"><span class="hl_vardecl"><span class="mpre">noProxy</span></span></a><span class="mpre"> = </span><a href="#loc_56_4_56_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_4_56_11&#39;)"><span class="hl_conref"><span class="mpre">NoProxy</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | @envProxyString@ locates proxy server settings by looking</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- up env variable @HTTP_PROXY@ (or its lower-case equivalent.)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If no mapping found, returns @Nothing@.</span></span><span class="mpre">
</span><a href="#loc_70_1_70_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_1_70_15&#39;)"><span class="mpre">envProxyString</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">)
</span><a name="loc_70_1_70_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_1_70_15&#39;)"><span class="hl_vardecl"><span class="mpre">envProxyString</span></span></a><span class="mpre"> = do
  </span><a name="loc_71_3_71_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_3_71_6&#39;)"><span class="hl_vardecl"><span class="mpre">env</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getEnvironment</span></span><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;http_proxy&quot;</span></span><span class="mpre"> </span><a href="#loc_71_3_71_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_3_71_6&#39;)"><span class="hl_varref"><span class="mpre">env</span></span></a><span class="mpre"> </span><a href="Control.Monad.html#loc_130_4_130_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_130_4_130_9&#39;)"><span class="hl_infix"><span class="mpre">`mplus`</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;HTTP_PROXY&quot;</span></span><span class="mpre"> </span><a href="#loc_71_3_71_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_3_71_6&#39;)"><span class="hl_varref"><span class="mpre">env</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | @proxyString@ tries to locate the user&#39;s proxy server setting.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Consults environment variable, and in case of Windows, by querying</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the Registry (cf. @registryProxyString@.)</span></span><span class="mpre">
</span><a href="#loc_78_1_78_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_12&#39;)"><span class="mpre">proxyString</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">)
</span><a name="loc_78_1_78_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_12&#39;)"><span class="hl_vardecl"><span class="mpre">proxyString</span></span></a><span class="mpre"> = </span><a href="Control.Monad.html#loc_283_1_283_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_283_1_283_7&#39;)"><span class="hl_varref"><span class="mpre">liftM2</span></span></a><span class="mpre"> </span><a href="Control.Monad.html#loc_130_4_130_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_130_4_130_9&#39;)"><span class="hl_varref"><span class="mpre">mplus</span></span></a><span class="mpre"> </span><a href="#loc_70_1_70_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_1_70_15&#39;)"><span class="hl_varref"><span class="mpre">envProxyString</span></span></a><span class="mpre"> </span><a href="#loc_82_1_82_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_1_82_20&#39;)"><span class="hl_varref"><span class="mpre">registryProxyString</span></span></a><span class="mpre">

</span><a href="#loc_82_1_82_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_1_82_20&#39;)"><span class="mpre">registryProxyString</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">)
#if !defined(WIN32)
</span><a name="loc_82_1_82_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_1_82_20&#39;)"><span class="hl_vardecl"><span class="mpre">registryProxyString</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
#else
</span><a href="#loc_85_1_85_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_17&#39;)"><span class="mpre">registryProxyLoc</span></a><span class="mpre"> :: (</span><span class="hl_tyconref"><span class="mpre">HKEY</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">)
</span><a name="loc_85_1_85_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_17&#39;)"><span class="hl_vardecl"><span class="mpre">registryProxyLoc</span></span></a><span class="mpre"> = (</span><a href="#loc_92_5_92_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_9&#39;)"><span class="hl_varref"><span class="mpre">hive</span></span></a><span class="mpre">, </span><a href="#loc_93_5_93_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_5_93_9&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre">)
  where
    </span><span class="hl_comment"><span class="mpre">-- some sources say proxy settings should be at </span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">--                   \CurrentVersion\Internet Settings\ProxyServer</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- but if the user sets them with IE connection panel they seem to</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- end up in the following place:</span></span><span class="mpre">
    </span><a name="loc_92_5_92_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_9&#39;)"><span class="hl_vardecl"><span class="mpre">hive</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">hKEY_CURRENT_USER</span></span><span class="mpre">
    </span><a name="loc_93_5_93_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_5_93_9&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings&quot;</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- read proxy settings from the windows registry; this is just a best</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- effort and may not work on all setups. </span></span><span class="mpre">
</span><span class="hl_vardecl"><span class="mpre">registryProxyString</span></span><span class="mpre"> = </span><a href="Network.HTTP.Base.html#loc_988_1_988_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Base.html#loc_988_1_988_8&#39;)"><span class="hl_varref"><span class="mpre">catchIO</span></span></a><span class="mpre">
  (</span><a href="Control.Exception.Base.html#loc_259_1_259_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_259_1_259_8&#39;)"><span class="hl_varref"><span class="mpre">bracket</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">uncurry</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">regOpenKey</span></span><span class="mpre"> </span><a href="#loc_85_1_85_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_17&#39;)"><span class="hl_varref"><span class="mpre">registryProxyLoc</span></span></a><span class="mpre">) </span><span class="hl_varref"><span class="mpre">regCloseKey</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_98_65_98_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_65_98_69&#39;)"><span class="hl_vardecl"><span class="mpre">hkey</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_99_5_99_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_5_99_11&#39;)"><span class="hl_vardecl"><span class="mpre">enable</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> </span><a href="Foreign.Marshal.Utils.html#loc_103_1_103_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Utils.html#loc_103_1_103_7&#39;)"><span class="hl_varref"><span class="mpre">toBool</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_174_1_174_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_1_174_19&#39;)"><span class="hl_varref"><span class="mpre">regQueryValueDWORD</span></span></a><span class="mpre"> </span><a href="#loc_98_65_98_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_65_98_69&#39;)"><span class="hl_varref"><span class="mpre">hkey</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;ProxyEnable&quot;</span></span><span class="mpre">
    if </span><a href="#loc_99_5_99_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_5_99_11&#39;)"><span class="hl_varref"><span class="mpre">enable</span></span></a><span class="mpre">
        then </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">regQueryValue</span></span><span class="mpre"> </span><a href="#loc_98_65_98_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_65_98_69&#39;)"><span class="hl_varref"><span class="mpre">hkey</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;ProxyServer&quot;</span></span><span class="mpre">)
        else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">)
  (\_ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">)
#endif

</span><span class="hl_comment"><span class="mpre">-- | @fetchProxy flg@ gets the local proxy settings and parse the string</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- into a @Proxy@ value. If you want to be informed of ill-formed proxy</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- configuration strings, supply @True@ for @flg@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Proxy settings are sourced from the @HTTP_PROXY@ environment variable,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- and in the case of Windows platforms, by consulting IE/WinInet&#39;s proxy</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- setting in the Registry.</span></span><span class="mpre">
</span><a href="#loc_113_1_113_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_1_113_11&#39;)"><span class="mpre">fetchProxy</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">Proxy</span></span></a><span class="mpre">
</span><a name="loc_113_1_113_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_1_113_11&#39;)"><span class="hl_fundecl"><span class="mpre">fetchProxy</span></span></a><span class="mpre"> </span><a name="loc_113_12_113_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_12_113_27&#39;)"><span class="hl_vardecl"><span class="mpre">warnIfIllformed</span></span></a><span class="mpre"> = do
  </span><a name="loc_114_3_114_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_3_114_7&#39;)"><span class="hl_vardecl"><span class="mpre">mstr</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_78_1_78_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_12&#39;)"><span class="hl_varref"><span class="mpre">proxyString</span></span></a><span class="mpre">
  case </span><a href="#loc_114_3_114_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_3_114_7&#39;)"><span class="hl_varref"><span class="mpre">mstr</span></span></a><span class="mpre"> of
    </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">     -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_56_4_56_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_4_56_11&#39;)"><span class="hl_conref"><span class="mpre">NoProxy</span></span></a><span class="mpre">
    </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_117_10_117_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_10_117_13&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre">    -&gt; case </span><a href="#loc_130_1_130_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_11&#39;)"><span class="hl_varref"><span class="mpre">parseProxy</span></span></a><span class="mpre"> </span><a href="#loc_117_10_117_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_10_117_13&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_118_14_118_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_14_118_15&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_118_14_118_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_14_118_15&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">                   
        </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; do
            </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_113_12_113_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_12_113_27&#39;)"><span class="hl_varref"><span class="mpre">warnIfIllformed</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">System.IO.hPutStrLn</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.FD.html#loc_74_1_74_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.FD.html#loc_74_1_74_7&#39;)"><span class="hl_varref"><span class="mpre">System.IO.stderr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">unlines</span></span><span class="mpre">
                    [ </span><span class="hl_string"><span class="mpre">&quot;invalid http proxy uri: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_117_10_117_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_10_117_13&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
                    , </span><span class="hl_string"><span class="mpre">&quot;proxy uri must be http with a hostname&quot;</span></span><span class="mpre">
                    , </span><span class="hl_string"><span class="mpre">&quot;ignoring http proxy, trying a direct connection&quot;</span></span><span class="mpre">
                    ]
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_56_4_56_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_4_56_11&#39;)"><span class="hl_conref"><span class="mpre">NoProxy</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | @parseProxy str@ translates a proxy server string into a @Proxy@ value;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- returns @Nothing@ if not well-formed.</span></span><span class="mpre">
</span><a href="#loc_130_1_130_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_11&#39;)"><span class="mpre">parseProxy</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">Proxy</span></span></a><span class="mpre">
</span><a name="loc_130_1_130_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_11&#39;)"><span class="hl_fundecl"><span class="mpre">parseProxy</span></span></a><span class="mpre"> </span><a name="loc_130_12_130_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_12_130_15&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> = </span><a href="Control.Monad.html#loc_204_1_204_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_204_1_204_5&#39;)"><span class="hl_varref"><span class="mpre">join</span></span></a><span class="mpre">
                   </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> </span><a href="#loc_157_1_157_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_1_157_10&#39;)"><span class="hl_varref"><span class="mpre">uri2proxy</span></span></a><span class="mpre">
                   </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_135_4_135_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_4_135_16&#39;)"><span class="hl_varref"><span class="mpre">parseHttpURI</span></span></a><span class="mpre"> </span><a href="#loc_130_12_130_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_12_130_15&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
             </span><a href="Control.Monad.html#loc_130_4_130_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_130_4_130_9&#39;)"><span class="hl_infix"><span class="mpre">`mplus`</span></span></a><span class="mpre"> </span><a href="#loc_135_4_135_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_4_135_16&#39;)"><span class="hl_varref"><span class="mpre">parseHttpURI</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;http://&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_130_12_130_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_12_130_15&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">)
  where
   </span><a name="loc_135_4_135_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_4_135_16&#39;)"><span class="hl_fundecl"><span class="mpre">parseHttpURI</span></span></a><span class="mpre"> </span><a name="loc_135_17_135_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_17_135_21&#39;)"><span class="hl_vardecl"><span class="mpre">str&#39;</span></span></a><span class="mpre"> =
    case </span><a href="Network.URI.html#loc_246_1_246_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.URI.html#loc_246_1_246_17&#39;)"><span class="hl_varref"><span class="mpre">parseAbsoluteURI</span></span></a><span class="mpre"> </span><a href="#loc_135_17_135_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_17_135_21&#39;)"><span class="hl_varref"><span class="mpre">str&#39;</span></span></a><span class="mpre"> of
      </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_137_12_137_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_12_137_15&#39;)"><span class="hl_specname"><span class="mpre">uri</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpanStartLine = 137, srcSpanStartColumn = 16, srcSpanEndLine = 137, srcSpanEndColumn = 42}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpanStartLine = 137, srcSpanStartColumn = 19, srcSpanEndLine = 137, srcSpanEndColumn = 20},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpanStart"><span class="mpre">URI{uriAuthority = Just{}}</span></span><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a href="#loc_151_1_151_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_1_151_12&#39;)"><span class="hl_varref"><span class="mpre">fixUserInfo</span></span></a><span class="mpre"> </span><a href="#loc_137_12_137_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_12_137_15&#39;)"><span class="hl_varref"><span class="mpre">uri</span></span></a><span class="mpre">)
      _  -&gt; </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">

     </span><span class="hl_comment"><span class="mpre">-- Note: we need to be able to parse non-URIs like @\&quot;wwwcache.example.com:80\&quot;@</span></span><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">-- which lack the @\&quot;http://\&quot;@ URI scheme. The problem is that</span></span><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">-- @\&quot;wwwcache.example.com:80\&quot;@ is in fact a valid URI but with scheme</span></span><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">-- @\&quot;wwwcache.example.com:\&quot;@, no authority part and a path of @\&quot;80\&quot;@.</span></span><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">-- So our strategy is to try parsing as normal uri first and if it lacks the</span></span><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">-- &#39;uriAuthority&#39; then we try parsing again with a @\&quot;http://\&quot;@ prefix.</span></span><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | tidy up user portion, don&#39;t want the trailing &quot;\@&quot;.</span></span><span class="mpre">
</span><a href="#loc_151_1_151_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_1_151_12&#39;)"><span class="mpre">fixUserInfo</span></a><span class="mpre"> :: </span><a href="Network.URI.html#loc_153_6_153_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.URI.html#loc_153_6_153_9&#39;)"><span class="hl_tyconref"><span class="mpre">URI</span></span></a><span class="mpre"> -&gt; </span><a href="Network.URI.html#loc_153_6_153_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.URI.html#loc_153_6_153_9&#39;)"><span class="hl_tyconref"><span class="mpre">URI</span></span></a><span class="mpre">
</span><a name="loc_151_1_151_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_1_151_12&#39;)"><span class="hl_fundecl"><span class="mpre">fixUserInfo</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">uri</span></span><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpanStartLine = 151, srcSpanStartColumn = 19, srcSpanEndLine = 151, srcSpanEndColumn = 66}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpanStartLine = 151, srcSpanStartColumn = 22, srcSpanEndLine = 151, srcSpanEndColumn = 23},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpan"><span class="mpre">uri{ uriAuthority = f `fmap` uriAuthority uri }</span></span><span class="mpre">
  where
   </span><span class="hl_fundecl"><span class="mpre">f</span></span><span class="mpre"> </span><span class="hl_specname"><span class="mpre">a</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpanStartLine = 153, srcSpanStartColumn = 8, srcSpanEndLine = 153, srcSpanEndColumn = 30}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpanStartLine = 153, srcSpanStartColumn = 15, srcSpanEndLine = 153, srcSpanEndColumn = 16},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpanStartL"><span class="mpre">URIAuth{uriUserInfo=s}</span></span><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpanStartLine = 153, srcSpanStartColumn = 33, srcSpanEndLine = 153, srcSpanEndColumn = 71}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpanStartLine = 153, srcSpanStartColumn = 34, srcSpanEndLine = 153, srcSpanEndColumn = 35},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpan"><span class="mpre">a{uriUserInfo=dropWhileTail (==&#39;@&#39;) s}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><a href="#loc_157_1_157_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_1_157_10&#39;)"><span class="mpre">uri2proxy</span></a><span class="mpre"> :: </span><a href="Network.URI.html#loc_153_6_153_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.URI.html#loc_153_6_153_9&#39;)"><span class="hl_tyconref"><span class="mpre">URI</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">Proxy</span></span></a><span class="mpre">
</span><a name="loc_157_1_157_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_1_157_10&#39;)"><span class="hl_fundecl"><span class="mpre">uri2proxy</span></span></a><span class="mpre"> </span><a name="loc_157_11_157_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_11_157_14&#39;)"><span class="hl_specname"><span class="mpre">uri</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpanStartLine = 157, srcSpanStartColumn = 15, srcSpanEndLine = 159, srcSpanEndColumn = 19}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpanStartLine = 157, srcSpanStartColumn = 18, srcSpanEndLine = 157, srcSpanEndColumn = 19},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/Network/HTTP/Proxy.hs&quot;, srcSpanStart"><span class="mpre">URI{ uriScheme    = &quot;http:&quot;
                 , uriAuthority = Just (URIAuth auth&#39; hst prt)
                 }</span></span><span class="mpre"> =
 </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a href="#loc_57_4_57_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_4_57_9&#39;)"><span class="hl_conref"><span class="mpre">Proxy</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">hst</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">prt</span></span><span class="mpre">) </span><a href="#loc_162_4_162_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_4_162_8&#39;)"><span class="hl_varref"><span class="mpre">auth</span></span></a><span class="mpre">)
  where
   </span><a name="loc_162_4_162_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_4_162_8&#39;)"><span class="hl_vardecl"><span class="mpre">auth</span></span></a><span class="mpre"> =
     case </span><span class="hl_varref"><span class="mpre">auth&#39;</span></span><span class="mpre"> of
       [] -&gt; </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
       </span><a name="loc_165_8_165_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_8_165_10&#39;)"><span class="hl_vardecl"><span class="mpre">as</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">AuthBasic</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre"> (</span><a href="Network.URI.html#loc_944_1_944_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.URI.html#loc_944_1_944_15&#39;)"><span class="hl_varref"><span class="mpre">unEscapeString</span></span></a><span class="mpre"> </span><a href="#loc_167_11_167_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_11_167_14&#39;)"><span class="hl_varref"><span class="mpre">usr</span></span></a><span class="mpre">) (</span><a href="Network.URI.html#loc_944_1_944_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.URI.html#loc_944_1_944_15&#39;)"><span class="hl_varref"><span class="mpre">unEscapeString</span></span></a><span class="mpre"> </span><a href="#loc_167_15_167_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_15_167_18&#39;)"><span class="hl_varref"><span class="mpre">pwd</span></span></a><span class="mpre">) </span><a href="#loc_157_11_157_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_11_157_14&#39;)"><span class="hl_varref"><span class="mpre">uri</span></span></a><span class="mpre">)
        where
         (</span><a name="loc_167_11_167_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_11_167_14&#39;)"><span class="hl_vardecl"><span class="mpre">usr</span></span></a><span class="mpre">,</span><a name="loc_167_15_167_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_15_167_18&#39;)"><span class="hl_vardecl"><span class="mpre">pwd</span></span></a><span class="mpre">) = </span><a href="Network.HTTP.Utils.html#loc_108_1_108_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Utils.html#loc_108_1_108_12&#39;)"><span class="hl_varref"><span class="mpre">chopAtDelim</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;:&#39;</span></span><span class="mpre"> </span><a href="#loc_165_8_165_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_8_165_10&#39;)"><span class="hl_varref"><span class="mpre">as</span></span></a><span class="mpre">

</span><a href="#loc_157_1_157_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_1_157_10&#39;)"><span class="hl_fundecl"><span class="mpre">uri2proxy</span></span></a><span class="mpre"> _ = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- utilities</span></span><span class="mpre">
#if defined(WIN32)
</span><a href="#loc_174_1_174_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_1_174_19&#39;)"><span class="mpre">regQueryValueDWORD</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">HKEY</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">DWORD</span></span><span class="mpre">
</span><a name="loc_174_1_174_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_1_174_19&#39;)"><span class="hl_fundecl"><span class="mpre">regQueryValueDWORD</span></span></a><span class="mpre"> </span><a name="loc_174_20_174_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_20_174_24&#39;)"><span class="hl_vardecl"><span class="mpre">hkey</span></span></a><span class="mpre"> </span><a name="loc_174_25_174_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_25_174_29&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre"> = </span><a href="Foreign.Marshal.Alloc.html#loc_107_1_107_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_107_1_107_7&#39;)"><span class="hl_varref"><span class="mpre">alloca</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_174_42_174_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_42_174_45&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> -&gt; do
  </span><span class="hl_comment"><span class="mpre">-- TODO: this throws away the key type returned by regQueryValueEx</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- we should check it&#39;s what we expect instead</span></span><span class="mpre">
  _ &lt;- </span><span class="hl_varref"><span class="mpre">regQueryValueEx</span></span><span class="mpre"> </span><a href="#loc_174_20_174_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_20_174_24&#39;)"><span class="hl_varref"><span class="mpre">hkey</span></span></a><span class="mpre"> </span><a href="#loc_174_25_174_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_25_174_29&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_174_42_174_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_42_174_45&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">DWORD</span></span><span class="mpre">))
  </span><span class="hl_varref"><span class="mpre">peek</span></span><span class="mpre"> </span><a href="#loc_174_42_174_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_42_174_45&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">

#endif
</span></div></body></html>