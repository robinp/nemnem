<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Trustworthy #-}
{-# LANGUAGE CPP, NoImplicitPrelude #-}
{-# OPTIONS_GHC -funbox-strict-fields #-}

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  GHC.IO.Buffer</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow 2008</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  see libraries/base/LICENSE</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  cvs-ghc@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  internal</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (GHC Extensions)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Buffers used in the IO system</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module GHC.IO.Buffer (
    </span><span class="hl_comment"><span class="mpre">-- * Buffers of any element</span></span><span class="mpre">
    Buffer(..), BufferState(..), CharBuffer, CharBufElem,

    </span><span class="hl_comment"><span class="mpre">-- ** Creation</span></span><span class="mpre">
    newByteBuffer,
    newCharBuffer,
    newBuffer,
    emptyBuffer,

    </span><span class="hl_comment"><span class="mpre">-- ** Insertion/removal</span></span><span class="mpre">
    bufferRemove,
    bufferAdd,
    slideContents,
    bufferAdjustL,

    </span><span class="hl_comment"><span class="mpre">-- ** Inspecting</span></span><span class="mpre">
    isEmptyBuffer,
    isFullBuffer,
    isFullCharBuffer,
    isWriteBuffer,
    bufferElems,
    bufferAvailable,
    summaryBuffer,

    </span><span class="hl_comment"><span class="mpre">-- ** Operating on the raw buffer as a Ptr</span></span><span class="mpre">
    withBuffer,
    withRawBuffer,

    </span><span class="hl_comment"><span class="mpre">-- ** Assertions</span></span><span class="mpre">
    checkBuffer,

    </span><span class="hl_comment"><span class="mpre">-- * Raw buffers</span></span><span class="mpre">
    RawBuffer,
    readWord8Buf,
    writeWord8Buf,
    RawCharBuffer,
    peekCharBuf,
    readCharBuf,
    writeCharBuf,
    readCharBufPtr,
    writeCharBufPtr,
    charSize,
 ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 64, srcSpanStartColumn = 8, srcSpanEndLine = 64, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- import GHC.IO</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 66, srcSpanStartColumn = 8, srcSpanEndLine = 66, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;GHC.Num&quot;"><span class="mpre">GHC.Num</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 67, srcSpanStartColumn = 8, srcSpanEndLine = 67, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;GHC.Ptr&quot;"><span class="mpre">GHC.Ptr</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 68, srcSpanStartColumn = 8, srcSpanEndLine = 68, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Word&quot;"><span class="mpre">GHC.Word</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 69, srcSpanStartColumn = 8, srcSpanEndLine = 69, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Show&quot;"><span class="mpre">GHC.Show</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 70, srcSpanStartColumn = 8, srcSpanEndLine = 70, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Real&quot;"><span class="mpre">GHC.Real</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 71, srcSpanStartColumn = 8, srcSpanEndLine = 71, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Foreign.C.Types&quot;"><span class="mpre">Foreign.C.Types</span></span><span class="mpre">
import Foreign.ForeignPtr
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 73, srcSpanStartColumn = 8, srcSpanEndLine = 73, srcSpanEndColumn = 24}, srcInfoPoints = []}) &quot;Foreign.Storable&quot;"><span class="mpre">Foreign.Storable</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Char buffers use either UTF-16 or UTF-32, with the endianness matching</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the endianness of the host.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Invariants:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   * a Char buffer consists of *valid* UTF-16 or UTF-32</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   * only whole characters: no partial surrogate pairs</span></span><span class="mpre">

#define CHARBUF_UTF32

</span><span class="hl_comment"><span class="mpre">-- #define CHARBUF_UTF16</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- NB. it won&#39;t work to just change this to CHARBUF_UTF16.  Some of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the code to make this work is there, and it has been tested with</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the Iconv codec, but there are some pieces that are known to be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- broken.  In particular, the built-in codecs</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- e.g. GHC.IO.Encoding.UTF{8,16,32} need to use isFullCharBuffer or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- similar in place of the ow &gt;= os comparisons.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Raw blocks of data</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 96, srcSpanStartColumn = 1, srcSpanEndLine = 96, srcSpanEndColumn = 32}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 96, srcSpanStartColumn = 1, srcSpanEndLine = 96, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 96, srcSpanStartC"><span class="mpre">type RawBuffer e = ForeignPtr e</span></span><span class="mpre">

</span><a href="#loc_99_1_99_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_13&#39;)"><span class="mpre">readWord8Buf</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">RawBuffer</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">
</span><a name="loc_99_1_99_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_13&#39;)"><span class="hl_fundecl"><span class="mpre">readWord8Buf</span></span></a><span class="mpre"> </span><a name="loc_99_14_99_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_14_99_17&#39;)"><span class="hl_vardecl"><span class="mpre">arr</span></span></a><span class="mpre"> </span><a name="loc_99_18_99_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_18_99_20&#39;)"><span class="hl_vardecl"><span class="mpre">ix</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> </span><a href="#loc_99_14_99_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_14_99_17&#39;)"><span class="hl_varref"><span class="mpre">arr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_99_45_99_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_45_99_46&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">peekByteOff</span></span><span class="mpre"> </span><a href="#loc_99_45_99_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_45_99_46&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_99_18_99_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_18_99_20&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="mpre">

</span><a href="#loc_102_1_102_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_1_102_14&#39;)"><span class="mpre">writeWord8Buf</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">RawBuffer</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_102_1_102_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_1_102_14&#39;)"><span class="hl_fundecl"><span class="mpre">writeWord8Buf</span></span></a><span class="mpre"> </span><a name="loc_102_15_102_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_15_102_18&#39;)"><span class="hl_vardecl"><span class="mpre">arr</span></span></a><span class="mpre"> </span><a name="loc_102_19_102_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_19_102_21&#39;)"><span class="hl_vardecl"><span class="mpre">ix</span></span></a><span class="mpre"> </span><a name="loc_102_22_102_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_22_102_23&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> </span><a href="#loc_102_15_102_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_15_102_18&#39;)"><span class="hl_varref"><span class="mpre">arr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_102_48_102_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_48_102_49&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">pokeByteOff</span></span><span class="mpre"> </span><a href="#loc_102_48_102_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_48_102_49&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_102_19_102_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_19_102_21&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="mpre"> </span><a href="#loc_102_22_102_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_22_102_23&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">

#ifdef CHARBUF_UTF16
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 105, srcSpanStartColumn = 1, srcSpanEndLine = 105, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 105, srcSpanStartColumn = 1, srcSpanEndLine = 105, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 105, srcSpanS"><span class="mpre">type CharBufElem = Word16</span></span><span class="mpre">
#else
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 107, srcSpanStartColumn = 1, srcSpanEndLine = 107, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 107, srcSpanStartColumn = 1, srcSpanEndLine = 107, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 107, srcSpanS"><span class="mpre">type CharBufElem = Char</span></span><span class="mpre">
#endif

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 110, srcSpanStartColumn = 1, srcSpanEndLine = 110, srcSpanEndColumn = 43}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 110, srcSpanStartColumn = 1, srcSpanEndLine = 110, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 110, srcSpanS"><span class="mpre">type RawCharBuffer = RawBuffer CharBufElem</span></span><span class="mpre">

</span><a href="#loc_113_1_113_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_1_113_12&#39;)"><span class="mpre">peekCharBuf</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">RawCharBuffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">
</span><a name="loc_113_1_113_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_1_113_12&#39;)"><span class="hl_fundecl"><span class="mpre">peekCharBuf</span></span></a><span class="mpre"> </span><a name="loc_113_13_113_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_13_113_16&#39;)"><span class="hl_vardecl"><span class="mpre">arr</span></span></a><span class="mpre"> </span><a name="loc_113_17_113_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_17_113_19&#39;)"><span class="hl_vardecl"><span class="mpre">ix</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> </span><a href="#loc_113_13_113_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_13_113_16&#39;)"><span class="hl_varref"><span class="mpre">arr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_113_44_113_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_44_113_45&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; do
                        (</span><a name="loc_114_26_114_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_26_114_27&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre">,_) &lt;- </span><a href="#loc_128_1_128_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_1_128_15&#39;)"><span class="hl_varref"><span class="mpre">readCharBufPtr</span></span></a><span class="mpre"> </span><a href="#loc_113_44_113_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_44_113_45&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_113_17_113_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_17_113_19&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="mpre">
                        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_114_26_114_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_26_114_27&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_119_1_119_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_12&#39;)"><span class="mpre">readCharBuf</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_119_1_119_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_12&#39;)"><span class="mpre">readCharBuf</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">RawCharBuffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)
</span><a name="loc_119_1_119_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_12&#39;)"><span class="hl_fundecl"><span class="mpre">readCharBuf</span></span></a><span class="mpre"> </span><a name="loc_119_13_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_13_119_16&#39;)"><span class="hl_vardecl"><span class="mpre">arr</span></span></a><span class="mpre"> </span><a name="loc_119_17_119_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_17_119_19&#39;)"><span class="hl_vardecl"><span class="mpre">ix</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> </span><a href="#loc_119_13_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_13_119_16&#39;)"><span class="hl_varref"><span class="mpre">arr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_119_44_119_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_44_119_45&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_128_1_128_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_1_128_15&#39;)"><span class="hl_varref"><span class="mpre">readCharBufPtr</span></span></a><span class="mpre"> </span><a href="#loc_119_44_119_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_44_119_45&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_119_17_119_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_17_119_19&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_123_1_123_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_13&#39;)"><span class="mpre">writeCharBuf</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_123_1_123_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_13&#39;)"><span class="mpre">writeCharBuf</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">RawCharBuffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_123_1_123_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_13&#39;)"><span class="hl_fundecl"><span class="mpre">writeCharBuf</span></span></a><span class="mpre"> </span><a name="loc_123_14_123_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_14_123_17&#39;)"><span class="hl_vardecl"><span class="mpre">arr</span></span></a><span class="mpre"> </span><a name="loc_123_18_123_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_18_123_20&#39;)"><span class="hl_vardecl"><span class="mpre">ix</span></span></a><span class="mpre"> </span><a name="loc_123_21_123_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_21_123_22&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> </span><a href="#loc_123_14_123_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_14_123_17&#39;)"><span class="hl_varref"><span class="mpre">arr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_123_47_123_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_47_123_48&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_142_1_142_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_16&#39;)"><span class="hl_varref"><span class="mpre">writeCharBufPtr</span></span></a><span class="mpre"> </span><a href="#loc_123_47_123_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_47_123_48&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_123_18_123_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_18_123_20&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="mpre"> </span><a href="#loc_123_21_123_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_21_123_22&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_128_1_128_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_1_128_15&#39;)"><span class="mpre">readCharBufPtr</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_128_1_128_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_1_128_15&#39;)"><span class="mpre">readCharBufPtr</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CharBufElem</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)
#ifdef CHARBUF_UTF16
</span><a name="loc_128_1_128_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_1_128_15&#39;)"><span class="hl_fundecl"><span class="mpre">readCharBufPtr</span></span></a><span class="mpre"> </span><a name="loc_128_16_128_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_16_128_17&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_128_18_128_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_18_128_20&#39;)"><span class="hl_vardecl"><span class="mpre">ix</span></span></a><span class="mpre"> = do
  </span><a name="loc_129_3_129_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_3_129_5&#39;)"><span class="hl_vardecl"><span class="mpre">c1</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekElemOff</span></span><span class="mpre"> </span><a href="#loc_128_16_128_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_16_128_17&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_128_18_128_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_18_128_20&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="mpre">
  if (</span><a href="#loc_129_3_129_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_3_129_5&#39;)"><span class="hl_varref"><span class="mpre">c1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xd800</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><a href="#loc_129_3_129_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_3_129_5&#39;)"><span class="hl_varref"><span class="mpre">c1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xdbff</span></span><span class="mpre">)
     then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">chr</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_129_3_129_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_3_129_5&#39;)"><span class="hl_varref"><span class="mpre">c1</span></span></a><span class="mpre">), </span><a href="#loc_128_18_128_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_18_128_20&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
     else do </span><a name="loc_132_14_132_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_14_132_16&#39;)"><span class="hl_vardecl"><span class="mpre">c2</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekElemOff</span></span><span class="mpre"> </span><a href="#loc_128_16_128_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_16_128_17&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> (</span><a href="#loc_128_18_128_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_18_128_20&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
             </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">unsafeChr</span></span><span class="mpre"> ((</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_129_3_129_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_3_129_5&#39;)"><span class="hl_varref"><span class="mpre">c1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xd800</span></span><span class="mpre">)</span><span class="hl_infix"><span class="mpre">*</span></span><span class="hl_num"><span class="mpre">0x400</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre">
                                (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_132_14_132_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_14_132_16&#39;)"><span class="hl_varref"><span class="mpre">c2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xdc00</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x10000</span></span><span class="mpre">), </span><a href="#loc_128_18_128_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_18_128_20&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">)
#else
</span><a href="#loc_128_1_128_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_1_128_15&#39;)"><span class="hl_fundecl"><span class="mpre">readCharBufPtr</span></span></a><span class="mpre"> </span><a name="loc_136_16_136_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_16_136_17&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_136_18_136_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_18_136_20&#39;)"><span class="hl_vardecl"><span class="mpre">ix</span></span></a><span class="mpre"> = do </span><a name="loc_136_26_136_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_26_136_27&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekElemOff</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_136_16_136_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_16_136_17&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">) </span><a href="#loc_136_18_136_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_18_136_20&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="mpre">; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_136_26_136_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_26_136_27&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">, </span><a href="#loc_136_18_136_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_18_136_20&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
#endif

</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_142_1_142_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_16&#39;)"><span class="mpre">writeCharBufPtr</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_142_1_142_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_16&#39;)"><span class="mpre">writeCharBufPtr</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CharBufElem</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
#ifdef CHARBUF_UTF16
</span><a name="loc_142_1_142_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_16&#39;)"><span class="hl_fundecl"><span class="mpre">writeCharBufPtr</span></span></a><span class="mpre"> </span><a name="loc_142_17_142_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_17_142_18&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_142_19_142_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_19_142_21&#39;)"><span class="hl_vardecl"><span class="mpre">ix</span></span></a><span class="mpre"> </span><a name="loc_142_22_142_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_22_142_24&#39;)"><span class="hl_vardecl"><span class="mpre">ch</span></span></a><span class="mpre">
  | </span><a href="#loc_150_5_150_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_5_150_6&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x10000</span></span><span class="mpre"> = do </span><span class="hl_varref"><span class="mpre">pokeElemOff</span></span><span class="mpre"> </span><a href="#loc_142_17_142_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_17_142_18&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_142_19_142_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_19_142_21&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_150_5_150_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_5_150_6&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">)
                     </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_142_19_142_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_19_142_21&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">   = do let </span><a name="loc_145_26_145_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_26_145_28&#39;)"><span class="hl_vardecl"><span class="mpre">c&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_150_5_150_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_5_150_6&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x10000</span></span><span class="mpre">
                     </span><span class="hl_varref"><span class="mpre">pokeElemOff</span></span><span class="mpre"> </span><a href="#loc_142_17_142_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_17_142_18&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_142_19_142_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_19_142_21&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_145_26_145_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_26_145_28&#39;)"><span class="hl_varref"><span class="mpre">c&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`div`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x400</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xd800</span></span><span class="mpre">))
                     </span><span class="hl_varref"><span class="mpre">pokeElemOff</span></span><span class="mpre"> </span><a href="#loc_142_17_142_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_17_142_18&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> (</span><a href="#loc_142_19_142_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_19_142_21&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_145_26_145_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_26_145_28&#39;)"><span class="hl_varref"><span class="mpre">c&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`mod`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x400</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xdc00</span></span><span class="mpre">))
                     </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_142_19_142_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_19_142_21&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">)
  where
    </span><a name="loc_150_5_150_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_5_150_6&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">ord</span></span><span class="mpre"> </span><a href="#loc_142_22_142_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_22_142_24&#39;)"><span class="hl_varref"><span class="mpre">ch</span></span></a><span class="mpre">
#else
</span><a href="#loc_142_1_142_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_16&#39;)"><span class="hl_fundecl"><span class="mpre">writeCharBufPtr</span></span></a><span class="mpre"> </span><a name="loc_152_17_152_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_17_152_18&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_152_19_152_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_19_152_21&#39;)"><span class="hl_vardecl"><span class="mpre">ix</span></span></a><span class="mpre"> </span><a name="loc_152_22_152_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_22_152_24&#39;)"><span class="hl_vardecl"><span class="mpre">ch</span></span></a><span class="mpre"> = do </span><span class="hl_varref"><span class="mpre">pokeElemOff</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_152_17_152_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_17_152_18&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">) </span><a href="#loc_152_19_152_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_19_152_21&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="mpre"> </span><a href="#loc_152_22_152_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_22_152_24&#39;)"><span class="hl_varref"><span class="mpre">ch</span></span></a><span class="mpre">; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_152_19_152_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_19_152_21&#39;)"><span class="hl_varref"><span class="mpre">ix</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
#endif

</span><a href="#loc_157_1_157_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_1_157_9&#39;)"><span class="mpre">charSize</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
#ifdef CHARBUF_UTF16
</span><a name="loc_157_1_157_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_1_157_9&#39;)"><span class="hl_vardecl"><span class="mpre">charSize</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">
#else
</span><span class="hl_vardecl"><span class="mpre">charSize</span></span><span class="mpre"> = </span><span class="hl_num"><span class="mpre">4</span></span><span class="mpre">
#endif

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Buffers</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A mutable array of bytes that can be passed to foreign functions.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The buffer is represented by a record, where the record contains</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the raw buffer and the start/end points of the filled portion.  The</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- buffer contents itself is mutable, but the rest of the record is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- immutable.  This is a slightly odd mix, but it turns out to be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- quite practical: by making all the buffer metadata immutable, we</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- can have operations on buffer metadata outside of the IO monad.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The &quot;live&quot; elements of the buffer are those between the &#39;bufL&#39; and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;bufR&#39; offsets.  In an empty buffer, &#39;bufL&#39; is equal to &#39;bufR&#39;, but</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- they might not be zero: for exmaple, the buffer might correspond to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a memory-mapped file and in which case &#39;bufL&#39; will point to the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- next location to be written, which is not necessarily the beginning</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- of the file.</span></span><span class="mpre">
data </span><a name="loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tycondecl"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre">
  = </span><span class="hl_condecl"><span class="mpre">Buffer</span></span><span class="mpre"> {
        </span><a name="loc_182_9_182_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_9_182_15&#39;)"><span class="hl_fielddecl"><span class="mpre">bufRaw</span></span></a><span class="mpre">   :: !(</span><span class="hl_tyconref"><span class="mpre">RawBuffer</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre">),
        </span><a name="loc_183_9_183_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_9_183_17&#39;)"><span class="hl_fielddecl"><span class="mpre">bufState</span></span></a><span class="mpre"> :: </span><a href="#loc_195_6_195_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_6_195_17&#39;)"><span class="hl_tyconref"><span class="mpre">BufferState</span></span></a><span class="mpre">,
        </span><a name="loc_184_9_184_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_9_184_16&#39;)"><span class="hl_fielddecl"><span class="mpre">bufSize</span></span></a><span class="mpre">  :: !</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">,          </span><span class="hl_comment"><span class="mpre">-- in elements, not bytes</span></span><span class="mpre">
        </span><a name="loc_185_9_185_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_9_185_13&#39;)"><span class="hl_fielddecl"><span class="mpre">bufL</span></span></a><span class="mpre">     :: !</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">,          </span><span class="hl_comment"><span class="mpre">-- offset of first item in the buffer</span></span><span class="mpre">
        </span><a name="loc_186_9_186_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_9_186_13&#39;)"><span class="hl_fielddecl"><span class="mpre">bufR</span></span></a><span class="mpre">     :: !</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">           </span><span class="hl_comment"><span class="mpre">-- offset of last item + 1</span></span><span class="mpre">
  }

#ifdef CHARBUF_UTF16
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 190, srcSpanStartColumn = 1, srcSpanEndLine = 190, srcSpanEndColumn = 32}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 190, srcSpanStartColumn = 1, srcSpanEndLine = 190, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 190, srcSpanS"><span class="mpre">type CharBuffer = Buffer Word16</span></span><span class="mpre">
#else
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 192, srcSpanStartColumn = 1, srcSpanEndLine = 192, srcSpanEndColumn = 30}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 192, srcSpanStartColumn = 1, srcSpanEndLine = 192, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 192, srcSpanS"><span class="mpre">type CharBuffer = Buffer Char</span></span><span class="mpre">
#endif

data </span><a name="loc_195_6_195_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_6_195_17&#39;)"><span class="hl_tycondecl"><span class="mpre">BufferState</span></span></a><span class="mpre"> = </span><a name="loc_195_20_195_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_20_195_30&#39;)"><span class="hl_condecl"><span class="mpre">ReadBuffer</span></span></a><span class="mpre"> | </span><a name="loc_195_33_195_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_33_195_44&#39;)"><span class="hl_condecl"><span class="mpre">WriteBuffer</span></span></a><span class="mpre"> </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 195, srcSpanStartColumn = 45, srcSpanEndLine = 195, srcSpanEndColumn = 58}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 195, srcSpanStartColumn = 45, srcSpanEndLine = 195, srcSpanEndColumn = 53},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 195, srcSp"><span class="mpre">deriving (Eq)</span></span><span class="mpre">

</span><a href="#loc_198_1_198_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_1_198_11&#39;)"><span class="mpre">withBuffer</span></a><span class="mpre"> :: </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_198_1_198_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_1_198_11&#39;)"><span class="hl_fundecl"><span class="mpre">withBuffer</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 198, srcSpanStartColumn = 12, srcSpanEndLine = 198, srcSpanEndColumn = 32}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 198, srcSpanStartColumn = 18, srcSpanEndLine = 198, srcSpanEndColumn = 19},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 198, srcSpanSt"><span class="mpre">Buffer{ bufRaw=raw }</span></span><span class="mpre"> </span><a name="loc_198_33_198_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_33_198_34&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castForeignPtr</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw</span></span><span class="mpre">) </span><a href="#loc_198_33_198_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_33_198_34&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">

</span><a href="#loc_201_1_201_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_1_201_14&#39;)"><span class="mpre">withRawBuffer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">RawBuffer</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_201_1_201_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_1_201_14&#39;)"><span class="hl_fundecl"><span class="mpre">withRawBuffer</span></span></a><span class="mpre"> </span><a name="loc_201_15_201_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_15_201_18&#39;)"><span class="hl_vardecl"><span class="mpre">raw</span></span></a><span class="mpre"> </span><a name="loc_201_19_201_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_19_201_20&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castForeignPtr</span></span><span class="mpre"> </span><a href="#loc_201_15_201_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_15_201_18&#39;)"><span class="hl_varref"><span class="mpre">raw</span></span></a><span class="mpre">) </span><a href="#loc_201_19_201_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_19_201_20&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">

</span><a href="#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_1_204_14&#39;)"><span class="mpre">isEmptyBuffer</span></a><span class="mpre"> :: </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_204_1_204_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_1_204_14&#39;)"><span class="hl_fundecl"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 204, srcSpanStartColumn = 15, srcSpanEndLine = 204, srcSpanEndColumn = 39}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 204, srcSpanStartColumn = 21, srcSpanEndLine = 204, srcSpanEndColumn = 22},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 204, srcSpanSt"><span class="mpre">Buffer{ bufL=l, bufR=r }</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">l</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">r</span></span><span class="mpre">

</span><a href="#loc_207_1_207_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_1_207_13&#39;)"><span class="mpre">isFullBuffer</span></a><span class="mpre"> :: </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_207_1_207_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_1_207_13&#39;)"><span class="hl_fundecl"><span class="mpre">isFullBuffer</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 207, srcSpanStartColumn = 14, srcSpanEndLine = 207, srcSpanEndColumn = 41}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 207, srcSpanStartColumn = 20, srcSpanEndLine = 207, srcSpanEndColumn = 21},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 207, srcSpanSt"><span class="mpre">Buffer{ bufR=w, bufSize=s }</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- if a Char buffer does not have room for a surrogate pair, it is &quot;full&quot;</span></span><span class="mpre">
</span><a href="#loc_212_1_212_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_1_212_17&#39;)"><span class="mpre">isFullCharBuffer</span></a><span class="mpre"> :: </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
#ifdef CHARBUF_UTF16
</span><a name="loc_212_1_212_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_1_212_17&#39;)"><span class="hl_fundecl"><span class="mpre">isFullCharBuffer</span></span></a><span class="mpre"> </span><a name="loc_212_18_212_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_18_212_21&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> = </span><a href="#loc_226_1_226_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_1_226_16&#39;)"><span class="hl_varref"><span class="mpre">bufferAvailable</span></span></a><span class="mpre"> </span><a href="#loc_212_18_212_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_18_212_21&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">
#else
</span><span class="hl_vardecl"><span class="mpre">isFullCharBuffer</span></span><span class="mpre"> = </span><a href="#loc_207_1_207_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_1_207_13&#39;)"><span class="hl_varref"><span class="mpre">isFullBuffer</span></span></a><span class="mpre">
#endif

</span><a href="#loc_218_1_218_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_1_218_14&#39;)"><span class="mpre">isWriteBuffer</span></a><span class="mpre"> :: </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_218_1_218_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_1_218_14&#39;)"><span class="hl_fundecl"><span class="mpre">isWriteBuffer</span></span></a><span class="mpre"> </span><a name="loc_218_15_218_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_15_218_18&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> = case </span><a href="#loc_183_9_183_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_9_183_17&#39;)"><span class="hl_varref"><span class="mpre">bufState</span></span></a><span class="mpre"> </span><a href="#loc_218_15_218_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_15_218_18&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> of
                        </span><a href="#loc_195_33_195_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_33_195_44&#39;)"><span class="hl_conref"><span class="mpre">WriteBuffer</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
                        </span><a href="#loc_195_20_195_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_20_195_30&#39;)"><span class="hl_conref"><span class="mpre">ReadBuffer</span></span></a><span class="mpre">  -&gt; </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

</span><a href="#loc_223_1_223_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_1_223_12&#39;)"><span class="mpre">bufferElems</span></a><span class="mpre"> :: </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_223_1_223_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_1_223_12&#39;)"><span class="hl_fundecl"><span class="mpre">bufferElems</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 223, srcSpanStartColumn = 13, srcSpanEndLine = 223, srcSpanEndColumn = 37}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 223, srcSpanStartColumn = 19, srcSpanEndLine = 223, srcSpanEndColumn = 20},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 223, srcSpanSt"><span class="mpre">Buffer{ bufR=w, bufL=r }</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">r</span></span><span class="mpre">

</span><a href="#loc_226_1_226_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_1_226_16&#39;)"><span class="mpre">bufferAvailable</span></a><span class="mpre"> :: </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_226_1_226_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_1_226_16&#39;)"><span class="hl_fundecl"><span class="mpre">bufferAvailable</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 226, srcSpanStartColumn = 17, srcSpanEndLine = 226, srcSpanEndColumn = 44}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 226, srcSpanStartColumn = 23, srcSpanEndLine = 226, srcSpanEndColumn = 24},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 226, srcSpanSt"><span class="mpre">Buffer{ bufR=w, bufSize=s }</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre">

</span><a href="#loc_229_1_229_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_1_229_13&#39;)"><span class="mpre">bufferRemove</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre">
</span><a name="loc_229_1_229_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_1_229_13&#39;)"><span class="hl_fundecl"><span class="mpre">bufferRemove</span></span></a><span class="mpre"> </span><a name="loc_229_14_229_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_14_229_15&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> </span><a name="loc_229_16_229_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_16_229_19&#39;)"><span class="hl_specname"><span class="mpre">buf</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 229, srcSpanStartColumn = 20, srcSpanEndLine = 229, srcSpanEndColumn = 36}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 229, srcSpanStartColumn = 26, srcSpanEndLine = 229, srcSpanEndColumn = 27},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 229, srcSpanSt"><span class="mpre">Buffer{ bufL=r }</span></span><span class="mpre"> = </span><a href="#loc_232_1_232_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_1_232_14&#39;)"><span class="hl_varref"><span class="mpre">bufferAdjustL</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">r</span></span><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_229_14_229_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_14_229_15&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">) </span><a href="#loc_229_16_229_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_16_229_19&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">

</span><a href="#loc_232_1_232_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_1_232_14&#39;)"><span class="mpre">bufferAdjustL</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre">
</span><a name="loc_232_1_232_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_1_232_14&#39;)"><span class="hl_fundecl"><span class="mpre">bufferAdjustL</span></span></a><span class="mpre"> </span><a name="loc_232_15_232_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_15_232_16&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> </span><span class="hl_specname"><span class="mpre">buf</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 232, srcSpanStartColumn = 21, srcSpanEndLine = 232, srcSpanEndColumn = 37}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 232, srcSpanStartColumn = 27, srcSpanEndLine = 232, srcSpanEndColumn = 28},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 232, srcSpanSt"><span class="mpre">Buffer{ bufR=w }</span></span><span class="mpre">
  | </span><a href="#loc_232_15_232_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_15_232_16&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre">    = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 233, srcSpanStartColumn = 17, srcSpanEndLine = 233, srcSpanEndColumn = 38}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 233, srcSpanStartColumn = 20, srcSpanEndLine = 233, srcSpanEndColumn = 21},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 233, srcS"><span class="mpre">buf{ bufL=0, bufR=0 }</span></span><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 234, srcSpanStartColumn = 17, srcSpanEndLine = 234, srcSpanEndColumn = 38}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 234, srcSpanStartColumn = 20, srcSpanEndLine = 234, srcSpanEndColumn = 21},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 234, srcS"><span class="mpre">buf{ bufL=l, bufR=w }</span></span><span class="mpre">

</span><a href="#loc_237_1_237_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_1_237_10&#39;)"><span class="mpre">bufferAdd</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre">
</span><a name="loc_237_1_237_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_1_237_10&#39;)"><span class="hl_fundecl"><span class="mpre">bufferAdd</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">i</span></span><span class="mpre"> </span><span class="hl_specname"><span class="mpre">buf</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 237, srcSpanStartColumn = 17, srcSpanEndLine = 237, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 237, srcSpanStartColumn = 23, srcSpanEndLine = 237, srcSpanEndColumn = 24},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 237, srcSpanSt"><span class="mpre">Buffer{ bufR=w }</span></span><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 237, srcSpanStartColumn = 36, srcSpanEndLine = 237, srcSpanEndColumn = 51}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 237, srcSpanStartColumn = 39, srcSpanEndLine = 237, srcSpanEndColumn = 40},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 237, srcS"><span class="mpre">buf{ bufR=w+i }</span></span><span class="mpre">

</span><a href="#loc_240_1_240_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_1_240_12&#39;)"><span class="mpre">emptyBuffer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">RawBuffer</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_195_6_195_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_6_195_17&#39;)"><span class="hl_tyconref"><span class="mpre">BufferState</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre">
</span><a name="loc_240_1_240_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_1_240_12&#39;)"><span class="hl_fundecl"><span class="mpre">emptyBuffer</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">raw</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">sz</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">state</span></span><span class="mpre"> = 
  </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 241, srcSpanStartColumn = 3, srcSpanEndLine = 241, srcSpanEndColumn = 67}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 241, srcSpanStartColumn = 9, srcSpanEndLine = 241, srcSpanEndColumn = 10},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 241, srcSpa"><span class="mpre">Buffer{ bufRaw=raw, bufState=state, bufR=0, bufL=0, bufSize=sz }</span></span><span class="mpre">

</span><a href="#loc_244_1_244_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_1_244_14&#39;)"><span class="mpre">newByteBuffer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_195_6_195_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_6_195_17&#39;)"><span class="hl_tyconref"><span class="mpre">BufferState</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
</span><a name="loc_244_1_244_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_1_244_14&#39;)"><span class="hl_fundecl"><span class="mpre">newByteBuffer</span></span></a><span class="mpre"> </span><a name="loc_244_15_244_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_15_244_16&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> </span><a name="loc_244_17_244_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_17_244_19&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> = </span><a href="#loc_250_1_250_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_1_250_10&#39;)"><span class="hl_varref"><span class="mpre">newBuffer</span></span></a><span class="mpre"> </span><a href="#loc_244_15_244_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_15_244_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><a href="#loc_244_15_244_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_15_244_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><a href="#loc_244_17_244_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_17_244_19&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">

</span><a href="#loc_247_1_247_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_1_247_14&#39;)"><span class="mpre">newCharBuffer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_195_6_195_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_6_195_17&#39;)"><span class="hl_tyconref"><span class="mpre">BufferState</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre">
</span><a name="loc_247_1_247_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_1_247_14&#39;)"><span class="hl_fundecl"><span class="mpre">newCharBuffer</span></span></a><span class="mpre"> </span><a name="loc_247_15_247_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_15_247_16&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> </span><a name="loc_247_17_247_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_17_247_19&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> = </span><a href="#loc_250_1_250_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_1_250_10&#39;)"><span class="hl_varref"><span class="mpre">newBuffer</span></span></a><span class="mpre"> (</span><a href="#loc_247_15_247_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_15_247_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><a href="#loc_157_1_157_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_1_157_9&#39;)"><span class="hl_varref"><span class="mpre">charSize</span></span></a><span class="mpre">) </span><a href="#loc_247_15_247_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_15_247_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><a href="#loc_247_17_247_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_17_247_19&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">

</span><a href="#loc_250_1_250_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_1_250_10&#39;)"><span class="mpre">newBuffer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_195_6_195_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_6_195_17&#39;)"><span class="hl_tyconref"><span class="mpre">BufferState</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre">)
</span><a name="loc_250_1_250_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_1_250_10&#39;)"><span class="hl_fundecl"><span class="mpre">newBuffer</span></span></a><span class="mpre"> </span><a name="loc_250_11_250_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_11_250_16&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre"> </span><a name="loc_250_17_250_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_17_250_19&#39;)"><span class="hl_vardecl"><span class="mpre">sz</span></span></a><span class="mpre"> </span><a name="loc_250_20_250_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_20_250_25&#39;)"><span class="hl_vardecl"><span class="mpre">state</span></span></a><span class="mpre"> = do
  </span><a name="loc_251_3_251_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_251_3_251_5&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">mallocForeignPtrBytes</span></span><span class="mpre"> </span><a href="#loc_250_11_250_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_11_250_16&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_240_1_240_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_1_240_12&#39;)"><span class="hl_varref"><span class="mpre">emptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_251_3_251_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_251_3_251_5&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a href="#loc_250_17_250_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_17_250_19&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre"> </span><a href="#loc_250_20_250_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_20_250_25&#39;)"><span class="hl_varref"><span class="mpre">state</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | slides the contents of the buffer to the beginning</span></span><span class="mpre">
</span><a href="#loc_256_1_256_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_256_1_256_14&#39;)"><span class="mpre">slideContents</span></a><span class="mpre"> :: </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
</span><a name="loc_256_1_256_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_256_1_256_14&#39;)"><span class="hl_fundecl"><span class="mpre">slideContents</span></span></a><span class="mpre"> </span><span class="hl_specname"><span class="mpre">buf</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 256, srcSpanStartColumn = 19, srcSpanEndLine = 256, srcSpanEndColumn = 55}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 256, srcSpanStartColumn = 25, srcSpanEndLine = 256, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 256, srcSpanSt"><span class="mpre">Buffer{ bufL=l, bufR=r, bufRaw=raw }</span></span><span class="mpre"> = do
  let </span><a name="loc_257_7_257_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_7_257_12&#39;)"><span class="hl_vardecl"><span class="mpre">elems</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">r</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">l</span></span><span class="mpre">
  </span><a href="#loc_201_1_201_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_1_201_14&#39;)"><span class="hl_varref"><span class="mpre">withRawBuffer</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_258_24_258_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_258_24_258_25&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt;
      do _ &lt;- </span><span class="hl_varref"><span class="mpre">memmove</span></span><span class="mpre"> </span><a href="#loc_258_24_258_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_258_24_258_25&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> (</span><a href="#loc_258_24_258_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_258_24_258_25&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">l</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_257_7_257_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_7_257_12&#39;)"><span class="hl_varref"><span class="mpre">elems</span></span></a><span class="mpre">)
         </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 261, srcSpanStartColumn = 10, srcSpanEndLine = 261, srcSpanEndColumn = 35}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 261, srcSpanStartColumn = 13, srcSpanEndLine = 261, srcSpanEndColumn = 14},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 261, srcS"><span class="mpre">buf{ bufL=0, bufR=elems }</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 263, srcSpanStartColumn = 1, srcSpanEndLine = 264, srcSpanEndColumn = 52}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 263, srcSpanStartColumn = 1, srcSpanEndLine = 263, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 263, srcSpanSta"><span class="mpre">foreign import ccall unsafe &quot;memmove&quot;
   memmove :: Ptr a -&gt; Ptr a -&gt; CSize -&gt; IO (Ptr a)</span></span><span class="mpre">

</span><a href="#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_1_267_14&#39;)"><span class="mpre">summaryBuffer</span></a><span class="mpre"> :: </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_267_1_267_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_1_267_14&#39;)"><span class="hl_fundecl"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a name="loc_267_15_267_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_15_267_18&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;buf&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><a href="#loc_184_9_184_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_9_184_16&#39;)"><span class="hl_varref"><span class="mpre">bufSize</span></span></a><span class="mpre"> </span><a href="#loc_267_15_267_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_15_267_18&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;(&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><a href="#loc_185_9_185_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_9_185_13&#39;)"><span class="hl_varref"><span class="mpre">bufL</span></span></a><span class="mpre"> </span><a href="#loc_267_15_267_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_15_267_18&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;-&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><a href="#loc_186_9_186_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_9_186_13&#39;)"><span class="hl_varref"><span class="mpre">bufR</span></span></a><span class="mpre"> </span><a href="#loc_267_15_267_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_15_267_18&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;)&quot;</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- INVARIANTS on Buffers:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   * r &lt;= w</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   * if r == w, and the buffer is for reading, then r == 0 &amp;&amp; w == 0</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   * a write buffer is never full.  If an operation</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     fills up the buffer, it will always flush it before </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     returning.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   * a read buffer may be full as a result of hLookAhead.  In normal</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     operation, a read buffer always has at least one character of space.</span></span><span class="mpre">

</span><a href="#loc_279_1_279_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_1_279_12&#39;)"><span class="mpre">checkBuffer</span></a><span class="mpre"> :: </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_279_1_279_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_1_279_12&#39;)"><span class="hl_fundecl"><span class="mpre">checkBuffer</span></span></a><span class="mpre"> </span><a name="loc_279_13_279_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_13_279_16&#39;)"><span class="hl_specname"><span class="mpre">buf</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 279, srcSpanStartColumn = 17, srcSpanEndLine = 279, srcSpanEndColumn = 73}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 279, srcSpanStartColumn = 23, srcSpanEndLine = 279, srcSpanEndColumn = 24},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Buffer.hs&quot;, srcSpanStartLine = 279, srcSpanSt"><span class="mpre">Buffer{ bufState = state, bufL=r, bufR=w, bufSize=size }</span></span><span class="mpre"> = do
     </span><a href="#loc_289_1_289_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_289_1_289_6&#39;)"><span class="hl_varref"><span class="mpre">check</span></span></a><span class="mpre"> </span><a href="#loc_279_13_279_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_13_279_16&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> (
              </span><span class="hl_varref"><span class="mpre">size</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
              </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">r</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre">
              </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">size</span></span><span class="mpre">
              </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> ( </span><span class="hl_varref"><span class="mpre">r</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">state</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_195_33_195_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_33_195_44&#39;)"><span class="hl_conref"><span class="mpre">WriteBuffer</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">r</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">) )
        </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> ( </span><span class="hl_varref"><span class="mpre">state</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="#loc_195_33_195_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_33_195_44&#39;)"><span class="hl_conref"><span class="mpre">WriteBuffer</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">size</span></span><span class="mpre"> ) </span><span class="hl_comment"><span class="mpre">-- write buffer is never full</span></span><span class="mpre">
      )

</span><a href="#loc_289_1_289_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_289_1_289_6&#39;)"><span class="mpre">check</span></a><span class="mpre"> :: </span><a href="#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_289_1_289_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_289_1_289_6&#39;)"><span class="hl_fundecl"><span class="mpre">check</span></span></a><span class="mpre"> _   </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
</span><a href="#loc_289_1_289_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_289_1_289_6&#39;)"><span class="hl_fundecl"><span class="mpre">check</span></span></a><span class="mpre"> </span><a name="loc_290_7_290_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_290_7_290_10&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;buffer invariant violation: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_290_7_290_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_290_7_290_10&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">)

</span></div></body></html>