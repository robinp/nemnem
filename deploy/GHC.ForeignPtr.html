<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Unsafe #-}
{-# LANGUAGE NoImplicitPrelude
           , BangPatterns
           , MagicHash
           , UnboxedTuples
  #-}
{-# OPTIONS_HADDOCK hide #-}
{-# LANGUAGE DeriveDataTypeable, StandaloneDeriving #-}

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  GHC.ForeignPtr</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow, 1992-2003</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  see libraries/base/LICENSE</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  cvs-ghc@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  internal</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (GHC extensions)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- GHC&#39;s implementation of the &#39;ForeignPtr&#39; data type.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module GHC.ForeignPtr
  (
        ForeignPtr(..),
        ForeignPtrContents(..),
        FinalizerPtr,
        FinalizerEnvPtr,
        newForeignPtr_,
        mallocForeignPtr,
        mallocPlainForeignPtr,
        mallocForeignPtrBytes,
        mallocPlainForeignPtrBytes,
        mallocForeignPtrAlignedBytes,
        mallocPlainForeignPtrAlignedBytes,
        addForeignPtrFinalizer,
        addForeignPtrFinalizerEnv,
        touchForeignPtr,
        unsafeForeignPtrToPtr,
        castForeignPtr,
        newConcForeignPtr,
        addForeignPtrConcFinalizer,
        finalizeForeignPtr
  ) where

import Control.Monad    ( </span><a href="Control.Monad.html#loc_106_1_106_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_106_1_106_10&#39;)"><span class="mpre">sequence_</span></a><span class="mpre"> )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 48, srcSpanStartColumn = 8, srcSpanEndLine = 48, srcSpanEndColumn = 24}, srcInfoPoints = []}) &quot;Foreign.Storable&quot;"><span class="mpre">Foreign.Storable</span></span><span class="mpre">
import Data.Typeable

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 51, srcSpanStartColumn = 8, srcSpanEndLine = 51, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Show&quot;"><span class="mpre">GHC.Show</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 52, srcSpanStartColumn = 8, srcSpanEndLine = 52, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">
import GHC.IORef
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 8, srcSpanEndLine = 54, srcSpanEndColumn = 17}, srcInfoPoints = []}) &quot;GHC.STRef&quot;"><span class="mpre">GHC.STRef</span></span><span class="mpre">        ( STRef(..) )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 55, srcSpanStartColumn = 8, srcSpanEndLine = 55, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;GHC.Ptr&quot;"><span class="mpre">GHC.Ptr</span></span><span class="mpre">          ( Ptr(..), FunPtr(..) )

</span><span class="hl_comment"><span class="mpre">-- |The type &#39;ForeignPtr&#39; represents references to objects that are</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- maintained in a foreign language, i.e., that are not part of the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- data structures usually managed by the Haskell storage manager.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The essential difference between &#39;ForeignPtr&#39;s and vanilla memory</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- references of type @Ptr a@ is that the former may be associated</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- with /finalizers/. A finalizer is a routine that is invoked when</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the Haskell storage manager detects that - within the Haskell heap</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- and stack - there are no more references left that are pointing to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the &#39;ForeignPtr&#39;.  Typically, the finalizer will, then, invoke</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- routines in the foreign language that free the resources bound by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the foreign object.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The &#39;ForeignPtr&#39; is parameterised in the same way as &#39;Ptr&#39;.  The</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- type argument of &#39;ForeignPtr&#39; should normally be an instance of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- class &#39;Storable&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
data </span><a name="loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tycondecl"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_73_21_73_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_21_73_31&#39;)"><span class="hl_condecl"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Addr#</span></span><span class="mpre"> </span><a href="#loc_90_6_90_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_6_90_24&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtrContents</span></span></a><span class="mpre">
                    </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 74, srcSpanStartColumn = 21, srcSpanEndLine = 74, srcSpanEndColumn = 38}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 74, srcSpanStartColumn = 21, srcSpanEndLine = 74, srcSpanEndColumn = 29}]}) [IHead (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignP"><span class="mpre">deriving Typeable</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- we cache the Addr# in the ForeignPtr object, but attach</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- the finalizer to the IORef (or the MutableByteArray# in</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- the case of a MallocPtr).  The aim of the representation</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- is to make withForeignPtr efficient; in fact, withForeignPtr</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- should be just as efficient as unpacking a Ptr, and multiple</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- withForeignPtrs can share an unpacked ForeignPtr.  Note</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- that touchForeignPtr only has to touch the ForeignPtrContents</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- object, because that ensures that whatever the finalizer is</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- attached to is kept alive.</span></span><span class="mpre">

data </span><a name="loc_85_6_85_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_16&#39;)"><span class="hl_tycondecl"><span class="mpre">Finalizers</span></span></a><span class="mpre">
  = </span><a name="loc_86_5_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_17&#39;)"><span class="hl_condecl"><span class="mpre">NoFinalizers</span></span></a><span class="mpre">
  | </span><a name="loc_87_5_87_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_16&#39;)"><span class="hl_condecl"><span class="mpre">CFinalizers</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Weak#</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)
  | </span><a name="loc_88_5_88_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_5_88_22&#39;)"><span class="hl_condecl"><span class="mpre">HaskellFinalizers</span></span></a><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">]

data </span><a name="loc_90_6_90_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_6_90_24&#39;)"><span class="hl_tycondecl"><span class="mpre">ForeignPtrContents</span></span></a><span class="mpre">
  = </span><a name="loc_91_5_91_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_5_91_20&#39;)"><span class="hl_condecl"><span class="mpre">PlainForeignPtr</span></span></a><span class="mpre"> !(</span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><a href="#loc_85_6_85_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_16&#39;)"><span class="hl_tyconref"><span class="mpre">Finalizers</span></span></a><span class="mpre">)
  | </span><a name="loc_92_5_92_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_14&#39;)"><span class="hl_condecl"><span class="mpre">MallocPtr</span></span></a><span class="mpre">      (</span><span class="hl_tyconref"><span class="mpre">MutableByteArray#</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">RealWorld</span></span><span class="mpre">) !(</span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><a href="#loc_85_6_85_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_16&#39;)"><span class="hl_tyconref"><span class="mpre">Finalizers</span></span></a><span class="mpre">)
  | </span><a name="loc_93_5_93_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_5_93_13&#39;)"><span class="hl_condecl"><span class="mpre">PlainPtr</span></span></a><span class="mpre">       (</span><span class="hl_tyconref"><span class="mpre">MutableByteArray#</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">RealWorld</span></span><span class="mpre">)

instance </span><span class="hl_classref"><span class="mpre">Eq</span></span><span class="mpre"> (</span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) where
    </span><a name="loc_96_5_96_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_5_96_6&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_fundecl"><span class="mpre">==</span></span><span class="mpre"> </span><a name="loc_96_10_96_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_10_96_11&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre">  =  </span><a href="#loc_420_1_420_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_1_420_22&#39;)"><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span></a><span class="mpre"> </span><a href="#loc_96_5_96_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_5_96_6&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_420_1_420_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_1_420_22&#39;)"><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span></a><span class="mpre"> </span><a href="#loc_96_10_96_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_10_96_11&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Ord</span></span><span class="mpre"> (</span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) where
    </span><span class="hl_fundecl"><span class="mpre">compare</span></span><span class="mpre"> </span><a name="loc_99_13_99_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_13_99_14&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_99_15_99_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_15_99_16&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre">  =  </span><span class="hl_varref"><span class="mpre">compare</span></span><span class="mpre"> (</span><a href="#loc_420_1_420_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_1_420_22&#39;)"><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span></a><span class="mpre"> </span><a href="#loc_99_13_99_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_13_99_14&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">) (</span><a href="#loc_420_1_420_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_1_420_22&#39;)"><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span></a><span class="mpre"> </span><a href="#loc_99_15_99_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_15_99_16&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">)

instance </span><span class="hl_classref"><span class="mpre">Show</span></span><span class="mpre"> (</span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) where
    </span><span class="hl_fundecl"><span class="mpre">showsPrec</span></span><span class="mpre"> </span><a name="loc_102_15_102_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_15_102_16&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_102_17_102_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_17_102_18&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">showsPrec</span></span><span class="mpre"> </span><a href="#loc_102_15_102_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_15_102_16&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> (</span><a href="#loc_420_1_420_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_1_420_22&#39;)"><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span></a><span class="mpre"> </span><a href="#loc_102_17_102_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_17_102_18&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">-- |A finalizer is represented as a pointer to a foreign function that, at</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- finalisation time, gets as an argument a plain pointer variant of the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- foreign pointer that the finalizer is associated with.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that the foreign function /must/ use the @ccall@ calling convention.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 111, srcSpanStartColumn = 1, srcSpanEndLine = 111, srcSpanEndColumn = 53}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 111, srcSpanStartColumn = 1, srcSpanEndLine = 111, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 111, srcSp"><span class="mpre">type FinalizerPtr a        = FunPtr (Ptr a -&gt; IO ())</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 112, srcSpanStartColumn = 1, srcSpanEndLine = 112, srcSpanEndColumn = 64}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 112, srcSpanStartColumn = 1, srcSpanEndLine = 112, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 112, srcSp"><span class="mpre">type FinalizerEnvPtr env a = FunPtr (Ptr env -&gt; Ptr a -&gt; IO ())</span></span><span class="mpre">

</span><a href="#loc_131_1_131_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_1_131_18&#39;)"><span class="mpre">newConcForeignPtr</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ^Turns a plain memory reference into a foreign object by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- associating a finalizer - given by the monadic operation - with the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- reference.  The storage manager will start the finalizer, in a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- separate thread, some time after the last reference to the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @ForeignPtr@ is dropped.  There is no guarantee of promptness, and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in fact there is no guarantee that the finalizer will eventually</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- run at all.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that references from a finalizer do not necessarily prevent</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- another object from being finalized.  If A&#39;s finalizer refers to B</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (perhaps using &#39;touchForeignPtr&#39;, then the only guarantee is that</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- B&#39;s finalizer will never be started before A&#39;s.  If both A and B</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- are unreachable, then both finalizers will start together.  See</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;touchForeignPtr&#39; for more on finalizer ordering.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a name="loc_131_1_131_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_1_131_18&#39;)"><span class="hl_fundecl"><span class="mpre">newConcForeignPtr</span></span></a><span class="mpre"> </span><a name="loc_131_19_131_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_19_131_20&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_131_21_131_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_21_131_30&#39;)"><span class="hl_vardecl"><span class="mpre">finalizer</span></span></a><span class="mpre">
  = do </span><a name="loc_132_8_132_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_8_132_12&#39;)"><span class="hl_vardecl"><span class="mpre">fObj</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_371_1_371_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_1_371_15&#39;)"><span class="hl_varref"><span class="mpre">newForeignPtr_</span></span></a><span class="mpre"> </span><a href="#loc_131_19_131_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_19_131_20&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">
       </span><a href="#loc_287_1_287_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_1_287_27&#39;)"><span class="hl_varref"><span class="mpre">addForeignPtrConcFinalizer</span></span></a><span class="mpre"> </span><a href="#loc_132_8_132_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_8_132_12&#39;)"><span class="hl_varref"><span class="mpre">fObj</span></span></a><span class="mpre"> </span><a href="#loc_131_21_131_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_21_131_30&#39;)"><span class="hl_varref"><span class="mpre">finalizer</span></span></a><span class="mpre">
       </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_132_8_132_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_8_132_12&#39;)"><span class="hl_varref"><span class="mpre">fObj</span></span></a><span class="mpre">

</span><a href="#loc_155_1_155_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_17&#39;)"><span class="mpre">mallocForeignPtr</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 136, srcSpanStartColumn = 21, srcSpanEndLine = 136, srcSpanEndColumn = 34}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 136, srcSpanStartColumn = 32, srcSpanEndLine = 136, srcSpanEndColumn = 34}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/For"><span class="mpre">Storable a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><span class="hl_comment"><span class="mpre">-- ^ Allocate some memory and return a &#39;ForeignPtr&#39; to it.  The memory</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- will be released automatically when the &#39;ForeignPtr&#39; is discarded.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;mallocForeignPtr&#39; is equivalent to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;    do { p &lt;- malloc; newForeignPtr finalizerFree p }</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- although it may be implemented differently internally: you may not</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- assume that the memory returned by &#39;mallocForeignPtr&#39; has been</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- allocated with &#39;Foreign.Marshal.Alloc.malloc&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- GHC notes: &#39;mallocForeignPtr&#39; has a heavily optimised</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- implementation in GHC.  It uses pinned memory in the garbage</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- collected heap, so the &#39;ForeignPtr&#39; does not require a finalizer to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- free the memory.  Use of &#39;mallocForeignPtr&#39; and associated</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- functions is strongly recommended in preference to &#39;newForeignPtr&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- with a finalizer.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><a name="loc_155_1_155_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_17&#39;)"><span class="hl_vardecl"><span class="mpre">mallocForeignPtr</span></span></a><span class="mpre"> = </span><a href="#loc_157_9_157_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_17&#39;)"><span class="hl_varref"><span class="mpre">doMalloc</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre">
  where </span><a href="#loc_157_9_157_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_17&#39;)"><span class="mpre">doMalloc</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 156, srcSpanStartColumn = 21, srcSpanEndLine = 156, srcSpanEndColumn = 34}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 156, srcSpanStartColumn = 32, srcSpanEndLine = 156, srcSpanEndColumn = 34}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/For"><span class="mpre">Storable b =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)
        </span><a name="loc_157_9_157_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_17&#39;)"><span class="hl_fundecl"><span class="mpre">doMalloc</span></span></a><span class="mpre"> </span><a name="loc_157_18_157_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_18_157_19&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">
          | </span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a href="#loc_166_24_166_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_24_166_28&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;mallocForeignPtr: size must be &gt;= 0&quot;</span></span><span class="mpre">
          | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do
          </span><a name="loc_160_11_160_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_11_160_12&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_86_5_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_17&#39;)"><span class="hl_conref"><span class="mpre">NoFinalizers</span></span></a><span class="mpre">
          </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_161_17_161_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_17_161_18&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
            case </span><span class="hl_varref"><span class="mpre">newAlignedPinnedByteArray#</span></span><span class="mpre"> </span><a href="#loc_166_24_166_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_24_166_28&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_167_24_167_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_24_167_29&#39;)"><span class="hl_varref"><span class="mpre">align</span></span></a><span class="mpre"> </span><a href="#loc_161_17_161_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_17_161_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of { (# </span><a name="loc_162_66_162_68" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_66_162_68&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a name="loc_162_70_162_76" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_70_162_76&#39;)"><span class="hl_vardecl"><span class="mpre">mbarr#</span></span></a><span class="mpre"> #) -&gt;
             (# </span><a href="#loc_162_66_162_68" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_66_162_68&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a href="#loc_73_21_73_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_21_73_31&#39;)"><span class="hl_conref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">byteArrayContents#</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">unsafeCoerce#</span></span><span class="mpre"> </span><a href="#loc_162_70_162_76" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_70_162_76&#39;)"><span class="hl_varref"><span class="mpre">mbarr#</span></span></a><span class="mpre">))
                               (</span><a href="#loc_92_5_92_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_14&#39;)"><span class="hl_conref"><span class="mpre">MallocPtr</span></span></a><span class="mpre"> </span><a href="#loc_162_70_162_76" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_70_162_76&#39;)"><span class="hl_varref"><span class="mpre">mbarr#</span></span></a><span class="mpre"> </span><a href="#loc_160_11_160_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_11_160_12&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">) #)
            }
            where !(</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_166_24_166_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_24_166_28&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre">)  = </span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> </span><a href="#loc_157_18_157_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_18_157_19&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
                  !(</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_167_24_167_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_24_167_29&#39;)"><span class="hl_vardecl"><span class="mpre">align</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">alignment</span></span><span class="mpre"> </span><a href="#loc_157_18_157_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_18_157_19&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | This function is similar to &#39;mallocForeignPtr&#39;, except that the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- size of the memory required is given explicitly as a number of bytes.</span></span><span class="mpre">
</span><a href="#loc_172_1_172_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_1_172_22&#39;)"><span class="mpre">mallocForeignPtrBytes</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_172_1_172_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_1_172_22&#39;)"><span class="hl_fundecl"><span class="mpre">mallocForeignPtrBytes</span></span></a><span class="mpre"> </span><a name="loc_172_23_172_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_23_172_27&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> | </span><a href="#loc_172_23_172_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_23_172_27&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> =
  </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;mallocForeignPtrBytes: size must be &gt;= 0&quot;</span></span><span class="mpre">
</span><a href="#loc_172_1_172_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_1_172_22&#39;)"><span class="hl_fundecl"><span class="mpre">mallocForeignPtrBytes</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_174_27_174_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_27_174_31&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre">) = do 
  </span><a name="loc_175_3_175_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_3_175_4&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_86_5_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_17&#39;)"><span class="hl_conref"><span class="mpre">NoFinalizers</span></span></a><span class="mpre">
  </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_176_9_176_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_9_176_10&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
     case </span><span class="hl_varref"><span class="mpre">newPinnedByteArray#</span></span><span class="mpre"> </span><a href="#loc_174_27_174_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_27_174_31&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_176_9_176_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_9_176_10&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">      of { (# </span><a name="loc_177_51_177_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_51_177_53&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a name="loc_177_55_177_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_55_177_61&#39;)"><span class="hl_vardecl"><span class="mpre">mbarr#</span></span></a><span class="mpre"> #) -&gt;
       (# </span><a href="#loc_177_51_177_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_51_177_53&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a href="#loc_73_21_73_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_21_73_31&#39;)"><span class="hl_conref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">byteArrayContents#</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">unsafeCoerce#</span></span><span class="mpre"> </span><a href="#loc_177_55_177_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_55_177_61&#39;)"><span class="hl_varref"><span class="mpre">mbarr#</span></span></a><span class="mpre">))
                         (</span><a href="#loc_92_5_92_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_14&#39;)"><span class="hl_conref"><span class="mpre">MallocPtr</span></span></a><span class="mpre"> </span><a href="#loc_177_55_177_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_55_177_61&#39;)"><span class="hl_varref"><span class="mpre">mbarr#</span></span></a><span class="mpre"> </span><a href="#loc_175_3_175_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_3_175_4&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">) #)
     }

</span><span class="hl_comment"><span class="mpre">-- | This function is similar to &#39;mallocForeignPtrBytes&#39;, except that the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- size and alignment of the memory required is given explicitly as numbers of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- bytes.</span></span><span class="mpre">
</span><a href="#loc_186_1_186_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_1_186_29&#39;)"><span class="mpre">mallocForeignPtrAlignedBytes</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_186_1_186_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_1_186_29&#39;)"><span class="hl_fundecl"><span class="mpre">mallocForeignPtrAlignedBytes</span></span></a><span class="mpre"> </span><a name="loc_186_30_186_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_30_186_34&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_align</span></span><span class="mpre"> | </span><a href="#loc_186_30_186_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_30_186_34&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> =
  </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;mallocForeignPtrAlignedBytes: size must be &gt;= 0&quot;</span></span><span class="mpre">
</span><a href="#loc_186_1_186_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_1_186_29&#39;)"><span class="hl_fundecl"><span class="mpre">mallocForeignPtrAlignedBytes</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_188_34_188_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_34_188_38&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre">) (</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_188_44_188_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_44_188_49&#39;)"><span class="hl_vardecl"><span class="mpre">align</span></span></a><span class="mpre">) = do
  </span><a name="loc_189_3_189_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_3_189_4&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_86_5_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_17&#39;)"><span class="hl_conref"><span class="mpre">NoFinalizers</span></span></a><span class="mpre">
  </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_190_9_190_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_9_190_10&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
     case </span><span class="hl_varref"><span class="mpre">newAlignedPinnedByteArray#</span></span><span class="mpre"> </span><a href="#loc_188_34_188_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_34_188_38&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_188_44_188_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_44_188_49&#39;)"><span class="hl_varref"><span class="mpre">align</span></span></a><span class="mpre"> </span><a href="#loc_190_9_190_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_9_190_10&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of { (# </span><a name="loc_191_59_191_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_59_191_61&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a name="loc_191_63_191_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_63_191_69&#39;)"><span class="hl_vardecl"><span class="mpre">mbarr#</span></span></a><span class="mpre"> #) -&gt;
       (# </span><a href="#loc_191_59_191_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_59_191_61&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a href="#loc_73_21_73_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_21_73_31&#39;)"><span class="hl_conref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">byteArrayContents#</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">unsafeCoerce#</span></span><span class="mpre"> </span><a href="#loc_191_63_191_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_63_191_69&#39;)"><span class="hl_varref"><span class="mpre">mbarr#</span></span></a><span class="mpre">))
                         (</span><a href="#loc_92_5_92_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_14&#39;)"><span class="hl_conref"><span class="mpre">MallocPtr</span></span></a><span class="mpre"> </span><a href="#loc_191_63_191_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_63_191_69&#39;)"><span class="hl_varref"><span class="mpre">mbarr#</span></span></a><span class="mpre"> </span><a href="#loc_189_3_189_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_3_189_4&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">) #)
     }

</span><span class="hl_comment"><span class="mpre">-- | Allocate some memory and return a &#39;ForeignPtr&#39; to it.  The memory</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- will be released automatically when the &#39;ForeignPtr&#39; is discarded.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- GHC notes: &#39;mallocPlainForeignPtr&#39; has a heavily optimised</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- implementation in GHC.  It uses pinned memory in the garbage</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- collected heap, as for mallocForeignPtr. Unlike mallocForeignPtr, a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ForeignPtr created with mallocPlainForeignPtr carries no finalizers.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- It is not possible to add a finalizer to a ForeignPtr created with</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- mallocPlainForeignPtr. This is useful for ForeignPtrs that will live</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- only inside Haskell (such as those created for packed strings).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Attempts to add a finalizer to a ForeignPtr created this way, or to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- finalize such a pointer, will throw an exception.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><a href="#loc_210_1_210_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_1_210_22&#39;)"><span class="mpre">mallocPlainForeignPtr</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 209, srcSpanStartColumn = 26, srcSpanEndLine = 209, srcSpanEndColumn = 39}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 209, srcSpanStartColumn = 37, srcSpanEndLine = 209, srcSpanEndColumn = 39}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/For"><span class="mpre">Storable a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_210_1_210_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_1_210_22&#39;)"><span class="hl_vardecl"><span class="mpre">mallocPlainForeignPtr</span></span></a><span class="mpre"> = </span><a href="#loc_212_9_212_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_9_212_17&#39;)"><span class="hl_varref"><span class="mpre">doMalloc</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre">
  where </span><a href="#loc_212_9_212_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_9_212_17&#39;)"><span class="mpre">doMalloc</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 211, srcSpanStartColumn = 21, srcSpanEndLine = 211, srcSpanEndColumn = 34}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 211, srcSpanStartColumn = 32, srcSpanEndLine = 211, srcSpanEndColumn = 34}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/For"><span class="mpre">Storable b =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)
        </span><a name="loc_212_9_212_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_9_212_17&#39;)"><span class="hl_fundecl"><span class="mpre">doMalloc</span></span></a><span class="mpre"> </span><a name="loc_212_18_212_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_18_212_19&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">
          | </span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a href="#loc_219_24_219_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_24_219_28&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;mallocForeignPtr: size must be &gt;= 0&quot;</span></span><span class="mpre">
          | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_214_31_214_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_31_214_32&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
            case </span><span class="hl_varref"><span class="mpre">newAlignedPinnedByteArray#</span></span><span class="mpre"> </span><a href="#loc_219_24_219_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_24_219_28&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_220_24_220_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_24_220_29&#39;)"><span class="hl_varref"><span class="mpre">align</span></span></a><span class="mpre"> </span><a href="#loc_214_31_214_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_31_214_32&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of { (# </span><a name="loc_215_66_215_68" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_66_215_68&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a name="loc_215_70_215_76" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_70_215_76&#39;)"><span class="hl_vardecl"><span class="mpre">mbarr#</span></span></a><span class="mpre"> #) -&gt;
             (# </span><a href="#loc_215_66_215_68" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_66_215_68&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a href="#loc_73_21_73_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_21_73_31&#39;)"><span class="hl_conref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">byteArrayContents#</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">unsafeCoerce#</span></span><span class="mpre"> </span><a href="#loc_215_70_215_76" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_70_215_76&#39;)"><span class="hl_varref"><span class="mpre">mbarr#</span></span></a><span class="mpre">))
                               (</span><a href="#loc_93_5_93_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_5_93_13&#39;)"><span class="hl_conref"><span class="mpre">PlainPtr</span></span></a><span class="mpre"> </span><a href="#loc_215_70_215_76" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_70_215_76&#39;)"><span class="hl_varref"><span class="mpre">mbarr#</span></span></a><span class="mpre">) #)
            }
            where !(</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_219_24_219_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_24_219_28&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre">)  = </span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> </span><a href="#loc_212_18_212_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_18_212_19&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
                  !(</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_220_24_220_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_24_220_29&#39;)"><span class="hl_vardecl"><span class="mpre">align</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">alignment</span></span><span class="mpre"> </span><a href="#loc_212_18_212_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_18_212_19&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | This function is similar to &#39;mallocForeignPtrBytes&#39;, except that</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the internally an optimised ForeignPtr representation with no</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- finalizer is used. Attempts to add a finalizer will cause an</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exception to be thrown.</span></span><span class="mpre">
</span><a href="#loc_227_1_227_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_1_227_27&#39;)"><span class="mpre">mallocPlainForeignPtrBytes</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_227_1_227_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_1_227_27&#39;)"><span class="hl_fundecl"><span class="mpre">mallocPlainForeignPtrBytes</span></span></a><span class="mpre"> </span><a name="loc_227_28_227_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_28_227_32&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> | </span><a href="#loc_227_28_227_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_28_227_32&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> =
  </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;mallocPlainForeignPtrBytes: size must be &gt;= 0&quot;</span></span><span class="mpre">
</span><a href="#loc_227_1_227_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_1_227_27&#39;)"><span class="hl_fundecl"><span class="mpre">mallocPlainForeignPtrBytes</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_229_32_229_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_32_229_36&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_229_46_229_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_46_229_47&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
    case </span><span class="hl_varref"><span class="mpre">newPinnedByteArray#</span></span><span class="mpre"> </span><a href="#loc_229_32_229_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_32_229_36&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_229_46_229_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_46_229_47&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">      of { (# </span><a name="loc_230_50_230_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_50_230_52&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a name="loc_230_54_230_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_54_230_60&#39;)"><span class="hl_vardecl"><span class="mpre">mbarr#</span></span></a><span class="mpre"> #) -&gt;
       (# </span><a href="#loc_230_50_230_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_50_230_52&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a href="#loc_73_21_73_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_21_73_31&#39;)"><span class="hl_conref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">byteArrayContents#</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">unsafeCoerce#</span></span><span class="mpre"> </span><a href="#loc_230_54_230_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_54_230_60&#39;)"><span class="hl_varref"><span class="mpre">mbarr#</span></span></a><span class="mpre">))
                         (</span><a href="#loc_93_5_93_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_5_93_13&#39;)"><span class="hl_conref"><span class="mpre">PlainPtr</span></span></a><span class="mpre"> </span><a href="#loc_230_54_230_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_54_230_60&#39;)"><span class="hl_varref"><span class="mpre">mbarr#</span></span></a><span class="mpre">) #)
     }

</span><span class="hl_comment"><span class="mpre">-- | This function is similar to &#39;mallocForeignPtrAlignedBytes&#39;, except that</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the internally an optimised ForeignPtr representation with no</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- finalizer is used. Attempts to add a finalizer will cause an</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exception to be thrown.</span></span><span class="mpre">
</span><a href="#loc_240_1_240_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_1_240_34&#39;)"><span class="mpre">mallocPlainForeignPtrAlignedBytes</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_240_1_240_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_1_240_34&#39;)"><span class="hl_fundecl"><span class="mpre">mallocPlainForeignPtrAlignedBytes</span></span></a><span class="mpre"> </span><a name="loc_240_35_240_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_35_240_39&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_align</span></span><span class="mpre"> | </span><a href="#loc_240_35_240_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_35_240_39&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> =
  </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;mallocPlainForeignPtrAlignedBytes: size must be &gt;= 0&quot;</span></span><span class="mpre">
</span><a href="#loc_240_1_240_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_1_240_34&#39;)"><span class="hl_fundecl"><span class="mpre">mallocPlainForeignPtrAlignedBytes</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_242_39_242_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_242_39_242_43&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre">) (</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_242_49_242_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_242_49_242_54&#39;)"><span class="hl_vardecl"><span class="mpre">align</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_242_64_242_65" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_242_64_242_65&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
    case </span><span class="hl_varref"><span class="mpre">newAlignedPinnedByteArray#</span></span><span class="mpre"> </span><a href="#loc_242_39_242_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_242_39_242_43&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_242_49_242_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_242_49_242_54&#39;)"><span class="hl_varref"><span class="mpre">align</span></span></a><span class="mpre"> </span><a href="#loc_242_64_242_65" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_242_64_242_65&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of { (# </span><a name="loc_243_58_243_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_58_243_60&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a name="loc_243_62_243_68" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_62_243_68&#39;)"><span class="hl_vardecl"><span class="mpre">mbarr#</span></span></a><span class="mpre"> #) -&gt;
       (# </span><a href="#loc_243_58_243_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_58_243_60&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a href="#loc_73_21_73_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_21_73_31&#39;)"><span class="hl_conref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">byteArrayContents#</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">unsafeCoerce#</span></span><span class="mpre"> </span><a href="#loc_243_62_243_68" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_62_243_68&#39;)"><span class="hl_varref"><span class="mpre">mbarr#</span></span></a><span class="mpre">))
                         (</span><a href="#loc_93_5_93_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_5_93_13&#39;)"><span class="hl_conref"><span class="mpre">PlainPtr</span></span></a><span class="mpre"> </span><a href="#loc_243_62_243_68" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_62_243_68&#39;)"><span class="hl_varref"><span class="mpre">mbarr#</span></span></a><span class="mpre">) #)
     }

</span><a href="#loc_252_1_252_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_1_252_23&#39;)"><span class="mpre">addForeignPtrFinalizer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FinalizerPtr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ^This function adds a finalizer to the given foreign object.  The</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- finalizer will run /before/ all other finalizers for the same</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- object which have already been registered.</span></span><span class="mpre">
</span><a name="loc_252_1_252_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_1_252_23&#39;)"><span class="hl_fundecl"><span class="mpre">addForeignPtrFinalizer</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">FunPtr</span></span><span class="mpre"> </span><a name="loc_252_32_252_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_32_252_34&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre">) (</span><a href="#loc_73_21_73_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_21_73_31&#39;)"><span class="hl_conref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><a name="loc_252_48_252_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_48_252_49&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_252_50_252_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_50_252_51&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre">) = case </span><a href="#loc_252_50_252_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_50_252_51&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> of
  </span><a href="#loc_91_5_91_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_5_91_20&#39;)"><span class="hl_conref"><span class="mpre">PlainForeignPtr</span></span></a><span class="mpre"> </span><a name="loc_253_19_253_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_19_253_20&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_257_5_257_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_5_257_6&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_253_19_253_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_19_253_20&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
  </span><a href="#loc_92_5_92_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_14&#39;)"><span class="hl_conref"><span class="mpre">MallocPtr</span></span></a><span class="mpre">     _ </span><a name="loc_254_19_254_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_19_254_20&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_257_5_257_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_5_257_6&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_254_19_254_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_19_254_20&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
  _ -&gt; </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;GHC.ForeignPtr: attempt to add a finalizer to a plain pointer&quot;</span></span><span class="mpre">
 where
    </span><a name="loc_257_5_257_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_5_257_6&#39;)"><span class="hl_fundecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_257_7_257_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_7_257_8&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = </span><a href="#loc_323_1_323_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_1_323_17&#39;)"><span class="hl_varref"><span class="mpre">insertCFinalizer</span></span></a><span class="mpre"> </span><a href="#loc_257_7_257_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_7_257_8&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><a href="#loc_252_32_252_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_32_252_34&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> 0# </span><span class="hl_varref"><span class="mpre">nullAddr#</span></span><span class="mpre"> </span><a href="#loc_252_48_252_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_48_252_49&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">

</span><a href="#loc_265_1_265_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_1_265_26&#39;)"><span class="mpre">addForeignPtrFinalizerEnv</span></a><span class="mpre"> ::
  </span><span class="hl_tyconref"><span class="mpre">FinalizerEnvPtr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">env</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">env</span></span><span class="mpre"> -&gt; </span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ^ Like &#39;addForeignPtrFinalizerEnv&#39; but allows the finalizer to be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- passed an additional environment parameter to be passed to the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- finalizer.  The environment passed to the finalizer is fixed by the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- second argument to &#39;addForeignPtrFinalizerEnv&#39;</span></span><span class="mpre">
</span><a name="loc_265_1_265_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_1_265_26&#39;)"><span class="hl_fundecl"><span class="mpre">addForeignPtrFinalizerEnv</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">FunPtr</span></span><span class="mpre"> </span><a name="loc_265_35_265_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_35_265_37&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre">) (</span><span class="hl_conref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><a name="loc_265_44_265_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_44_265_46&#39;)"><span class="hl_vardecl"><span class="mpre">ep</span></span></a><span class="mpre">) (</span><a href="#loc_73_21_73_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_21_73_31&#39;)"><span class="hl_conref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><a name="loc_265_60_265_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_60_265_61&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_265_62_265_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_62_265_63&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre">) = case </span><a href="#loc_265_62_265_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_62_265_63&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> of
  </span><a href="#loc_91_5_91_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_5_91_20&#39;)"><span class="hl_conref"><span class="mpre">PlainForeignPtr</span></span></a><span class="mpre"> </span><a name="loc_266_19_266_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_19_266_20&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_270_5_270_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_5_270_6&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_266_19_266_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_19_266_20&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
  </span><a href="#loc_92_5_92_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_14&#39;)"><span class="hl_conref"><span class="mpre">MallocPtr</span></span></a><span class="mpre">     _ </span><a name="loc_267_19_267_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_19_267_20&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_270_5_270_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_5_270_6&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_267_19_267_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_19_267_20&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
  _ -&gt; </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;GHC.ForeignPtr: attempt to add a finalizer to a plain pointer&quot;</span></span><span class="mpre">
 where
    </span><a name="loc_270_5_270_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_5_270_6&#39;)"><span class="hl_fundecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_270_7_270_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_7_270_8&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = </span><a href="#loc_323_1_323_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_1_323_17&#39;)"><span class="hl_varref"><span class="mpre">insertCFinalizer</span></span></a><span class="mpre"> </span><a href="#loc_270_7_270_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_7_270_8&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><a href="#loc_265_35_265_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_35_265_37&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> 1# </span><a href="#loc_265_44_265_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_44_265_46&#39;)"><span class="hl_varref"><span class="mpre">ep</span></span></a><span class="mpre"> </span><a href="#loc_265_60_265_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_60_265_61&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">

</span><a href="#loc_287_1_287_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_1_287_27&#39;)"><span class="mpre">addForeignPtrConcFinalizer</span></a><span class="mpre"> :: </span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ^This function adds a finalizer to the given @ForeignPtr@.  The</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- finalizer will run /before/ all other finalizers for the same</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- object which have already been registered.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This is a variant of @addForeignPtrFinalizer@, where the finalizer</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is an arbitrary @IO@ action.  When it is invoked, the finalizer</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- will run in a new thread.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- NB. Be very careful with these finalizers.  One common trap is that</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- if a finalizer references another finalized value, it does not</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- prevent that value from being finalized.  In particular, &#39;Handle&#39;s</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- are finalized objects, so a finalizer should not refer to a &#39;Handle&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (including @stdout@, @stdin@ or @stderr@).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a name="loc_287_1_287_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_1_287_27&#39;)"><span class="hl_fundecl"><span class="mpre">addForeignPtrConcFinalizer</span></span></a><span class="mpre"> (</span><a href="#loc_73_21_73_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_21_73_31&#39;)"><span class="hl_conref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> _ </span><a name="loc_287_42_287_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_42_287_43&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre">) </span><a name="loc_287_45_287_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_45_287_54&#39;)"><span class="hl_vardecl"><span class="mpre">finalizer</span></span></a><span class="mpre"> = 
  </span><a href="#loc_291_1_291_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_1_291_28&#39;)"><span class="hl_varref"><span class="mpre">addForeignPtrConcFinalizer_</span></span></a><span class="mpre"> </span><a href="#loc_287_42_287_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_42_287_43&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><a href="#loc_287_45_287_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_45_287_54&#39;)"><span class="hl_varref"><span class="mpre">finalizer</span></span></a><span class="mpre">

</span><a href="#loc_291_1_291_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_1_291_28&#39;)"><span class="mpre">addForeignPtrConcFinalizer_</span></a><span class="mpre"> :: </span><a href="#loc_90_6_90_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_6_90_24&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtrContents</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_291_1_291_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_1_291_28&#39;)"><span class="hl_fundecl"><span class="mpre">addForeignPtrConcFinalizer_</span></span></a><span class="mpre"> (</span><a href="#loc_91_5_91_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_5_91_20&#39;)"><span class="hl_conref"><span class="mpre">PlainForeignPtr</span></span></a><span class="mpre"> </span><a name="loc_291_46_291_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_46_291_47&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">) </span><a name="loc_291_49_291_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_49_291_58&#39;)"><span class="hl_vardecl"><span class="mpre">finalizer</span></span></a><span class="mpre"> = do
  </span><a name="loc_292_3_292_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_292_3_292_15&#39;)"><span class="hl_vardecl"><span class="mpre">noFinalizers</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_311_1_311_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_1_311_23&#39;)"><span class="hl_varref"><span class="mpre">insertHaskellFinalizer</span></span></a><span class="mpre"> </span><a href="#loc_291_46_291_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_46_291_47&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><a href="#loc_291_49_291_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_49_291_58&#39;)"><span class="hl_varref"><span class="mpre">finalizer</span></span></a><span class="mpre">
  if </span><a href="#loc_292_3_292_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_292_3_292_15&#39;)"><span class="hl_varref"><span class="mpre">noFinalizers</span></span></a><span class="mpre">
     then </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_294_17_294_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_17_294_18&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
              case </span><a href="#loc_291_46_291_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_46_291_47&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> of { </span><a href="GHC.IORef.html#loc_34_19_34_24" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_19_34_24&#39;)"><span class="hl_conref"><span class="mpre">IORef</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">STRef</span></span><span class="mpre"> </span><a name="loc_295_40_295_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_295_40_295_42&#39;)"><span class="hl_vardecl"><span class="mpre">r#</span></span></a><span class="mpre">) -&gt;
              case </span><span class="hl_varref"><span class="mpre">mkWeak#</span></span><span class="mpre"> </span><a href="#loc_295_40_295_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_295_40_295_42&#39;)"><span class="hl_varref"><span class="mpre">r#</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> (</span><a href="#loc_359_1_359_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_359_1_359_20&#39;)"><span class="hl_varref"><span class="mpre">foreignPtrFinalizer</span></span></a><span class="mpre"> </span><a href="#loc_291_46_291_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_46_291_47&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">) </span><a href="#loc_294_17_294_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_17_294_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of {  (# </span><a name="loc_296_69_296_71" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_296_69_296_71&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">, _ #) -&gt;
              (# </span><a href="#loc_296_69_296_71" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_296_69_296_71&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> #) }}
     else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
</span><a href="#loc_291_1_291_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_1_291_28&#39;)"><span class="hl_fundecl"><span class="mpre">addForeignPtrConcFinalizer_</span></span></a><span class="mpre"> </span><a name="loc_299_29_299_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_29_299_30&#39;)"><span class="hl_specname"><span class="mpre">f</span></span></a><span class="mpre">@(</span><a href="#loc_92_5_92_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_14&#39;)"><span class="hl_conref"><span class="mpre">MallocPtr</span></span></a><span class="mpre"> </span><a name="loc_299_42_299_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_42_299_44&#39;)"><span class="hl_vardecl"><span class="mpre">fo</span></span></a><span class="mpre"> </span><a name="loc_299_45_299_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_45_299_46&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">) </span><a name="loc_299_48_299_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_48_299_57&#39;)"><span class="hl_vardecl"><span class="mpre">finalizer</span></span></a><span class="mpre"> = do
  </span><a name="loc_300_3_300_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_300_3_300_15&#39;)"><span class="hl_vardecl"><span class="mpre">noFinalizers</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_311_1_311_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_1_311_23&#39;)"><span class="hl_varref"><span class="mpre">insertHaskellFinalizer</span></span></a><span class="mpre"> </span><a href="#loc_299_45_299_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_45_299_46&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><a href="#loc_299_48_299_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_48_299_57&#39;)"><span class="hl_varref"><span class="mpre">finalizer</span></span></a><span class="mpre">
  if </span><a href="#loc_300_3_300_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_300_3_300_15&#39;)"><span class="hl_varref"><span class="mpre">noFinalizers</span></span></a><span class="mpre">
     then  </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_302_18_302_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_18_302_19&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; 
               case </span><span class="hl_varref"><span class="mpre">mkWeak#</span></span><span class="mpre"> </span><a href="#loc_299_42_299_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_42_299_44&#39;)"><span class="hl_varref"><span class="mpre">fo</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> (do </span><a href="#loc_359_1_359_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_359_1_359_20&#39;)"><span class="hl_varref"><span class="mpre">foreignPtrFinalizer</span></span></a><span class="mpre"> </span><a href="#loc_299_45_299_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_45_299_46&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">; </span><a href="#loc_403_1_403_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_1_403_6&#39;)"><span class="hl_varref"><span class="mpre">touch</span></span></a><span class="mpre"> </span><a href="#loc_299_29_299_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_29_299_30&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">) </span><a href="#loc_302_18_302_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_18_302_19&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
                  (# </span><a name="loc_304_22_304_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_22_304_24&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">, _ #) -&gt; (# </span><a href="#loc_304_22_304_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_22_304_24&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> #)
     else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><a href="#loc_291_1_291_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_1_291_28&#39;)"><span class="hl_fundecl"><span class="mpre">addForeignPtrConcFinalizer_</span></span></a><span class="mpre"> _ _ =
  </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;GHC.ForeignPtr: attempt to add a finalizer to plain pointer&quot;</span></span><span class="mpre">

</span><a href="#loc_311_1_311_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_1_311_23&#39;)"><span class="mpre">insertHaskellFinalizer</span></a><span class="mpre"> :: </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><a href="#loc_85_6_85_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_16&#39;)"><span class="hl_tyconref"><span class="mpre">Finalizers</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_311_1_311_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_1_311_23&#39;)"><span class="hl_fundecl"><span class="mpre">insertHaskellFinalizer</span></span></a><span class="mpre"> </span><a name="loc_311_24_311_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_24_311_25&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> </span><a name="loc_311_26_311_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_26_311_27&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = do
  !</span><a name="loc_312_4_312_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_4_312_12&#39;)"><span class="hl_vardecl"><span class="mpre">wasEmpty</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_53_1_53_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_53_1_53_18&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef</span></span></a><span class="mpre"> </span><a href="#loc_311_24_311_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_24_311_25&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_312_39_312_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_39_312_49&#39;)"><span class="hl_vardecl"><span class="mpre">finalizers</span></span></a><span class="mpre"> -&gt; case </span><a href="#loc_312_39_312_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_39_312_49&#39;)"><span class="hl_varref"><span class="mpre">finalizers</span></span></a><span class="mpre"> of
      </span><a href="#loc_86_5_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_17&#39;)"><span class="hl_conref"><span class="mpre">NoFinalizers</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_88_5_88_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_5_88_22&#39;)"><span class="hl_conref"><span class="mpre">HaskellFinalizers</span></span></a><span class="mpre"> [</span><a href="#loc_311_26_311_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_26_311_27&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">], </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">)
      </span><a href="#loc_88_5_88_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_5_88_22&#39;)"><span class="hl_conref"><span class="mpre">HaskellFinalizers</span></span></a><span class="mpre"> </span><a name="loc_314_25_314_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_314_25_314_27&#39;)"><span class="hl_vardecl"><span class="mpre">fs</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_88_5_88_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_5_88_22&#39;)"><span class="hl_conref"><span class="mpre">HaskellFinalizers</span></span></a><span class="mpre"> (</span><a href="#loc_311_26_311_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_26_311_27&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_314_25_314_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_314_25_314_27&#39;)"><span class="hl_varref"><span class="mpre">fs</span></span></a><span class="mpre">), </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">)
      _ -&gt; </span><a href="#loc_354_1_354_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_1_354_14&#39;)"><span class="hl_varref"><span class="mpre">noMixingError</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_312_4_312_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_4_312_12&#39;)"><span class="hl_varref"><span class="mpre">wasEmpty</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A box around Weak#, private to this module.</span></span><span class="mpre">
data </span><a name="loc_319_6_319_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_319_6_319_12&#39;)"><span class="hl_tycondecl"><span class="mpre">MyWeak</span></span></a><span class="mpre"> = </span><a name="loc_319_15_319_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_319_15_319_21&#39;)"><span class="hl_condecl"><span class="mpre">MyWeak</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Weak#</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)

</span><a href="#loc_323_1_323_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_1_323_17&#39;)"><span class="mpre">insertCFinalizer</span></a><span class="mpre"> ::
  </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><a href="#loc_85_6_85_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_16&#39;)"><span class="hl_tyconref"><span class="mpre">Finalizers</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Addr#</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int#</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Addr#</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Addr#</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_323_1_323_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_1_323_17&#39;)"><span class="hl_fundecl"><span class="mpre">insertCFinalizer</span></span></a><span class="mpre"> </span><a name="loc_323_18_323_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_18_323_19&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> </span><a name="loc_323_20_323_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_20_323_22&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a name="loc_323_23_323_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_23_323_27&#39;)"><span class="hl_vardecl"><span class="mpre">flag</span></span></a><span class="mpre"> </span><a name="loc_323_28_323_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_28_323_30&#39;)"><span class="hl_vardecl"><span class="mpre">ep</span></span></a><span class="mpre"> </span><a name="loc_323_31_323_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_31_323_32&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = do
  </span><a href="#loc_319_15_319_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_319_15_319_21&#39;)"><span class="hl_conref"><span class="mpre">MyWeak</span></span></a><span class="mpre"> </span><a name="loc_324_10_324_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_10_324_11&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_335_1_335_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_1_335_21&#39;)"><span class="hl_varref"><span class="mpre">ensureCFinalizerWeak</span></span></a><span class="mpre"> </span><a href="#loc_323_18_323_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_18_323_19&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
  </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_325_9_325_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_325_9_325_10&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; case </span><span class="hl_varref"><span class="mpre">addCFinalizerToWeak#</span></span><span class="mpre"> </span><a href="#loc_323_20_323_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_20_323_22&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a href="#loc_323_31_323_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_31_323_32&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_323_23_323_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_23_323_27&#39;)"><span class="hl_varref"><span class="mpre">flag</span></span></a><span class="mpre"> </span><a href="#loc_323_28_323_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_28_323_30&#39;)"><span class="hl_varref"><span class="mpre">ep</span></span></a><span class="mpre"> </span><a href="#loc_324_10_324_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_10_324_11&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><a href="#loc_325_9_325_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_325_9_325_10&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
      (# </span><a name="loc_326_10_326_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_326_10_326_12&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">, 1# #) -&gt; (# </span><a href="#loc_326_10_326_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_326_10_326_12&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> #)

      </span><span class="hl_comment"><span class="mpre">-- Failed to add the finalizer because some other thread</span></span><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">-- has finalized w by calling foreignPtrFinalizer. We retry now.</span></span><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">-- This won&#39;t be an infinite loop because that thread must have</span></span><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">-- replaced the content of r before calling finalizeWeak#.</span></span><span class="mpre">
      (# </span><a name="loc_332_10_332_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_10_332_12&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">, _ #) -&gt; </span><span class="hl_varref"><span class="mpre">unIO</span></span><span class="mpre"> (</span><a href="#loc_323_1_323_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_1_323_17&#39;)"><span class="hl_varref"><span class="mpre">insertCFinalizer</span></span></a><span class="mpre"> </span><a href="#loc_323_18_323_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_18_323_19&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><a href="#loc_323_20_323_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_20_323_22&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a href="#loc_323_23_323_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_23_323_27&#39;)"><span class="hl_varref"><span class="mpre">flag</span></span></a><span class="mpre"> </span><a href="#loc_323_28_323_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_28_323_30&#39;)"><span class="hl_varref"><span class="mpre">ep</span></span></a><span class="mpre"> </span><a href="#loc_323_31_323_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_31_323_32&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">) </span><a href="#loc_332_10_332_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_10_332_12&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre">

</span><a href="#loc_335_1_335_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_1_335_21&#39;)"><span class="mpre">ensureCFinalizerWeak</span></a><span class="mpre"> :: </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><a href="#loc_85_6_85_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_16&#39;)"><span class="hl_tyconref"><span class="mpre">Finalizers</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_319_6_319_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_319_6_319_12&#39;)"><span class="hl_tyconref"><span class="mpre">MyWeak</span></span></a><span class="mpre">
</span><a name="loc_335_1_335_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_1_335_21&#39;)"><span class="hl_fundecl"><span class="mpre">ensureCFinalizerWeak</span></span></a><span class="mpre"> </span><a name="loc_335_22_335_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_22_335_25&#39;)"><span class="hl_specname"><span class="mpre">ref</span></span></a><span class="mpre">@(</span><a href="GHC.IORef.html#loc_34_19_34_24" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_19_34_24&#39;)"><span class="hl_conref"><span class="mpre">IORef</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">STRef</span></span><span class="mpre"> </span><a name="loc_335_40_335_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_40_335_42&#39;)"><span class="hl_vardecl"><span class="mpre">r#</span></span></a><span class="mpre">)) = do
  </span><a name="loc_336_3_336_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_336_3_336_6&#39;)"><span class="hl_vardecl"><span class="mpre">fin</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_335_22_335_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_22_335_25&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">
  case </span><a href="#loc_336_3_336_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_336_3_336_6&#39;)"><span class="hl_varref"><span class="mpre">fin</span></span></a><span class="mpre"> of
      </span><a href="#loc_87_5_87_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_16&#39;)"><span class="hl_conref"><span class="mpre">CFinalizers</span></span></a><span class="mpre"> </span><a name="loc_338_19_338_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_19_338_23&#39;)"><span class="hl_vardecl"><span class="mpre">weak</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_319_15_319_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_319_15_319_21&#39;)"><span class="hl_conref"><span class="mpre">MyWeak</span></span></a><span class="mpre"> </span><a href="#loc_338_19_338_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_19_338_23&#39;)"><span class="hl_varref"><span class="mpre">weak</span></span></a><span class="mpre">)
      </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 339, srcSpanStartColumn = 7, srcSpanEndLine = 339, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 339, srcSpanStartColumn = 24, srcSpanEndLine = 339, srcSpanEndColumn = 25},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/ForeignPtr.hs&quot;, srcSpanStartLine = 339, srcSpan"><span class="mpre">HaskellFinalizers{}</span></span><span class="mpre"> -&gt; </span><a href="#loc_354_1_354_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_1_354_14&#39;)"><span class="hl_varref"><span class="mpre">noMixingError</span></span></a><span class="mpre">
      </span><a href="#loc_86_5_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_17&#39;)"><span class="hl_conref"><span class="mpre">NoFinalizers</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_340_29_340_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_340_29_340_30&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
          case </span><span class="hl_varref"><span class="mpre">mkWeakNoFinalizer#</span></span><span class="mpre"> </span><a href="#loc_335_40_335_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_40_335_42&#39;)"><span class="hl_varref"><span class="mpre">r#</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> </span><a href="#loc_340_29_340_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_340_29_340_30&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of { (# </span><a name="loc_341_51_341_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_341_51_341_53&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">, </span><a name="loc_341_55_341_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_341_55_341_56&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> #) -&gt;
          case </span><span class="hl_varref"><span class="mpre">atomicModifyMutVar#</span></span><span class="mpre"> </span><a href="#loc_335_40_335_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_40_335_42&#39;)"><span class="hl_varref"><span class="mpre">r#</span></span></a><span class="mpre"> (</span><a href="#loc_349_7_349_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_7_349_13&#39;)"><span class="hl_varref"><span class="mpre">update</span></span></a><span class="mpre"> </span><a href="#loc_341_55_341_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_341_55_341_56&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">) </span><a href="#loc_341_51_341_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_341_51_341_53&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre"> of
              { (# </span><a name="loc_343_20_343_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_20_343_22&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">, (</span><a name="loc_343_25_343_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_25_343_29&#39;)"><span class="hl_vardecl"><span class="mpre">weak</span></span></a><span class="mpre">, </span><a name="loc_343_31_343_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_31_343_39&#39;)"><span class="hl_vardecl"><span class="mpre">needKill</span></span></a><span class="mpre"> ) #) -&gt;
          if </span><a href="#loc_343_31_343_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_31_343_39&#39;)"><span class="hl_varref"><span class="mpre">needKill</span></span></a><span class="mpre">
            then case </span><span class="hl_varref"><span class="mpre">finalizeWeak#</span></span><span class="mpre"> </span><a href="#loc_341_55_341_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_341_55_341_56&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><a href="#loc_343_20_343_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_20_343_22&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre"> of { (# </span><a name="loc_345_50_345_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_345_50_345_52&#39;)"><span class="hl_vardecl"><span class="mpre">s3</span></span></a><span class="mpre">, _, _ #) -&gt;
              (# </span><a href="#loc_345_50_345_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_345_50_345_52&#39;)"><span class="hl_varref"><span class="mpre">s3</span></span></a><span class="mpre">, </span><a href="#loc_343_25_343_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_25_343_29&#39;)"><span class="hl_varref"><span class="mpre">weak</span></span></a><span class="mpre"> #) }
            else (# </span><a href="#loc_343_20_343_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_20_343_22&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre">, </span><a href="#loc_343_25_343_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_25_343_29&#39;)"><span class="hl_varref"><span class="mpre">weak</span></span></a><span class="mpre"> #) }}
  where
      </span><a name="loc_349_7_349_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_7_349_13&#39;)"><span class="hl_fundecl"><span class="mpre">update</span></span></a><span class="mpre"> _ </span><a name="loc_349_16_349_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_16_349_19&#39;)"><span class="hl_specname"><span class="mpre">fin</span></span></a><span class="mpre">@(</span><a href="#loc_87_5_87_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_16&#39;)"><span class="hl_conref"><span class="mpre">CFinalizers</span></span></a><span class="mpre"> </span><a name="loc_349_33_349_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_33_349_34&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre">) = (</span><a href="#loc_349_16_349_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_16_349_19&#39;)"><span class="hl_varref"><span class="mpre">fin</span></span></a><span class="mpre">, (</span><a href="#loc_319_15_319_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_319_15_319_21&#39;)"><span class="hl_conref"><span class="mpre">MyWeak</span></span></a><span class="mpre"> </span><a href="#loc_349_33_349_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_33_349_34&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">))
      </span><a href="#loc_349_7_349_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_7_349_13&#39;)"><span class="hl_fundecl"><span class="mpre">update</span></span></a><span class="mpre"> </span><a name="loc_350_14_350_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_14_350_15&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> </span><a href="#loc_86_5_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_17&#39;)"><span class="hl_conref"><span class="mpre">NoFinalizers</span></span></a><span class="mpre"> = (</span><a href="#loc_87_5_87_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_16&#39;)"><span class="hl_conref"><span class="mpre">CFinalizers</span></span></a><span class="mpre"> </span><a href="#loc_350_14_350_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_14_350_15&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">, (</span><a href="#loc_319_15_319_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_319_15_319_21&#39;)"><span class="hl_conref"><span class="mpre">MyWeak</span></span></a><span class="mpre"> </span><a href="#loc_350_14_350_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_14_350_15&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">))
      </span><a href="#loc_349_7_349_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_7_349_13&#39;)"><span class="hl_fundecl"><span class="mpre">update</span></span></a><span class="mpre"> _ _ = </span><a href="#loc_354_1_354_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_1_354_14&#39;)"><span class="hl_varref"><span class="mpre">noMixingError</span></span></a><span class="mpre">

</span><a href="#loc_354_1_354_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_1_354_14&#39;)"><span class="mpre">noMixingError</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_354_1_354_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_1_354_14&#39;)"><span class="hl_vardecl"><span class="mpre">noMixingError</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
   </span><span class="hl_string"><span class="mpre">&quot;GHC.ForeignPtr: attempt to mix Haskell and C finalizers &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">
   </span><span class="hl_string"><span class="mpre">&quot;in the same ForeignPtr&quot;</span></span><span class="mpre">

</span><a href="#loc_359_1_359_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_359_1_359_20&#39;)"><span class="mpre">foreignPtrFinalizer</span></a><span class="mpre"> :: </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><a href="#loc_85_6_85_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_16&#39;)"><span class="hl_tyconref"><span class="mpre">Finalizers</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_359_1_359_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_359_1_359_20&#39;)"><span class="hl_fundecl"><span class="mpre">foreignPtrFinalizer</span></span></a><span class="mpre"> </span><a name="loc_359_21_359_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_359_21_359_22&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = do
  </span><a name="loc_360_3_360_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_3_360_5&#39;)"><span class="hl_vardecl"><span class="mpre">fs</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_53_1_53_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_53_1_53_18&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef</span></span></a><span class="mpre"> </span><a href="#loc_359_21_359_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_359_21_359_22&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_360_32_360_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_32_360_34&#39;)"><span class="hl_vardecl"><span class="mpre">fs</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_86_5_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_17&#39;)"><span class="hl_conref"><span class="mpre">NoFinalizers</span></span></a><span class="mpre">, </span><a href="#loc_360_32_360_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_32_360_34&#39;)"><span class="hl_varref"><span class="mpre">fs</span></span></a><span class="mpre">) </span><span class="hl_comment"><span class="mpre">-- atomic, see #7170</span></span><span class="mpre">
  case </span><a href="#loc_360_3_360_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_3_360_5&#39;)"><span class="hl_varref"><span class="mpre">fs</span></span></a><span class="mpre"> of
    </span><a href="#loc_86_5_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_17&#39;)"><span class="hl_conref"><span class="mpre">NoFinalizers</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    </span><a href="#loc_87_5_87_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_16&#39;)"><span class="hl_conref"><span class="mpre">CFinalizers</span></span></a><span class="mpre"> </span><a name="loc_363_17_363_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_363_17_363_18&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_363_28_363_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_363_28_363_29&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; case </span><span class="hl_varref"><span class="mpre">finalizeWeak#</span></span><span class="mpre"> </span><a href="#loc_363_17_363_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_363_17_363_18&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><a href="#loc_363_28_363_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_363_28_363_29&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
        (# </span><a name="loc_364_12_364_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_364_12_364_14&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">, 1#, </span><a name="loc_364_20_364_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_364_20_364_21&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> #) -&gt; </span><a href="#loc_364_20_364_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_364_20_364_21&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_364_12_364_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_364_12_364_14&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre">
        (# </span><a name="loc_365_12_365_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_365_12_365_14&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">, _, _ #) -&gt; (# </span><a href="#loc_365_12_365_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_365_12_365_14&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> #)
    </span><a href="#loc_88_5_88_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_5_88_22&#39;)"><span class="hl_conref"><span class="mpre">HaskellFinalizers</span></span></a><span class="mpre"> </span><a name="loc_366_23_366_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_366_23_366_30&#39;)"><span class="hl_vardecl"><span class="mpre">actions</span></span></a><span class="mpre"> -&gt; </span><a href="Control.Monad.html#loc_106_1_106_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_106_1_106_10&#39;)"><span class="hl_varref"><span class="mpre">sequence_</span></span></a><span class="mpre"> </span><a href="#loc_366_23_366_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_366_23_366_30&#39;)"><span class="hl_varref"><span class="mpre">actions</span></span></a><span class="mpre">

</span><a href="#loc_371_1_371_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_1_371_15&#39;)"><span class="mpre">newForeignPtr_</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><span class="hl_comment"><span class="mpre">-- ^Turns a plain memory reference into a foreign pointer that may be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- associated with finalizers by using &#39;addForeignPtrFinalizer&#39;.</span></span><span class="mpre">
</span><a name="loc_371_1_371_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_1_371_15&#39;)"><span class="hl_fundecl"><span class="mpre">newForeignPtr_</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><a name="loc_371_21_371_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_21_371_24&#39;)"><span class="hl_vardecl"><span class="mpre">obj</span></span></a><span class="mpre">) =  do
  </span><a name="loc_372_3_372_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_3_372_4&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_86_5_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_17&#39;)"><span class="hl_conref"><span class="mpre">NoFinalizers</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_73_21_73_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_21_73_31&#39;)"><span class="hl_conref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_371_21_371_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_21_371_24&#39;)"><span class="hl_varref"><span class="mpre">obj</span></span></a><span class="mpre"> (</span><a href="#loc_91_5_91_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_5_91_20&#39;)"><span class="hl_conref"><span class="mpre">PlainForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_372_3_372_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_3_372_4&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">))

</span><a href="#loc_400_1_400_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_1_400_16&#39;)"><span class="mpre">touchForeignPtr</span></a><span class="mpre"> :: </span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ^This function ensures that the foreign object in</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- question is alive at the given place in the sequence of IO</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- actions. In particular &#39;Foreign.ForeignPtr.withForeignPtr&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- does a &#39;touchForeignPtr&#39; after it</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- executes the user action.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that this function should not be used to express dependencies</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- between finalizers on &#39;ForeignPtr&#39;s.  For example, if the finalizer</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- for a &#39;ForeignPtr&#39; @F1@ calls &#39;touchForeignPtr&#39; on a second</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;ForeignPtr&#39; @F2@, then the only guarantee is that the finalizer</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- for @F2@ is never started before the finalizer for @F1@.  They</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- might be started together if for example both @F1@ and @F2@ are</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- otherwise unreachable, and in that case the scheduler might end up</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- running the finalizer for @F2@ first.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- In general, it is not recommended to use finalizers on separate</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- objects with ordering constraints between them.  To express the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ordering robustly requires explicit synchronisation using @MVar@s</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- between the finalizers, but even then the runtime sometimes runs</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- multiple finalizers sequentially in a single thread (for</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- performance reasons), so synchronisation between finalizers could</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- result in artificial deadlock.  Another alternative is to use</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- explicit reference counting.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a name="loc_400_1_400_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_1_400_16&#39;)"><span class="hl_fundecl"><span class="mpre">touchForeignPtr</span></span></a><span class="mpre"> (</span><a href="#loc_73_21_73_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_21_73_31&#39;)"><span class="hl_conref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> _ </span><a name="loc_400_31_400_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_31_400_32&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">) = </span><a href="#loc_403_1_403_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_1_403_6&#39;)"><span class="hl_varref"><span class="mpre">touch</span></span></a><span class="mpre"> </span><a href="#loc_400_31_400_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_31_400_32&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

</span><a href="#loc_403_1_403_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_1_403_6&#39;)"><span class="mpre">touch</span></a><span class="mpre"> :: </span><a href="#loc_90_6_90_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_6_90_24&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtrContents</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_403_1_403_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_1_403_6&#39;)"><span class="hl_fundecl"><span class="mpre">touch</span></span></a><span class="mpre"> </span><a name="loc_403_7_403_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_7_403_8&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_403_17_403_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_17_403_18&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; case </span><span class="hl_varref"><span class="mpre">touch#</span></span><span class="mpre"> </span><a href="#loc_403_7_403_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_7_403_8&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><a href="#loc_403_17_403_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_17_403_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of </span><a name="loc_403_41_403_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_41_403_43&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre"> -&gt; (# </span><a href="#loc_403_41_403_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_403_41_403_43&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> #)

</span><a href="#loc_420_1_420_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_1_420_22&#39;)"><span class="mpre">unsafeForeignPtrToPtr</span></a><span class="mpre"> :: </span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ^This function extracts the pointer component of a foreign</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- pointer.  This is a potentially dangerous operations, as if the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- argument to &#39;unsafeForeignPtrToPtr&#39; is the last usage</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- occurrence of the given foreign pointer, then its finalizer(s) will</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- be run, which potentially invalidates the plain pointer just</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- obtained.  Hence, &#39;touchForeignPtr&#39; must be used</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- wherever it has to be guaranteed that the pointer lives on - i.e.,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- has another usage occurrence.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- To avoid subtle coding errors, hand written marshalling code</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- should preferably use &#39;Foreign.ForeignPtr.withForeignPtr&#39; rather</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- than combinations of &#39;unsafeForeignPtrToPtr&#39; and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;touchForeignPtr&#39;.  However, the latter routines</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- are occasionally preferred in tool generated marshalling code.</span></span><span class="mpre">
</span><a name="loc_420_1_420_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_1_420_22&#39;)"><span class="hl_fundecl"><span class="mpre">unsafeForeignPtrToPtr</span></span></a><span class="mpre"> (</span><a href="#loc_73_21_73_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_21_73_31&#39;)"><span class="hl_conref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><a name="loc_420_35_420_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_35_420_37&#39;)"><span class="hl_vardecl"><span class="mpre">fo</span></span></a><span class="mpre"> _) = </span><span class="hl_conref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><a href="#loc_420_35_420_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_35_420_37&#39;)"><span class="hl_varref"><span class="mpre">fo</span></span></a><span class="mpre">

</span><a href="#loc_425_1_425_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_425_1_425_15&#39;)"><span class="mpre">castForeignPtr</span></a><span class="mpre"> :: </span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ^This function casts a &#39;ForeignPtr&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- parameterised by one type into another type.</span></span><span class="mpre">
</span><a name="loc_425_1_425_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_425_1_425_15&#39;)"><span class="hl_fundecl"><span class="mpre">castForeignPtr</span></span></a><span class="mpre"> </span><a name="loc_425_16_425_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_425_16_425_17&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">unsafeCoerce#</span></span><span class="mpre"> </span><a href="#loc_425_16_425_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_425_16_425_17&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Causes the finalizers associated with a foreign pointer to be run</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- immediately.</span></span><span class="mpre">
</span><a href="#loc_430_1_430_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_430_1_430_19&#39;)"><span class="mpre">finalizeForeignPtr</span></a><span class="mpre"> :: </span><a href="#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_430_1_430_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_430_1_430_19&#39;)"><span class="hl_fundecl"><span class="mpre">finalizeForeignPtr</span></span></a><span class="mpre"> (</span><a href="#loc_73_21_73_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_21_73_31&#39;)"><span class="hl_conref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> _ (</span><a href="#loc_93_5_93_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_5_93_13&#39;)"><span class="hl_conref"><span class="mpre">PlainPtr</span></span></a><span class="mpre"> _)) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- no effect</span></span><span class="mpre">
</span><a href="#loc_430_1_430_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_430_1_430_19&#39;)"><span class="hl_fundecl"><span class="mpre">finalizeForeignPtr</span></span></a><span class="mpre"> (</span><a href="#loc_73_21_73_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_21_73_31&#39;)"><span class="hl_conref"><span class="mpre">ForeignPtr</span></span></a><span class="mpre"> _ </span><a name="loc_431_34_431_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_34_431_44&#39;)"><span class="hl_vardecl"><span class="mpre">foreignPtr</span></span></a><span class="mpre">) = </span><a href="#loc_359_1_359_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_359_1_359_20&#39;)"><span class="hl_varref"><span class="mpre">foreignPtrFinalizer</span></span></a><span class="mpre"> </span><a href="#loc_433_17_433_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_433_17_433_30&#39;)"><span class="hl_varref"><span class="mpre">refFinalizers</span></span></a><span class="mpre">
        where
                </span><a name="loc_433_17_433_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_433_17_433_30&#39;)"><span class="hl_vardecl"><span class="mpre">refFinalizers</span></span></a><span class="mpre"> = case </span><a href="#loc_431_34_431_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_34_431_44&#39;)"><span class="hl_varref"><span class="mpre">foreignPtr</span></span></a><span class="mpre"> of
                        (</span><a href="#loc_91_5_91_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_5_91_20&#39;)"><span class="hl_conref"><span class="mpre">PlainForeignPtr</span></span></a><span class="mpre"> </span><a name="loc_434_42_434_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_42_434_45&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre">) -&gt; </span><a href="#loc_434_42_434_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_42_434_45&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">
                        (</span><a href="#loc_92_5_92_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_14&#39;)"><span class="hl_conref"><span class="mpre">MallocPtr</span></span></a><span class="mpre">     _ </span><a name="loc_435_42_435_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_435_42_435_45&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre">) -&gt; </span><a href="#loc_435_42_435_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_435_42_435_45&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">
                        </span><a href="#loc_93_5_93_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_5_93_13&#39;)"><span class="hl_conref"><span class="mpre">PlainPtr</span></span></a><span class="mpre"> _            -&gt;
                            </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;finalizeForeignPtr PlainPtr&quot;</span></span><span class="mpre">

</span></div></body></html>