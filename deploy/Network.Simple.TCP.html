<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE CPP #-}

</span><span class="hl_comment"><span class="mpre">-- | This module exports functions that abstract simple TCP &#39;NS.Socket&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- usage patterns.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This module uses &#39;MonadIO&#39; and &#39;C.MonadMask&#39; extensively so that you can</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- reuse these functions in monads other than &#39;IO&#39;. However, if you don&#39;t care</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- about any of that, just pretend you are using the &#39;IO&#39; monad all the time</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- and everything will work as expected.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Some code in this file was adapted from the @pipes-network@ library by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Renzo Carbonara. Copyright (c) 2012-2013. See its licensing terms (BSD3) at:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   https://github.com/k0001/pipes-network/blob/master/LICENSE</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Some code in this file was adapted from the @network-conduit@ library by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Michael Snoyman. Copyright (c) 2011. See its licensing terms (BSD3) at:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   https://github.com/snoyberg/conduit/blob/master/network-conduit/LICENSE</span></span><span class="mpre">

module Network.Simple.TCP (
  </span><span class="hl_comment"><span class="mpre">-- * Introduction to TCP networking</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- $tcp-101</span></span><span class="mpre">

  </span><span class="hl_comment"><span class="mpre">-- * Client side</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- $client-side</span></span><span class="mpre">
    connect

  </span><span class="hl_comment"><span class="mpre">-- * Server side</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- $server-side</span></span><span class="mpre">
  , serve
  </span><span class="hl_comment"><span class="mpre">-- ** Listening</span></span><span class="mpre">
  , listen
  </span><span class="hl_comment"><span class="mpre">-- ** Accepting</span></span><span class="mpre">
  , accept
  , acceptFork

  </span><span class="hl_comment"><span class="mpre">-- * Utils</span></span><span class="mpre">
  , recv
  , send

  </span><span class="hl_comment"><span class="mpre">-- * Low level support</span></span><span class="mpre">
  , bindSock
  , connectSock
  , closeSock

  </span><span class="hl_comment"><span class="mpre">-- * Note to Windows users</span></span><span class="mpre">
  , NS.withSocketsDo

  </span><span class="hl_comment"><span class="mpre">-- * Types</span></span><span class="mpre">
  , HostPreference(..)
  </span><span class="hl_comment"><span class="mpre">-- ** Re-exported from @Network.Socket@</span></span><span class="mpre">
  , NS.HostName
  , NS.ServiceName
  , NS.Socket
  , NS.SockAddr
  ) where

import           </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 57, srcSpanStartColumn = 18, srcSpanEndLine = 57, srcSpanEndColumn = 36}, srcInfoPoints = []}) &quot;Control.Concurrent&quot;"><span class="mpre">Control.Concurrent</span></span><span class="mpre">             (ThreadId, forkIO)
import qualified Control.Exception              as E
import qualified Control.Monad.Catch            as C
import           Control.Monad
import           Control.Monad.IO.Class         (</span><a href="Control.Monad.IO.Class.html#loc_30_20_30_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_30_20_30_27&#39;)"><span class="mpre">MonadIO</span></a><span class="mpre">(</span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="mpre">liftIO</span></a><span class="mpre">))
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 62, srcSpanStartColumn = 18, srcSpanEndLine = 62, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre">                as BS
import           Data.List                      (</span><a href="Data.List.html#loc_464_1_464_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_464_1_464_10&#39;)"><span class="mpre">partition</span></a><span class="mpre">)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 64, srcSpanStartColumn = 18, srcSpanEndLine = 64, srcSpanEndColumn = 32}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre">                 as NS
import           Network.Simple.Internal
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 66, srcSpanStartColumn = 18, srcSpanEndLine = 66, srcSpanEndColumn = 43}, srcInfoPoints = []}) &quot;Network.Socket.ByteString&quot;"><span class="mpre">Network.Socket.ByteString</span></span><span class="mpre">      as NSB

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- $tcp-101</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This introduction aims to give you a overly simplified overview of some</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- concepts you need to know about TCP sockets in order to make effective use of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- this module.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- There are two ends in a single TCP connection: one is the TCP «server» and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the other is the TCP «client». Each end is uniquely identified by an IP</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- address and a TCP port pair, and each end knows the IP address and TCP port</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- of the other end. Each end can send and receive data to and from the other</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- end.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A TCP server, once «bound» to a well-known IP address and TCP port, starts</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- «listening» for incoming connections from TCP clients to such bound IP</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- address and TCP port. When a TCP client attempts to connect to the TCP</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- server, the TCP server must «accept» the incoming connection in order to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- start exchanging data with the remote end. A single TCP server can</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- sequentially accept many incoming connections, possibly handling each one</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- concurrently.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A TCP client can «connect» to a well-known IP address and TCP port previously</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- bound by a listening TCP server willing to accept new incoming connections.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Once the connection is established, the TCP client can immediately start</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exchanging data with the TCP server. The TCP client is randomly assigned a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- TCP port when connecting, and its IP address is selected by the operating</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- system so that it is reachable from the remote end.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The TCP client a and the TCP server can be running in the same host or in</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- different hosts.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- $client-side</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Here&#39;s how you could run a TCP client:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;connect&#39; \&quot;www.example.org\&quot; \&quot;80\&quot; $ \\(connectionSocket, remoteAddr) -&gt; do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   putStrLn $ \&quot;Connection established to \&quot; ++ show remoteAddr</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   -- Now you may use connectionSocket as you please within this scope,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   -- possibly using &#39;recv&#39; and &#39;send&#39; to interact with the remote end.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Connect to a TCP server and use the connection.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The connection socket is closed when done or in case of exceptions.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If you prefer to acquire and close the socket yourself, then use</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;connectSock&#39; and &#39;closeSock&#39;.</span></span><span class="mpre">
</span><a href="#loc_126_1_126_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_8&#39;)"><span class="mpre">connect</span></a><span class="mpre">
  :: </span><span class="warning" data-warning="ContextCxTuple (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 119, srcSpanStartColumn = 6, srcSpanEndLine = 120, srcSpanEndColumn = 5}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 119, srcSpanStartColumn = 6, srcSpanEndLine = 119, srcSpanEndColumn = 7},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simpl"><span class="mpre">(MonadIO m, C.MonadMask m)
  =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">NS.HostName</span></span><span class="mpre">      </span><span class="hl_comment"><span class="mpre">-- ^Server hostname.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyconref"><span class="mpre">NS.ServiceName</span></span><span class="mpre">   </span><span class="hl_comment"><span class="mpre">-- ^Server service port.</span></span><span class="mpre">
  -&gt; ((</span><span class="hl_tyconref"><span class="mpre">NS.Socket</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">NS.SockAddr</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">)
                      </span><span class="hl_comment"><span class="mpre">-- ^Computation taking the communication socket</span></span><span class="mpre">
                      </span><span class="hl_comment"><span class="mpre">-- and the server address.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">
</span><a name="loc_126_1_126_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_8&#39;)"><span class="hl_fundecl"><span class="mpre">connect</span></span></a><span class="mpre"> </span><a name="loc_126_9_126_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_9_126_13&#39;)"><span class="hl_vardecl"><span class="mpre">host</span></span></a><span class="mpre"> </span><a name="loc_126_14_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_14_126_18&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> = </span><a href="Control.Monad.Catch.html#loc_413_1_413_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Catch.html#loc_413_1_413_8&#39;)"><span class="hl_varref"><span class="mpre">C.bracket</span></span></a><span class="mpre"> (</span><a href="#loc_245_1_245_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_1_245_12&#39;)"><span class="hl_varref"><span class="mpre">connectSock</span></span></a><span class="mpre"> </span><a href="#loc_126_9_126_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_9_126_13&#39;)"><span class="hl_varref"><span class="mpre">host</span></span></a><span class="mpre"> </span><a href="#loc_126_14_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_14_126_18&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre">)
                              (</span><a href="#loc_350_1_350_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_1_350_16&#39;)"><span class="hl_varref"><span class="mpre">silentCloseSock</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fst</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- $server-side</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Here&#39;s how you can run a TCP server that handles in different threads each</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- incoming connection to port @8000@ at IPv4 address @127.0.0.1@:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;serve&#39; (&#39;Host&#39; \&quot;127.0.0.1\&quot;) \&quot;8000\&quot; $ \\(connectionSocket, remoteAddr) -&gt; do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   putStrLn $ \&quot;TCP connection established from \&quot; ++ show remoteAddr</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   -- Now you may use connectionSocket as you please within this scope,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   -- possibly using &#39;recv&#39; and &#39;send&#39; to interact with the remote end.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If you need more control on the way your server runs, then you can use more</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- advanced functions such as &#39;listen&#39;, &#39;accept&#39; and &#39;acceptFork&#39;.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Start a TCP server that accepts incoming connections and handles them</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- concurrently in different threads.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Any acquired network resources are properly closed and discarded when done or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in case of exceptions.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note: This function performs &#39;listen&#39; and &#39;acceptFork&#39;, so you don&#39;t need to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- perform those manually.</span></span><span class="mpre">
</span><a href="#loc_165_1_165_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_6&#39;)"><span class="mpre">serve</span></a><span class="mpre">
  :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 157, srcSpanStartColumn = 6, srcSpanEndLine = 158, srcSpanEndColumn = 5}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 158, srcSpanStartColumn = 3, srcSpanEndLine = 158, srcSpanEndColumn = 5}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/p"><span class="mpre">MonadIO m
  =&gt;</span></span><span class="mpre"> </span><a href="Network.Simple.Internal.html#loc_17_6_17_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.Internal.html#loc_17_6_17_20&#39;)"><span class="hl_tyconref"><span class="mpre">HostPreference</span></span></a><span class="mpre">   </span><span class="hl_comment"><span class="mpre">-- ^Preferred host to bind.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyconref"><span class="mpre">NS.ServiceName</span></span><span class="mpre">   </span><span class="hl_comment"><span class="mpre">-- ^Service port to bind.</span></span><span class="mpre">
  -&gt; ((</span><span class="hl_tyconref"><span class="mpre">NS.Socket</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">NS.SockAddr</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)
                      </span><span class="hl_comment"><span class="mpre">-- ^Computation to run in a different thread</span></span><span class="mpre">
                      </span><span class="hl_comment"><span class="mpre">-- once an incoming connection is accepted. Takes the</span></span><span class="mpre">
                      </span><span class="hl_comment"><span class="mpre">-- connection socket and remote end address.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_165_1_165_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_6&#39;)"><span class="hl_fundecl"><span class="mpre">serve</span></span></a><span class="mpre"> </span><a name="loc_165_7_165_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_7_165_9&#39;)"><span class="hl_vardecl"><span class="mpre">hp</span></span></a><span class="mpre"> </span><a name="loc_165_10_165_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_10_165_14&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> </span><a name="loc_165_15_165_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_15_165_16&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a href="#loc_190_1_190_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_1_190_7&#39;)"><span class="hl_varref"><span class="mpre">listen</span></span></a><span class="mpre"> </span><a href="#loc_165_7_165_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_7_165_9&#39;)"><span class="hl_varref"><span class="mpre">hp</span></span></a><span class="mpre"> </span><a href="#loc_165_10_165_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_10_165_14&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_166_24_166_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_24_166_29&#39;)"><span class="hl_vardecl"><span class="mpre">lsock</span></span></a><span class="mpre">,_) -&gt; do
      </span><a href="Control.Monad.html#loc_189_1_189_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_189_1_189_8&#39;)"><span class="hl_varref"><span class="mpre">forever</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_225_1_225_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_1_225_11&#39;)"><span class="hl_varref"><span class="mpre">acceptFork</span></span></a><span class="mpre"> </span><a href="#loc_166_24_166_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_24_166_29&#39;)"><span class="hl_varref"><span class="mpre">lsock</span></span></a><span class="mpre"> </span><a href="#loc_165_15_165_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_15_165_16&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Bind a TCP listening socket and use it.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The listening socket is closed when done or in case of exceptions.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If you prefer to acquire and close the socket yourself, then use &#39;bindSock&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;closeSock&#39; and the &#39;NS.listen&#39; function from &quot;Network.Socket&quot; instead.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note: &#39;N.maxListenQueue&#39; is tipically 128, which is too small for high</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- performance servers. So, we use the maximum between &#39;N.maxListenQueue&#39; and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 2048 as the default size of the listening queue. The &#39;NS.NoDelay&#39; and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;NS.ReuseAddr&#39; options are set on the socket.</span></span><span class="mpre">
</span><a href="#loc_190_1_190_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_1_190_7&#39;)"><span class="mpre">listen</span></a><span class="mpre">
  :: </span><span class="warning" data-warning="ContextCxTuple (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 183, srcSpanStartColumn = 6, srcSpanEndLine = 184, srcSpanEndColumn = 5}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 183, srcSpanStartColumn = 6, srcSpanEndLine = 183, srcSpanEndColumn = 7},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simpl"><span class="mpre">(MonadIO m, C.MonadMask m)
  =&gt;</span></span><span class="mpre"> </span><a href="Network.Simple.Internal.html#loc_17_6_17_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.Internal.html#loc_17_6_17_20&#39;)"><span class="hl_tyconref"><span class="mpre">HostPreference</span></span></a><span class="mpre">   </span><span class="hl_comment"><span class="mpre">-- ^Preferred host to bind.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyconref"><span class="mpre">NS.ServiceName</span></span><span class="mpre">   </span><span class="hl_comment"><span class="mpre">-- ^Service port to bind.</span></span><span class="mpre">
  -&gt; ((</span><span class="hl_tyconref"><span class="mpre">NS.Socket</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">NS.SockAddr</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">)
                      </span><span class="hl_comment"><span class="mpre">-- ^Computation taking the listening socket and</span></span><span class="mpre">
                      </span><span class="hl_comment"><span class="mpre">-- the address it&#39;s bound to.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">
</span><a name="loc_190_1_190_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_1_190_7&#39;)"><span class="hl_fundecl"><span class="mpre">listen</span></span></a><span class="mpre"> </span><a name="loc_190_8_190_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_8_190_10&#39;)"><span class="hl_vardecl"><span class="mpre">hp</span></span></a><span class="mpre"> </span><a name="loc_190_11_190_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_11_190_15&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> = </span><a href="Control.Monad.Catch.html#loc_413_1_413_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Catch.html#loc_413_1_413_8&#39;)"><span class="hl_varref"><span class="mpre">C.bracket</span></span></a><span class="mpre"> </span><a href="#loc_192_5_192_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_5_192_12&#39;)"><span class="hl_varref"><span class="mpre">listen&#39;</span></span></a><span class="mpre"> (</span><a href="#loc_350_1_350_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_1_350_16&#39;)"><span class="hl_varref"><span class="mpre">silentCloseSock</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fst</span></span><span class="mpre">)
  where
    </span><a name="loc_192_5_192_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_5_192_12&#39;)"><span class="hl_vardecl"><span class="mpre">listen&#39;</span></span></a><span class="mpre"> = do </span><a name="loc_192_18_192_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_18_192_19&#39;)"><span class="hl_specname"><span class="mpre">x</span></span></a><span class="mpre">@(</span><a name="loc_192_21_192_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_21_192_26&#39;)"><span class="hl_vardecl"><span class="mpre">bsock</span></span></a><span class="mpre">,_) &lt;- </span><a href="#loc_265_1_265_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_1_265_9&#39;)"><span class="hl_varref"><span class="mpre">bindSock</span></span></a><span class="mpre"> </span><a href="#loc_190_8_190_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_8_190_10&#39;)"><span class="hl_varref"><span class="mpre">hp</span></span></a><span class="mpre"> </span><a href="#loc_190_11_190_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_11_190_15&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre">
                 </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">NS.listen</span></span><span class="mpre"> </span><a href="#loc_192_21_192_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_21_192_26&#39;)"><span class="hl_varref"><span class="mpre">bsock</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">max</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2048</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">NS.maxListenQueue</span></span><span class="mpre">
                 </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_192_18_192_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_18_192_19&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Accept a single incoming connection and use it.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The connection socket is closed when done or in case of exceptions.</span></span><span class="mpre">
</span><a href="#loc_209_1_209_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_1_209_7&#39;)"><span class="mpre">accept</span></a><span class="mpre">
  :: </span><span class="warning" data-warning="ContextCxTuple (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 202, srcSpanStartColumn = 6, srcSpanEndLine = 203, srcSpanEndColumn = 5}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 202, srcSpanStartColumn = 6, srcSpanEndLine = 202, srcSpanEndColumn = 7},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simpl"><span class="mpre">(MonadIO m, C.MonadMask m)
  =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">NS.Socket</span></span><span class="mpre">        </span><span class="hl_comment"><span class="mpre">-- ^Listening and bound socket.</span></span><span class="mpre">
  -&gt; ((</span><span class="hl_tyconref"><span class="mpre">NS.Socket</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">NS.SockAddr</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">)
                      </span><span class="hl_comment"><span class="mpre">-- ^Computation to run once an incoming</span></span><span class="mpre">
                      </span><span class="hl_comment"><span class="mpre">-- connection is accepted. Takes the connection socket</span></span><span class="mpre">
                      </span><span class="hl_comment"><span class="mpre">-- and remote end address.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">
</span><a name="loc_209_1_209_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_1_209_7&#39;)"><span class="hl_fundecl"><span class="mpre">accept</span></span></a><span class="mpre"> </span><a name="loc_209_8_209_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_8_209_13&#39;)"><span class="hl_vardecl"><span class="mpre">lsock</span></span></a><span class="mpre"> </span><a name="loc_209_14_209_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_14_209_15&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = do
    </span><a name="loc_210_5_210_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_5_210_9&#39;)"><span class="hl_specname"><span class="mpre">conn</span></span></a><span class="mpre">@(</span><a name="loc_210_11_210_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_11_210_16&#39;)"><span class="hl_vardecl"><span class="mpre">csock</span></span></a><span class="mpre">,_) &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">NS.accept</span></span><span class="mpre"> </span><a href="#loc_209_8_209_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_8_209_13&#39;)"><span class="hl_varref"><span class="mpre">lsock</span></span></a><span class="mpre">)
    </span><a href="Control.Monad.Catch.html#loc_427_1_427_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Catch.html#loc_427_1_427_8&#39;)"><span class="hl_varref"><span class="mpre">C.finally</span></span></a><span class="mpre"> (</span><a href="#loc_209_14_209_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_14_209_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_210_5_210_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_5_210_9&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">) (</span><a href="#loc_350_1_350_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_1_350_16&#39;)"><span class="hl_varref"><span class="mpre">silentCloseSock</span></span></a><span class="mpre"> </span><a href="#loc_210_11_210_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_11_210_16&#39;)"><span class="hl_varref"><span class="mpre">csock</span></span></a><span class="mpre">)
</span><span class="hl_comment"><span class="mpre">{-# INLINABLE accept #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Accept a single incoming connection and use it in a different thread.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The connection socket is closed when done or in case of exceptions.</span></span><span class="mpre">
</span><a href="#loc_225_1_225_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_1_225_11&#39;)"><span class="mpre">acceptFork</span></a><span class="mpre">
  :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 218, srcSpanStartColumn = 6, srcSpanEndLine = 219, srcSpanEndColumn = 5}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 219, srcSpanStartColumn = 3, srcSpanEndLine = 219, srcSpanEndColumn = 5}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/p"><span class="mpre">MonadIO m
  =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">NS.Socket</span></span><span class="mpre">        </span><span class="hl_comment"><span class="mpre">-- ^Listening and bound socket.</span></span><span class="mpre">
  -&gt; ((</span><span class="hl_tyconref"><span class="mpre">NS.Socket</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">NS.SockAddr</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)
                      </span><span class="hl_comment"><span class="mpre">-- ^Computation to run in a different thread</span></span><span class="mpre">
                      </span><span class="hl_comment"><span class="mpre">-- once an incoming connection is accepted. Takes the</span></span><span class="mpre">
                      </span><span class="hl_comment"><span class="mpre">-- connection socket and remote end address.</span></span><span class="mpre">
  -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ThreadId</span></span><span class="mpre">
</span><a name="loc_225_1_225_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_1_225_11&#39;)"><span class="hl_fundecl"><span class="mpre">acceptFork</span></span></a><span class="mpre"> </span><a name="loc_225_12_225_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_12_225_17&#39;)"><span class="hl_vardecl"><span class="mpre">lsock</span></span></a><span class="mpre"> </span><a name="loc_225_18_225_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_18_225_19&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a name="loc_226_5_226_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_5_226_9&#39;)"><span class="hl_specname"><span class="mpre">conn</span></span></a><span class="mpre">@(</span><a name="loc_226_11_226_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_11_226_16&#39;)"><span class="hl_vardecl"><span class="mpre">csock</span></span></a><span class="mpre">,_) &lt;- </span><span class="hl_varref"><span class="mpre">NS.accept</span></span><span class="mpre"> </span><a href="#loc_225_12_225_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_12_225_17&#39;)"><span class="hl_varref"><span class="mpre">lsock</span></span></a><span class="mpre">
    </span><a href="#loc_343_1_343_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_1_343_12&#39;)"><span class="hl_varref"><span class="mpre">forkFinally</span></span></a><span class="mpre"> (</span><a href="#loc_225_18_225_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_18_225_19&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_226_5_226_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_5_226_9&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">)
                (\</span><a name="loc_228_19_228_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_19_228_21&#39;)"><span class="hl_vardecl"><span class="mpre">ea</span></span></a><span class="mpre"> -&gt; do </span><a href="#loc_350_1_350_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_1_350_16&#39;)"><span class="hl_varref"><span class="mpre">silentCloseSock</span></span></a><span class="mpre"> </span><a href="#loc_226_11_226_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_11_226_16&#39;)"><span class="hl_varref"><span class="mpre">csock</span></span></a><span class="mpre">
                           </span><span class="hl_varref"><span class="mpre">either</span></span><span class="mpre"> </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">E.throwIO</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_228_19_228_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_19_228_21&#39;)"><span class="hl_varref"><span class="mpre">ea</span></span></a><span class="mpre">)
</span><span class="hl_comment"><span class="mpre">{-# INLINABLE acceptFork #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Obtain a &#39;NS.Socket&#39; connected to the given host and TCP service port.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The obtained &#39;NS.Socket&#39; should be closed manually using &#39;closeSock&#39; when</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- it&#39;s not needed anymore, otherwise you risk having the socket open for much</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- longer than needed.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Prefer to use &#39;connect&#39; if you will be using the socket within a limited</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- scope and would like it to be closed immediately after its usage or in case</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- of exceptions.</span></span><span class="mpre">
</span><a href="#loc_245_1_245_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_1_245_12&#39;)"><span class="mpre">connectSock</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 243, srcSpanStartColumn = 16, srcSpanEndLine = 244, srcSpanEndColumn = 15}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 244, srcSpanStartColumn = 13, srcSpanEndLine = 244, srcSpanEndColumn = 15}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemn"><span class="mpre">MonadIO m
            =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">NS.HostName</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">NS.ServiceName</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">NS.Socket</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">NS.SockAddr</span></span><span class="mpre">)
</span><a name="loc_245_1_245_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_1_245_12&#39;)"><span class="hl_fundecl"><span class="mpre">connectSock</span></span></a><span class="mpre"> </span><a name="loc_245_13_245_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_13_245_17&#39;)"><span class="hl_vardecl"><span class="mpre">host</span></span></a><span class="mpre"> </span><a name="loc_245_18_245_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_18_245_22&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> = </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    (</span><a name="loc_246_6_246_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_246_6_246_10&#39;)"><span class="hl_vardecl"><span class="mpre">addr</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_) &lt;- </span><span class="hl_varref"><span class="mpre">NS.getAddrInfo</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_252_5_252_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_5_252_10&#39;)"><span class="hl_varref"><span class="mpre">hints</span></span></a><span class="mpre">) (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_245_13_245_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_13_245_17&#39;)"><span class="hl_varref"><span class="mpre">host</span></span></a><span class="mpre">) (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_245_18_245_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_18_245_22&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre">)
    </span><a href="Control.Exception.Base.html#loc_291_1_291_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_291_1_291_15&#39;)"><span class="hl_varref"><span class="mpre">E.bracketOnError</span></span></a><span class="mpre"> (</span><a href="#loc_324_1_324_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_10&#39;)"><span class="hl_varref"><span class="mpre">newSocket</span></span></a><span class="mpre"> </span><a href="#loc_246_6_246_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_246_6_246_10&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre">) </span><a href="#loc_291_1_291_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_1_291_10&#39;)"><span class="hl_varref"><span class="mpre">closeSock</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_247_52_247_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_52_247_56&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> -&gt; do
       let </span><a name="loc_248_12_248_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_12_248_20&#39;)"><span class="hl_vardecl"><span class="mpre">sockAddr</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">NS.addrAddress</span></span><span class="mpre"> </span><a href="#loc_246_6_246_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_246_6_246_10&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre">
       </span><span class="hl_varref"><span class="mpre">NS.connect</span></span><span class="mpre"> </span><a href="#loc_247_52_247_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_52_247_56&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a href="#loc_248_12_248_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_12_248_20&#39;)"><span class="hl_varref"><span class="mpre">sockAddr</span></span></a><span class="mpre">
       </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_247_52_247_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_52_247_56&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre">, </span><a href="#loc_248_12_248_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_12_248_20&#39;)"><span class="hl_varref"><span class="mpre">sockAddr</span></span></a><span class="mpre">)
  where
    </span><a name="loc_252_5_252_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_5_252_10&#39;)"><span class="hl_vardecl"><span class="mpre">hints</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 252, srcSpanStartColumn = 13, srcSpanEndLine = 253, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 252, srcSpanStartColumn = 29, srcSpanEndLine = 252, srcSpanEndColumn = 30},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network"><span class="mpre">NS.defaultHints { NS.addrFlags = [NS.AI_ADDRCONFIG]
                            , NS.addrSocketType = NS.Stream }</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Obtain a &#39;NS.Socket&#39; bound to the given host name and TCP service port.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The obtained &#39;NS.Socket&#39; should be closed manually using &#39;closeSock&#39; when</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- it&#39;s not needed anymore.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Prefer to use &#39;listen&#39; if you will be listening on this socket and using it</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- within a limited scope, and would like it to be closed immediately after its</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- usage or in case of exceptions.</span></span><span class="mpre">
</span><a href="#loc_265_1_265_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_1_265_9&#39;)"><span class="mpre">bindSock</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 263, srcSpanStartColumn = 13, srcSpanEndLine = 264, srcSpanEndColumn = 12}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 264, srcSpanStartColumn = 10, srcSpanEndLine = 264, srcSpanEndColumn = 12}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemn"><span class="mpre">MonadIO m
         =&gt;</span></span><span class="mpre"> </span><a href="Network.Simple.Internal.html#loc_17_6_17_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.Internal.html#loc_17_6_17_20&#39;)"><span class="hl_tyconref"><span class="mpre">HostPreference</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">NS.ServiceName</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">NS.Socket</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">NS.SockAddr</span></span><span class="mpre">)
</span><a name="loc_265_1_265_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_1_265_9&#39;)"><span class="hl_fundecl"><span class="mpre">bindSock</span></span></a><span class="mpre"> </span><a name="loc_265_10_265_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_10_265_12&#39;)"><span class="hl_vardecl"><span class="mpre">hp</span></span></a><span class="mpre"> </span><a name="loc_265_13_265_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_13_265_17&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> = </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a name="loc_266_5_266_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_5_266_10&#39;)"><span class="hl_vardecl"><span class="mpre">addrs</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">NS.getAddrInfo</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_273_5_273_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_5_273_10&#39;)"><span class="hl_varref"><span class="mpre">hints</span></span></a><span class="mpre">) (</span><a href="Network.Simple.Internal.html#loc_41_1_41_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.Internal.html#loc_41_1_41_11&#39;)"><span class="hl_varref"><span class="mpre">hpHostName</span></span></a><span class="mpre"> </span><a href="#loc_265_10_265_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_10_265_12&#39;)"><span class="hl_varref"><span class="mpre">hp</span></span></a><span class="mpre">) (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_265_13_265_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_13_265_17&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre">)
    let </span><a name="loc_267_9_267_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_9_267_15&#39;)"><span class="hl_vardecl"><span class="mpre">addrs&#39;</span></span></a><span class="mpre"> = case </span><a href="#loc_265_10_265_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_10_265_12&#39;)"><span class="hl_varref"><span class="mpre">hp</span></span></a><span class="mpre"> of
          </span><a href="Network.Simple.Internal.html#loc_19_5_19_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.Internal.html#loc_19_5_19_13&#39;)"><span class="hl_conref"><span class="mpre">HostIPv4</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_335_1_335_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_1_335_11&#39;)"><span class="hl_varref"><span class="mpre">prioritize</span></span></a><span class="mpre"> </span><a href="#loc_329_1_329_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_1_329_11&#39;)"><span class="hl_varref"><span class="mpre">isIPv4addr</span></span></a><span class="mpre"> </span><a href="#loc_266_5_266_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_5_266_10&#39;)"><span class="hl_varref"><span class="mpre">addrs</span></span></a><span class="mpre">
          </span><a href="Network.Simple.Internal.html#loc_20_5_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Simple.Internal.html#loc_20_5_20_13&#39;)"><span class="hl_conref"><span class="mpre">HostIPv6</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_335_1_335_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_1_335_11&#39;)"><span class="hl_varref"><span class="mpre">prioritize</span></span></a><span class="mpre"> </span><a href="#loc_330_1_330_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_330_1_330_11&#39;)"><span class="hl_varref"><span class="mpre">isIPv6addr</span></span></a><span class="mpre"> </span><a href="#loc_266_5_266_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_5_266_10&#39;)"><span class="hl_varref"><span class="mpre">addrs</span></span></a><span class="mpre">
          _        -&gt; </span><a href="#loc_266_5_266_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_5_266_10&#39;)"><span class="hl_varref"><span class="mpre">addrs</span></span></a><span class="mpre">
    </span><a href="#loc_276_5_276_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_276_5_276_13&#39;)"><span class="hl_varref"><span class="mpre">tryAddrs</span></span></a><span class="mpre"> </span><a href="#loc_267_9_267_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_9_267_15&#39;)"><span class="hl_varref"><span class="mpre">addrs&#39;</span></span></a><span class="mpre">
  where
    </span><a name="loc_273_5_273_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_5_273_10&#39;)"><span class="hl_vardecl"><span class="mpre">hints</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 273, srcSpanStartColumn = 13, srcSpanEndLine = 274, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 273, srcSpanStartColumn = 29, srcSpanEndLine = 273, srcSpanEndColumn = 30},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network"><span class="mpre">NS.defaultHints { NS.addrFlags = [NS.AI_PASSIVE]
                            , NS.addrSocketType = NS.Stream }</span></span><span class="mpre">

    </span><a name="loc_276_5_276_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_276_5_276_13&#39;)"><span class="hl_fundecl"><span class="mpre">tryAddrs</span></span></a><span class="mpre"> []     = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;bindSock: no addresses available&quot;</span></span><span class="mpre">
    </span><a href="#loc_276_5_276_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_276_5_276_13&#39;)"><span class="hl_fundecl"><span class="mpre">tryAddrs</span></span></a><span class="mpre"> [</span><a name="loc_277_15_277_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_15_277_16&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">]    = </span><a href="#loc_281_5_281_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_5_281_12&#39;)"><span class="hl_varref"><span class="mpre">useAddr</span></span></a><span class="mpre"> </span><a href="#loc_277_15_277_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_15_277_16&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
    </span><a href="#loc_276_5_276_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_276_5_276_13&#39;)"><span class="hl_fundecl"><span class="mpre">tryAddrs</span></span></a><span class="mpre"> (</span><a name="loc_278_15_278_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_15_278_16&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_278_17_278_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_17_278_19&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre">) = </span><a href="Control.Exception.Base.html#loc_150_1_150_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_150_1_150_6&#39;)"><span class="hl_varref"><span class="mpre">E.catch</span></span></a><span class="mpre"> (</span><a href="#loc_281_5_281_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_5_281_12&#39;)"><span class="hl_varref"><span class="mpre">useAddr</span></span></a><span class="mpre"> </span><a href="#loc_278_15_278_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_15_278_16&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)
                              (\</span><a name="loc_279_33_279_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_33_279_34&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; let _ = </span><a href="#loc_279_33_279_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_33_279_34&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IOError</span></span><span class="mpre"> in </span><a href="#loc_276_5_276_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_276_5_276_13&#39;)"><span class="hl_varref"><span class="mpre">tryAddrs</span></span></a><span class="mpre"> </span><a href="#loc_278_17_278_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_17_278_19&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">)

    </span><a name="loc_281_5_281_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_5_281_12&#39;)"><span class="hl_fundecl"><span class="mpre">useAddr</span></span></a><span class="mpre"> </span><a name="loc_281_13_281_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_13_281_17&#39;)"><span class="hl_vardecl"><span class="mpre">addr</span></span></a><span class="mpre"> = </span><a href="Control.Exception.Base.html#loc_291_1_291_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_291_1_291_15&#39;)"><span class="hl_varref"><span class="mpre">E.bracketOnError</span></span></a><span class="mpre"> (</span><a href="#loc_324_1_324_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_10&#39;)"><span class="hl_varref"><span class="mpre">newSocket</span></span></a><span class="mpre"> </span><a href="#loc_281_13_281_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_13_281_17&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre">) </span><a href="#loc_291_1_291_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_1_291_10&#39;)"><span class="hl_varref"><span class="mpre">closeSock</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_281_67_281_71" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_67_281_71&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> -&gt; do
      let </span><a name="loc_282_11_282_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_282_11_282_19&#39;)"><span class="hl_vardecl"><span class="mpre">sockAddr</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">NS.addrAddress</span></span><span class="mpre"> </span><a href="#loc_281_13_281_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_13_281_17&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">NS.setSocketOption</span></span><span class="mpre"> </span><a href="#loc_281_67_281_71" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_67_281_71&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">NS.NoDelay</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">NS.setSocketOption</span></span><span class="mpre"> </span><a href="#loc_281_67_281_71" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_67_281_71&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">NS.ReuseAddr</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">NS.bindSocket</span></span><span class="mpre"> </span><a href="#loc_281_67_281_71" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_67_281_71&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a href="#loc_282_11_282_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_282_11_282_19&#39;)"><span class="hl_varref"><span class="mpre">sockAddr</span></span></a><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_281_67_281_71" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_67_281_71&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre">, </span><a href="#loc_282_11_282_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_282_11_282_19&#39;)"><span class="hl_varref"><span class="mpre">sockAddr</span></span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">-- | Close the &#39;NS.Socket&#39;.</span></span><span class="mpre">
</span><a href="#loc_291_1_291_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_1_291_10&#39;)"><span class="mpre">closeSock</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 290, srcSpanStartColumn = 14, srcSpanEndLine = 290, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 290, srcSpanStartColumn = 24, srcSpanEndLine = 290, srcSpanEndColumn = 26}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemn"><span class="mpre">MonadIO m =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">NS.Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_291_1_291_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_1_291_10&#39;)"><span class="hl_vardecl"><span class="mpre">closeSock</span></span></a><span class="mpre"> = </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre">
#if MIN_VERSION_network(2,4,0)
    </span><span class="hl_varref"><span class="mpre">NS.close</span></span><span class="mpre">
#else
    </span><span class="hl_varref"><span class="mpre">NS.sClose</span></span><span class="mpre">
#endif
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_291_1_291_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_1_291_10&#39;)"><span class="mpre">closeSock</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Utils</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Read up to a limited number of bytes from a socket.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Returns `Nothing` if the remote end closed the connection or end-of-input was</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- reached. The number of returned bytes might be less than the specified limit.</span></span><span class="mpre">
</span><a href="#loc_307_1_307_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_1_307_5&#39;)"><span class="mpre">recv</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 306, srcSpanStartColumn = 9, srcSpanEndLine = 306, srcSpanEndColumn = 21}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 306, srcSpanStartColumn = 19, srcSpanEndLine = 306, srcSpanEndColumn = 21}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemne"><span class="mpre">MonadIO m =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">NS.Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">BS.ByteString</span></span><span class="mpre">)
</span><a name="loc_307_1_307_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_1_307_5&#39;)"><span class="hl_fundecl"><span class="mpre">recv</span></span></a><span class="mpre"> </span><a name="loc_307_6_307_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_6_307_10&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a name="loc_307_11_307_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_11_307_17&#39;)"><span class="hl_vardecl"><span class="mpre">nbytes</span></span></a><span class="mpre"> = do
     </span><a name="loc_308_6_308_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_308_6_308_8&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">NSB.recv</span></span><span class="mpre"> </span><a href="#loc_307_6_307_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_6_307_10&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a href="#loc_307_11_307_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_11_307_17&#39;)"><span class="hl_varref"><span class="mpre">nbytes</span></span></a><span class="mpre">)
     if </span><span class="hl_varref"><span class="mpre">BS.null</span></span><span class="mpre"> </span><a href="#loc_308_6_308_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_308_6_308_8&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
        then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
        else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_308_6_308_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_308_6_308_8&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">)
</span><span class="hl_comment"><span class="mpre">{-# INLINABLE recv #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Writes the given bytes to the socket.</span></span><span class="mpre">
</span><a href="#loc_316_1_316_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_316_1_316_5&#39;)"><span class="mpre">send</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 315, srcSpanStartColumn = 9, srcSpanEndLine = 315, srcSpanEndColumn = 21}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 315, srcSpanStartColumn = 19, srcSpanEndLine = 315, srcSpanEndColumn = 21}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemne"><span class="mpre">MonadIO m =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">NS.Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">BS.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_316_1_316_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_316_1_316_5&#39;)"><span class="hl_fundecl"><span class="mpre">send</span></span></a><span class="mpre"> </span><a name="loc_316_6_316_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_316_6_316_10&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> = \</span><a name="loc_316_14_316_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_316_14_316_16&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> -&gt; </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">NSB.sendAll</span></span><span class="mpre"> </span><a href="#loc_316_6_316_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_316_6_316_10&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a href="#loc_316_14_316_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_316_14_316_16&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">)
</span><span class="hl_comment"><span class="mpre">{-# INLINABLE send #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Misc</span></span><span class="mpre">

</span><a href="#loc_324_1_324_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_10&#39;)"><span class="mpre">newSocket</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">NS.AddrInfo</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">NS.Socket</span></span><span class="mpre">
</span><a name="loc_324_1_324_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_10&#39;)"><span class="hl_fundecl"><span class="mpre">newSocket</span></span></a><span class="mpre"> </span><a name="loc_324_11_324_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_11_324_15&#39;)"><span class="hl_vardecl"><span class="mpre">addr</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">NS.socket</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">NS.addrFamily</span></span><span class="mpre"> </span><a href="#loc_324_11_324_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_11_324_15&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre">)
                           (</span><span class="hl_varref"><span class="mpre">NS.addrSocketType</span></span><span class="mpre"> </span><a href="#loc_324_11_324_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_11_324_15&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre">)
                           (</span><span class="hl_varref"><span class="mpre">NS.addrProtocol</span></span><span class="mpre"> </span><a href="#loc_324_11_324_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_11_324_15&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre">)

</span><a href="#loc_329_1_329_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_1_329_11&#39;)"><span class="mpre">isIPv4addr</span></a><span class="mpre">, </span><a href="#loc_330_1_330_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_330_1_330_11&#39;)"><span class="mpre">isIPv6addr</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">NS.AddrInfo</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_329_1_329_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_1_329_11&#39;)"><span class="hl_fundecl"><span class="mpre">isIPv4addr</span></span></a><span class="mpre"> </span><a name="loc_329_12_329_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_12_329_13&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">NS.addrFamily</span></span><span class="mpre"> </span><a href="#loc_329_12_329_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_12_329_13&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">NS.AF_INET</span></span><span class="mpre">
</span><a name="loc_330_1_330_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_330_1_330_11&#39;)"><span class="hl_fundecl"><span class="mpre">isIPv6addr</span></span></a><span class="mpre"> </span><a name="loc_330_12_330_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_330_12_330_13&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">NS.addrFamily</span></span><span class="mpre"> </span><a href="#loc_330_12_330_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_330_12_330_13&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">NS.AF_INET6</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Move the elements that match the predicate closer to the head of the list.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Sorting is stable.</span></span><span class="mpre">
</span><a href="#loc_335_1_335_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_1_335_11&#39;)"><span class="mpre">prioritize</span></a><span class="mpre"> :: (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">) -&gt; [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">] -&gt; [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">]
</span><a name="loc_335_1_335_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_1_335_11&#39;)"><span class="hl_fundecl"><span class="mpre">prioritize</span></span></a><span class="mpre"> </span><a name="loc_335_12_335_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_12_335_13&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">uncurry</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">(++)</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.List.html#loc_464_1_464_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_464_1_464_10&#39;)"><span class="hl_varref"><span class="mpre">partition</span></span></a><span class="mpre"> </span><a href="#loc_335_12_335_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_12_335_13&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | &#39;Control.Concurrent.forkFinally&#39; was introduced in base==4.6.0.0. We&#39;ll use</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- our own version here for a while, until base==4.6.0.0 is widely establised.</span></span><span class="mpre">
</span><a href="#loc_343_1_343_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_1_343_12&#39;)"><span class="mpre">forkFinally</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">E.SomeException</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ThreadId</span></span><span class="mpre">
</span><a name="loc_343_1_343_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_1_343_12&#39;)"><span class="hl_fundecl"><span class="mpre">forkFinally</span></span></a><span class="mpre"> </span><a name="loc_343_13_343_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_13_343_19&#39;)"><span class="hl_vardecl"><span class="mpre">action</span></span></a><span class="mpre"> </span><a name="loc_343_20_343_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_20_343_28&#39;)"><span class="hl_vardecl"><span class="mpre">and_then</span></span></a><span class="mpre"> =
    </span><a href="GHC.IO.html#loc_428_1_428_5" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_428_1_428_5&#39;)"><span class="hl_varref"><span class="mpre">E.mask</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_344_15_344_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_15_344_22&#39;)"><span class="hl_vardecl"><span class="mpre">restore</span></span></a><span class="mpre"> -&gt;
        </span><span class="hl_varref"><span class="mpre">forkIO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Exception.Base.html#loc_212_1_212_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_212_1_212_4&#39;)"><span class="hl_varref"><span class="mpre">E.try</span></span></a><span class="mpre"> (</span><a href="#loc_344_15_344_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_15_344_22&#39;)"><span class="hl_varref"><span class="mpre">restore</span></span></a><span class="mpre"> </span><a href="#loc_343_13_343_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_13_343_19&#39;)"><span class="hl_varref"><span class="mpre">action</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="#loc_343_20_343_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_20_343_28&#39;)"><span class="hl_varref"><span class="mpre">and_then</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | Like &#39;closeSock&#39;, except it swallows all &#39;IOError&#39; exceptions.</span></span><span class="mpre">
</span><a href="#loc_350_1_350_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_1_350_16&#39;)"><span class="mpre">silentCloseSock</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 349, srcSpanStartColumn = 20, srcSpanEndLine = 349, srcSpanEndColumn = 32}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/network-simple-0.4/src/Network/Simple/TCP.hs&quot;, srcSpanStartLine = 349, srcSpanStartColumn = 30, srcSpanEndLine = 349, srcSpanEndColumn = 32}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemn"><span class="mpre">MonadIO m =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">NS.Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_350_1_350_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_1_350_16&#39;)"><span class="hl_fundecl"><span class="mpre">silentCloseSock</span></span></a><span class="mpre"> </span><a name="loc_350_17_350_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_17_350_21&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> = </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a href="Control.Exception.Base.html#loc_150_1_150_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_150_1_150_6&#39;)"><span class="hl_varref"><span class="mpre">E.catch</span></span></a><span class="mpre"> (</span><a href="#loc_291_1_291_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_291_1_291_10&#39;)"><span class="hl_varref"><span class="mpre">closeSock</span></span></a><span class="mpre"> </span><a href="#loc_350_17_350_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_17_350_21&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre">)
            (\</span><a name="loc_352_15_352_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_15_352_16&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; let _ = </span><a href="#loc_352_15_352_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_15_352_16&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IOError</span></span><span class="mpre"> in </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)

</span></div></body></html>