<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Data.ASN1.BinaryEncoding.Writer</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Serialize events for streaming.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Data.ASN1.BinaryEncoding.Writer
    ( toByteString
    , toLazyByteString
    ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/asn1-encoding-0.8.1.3/Data/ASN1/BinaryEncoding/Writer.hs&quot;, srcSpanStartLine = 15, srcSpanStartColumn = 8, srcSpanEndLine = 15, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/asn1-encoding-0.8.1.3/Data/ASN1/BinaryEncoding/Writer.hs&quot;, srcSpanStartLine = 16, srcSpanStartColumn = 18, srcSpanEndLine = 16, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/asn1-encoding-0.8.1.3/Data/ASN1/BinaryEncoding/Writer.hs&quot;, srcSpanStartLine = 17, srcSpanStartColumn = 18, srcSpanEndLine = 17, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L
import Data.ASN1.Types.Lowlevel
import Data.ASN1.Serialize

</span><span class="hl_comment"><span class="mpre">-- | transform a list of ASN1 Events into a strict bytestring</span></span><span class="mpre">
</span><a href="#loc_23_1_23_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_13&#39;)"><span class="mpre">toByteString</span></a><span class="mpre"> :: [</span><a href="Data.ASN1.Types.Lowlevel.html#loc_43_6_43_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_43_6_43_15&#39;)"><span class="hl_tyconref"><span class="mpre">ASN1Event</span></span></a><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_23_1_23_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_13&#39;)"><span class="hl_vardecl"><span class="mpre">toByteString</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.toChunks</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_27_1_27_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_1_27_17&#39;)"><span class="hl_varref"><span class="mpre">toLazyByteString</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | transform a list of ASN1 Events into a lazy bytestring</span></span><span class="mpre">
</span><a href="#loc_27_1_27_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_1_27_17&#39;)"><span class="mpre">toLazyByteString</span></a><span class="mpre"> :: [</span><a href="Data.ASN1.Types.Lowlevel.html#loc_43_6_43_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_43_6_43_15&#39;)"><span class="hl_tyconref"><span class="mpre">ASN1Event</span></span></a><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre">
</span><a name="loc_27_1_27_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_1_27_17&#39;)"><span class="hl_fundecl"><span class="mpre">toLazyByteString</span></span></a><span class="mpre"> </span><a name="loc_27_18_27_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_18_27_21&#39;)"><span class="hl_vardecl"><span class="mpre">evs</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">L.fromChunks</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_28_11_28_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_11_28_15&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> [] </span><a href="#loc_27_18_27_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_18_27_21&#39;)"><span class="hl_varref"><span class="mpre">evs</span></span></a><span class="mpre">
    where </span><a name="loc_28_11_28_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_11_28_15&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> _ [] = []
          </span><a href="#loc_28_11_28_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_11_28_15&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_29_16_29_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_16_29_19&#39;)"><span class="hl_vardecl"><span class="mpre">acc</span></span></a><span class="mpre"> (</span><a name="loc_29_21_29_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_21_29_22&#39;)"><span class="hl_specname"><span class="mpre">x</span></span></a><span class="mpre">@(</span><a href="Data.ASN1.Types.Lowlevel.html#loc_43_18_43_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_43_18_43_24&#39;)"><span class="hl_conref"><span class="mpre">Header</span></span></a><span class="mpre"> (</span><a href="Data.ASN1.Types.Lowlevel.html#loc_39_19_39_29" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_39_19_39_29&#39;)"><span class="hl_conref"><span class="mpre">ASN1Header</span></span></a><span class="mpre"> _ _ </span><a name="loc_29_47_29_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_47_29_49&#39;)"><span class="hl_vardecl"><span class="mpre">pc</span></span></a><span class="mpre"> </span><a name="loc_29_50_29_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_50_29_53&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">))</span><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_29_56_29_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_56_29_58&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre">) = </span><a href="#loc_36_11_36_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_15&#39;)"><span class="hl_varref"><span class="mpre">toBs</span></span></a><span class="mpre"> </span><a href="#loc_29_21_29_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_21_29_22&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_28_11_28_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_11_28_15&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> (if </span><a href="#loc_29_47_29_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_47_29_49&#39;)"><span class="hl_varref"><span class="mpre">pc</span></span></a><span class="mpre"> then (</span><a href="#loc_29_50_29_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_50_29_53&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="Data.ASN1.Types.Lowlevel.html#loc_35_19_35_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_35_19_35_32&#39;)"><span class="hl_conref"><span class="mpre">LenIndefinite</span></span></a><span class="mpre">)</span><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_29_16_29_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_16_29_19&#39;)"><span class="hl_varref"><span class="mpre">acc</span></span></a><span class="mpre"> else </span><a href="#loc_29_16_29_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_16_29_19&#39;)"><span class="hl_varref"><span class="mpre">acc</span></span></a><span class="mpre">) </span><a href="#loc_29_56_29_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_56_29_58&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">
          </span><a href="#loc_28_11_28_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_11_28_15&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_30_16_30_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_16_30_19&#39;)"><span class="hl_vardecl"><span class="mpre">acc</span></span></a><span class="mpre"> (</span><a href="Data.ASN1.Types.Lowlevel.html#loc_46_18_46_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_46_18_46_33&#39;)"><span class="hl_conref"><span class="mpre">ConstructionEnd</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_30_37_30_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_37_30_39&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre">) = case </span><a href="#loc_30_16_30_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_16_30_19&#39;)"><span class="hl_varref"><span class="mpre">acc</span></span></a><span class="mpre"> of
                                              []        -&gt; </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;malformed stream: end before construction&quot;</span></span><span class="mpre">
                                              (</span><span class="hl_conref"><span class="mpre">True</span></span><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_32_53_32_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_53_32_54&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">)  -&gt; </span><a href="#loc_36_11_36_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_15&#39;)"><span class="hl_varref"><span class="mpre">toBs</span></span></a><span class="mpre"> </span><a href="Data.ASN1.Types.Lowlevel.html#loc_46_18_46_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_46_18_46_33&#39;)"><span class="hl_conref"><span class="mpre">ConstructionEnd</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_28_11_28_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_11_28_15&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_32_53_32_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_53_32_54&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><a href="#loc_30_37_30_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_37_30_39&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">
                                              (</span><span class="hl_conref"><span class="mpre">False</span></span><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_33_54_33_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_54_33_55&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">) -&gt; </span><a href="#loc_28_11_28_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_11_28_15&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_33_54_33_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_54_33_55&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><a href="#loc_30_37_30_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_37_30_39&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">
          </span><a href="#loc_28_11_28_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_11_28_15&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_34_16_34_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_16_34_19&#39;)"><span class="hl_vardecl"><span class="mpre">acc</span></span></a><span class="mpre"> (</span><a name="loc_34_21_34_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_21_34_22&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_34_23_34_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_23_34_25&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre">) = </span><a href="#loc_36_11_36_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_15&#39;)"><span class="hl_varref"><span class="mpre">toBs</span></span></a><span class="mpre"> </span><a href="#loc_34_21_34_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_21_34_22&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_28_11_28_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_11_28_15&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_34_16_34_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_16_34_19&#39;)"><span class="hl_varref"><span class="mpre">acc</span></span></a><span class="mpre"> </span><a href="#loc_34_23_34_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_23_34_25&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">

          </span><a name="loc_36_11_36_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_15&#39;)"><span class="hl_fundecl"><span class="mpre">toBs</span></span></a><span class="mpre"> (</span><a href="Data.ASN1.Types.Lowlevel.html#loc_43_18_43_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_43_18_43_24&#39;)"><span class="hl_conref"><span class="mpre">Header</span></span></a><span class="mpre"> </span><a name="loc_36_24_36_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_24_36_27&#39;)"><span class="hl_vardecl"><span class="mpre">hdr</span></span></a><span class="mpre">)      = </span><a href="Data.ASN1.Serialize.html#loc_73_1_73_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Serialize.html#loc_73_1_73_10&#39;)"><span class="hl_varref"><span class="mpre">putHeader</span></span></a><span class="mpre"> </span><a href="#loc_36_24_36_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_24_36_27&#39;)"><span class="hl_varref"><span class="mpre">hdr</span></span></a><span class="mpre">
          </span><a href="#loc_36_11_36_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_15&#39;)"><span class="hl_fundecl"><span class="mpre">toBs</span></span></a><span class="mpre"> (</span><a href="Data.ASN1.Types.Lowlevel.html#loc_44_18_44_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_44_18_44_27&#39;)"><span class="hl_conref"><span class="mpre">Primitive</span></span></a><span class="mpre"> </span><a name="loc_37_27_37_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_27_37_29&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">)    = </span><a href="#loc_37_27_37_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_27_37_29&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
          </span><a href="#loc_36_11_36_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_15&#39;)"><span class="hl_fundecl"><span class="mpre">toBs</span></span></a><span class="mpre"> </span><a href="Data.ASN1.Types.Lowlevel.html#loc_45_18_45_35" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_45_18_45_35&#39;)"><span class="hl_conref"><span class="mpre">ConstructionBegin</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">
          </span><a href="#loc_36_11_36_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_15&#39;)"><span class="hl_fundecl"><span class="mpre">toBs</span></span></a><span class="mpre"> </span><a href="Data.ASN1.Types.Lowlevel.html#loc_46_18_46_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_46_18_46_33&#39;)"><span class="hl_conref"><span class="mpre">ConstructionEnd</span></span></a><span class="mpre">   = </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">
</span></div></body></html>