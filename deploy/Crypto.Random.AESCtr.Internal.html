<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Crypto.Random.AESCtr.Internal</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : stable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
{-# LANGUAGE CPP #-}
module Crypto.Random.AESCtr.Internal where

import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr/Internal.hs&quot;, srcSpanStartLine = 11, srcSpanStartColumn = 18, srcSpanEndLine = 11, srcSpanEndColumn = 35}, srcInfoPoints = []}) &quot;Crypto.Cipher.AES&quot;"><span class="mpre">Crypto.Cipher.AES</span></span><span class="mpre"> as AES

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr/Internal.hs&quot;, srcSpanStartLine = 13, srcSpanStartColumn = 8, srcSpanEndLine = 13, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr/Internal.hs&quot;, srcSpanStartLine = 14, srcSpanStartColumn = 18, srcSpanEndLine = 14, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B

import Data.Word
import Data.Bits (</span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="mpre">xor</span></a><span class="mpre">)

import Foreign.Ptr
#if __GLASGOW_HASKELL__ &gt; 704
import Foreign.ForeignPtr.Unsafe (unsafeForeignPtrToPtr)
#else
import Foreign.ForeignPtr (unsafeForeignPtrToPtr)
#endif

import Foreign.Storable
import qualified Data.ByteString.Internal as B

data </span><a name="loc_29_6_29_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_6_29_13&#39;)"><span class="hl_tycondecl"><span class="mpre">Word128</span></span></a><span class="mpre"> = </span><a name="loc_29_16_29_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_16_29_23&#39;)"><span class="hl_condecl"><span class="mpre">Word128</span></span></a><span class="mpre"> {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">Word64</span></span><span class="mpre"> {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">Word64</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-| An opaque object containing an AES CPRNG -}</span></span><span class="mpre">
data </span><a name="loc_32_6_32_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_6_32_9&#39;)"><span class="hl_tycondecl"><span class="mpre">RNG</span></span></a><span class="mpre"> = </span><a name="loc_32_12_32_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_12_32_15&#39;)"><span class="hl_condecl"><span class="mpre">RNG</span></span></a><span class="mpre">
    {-# UNPACK #-} !</span><a href="#loc_29_6_29_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_6_29_13&#39;)"><span class="hl_tyconref"><span class="mpre">Word128</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- iv</span></span><span class="mpre">
    {-# UNPACK #-} !</span><a href="#loc_29_6_29_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_6_29_13&#39;)"><span class="hl_tyconref"><span class="mpre">Word128</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- cnt</span></span><span class="mpre">
    {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">     </span><span class="hl_comment"><span class="mpre">-- number of chunks generated since reseed</span></span><span class="mpre">
    {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">AES.AES</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- AES context</span></span><span class="mpre">

</span><a href="#loc_39_1_39_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_21&#39;)"><span class="mpre">getNbChunksGenerated</span></a><span class="mpre"> :: </span><a href="#loc_32_6_32_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_6_32_9&#39;)"><span class="hl_tyconref"><span class="mpre">RNG</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_39_1_39_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_21&#39;)"><span class="hl_fundecl"><span class="mpre">getNbChunksGenerated</span></span></a><span class="mpre"> (</span><a href="#loc_32_12_32_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_12_32_15&#39;)"><span class="hl_conref"><span class="mpre">RNG</span></span></a><span class="mpre"> _ _ </span><a name="loc_39_31_39_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_31_39_32&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> _) = </span><a href="#loc_39_31_39_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_31_39_32&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">

</span><a href="#loc_42_1_42_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_7&#39;)"><span class="mpre">put128</span></a><span class="mpre"> :: </span><a href="#loc_29_6_29_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_6_29_13&#39;)"><span class="hl_tyconref"><span class="mpre">Word128</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_42_1_42_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_7&#39;)"><span class="hl_fundecl"><span class="mpre">put128</span></span></a><span class="mpre"> (</span><a href="#loc_29_16_29_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_16_29_23&#39;)"><span class="hl_conref"><span class="mpre">Word128</span></span></a><span class="mpre"> </span><a name="loc_42_17_42_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_17_42_18&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> </span><a name="loc_42_19_42_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_19_42_20&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">) = </span><a href="Data.ByteString.Internal.html#loc_411_1_411_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_411_1_411_13&#39;)"><span class="hl_varref"><span class="mpre">B.unsafeCreate</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre"> (</span><a href="#loc_44_11_44_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_11_44_18&#39;)"><span class="hl_varref"><span class="mpre">write64</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre">)
    where </span><a href="#loc_44_11_44_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_11_44_18&#39;)"><span class="mpre">write64</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word64</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
          </span><a name="loc_44_11_44_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_11_44_18&#39;)"><span class="hl_fundecl"><span class="mpre">write64</span></span></a><span class="mpre"> </span><a name="loc_44_19_44_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_19_44_22&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_44_19_44_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_19_44_22&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_42_17_42_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_17_42_18&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_44_19_44_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_19_44_22&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">) </span><a href="#loc_42_19_42_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_19_42_20&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

</span><a href="#loc_47_1_47_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_1_47_7&#39;)"><span class="mpre">get128</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><a href="#loc_29_6_29_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_6_29_13&#39;)"><span class="hl_tyconref"><span class="mpre">Word128</span></span></a><span class="mpre">
</span><a name="loc_47_1_47_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_1_47_7&#39;)"><span class="hl_fundecl"><span class="mpre">get128</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">B.PS</span></span></a><span class="mpre"> </span><a name="loc_47_14_47_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_14_47_16&#39;)"><span class="hl_vardecl"><span class="mpre">ps</span></span></a><span class="mpre"> </span><a name="loc_47_17_47_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_17_47_18&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> _) = </span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">B.inlinePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    let </span><a name="loc_48_9_48_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_9_48_12&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span><span class="mpre"> </span><a href="#loc_47_14_47_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_14_47_16&#39;)"><span class="hl_varref"><span class="mpre">ps</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_47_17_47_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_17_47_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word64</span></span><span class="mpre">
    </span><a name="loc_49_5_49_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_5_49_6&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peek</span></span><span class="mpre"> </span><a href="#loc_48_9_48_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_9_48_12&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">
    </span><a name="loc_50_5_50_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_5_50_6&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peek</span></span><span class="mpre"> (</span><a href="#loc_48_9_48_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_9_48_12&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_29_16_29_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_16_29_23&#39;)"><span class="hl_conref"><span class="mpre">Word128</span></span></a><span class="mpre"> </span><a href="#loc_49_5_49_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_5_49_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><a href="#loc_50_5_50_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_5_50_6&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

</span><a href="#loc_54_1_54_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_7&#39;)"><span class="mpre">xor128</span></a><span class="mpre"> :: </span><a href="#loc_29_6_29_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_6_29_13&#39;)"><span class="hl_tyconref"><span class="mpre">Word128</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_29_6_29_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_6_29_13&#39;)"><span class="hl_tyconref"><span class="mpre">Word128</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_29_6_29_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_6_29_13&#39;)"><span class="hl_tyconref"><span class="mpre">Word128</span></span></a><span class="mpre">
</span><a name="loc_54_1_54_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_7&#39;)"><span class="hl_fundecl"><span class="mpre">xor128</span></span></a><span class="mpre"> (</span><a href="#loc_29_16_29_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_16_29_23&#39;)"><span class="hl_conref"><span class="mpre">Word128</span></span></a><span class="mpre"> </span><a name="loc_54_17_54_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_17_54_19&#39;)"><span class="hl_vardecl"><span class="mpre">a1</span></span></a><span class="mpre"> </span><a name="loc_54_20_54_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_20_54_22&#39;)"><span class="hl_vardecl"><span class="mpre">b1</span></span></a><span class="mpre">) (</span><a href="#loc_29_16_29_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_16_29_23&#39;)"><span class="hl_conref"><span class="mpre">Word128</span></span></a><span class="mpre"> </span><a name="loc_54_33_54_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_33_54_35&#39;)"><span class="hl_vardecl"><span class="mpre">a2</span></span></a><span class="mpre"> </span><a name="loc_54_36_54_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_36_54_38&#39;)"><span class="hl_vardecl"><span class="mpre">b2</span></span></a><span class="mpre">) = </span><a href="#loc_29_16_29_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_16_29_23&#39;)"><span class="hl_conref"><span class="mpre">Word128</span></span></a><span class="mpre"> (</span><a href="#loc_54_17_54_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_17_54_19&#39;)"><span class="hl_varref"><span class="mpre">a1</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="hl_infix"><span class="mpre">`xor`</span></span></a><span class="mpre"> </span><a href="#loc_54_33_54_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_33_54_35&#39;)"><span class="hl_varref"><span class="mpre">a2</span></span></a><span class="mpre">) (</span><a href="#loc_54_20_54_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_20_54_22&#39;)"><span class="hl_varref"><span class="mpre">b1</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="hl_infix"><span class="mpre">`xor`</span></span></a><span class="mpre"> </span><a href="#loc_54_36_54_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_36_54_38&#39;)"><span class="hl_varref"><span class="mpre">b2</span></span></a><span class="mpre">)

</span><a href="#loc_57_1_57_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_6&#39;)"><span class="mpre">add64</span></a><span class="mpre"> :: </span><a href="#loc_29_6_29_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_6_29_13&#39;)"><span class="hl_tyconref"><span class="mpre">Word128</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_29_6_29_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_6_29_13&#39;)"><span class="hl_tyconref"><span class="mpre">Word128</span></span></a><span class="mpre">
</span><a name="loc_57_1_57_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_6&#39;)"><span class="hl_fundecl"><span class="mpre">add64</span></span></a><span class="mpre"> (</span><a href="#loc_29_16_29_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_16_29_23&#39;)"><span class="hl_conref"><span class="mpre">Word128</span></span></a><span class="mpre"> </span><a name="loc_57_16_57_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_16_57_17&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> </span><a name="loc_57_18_57_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_18_57_19&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">) = if </span><a href="#loc_58_9_58_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_11&#39;)"><span class="hl_varref"><span class="mpre">nb</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">64</span></span><span class="mpre"> then </span><a href="#loc_29_16_29_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_16_29_23&#39;)"><span class="hl_conref"><span class="mpre">Word128</span></span></a><span class="mpre"> (</span><a href="#loc_57_16_57_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_16_57_17&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_58_9_58_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_11&#39;)"><span class="hl_varref"><span class="mpre">nb</span></span></a><span class="mpre"> else </span><a href="#loc_29_16_29_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_16_29_23&#39;)"><span class="hl_conref"><span class="mpre">Word128</span></span></a><span class="mpre"> </span><a href="#loc_57_16_57_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_16_57_17&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><a href="#loc_58_9_58_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_11&#39;)"><span class="hl_varref"><span class="mpre">nb</span></span></a><span class="mpre">
  where </span><a name="loc_58_9_58_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_11&#39;)"><span class="hl_vardecl"><span class="mpre">nb</span></span></a><span class="mpre"> = </span><a href="#loc_57_18_57_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_18_57_19&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">64</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-
withBsPtr :: ByteString -&gt; (Ptr Word8 -&gt; IO a) -&gt; IO a
withBsPtr (B.PS ps s _) f = withForeignPtr ps $ \ptr -&gt; f (ptr `plusPtr` s)
-}</span></span><span class="mpre">

</span><a href="#loc_66_1_66_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_11&#39;)"><span class="mpre">makeParams</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">AES.AES</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_66_1_66_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_11&#39;)"><span class="hl_fundecl"><span class="mpre">makeParams</span></span></a><span class="mpre"> </span><a name="loc_66_12_66_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_12_66_13&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = (</span><a href="#loc_68_9_68_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_9_68_12&#39;)"><span class="hl_varref"><span class="mpre">key</span></span></a><span class="mpre">, </span><a href="#loc_69_10_69_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_10_69_13&#39;)"><span class="hl_varref"><span class="mpre">cnt</span></span></a><span class="mpre">, </span><a href="#loc_70_10_70_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_10_70_12&#39;)"><span class="hl_varref"><span class="mpre">iv</span></span></a><span class="mpre">)
    where
        </span><a name="loc_68_9_68_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_9_68_12&#39;)"><span class="hl_vardecl"><span class="mpre">key</span></span></a><span class="mpre">          = </span><span class="hl_varref"><span class="mpre">AES.initAES</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.take</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">32</span></span><span class="mpre"> </span><a href="#loc_69_15_69_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_15_69_20&#39;)"><span class="hl_varref"><span class="mpre">left2</span></span></a><span class="mpre">
        (</span><a name="loc_69_10_69_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_10_69_13&#39;)"><span class="hl_vardecl"><span class="mpre">cnt</span></span></a><span class="mpre">, </span><a name="loc_69_15_69_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_15_69_20&#39;)"><span class="hl_vardecl"><span class="mpre">left2</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">B.splitAt</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre"> </span><a href="#loc_70_14_70_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_14_70_19&#39;)"><span class="hl_varref"><span class="mpre">left1</span></span></a><span class="mpre">
        (</span><a name="loc_70_10_70_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_10_70_12&#39;)"><span class="hl_vardecl"><span class="mpre">iv</span></span></a><span class="mpre">, </span><a name="loc_70_14_70_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_14_70_19&#39;)"><span class="hl_vardecl"><span class="mpre">left1</span></span></a><span class="mpre">)  = </span><span class="hl_varref"><span class="mpre">B.splitAt</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre"> </span><a href="#loc_66_12_66_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_12_66_13&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

</span><a href="#loc_73_1_73_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_10&#39;)"><span class="mpre">chunkSize</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_73_1_73_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_10&#39;)"><span class="hl_vardecl"><span class="mpre">chunkSize</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">1024</span></span><span class="mpre">

</span><a href="#loc_76_1_76_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_13&#39;)"><span class="mpre">genNextChunk</span></a><span class="mpre"> :: </span><a href="#loc_32_6_32_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_6_32_9&#39;)"><span class="hl_tyconref"><span class="mpre">RNG</span></span></a><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">, </span><a href="#loc_32_6_32_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_6_32_9&#39;)"><span class="hl_tyconref"><span class="mpre">RNG</span></span></a><span class="mpre">)
</span><a name="loc_76_1_76_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_13&#39;)"><span class="hl_fundecl"><span class="mpre">genNextChunk</span></span></a><span class="mpre"> (</span><a href="#loc_32_12_32_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_12_32_15&#39;)"><span class="hl_conref"><span class="mpre">RNG</span></span></a><span class="mpre"> </span><a name="loc_76_19_76_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_19_76_21&#39;)"><span class="hl_vardecl"><span class="mpre">iv</span></span></a><span class="mpre"> </span><a name="loc_76_22_76_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_22_76_29&#39;)"><span class="hl_vardecl"><span class="mpre">counter</span></span></a><span class="mpre"> </span><a name="loc_76_30_76_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_30_76_38&#39;)"><span class="hl_vardecl"><span class="mpre">nbChunks</span></span></a><span class="mpre"> </span><a name="loc_76_39_76_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_39_76_42&#39;)"><span class="hl_vardecl"><span class="mpre">key</span></span></a><span class="mpre">) = (</span><a href="#loc_79_9_79_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_9_79_14&#39;)"><span class="hl_varref"><span class="mpre">chunk</span></span></a><span class="mpre">, </span><a href="#loc_78_9_78_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_9_78_15&#39;)"><span class="hl_varref"><span class="mpre">newrng</span></span></a><span class="mpre">)
  where
        </span><a name="loc_78_9_78_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_9_78_15&#39;)"><span class="hl_vardecl"><span class="mpre">newrng</span></span></a><span class="mpre"> = </span><a href="#loc_32_12_32_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_12_32_15&#39;)"><span class="hl_conref"><span class="mpre">RNG</span></span></a><span class="mpre"> (</span><a href="#loc_47_1_47_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_1_47_7&#39;)"><span class="hl_varref"><span class="mpre">get128</span></span></a><span class="mpre"> </span><a href="#loc_79_9_79_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_9_79_14&#39;)"><span class="hl_varref"><span class="mpre">chunk</span></span></a><span class="mpre">) (</span><a href="#loc_57_1_57_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_6&#39;)"><span class="hl_varref"><span class="mpre">add64</span></span></a><span class="mpre"> </span><a href="#loc_76_22_76_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_22_76_29&#39;)"><span class="hl_varref"><span class="mpre">counter</span></span></a><span class="mpre">) (</span><a href="#loc_76_30_76_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_30_76_38&#39;)"><span class="hl_varref"><span class="mpre">nbChunks</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_76_39_76_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_39_76_42&#39;)"><span class="hl_varref"><span class="mpre">key</span></span></a><span class="mpre">
        </span><a name="loc_79_9_79_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_9_79_14&#39;)"><span class="hl_vardecl"><span class="mpre">chunk</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">AES.genCTR</span></span><span class="mpre"> </span><a href="#loc_76_39_76_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_39_76_42&#39;)"><span class="hl_varref"><span class="mpre">key</span></span></a><span class="mpre"> </span><a href="#loc_80_9_80_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_14&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre"> </span><a href="#loc_73_1_73_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_10&#39;)"><span class="hl_varref"><span class="mpre">chunkSize</span></span></a><span class="mpre">
        </span><a name="loc_80_9_80_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_14&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre">  = </span><a href="#loc_42_1_42_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_7&#39;)"><span class="hl_varref"><span class="mpre">put128</span></span></a><span class="mpre"> (</span><a href="#loc_76_19_76_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_19_76_21&#39;)"><span class="hl_varref"><span class="mpre">iv</span></span></a><span class="mpre"> </span><a href="#loc_54_1_54_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_7&#39;)"><span class="hl_infix"><span class="mpre">`xor128`</span></span></a><span class="mpre"> </span><a href="#loc_76_22_76_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_22_76_29&#39;)"><span class="hl_varref"><span class="mpre">counter</span></span></a><span class="mpre">)
</span></div></body></html>