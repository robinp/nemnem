<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE BangPatterns #-}
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Data.Text.Lazy.Fusion</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   : (c) 2009, 2010 Bryan O&#39;Sullivan</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : bos@serpentine.com</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : GHC</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /Warning/: this is an internal module, and does not have a stable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- API or name. Functions in this module may not check or enforce</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- preconditions expected by public modules. Use at your own risk!</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Core stream fusion functionality for text.</span></span><span class="mpre">

module Data.Text.Internal.Lazy.Fusion
    (
      stream
    , unstream
    , unstreamChunks
    , length
    , unfoldrN
    , index
    , countChar
    ) where

import Prelude hiding (length)
import qualified Data.Text.Internal.Fusion.Common as S
import Control.Monad.ST (runST)
import Data.Text.Internal.Fusion.Types
import Data.Text.Internal.Fusion.Size (</span><a href="Data.Text.Internal.Fusion.Size.html#loc_157_1_157_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Size.html#loc_157_1_157_8&#39;)"><span class="mpre">isEmpty</span></a><span class="mpre">, </span><a href="Data.Text.Internal.Fusion.Size.html#loc_74_1_74_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Size.html#loc_74_1_74_12&#39;)"><span class="mpre">unknownSize</span></a><span class="mpre">)
import Data.Text.Internal.Lazy
import qualified Data.Text.Internal as I
import qualified Data.Text.Array as A
import Data.Text.Internal.Unsafe.Char (</span><a href="Data.Text.Internal.Unsafe.Char.html#loc_58_1_58_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Unsafe.Char.html#loc_58_1_58_12&#39;)"><span class="mpre">unsafeWrite</span></a><span class="mpre">)
import Data.Text.Internal.Unsafe.Shift (</span><a href="Data.Text.Internal.Unsafe.Shift.html#loc_34_5_34_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Unsafe.Shift.html#loc_34_5_34_11&#39;)"><span class="mpre">shiftL</span></a><span class="mpre">)
import Data.Text.Unsafe (</span><a href="Data.Text.Unsafe.html#loc_62_6_62_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Unsafe.html#loc_62_6_62_10&#39;)"><span class="mpre">Iter</span></a><span class="mpre">(..), </span><a href="Data.Text.Unsafe.html#loc_68_1_68_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Unsafe.html#loc_68_1_68_5&#39;)"><span class="mpre">iter</span></a><span class="mpre">)
import Data.Int (</span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="mpre">Int64</span></a><span class="mpre">)

</span><span class="warning" data-warning="DeclDefaultDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal/Lazy/Fusion.hs&quot;, srcSpanStartLine = 41, srcSpanStartColumn = 1, srcSpanEndLine = 41, srcSpanEndColumn = 15}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal/Lazy/Fusion.hs&quot;, srcSpanStartLine = 41, srcSpanStartColumn = 1, srcSpanEndLine = 41, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal"><span class="mpre">default(Int64)</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(n)/ Convert a &#39;Text&#39; into a &#39;Stream Char&#39;.</span></span><span class="mpre">
</span><a href="#loc_45_1_45_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_7&#39;)"><span class="mpre">stream</span></a><span class="mpre"> :: </span><a href="Data.Text.Internal.Lazy.html#loc_47_6_47_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Lazy.html#loc_47_6_47_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre"> -&gt; </span><a href="Data.Text.Internal.Fusion.Types.html#loc_88_6_88_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Types.html#loc_88_6_88_12&#39;)"><span class="hl_tyconref"><span class="mpre">Stream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">
</span><a name="loc_45_1_45_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_7&#39;)"><span class="hl_fundecl"><span class="mpre">stream</span></span></a><span class="mpre"> </span><a name="loc_45_8_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_8_45_12&#39;)"><span class="hl_vardecl"><span class="mpre">text</span></span></a><span class="mpre"> = </span><a href="Data.Text.Internal.Fusion.Types.html#loc_89_15_89_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Types.html#loc_89_15_89_21&#39;)"><span class="hl_conref"><span class="mpre">Stream</span></span></a><span class="mpre"> </span><a href="#loc_47_5_47_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_5_47_9&#39;)"><span class="hl_varref"><span class="mpre">next</span></span></a><span class="mpre"> (</span><a href="#loc_45_8_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_8_45_12&#39;)"><span class="hl_varref"><span class="mpre">text</span></span></a><span class="mpre"> </span><a href="Data.Text.Internal.Fusion.Types.html#loc_53_21_53_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Types.html#loc_53_21_53_24&#39;)"><span class="hl_infix"><span class="mpre">:*:</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">) </span><a href="Data.Text.Internal.Fusion.Size.html#loc_74_1_74_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Size.html#loc_74_1_74_12&#39;)"><span class="hl_varref"><span class="mpre">unknownSize</span></span></a><span class="mpre">
  where
    </span><a name="loc_47_5_47_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_5_47_9&#39;)"><span class="hl_fundecl"><span class="mpre">next</span></span></a><span class="mpre"> (</span><a href="Data.Text.Internal.Lazy.html#loc_47_13_47_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Lazy.html#loc_47_13_47_18&#39;)"><span class="hl_conref"><span class="mpre">Empty</span></span></a><span class="mpre"> </span><a href="Data.Text.Internal.Fusion.Types.html#loc_53_21_53_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Types.html#loc_53_21_53_24&#39;)"><span class="hl_infix"><span class="mpre">:*:</span></span></a><span class="mpre"> _) = </span><a href="Data.Text.Internal.Fusion.Types.html#loc_59_17_59_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Types.html#loc_59_17_59_21&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre">
    </span><a href="#loc_47_5_47_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_5_47_9&#39;)"><span class="hl_fundecl"><span class="mpre">next</span></span></a><span class="mpre"> (</span><a name="loc_48_11_48_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_11_48_14&#39;)"><span class="hl_specname"><span class="mpre">txt</span></span></a><span class="mpre">@(</span><a href="Data.Text.Internal.Lazy.html#loc_48_13_48_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Lazy.html#loc_48_13_48_18&#39;)"><span class="hl_conref"><span class="mpre">Chunk</span></span></a><span class="mpre"> </span><a name="loc_48_22_48_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_22_48_23&#39;)"><span class="hl_specname"><span class="mpre">t</span></span></a><span class="mpre">@(</span><a href="Data.Text.Internal.html#loc_50_13_50_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_13_50_17&#39;)"><span class="hl_conref"><span class="mpre">I.Text</span></span></a><span class="mpre"> _ _ </span><a name="loc_48_36_48_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_36_48_39&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">) </span><a name="loc_48_41_48_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_41_48_43&#39;)"><span class="hl_vardecl"><span class="mpre">ts</span></span></a><span class="mpre">) </span><a href="Data.Text.Internal.Fusion.Types.html#loc_53_21_53_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Types.html#loc_53_21_53_24&#39;)"><span class="hl_infix"><span class="mpre">:*:</span></span></a><span class="mpre"> </span><a name="loc_48_49_48_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_49_48_50&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">)
        | </span><a href="#loc_48_49_48_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_49_48_50&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="#loc_48_36_48_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_36_48_39&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">  = </span><a href="#loc_47_5_47_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_5_47_9&#39;)"><span class="hl_varref"><span class="mpre">next</span></span></a><span class="mpre"> (</span><a href="#loc_48_41_48_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_41_48_43&#39;)"><span class="hl_varref"><span class="mpre">ts</span></span></a><span class="mpre"> </span><a href="Data.Text.Internal.Fusion.Types.html#loc_53_21_53_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Types.html#loc_53_21_53_24&#39;)"><span class="hl_infix"><span class="mpre">:*:</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">)
        | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="Data.Text.Internal.Fusion.Types.html#loc_61_17_61_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Types.html#loc_61_17_61_22&#39;)"><span class="hl_conref"><span class="mpre">Yield</span></span></a><span class="mpre"> </span><a href="#loc_51_20_51_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_20_51_21&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> (</span><a href="#loc_48_11_48_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_11_48_14&#39;)"><span class="hl_varref"><span class="mpre">txt</span></span></a><span class="mpre"> </span><a href="Data.Text.Internal.Fusion.Types.html#loc_53_21_53_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Types.html#loc_53_21_53_24&#39;)"><span class="hl_infix"><span class="mpre">:*:</span></span></a><span class="mpre"> </span><a href="#loc_48_49_48_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_49_48_50&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_51_22_51_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_22_51_23&#39;)"><span class="hl_varref"><span class="mpre">d</span></span></a><span class="mpre">)
        where </span><a href="Data.Text.Unsafe.html#loc_62_13_62_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Unsafe.html#loc_62_13_62_17&#39;)"><span class="hl_conref"><span class="mpre">Iter</span></span></a><span class="mpre"> </span><a name="loc_51_20_51_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_20_51_21&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> </span><a name="loc_51_22_51_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_22_51_23&#39;)"><span class="hl_vardecl"><span class="mpre">d</span></span></a><span class="mpre"> = </span><a href="Data.Text.Unsafe.html#loc_68_1_68_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Unsafe.html#loc_68_1_68_5&#39;)"><span class="hl_varref"><span class="mpre">iter</span></span></a><span class="mpre"> </span><a href="#loc_48_22_48_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_22_48_23&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><a href="#loc_48_49_48_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_49_48_50&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE [0] </span><a href="#loc_45_1_45_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_7&#39;)"><span class="mpre">stream</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(n)/ Convert a &#39;Stream Char&#39; into a &#39;Text&#39;, using the given</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- chunk size.</span></span><span class="mpre">
</span><a href="#loc_57_1_57_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_15&#39;)"><span class="mpre">unstreamChunks</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="Data.Text.Internal.Fusion.Types.html#loc_88_6_88_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Types.html#loc_88_6_88_12&#39;)"><span class="hl_tyconref"><span class="mpre">Stream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><a href="Data.Text.Internal.Lazy.html#loc_47_6_47_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Lazy.html#loc_47_6_47_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre">
</span><a name="loc_57_1_57_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_15&#39;)"><span class="hl_fundecl"><span class="mpre">unstreamChunks</span></span></a><span class="mpre"> !</span><a name="loc_57_17_57_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_17_57_26&#39;)"><span class="hl_vardecl"><span class="mpre">chunkSize</span></span></a><span class="mpre"> (</span><a href="Data.Text.Internal.Fusion.Types.html#loc_89_15_89_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Types.html#loc_89_15_89_21&#39;)"><span class="hl_conref"><span class="mpre">Stream</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">next</span></span><span class="mpre"> </span><a name="loc_57_40_57_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_40_57_42&#39;)"><span class="hl_vardecl"><span class="mpre">s0</span></span></a><span class="mpre"> </span><a name="loc_57_43_57_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_43_57_47&#39;)"><span class="hl_vardecl"><span class="mpre">len0</span></span></a><span class="mpre">)
  | </span><a href="Data.Text.Internal.Fusion.Size.html#loc_157_1_157_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Size.html#loc_157_1_157_8&#39;)"><span class="hl_varref"><span class="mpre">isEmpty</span></span></a><span class="mpre"> </span><a href="#loc_57_43_57_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_43_57_47&#39;)"><span class="hl_varref"><span class="mpre">len0</span></span></a><span class="mpre"> = </span><a href="Data.Text.Internal.Lazy.html#loc_47_13_47_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Lazy.html#loc_47_13_47_18&#39;)"><span class="hl_conref"><span class="mpre">Empty</span></span></a><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">    = </span><a href="#loc_61_5_61_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_5_61_10&#39;)"><span class="hl_varref"><span class="mpre">outer</span></span></a><span class="mpre"> </span><a href="#loc_57_40_57_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_40_57_42&#39;)"><span class="hl_varref"><span class="mpre">s0</span></span></a><span class="mpre">
  where
    </span><a name="loc_61_5_61_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_5_61_10&#39;)"><span class="hl_fundecl"><span class="mpre">outer</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">so</span></span><span class="mpre"> = </span><span class="warning" data-warning="ExpSCCPragma (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal/Lazy/Fusion.hs&quot;, srcSpanStartLine = 61, srcSpanStartColumn = 16, srcSpanEndLine = 69, srcSpanEndColumn = 0}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal/Lazy/Fusion.hs&quot;, srcSpanStartLine = 61, srcSpanStartColumn = 24, srcSpanEndLine = 61, srcSpanEndColumn = 46},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal"><span class="mpre">{-# SCC &quot;unstreamChunks/outer&quot; #-}
              case next so of
                Done       -&gt; Empty
                Skip s&#39;    -&gt; outer s&#39;
                Yield x s&#39; -&gt; runST $ do
                                a &lt;- A.new unknownLength
                                unsafeWrite a 0 x &gt;&gt;= inner a unknownLength s&#39;
                    where unknownLength = 4</span></span><span class="mpre">
      where
        </span><span class="hl_fundecl"><span class="mpre">inner</span></span><span class="mpre"> </span><a name="loc_70_15_70_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_15_70_19&#39;)"><span class="hl_vardecl"><span class="mpre">marr</span></span></a><span class="mpre"> !</span><a name="loc_70_21_70_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_21_70_24&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_70_25_70_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_25_70_26&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> !</span><a name="loc_70_28_70_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_28_70_29&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">
            | </span><a href="#loc_70_28_70_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_28_70_29&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="#loc_57_17_57_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_17_57_26&#39;)"><span class="hl_varref"><span class="mpre">chunkSize</span></span></a><span class="mpre"> = </span><a href="#loc_84_9_84_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_9_84_15&#39;)"><span class="hl_varref"><span class="mpre">finish</span></span></a><span class="mpre"> </span><a href="#loc_70_15_70_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_15_70_19&#39;)"><span class="hl_varref"><span class="mpre">marr</span></span></a><span class="mpre"> </span><a href="#loc_70_28_70_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_28_70_29&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="#loc_70_25_70_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_25_70_26&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
            | </span><a href="#loc_70_28_70_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_28_70_29&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="#loc_70_21_70_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_21_70_24&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">       = </span><span class="warning" data-warning="ExpSCCPragma (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal/Lazy/Fusion.hs&quot;, srcSpanStartLine = 72, srcSpanStartColumn = 36, srcSpanEndLine = 77, srcSpanEndColumn = 0}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal/Lazy/Fusion.hs&quot;, srcSpanStartLine = 72, srcSpanStartColumn = 44, srcSpanEndLine = 72, srcSpanEndColumn = 67},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal"><span class="mpre">{-# SCC &quot;unstreamChunks/resize&quot; #-} do
                let newLen = min (len `shiftL` 1) chunkSize
                marr&#39; &lt;- A.new newLen
                A.copyM marr&#39; 0 marr 0 len
                inner marr&#39; newLen s i</span></span><span class="mpre">
            | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> =
                </span><span class="warning" data-warning="ExpSCCPragma (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal/Lazy/Fusion.hs&quot;, srcSpanStartLine = 78, srcSpanStartColumn = 17, srcSpanEndLine = 84, srcSpanEndColumn = 0}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal/Lazy/Fusion.hs&quot;, srcSpanStartLine = 78, srcSpanStartColumn = 25, srcSpanEndLine = 78, srcSpanEndColumn = 47},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal"><span class="mpre">{-# SCC &quot;unstreamChunks/inner&quot; #-}
                case next s of
                  Done        -&gt; finish marr i s
                  Skip s&#39;     -&gt; inner marr len s&#39; i
                  Yield x s&#39;  -&gt; do d &lt;- unsafeWrite marr i x
                                    inner marr len s&#39; (i+d)</span></span><span class="mpre">
        </span><a name="loc_84_9_84_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_9_84_15&#39;)"><span class="hl_fundecl"><span class="mpre">finish</span></span></a><span class="mpre"> </span><a name="loc_84_16_84_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_16_84_20&#39;)"><span class="hl_vardecl"><span class="mpre">marr</span></span></a><span class="mpre"> </span><a name="loc_84_21_84_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_21_84_24&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_84_25_84_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_25_84_27&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre"> = do
          </span><a name="loc_85_11_85_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_11_85_14&#39;)"><span class="hl_vardecl"><span class="mpre">arr</span></span></a><span class="mpre"> &lt;- </span><a href="Data.Text.Array.html#loc_133_1_133_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Array.html#loc_133_1_133_13&#39;)"><span class="hl_varref"><span class="mpre">A.unsafeFreeze</span></span></a><span class="mpre"> </span><a href="#loc_84_16_84_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_16_84_20&#39;)"><span class="hl_varref"><span class="mpre">marr</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Data.Text.Internal.html#loc_50_13_50_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_13_50_17&#39;)"><span class="hl_conref"><span class="mpre">I.Text</span></span></a><span class="mpre"> </span><a href="#loc_85_11_85_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_11_85_14&#39;)"><span class="hl_varref"><span class="mpre">arr</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_84_21_84_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_21_84_24&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><a href="Data.Text.Internal.Lazy.html#loc_48_13_48_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Lazy.html#loc_48_13_48_18&#39;)"><span class="hl_infix"><span class="mpre">`Chunk`</span></span></a><span class="mpre"> </span><a href="#loc_61_5_61_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_5_61_10&#39;)"><span class="hl_varref"><span class="mpre">outer</span></span></a><span class="mpre"> </span><a href="#loc_84_25_84_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_25_84_27&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE [0] </span><a href="#loc_57_1_57_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_15&#39;)"><span class="mpre">unstreamChunks</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(n)/ Convert a &#39;Stream Char&#39; into a &#39;Text&#39;, using</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;defaultChunkSize&#39;.</span></span><span class="mpre">
</span><a href="#loc_92_1_92_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_9&#39;)"><span class="mpre">unstream</span></a><span class="mpre"> :: </span><a href="Data.Text.Internal.Fusion.Types.html#loc_88_6_88_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Types.html#loc_88_6_88_12&#39;)"><span class="hl_tyconref"><span class="mpre">Stream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><a href="Data.Text.Internal.Lazy.html#loc_47_6_47_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Lazy.html#loc_47_6_47_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre">
</span><a name="loc_92_1_92_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_9&#39;)"><span class="hl_vardecl"><span class="mpre">unstream</span></span></a><span class="mpre"> = </span><a href="#loc_57_1_57_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_15&#39;)"><span class="hl_varref"><span class="mpre">unstreamChunks</span></span></a><span class="mpre"> </span><a href="Data.Text.Internal.Lazy.html#loc_108_1_108_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Lazy.html#loc_108_1_108_17&#39;)"><span class="hl_varref"><span class="mpre">defaultChunkSize</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE [0] </span><a href="#loc_92_1_92_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_9&#39;)"><span class="mpre">unstream</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(n)/ Returns the number of characters in a text.</span></span><span class="mpre">
</span><a href="#loc_97_1_97_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_1_97_7&#39;)"><span class="mpre">length</span></a><span class="mpre"> :: </span><a href="Data.Text.Internal.Fusion.Types.html#loc_88_6_88_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Types.html#loc_88_6_88_12&#39;)"><span class="hl_tyconref"><span class="mpre">Stream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre">
</span><a name="loc_97_1_97_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_1_97_7&#39;)"><span class="hl_vardecl"><span class="mpre">length</span></span></a><span class="mpre"> = </span><a href="Data.Text.Internal.Fusion.Common.html#loc_305_1_305_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Common.html#loc_305_1_305_8&#39;)"><span class="hl_varref"><span class="mpre">S.lengthI</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE[0] </span><a href="#loc_97_1_97_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_1_97_7&#39;)"><span class="mpre">length</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# RULES &quot;LAZY STREAM stream/unstream fusion&quot; forall s.
    stream (unstream s) = s #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(n)/ Like &#39;unfoldr&#39;, &#39;unfoldrN&#39; builds a stream from a seed</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- value. However, the length of the result is limited by the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- first argument to &#39;unfoldrN&#39;. This function is more efficient than</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;unfoldr&#39; when the length of the result is known.</span></span><span class="mpre">
</span><a href="#loc_108_1_108_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_9&#39;)"><span class="mpre">unfoldrN</span></a><span class="mpre"> :: </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">,</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)) -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="Data.Text.Internal.Fusion.Types.html#loc_88_6_88_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Types.html#loc_88_6_88_12&#39;)"><span class="hl_tyconref"><span class="mpre">Stream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">
</span><a name="loc_108_1_108_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_9&#39;)"><span class="hl_fundecl"><span class="mpre">unfoldrN</span></span></a><span class="mpre"> </span><a name="loc_108_10_108_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_10_108_11&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><a href="Data.Text.Internal.Fusion.Common.html#loc_733_1_733_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Common.html#loc_733_1_733_10&#39;)"><span class="hl_varref"><span class="mpre">S.unfoldrNI</span></span></a><span class="mpre"> </span><a href="#loc_108_10_108_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_10_108_11&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE [0] </span><a href="#loc_108_1_108_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_9&#39;)"><span class="mpre">unfoldrN</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(n)/ stream index (subscript) operator, starting from 0.</span></span><span class="mpre">
</span><a href="#loc_113_1_113_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_1_113_6&#39;)"><span class="mpre">index</span></a><span class="mpre"> :: </span><a href="Data.Text.Internal.Fusion.Types.html#loc_88_6_88_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Types.html#loc_88_6_88_12&#39;)"><span class="hl_tyconref"><span class="mpre">Stream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">
</span><a name="loc_113_1_113_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_1_113_6&#39;)"><span class="hl_vardecl"><span class="mpre">index</span></span></a><span class="mpre"> = </span><a href="Data.Text.Internal.Fusion.Common.html#loc_860_1_860_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Common.html#loc_860_1_860_7&#39;)"><span class="hl_varref"><span class="mpre">S.indexI</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE [0] </span><a href="#loc_113_1_113_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_1_113_6&#39;)"><span class="mpre">index</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(n)/ The &#39;count&#39; function returns the number of times the query</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- element appears in the given stream.</span></span><span class="mpre">
</span><a href="#loc_119_1_119_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_10&#39;)"><span class="mpre">countChar</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><a href="Data.Text.Internal.Fusion.Types.html#loc_88_6_88_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Types.html#loc_88_6_88_12&#39;)"><span class="hl_tyconref"><span class="mpre">Stream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre">
</span><a name="loc_119_1_119_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_10&#39;)"><span class="hl_vardecl"><span class="mpre">countChar</span></span></a><span class="mpre"> = </span><a href="Data.Text.Internal.Fusion.Common.html#loc_934_1_934_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Fusion.Common.html#loc_934_1_934_11&#39;)"><span class="hl_varref"><span class="mpre">S.countCharI</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE [0] </span><a href="#loc_119_1_119_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_10&#39;)"><span class="mpre">countChar</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span></div></body></html>