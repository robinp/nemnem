<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- | This module provides support for parsing values from &#39;InputStream&#39;s using</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @attoparsec@.</span></span><span class="mpre">

{-# LANGUAGE DeriveDataTypeable #-}
{-# LANGUAGE OverloadedStrings  #-}

module System.IO.Streams.Internal.Attoparsec
  ( </span><span class="hl_comment"><span class="mpre">-- * Parsing</span></span><span class="mpre">
    ParseException(..)
  , parseFromStream
  , parseFromStreamInternal
  , parserToInputStream
  ) where

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
import           Control.Exception                (Exception, </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="mpre">throwIO</span></a><span class="mpre">)
import           Control.Monad                    (</span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">)
import           Data.Attoparsec.ByteString.Char8 (Parser, Result, </span><a href="Data.Attoparsec.ByteString.html#loc_221_1_221_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Attoparsec.ByteString.html#loc_221_1_221_13&#39;)"><span class="mpre">eitherResult</span></a><span class="mpre">, </span><a href="Data.Attoparsec.Combinator.html#loc_239_1_239_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Attoparsec.Combinator.html#loc_239_1_239_5&#39;)"><span class="mpre">feed</span></a><span class="mpre">, </span><a href="Data.Attoparsec.ByteString.Internal.html#loc_405_1_405_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Attoparsec.ByteString.Internal.html#loc_405_1_405_6&#39;)"><span class="mpre">parse</span></a><span class="mpre">)
import           Data.Attoparsec.Types            (</span><a href="Data.Attoparsec.Internal.Types.html#loc_51_6_51_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Attoparsec.Internal.Types.html#loc_51_6_51_13&#39;)"><span class="mpre">IResult</span></a><span class="mpre"> (..))
import           </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal/Attoparsec.hs&quot;, srcSpanStartLine = 20, srcSpanStartColumn = 18, srcSpanEndLine = 20, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre">            (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal/Attoparsec.hs&quot;, srcSpanStartLine = 21, srcSpanStartColumn = 18, srcSpanEndLine = 21, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre">            as S
import           Data.Typeable                    (</span><a href="Data.Typeable.Internal.html#loc_196_7_196_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Typeable.Internal.html#loc_196_7_196_15&#39;)"><span class="mpre">Typeable</span></a><span class="mpre">)
import           Prelude                          hiding (</span><a href="Text.Read.html#loc_91_1_91_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Read.html#loc_91_1_91_5&#39;)"><span class="mpre">read</span></a><span class="mpre">)
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
import           System.IO.Streams.Internal       (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="mpre">InputStream</span></a><span class="mpre">)
import qualified System.IO.Streams.Internal       as Streams


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | An exception raised when parsing fails.</span></span><span class="mpre">
data </span><a name="loc_31_6_31_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_6_31_20&#39;)"><span class="hl_tycondecl"><span class="mpre">ParseException</span></span></a><span class="mpre"> = </span><a name="loc_31_23_31_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_23_31_37&#39;)"><span class="hl_condecl"><span class="mpre">ParseException</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
  </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal/Attoparsec.hs&quot;, srcSpanStartLine = 32, srcSpanStartColumn = 3, srcSpanEndLine = 32, srcSpanEndColumn = 22}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal/Attoparsec.hs&quot;, srcSpanStartLine = 32, srcSpanStartColumn = 3, srcSpanEndLine = 32, srcSpanEndColumn = 11},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull"><span class="mpre">deriving (Typeable)</span></span><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Show</span></span><span class="mpre"> </span><a href="#loc_31_6_31_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_6_31_20&#39;)"><span class="hl_tyconref"><span class="mpre">ParseException</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">show</span></span><span class="mpre"> (</span><a href="#loc_31_23_31_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_23_31_37&#39;)"><span class="hl_conref"><span class="mpre">ParseException</span></span></a><span class="mpre"> </span><a name="loc_35_26_35_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_26_35_27&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">) = </span><span class="hl_string"><span class="mpre">&quot;Parse exception: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_35_26_35_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_26_35_27&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Exception</span></span><span class="mpre"> </span><a href="#loc_31_6_31_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_6_31_20&#39;)"><span class="hl_tyconref"><span class="mpre">ParseException</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Supplies an @attoparsec@ &#39;Parser&#39; with an &#39;InputStream&#39;, returning the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- final parsed value or a &#39;ParseException&#39; if parsing fails.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;parseFromStream&#39; consumes only as much input as necessary to satisfy the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Parser&#39; and unconsumed input is pushed back onto the &#39;InputStream&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If the &#39;Parser&#39; exhausts the &#39;InputStream&#39;, it receives an @EOF@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; import &quot;Data.Attoparsec.ByteString.Char8&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; is &lt;- &#39;System.IO.Streams.fromList&#39; [\&quot;12345xxx\&quot; :: &#39;ByteString&#39;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; &#39;parseFromStream&#39; (&#39;Data.Attoparsec.ByteString.Char8.takeWhile&#39; &#39;Data.Attoparsec.ByteString.Char8.isDigit&#39;) is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- \&quot;12345\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; &#39;System.IO.Streams.read&#39; is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just \&quot;xxx\&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_61_1_61_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_16&#39;)"><span class="mpre">parseFromStream</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Parser</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">
                -&gt; </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
                -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">
</span><a name="loc_61_1_61_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_16&#39;)"><span class="hl_vardecl"><span class="mpre">parseFromStream</span></span></a><span class="mpre"> = </span><a href="#loc_73_1_73_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_24&#39;)"><span class="hl_varref"><span class="mpre">parseFromStreamInternal</span></span></a><span class="mpre"> </span><a href="Data.Attoparsec.ByteString.Internal.html#loc_405_1_405_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Attoparsec.ByteString.Internal.html#loc_405_1_405_6&#39;)"><span class="hl_varref"><span class="mpre">parse</span></span></a><span class="mpre"> </span><a href="Data.Attoparsec.Combinator.html#loc_239_1_239_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Attoparsec.Combinator.html#loc_239_1_239_5&#39;)"><span class="hl_varref"><span class="mpre">feed</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_61_1_61_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_16&#39;)"><span class="mpre">parseFromStream</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Internal version of parseFromStream allowing dependency injection of the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- parse functions for testing.</span></span><span class="mpre">
</span><a href="#loc_73_1_73_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_24&#39;)"><span class="mpre">parseFromStreamInternal</span></a><span class="mpre"> :: (</span><span class="hl_tyconref"><span class="mpre">Parser</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">)
                        -&gt; (</span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Result</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">)
                        -&gt; </span><span class="hl_tyconref"><span class="mpre">Parser</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">
                        -&gt; </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
                        -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">
</span><a name="loc_73_1_73_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_24&#39;)"><span class="hl_fundecl"><span class="mpre">parseFromStreamInternal</span></span></a><span class="mpre"> </span><a name="loc_73_25_73_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_25_73_34&#39;)"><span class="hl_vardecl"><span class="mpre">parseFunc</span></span></a><span class="mpre"> </span><a name="loc_73_35_73_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_35_73_43&#39;)"><span class="hl_vardecl"><span class="mpre">feedFunc</span></span></a><span class="mpre"> </span><a name="loc_73_44_73_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_44_73_50&#39;)"><span class="hl_vardecl"><span class="mpre">parser</span></span></a><span class="mpre"> </span><a name="loc_73_51_73_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_51_73_53&#39;)"><span class="hl_vardecl"><span class="mpre">is</span></span></a><span class="mpre"> =
    </span><a href="System.IO.Streams.Internal.html#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">Streams.read</span></span></a><span class="mpre"> </span><a href="#loc_73_51_73_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_51_73_53&#39;)"><span class="hl_varref"><span class="mpre">is</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre">
    </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><a href="#loc_82_5_82_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_5_82_11&#39;)"><span class="hl_varref"><span class="mpre">finish</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_73_25_73_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_25_73_34&#39;)"><span class="hl_varref"><span class="mpre">parseFunc</span></span></a><span class="mpre"> </span><a href="#loc_73_44_73_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_44_73_50&#39;)"><span class="hl_varref"><span class="mpre">parser</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">)
          (\</span><a name="loc_76_13_76_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_13_76_14&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; if </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_76_13_76_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_13_76_14&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
                   then </span><a href="#loc_73_1_73_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_24&#39;)"><span class="hl_varref"><span class="mpre">parseFromStreamInternal</span></span></a><span class="mpre"> </span><a href="#loc_73_25_73_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_25_73_34&#39;)"><span class="hl_varref"><span class="mpre">parseFunc</span></span></a><span class="mpre"> </span><a href="#loc_73_35_73_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_35_73_43&#39;)"><span class="hl_varref"><span class="mpre">feedFunc</span></span></a><span class="mpre"> </span><a href="#loc_73_44_73_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_44_73_50&#39;)"><span class="hl_varref"><span class="mpre">parser</span></span></a><span class="mpre"> </span><a href="#loc_73_51_73_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_51_73_53&#39;)"><span class="hl_varref"><span class="mpre">is</span></span></a><span class="mpre">
                   else </span><a href="#loc_90_5_90_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_73_25_73_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_25_73_34&#39;)"><span class="hl_varref"><span class="mpre">parseFunc</span></span></a><span class="mpre"> </span><a href="#loc_73_44_73_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_44_73_50&#39;)"><span class="hl_varref"><span class="mpre">parser</span></span></a><span class="mpre"> </span><a href="#loc_76_13_76_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_13_76_14&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)
  where
    </span><a name="loc_80_5_80_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_5_80_13&#39;)"><span class="hl_fundecl"><span class="mpre">leftover</span></span></a><span class="mpre"> </span><a name="loc_80_14_80_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_14_80_15&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_80_14_80_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_14_80_15&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="System.IO.Streams.Internal.html#loc_178_1_178_7" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_178_1_178_7&#39;)"><span class="hl_varref"><span class="mpre">Streams.unRead</span></span></a><span class="mpre"> </span><a href="#loc_80_14_80_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_14_80_15&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="#loc_73_51_73_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_51_73_53&#39;)"><span class="hl_varref"><span class="mpre">is</span></span></a><span class="mpre">

    </span><a name="loc_82_5_82_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_5_82_11&#39;)"><span class="hl_fundecl"><span class="mpre">finish</span></span></a><span class="mpre"> </span><a name="loc_82_12_82_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_12_82_13&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = let </span><a name="loc_82_20_82_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_20_82_22&#39;)"><span class="hl_vardecl"><span class="mpre">k&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_73_35_73_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_35_73_43&#39;)"><span class="hl_varref"><span class="mpre">feedFunc</span></span></a><span class="mpre"> (</span><a href="#loc_73_35_73_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_35_73_43&#39;)"><span class="hl_varref"><span class="mpre">feedFunc</span></span></a><span class="mpre"> </span><a href="#loc_82_12_82_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_12_82_13&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">) </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
               in case </span><a href="#loc_82_20_82_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_20_82_22&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre"> of
                    </span><span class="hl_conref"><span class="mpre">Fail</span></span><span class="mpre"> </span><a name="loc_84_26_84_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_26_84_27&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> _ _ -&gt; </span><a href="#loc_80_5_80_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_5_80_13&#39;)"><span class="hl_varref"><span class="mpre">leftover</span></span></a><span class="mpre"> </span><a href="#loc_84_26_84_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_26_84_27&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_88_5_88_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_5_88_8&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre"> </span><a href="#loc_82_20_82_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_20_82_22&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre">
                    </span><span class="hl_conref"><span class="mpre">Partial</span></span><span class="mpre"> _  -&gt; </span><a href="#loc_88_5_88_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_5_88_8&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre"> </span><a href="#loc_82_20_82_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_20_82_22&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre">                </span><span class="hl_comment"><span class="mpre">-- should be impossible</span></span><span class="mpre">
                    </span><span class="hl_conref"><span class="mpre">Done</span></span><span class="mpre"> </span><a name="loc_86_26_86_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_26_86_27&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> </span><a name="loc_86_28_86_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_28_86_29&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">   -&gt; </span><a href="#loc_80_5_80_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_5_80_13&#39;)"><span class="hl_varref"><span class="mpre">leftover</span></span></a><span class="mpre"> </span><a href="#loc_86_26_86_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_26_86_27&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_86_28_86_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_28_86_29&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

    </span><a name="loc_88_5_88_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_5_88_8&#39;)"><span class="hl_fundecl"><span class="mpre">err</span></span></a><span class="mpre"> </span><a name="loc_88_9_88_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_9_88_10&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = let (</span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_88_23_88_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_23_88_24&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">) = </span><a href="Data.Attoparsec.ByteString.html#loc_221_1_221_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Attoparsec.ByteString.html#loc_221_1_221_13&#39;)"><span class="hl_varref"><span class="mpre">eitherResult</span></span></a><span class="mpre"> </span><a href="#loc_88_9_88_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_9_88_10&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> in </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_31_23_31_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_23_31_37&#39;)"><span class="hl_conref"><span class="mpre">ParseException</span></span></a><span class="mpre"> </span><a href="#loc_88_23_88_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_23_88_24&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">

    </span><a name="loc_90_5_90_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_90_8_90_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_8_90_9&#39;)"><span class="hl_specname"><span class="mpre">r</span></span></a><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">Fail</span></span><span class="mpre"> </span><a name="loc_90_16_90_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_16_90_17&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> _ _) = </span><a href="#loc_80_5_80_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_5_80_13&#39;)"><span class="hl_varref"><span class="mpre">leftover</span></span></a><span class="mpre"> </span><a href="#loc_90_16_90_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_16_90_17&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_88_5_88_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_5_88_8&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre"> </span><a href="#loc_90_8_90_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_8_90_9&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
    </span><a href="#loc_90_5_90_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Done</span></span><span class="mpre"> </span><a name="loc_91_14_91_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_14_91_15&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> </span><a name="loc_91_16_91_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_16_91_17&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">)     = </span><a href="#loc_80_5_80_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_5_80_13&#39;)"><span class="hl_varref"><span class="mpre">leftover</span></span></a><span class="mpre"> </span><a href="#loc_91_14_91_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_14_91_15&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_91_16_91_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_16_91_17&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
    </span><a href="#loc_90_5_90_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_92_8_92_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_8_92_9&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">              = </span><a href="System.IO.Streams.Internal.html#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">Streams.read</span></span></a><span class="mpre"> </span><a href="#loc_73_51_73_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_51_73_53&#39;)"><span class="hl_varref"><span class="mpre">is</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre">
                        </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><a href="#loc_82_5_82_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_5_82_11&#39;)"><span class="hl_varref"><span class="mpre">finish</span></span></a><span class="mpre"> </span><a href="#loc_92_8_92_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_8_92_9&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">)
                              (\</span><a name="loc_94_33_94_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_33_94_34&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; if </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_94_33_94_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_33_94_34&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
                                       then </span><a href="#loc_90_5_90_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_92_8_92_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_8_92_9&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
                                       else </span><a href="#loc_90_5_90_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_73_35_73_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_35_73_43&#39;)"><span class="hl_varref"><span class="mpre">feedFunc</span></span></a><span class="mpre"> </span><a href="#loc_92_8_92_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_8_92_9&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><a href="#loc_94_33_94_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_33_94_34&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Given a &#39;Parser&#39; yielding values of type @&#39;Maybe&#39; r@, transforms an</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;InputStream&#39; over byte strings to an &#39;InputStream&#39; yielding values of type</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @r@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If the parser yields @Just x@, then @x@ will be passed along downstream, and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- if the parser yields @Nothing@, that will be interpreted as end-of-stream.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Upon a parse error, &#39;parserToInputStream&#39; will throw a &#39;ParseException&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; import &quot;Control.Applicative&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; import &quot;Data.Attoparsec.ByteString.Char8&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; is &lt;- &#39;System.IO.Streams.fromList&#39; [\&quot;1 2 3 4 5\&quot; :: &#39;ByteString&#39;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; let parser = (&#39;Data.Attoparsec.ByteString.Char8.endOfInput&#39; &gt;&gt; &#39;Control.Applicative.pure&#39; &#39;Nothing&#39;) \&lt;|\&gt; (Just \&lt;$\&gt; (&#39;Data.Attoparsec.ByteString.Char8.skipWhile&#39; &#39;Data.Attoparsec.ByteString.Char8.isSpace&#39; *&gt; &#39;Data.Attoparsec.ByteString.Char8.decimal&#39;))</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; &#39;parserToInputStream&#39; parser is &gt;&gt;= &#39;System.IO.Streams.toList&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [1,2,3,4,5]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; is&#39; \&lt;- &#39;System.IO.Streams.fromList&#39; [\&quot;1 2xx3 4 5\&quot; :: &#39;ByteString&#39;] &gt;&gt;= &#39;parserToInputStream&#39; parser</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; &#39;read&#39; is&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just 1</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; &#39;read&#39; is&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just 2</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; &#39;read&#39; is&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- *** Exception: Parse exception: Failed reading: takeWhile1</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_129_1_129_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_20&#39;)"><span class="mpre">parserToInputStream</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Parser</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">)
                    -&gt; </span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
                    -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">)
</span><a name="loc_129_1_129_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_20&#39;)"><span class="hl_vardecl"><span class="mpre">parserToInputStream</span></span></a><span class="mpre"> = (</span><a href="System.IO.Streams.Internal.html#loc_247_1_247_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_247_1_247_16&#39;)"><span class="hl_varref"><span class="mpre">Streams.makeInputStream</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_61_1_61_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_16&#39;)"><span class="hl_varref"><span class="mpre">parseFromStream</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_129_1_129_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_20&#39;)"><span class="mpre">parserToInputStream</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span></div></body></html>