<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE OverloadedStrings #-}
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   : (c) 2011 Simon Meier</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD3-style (see LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Simon Meier &lt;iridcode@gmail.com&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : tested on GHC only</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Benchmarking IO output speed of writing a string in Utf8 encoding to a file.</span></span><span class="mpre">
module Utf8IO (main)  where

import           Control.Monad
import           Control.Exception (</span><a href="GHC.IO.html#loc_480_1_480_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_480_1_480_9&#39;)"><span class="mpre">evaluate</span></a><span class="mpre">)

import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/Utf8IO.hs&quot;, srcSpanStartLine = 16, srcSpanStartColumn = 18, srcSpanEndLine = 16, srcSpanEndColumn = 41}, srcInfoPoints = []}) &quot;Codec.Binary.UTF8.Light&quot;"><span class="mpre">Codec.Binary.UTF8.Light</span></span><span class="mpre"> as Utf8Light

import           Data.Char (</span><a href="GHC.Char.html#loc_11_1_11_4" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Char.html#loc_11_1_11_4&#39;)"><span class="mpre">chr</span></a><span class="mpre">)
import           Data.Time.Clock
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/Utf8IO.hs&quot;, srcSpanStartLine = 20, srcSpanStartColumn = 18, srcSpanEndLine = 20, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L
import qualified Data.ByteString.Lazy.UTF8 as Utf8String
import qualified Data.Text.Lazy          as TL
import qualified Data.Text.Lazy.Encoding as TL

import           System.IO
import           System.Environment

import           Blaze.ByteString.Builder           
import           Blaze.ByteString.Builder.Internal (</span><a href="Blaze.ByteString.Builder.Internal.html#loc_84_1_84_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_84_1_84_18&#39;)"><span class="mpre">defaultBufferSize</span></a><span class="mpre">)
import qualified Blaze.ByteString.Builder.Char.Utf8 as Blaze


</span><span class="hl_comment"><span class="mpre">-- | Write using the standard text utf8 encoding function built into &#39;base&#39;.</span></span><span class="mpre">
</span><a href="#loc_35_1_35_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_1_35_15&#39;)"><span class="mpre">writeUtf8_base</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_35_1_35_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_1_35_15&#39;)"><span class="hl_fundecl"><span class="mpre">writeUtf8_base</span></span></a><span class="mpre"> </span><a name="loc_35_16_35_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_16_35_18&#39;)"><span class="hl_vardecl"><span class="mpre">cs</span></span></a><span class="mpre"> </span><a name="loc_35_19_35_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_19_35_23&#39;)"><span class="hl_vardecl"><span class="mpre">file</span></span></a><span class="mpre"> = 
    </span><a href="System.IO.html#loc_390_1_390_9" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.html#loc_390_1_390_9&#39;)"><span class="hl_varref"><span class="mpre">withFile</span></span></a><span class="mpre"> </span><a href="#loc_35_19_35_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_19_35_23&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre"> </span><a href="GHC.IO.IOMode.html#loc_28_32_28_41" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.IOMode.html#loc_28_32_28_41&#39;)"><span class="hl_conref"><span class="mpre">WriteMode</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_36_32_36_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_32_36_33&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> -&gt; do
        </span><a href="GHC.IO.Handle.html#loc_253_1_253_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_253_1_253_13&#39;)"><span class="hl_varref"><span class="mpre">hSetEncoding</span></span></a><span class="mpre"> </span><a href="#loc_36_32_36_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_32_36_33&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="GHC.IO.Encoding.html#loc_66_1_66_5" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.html#loc_66_1_66_5&#39;)"><span class="hl_varref"><span class="mpre">utf8</span></span></a><span class="mpre">
        </span><a href="GHC.IO.Handle.Text.html#loc_529_1_529_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Text.html#loc_529_1_529_8&#39;)"><span class="hl_varref"><span class="mpre">hPutStr</span></span></a><span class="mpre"> </span><a href="#loc_36_32_36_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_32_36_33&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_35_16_35_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_16_35_18&#39;)"><span class="hl_varref"><span class="mpre">cs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Write using utf8 encoding as provided by the &#39;blaze-builder&#39; library.</span></span><span class="mpre">
</span><a href="#loc_42_1_42_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_16&#39;)"><span class="mpre">writeUtf8_blaze</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_42_1_42_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_16&#39;)"><span class="hl_fundecl"><span class="mpre">writeUtf8_blaze</span></span></a><span class="mpre"> </span><a name="loc_42_17_42_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_17_42_19&#39;)"><span class="hl_vardecl"><span class="mpre">cs</span></span></a><span class="mpre"> </span><a name="loc_42_20_42_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_20_42_24&#39;)"><span class="hl_vardecl"><span class="mpre">file</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">L.writeFile</span></span><span class="mpre"> </span><a href="#loc_42_20_42_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_20_42_24&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17&#39;)"><span class="hl_varref"><span class="mpre">toLazyByteString</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Char.Utf8.html#loc_97_1_97_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char.Utf8.html#loc_97_1_97_11&#39;)"><span class="hl_varref"><span class="mpre">Blaze.fromString</span></span></a><span class="mpre"> </span><a href="#loc_42_17_42_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_17_42_19&#39;)"><span class="hl_varref"><span class="mpre">cs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Write using utf8 encoding as provided by the &#39;text&#39; library.</span></span><span class="mpre">
</span><a href="#loc_46_1_46_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_1_46_15&#39;)"><span class="mpre">writeUtf8_text</span></a><span class="mpre"> :: </span><a href="Data.Text.Internal.Lazy.html#loc_47_6_47_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Lazy.html#loc_47_6_47_10&#39;)"><span class="hl_tyconref"><span class="mpre">TL.Text</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_46_1_46_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_1_46_15&#39;)"><span class="hl_fundecl"><span class="mpre">writeUtf8_text</span></span></a><span class="mpre"> </span><a name="loc_46_16_46_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_16_46_18&#39;)"><span class="hl_vardecl"><span class="mpre">tx</span></span></a><span class="mpre"> </span><a name="loc_46_19_46_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_23&#39;)"><span class="hl_vardecl"><span class="mpre">file</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">L.writeFile</span></span><span class="mpre"> </span><a href="#loc_46_19_46_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_23&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Text.Lazy.Encoding.html#loc_153_1_153_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Lazy.Encoding.html#loc_153_1_153_11&#39;)"><span class="hl_varref"><span class="mpre">TL.encodeUtf8</span></span></a><span class="mpre"> </span><a href="#loc_46_16_46_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_16_46_18&#39;)"><span class="hl_varref"><span class="mpre">tx</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Write using utf8 encoding as provided by the &#39;utf8-string&#39; library.</span></span><span class="mpre">
</span><a href="#loc_50_1_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_17&#39;)"><span class="mpre">writeUtf8_string</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_50_1_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_17&#39;)"><span class="hl_fundecl"><span class="mpre">writeUtf8_string</span></span></a><span class="mpre"> </span><a name="loc_50_18_50_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_18_50_20&#39;)"><span class="hl_vardecl"><span class="mpre">cs</span></span></a><span class="mpre"> </span><a name="loc_50_21_50_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_21_50_25&#39;)"><span class="hl_vardecl"><span class="mpre">file</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">L.writeFile</span></span><span class="mpre"> </span><a href="#loc_50_21_50_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_21_50_25&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.ByteString.Lazy.UTF8.html#loc_49_1_49_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.UTF8.html#loc_49_1_49_11&#39;)"><span class="hl_varref"><span class="mpre">Utf8String.fromString</span></span></a><span class="mpre"> </span><a href="#loc_50_18_50_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_18_50_20&#39;)"><span class="hl_varref"><span class="mpre">cs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Write using utf8 encoding as provided by the &#39;utf8-light&#39; library. Note</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- that this library only allows encoding the whole string as a strict</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- bytestring. That might make it unusable in some circumstances.</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_57_1_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_16&#39;)"><span class="mpre">writeUtf8_light</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_57_1_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_16&#39;)"><span class="mpre">writeUtf8_light</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_57_1_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_16&#39;)"><span class="hl_fundecl"><span class="mpre">writeUtf8_light</span></span></a><span class="mpre"> </span><a name="loc_57_17_57_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_17_57_19&#39;)"><span class="hl_vardecl"><span class="mpre">cs</span></span></a><span class="mpre"> </span><a name="loc_57_20_57_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_20_57_24&#39;)"><span class="hl_vardecl"><span class="mpre">file</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">Utf8Light.writeUTF8File</span></span><span class="mpre"> </span><a href="#loc_57_20_57_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_20_57_24&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre"> </span><a href="#loc_57_17_57_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_17_57_19&#39;)"><span class="hl_varref"><span class="mpre">cs</span></span></a><span class="mpre">


</span><a href="#loc_61_1_61_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_5&#39;)"><span class="mpre">main</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_61_1_61_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_5&#39;)"><span class="hl_vardecl"><span class="mpre">main</span></span></a><span class="mpre"> = do
    [</span><a name="loc_62_6_62_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_9&#39;)"><span class="hl_vardecl"><span class="mpre">how</span></span></a><span class="mpre">, </span><a name="loc_62_11_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_11_62_14&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">, </span><a name="loc_62_16_62_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_16_62_20&#39;)"><span class="hl_vardecl"><span class="mpre">file</span></span></a><span class="mpre">] &lt;- </span><span class="hl_varref"><span class="mpre">getArgs</span></span><span class="mpre">
    let </span><span class="hl_vardecl"><span class="mpre">blocksize</span></span><span class="mpre"> = </span><span class="hl_num"><span class="mpre">32000</span></span><span class="mpre">
        </span><a name="loc_64_9_64_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_14&#39;)"><span class="hl_vardecl"><span class="mpre">block</span></span></a><span class="mpre">     = </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="GHC.Char.html#loc_11_1_11_4" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Char.html#loc_11_1_11_4&#39;)"><span class="hl_varref"><span class="mpre">chr</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpEnumFromTo (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/Utf8IO.hs&quot;, srcSpanStartLine = 64, srcSpanStartColumn = 29, srcSpanEndLine = 64, srcSpanEndColumn = 43}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/Utf8IO.hs&quot;, srcSpanStartLine = 64, srcSpanStartColumn = 29, srcSpanEndLine = 64, srcSpanEndColumn = 30},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/Utf8"><span class="mpre">[0..blocksize]</span></span><span class="mpre">
        </span><a name="loc_65_9_65_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_9_65_10&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">         = </span><span class="hl_varref"><span class="mpre">read</span></span><span class="mpre"> </span><a href="#loc_62_11_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_11_62_14&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
        </span><a name="loc_66_9_66_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_9_66_11&#39;)"><span class="hl_vardecl"><span class="mpre">cs</span></span></a><span class="mpre">        = </span><span class="hl_varref"><span class="mpre">take</span></span><span class="mpre"> </span><a href="#loc_65_9_65_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_9_65_10&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">cycle</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_64_9_64_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_14&#39;)"><span class="hl_varref"><span class="mpre">block</span></span></a><span class="mpre">
        </span><a name="loc_67_9_67_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_9_67_11&#39;)"><span class="hl_vardecl"><span class="mpre">tx</span></span></a><span class="mpre">        = </span><a href="Data.Text.Lazy.html#loc_348_1_348_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Lazy.html#loc_348_1_348_5&#39;)"><span class="hl_varref"><span class="mpre">TL.pack</span></span></a><span class="mpre"> </span><a href="#loc_66_9_66_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_9_66_11&#39;)"><span class="hl_varref"><span class="mpre">cs</span></span></a><span class="mpre">
    </span><a name="loc_68_5_68_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_5_68_11&#39;)"><span class="hl_vardecl"><span class="mpre">writer</span></span></a><span class="mpre"> &lt;- case </span><a href="#loc_62_6_62_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_9&#39;)"><span class="hl_varref"><span class="mpre">how</span></span></a><span class="mpre"> of
        </span><span class="hl_string"><span class="mpre">&quot;base&quot;</span></span><span class="mpre">        -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_35_1_35_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_1_35_15&#39;)"><span class="hl_varref"><span class="mpre">writeUtf8_base</span></span></a><span class="mpre"> </span><a href="#loc_66_9_66_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_9_66_11&#39;)"><span class="hl_varref"><span class="mpre">cs</span></span></a><span class="mpre">
        </span><span class="hl_string"><span class="mpre">&quot;blaze&quot;</span></span><span class="mpre">       -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_42_1_42_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_16&#39;)"><span class="hl_varref"><span class="mpre">writeUtf8_blaze</span></span></a><span class="mpre"> </span><a href="#loc_66_9_66_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_9_66_11&#39;)"><span class="hl_varref"><span class="mpre">cs</span></span></a><span class="mpre">
        </span><span class="hl_string"><span class="mpre">&quot;utf8-string&quot;</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_50_1_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_17&#39;)"><span class="hl_varref"><span class="mpre">writeUtf8_string</span></span></a><span class="mpre"> </span><a href="#loc_66_9_66_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_9_66_11&#39;)"><span class="hl_varref"><span class="mpre">cs</span></span></a><span class="mpre">

        </span><span class="hl_comment"><span class="mpre">-- utf8-light is missing support for lazy bytestrings =&gt; test 100 times</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- writing a 100 times smaller string to avoid out-of-memory errors.</span></span><span class="mpre">
        </span><span class="hl_string"><span class="mpre">&quot;utf8-light&quot;</span></span><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_75_36_75_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_36_75_37&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> -&gt; </span><a href="Control.Monad.html#loc_106_1_106_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_106_1_106_10&#39;)"><span class="hl_varref"><span class="mpre">sequence_</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">replicate</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">100</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> 
                                        </span><a href="#loc_57_1_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_16&#39;)"><span class="hl_varref"><span class="mpre">writeUtf8_light</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">take</span></span><span class="mpre"> (</span><a href="#loc_65_9_65_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_9_65_10&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`div`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">100</span></span><span class="mpre">) </span><a href="#loc_66_9_66_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_9_66_11&#39;)"><span class="hl_varref"><span class="mpre">cs</span></span></a><span class="mpre">) </span><a href="#loc_75_36_75_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_36_75_37&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">

        </span><span class="hl_string"><span class="mpre">&quot;via-text&quot;</span></span><span class="mpre">    -&gt; do </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_46_1_46_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_1_46_15&#39;)"><span class="hl_varref"><span class="mpre">writeUtf8_text</span></span></a><span class="mpre"> </span><a href="#loc_67_9_67_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_9_67_11&#39;)"><span class="hl_varref"><span class="mpre">tx</span></span></a><span class="mpre">

        </span><span class="hl_comment"><span class="mpre">-- Here, we ensure that the text tx is already packed before timing.</span></span><span class="mpre">
        </span><span class="hl_string"><span class="mpre">&quot;text&quot;</span></span><span class="mpre">        -&gt; do _ &lt;- </span><a href="GHC.IO.html#loc_480_1_480_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_480_1_480_9&#39;)"><span class="hl_varref"><span class="mpre">evaluate</span></span></a><span class="mpre"> (</span><a href="Data.Text.Lazy.html#loc_529_1_529_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Lazy.html#loc_529_1_529_7&#39;)"><span class="hl_varref"><span class="mpre">TL.length</span></span></a><span class="mpre"> </span><a href="#loc_67_9_67_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_9_67_11&#39;)"><span class="hl_varref"><span class="mpre">tx</span></span></a><span class="mpre">) 
                            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_46_1_46_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_1_46_15&#39;)"><span class="hl_varref"><span class="mpre">writeUtf8_text</span></span></a><span class="mpre"> </span><a href="#loc_67_9_67_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_9_67_11&#39;)"><span class="hl_varref"><span class="mpre">tx</span></span></a><span class="mpre">
        _             -&gt; </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;unknown writer &#39;&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_62_6_62_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_9&#39;)"><span class="hl_varref"><span class="mpre">how</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&#39;&quot;</span></span><span class="mpre">
    </span><a name="loc_84_5_84_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_5_84_6&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_101_1_101_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_7&#39;)"><span class="hl_varref"><span class="mpre">timed_</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_68_5_68_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_5_68_11&#39;)"><span class="hl_varref"><span class="mpre">writer</span></span></a><span class="mpre"> </span><a href="#loc_62_16_62_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_16_62_20&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre">
    </span><a href="System.IO.html#loc_267_1_267_9" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.html#loc_267_1_267_9&#39;)"><span class="hl_varref"><span class="mpre">putStrLn</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_62_6_62_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_9&#39;)"><span class="hl_varref"><span class="mpre">how</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_84_5_84_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_5_84_6&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Timing</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Execute an IO action and return its result plus the time it took to execute it.</span></span><span class="mpre">
</span><a href="#loc_93_1_93_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_6&#39;)"><span class="mpre">timed</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><a href="Data.Time.Clock.UTC.html#loc_62_9_62_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Time.Clock.UTC.html#loc_62_9_62_24&#39;)"><span class="hl_tyconref"><span class="mpre">NominalDiffTime</span></span></a><span class="mpre">)
</span><a name="loc_93_1_93_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_6&#39;)"><span class="hl_fundecl"><span class="mpre">timed</span></span></a><span class="mpre"> </span><a name="loc_93_7_93_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_7_93_9&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> = do
  </span><a name="loc_94_3_94_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_3_94_5&#39;)"><span class="hl_vardecl"><span class="mpre">t0</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getCurrentTime</span></span><span class="mpre">
  </span><a name="loc_95_3_95_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_3_95_4&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_93_7_93_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_7_93_9&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre">
  </span><a name="loc_96_3_96_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_3_96_5&#39;)"><span class="hl_vardecl"><span class="mpre">t1</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getCurrentTime</span></span><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_95_3_95_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_3_95_4&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">, </span><a href="Data.Time.Clock.UTCDiff.html#loc_13_1_13_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Time.Clock.UTCDiff.html#loc_13_1_13_12&#39;)"><span class="hl_varref"><span class="mpre">diffUTCTime</span></span></a><span class="mpre"> </span><a href="#loc_96_3_96_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_3_96_5&#39;)"><span class="hl_varref"><span class="mpre">t1</span></span></a><span class="mpre"> </span><a href="#loc_94_3_94_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_3_94_5&#39;)"><span class="hl_varref"><span class="mpre">t0</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Execute an IO action and return the time it took to execute it.</span></span><span class="mpre">
</span><a href="#loc_101_1_101_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_7&#39;)"><span class="mpre">timed_</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="Data.Time.Clock.UTC.html#loc_62_9_62_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Time.Clock.UTC.html#loc_62_9_62_24&#39;)"><span class="hl_tyconref"><span class="mpre">NominalDiffTime</span></span></a><span class="mpre">
</span><a name="loc_101_1_101_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_7&#39;)"><span class="hl_vardecl"><span class="mpre">timed_</span></span></a><span class="mpre"> = (</span><span class="hl_varref"><span class="mpre">snd</span></span><span class="mpre"> </span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="hl_infix"><span class="mpre">`liftM`</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_93_1_93_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_6&#39;)"><span class="hl_varref"><span class="mpre">timed</span></span></a><span class="mpre">

</span></div></body></html>