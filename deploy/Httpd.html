<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE CPP #-}

module Httpd
    ( Request, Response, Server
    , mkResponse
    , reqMethod, reqURI, reqHeaders, reqBody
    , shed
#ifdef WARP_TESTS
    , warp
#endif
    )
    where

import Control.Applicative
import Control.Arrow ( </span><a href="Control.Arrow.html#loc_107_5_107_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Arrow.html#loc_107_5_107_10&#39;)"><span class="mpre">(***)</span></a><span class="mpre"> )
import Control.DeepSeq
import Control.Monad
import Control.Monad.Trans ( </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="mpre">liftIO</span></a><span class="mpre"> )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 19, srcSpanStartColumn = 8, srcSpanEndLine = 19, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B ( empty, concat, length, ByteString )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 20, srcSpanStartColumn = 8, srcSpanEndLine = 20, srcSpanEndColumn = 29}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as BC ( pack, unpack )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 21, srcSpanStartColumn = 8, srcSpanEndLine = 21, srcSpanEndColumn = 34}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy.Char8&quot;"><span class="mpre">Data.ByteString.Lazy.Char8</span></span><span class="mpre"> as BLC ( pack )
#ifdef WARP_TESTS
import qualified Data.CaseInsensitive as CI ( </span><a href="Data.CaseInsensitive.Internal.html#loc_94_1_94_3" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.CaseInsensitive.Internal.html#loc_94_1_94_3&#39;)"><span class="mpre">mk</span></a><span class="mpre">, </span><a href="Data.CaseInsensitive.Internal.html#loc_86_18_86_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.CaseInsensitive.Internal.html#loc_86_18_86_26&#39;)"><span class="mpre">original</span></a><span class="mpre"> )
#endif
import Data.Maybe ( </span><a href="Data.Maybe.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_91_1_91_9&#39;)"><span class="mpre">fromJust</span></a><span class="mpre"> )
import Network.URI ( </span><a href="Network.URI.html#loc_153_6_153_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.URI.html#loc_153_6_153_9&#39;)"><span class="mpre">URI</span></a><span class="mpre">, </span><a href="Network.URI.html#loc_239_1_239_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.URI.html#loc_239_1_239_23&#39;)"><span class="mpre">parseRelativeReference</span></a><span class="mpre"> )

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 28, srcSpanStartColumn = 8, srcSpanEndLine = 28, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre">
    ( getAddrInfo, AddrInfo, defaultHints, addrAddress, addrFamily
      , addrFlags, addrSocketType, AddrInfoFlag(AI_PASSIVE), socket, Family(AF_UNSPEC,AF_INET6)
      , defaultProtocol, SocketType(Stream), listen, setSocketOption
    )
#ifdef WARP_TESTS
#if MIN_VERSION_network(2,4,0)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 35, srcSpanStartColumn = 8, srcSpanEndLine = 35, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre"> ( bind )
#else
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 37, srcSpanStartColumn = 8, srcSpanEndLine = 37, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre"> ( bindSocket, Socket, SockAddr )
#endif
#endif

import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 41, srcSpanStartColumn = 18, srcSpanEndLine = 41, srcSpanEndColumn = 36}, srcInfoPoints = []}) &quot;Network.Shed.Httpd&quot;"><span class="mpre">Network.Shed.Httpd</span></span><span class="mpre"> as Shed
    ( Request, Response(Response), initServer
    , reqMethod, reqURI, reqHeaders, reqBody
    )
#ifdef WARP_TESTS
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 46, srcSpanStartColumn = 18, srcSpanEndLine = 46, srcSpanEndColumn = 35}, srcInfoPoints = []}) &quot;Data.Conduit.Lazy&quot;"><span class="mpre">Data.Conduit.Lazy</span></span><span class="mpre"> as Warp
    ( lazyConsume )
import qualified Network.HTTP.Types as Warp
    ( </span><a href="Network.HTTP.Types.Status.html#loc_114_6_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_114_6_114_12&#39;)"><span class="mpre">Status</span></a><span class="mpre">(..) )
import qualified Network.Wai as Warp
    ( </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="mpre">Request</span></a><span class="mpre">(</span><a href="Network.Wai.Internal.html#loc_22_6_22_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_22_6_22_19&#39;)"><span class="mpre">requestMethod</span></a><span class="mpre">, </span><a href="Network.Wai.Internal.html#loc_36_6_36_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_36_6_36_20&#39;)"><span class="mpre">requestHeaders</span></a><span class="mpre">, </span><a href="Network.Wai.Internal.html#loc_30_6_30_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_30_6_30_17&#39;)"><span class="mpre">rawPathInfo</span></a><span class="mpre">, </span><a href="Network.Wai.Internal.html#loc_55_6_55_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_55_6_55_17&#39;)"><span class="mpre">requestBody</span></a><span class="mpre">)
    , </span><a href="Network.Wai.html#loc_130_1_130_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_130_1_130_12&#39;)"><span class="mpre">responseLBS</span></a><span class="mpre"> )
import qualified Network.Wai.Handler.Warp as Warp
    ( runSettingsSocket, </span><a href="Network.Wai.Handler.Warp.Settings.html#loc_65_1_65_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Settings.html#loc_65_1_65_16&#39;)"><span class="mpre">defaultSettings</span></a><span class="mpre">, </span><a href="Network.Wai.Handler.Warp.html#loc_107_1_107_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.html#loc_107_1_107_8&#39;)"><span class="mpre">setPort</span></a><span class="mpre"> )
#endif

data </span><a name="loc_57_6_57_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_6_57_13&#39;)"><span class="hl_tycondecl"><span class="mpre">Request</span></span></a><span class="mpre"> = </span><span class="hl_condecl"><span class="mpre">Request</span></span><span class="mpre">
    {
     </span><a name="loc_59_6_59_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_6_59_15&#39;)"><span class="hl_fielddecl"><span class="mpre">reqMethod</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">,
     </span><a name="loc_60_6_60_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_6_60_12&#39;)"><span class="hl_fielddecl"><span class="mpre">reqURI</span></span></a><span class="mpre"> :: </span><a href="Network.URI.html#loc_153_6_153_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.URI.html#loc_153_6_153_9&#39;)"><span class="hl_tyconref"><span class="mpre">URI</span></span></a><span class="mpre">,
     </span><a name="loc_61_6_61_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_6_61_16&#39;)"><span class="hl_fielddecl"><span class="mpre">reqHeaders</span></span></a><span class="mpre"> :: [(</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">)],
     </span><a name="loc_62_6_62_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_6_62_13&#39;)"><span class="hl_fielddecl"><span class="mpre">reqBody</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
    }

data </span><a name="loc_65_6_65_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_6_65_14&#39;)"><span class="hl_tycondecl"><span class="mpre">Response</span></span></a><span class="mpre"> = </span><a name="loc_65_17_65_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_17_65_25&#39;)"><span class="hl_condecl"><span class="mpre">Response</span></span></a><span class="mpre">
    {
     </span><span class="hl_fielddecl"><span class="mpre">respStatus</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">,
     </span><span class="hl_fielddecl"><span class="mpre">respHeaders</span></span><span class="mpre"> :: [(</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">)],
     </span><span class="hl_fielddecl"><span class="mpre">respBody</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
    }

</span><a href="#loc_73_1_73_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_11&#39;)"><span class="mpre">mkResponse</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; [(</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">)] -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="#loc_65_6_65_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_6_65_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre">
</span><a name="loc_73_1_73_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_11&#39;)"><span class="hl_vardecl"><span class="mpre">mkResponse</span></span></a><span class="mpre"> = </span><a href="#loc_65_17_65_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_17_65_25&#39;)"><span class="hl_conref"><span class="mpre">Response</span></span></a><span class="mpre">

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 75, srcSpanStartColumn = 1, srcSpanEndLine = 75, srcSpanEndColumn = 55}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 75, srcSpanStartColumn = 1, srcSpanEndLine = 75, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 75, srcSpanStartColu"><span class="mpre">type Server = Int -&gt; (Request -&gt; IO Response) -&gt; IO ()</span></span><span class="mpre">

</span><a href="#loc_78_1_78_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_5&#39;)"><span class="mpre">shed</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Server</span></span><span class="mpre">
</span><a name="loc_78_1_78_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_5&#39;)"><span class="hl_fundecl"><span class="mpre">shed</span></span></a><span class="mpre"> </span><a name="loc_78_6_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_6_78_10&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> </span><a name="loc_78_11_78_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_11_78_18&#39;)"><span class="hl_vardecl"><span class="mpre">handler</span></span></a><span class="mpre"> =
    </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">Shed.initServer</span></span><span class="mpre">
           </span><a href="#loc_78_6_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_6_78_10&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre">
           (</span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="hl_varref"><span class="mpre">liftM</span></span></a><span class="mpre"> </span><a href="#loc_83_6_83_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_6_83_20&#39;)"><span class="hl_varref"><span class="mpre">responseToShed</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_78_11_78_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_11_78_18&#39;)"><span class="hl_varref"><span class="mpre">handler</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_88_6_88_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_6_88_21&#39;)"><span class="hl_varref"><span class="mpre">requestFromShed</span></span></a><span class="mpre">)
  where
     </span><a name="loc_83_6_83_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_6_83_20&#39;)"><span class="hl_fundecl"><span class="mpre">responseToShed</span></span></a><span class="mpre"> (</span><a href="#loc_65_17_65_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_17_65_25&#39;)"><span class="hl_conref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><a name="loc_83_31_83_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_31_83_37&#39;)"><span class="hl_vardecl"><span class="mpre">status</span></span></a><span class="mpre"> </span><a name="loc_83_38_83_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_38_83_42&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre"> </span><a name="loc_83_43_83_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_43_83_47&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre">) =
         </span><span class="hl_conref"><span class="mpre">Shed.Response</span></span><span class="mpre"> </span><a href="#loc_83_31_83_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_31_83_37&#39;)"><span class="hl_varref"><span class="mpre">status</span></span></a><span class="mpre"> </span><a href="#loc_83_38_83_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_38_83_42&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre"> </span><a href="#loc_83_43_83_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_43_83_47&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre">
     </span><span class="hl_vardecl"><span class="mpre">chomp</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">reverse</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_86_6_86_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_6_86_11&#39;)"><span class="hl_varref"><span class="mpre">strip</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\r&#39;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">reverse</span></span><span class="mpre">
     </span><a name="loc_86_6_86_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_6_86_11&#39;)"><span class="hl_fundecl"><span class="mpre">strip</span></span></a><span class="mpre"> </span><a name="loc_86_12_86_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_12_86_13&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> (</span><a name="loc_86_15_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_15_86_17&#39;)"><span class="hl_vardecl"><span class="mpre">c&#39;</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_86_18_86_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_18_86_21&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre">) | </span><a href="#loc_86_12_86_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_12_86_13&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_86_15_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_15_86_17&#39;)"><span class="hl_varref"><span class="mpre">c&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_86_18_86_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_18_86_21&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
     </span><a href="#loc_86_6_86_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_6_86_11&#39;)"><span class="hl_fundecl"><span class="mpre">strip</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">c</span></span><span class="mpre"> </span><a name="loc_87_14_87_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_14_87_17&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> = </span><a href="#loc_87_14_87_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_14_87_17&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
     </span><a name="loc_88_6_88_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_6_88_21&#39;)"><span class="hl_fundecl"><span class="mpre">requestFromShed</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">request</span></span><span class="mpre"> =
         </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 89, srcSpanStartColumn = 10, srcSpanEndLine = 95, srcSpanEndColumn = 11}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 90, srcSpanStartColumn = 10, srcSpanEndLine = 90, srcSpanEndColumn = 11},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 91, srcSpanStart"><span class="mpre">Request
         {
          reqMethod = Shed.reqMethod request,
          reqURI = Shed.reqURI request,
          reqHeaders = map (id *** chomp) $ Shed.reqHeaders request,
          reqBody = Shed.reqBody request
         }</span></span><span class="mpre">

#if !MIN_VERSION_bytestring(0,10,0)
instance </span><a href="Control.DeepSeq.html#loc_110_7_110_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.DeepSeq.html#loc_110_7_110_13&#39;)"><span class="hl_classref"><span class="mpre">NFData</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> where
   </span><a href="Control.DeepSeq.html#loc_120_5_120_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.DeepSeq.html#loc_120_5_120_8&#39;)"><span class="hl_vardecl"><span class="mpre">rnf</span></span></a><span class="mpre"> = </span><a href="Control.DeepSeq.html#loc_120_5_120_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.DeepSeq.html#loc_120_5_120_8&#39;)"><span class="hl_varref"><span class="mpre">rnf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre">
#endif

#ifdef WARP_TESTS
#if !MIN_VERSION_network(2,4,0)
</span><a href="#loc_105_1_105_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_1_105_5&#39;)"><span class="mpre">bind</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">SockAddr</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_105_1_105_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_1_105_5&#39;)"><span class="hl_vardecl"><span class="mpre">bind</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">bindSocket</span></span><span class="mpre">
#endif

</span><a href="#loc_109_1_109_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_1_109_5&#39;)"><span class="mpre">warp</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Server</span></span><span class="mpre">
</span><a name="loc_109_1_109_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_1_109_5&#39;)"><span class="hl_fundecl"><span class="mpre">warp</span></span></a><span class="mpre"> </span><a name="loc_109_6_109_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_6_109_10&#39;)"><span class="hl_vardecl"><span class="mpre">ipv6</span></span></a><span class="mpre"> </span><a name="loc_109_11_109_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_11_109_15&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> </span><a name="loc_109_16_109_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_16_109_23&#39;)"><span class="hl_vardecl"><span class="mpre">handler</span></span></a><span class="mpre"> = do
    </span><a name="loc_110_5_110_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_5_110_14&#39;)"><span class="hl_vardecl"><span class="mpre">addrinfos</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getAddrInfo</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 110, srcSpanStartColumn = 38, srcSpanEndLine = 110, srcSpanEndColumn = 102}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 110, srcSpanStartColumn = 51, srcSpanEndLine = 110, srcSpanEndColumn = 52},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 110, srcSpa"><span class="mpre">defaultHints { addrFamily = AF_UNSPEC, addrSocketType = Stream }</span></span><span class="mpre">)
                             (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> if </span><a href="#loc_109_6_109_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_6_109_10&#39;)"><span class="hl_varref"><span class="mpre">ipv6</span></span></a><span class="mpre"> then </span><span class="hl_string"><span class="mpre">&quot;::1&quot;</span></span><span class="mpre"> else </span><span class="hl_string"><span class="mpre">&quot;127.0.0.1&quot;</span></span><span class="mpre">)
                             (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_109_11_109_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_11_109_15&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre">)
    case </span><a href="#loc_110_5_110_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_5_110_14&#39;)"><span class="hl_varref"><span class="mpre">addrinfos</span></span></a><span class="mpre"> of
        [] -&gt; </span><span class="hl_varref"><span class="mpre">fail</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Couldn&#39;t obtain address information in warp&quot;</span></span><span class="mpre">
        (</span><a name="loc_115_10_115_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_10_115_15&#39;)"><span class="hl_vardecl"><span class="mpre">addri</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_) -&gt; do
            </span><a name="loc_116_13_116_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_13_116_17&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">socket</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">addrFamily</span></span><span class="mpre"> </span><a href="#loc_115_10_115_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_10_115_15&#39;)"><span class="hl_varref"><span class="mpre">addri</span></span></a><span class="mpre">) </span><span class="hl_conref"><span class="mpre">Stream</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">defaultProtocol</span></span><span class="mpre">
            </span><a href="#loc_105_1_105_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_1_105_5&#39;)"><span class="hl_varref"><span class="mpre">bind</span></span></a><span class="mpre"> </span><a href="#loc_116_13_116_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_13_116_17&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">addrAddress</span></span><span class="mpre"> </span><a href="#loc_115_10_115_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_10_115_15&#39;)"><span class="hl_varref"><span class="mpre">addri</span></span></a><span class="mpre">)
            </span><span class="hl_varref"><span class="mpre">listen</span></span><span class="mpre"> </span><a href="#loc_116_13_116_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_13_116_17&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">5</span></span><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">Warp.runSettingsSocket</span></span><span class="mpre"> (</span><a href="Network.Wai.Handler.Warp.html#loc_107_1_107_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.html#loc_107_1_107_8&#39;)"><span class="hl_varref"><span class="mpre">Warp.setPort</span></span></a><span class="mpre"> </span><a href="#loc_109_11_109_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_11_109_15&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Settings.html#loc_65_1_65_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Settings.html#loc_65_1_65_16&#39;)"><span class="hl_varref"><span class="mpre">Warp.defaultSettings</span></span></a><span class="mpre">) </span><a href="#loc_116_13_116_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_13_116_17&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_119_85_119_96" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_85_119_96&#39;)"><span class="hl_vardecl"><span class="mpre">warpRequest</span></span></a><span class="mpre"> -&gt; do
               </span><a name="loc_120_16_120_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_16_120_23&#39;)"><span class="hl_vardecl"><span class="mpre">request</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_132_6_132_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_6_132_21&#39;)"><span class="hl_varref"><span class="mpre">requestFromWarp</span></span></a><span class="mpre"> </span><a href="#loc_119_85_119_96" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_85_119_96&#39;)"><span class="hl_varref"><span class="mpre">warpRequest</span></span></a><span class="mpre">
               </span><a name="loc_121_16_121_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_16_121_24&#39;)"><span class="hl_vardecl"><span class="mpre">response</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_109_16_109_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_16_109_23&#39;)"><span class="hl_varref"><span class="mpre">handler</span></span></a><span class="mpre"> </span><a href="#loc_120_16_120_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_16_120_23&#39;)"><span class="hl_varref"><span class="mpre">request</span></span></a><span class="mpre">
               </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_124_6_124_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_6_124_20&#39;)"><span class="hl_varref"><span class="mpre">responseToWarp</span></span></a><span class="mpre"> </span><a href="#loc_121_16_121_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_16_121_24&#39;)"><span class="hl_varref"><span class="mpre">response</span></span></a><span class="mpre">)
  where
     </span><a name="loc_124_6_124_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_6_124_20&#39;)"><span class="hl_fundecl"><span class="mpre">responseToWarp</span></span></a><span class="mpre"> (</span><a href="#loc_65_17_65_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_17_65_25&#39;)"><span class="hl_conref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><a name="loc_124_31_124_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_31_124_37&#39;)"><span class="hl_vardecl"><span class="mpre">status</span></span></a><span class="mpre"> </span><a name="loc_124_38_124_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_38_124_42&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre"> </span><a name="loc_124_43_124_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_43_124_47&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre">) =
         </span><a href="Network.Wai.html#loc_130_1_130_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_130_1_130_12&#39;)"><span class="hl_varref"><span class="mpre">Warp.responseLBS</span></span></a><span class="mpre">
                 (</span><span class="hl_conref"><span class="mpre">Warp.Status</span></span><span class="mpre"> </span><a href="#loc_124_31_124_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_31_124_37&#39;)"><span class="hl_varref"><span class="mpre">status</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">)
                 (</span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_129_6_129_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_6_129_18&#39;)"><span class="hl_varref"><span class="mpre">headerToWarp</span></span></a><span class="mpre"> </span><a href="#loc_124_38_124_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_38_124_42&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">)
                 (</span><span class="hl_varref"><span class="mpre">BLC.pack</span></span><span class="mpre"> </span><a href="#loc_124_43_124_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_43_124_47&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre">)
     </span><a name="loc_129_6_129_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_6_129_18&#39;)"><span class="hl_fundecl"><span class="mpre">headerToWarp</span></span></a><span class="mpre"> (</span><a name="loc_129_20_129_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_20_129_24&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre">, </span><a name="loc_129_26_129_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_26_129_31&#39;)"><span class="hl_vardecl"><span class="mpre">value</span></span></a><span class="mpre">) = (</span><a href="Data.CaseInsensitive.Internal.html#loc_94_1_94_3" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.CaseInsensitive.Internal.html#loc_94_1_94_3&#39;)"><span class="hl_varref"><span class="mpre">CI.mk</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">BC.pack</span></span><span class="mpre"> </span><a href="#loc_129_20_129_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_20_129_24&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre">), </span><span class="hl_varref"><span class="mpre">BC.pack</span></span><span class="mpre"> </span><a href="#loc_129_26_129_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_26_129_31&#39;)"><span class="hl_varref"><span class="mpre">value</span></span></a><span class="mpre">)
     </span><span class="hl_fundecl"><span class="mpre">headerFromWarp</span></span><span class="mpre"> (</span><a name="loc_130_22_130_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_22_130_26&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre">, </span><a name="loc_130_28_130_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_28_130_33&#39;)"><span class="hl_vardecl"><span class="mpre">value</span></span></a><span class="mpre">) =
         (</span><span class="hl_varref"><span class="mpre">BC.unpack</span></span><span class="mpre"> (</span><a href="Data.CaseInsensitive.Internal.html#loc_86_18_86_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.CaseInsensitive.Internal.html#loc_86_18_86_26&#39;)"><span class="hl_varref"><span class="mpre">CI.original</span></span></a><span class="mpre"> </span><a href="#loc_130_22_130_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_22_130_26&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre">), </span><span class="hl_varref"><span class="mpre">BC.unpack</span></span><span class="mpre"> </span><a href="#loc_130_28_130_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_28_130_33&#39;)"><span class="hl_varref"><span class="mpre">value</span></span></a><span class="mpre">)
     </span><a name="loc_132_6_132_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_6_132_21&#39;)"><span class="hl_fundecl"><span class="mpre">requestFromWarp</span></span></a><span class="mpre"> </span><a name="loc_132_22_132_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_22_132_29&#39;)"><span class="hl_vardecl"><span class="mpre">request</span></span></a><span class="mpre"> = do
         </span><a name="loc_133_10_133_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_10_133_14&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">Warp.lazyConsume</span></span><span class="mpre"> (</span><a href="Network.Wai.Internal.html#loc_55_6_55_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_55_6_55_17&#39;)"><span class="hl_varref"><span class="mpre">Warp.requestBody</span></span></a><span class="mpre"> </span><a href="#loc_132_22_132_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_22_132_29&#39;)"><span class="hl_varref"><span class="mpre">request</span></span></a><span class="mpre">)
         </span><a href="#loc_133_10_133_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_10_133_14&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre"> </span><a href="Control.DeepSeq.html#loc_85_1_85_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.DeepSeq.html#loc_85_1_85_8&#39;)"><span class="hl_infix"><span class="mpre">`deepseq`</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
         </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
                </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 136, srcSpanStartColumn = 17, srcSpanEndLine = 144, srcSpanEndColumn = 18}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 137, srcSpanStartColumn = 17, srcSpanEndLine = 137, srcSpanEndColumn = 18},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/HTTP-4000.2.17/test/Httpd.hs&quot;, srcSpanStartLine = 138, srcSpan"><span class="mpre">Request
                {
                 reqMethod = BC.unpack (Warp.requestMethod request),
                 reqURI = fromJust . parseRelativeReference .
                          BC.unpack . Warp.rawPathInfo $
                          request,
                 reqHeaders = map headerFromWarp (Warp.requestHeaders request),
                 reqBody = BC.unpack (B.concat body)
                }</span></span><span class="mpre">
#endif
</span></div></body></html>