<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Trustworthy #-}
{-# LANGUAGE NoImplicitPrelude #-}

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Foreign.Marshal.Pool</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) Sven Panne 2002-2004</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD-style (see the file libraries/base/LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  sven.panne@aedion.de</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  provisional</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This module contains support for pooled memory management. Under this scheme,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (re-)allocations belong to a given pool, and everything in a pool is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- deallocated when the pool itself is deallocated. This is useful when</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Foreign.Marshal.Alloc.alloca&#39; with its implicit allocation and deallocation</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is not flexible enough, but explicit uses of &#39;Foreign.Marshal.Alloc.malloc&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- and &#39;free&#39; are too awkward.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

module Foreign.Marshal.Pool (
   </span><span class="hl_comment"><span class="mpre">-- * Pool management</span></span><span class="mpre">
   Pool,
   newPool,
   freePool,
   withPool,

   </span><span class="hl_comment"><span class="mpre">-- * (Re-)Allocation within a pool</span></span><span class="mpre">
   pooledMalloc,
   pooledMallocBytes,

   pooledRealloc,
   pooledReallocBytes,

   pooledMallocArray,
   pooledMallocArray0,

   pooledReallocArray,
   pooledReallocArray0,

   </span><span class="hl_comment"><span class="mpre">-- * Combined allocation and marshalling</span></span><span class="mpre">
   pooledNew,
   pooledNewArray,
   pooledNewArray0
) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 49, srcSpanStartColumn = 8, srcSpanEndLine = 49, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">              ( Int, Monad(..), (.), not )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 50, srcSpanStartColumn = 8, srcSpanEndLine = 50, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;GHC.Err&quot;"><span class="mpre">GHC.Err</span></span><span class="mpre">               ( undefined )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 51, srcSpanStartColumn = 8, srcSpanEndLine = 51, srcSpanEndColumn = 21}, srcInfoPoints = []}) &quot;GHC.Exception&quot;"><span class="mpre">GHC.Exception</span></span><span class="mpre">         ( throw )
import GHC.IO                ( IO, </span><a href="GHC.IO.html#loc_428_1_428_5" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_428_1_428_5&#39;)"><span class="mpre">mask</span></a><span class="mpre">, </span><a href="GHC.IO.html#loc_285_1_285_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_285_1_285_9&#39;)"><span class="mpre">catchAny</span></a><span class="mpre"> )
import GHC.IORef             ( </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><a href="GHC.IORef.html#loc_34_19_34_24" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_19_34_24&#39;)"><span class="mpre">IORef</span></a></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="mpre">newIORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="mpre">readIORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="mpre">writeIORef</span></a><span class="mpre"> )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 8, srcSpanEndLine = 54, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.List&quot;"><span class="mpre">GHC.List</span></span><span class="mpre">              ( elem, length )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 55, srcSpanStartColumn = 8, srcSpanEndLine = 55, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;GHC.Num&quot;"><span class="mpre">GHC.Num</span></span><span class="mpre">               ( Num(..) )

import Control.Monad         ( </span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="mpre">liftM</span></a><span class="mpre"> )
import Data.List             ( </span><a href="Data.List.html#loc_360_1_360_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_360_1_360_7&#39;)"><span class="mpre">delete</span></a><span class="mpre"> )
import Foreign.Marshal.Alloc ( </span><a href="Foreign.Marshal.Alloc.html#loc_96_1_96_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_96_1_96_12&#39;)"><span class="mpre">mallocBytes</span></a><span class="mpre">, </span><a href="Foreign.Marshal.Alloc.html#loc_174_1_174_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_174_1_174_13&#39;)"><span class="mpre">reallocBytes</span></a><span class="mpre">, </span><a href="Foreign.Marshal.Alloc.html#loc_184_1_184_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_184_1_184_5&#39;)"><span class="mpre">free</span></a><span class="mpre"> )
import Foreign.Marshal.Array ( </span><a href="Foreign.Marshal.Array.html#loc_150_1_150_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Array.html#loc_150_1_150_10&#39;)"><span class="mpre">pokeArray</span></a><span class="mpre">, </span><a href="Foreign.Marshal.Array.html#loc_158_1_158_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Array.html#loc_158_1_158_11&#39;)"><span class="mpre">pokeArray0</span></a><span class="mpre"> )
import Foreign.Marshal.Error ( </span><a href="Foreign.Marshal.Error.html#loc_53_1_53_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Error.html#loc_53_1_53_8&#39;)"><span class="mpre">throwIf</span></a><span class="mpre"> )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 62, srcSpanStartColumn = 8, srcSpanEndLine = 62, srcSpanEndColumn = 19}, srcInfoPoints = []}) &quot;Foreign.Ptr&quot;"><span class="mpre">Foreign.Ptr</span></span><span class="mpre">           ( Ptr, castPtr )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 63, srcSpanStartColumn = 8, srcSpanEndLine = 63, srcSpanEndColumn = 24}, srcInfoPoints = []}) &quot;Foreign.Storable&quot;"><span class="mpre">Foreign.Storable</span></span><span class="mpre">      ( Storable(sizeOf, poke) )

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- To avoid non-H2010 stuff like existentially quantified data constructors, we</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- simply use pointers to () below. Not very nice, but...</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A memory pool.</span></span><span class="mpre">

newtype </span><a name="loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tycondecl"><span class="mpre">Pool</span></span></a><span class="mpre"> = </span><a name="loc_72_16_72_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_16_72_20&#39;)"><span class="hl_condecl"><span class="mpre">Pool</span></span></a><span class="mpre"> (</span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">])

</span><span class="hl_comment"><span class="mpre">-- | Allocate a fresh memory pool.</span></span><span class="mpre">

</span><a href="#loc_77_1_77_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_1_77_8&#39;)"><span class="mpre">newPool</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre">
</span><a name="loc_77_1_77_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_1_77_8&#39;)"><span class="hl_vardecl"><span class="mpre">newPool</span></span></a><span class="mpre"> = </span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="hl_varref"><span class="mpre">liftM</span></span></a><span class="mpre"> </span><a href="#loc_72_16_72_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_16_72_20&#39;)"><span class="hl_conref"><span class="mpre">Pool</span></span></a><span class="mpre"> (</span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> [])

</span><span class="hl_comment"><span class="mpre">-- | Deallocate a memory pool and everything which has been allocated in the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- pool itself.</span></span><span class="mpre">

</span><a href="#loc_83_1_83_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_9&#39;)"><span class="mpre">freePool</span></a><span class="mpre"> :: </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_83_1_83_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_9&#39;)"><span class="hl_fundecl"><span class="mpre">freePool</span></span></a><span class="mpre"> (</span><a href="#loc_72_16_72_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_16_72_20&#39;)"><span class="hl_conref"><span class="mpre">Pool</span></span></a><span class="mpre"> </span><a name="loc_83_16_83_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_16_83_20&#39;)"><span class="hl_vardecl"><span class="mpre">pool</span></span></a><span class="mpre">) = </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_83_16_83_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_16_83_20&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="#loc_84_10_84_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_10_84_17&#39;)"><span class="hl_varref"><span class="mpre">freeAll</span></span></a><span class="mpre">
   where </span><a name="loc_84_10_84_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_10_84_17&#39;)"><span class="hl_fundecl"><span class="mpre">freeAll</span></span></a><span class="mpre"> []     = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
         </span><a href="#loc_84_10_84_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_10_84_17&#39;)"><span class="hl_fundecl"><span class="mpre">freeAll</span></span></a><span class="mpre"> (</span><a name="loc_85_19_85_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_19_85_20&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_85_21_85_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_21_85_23&#39;)"><span class="hl_vardecl"><span class="mpre">ps</span></span></a><span class="mpre">) = </span><a href="Foreign.Marshal.Alloc.html#loc_184_1_184_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_184_1_184_5&#39;)"><span class="hl_varref"><span class="mpre">free</span></span></a><span class="mpre"> </span><a href="#loc_85_19_85_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_19_85_20&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_84_10_84_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_10_84_17&#39;)"><span class="hl_varref"><span class="mpre">freeAll</span></span></a><span class="mpre"> </span><a href="#loc_85_21_85_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_21_85_23&#39;)"><span class="hl_varref"><span class="mpre">ps</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Execute an action with a fresh memory pool, which gets automatically</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- deallocated (including its contents) after the action has finished.</span></span><span class="mpre">

</span><a href="#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_1_91_9&#39;)"><span class="mpre">withPool</span></a><span class="mpre"> :: (</span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
</span><a name="loc_91_1_91_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_1_91_9&#39;)"><span class="hl_fundecl"><span class="mpre">withPool</span></span></a><span class="mpre"> </span><a name="loc_91_10_91_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_10_91_13&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> =   </span><span class="hl_comment"><span class="mpre">-- ATTENTION: cut-n-paste from Control.Exception below!</span></span><span class="mpre">
   </span><a href="GHC.IO.html#loc_428_1_428_5" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_428_1_428_5&#39;)"><span class="hl_varref"><span class="mpre">mask</span></span></a><span class="mpre"> (\</span><a name="loc_92_11_92_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_11_92_18&#39;)"><span class="hl_vardecl"><span class="mpre">restore</span></span></a><span class="mpre"> -&gt; do
      </span><a name="loc_93_7_93_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_7_93_11&#39;)"><span class="hl_vardecl"><span class="mpre">pool</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_77_1_77_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_1_77_8&#39;)"><span class="hl_varref"><span class="mpre">newPool</span></span></a><span class="mpre">
      </span><a name="loc_94_7_94_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_7_94_10&#39;)"><span class="hl_vardecl"><span class="mpre">val</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.html#loc_285_1_285_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_285_1_285_9&#39;)"><span class="hl_varref"><span class="mpre">catchAny</span></span></a><span class="mpre">
                (</span><a href="#loc_92_11_92_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_11_92_18&#39;)"><span class="hl_varref"><span class="mpre">restore</span></span></a><span class="mpre"> (</span><a href="#loc_91_10_91_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_10_91_13&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre"> </span><a href="#loc_93_7_93_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_7_93_11&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre">))
                (\</span><a name="loc_96_19_96_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_19_96_20&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; do </span><a href="#loc_83_1_83_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_9&#39;)"><span class="hl_varref"><span class="mpre">freePool</span></span></a><span class="mpre"> </span><a href="#loc_93_7_93_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_7_93_11&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre">; </span><span class="hl_varref"><span class="mpre">throw</span></span><span class="mpre"> </span><a href="#loc_96_19_96_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_19_96_20&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">)
      </span><a href="#loc_83_1_83_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_9&#39;)"><span class="hl_varref"><span class="mpre">freePool</span></span></a><span class="mpre"> </span><a href="#loc_93_7_93_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_7_93_11&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_94_7_94_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_7_94_10&#39;)"><span class="hl_varref"><span class="mpre">val</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Allocate space for storable type in the given pool. The size of the area</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- allocated is determined by the &#39;sizeOf&#39; method from the instance of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Storable&#39; for the appropriate type.</span></span><span class="mpre">

</span><a href="#loc_107_1_107_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_1_107_13&#39;)"><span class="mpre">pooledMalloc</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 106, srcSpanStartColumn = 17, srcSpanEndLine = 106, srcSpanEndColumn = 30}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 106, srcSpanStartColumn = 28, srcSpanEndLine = 106, srcSpanEndColumn = 30}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7"><span class="mpre">Storable a =&gt;</span></span><span class="mpre"> </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_107_1_107_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_1_107_13&#39;)"><span class="hl_vardecl"><span class="mpre">pooledMalloc</span></span></a><span class="mpre"> = </span><a href="#loc_110_5_110_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_5_110_7&#39;)"><span class="hl_varref"><span class="mpre">pm</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre">
  where
    </span><a href="#loc_110_5_110_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_5_110_7&#39;)"><span class="mpre">pm</span></a><span class="mpre">           :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 109, srcSpanStartColumn = 21, srcSpanEndLine = 109, srcSpanEndColumn = 35}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 109, srcSpanStartColumn = 33, srcSpanEndLine = 109, srcSpanEndColumn = 35}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7"><span class="mpre">Storable a&#39; =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a&#39;</span></span><span class="mpre"> -&gt; </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a&#39;</span></span><span class="mpre">)
    </span><a name="loc_110_5_110_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_5_110_7&#39;)"><span class="hl_fundecl"><span class="mpre">pm</span></span></a><span class="mpre"> </span><a name="loc_110_8_110_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_8_110_13&#39;)"><span class="hl_vardecl"><span class="mpre">dummy</span></span></a><span class="mpre"> </span><a name="loc_110_14_110_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_14_110_18&#39;)"><span class="hl_vardecl"><span class="mpre">pool</span></span></a><span class="mpre"> = </span><a href="#loc_115_1_115_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_1_115_18&#39;)"><span class="hl_varref"><span class="mpre">pooledMallocBytes</span></span></a><span class="mpre"> </span><a href="#loc_110_14_110_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_14_110_18&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> </span><a href="#loc_110_8_110_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_8_110_13&#39;)"><span class="hl_varref"><span class="mpre">dummy</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Allocate the given number of bytes of storage in the pool.</span></span><span class="mpre">

</span><a href="#loc_115_1_115_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_1_115_18&#39;)"><span class="mpre">pooledMallocBytes</span></a><span class="mpre"> :: </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_115_1_115_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_1_115_18&#39;)"><span class="hl_fundecl"><span class="mpre">pooledMallocBytes</span></span></a><span class="mpre"> (</span><a href="#loc_72_16_72_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_16_72_20&#39;)"><span class="hl_conref"><span class="mpre">Pool</span></span></a><span class="mpre"> </span><a name="loc_115_25_115_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_25_115_29&#39;)"><span class="hl_vardecl"><span class="mpre">pool</span></span></a><span class="mpre">) </span><a name="loc_115_31_115_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_31_115_35&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> = do
   </span><a name="loc_116_4_116_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_4_116_7&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> &lt;- </span><a href="Foreign.Marshal.Alloc.html#loc_96_1_96_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_96_1_96_12&#39;)"><span class="hl_varref"><span class="mpre">mallocBytes</span></span></a><span class="mpre"> </span><a href="#loc_115_31_115_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_31_115_35&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">
   </span><a name="loc_117_4_117_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_4_117_8&#39;)"><span class="hl_vardecl"><span class="mpre">ptrs</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_115_25_115_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_25_115_29&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre">
   </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_115_25_115_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_25_115_29&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre"> (</span><a href="#loc_116_4_116_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_4_116_7&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_117_4_117_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_4_117_8&#39;)"><span class="hl_varref"><span class="mpre">ptrs</span></span></a><span class="mpre">)
   </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_116_4_116_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_4_116_7&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Adjust the storage area for an element in the pool to the given size of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the required type.</span></span><span class="mpre">

</span><a href="#loc_125_1_125_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_1_125_14&#39;)"><span class="mpre">pooledRealloc</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 124, srcSpanStartColumn = 18, srcSpanEndLine = 124, srcSpanEndColumn = 31}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 124, srcSpanStartColumn = 29, srcSpanEndLine = 124, srcSpanEndColumn = 31}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7"><span class="mpre">Storable a =&gt;</span></span><span class="mpre"> </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_125_1_125_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_1_125_14&#39;)"><span class="hl_vardecl"><span class="mpre">pooledRealloc</span></span></a><span class="mpre"> = </span><a href="#loc_128_5_128_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_5_128_7&#39;)"><span class="hl_varref"><span class="mpre">pr</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre">
  where
    </span><a href="#loc_128_5_128_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_5_128_7&#39;)"><span class="mpre">pr</span></a><span class="mpre">               :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 127, srcSpanStartColumn = 25, srcSpanEndLine = 127, srcSpanEndColumn = 39}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 127, srcSpanStartColumn = 37, srcSpanEndLine = 127, srcSpanEndColumn = 39}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7"><span class="mpre">Storable a&#39; =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a&#39;</span></span><span class="mpre"> -&gt; </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a&#39;</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a&#39;</span></span><span class="mpre">)
    </span><a name="loc_128_5_128_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_5_128_7&#39;)"><span class="hl_fundecl"><span class="mpre">pr</span></span></a><span class="mpre"> </span><a name="loc_128_8_128_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_8_128_13&#39;)"><span class="hl_vardecl"><span class="mpre">dummy</span></span></a><span class="mpre"> </span><a name="loc_128_14_128_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_14_128_18&#39;)"><span class="hl_vardecl"><span class="mpre">pool</span></span></a><span class="mpre"> </span><a name="loc_128_19_128_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_19_128_22&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> = </span><a href="#loc_133_1_133_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_19&#39;)"><span class="hl_varref"><span class="mpre">pooledReallocBytes</span></span></a><span class="mpre"> </span><a href="#loc_128_14_128_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_14_128_18&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre"> </span><a href="#loc_128_19_128_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_19_128_22&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> </span><a href="#loc_128_8_128_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_8_128_13&#39;)"><span class="hl_varref"><span class="mpre">dummy</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Adjust the storage area for an element in the pool to the given size.</span></span><span class="mpre">

</span><a href="#loc_133_1_133_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_19&#39;)"><span class="mpre">pooledReallocBytes</span></a><span class="mpre"> :: </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_133_1_133_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_19&#39;)"><span class="hl_fundecl"><span class="mpre">pooledReallocBytes</span></span></a><span class="mpre"> (</span><a href="#loc_72_16_72_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_16_72_20&#39;)"><span class="hl_conref"><span class="mpre">Pool</span></span></a><span class="mpre"> </span><a name="loc_133_26_133_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_26_133_30&#39;)"><span class="hl_vardecl"><span class="mpre">pool</span></span></a><span class="mpre">) </span><a name="loc_133_32_133_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_32_133_35&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_133_36_133_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_36_133_40&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> = do
   let </span><a name="loc_134_8_134_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_8_134_12&#39;)"><span class="hl_vardecl"><span class="mpre">cPtr</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_133_32_133_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_32_133_35&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">
   _ &lt;- </span><a href="Foreign.Marshal.Error.html#loc_53_1_53_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Error.html#loc_53_1_53_8&#39;)"><span class="hl_varref"><span class="mpre">throwIf</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (</span><a href="#loc_134_8_134_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_8_134_12&#39;)"><span class="hl_varref"><span class="mpre">cPtr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`elem`</span></span><span class="mpre">)) (\_ -&gt; </span><span class="hl_string"><span class="mpre">&quot;pointer not in pool&quot;</span></span><span class="mpre">) (</span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_133_26_133_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_26_133_30&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre">)
   </span><a name="loc_136_4_136_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_4_136_10&#39;)"><span class="hl_vardecl"><span class="mpre">newPtr</span></span></a><span class="mpre"> &lt;- </span><a href="Foreign.Marshal.Alloc.html#loc_174_1_174_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_174_1_174_13&#39;)"><span class="hl_varref"><span class="mpre">reallocBytes</span></span></a><span class="mpre"> </span><a href="#loc_134_8_134_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_8_134_12&#39;)"><span class="hl_varref"><span class="mpre">cPtr</span></span></a><span class="mpre"> </span><a href="#loc_133_36_133_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_36_133_40&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">
   </span><a name="loc_137_4_137_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_4_137_8&#39;)"><span class="hl_vardecl"><span class="mpre">ptrs</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_133_26_133_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_26_133_30&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre">
   </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_133_26_133_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_26_133_30&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre"> (</span><a href="#loc_136_4_136_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_4_136_10&#39;)"><span class="hl_varref"><span class="mpre">newPtr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="Data.List.html#loc_360_1_360_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_360_1_360_7&#39;)"><span class="hl_varref"><span class="mpre">delete</span></span></a><span class="mpre"> </span><a href="#loc_134_8_134_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_8_134_12&#39;)"><span class="hl_varref"><span class="mpre">cPtr</span></span></a><span class="mpre"> </span><a href="#loc_137_4_137_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_4_137_8&#39;)"><span class="hl_varref"><span class="mpre">ptrs</span></span></a><span class="mpre">)
   </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_136_4_136_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_4_136_10&#39;)"><span class="hl_varref"><span class="mpre">newPtr</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Allocate storage for the given number of elements of a storable type in the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- pool.</span></span><span class="mpre">

</span><a href="#loc_145_1_145_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_1_145_18&#39;)"><span class="mpre">pooledMallocArray</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 144, srcSpanStartColumn = 22, srcSpanEndLine = 144, srcSpanEndColumn = 35}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 144, srcSpanStartColumn = 33, srcSpanEndLine = 144, srcSpanEndColumn = 35}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7"><span class="mpre">Storable a =&gt;</span></span><span class="mpre"> </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_145_1_145_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_1_145_18&#39;)"><span class="hl_vardecl"><span class="mpre">pooledMallocArray</span></span></a><span class="mpre"> = </span><a href="#loc_148_5_148_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_5_148_8&#39;)"><span class="hl_varref"><span class="mpre">pma</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre">
  where
    </span><a href="#loc_148_5_148_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_5_148_8&#39;)"><span class="mpre">pma</span></a><span class="mpre">                :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 147, srcSpanStartColumn = 27, srcSpanEndLine = 147, srcSpanEndColumn = 41}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 147, srcSpanStartColumn = 39, srcSpanEndLine = 147, srcSpanEndColumn = 41}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7"><span class="mpre">Storable a&#39; =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a&#39;</span></span><span class="mpre"> -&gt; </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a&#39;</span></span><span class="mpre">)
    </span><a name="loc_148_5_148_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_5_148_8&#39;)"><span class="hl_fundecl"><span class="mpre">pma</span></span></a><span class="mpre"> </span><a name="loc_148_9_148_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_9_148_14&#39;)"><span class="hl_vardecl"><span class="mpre">dummy</span></span></a><span class="mpre"> </span><a name="loc_148_15_148_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_15_148_19&#39;)"><span class="hl_vardecl"><span class="mpre">pool</span></span></a><span class="mpre"> </span><a name="loc_148_20_148_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_20_148_24&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> = </span><a href="#loc_115_1_115_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_1_115_18&#39;)"><span class="hl_varref"><span class="mpre">pooledMallocBytes</span></span></a><span class="mpre"> </span><a href="#loc_148_15_148_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_15_148_19&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre"> (</span><a href="#loc_148_20_148_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_20_148_24&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> </span><a href="#loc_148_9_148_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_9_148_14&#39;)"><span class="hl_varref"><span class="mpre">dummy</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Allocate storage for the given number of elements of a storable type in the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- pool, but leave room for an extra element to signal the end of the array.</span></span><span class="mpre">

</span><a href="#loc_154_1_154_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_19&#39;)"><span class="mpre">pooledMallocArray0</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 153, srcSpanStartColumn = 23, srcSpanEndLine = 153, srcSpanEndColumn = 36}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 153, srcSpanStartColumn = 34, srcSpanEndLine = 153, srcSpanEndColumn = 36}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7"><span class="mpre">Storable a =&gt;</span></span><span class="mpre"> </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_154_1_154_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_19&#39;)"><span class="hl_fundecl"><span class="mpre">pooledMallocArray0</span></span></a><span class="mpre"> </span><a name="loc_154_20_154_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_20_154_24&#39;)"><span class="hl_vardecl"><span class="mpre">pool</span></span></a><span class="mpre"> </span><a name="loc_154_25_154_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_25_154_29&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> =
   </span><a href="#loc_145_1_145_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_1_145_18&#39;)"><span class="hl_varref"><span class="mpre">pooledMallocArray</span></span></a><span class="mpre"> </span><a href="#loc_154_20_154_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_20_154_24&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre"> (</span><a href="#loc_154_25_154_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_25_154_29&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Adjust the size of an array in the given pool.</span></span><span class="mpre">

</span><a href="#loc_160_1_160_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_1_160_19&#39;)"><span class="mpre">pooledReallocArray</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 159, srcSpanStartColumn = 23, srcSpanEndLine = 159, srcSpanEndColumn = 36}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 159, srcSpanStartColumn = 34, srcSpanEndLine = 159, srcSpanEndColumn = 36}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7"><span class="mpre">Storable a =&gt;</span></span><span class="mpre"> </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_160_1_160_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_1_160_19&#39;)"><span class="hl_vardecl"><span class="mpre">pooledReallocArray</span></span></a><span class="mpre"> = </span><a href="#loc_163_5_163_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_5_163_8&#39;)"><span class="hl_varref"><span class="mpre">pra</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre">
  where
    </span><a href="#loc_163_5_163_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_5_163_8&#39;)"><span class="mpre">pra</span></a><span class="mpre">                ::  </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 162, srcSpanStartColumn = 28, srcSpanEndLine = 162, srcSpanEndColumn = 42}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 162, srcSpanStartColumn = 40, srcSpanEndLine = 162, srcSpanEndColumn = 42}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7"><span class="mpre">Storable a&#39; =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a&#39;</span></span><span class="mpre"> -&gt; </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a&#39;</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a&#39;</span></span><span class="mpre">)
    </span><a name="loc_163_5_163_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_5_163_8&#39;)"><span class="hl_fundecl"><span class="mpre">pra</span></span></a><span class="mpre"> </span><a name="loc_163_9_163_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_9_163_14&#39;)"><span class="hl_vardecl"><span class="mpre">dummy</span></span></a><span class="mpre"> </span><a name="loc_163_15_163_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_15_163_19&#39;)"><span class="hl_vardecl"><span class="mpre">pool</span></span></a><span class="mpre"> </span><a name="loc_163_20_163_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_20_163_23&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_163_24_163_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_24_163_28&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre">  = </span><a href="#loc_133_1_133_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_19&#39;)"><span class="hl_varref"><span class="mpre">pooledReallocBytes</span></span></a><span class="mpre"> </span><a href="#loc_163_15_163_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_15_163_19&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre"> </span><a href="#loc_163_20_163_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_20_163_23&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> (</span><a href="#loc_163_24_163_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_24_163_28&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> </span><a href="#loc_163_9_163_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_9_163_14&#39;)"><span class="hl_varref"><span class="mpre">dummy</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Adjust the size of an array with an end marker in the given pool.</span></span><span class="mpre">

</span><a href="#loc_168_1_168_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_1_168_20&#39;)"><span class="mpre">pooledReallocArray0</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 167, srcSpanStartColumn = 24, srcSpanEndLine = 167, srcSpanEndColumn = 37}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 167, srcSpanStartColumn = 35, srcSpanEndLine = 167, srcSpanEndColumn = 37}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7"><span class="mpre">Storable a =&gt;</span></span><span class="mpre"> </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_168_1_168_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_1_168_20&#39;)"><span class="hl_fundecl"><span class="mpre">pooledReallocArray0</span></span></a><span class="mpre"> </span><a name="loc_168_21_168_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_21_168_25&#39;)"><span class="hl_vardecl"><span class="mpre">pool</span></span></a><span class="mpre"> </span><a name="loc_168_26_168_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_26_168_29&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_168_30_168_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_30_168_34&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> =
   </span><a href="#loc_160_1_160_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_1_160_19&#39;)"><span class="hl_varref"><span class="mpre">pooledReallocArray</span></span></a><span class="mpre"> </span><a href="#loc_168_21_168_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_21_168_25&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre"> </span><a href="#loc_168_26_168_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_26_168_29&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> (</span><a href="#loc_168_30_168_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_30_168_34&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">--------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Allocate storage for a value in the given pool and marshal the value into</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- this storage.</span></span><span class="mpre">

</span><a href="#loc_177_1_177_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_10&#39;)"><span class="mpre">pooledNew</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 176, srcSpanStartColumn = 14, srcSpanEndLine = 176, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 176, srcSpanStartColumn = 25, srcSpanEndLine = 176, srcSpanEndColumn = 27}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7"><span class="mpre">Storable a =&gt;</span></span><span class="mpre"> </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_177_1_177_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_10&#39;)"><span class="hl_fundecl"><span class="mpre">pooledNew</span></span></a><span class="mpre"> </span><a name="loc_177_11_177_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_11_177_15&#39;)"><span class="hl_vardecl"><span class="mpre">pool</span></span></a><span class="mpre"> </span><a name="loc_177_16_177_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_16_177_19&#39;)"><span class="hl_vardecl"><span class="mpre">val</span></span></a><span class="mpre"> = do
   </span><a name="loc_178_4_178_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_4_178_7&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_107_1_107_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_1_107_13&#39;)"><span class="hl_varref"><span class="mpre">pooledMalloc</span></span></a><span class="mpre"> </span><a href="#loc_177_11_177_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_11_177_15&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre">
   </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_178_4_178_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_4_178_7&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_177_16_177_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_16_177_19&#39;)"><span class="hl_varref"><span class="mpre">val</span></span></a><span class="mpre">
   </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_178_4_178_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_4_178_7&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Allocate consecutive storage for a list of values in the given pool and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- marshal these values into it.</span></span><span class="mpre">

</span><a href="#loc_186_1_186_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_1_186_15&#39;)"><span class="mpre">pooledNewArray</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 185, srcSpanStartColumn = 19, srcSpanEndLine = 185, srcSpanEndColumn = 32}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 185, srcSpanStartColumn = 30, srcSpanEndLine = 185, srcSpanEndColumn = 32}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7"><span class="mpre">Storable a =&gt;</span></span><span class="mpre"> </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_186_1_186_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_1_186_15&#39;)"><span class="hl_fundecl"><span class="mpre">pooledNewArray</span></span></a><span class="mpre"> </span><a name="loc_186_16_186_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_16_186_20&#39;)"><span class="hl_vardecl"><span class="mpre">pool</span></span></a><span class="mpre"> </span><a name="loc_186_21_186_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_21_186_25&#39;)"><span class="hl_vardecl"><span class="mpre">vals</span></span></a><span class="mpre"> = do
   </span><a name="loc_187_4_187_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_4_187_7&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_145_1_145_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_1_145_18&#39;)"><span class="hl_varref"><span class="mpre">pooledMallocArray</span></span></a><span class="mpre"> </span><a href="#loc_186_16_186_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_16_186_20&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">length</span></span><span class="mpre"> </span><a href="#loc_186_21_186_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_21_186_25&#39;)"><span class="hl_varref"><span class="mpre">vals</span></span></a><span class="mpre">)
   </span><a href="Foreign.Marshal.Array.html#loc_150_1_150_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Array.html#loc_150_1_150_10&#39;)"><span class="hl_varref"><span class="mpre">pokeArray</span></span></a><span class="mpre"> </span><a href="#loc_187_4_187_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_4_187_7&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_186_21_186_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_21_186_25&#39;)"><span class="hl_varref"><span class="mpre">vals</span></span></a><span class="mpre">
   </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_187_4_187_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_4_187_7&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Allocate consecutive storage for a list of values in the given pool and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- marshal these values into it, terminating the end with the given marker.</span></span><span class="mpre">

</span><a href="#loc_195_1_195_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_1_195_16&#39;)"><span class="mpre">pooledNewArray0</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 194, srcSpanStartColumn = 20, srcSpanEndLine = 194, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Pool.hs&quot;, srcSpanStartLine = 194, srcSpanStartColumn = 31, srcSpanEndLine = 194, srcSpanEndColumn = 33}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7"><span class="mpre">Storable a =&gt;</span></span><span class="mpre"> </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_tyconref"><span class="mpre">Pool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_195_1_195_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_1_195_16&#39;)"><span class="hl_fundecl"><span class="mpre">pooledNewArray0</span></span></a><span class="mpre"> </span><a name="loc_195_17_195_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_17_195_21&#39;)"><span class="hl_vardecl"><span class="mpre">pool</span></span></a><span class="mpre"> </span><a name="loc_195_22_195_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_22_195_28&#39;)"><span class="hl_vardecl"><span class="mpre">marker</span></span></a><span class="mpre"> </span><a name="loc_195_29_195_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_29_195_33&#39;)"><span class="hl_vardecl"><span class="mpre">vals</span></span></a><span class="mpre"> = do
   </span><a name="loc_196_4_196_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_4_196_7&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_154_1_154_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_19&#39;)"><span class="hl_varref"><span class="mpre">pooledMallocArray0</span></span></a><span class="mpre"> </span><a href="#loc_195_17_195_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_17_195_21&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">length</span></span><span class="mpre"> </span><a href="#loc_195_29_195_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_29_195_33&#39;)"><span class="hl_varref"><span class="mpre">vals</span></span></a><span class="mpre">)
   </span><a href="Foreign.Marshal.Array.html#loc_158_1_158_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Array.html#loc_158_1_158_11&#39;)"><span class="hl_varref"><span class="mpre">pokeArray0</span></span></a><span class="mpre"> </span><a href="#loc_195_22_195_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_22_195_28&#39;)"><span class="hl_varref"><span class="mpre">marker</span></span></a><span class="mpre"> </span><a href="#loc_196_4_196_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_4_196_7&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_195_29_195_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_29_195_33&#39;)"><span class="hl_varref"><span class="mpre">vals</span></span></a><span class="mpre">
   </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_196_4_196_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_4_196_7&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">

</span></div></body></html>