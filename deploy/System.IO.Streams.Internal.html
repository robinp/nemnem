<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- | Internal implementation of the @io-streams@ library, intended for library</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- writers</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Library users should use the interface provided by &quot;System.IO.Streams&quot;</span></span><span class="mpre">

{-# LANGUAGE BangPatterns               #-}
{-# LANGUAGE DeriveDataTypeable         #-}
{-# LANGUAGE FlexibleInstances          #-}
{-# LANGUAGE GeneralizedNewtypeDeriving #-}
{-# LANGUAGE OverloadedStrings          #-}
{-# LANGUAGE TypeSynonymInstances       #-}

module System.IO.Streams.Internal
  ( </span><span class="hl_comment"><span class="mpre">-- * Types</span></span><span class="mpre">
    SP(..)
  , StreamPair

    </span><span class="hl_comment"><span class="mpre">-- * About pushback</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- $pushback</span></span><span class="mpre">

    </span><span class="hl_comment"><span class="mpre">-- * Input and output streams</span></span><span class="mpre">
  , InputStream(..)
  , OutputStream(..)

    </span><span class="hl_comment"><span class="mpre">-- * Primitive stream operations</span></span><span class="mpre">
  , read
  , unRead
  , peek
  , write
  , atEOF

    </span><span class="hl_comment"><span class="mpre">-- * Building streams</span></span><span class="mpre">
  , makeInputStream
  , makeOutputStream
  , appendInputStream
  , concatInputStreams

    </span><span class="hl_comment"><span class="mpre">-- * Connecting streams</span></span><span class="mpre">
  , connect
  , connectTo
  , supply
  , supplyTo

    </span><span class="hl_comment"><span class="mpre">-- * Thread safety</span></span><span class="mpre">
  , lockingInputStream
  , lockingOutputStream

    </span><span class="hl_comment"><span class="mpre">-- * Utility streams</span></span><span class="mpre">
  , nullInput
  , nullOutput

    </span><span class="hl_comment"><span class="mpre">-- * Generator monad</span></span><span class="mpre">
  , Generator
  , fromGenerator
  , yield

    </span><span class="hl_comment"><span class="mpre">-- * Consumer monad</span></span><span class="mpre">
  , Consumer
  , fromConsumer
  , await
  ) where

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
import           Control.Applicative      (</span><a href="Control.Applicative.html#loc_113_20_113_31" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_113_20_113_31&#39;)"><span class="mpre">Applicative</span></a><span class="mpre"> (..))
import           </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 18, srcSpanEndLine = 65, srcSpanEndColumn = 36}, srcInfoPoints = []}) &quot;Control.Concurrent&quot;"><span class="mpre">Control.Concurrent</span></span><span class="mpre">       (newMVar, withMVar)
import           Control.Exception        (</span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="mpre">throwIO</span></a><span class="mpre">)
import           Control.Monad            (</span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">)
import           Control.Monad.IO.Class   (</span><a href="Control.Monad.IO.Class.html#loc_30_20_30_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_30_20_30_27&#39;)"><span class="mpre">MonadIO</span></a><span class="mpre"> (..))
import           </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 69, srcSpanStartColumn = 18, srcSpanEndLine = 69, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre">    (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 70, srcSpanStartColumn = 18, srcSpanEndLine = 70, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre">    as S
import qualified Data.ByteString.Internal as S
import qualified Data.ByteString.Unsafe   as S
import           Data.IORef               (</span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="mpre">newIORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="mpre">readIORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="mpre">writeIORef</span></a><span class="mpre">)
import           Data.Maybe               (</span><a href="Data.Maybe.html#loc_85_1_85_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_85_1_85_10&#39;)"><span class="mpre">isNothing</span></a><span class="mpre">)
import           Data.Typeable            (</span><a href="Data.Typeable.Internal.html#loc_196_7_196_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Typeable.Internal.html#loc_196_7_196_15&#39;)"><span class="mpre">Typeable</span></a><span class="mpre">)
import           Data.Word                (Word8)
import           Foreign.Marshal.Utils    (</span><a href="Foreign.Marshal.Utils.html#loc_154_1_154_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Utils.html#loc_154_1_154_10&#39;)"><span class="mpre">copyBytes</span></a><span class="mpre">)
import           Foreign.Ptr              (castPtr)
import qualified GHC.IO.Buffer            as H
import qualified GHC.IO.BufferedIO        as H
import qualified GHC.IO.Device            as H
import           GHC.IO.Exception         (</span><a href="GHC.IO.Exception.html#loc_345_1_345_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_345_1_345_21&#39;)"><span class="mpre">unsupportedOperation</span></a><span class="mpre">)
import           Prelude                  hiding (</span><a href="Text.Read.html#loc_91_1_91_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Read.html#loc_91_1_91_5&#39;)"><span class="mpre">read</span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | A strict pair type.</span></span><span class="mpre">
data </span><a name="loc_88_6_88_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_6_88_8&#39;)"><span class="hl_tycondecl"><span class="mpre">SP</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> = </span><a name="loc_88_15_88_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_15_88_17&#39;)"><span class="hl_condecl"><span class="mpre">SP</span></span></a><span class="mpre"> !</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> !</span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
  </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 89, srcSpanStartColumn = 3, srcSpanEndLine = 89, srcSpanEndColumn = 22}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 89, srcSpanStartColumn = 3, srcSpanEndLine = 89, srcSpanEndColumn = 11},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/sr"><span class="mpre">deriving (Typeable)</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | An &#39;InputStream&#39; generates values of type @c@ in the &#39;IO&#39; monad.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  Two primitive operations are defined on &#39;InputStream&#39;:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * @&#39;read&#39; :: &#39;InputStream&#39; c -&gt; &#39;IO&#39; (&#39;Maybe&#39; c)@ reads a value from the stream,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- where \&quot;end of stream\&quot; is signaled by &#39;read&#39; returning &#39;Nothing&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * @&#39;unRead&#39; :: c -&gt; &#39;InputStream&#39; c -&gt; &#39;IO&#39; ()@ \&quot;pushes back\&quot; a value to the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- stream.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- It is intended that &#39;InputStream&#39;s obey the following law:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @&#39;unRead&#39; c stream &gt;&gt; &#39;read&#39; stream === &#39;return&#39; (&#39;Just&#39; c)@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
data </span><a name="loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tycondecl"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_107_22_107_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_22_107_33&#39;)"><span class="hl_condecl"><span class="mpre">InputStream</span></span></a><span class="mpre"> {
      </span><a name="loc_108_7_108_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_7_108_12&#39;)"><span class="hl_fielddecl"><span class="mpre">_read</span></span></a><span class="mpre">   :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
    , </span><a name="loc_109_7_109_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_7_109_14&#39;)"><span class="hl_fielddecl"><span class="mpre">_unRead</span></span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
    } </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 110, srcSpanStartColumn = 7, srcSpanEndLine = 110, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 110, srcSpanStartColumn = 7, srcSpanEndLine = 110, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4."><span class="mpre">deriving (Typeable)</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | An &#39;OutputStream&#39; consumes values of type @c@ in the &#39;IO&#39; monad.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The only primitive operation defined on &#39;OutputStream&#39; is:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * @&#39;write&#39; :: &#39;Maybe&#39; c -&gt; &#39;OutputStream&#39; c -&gt; &#39;IO&#39; ()@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Values of type @c@ are written in an &#39;OutputStream&#39; by wrapping them in</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Just&#39;, and the end of the stream is indicated by supplying &#39;Nothing&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If you supply a value after a &#39;Nothing&#39;, the behavior is defined by the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- implementer of the given &#39;OutputStream&#39;. (All &#39;OutputStream&#39; definitions in</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- this library will simply discard the extra input.)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
data </span><a name="loc_126_6_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_6_126_18&#39;)"><span class="hl_tycondecl"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_126_23_126_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_23_126_35&#39;)"><span class="hl_condecl"><span class="mpre">OutputStream</span></span></a><span class="mpre"> {
      </span><a name="loc_127_7_127_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_7_127_13&#39;)"><span class="hl_fielddecl"><span class="mpre">_write</span></span></a><span class="mpre"> :: </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
    } </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 128, srcSpanStartColumn = 7, srcSpanEndLine = 128, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 128, srcSpanStartColumn = 7, srcSpanEndLine = 128, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4."><span class="mpre">deriving (Typeable)</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Reads one value from an &#39;InputStream&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Returns either a value wrapped in a &#39;Just&#39;, or &#39;Nothing&#39; if the end of the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- stream is reached.</span></span><span class="mpre">
</span><a href="#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_5&#39;)"><span class="mpre">read</span></a><span class="mpre"> :: </span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_137_1_137_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_5&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre"> = </span><a href="#loc_108_7_108_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_7_108_12&#39;)"><span class="hl_varref"><span class="mpre">_read</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_5&#39;)"><span class="mpre">read</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Feeds a value to an &#39;OutputStream&#39;. Values of type @c@ are written in an</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;OutputStream&#39; by wrapping them in &#39;Just&#39;, and the end of the stream is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- indicated by supplying &#39;Nothing&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_6&#39;)"><span class="mpre">write</span></a><span class="mpre"> :: </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_147_1_147_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_6&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">flip</span></span><span class="mpre"> </span><a href="#loc_127_7_127_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_7_127_13&#39;)"><span class="hl_varref"><span class="mpre">_write</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_6&#39;)"><span class="mpre">write</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Observes the first value from an &#39;InputStream&#39; without consuming it.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Returns &#39;Nothing&#39; if the &#39;InputStream&#39; is empty. &#39;peek&#39; satisfies the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- following law:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Streams.&#39;peek&#39; stream &gt;&gt; Streams.&#39;read&#39; stream === Streams.&#39;read&#39; stream</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_161_1_161_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_1_161_5&#39;)"><span class="mpre">peek</span></a><span class="mpre"> :: </span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_161_1_161_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_1_161_5&#39;)"><span class="hl_fundecl"><span class="mpre">peek</span></span></a><span class="mpre"> </span><a name="loc_161_6_161_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_6_161_7&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = do
    </span><a name="loc_162_5_162_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_5_162_6&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_161_6_161_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_6_161_7&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
    </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">) (</span><a href="#loc_109_7_109_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_7_109_14&#39;)"><span class="hl_varref"><span class="mpre">_unRead</span></span></a><span class="mpre"> </span><a href="#loc_161_6_161_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_6_161_7&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) </span><a href="#loc_162_5_162_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_5_162_6&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_162_5_162_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_5_162_6&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Pushes a value back onto an input stream. &#39;read&#39; and &#39;unRead&#39; should</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- satisfy the following law, with the possible exception of side effects:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Streams.&#39;unRead&#39; c stream &gt;&gt; Streams.&#39;read&#39; stream === &#39;return&#39; (&#39;Just&#39; c)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that this could be used to add values back to the stream that were not</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- originally drawn from the stream.</span></span><span class="mpre">
</span><a href="#loc_178_1_178_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_1_178_7&#39;)"><span class="mpre">unRead</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_178_1_178_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_1_178_7&#39;)"><span class="hl_vardecl"><span class="mpre">unRead</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">flip</span></span><span class="mpre"> </span><a href="#loc_109_7_109_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_7_109_14&#39;)"><span class="hl_varref"><span class="mpre">_unRead</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Connects an &#39;InputStream&#39; and &#39;OutputStream&#39;, supplying values from the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;InputStream&#39; to the &#39;OutputStream&#39;, and propagating the end-of-stream</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- message from the &#39;InputStream&#39; through to the &#39;OutputStream&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The connection ends when the &#39;InputStream&#39; yields a &#39;Nothing&#39;.</span></span><span class="mpre">
</span><a href="#loc_188_1_188_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_1_188_8&#39;)"><span class="mpre">connect</span></a><span class="mpre"> :: </span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_188_1_188_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_1_188_8&#39;)"><span class="hl_fundecl"><span class="mpre">connect</span></span></a><span class="mpre"> </span><a name="loc_188_9_188_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_9_188_10&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_188_11_188_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_11_188_12&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre"> = </span><a href="#loc_190_5_190_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_5_190_9&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre">
  where
    </span><a name="loc_190_5_190_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_5_190_9&#39;)"><span class="hl_vardecl"><span class="mpre">loop</span></span></a><span class="mpre"> = do
        </span><a name="loc_191_9_191_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_9_191_10&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_188_9_188_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_9_188_10&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">
        </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><a href="#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="#loc_188_11_188_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_11_188_12&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">)
              (</span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_191_9_191_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_9_191_10&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_188_11_188_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_11_188_12&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_190_5_190_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_5_190_9&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre">)
              </span><a href="#loc_191_9_191_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_9_191_10&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_188_1_188_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_1_188_8&#39;)"><span class="mpre">connect</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | The &#39;connectTo&#39; function is just @&#39;flip&#39; &#39;connect&#39;@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Useful for writing expressions like @fromList [1,2,3] &gt;&gt;= connectTo foo@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_204_1_204_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_1_204_10&#39;)"><span class="mpre">connectTo</span></a><span class="mpre"> :: </span><a href="#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_204_1_204_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_1_204_10&#39;)"><span class="hl_vardecl"><span class="mpre">connectTo</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">flip</span></span><span class="mpre"> </span><a href="#loc_188_1_188_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_1_188_8&#39;)"><span class="hl_varref"><span class="mpre">connect</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_204_1_204_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_1_204_10&#39;)"><span class="mpre">connectTo</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Connects an &#39;InputStream&#39; to an &#39;OutputStream&#39; without passing the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- end-of-stream notification through to the &#39;OutputStream&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Use this to supply an &#39;OutputStream&#39; with multiple &#39;InputStream&#39;s and use</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;connect&#39; for the final &#39;InputStream&#39; to finalize the &#39;OutputStream&#39;, like</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- so:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- do Streams.&#39;supply&#39;  input1 output</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    Streams.&#39;supply&#39;  input2 output</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    Streams.&#39;connect&#39; input3 output</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_223_1_223_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_1_223_7&#39;)"><span class="mpre">supply</span></a><span class="mpre"> :: </span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_223_1_223_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_1_223_7&#39;)"><span class="hl_fundecl"><span class="mpre">supply</span></span></a><span class="mpre"> </span><a name="loc_223_8_223_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_8_223_9&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_223_10_223_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_10_223_11&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre"> = </span><a href="#loc_225_5_225_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_5_225_9&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre">
  where
    </span><a name="loc_225_5_225_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_5_225_9&#39;)"><span class="hl_vardecl"><span class="mpre">loop</span></span></a><span class="mpre"> = do
        </span><a name="loc_226_9_226_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_9_226_10&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_223_8_223_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_8_223_9&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">
        </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)
              (</span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_226_9_226_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_9_226_10&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_223_10_223_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_10_223_11&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_225_5_225_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_5_225_9&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre">)
              </span><a href="#loc_226_9_226_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_9_226_10&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_223_1_223_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_1_223_7&#39;)"><span class="mpre">supply</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | &#39;supply&#39; with the arguments flipped.</span></span><span class="mpre">
</span><a href="#loc_236_1_236_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_236_1_236_9&#39;)"><span class="mpre">supplyTo</span></a><span class="mpre"> :: </span><a href="#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_236_1_236_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_236_1_236_9&#39;)"><span class="hl_vardecl"><span class="mpre">supplyTo</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">flip</span></span><span class="mpre"> </span><a href="#loc_223_1_223_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_1_223_7&#39;)"><span class="hl_varref"><span class="mpre">supply</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_236_1_236_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_236_1_236_9&#39;)"><span class="mpre">supplyTo</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Creates an &#39;InputStream&#39; from a value-producing action.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (@makeInputStream m@) calls the action @m@ each time you request a value</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- from the &#39;InputStream&#39;. The given action is extended with the default</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- pushback mechanism (see &quot;System.IO.Streams.Internal#pushback&quot;).</span></span><span class="mpre">
</span><a href="#loc_247_1_247_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_1_247_16&#39;)"><span class="mpre">makeInputStream</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_247_1_247_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_1_247_16&#39;)"><span class="hl_fundecl"><span class="mpre">makeInputStream</span></span></a><span class="mpre"> </span><a name="loc_247_17_247_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_17_247_18&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = do
    </span><a name="loc_248_5_248_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_5_248_12&#39;)"><span class="hl_vardecl"><span class="mpre">doneRef</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
    </span><a name="loc_249_5_249_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_5_249_10&#39;)"><span class="hl_vardecl"><span class="mpre">pbRef</span></span></a><span class="mpre">   &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> []
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_107_22_107_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_22_107_33&#39;)"><span class="hl_conref"><span class="mpre">InputStream</span></span></a><span class="mpre"> (</span><a href="#loc_252_5_252_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_5_252_9&#39;)"><span class="hl_varref"><span class="mpre">grab</span></span></a><span class="mpre"> </span><a href="#loc_248_5_248_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_5_248_12&#39;)"><span class="hl_varref"><span class="mpre">doneRef</span></span></a><span class="mpre"> </span><a href="#loc_249_5_249_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_5_249_10&#39;)"><span class="hl_varref"><span class="mpre">pbRef</span></span></a><span class="mpre">) (</span><a href="#loc_264_5_264_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_5_264_7&#39;)"><span class="hl_varref"><span class="mpre">pb</span></span></a><span class="mpre"> </span><a href="#loc_249_5_249_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_5_249_10&#39;)"><span class="hl_varref"><span class="mpre">pbRef</span></span></a><span class="mpre">)
  where
    </span><a name="loc_252_5_252_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_5_252_9&#39;)"><span class="hl_fundecl"><span class="mpre">grab</span></span></a><span class="mpre"> </span><a name="loc_252_10_252_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_10_252_17&#39;)"><span class="hl_vardecl"><span class="mpre">doneRef</span></span></a><span class="mpre"> </span><a name="loc_252_18_252_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_18_252_23&#39;)"><span class="hl_vardecl"><span class="mpre">pbRef</span></span></a><span class="mpre"> = do
        </span><a name="loc_253_9_253_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_9_253_10&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_252_18_252_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_18_252_23&#39;)"><span class="hl_varref"><span class="mpre">pbRef</span></span></a><span class="mpre">
        case </span><a href="#loc_253_9_253_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_9_253_10&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> of
          []     -&gt; do </span><a name="loc_255_24_255_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_255_24_255_28&#39;)"><span class="hl_vardecl"><span class="mpre">done</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_252_10_252_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_10_252_17&#39;)"><span class="hl_varref"><span class="mpre">doneRef</span></span></a><span class="mpre">
                       if </span><a href="#loc_255_24_255_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_255_24_255_28&#39;)"><span class="hl_varref"><span class="mpre">done</span></span></a><span class="mpre">
                         then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
                         else do
                             </span><a name="loc_259_30_259_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_30_259_31&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_247_17_247_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_17_247_18&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
                             </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_85_1_85_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_85_1_85_10&#39;)"><span class="hl_varref"><span class="mpre">isNothing</span></span></a><span class="mpre"> </span><a href="#loc_259_30_259_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_30_259_31&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_252_10_252_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_10_252_17&#39;)"><span class="hl_varref"><span class="mpre">doneRef</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
                             </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_259_30_259_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_30_259_31&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
          (</span><a name="loc_262_12_262_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_262_12_262_13&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_262_14_262_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_262_14_262_16&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre">) -&gt; </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_252_18_252_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_18_252_23&#39;)"><span class="hl_varref"><span class="mpre">pbRef</span></span></a><span class="mpre"> </span><a href="#loc_262_14_262_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_262_14_262_16&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_262_12_262_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_262_12_262_13&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)

    </span><a name="loc_264_5_264_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_5_264_7&#39;)"><span class="hl_fundecl"><span class="mpre">pb</span></span></a><span class="mpre"> </span><a name="loc_264_8_264_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_8_264_11&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> </span><a name="loc_264_12_264_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_12_264_13&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_264_8_264_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_8_264_11&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> \</span><a name="loc_264_35_264_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_35_264_37&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_264_8_264_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_8_264_11&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> (</span><a href="#loc_264_12_264_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_12_264_13&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_264_35_264_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_35_264_37&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_247_1_247_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_1_247_16&#39;)"><span class="mpre">makeInputStream</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Creates an &#39;OutputStream&#39; from a value-consuming action.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (@makeOutputStream f@) runs the computation @f@ on each value fed to it.</span></span><span class="mpre">
</span><a href="#loc_273_1_273_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_1_273_17&#39;)"><span class="mpre">makeOutputStream</span></a><span class="mpre"> :: (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_273_1_273_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_1_273_17&#39;)"><span class="hl_vardecl"><span class="mpre">makeOutputStream</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_126_23_126_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_23_126_35&#39;)"><span class="hl_conref"><span class="mpre">OutputStream</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Converts an &#39;InputStream&#39; into a thread-safe &#39;InputStream&#39;, at a slight</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- performance penalty.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- For performance reasons, this library provides non-thread-safe streams by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- default. Use the @locking@ functions to convert these streams into slightly</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- slower, but thread-safe, equivalents.</span></span><span class="mpre">
</span><a href="#loc_284_1_284_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_284_1_284_19&#39;)"><span class="mpre">lockingInputStream</span></a><span class="mpre"> :: </span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_284_1_284_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_284_1_284_19&#39;)"><span class="hl_fundecl"><span class="mpre">lockingInputStream</span></span></a><span class="mpre"> </span><a name="loc_284_20_284_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_284_20_284_21&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = do
    </span><a name="loc_285_5_285_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_285_5_285_7&#39;)"><span class="hl_vardecl"><span class="mpre">mv</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newMVar</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_107_22_107_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_22_107_33&#39;)"><span class="hl_conref"><span class="mpre">InputStream</span></span></a><span class="mpre"> (</span><a href="#loc_289_5_289_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_289_5_289_9&#39;)"><span class="hl_varref"><span class="mpre">grab</span></span></a><span class="mpre"> </span><a href="#loc_285_5_285_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_285_5_285_7&#39;)"><span class="hl_varref"><span class="mpre">mv</span></span></a><span class="mpre">) (</span><a href="#loc_290_5_290_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_290_5_290_7&#39;)"><span class="hl_varref"><span class="mpre">pb</span></span></a><span class="mpre"> </span><a href="#loc_285_5_285_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_285_5_285_7&#39;)"><span class="hl_varref"><span class="mpre">mv</span></span></a><span class="mpre">)

  where
    </span><a name="loc_289_5_289_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_289_5_289_9&#39;)"><span class="hl_fundecl"><span class="mpre">grab</span></span></a><span class="mpre"> </span><a name="loc_289_10_289_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_289_10_289_12&#39;)"><span class="hl_vardecl"><span class="mpre">mv</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">withMVar</span></span><span class="mpre"> </span><a href="#loc_289_10_289_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_289_10_289_12&#39;)"><span class="hl_varref"><span class="mpre">mv</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_284_20_284_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_284_20_284_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
    </span><a name="loc_290_5_290_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_290_5_290_7&#39;)"><span class="hl_fundecl"><span class="mpre">pb</span></span></a><span class="mpre"> </span><a name="loc_290_8_290_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_290_8_290_10&#39;)"><span class="hl_vardecl"><span class="mpre">mv</span></span></a><span class="mpre"> </span><a name="loc_290_11_290_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_290_11_290_12&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">withMVar</span></span><span class="mpre"> </span><a href="#loc_290_8_290_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_290_8_290_10&#39;)"><span class="hl_varref"><span class="mpre">mv</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_178_1_178_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_1_178_7&#39;)"><span class="hl_varref"><span class="mpre">unRead</span></span></a><span class="mpre"> </span><a href="#loc_290_11_290_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_290_11_290_12&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="#loc_284_20_284_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_284_20_284_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_284_1_284_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_284_1_284_19&#39;)"><span class="mpre">lockingInputStream</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Converts an &#39;OutputStream&#39; into a thread-safe &#39;OutputStream&#39;, at a slight</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- performance penalty.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- For performance reasons, this library provides non-thread-safe streams by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- default. Use the @locking@ functions to convert these streams into slightly</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- slower, but thread-safe, equivalents.</span></span><span class="mpre">
</span><a href="#loc_302_1_302_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_1_302_20&#39;)"><span class="mpre">lockingOutputStream</span></a><span class="mpre"> :: </span><a href="#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_302_1_302_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_1_302_20&#39;)"><span class="hl_fundecl"><span class="mpre">lockingOutputStream</span></span></a><span class="mpre"> </span><a name="loc_302_21_302_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_21_302_22&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = do
    </span><a name="loc_303_5_303_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_303_5_303_7&#39;)"><span class="hl_vardecl"><span class="mpre">mv</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newMVar</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    </span><a href="#loc_273_1_273_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_1_273_17&#39;)"><span class="hl_varref"><span class="mpre">makeOutputStream</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_307_5_307_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_5_307_6&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_303_5_303_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_303_5_303_7&#39;)"><span class="hl_varref"><span class="mpre">mv</span></span></a><span class="mpre">

  where
    </span><a name="loc_307_5_307_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_5_307_6&#39;)"><span class="hl_fundecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_307_7_307_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_7_307_9&#39;)"><span class="hl_vardecl"><span class="mpre">mv</span></span></a><span class="mpre"> </span><a name="loc_307_10_307_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_10_307_11&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">withMVar</span></span><span class="mpre"> </span><a href="#loc_307_7_307_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_7_307_9&#39;)"><span class="hl_varref"><span class="mpre">mv</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_307_10_307_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_10_307_11&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="#loc_302_21_302_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_21_302_22&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_302_1_302_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_1_302_20&#39;)"><span class="mpre">lockingOutputStream</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | An empty &#39;InputStream&#39; that yields &#39;Nothing&#39; immediately.</span></span><span class="mpre">
</span><a href="#loc_314_1_314_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_314_1_314_10&#39;)"><span class="mpre">nullInput</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_314_1_314_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_314_1_314_10&#39;)"><span class="hl_vardecl"><span class="mpre">nullInput</span></span></a><span class="mpre"> = </span><a href="#loc_247_1_247_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_1_247_16&#39;)"><span class="hl_varref"><span class="mpre">makeInputStream</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | An empty &#39;OutputStream&#39; that discards any input fed to it.</span></span><span class="mpre">
</span><a href="#loc_320_1_320_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_320_1_320_11&#39;)"><span class="mpre">nullOutput</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_320_1_320_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_320_1_320_11&#39;)"><span class="hl_vardecl"><span class="mpre">nullOutput</span></span></a><span class="mpre"> = </span><a href="#loc_273_1_273_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_1_273_17&#39;)"><span class="hl_varref"><span class="mpre">makeOutputStream</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | &#39;appendInputStream&#39; concatenates two &#39;InputStream&#39;s, analogous to (&#39;++&#39;)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- for lists.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The second &#39;InputStream&#39; continues where the first &#39;InputStream&#39; ends.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note: values pushed back to &#39;appendInputStream&#39; are not propagated to either</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- wrapped &#39;InputStream&#39;.</span></span><span class="mpre">
</span><a href="#loc_332_1_332_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_1_332_18&#39;)"><span class="mpre">appendInputStream</span></a><span class="mpre"> :: </span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_332_1_332_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_1_332_18&#39;)"><span class="hl_fundecl"><span class="mpre">appendInputStream</span></span></a><span class="mpre"> </span><a name="loc_332_19_332_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_19_332_21&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre"> </span><a name="loc_332_22_332_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_22_332_24&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre"> = </span><a href="#loc_346_1_346_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_346_1_346_19&#39;)"><span class="hl_varref"><span class="mpre">concatInputStreams</span></span></a><span class="mpre"> [</span><a href="#loc_332_19_332_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_19_332_21&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre">, </span><a href="#loc_332_22_332_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_22_332_24&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre">]


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | &#39;concatInputStreams&#39; concatenates a list of &#39;InputStream&#39;s, analogous to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (&#39;++&#39;) for lists.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Subsequent &#39;InputStream&#39;s continue where the previous one &#39;InputStream&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ends.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note: values pushed back to the &#39;InputStream&#39; returned by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;concatInputStreams&#39; are not propagated to any of the source</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;InputStream&#39;s.</span></span><span class="mpre">
</span><a href="#loc_346_1_346_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_346_1_346_19&#39;)"><span class="mpre">concatInputStreams</span></a><span class="mpre"> :: [</span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_346_1_346_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_346_1_346_19&#39;)"><span class="hl_fundecl"><span class="mpre">concatInputStreams</span></span></a><span class="mpre"> </span><a name="loc_346_20_346_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_346_20_346_32&#39;)"><span class="hl_vardecl"><span class="mpre">inputStreams</span></span></a><span class="mpre"> = do
    </span><a name="loc_347_5_347_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_347_5_347_8&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_346_20_346_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_346_20_346_32&#39;)"><span class="hl_varref"><span class="mpre">inputStreams</span></span></a><span class="mpre">
    </span><a href="#loc_247_1_247_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_1_247_16&#39;)"><span class="hl_varref"><span class="mpre">makeInputStream</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_351_5_351_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_5_351_8&#39;)"><span class="hl_varref"><span class="mpre">run</span></span></a><span class="mpre"> </span><a href="#loc_347_5_347_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_347_5_347_8&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">

  where
    </span><a name="loc_351_5_351_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_5_351_8&#39;)"><span class="hl_fundecl"><span class="mpre">run</span></span></a><span class="mpre"> </span><a name="loc_351_9_351_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_9_351_12&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> = </span><a href="#loc_353_9_353_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_9_353_11&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">
      where
        </span><a name="loc_353_9_353_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_9_353_11&#39;)"><span class="hl_vardecl"><span class="mpre">go</span></span></a><span class="mpre"> = do
            </span><a name="loc_354_13_354_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_13_354_20&#39;)"><span class="hl_vardecl"><span class="mpre">streams</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_351_9_351_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_9_351_12&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">
            case </span><a href="#loc_354_13_354_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_13_354_20&#39;)"><span class="hl_varref"><span class="mpre">streams</span></span></a><span class="mpre"> of
              []       -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
              (</span><a name="loc_357_16_357_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_16_357_17&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_357_18_357_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_18_357_22&#39;)"><span class="hl_vardecl"><span class="mpre">rest</span></span></a><span class="mpre">) -&gt; do
                  </span><a name="loc_358_19_358_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_358_19_358_23&#39;)"><span class="hl_vardecl"><span class="mpre">next</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_357_16_357_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_16_357_17&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
                  case </span><a href="#loc_358_19_358_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_358_19_358_23&#39;)"><span class="hl_varref"><span class="mpre">next</span></span></a><span class="mpre"> of
                    </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_351_9_351_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_9_351_12&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><a href="#loc_357_18_357_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_18_357_22&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_353_9_353_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_9_353_11&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">
                    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> _  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_358_19_358_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_358_19_358_23&#39;)"><span class="hl_varref"><span class="mpre">next</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Checks if an &#39;InputStream&#39; is at end-of-stream.</span></span><span class="mpre">
</span><a href="#loc_367_1_367_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_367_1_367_6&#39;)"><span class="mpre">atEOF</span></a><span class="mpre"> :: </span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_367_1_367_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_367_1_367_6&#39;)"><span class="hl_fundecl"><span class="mpre">atEOF</span></span></a><span class="mpre"> </span><a name="loc_367_7_367_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_367_7_367_8&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = </span><a href="#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_367_7_367_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_367_7_367_8&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">) (\</span><a name="loc_367_44_367_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_367_44_367_45&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_178_1_178_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_1_178_7&#39;)"><span class="hl_varref"><span class="mpre">unRead</span></span></a><span class="mpre"> </span><a href="#loc_367_44_367_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_367_44_367_45&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_367_7_367_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_367_7_367_8&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- $pushback</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- #pushback#</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Users can push a value back into an input stream using the &#39;unRead&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- function. Usually this will use the default pushback mechanism which</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- provides a buffer for the stream. Some stream transformers, like</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;takeBytes&#39;, produce streams that send pushed-back values back to the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- streams that they wrap. A function like &#39;System.IO.Streams.Combinators.map&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- cannot do this because the types don&#39;t match up:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;System.IO.Streams.Combinators.map&#39; :: (a -&gt; b) -&gt; &#39;InputStream&#39; a -&gt; &#39;IO&#39; (&#39;InputStream&#39; b)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A function will usually document if its pushback behaviour differs from the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- default. No matter what the case, input streams should obey the following</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- law:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Streams.&#39;unRead&#39; c stream &gt;&gt; Streams.&#39;read&#39; stream === &#39;return&#39; (&#39;Just&#39; c)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">


                 </span><span class="hl_comment"><span class="mpre">--------------------------------------------</span></span><span class="mpre">
                 </span><span class="hl_comment"><span class="mpre">-- Typeclass instances for Handle support --</span></span><span class="mpre">
                 </span><span class="hl_comment"><span class="mpre">--------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><a href="#loc_400_1_400_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_1_400_7&#39;)"><span class="mpre">bUFSIZ</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_400_1_400_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_1_400_7&#39;)"><span class="hl_vardecl"><span class="mpre">bUFSIZ</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">32752</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><a href="#loc_405_1_405_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_12&#39;)"><span class="mpre">unsupported</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_405_1_405_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_12&#39;)"><span class="hl_vardecl"><span class="mpre">unsupported</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_345_1_345_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_345_1_345_21&#39;)"><span class="hl_varref"><span class="mpre">unsupportedOperation</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><a href="#loc_410_1_410_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_1_410_11&#39;)"><span class="mpre">bufferToBS</span></a><span class="mpre"> :: </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">H.Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_410_1_410_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_1_410_11&#39;)"><span class="hl_fundecl"><span class="mpre">bufferToBS</span></span></a><span class="mpre"> </span><a name="loc_410_12_410_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_12_410_15&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.copy</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="Data.ByteString.Internal.html#loc_400_1_400_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_400_1_400_15&#39;)"><span class="hl_varref"><span class="mpre">S.fromForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_412_5_412_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_412_5_412_8&#39;)"><span class="hl_varref"><span class="mpre">raw</span></span></a><span class="mpre"> </span><a href="#loc_413_5_413_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_413_5_413_6&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><a href="#loc_415_5_415_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_415_5_415_7&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre">
  where
    </span><a name="loc_412_5_412_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_412_5_412_8&#39;)"><span class="hl_vardecl"><span class="mpre">raw</span></span></a><span class="mpre">  = </span><a href="GHC.IO.Buffer.html#loc_182_9_182_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_182_9_182_15&#39;)"><span class="hl_varref"><span class="mpre">H.bufRaw</span></span></a><span class="mpre"> </span><a href="#loc_410_12_410_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_12_410_15&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
    </span><a name="loc_413_5_413_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_413_5_413_6&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">    = </span><a href="GHC.IO.Buffer.html#loc_185_9_185_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_185_9_185_13&#39;)"><span class="hl_varref"><span class="mpre">H.bufL</span></span></a><span class="mpre"> </span><a href="#loc_410_12_410_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_12_410_15&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
    </span><a name="loc_414_5_414_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_414_5_414_6&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">    = </span><a href="GHC.IO.Buffer.html#loc_186_9_186_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_186_9_186_13&#39;)"><span class="hl_varref"><span class="mpre">H.bufR</span></span></a><span class="mpre"> </span><a href="#loc_410_12_410_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_12_410_15&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
    </span><a name="loc_415_5_415_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_415_5_415_7&#39;)"><span class="hl_vardecl"><span class="mpre">sz</span></span></a><span class="mpre">   = </span><a href="#loc_414_5_414_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_414_5_414_6&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_413_5_413_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_413_5_413_6&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
instance </span><a href="GHC.IO.Device.html#loc_38_7_38_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_38_7_38_12&#39;)"><span class="hl_classref"><span class="mpre">H.RawIO</span></span></a><span class="mpre"> (</span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">) where
    </span><a href="#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_5&#39;)"><span class="hl_fundecl"><span class="mpre">read</span></span></a><span class="mpre"> </span><a name="loc_420_10_420_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_10_420_12&#39;)"><span class="hl_vardecl"><span class="mpre">is</span></span></a><span class="mpre"> </span><a name="loc_420_13_420_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_13_420_16&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_420_17_420_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_17_420_18&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><a href="#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_5&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_420_10_420_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_10_420_12&#39;)"><span class="hl_varref"><span class="mpre">is</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">) </span><a href="#loc_422_9_422_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_9_422_10&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">
      where
        </span><a name="loc_422_9_422_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_9_422_10&#39;)"><span class="hl_fundecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_422_11_422_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_11_422_12&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Unsafe.html#loc_311_1_311_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Unsafe.html#loc_311_1_311_22&#39;)"><span class="hl_varref"><span class="mpre">S.unsafeUseAsCStringLen</span></span></a><span class="mpre"> </span><a href="#loc_422_11_422_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_11_422_12&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_422_45_422_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_45_422_49&#39;)"><span class="hl_vardecl"><span class="mpre">cstr</span></span></a><span class="mpre">, </span><a name="loc_422_51_422_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_51_422_52&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) -&gt; do
                  let </span><a name="loc_423_23_423_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_423_23_423_24&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">min</span></span><span class="mpre"> </span><a href="#loc_420_17_420_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_17_420_18&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_422_51_422_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_51_422_52&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
                  </span><a href="Foreign.Marshal.Utils.html#loc_154_1_154_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Utils.html#loc_154_1_154_10&#39;)"><span class="hl_varref"><span class="mpre">copyBytes</span></span></a><span class="mpre"> </span><a href="#loc_420_13_420_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_420_13_420_16&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_422_45_422_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_45_422_49&#39;)"><span class="hl_varref"><span class="mpre">cstr</span></span></a><span class="mpre">) </span><a href="#loc_423_23_423_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_423_23_423_24&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">
                  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_423_23_423_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_423_23_423_24&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">

    </span><span class="hl_fundecl"><span class="mpre">readNonBlocking</span></span><span class="mpre">  _ _ _ = </span><a href="#loc_405_1_405_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_12&#39;)"><span class="hl_varref"><span class="mpre">unsupported</span></span></a><span class="mpre">
    </span><a href="#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_6&#39;)"><span class="hl_fundecl"><span class="mpre">write</span></span></a><span class="mpre">            _ _ _ = </span><a href="#loc_405_1_405_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_12&#39;)"><span class="hl_varref"><span class="mpre">unsupported</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">writeNonBlocking</span></span><span class="mpre"> _ _ _ = </span><a href="#loc_405_1_405_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_12&#39;)"><span class="hl_varref"><span class="mpre">unsupported</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
instance </span><a href="GHC.IO.Device.html#loc_38_7_38_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_38_7_38_12&#39;)"><span class="hl_classref"><span class="mpre">H.RawIO</span></span></a><span class="mpre"> (</span><a href="#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">) where
    </span><a href="#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_5&#39;)"><span class="hl_fundecl"><span class="mpre">read</span></span></a><span class="mpre"> _ _ _             = </span><a href="#loc_405_1_405_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_12&#39;)"><span class="hl_varref"><span class="mpre">unsupported</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">readNonBlocking</span></span><span class="mpre"> _ _ _  = </span><a href="#loc_405_1_405_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_12&#39;)"><span class="hl_varref"><span class="mpre">unsupported</span></span></a><span class="mpre">
    </span><a href="#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_6&#39;)"><span class="hl_fundecl"><span class="mpre">write</span></span></a><span class="mpre"> </span><a name="loc_436_11_436_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_436_11_436_13&#39;)"><span class="hl_vardecl"><span class="mpre">os</span></span></a><span class="mpre"> </span><a name="loc_436_14_436_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_436_14_436_17&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_436_18_436_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_436_18_436_19&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">         = </span><span class="hl_varref"><span class="mpre">S.packCStringLen</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_436_14_436_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_436_14_436_17&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">, </span><a href="#loc_436_18_436_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_436_18_436_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre">
                             </span><span class="hl_varref"><span class="mpre">flip</span></span><span class="mpre"> </span><a href="#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_436_11_436_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_436_11_436_13&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">writeNonBlocking</span></span><span class="mpre"> _ _ _ = </span><a href="#loc_405_1_405_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_12&#39;)"><span class="hl_varref"><span class="mpre">unsupported</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Internal convenience synonym for a pair of input\/output streams.</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 443, srcSpanStartColumn = 1, srcSpanEndLine = 443, srcSpanEndColumn = 56}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 443, srcSpanStartColumn = 1, srcSpanEndLine = 443, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6"><span class="mpre">type StreamPair a = SP (InputStream a) (OutputStream a)</span></span><span class="mpre">

instance </span><a href="GHC.IO.Device.html#loc_38_7_38_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_38_7_38_12&#39;)"><span class="hl_classref"><span class="mpre">H.RawIO</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">StreamPair</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">) where
    </span><a href="#loc_137_1_137_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_5&#39;)"><span class="hl_fundecl"><span class="mpre">read</span></span></a><span class="mpre"> (</span><a href="#loc_88_15_88_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_15_88_17&#39;)"><span class="hl_conref"><span class="mpre">SP</span></span></a><span class="mpre"> </span><a name="loc_446_14_446_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_446_14_446_16&#39;)"><span class="hl_vardecl"><span class="mpre">is</span></span></a><span class="mpre"> _) </span><a name="loc_446_20_446_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_446_20_446_23&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_446_24_446_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_446_24_446_25&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">   = </span><a href="GHC.IO.Device.html#loc_45_3_45_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_45_3_45_7&#39;)"><span class="hl_varref"><span class="mpre">H.read</span></span></a><span class="mpre"> </span><a href="#loc_446_14_446_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_446_14_446_16&#39;)"><span class="hl_varref"><span class="mpre">is</span></span></a><span class="mpre"> </span><a href="#loc_446_20_446_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_446_20_446_23&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_446_24_446_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_446_24_446_25&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">readNonBlocking</span></span><span class="mpre">  _ _ _ = </span><a href="#loc_405_1_405_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_12&#39;)"><span class="hl_varref"><span class="mpre">unsupported</span></span></a><span class="mpre">
    </span><a href="#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_6&#39;)"><span class="hl_fundecl"><span class="mpre">write</span></span></a><span class="mpre"> (</span><a href="#loc_88_15_88_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_15_88_17&#39;)"><span class="hl_conref"><span class="mpre">SP</span></span></a><span class="mpre"> _ </span><a name="loc_448_17_448_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_17_448_19&#39;)"><span class="hl_vardecl"><span class="mpre">os</span></span></a><span class="mpre">) </span><a name="loc_448_21_448_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_21_448_24&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_448_25_448_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_25_448_26&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">  = </span><a href="GHC.IO.Device.html#loc_53_3_53_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_53_3_53_8&#39;)"><span class="hl_varref"><span class="mpre">H.write</span></span></a><span class="mpre"> </span><a href="#loc_448_17_448_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_17_448_19&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre"> </span><a href="#loc_448_21_448_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_21_448_24&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_448_25_448_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_25_448_26&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">writeNonBlocking</span></span><span class="mpre"> _ _ _ = </span><a href="#loc_405_1_405_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_12&#39;)"><span class="hl_varref"><span class="mpre">unsupported</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
instance </span><a href="GHC.IO.BufferedIO.html#loc_39_7_39_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_39_7_39_17&#39;)"><span class="hl_classref"><span class="mpre">H.BufferedIO</span></span></a><span class="mpre"> (</span><a href="#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">) where
    </span><span class="hl_fundecl"><span class="mpre">newBuffer</span></span><span class="mpre"> !_ </span><a name="loc_454_18_454_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_454_18_454_20&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">            = </span><a href="GHC.IO.Buffer.html#loc_244_1_244_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_244_1_244_14&#39;)"><span class="hl_varref"><span class="mpre">H.newByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_400_1_400_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_1_400_7&#39;)"><span class="hl_varref"><span class="mpre">bUFSIZ</span></span></a><span class="mpre"> </span><a href="#loc_454_18_454_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_454_18_454_20&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">fillReadBuffer</span></span><span class="mpre"> !_ _        = </span><a href="#loc_405_1_405_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_12&#39;)"><span class="hl_varref"><span class="mpre">unsupported</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">fillReadBuffer0</span></span><span class="mpre"> !_ _       = </span><a href="#loc_405_1_405_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_12&#39;)"><span class="hl_varref"><span class="mpre">unsupported</span></span></a><span class="mpre">

    </span><span class="hl_fundecl"><span class="mpre">flushWriteBuffer</span></span><span class="mpre"> !</span><a name="loc_458_23_458_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_458_23_458_25&#39;)"><span class="hl_vardecl"><span class="mpre">os</span></span></a><span class="mpre"> !</span><a name="loc_458_27_458_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_458_27_458_30&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre">  = do
        </span><a href="#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_410_1_410_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_1_410_11&#39;)"><span class="hl_varref"><span class="mpre">bufferToBS</span></span></a><span class="mpre"> </span><a href="#loc_458_27_458_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_458_27_458_30&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">) </span><a href="#loc_458_23_458_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_458_23_458_25&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre">
        </span><a href="#loc_512_1_512_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_1_512_17&#39;)"><span class="hl_varref"><span class="mpre">emptyWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_458_27_458_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_458_27_458_30&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">

    </span><span class="hl_fundecl"><span class="mpre">flushWriteBuffer0</span></span><span class="mpre"> !</span><a name="loc_462_24_462_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_462_24_462_26&#39;)"><span class="hl_vardecl"><span class="mpre">os</span></span></a><span class="mpre"> !</span><a name="loc_462_28_462_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_462_28_462_31&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> = do
        let </span><a name="loc_463_13_463_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_13_463_14&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = </span><a href="#loc_410_1_410_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_1_410_11&#39;)"><span class="hl_varref"><span class="mpre">bufferToBS</span></span></a><span class="mpre"> </span><a href="#loc_462_28_462_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_462_28_462_31&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
        let </span><a name="loc_464_13_464_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_13_464_14&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_463_13_463_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_13_463_14&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
        </span><a href="#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_463_13_463_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_463_13_463_14&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) </span><a href="#loc_462_24_462_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_462_24_462_26&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre">
        </span><a name="loc_466_9_466_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_466_9_466_13&#39;)"><span class="hl_vardecl"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_512_1_512_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_1_512_17&#39;)"><span class="hl_varref"><span class="mpre">emptyWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_462_28_462_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_462_28_462_31&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> (</span><a href="#loc_464_13_464_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_13_464_14&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">, </span><a href="#loc_466_9_466_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_466_9_466_13&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
instance </span><a href="GHC.IO.BufferedIO.html#loc_39_7_39_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_39_7_39_17&#39;)"><span class="hl_classref"><span class="mpre">H.BufferedIO</span></span></a><span class="mpre"> (</span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">) where
    </span><span class="hl_fundecl"><span class="mpre">newBuffer</span></span><span class="mpre"> !_ !</span><a name="loc_472_19_472_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_472_19_472_21&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">        = </span><a href="GHC.IO.Buffer.html#loc_244_1_244_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_244_1_244_14&#39;)"><span class="hl_varref"><span class="mpre">H.newByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_400_1_400_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_1_400_7&#39;)"><span class="hl_varref"><span class="mpre">bUFSIZ</span></span></a><span class="mpre"> </span><a href="#loc_472_19_472_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_472_19_472_21&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">fillReadBuffer</span></span><span class="mpre"> !</span><a name="loc_473_21_473_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_21_473_23&#39;)"><span class="hl_vardecl"><span class="mpre">is</span></span></a><span class="mpre"> !</span><a name="loc_473_25_473_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_25_473_28&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> = </span><a href="GHC.IO.BufferedIO.html#loc_94_1_94_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_94_1_94_8&#39;)"><span class="hl_varref"><span class="mpre">H.readBuf</span></span></a><span class="mpre"> </span><a href="#loc_473_21_473_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_21_473_23&#39;)"><span class="hl_varref"><span class="mpre">is</span></span></a><span class="mpre"> </span><a href="#loc_473_25_473_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_25_473_28&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">fillReadBuffer0</span></span><span class="mpre"> _ _    = </span><a href="#loc_405_1_405_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_12&#39;)"><span class="hl_varref"><span class="mpre">unsupported</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">flushWriteBuffer</span></span><span class="mpre"> _ _   = </span><a href="#loc_405_1_405_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_12&#39;)"><span class="hl_varref"><span class="mpre">unsupported</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">flushWriteBuffer0</span></span><span class="mpre"> _ _  = </span><a href="#loc_405_1_405_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_12&#39;)"><span class="hl_varref"><span class="mpre">unsupported</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
instance </span><a href="GHC.IO.BufferedIO.html#loc_39_7_39_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_39_7_39_17&#39;)"><span class="hl_classref"><span class="mpre">H.BufferedIO</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">StreamPair</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">) where
    </span><span class="hl_fundecl"><span class="mpre">newBuffer</span></span><span class="mpre"> !_ </span><a name="loc_481_18_481_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_481_18_481_20&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">              = </span><a href="GHC.IO.Buffer.html#loc_244_1_244_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_244_1_244_14&#39;)"><span class="hl_varref"><span class="mpre">H.newByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_400_1_400_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_1_400_7&#39;)"><span class="hl_varref"><span class="mpre">bUFSIZ</span></span></a><span class="mpre"> </span><a href="#loc_481_18_481_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_481_18_481_20&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">fillReadBuffer</span></span><span class="mpre"> (</span><a href="#loc_88_15_88_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_15_88_17&#39;)"><span class="hl_conref"><span class="mpre">SP</span></span></a><span class="mpre"> </span><a name="loc_482_24_482_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_482_24_482_26&#39;)"><span class="hl_vardecl"><span class="mpre">is</span></span></a><span class="mpre"> _)     = </span><a href="GHC.IO.BufferedIO.html#loc_48_3_48_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_48_3_48_17&#39;)"><span class="hl_varref"><span class="mpre">H.fillReadBuffer</span></span></a><span class="mpre"> </span><a href="#loc_482_24_482_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_482_24_482_26&#39;)"><span class="hl_varref"><span class="mpre">is</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">fillReadBuffer0</span></span><span class="mpre"> _ _          = </span><a href="#loc_405_1_405_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_12&#39;)"><span class="hl_varref"><span class="mpre">unsupported</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">flushWriteBuffer</span></span><span class="mpre"> (</span><a href="#loc_88_15_88_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_15_88_17&#39;)"><span class="hl_conref"><span class="mpre">SP</span></span></a><span class="mpre"> _ !</span><a name="loc_484_29_484_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_484_29_484_31&#39;)"><span class="hl_vardecl"><span class="mpre">os</span></span></a><span class="mpre">)  = </span><a href="GHC.IO.BufferedIO.html#loc_69_3_69_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_69_3_69_19&#39;)"><span class="hl_varref"><span class="mpre">H.flushWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_484_29_484_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_484_29_484_31&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">flushWriteBuffer0</span></span><span class="mpre"> (</span><a href="#loc_88_15_88_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_15_88_17&#39;)"><span class="hl_conref"><span class="mpre">SP</span></span></a><span class="mpre"> _ !</span><a name="loc_485_30_485_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_485_30_485_32&#39;)"><span class="hl_vardecl"><span class="mpre">os</span></span></a><span class="mpre">) = </span><a href="GHC.IO.BufferedIO.html#loc_74_3_74_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_74_3_74_20&#39;)"><span class="hl_varref"><span class="mpre">H.flushWriteBuffer0</span></span></a><span class="mpre"> </span><a href="#loc_485_30_485_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_485_30_485_32&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
instance </span><a href="GHC.IO.Device.html#loc_61_7_61_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_61_7_61_15&#39;)"><span class="hl_classref"><span class="mpre">H.IODevice</span></span></a><span class="mpre"> (</span><a href="#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">) where
  </span><span class="hl_fundecl"><span class="mpre">ready</span></span><span class="mpre"> _ _ _ = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
  </span><span class="hl_vardecl"><span class="mpre">close</span></span><span class="mpre">       = </span><a href="#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
  </span><span class="hl_fundecl"><span class="mpre">devType</span></span><span class="mpre"> _   = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="GHC.IO.Device.html#loc_148_5_148_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_148_5_148_11&#39;)"><span class="hl_conref"><span class="mpre">H.Stream</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
instance </span><a href="GHC.IO.Device.html#loc_61_7_61_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_61_7_61_15&#39;)"><span class="hl_classref"><span class="mpre">H.IODevice</span></span></a><span class="mpre"> (</span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">) where
  </span><span class="hl_fundecl"><span class="mpre">ready</span></span><span class="mpre"> _ _ _ = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
  </span><span class="hl_fundecl"><span class="mpre">close</span></span><span class="mpre"> _     = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
  </span><span class="hl_fundecl"><span class="mpre">devType</span></span><span class="mpre"> _   = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="GHC.IO.Device.html#loc_148_5_148_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_148_5_148_11&#39;)"><span class="hl_conref"><span class="mpre">H.Stream</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
instance </span><a href="GHC.IO.Device.html#loc_61_7_61_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_61_7_61_15&#39;)"><span class="hl_classref"><span class="mpre">H.IODevice</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">StreamPair</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">) where
  </span><span class="hl_fundecl"><span class="mpre">ready</span></span><span class="mpre"> _ _ _     = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
  </span><span class="hl_fundecl"><span class="mpre">close</span></span><span class="mpre"> (</span><a href="#loc_88_15_88_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_15_88_17&#39;)"><span class="hl_conref"><span class="mpre">SP</span></span></a><span class="mpre"> _ </span><a name="loc_505_15_505_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_505_15_505_17&#39;)"><span class="hl_vardecl"><span class="mpre">os</span></span></a><span class="mpre">) = </span><a href="#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="#loc_505_15_505_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_505_15_505_17&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre">
  </span><span class="hl_fundecl"><span class="mpre">devType</span></span><span class="mpre"> _       = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="GHC.IO.Device.html#loc_148_5_148_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_148_5_148_11&#39;)"><span class="hl_conref"><span class="mpre">H.Stream</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><a href="#loc_512_1_512_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_1_512_17&#39;)"><span class="mpre">emptyWriteBuffer</span></a><span class="mpre"> :: </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">H.Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">
                 -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">H.Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
</span><a name="loc_512_1_512_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_512_1_512_17&#39;)"><span class="hl_fundecl"><span class="mpre">emptyWriteBuffer</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">buf</span></span><span class="mpre">
    = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 513, srcSpanStartColumn = 14, srcSpanEndLine = 513, srcSpanEndColumn = 68}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 513, srcSpanStartColumn = 18, srcSpanEndLine = 513, srcSpanEndColumn = 19},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1"><span class="mpre">buf { H.bufL=0, H.bufR=0, H.bufState = H.WriteBuffer }</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | A &#39;Generator&#39; is a coroutine monad that can be used to define complex</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;InputStream&#39;s. You can cause a value of type @Just r@ to appear when the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;InputStream&#39; is read by calling &#39;yield&#39;:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- g :: &#39;Generator&#39; Int ()</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- g = do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     Streams.&#39;yield&#39; 1</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     Streams.&#39;yield&#39; 2</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     Streams.&#39;yield&#39; 3</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A &#39;Generator&#39; can be turned into an &#39;InputStream&#39; by calling</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;fromGenerator&#39;:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- m :: &#39;IO&#39; [&#39;Int&#39;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- m = Streams.&#39;fromGenerator&#39; g &gt;&gt;= Streams.&#39;System.IO.Streams.toList&#39;     \-\- value returned is [1,2,3]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- You can perform IO by calling &#39;liftIO&#39;, and turn a &#39;Generator&#39; into an</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;InputStream&#39; with &#39;fromGenerator&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- As a general rule, you should not acquire resources that need to be freed</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- from a &#39;Generator&#39;, because there is no guarantee the coroutine continuation</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- will ever be called, nor can you catch an exception from within a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Generator&#39;.</span></span><span class="mpre">
newtype </span><a name="loc_544_9_544_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_9_544_18&#39;)"><span class="hl_tycondecl"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_544_25_544_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_25_544_34&#39;)"><span class="hl_condecl"><span class="mpre">Generator</span></span></a><span class="mpre"> {
      </span><a name="loc_545_7_545_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_545_7_545_10&#39;)"><span class="hl_fielddecl"><span class="mpre">unG</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> (</span><a href="#loc_88_6_88_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_6_88_8&#39;)"><span class="hl_tyconref"><span class="mpre">SP</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre"> (</span><a href="#loc_544_9_544_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_9_544_18&#39;)"><span class="hl_tyconref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
    } </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 546, srcSpanStartColumn = 7, srcSpanEndLine = 546, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 546, srcSpanStartColumn = 7, srcSpanEndLine = 546, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4."><span class="mpre">deriving (Typeable)</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><a href="#loc_551_1_551_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_1_551_14&#39;)"><span class="mpre">generatorBind</span></a><span class="mpre"> :: </span><a href="#loc_544_9_544_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_9_544_18&#39;)"><span class="hl_tyconref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_544_9_544_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_9_544_18&#39;)"><span class="hl_tyconref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">) -&gt; </span><a href="#loc_544_9_544_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_9_544_18&#39;)"><span class="hl_tyconref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
</span><a name="loc_551_1_551_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_1_551_14&#39;)"><span class="hl_fundecl"><span class="mpre">generatorBind</span></span></a><span class="mpre"> (</span><a href="#loc_544_25_544_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_25_544_34&#39;)"><span class="hl_conref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><a name="loc_551_26_551_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_26_551_27&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) </span><a name="loc_551_29_551_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_29_551_30&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_544_25_544_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_25_544_34&#39;)"><span class="hl_conref"><span class="mpre">Generator</span></span></a><span class="mpre"> (</span><a href="#loc_551_26_551_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_26_551_27&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">either</span></span><span class="mpre"> </span><a href="#loc_553_5_553_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_553_5_553_9&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_554_5_554_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_554_5_554_10&#39;)"><span class="hl_varref"><span class="mpre">value</span></span></a><span class="mpre">)
  where
    </span><a name="loc_553_5_553_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_553_5_553_9&#39;)"><span class="hl_fundecl"><span class="mpre">step</span></span></a><span class="mpre"> (</span><a href="#loc_88_15_88_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_15_88_17&#39;)"><span class="hl_conref"><span class="mpre">SP</span></span></a><span class="mpre"> </span><a name="loc_553_14_553_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_553_14_553_15&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> </span><a name="loc_553_16_553_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_553_16_553_17&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_88_15_88_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_15_88_17&#39;)"><span class="hl_conref"><span class="mpre">SP</span></span></a><span class="mpre"> </span><a href="#loc_553_14_553_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_553_14_553_15&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre"> (</span><a href="#loc_551_1_551_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_1_551_14&#39;)"><span class="hl_varref"><span class="mpre">generatorBind</span></span></a><span class="mpre"> </span><a href="#loc_553_16_553_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_553_16_553_17&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><a href="#loc_551_29_551_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_29_551_30&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">)
    </span><a name="loc_554_5_554_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_554_5_554_10&#39;)"><span class="hl_vardecl"><span class="mpre">value</span></span></a><span class="mpre"> = </span><a href="#loc_545_7_545_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_545_7_545_10&#39;)"><span class="hl_varref"><span class="mpre">unG</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre">  </span><a href="#loc_551_29_551_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_29_551_30&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_551_1_551_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_1_551_14&#39;)"><span class="mpre">generatorBind</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
instance </span><span class="hl_classref"><span class="mpre">Monad</span></span><span class="mpre"> (</span><a href="#loc_544_9_544_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_9_544_18&#39;)"><span class="hl_tyconref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">) where
   </span><span class="hl_vardecl"><span class="mpre">return</span></span><span class="mpre"> = </span><a href="#loc_544_25_544_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_25_544_34&#39;)"><span class="hl_conref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre">
   </span><span class="hl_vardecl"><span class="mpre">(&gt;&gt;=)</span></span><span class="mpre">  = </span><a href="#loc_551_1_551_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_551_1_551_14&#39;)"><span class="hl_varref"><span class="mpre">generatorBind</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
instance </span><a href="Control.Monad.IO.Class.html#loc_30_20_30_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_30_20_30_27&#39;)"><span class="hl_classref"><span class="mpre">MonadIO</span></span></a><span class="mpre"> (</span><a href="#loc_544_9_544_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_9_544_18&#39;)"><span class="hl_tyconref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">) where
    </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_vardecl"><span class="mpre">liftIO</span></span></a><span class="mpre"> = </span><a href="#loc_544_25_544_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_25_544_34&#39;)"><span class="hl_conref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
instance </span><span class="hl_classref"><span class="mpre">Functor</span></span><span class="mpre"> (</span><a href="#loc_544_9_544_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_9_544_18&#39;)"><span class="hl_tyconref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">) where
    </span><span class="hl_fundecl"><span class="mpre">fmap</span></span><span class="mpre"> </span><a name="loc_571_10_571_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_10_571_11&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> (</span><a href="#loc_544_25_544_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_25_544_34&#39;)"><span class="hl_conref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><a name="loc_571_23_571_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_23_571_24&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) = </span><a href="#loc_544_25_544_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_25_544_34&#39;)"><span class="hl_conref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_571_23_571_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_23_571_24&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">either</span></span><span class="mpre"> </span><a href="#loc_573_9_573_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_573_9_573_13&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_574_9_574_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_574_9_574_14&#39;)"><span class="hl_varref"><span class="mpre">value</span></span></a><span class="mpre">
      where
        </span><a name="loc_573_9_573_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_573_9_573_13&#39;)"><span class="hl_fundecl"><span class="mpre">step</span></span></a><span class="mpre"> (</span><a href="#loc_88_15_88_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_15_88_17&#39;)"><span class="hl_conref"><span class="mpre">SP</span></span></a><span class="mpre"> </span><a name="loc_573_18_573_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_573_18_573_19&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> </span><a name="loc_573_20_573_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_573_20_573_22&#39;)"><span class="hl_vardecl"><span class="mpre">m&#39;</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_88_15_88_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_15_88_17&#39;)"><span class="hl_conref"><span class="mpre">SP</span></span></a><span class="mpre"> </span><a href="#loc_573_18_573_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_573_18_573_19&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> </span><a href="#loc_571_10_571_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_10_571_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_573_20_573_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_573_20_573_22&#39;)"><span class="hl_varref"><span class="mpre">m&#39;</span></span></a><span class="mpre">)
        </span><a name="loc_574_9_574_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_574_9_574_14&#39;)"><span class="hl_fundecl"><span class="mpre">value</span></span></a><span class="mpre"> </span><a name="loc_574_15_574_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_574_15_574_16&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre">        = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_571_10_571_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_10_571_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_574_15_574_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_574_15_574_16&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
instance </span><a href="Control.Applicative.html#loc_113_20_113_31" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_113_20_113_31&#39;)"><span class="hl_classref"><span class="mpre">Applicative</span></span></a><span class="mpre"> (</span><a href="#loc_544_9_544_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_9_544_18&#39;)"><span class="hl_tyconref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">) where
    </span><a href="Control.Applicative.html#loc_115_5_115_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_115_5_115_9&#39;)"><span class="hl_vardecl"><span class="mpre">pure</span></span></a><span class="mpre"> = </span><a href="#loc_544_25_544_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_25_544_34&#39;)"><span class="hl_conref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre">

    </span><a name="loc_581_5_581_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_581_5_581_6&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_fundecl"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a name="loc_581_11_581_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_581_11_581_12&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = do
        </span><a name="loc_582_9_582_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_9_582_10&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_581_5_581_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_581_5_581_6&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
        </span><a name="loc_583_9_583_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_583_9_583_10&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_581_11_581_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_581_11_581_12&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_582_9_582_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_9_582_10&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_583_9_583_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_583_9_583_10&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Calling @&#39;yield&#39; x@ causes the value @&#39;Just&#39; x@ to appear on the input</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- when this generator is converted to an &#39;InputStream&#39;. The rest of the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- computation after the call to &#39;yield&#39; is resumed later when the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;InputStream&#39; is &#39;read&#39; again.</span></span><span class="mpre">
</span><a href="#loc_593_1_593_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_593_1_593_6&#39;)"><span class="mpre">yield</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre"> -&gt; </span><a href="#loc_544_9_544_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_9_544_18&#39;)"><span class="hl_tyconref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_593_1_593_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_593_1_593_6&#39;)"><span class="hl_fundecl"><span class="mpre">yield</span></span></a><span class="mpre"> </span><a name="loc_593_7_593_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_593_7_593_8&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="#loc_544_25_544_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_25_544_34&#39;)"><span class="hl_conref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_88_15_88_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_15_88_17&#39;)"><span class="hl_conref"><span class="mpre">SP</span></span></a><span class="mpre"> </span><a href="#loc_593_7_593_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_593_7_593_8&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Turns a &#39;Generator&#39; into an &#39;InputStream&#39;.</span></span><span class="mpre">
</span><a href="#loc_599_1_599_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_599_1_599_14&#39;)"><span class="mpre">fromGenerator</span></a><span class="mpre"> :: </span><a href="#loc_544_9_544_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_9_544_18&#39;)"><span class="hl_tyconref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_107_6_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_6_107_17&#39;)"><span class="hl_tyconref"><span class="mpre">InputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">)
</span><a name="loc_599_1_599_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_599_1_599_14&#39;)"><span class="hl_fundecl"><span class="mpre">fromGenerator</span></span></a><span class="mpre"> (</span><a href="#loc_544_25_544_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_544_25_544_34&#39;)"><span class="hl_conref"><span class="mpre">Generator</span></span></a><span class="mpre"> </span><a name="loc_599_26_599_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_599_26_599_27&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) = do
    </span><a name="loc_600_5_600_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_600_5_600_8&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_599_26_599_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_599_26_599_27&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
    </span><a href="#loc_247_1_247_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_1_247_16&#39;)"><span class="hl_varref"><span class="mpre">makeInputStream</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_603_5_603_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_603_5_603_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_600_5_600_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_600_5_600_8&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">
  where
    </span><a name="loc_603_5_603_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_603_5_603_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_603_8_603_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_603_8_603_11&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> = </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_603_8_603_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_603_8_603_11&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> (\</span><a name="loc_603_34_603_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_603_34_603_35&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_603_34_603_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_603_34_603_35&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">either</span></span><span class="mpre"> </span><a href="#loc_605_9_605_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_9_605_13&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_609_9_609_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_609_9_609_15&#39;)"><span class="hl_varref"><span class="mpre">finish</span></span></a><span class="mpre">)
      where
        </span><a name="loc_605_9_605_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_9_605_13&#39;)"><span class="hl_fundecl"><span class="mpre">step</span></span></a><span class="mpre"> (</span><a href="#loc_88_15_88_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_15_88_17&#39;)"><span class="hl_conref"><span class="mpre">SP</span></span></a><span class="mpre"> </span><a name="loc_605_18_605_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_18_605_19&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> </span><a name="loc_605_20_605_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_20_605_23&#39;)"><span class="hl_vardecl"><span class="mpre">gen</span></span></a><span class="mpre">) = do
            </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_603_8_603_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_603_8_603_11&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_545_7_545_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_545_7_545_10&#39;)"><span class="hl_varref"><span class="mpre">unG</span></span></a><span class="mpre"> </span><a href="#loc_605_20_605_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_20_605_23&#39;)"><span class="hl_varref"><span class="mpre">gen</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_605_18_605_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_18_605_19&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">

        </span><a name="loc_609_9_609_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_609_9_609_15&#39;)"><span class="hl_fundecl"><span class="mpre">finish</span></span></a><span class="mpre"> _ = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
newtype </span><a name="loc_613_9_613_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_9_613_17&#39;)"><span class="hl_tycondecl"><span class="mpre">Consumer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_613_24_613_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_24_613_32&#39;)"><span class="hl_condecl"><span class="mpre">Consumer</span></span></a><span class="mpre"> {
      </span><a name="loc_614_7_614_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_614_7_614_10&#39;)"><span class="hl_fielddecl"><span class="mpre">unC</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre"> -&gt; </span><a href="#loc_613_9_613_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_9_613_17&#39;)"><span class="hl_tyconref"><span class="mpre">Consumer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
    } </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 615, srcSpanStartColumn = 7, srcSpanEndLine = 615, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Internal.hs&quot;, srcSpanStartLine = 615, srcSpanStartColumn = 7, srcSpanEndLine = 615, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4."><span class="mpre">deriving (Typeable)</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
instance </span><span class="hl_classref"><span class="mpre">Monad</span></span><span class="mpre"> (</span><a href="#loc_613_9_613_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_9_613_17&#39;)"><span class="hl_tyconref"><span class="mpre">Consumer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">) where
    </span><span class="hl_vardecl"><span class="mpre">return</span></span><span class="mpre"> = </span><a href="#loc_613_24_613_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_24_613_32&#39;)"><span class="hl_conref"><span class="mpre">Consumer</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre">

    (</span><a href="#loc_613_24_613_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_24_613_32&#39;)"><span class="hl_conref"><span class="mpre">Consumer</span></span></a><span class="mpre"> </span><a name="loc_622_15_622_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_622_15_622_16&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) </span><span class="hl_fundecl"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a name="loc_622_22_622_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_622_22_622_23&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_613_24_613_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_24_613_32&#39;)"><span class="hl_conref"><span class="mpre">Consumer</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_622_15_622_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_622_15_622_16&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">either</span></span><span class="mpre"> </span><a href="#loc_624_9_624_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_624_9_624_13&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_625_9_625_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_625_9_625_14&#39;)"><span class="hl_varref"><span class="mpre">value</span></span></a><span class="mpre">
      where
        </span><a name="loc_624_9_624_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_624_9_624_13&#39;)"><span class="hl_fundecl"><span class="mpre">step</span></span></a><span class="mpre"> </span><a name="loc_624_14_624_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_624_14_624_15&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="#loc_622_22_622_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_622_22_622_23&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_624_14_624_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_624_14_624_15&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre">
        </span><a name="loc_625_9_625_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_625_9_625_14&#39;)"><span class="hl_fundecl"><span class="mpre">value</span></span></a><span class="mpre"> </span><a name="loc_625_15_625_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_625_15_625_16&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> = </span><a href="#loc_614_7_614_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_614_7_614_10&#39;)"><span class="hl_varref"><span class="mpre">unC</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_622_22_622_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_622_22_622_23&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_625_15_625_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_625_15_625_16&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
instance </span><a href="Control.Monad.IO.Class.html#loc_30_20_30_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_30_20_30_27&#39;)"><span class="hl_classref"><span class="mpre">MonadIO</span></span></a><span class="mpre"> (</span><a href="#loc_613_9_613_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_9_613_17&#39;)"><span class="hl_tyconref"><span class="mpre">Consumer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">) where
    </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_vardecl"><span class="mpre">liftIO</span></span></a><span class="mpre"> = </span><a href="#loc_613_24_613_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_24_613_32&#39;)"><span class="hl_conref"><span class="mpre">Consumer</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
instance </span><span class="hl_classref"><span class="mpre">Functor</span></span><span class="mpre"> (</span><a href="#loc_613_9_613_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_9_613_17&#39;)"><span class="hl_tyconref"><span class="mpre">Consumer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">) where
    </span><span class="hl_fundecl"><span class="mpre">fmap</span></span><span class="mpre"> </span><a name="loc_635_10_635_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_635_10_635_11&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> (</span><a href="#loc_613_24_613_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_24_613_32&#39;)"><span class="hl_conref"><span class="mpre">Consumer</span></span></a><span class="mpre"> </span><a name="loc_635_22_635_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_635_22_635_23&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) = </span><a href="#loc_613_24_613_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_24_613_32&#39;)"><span class="hl_conref"><span class="mpre">Consumer</span></span></a><span class="mpre"> (</span><a href="#loc_635_22_635_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_635_22_635_23&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">either</span></span><span class="mpre"> </span><a href="#loc_637_9_637_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_637_9_637_13&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_638_9_638_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_638_9_638_14&#39;)"><span class="hl_varref"><span class="mpre">value</span></span></a><span class="mpre">)
      where
        </span><a name="loc_637_9_637_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_637_9_637_13&#39;)"><span class="hl_fundecl"><span class="mpre">step</span></span></a><span class="mpre"> </span><a name="loc_637_14_637_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_637_14_637_15&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> </span><a href="#loc_635_10_635_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_635_10_635_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_637_14_637_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_637_14_637_15&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre">
        </span><a name="loc_638_9_638_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_638_9_638_14&#39;)"><span class="hl_fundecl"><span class="mpre">value</span></span></a><span class="mpre"> </span><a name="loc_638_15_638_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_638_15_638_16&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_635_10_635_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_635_10_635_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_638_15_638_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_638_15_638_16&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
instance </span><a href="Control.Applicative.html#loc_113_20_113_31" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_113_20_113_31&#39;)"><span class="hl_classref"><span class="mpre">Applicative</span></span></a><span class="mpre"> (</span><a href="#loc_613_9_613_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_9_613_17&#39;)"><span class="hl_tyconref"><span class="mpre">Consumer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">) where
    </span><a href="Control.Applicative.html#loc_115_5_115_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_115_5_115_9&#39;)"><span class="hl_vardecl"><span class="mpre">pure</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre">

    </span><a name="loc_645_5_645_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_645_5_645_6&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_fundecl"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a name="loc_645_11_645_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_645_11_645_12&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = do
        </span><a name="loc_646_9_646_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_646_9_646_10&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_645_5_645_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_645_5_645_6&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
        </span><a name="loc_647_9_647_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_647_9_647_10&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_645_11_645_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_645_11_645_12&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_646_9_646_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_646_9_646_10&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_647_9_647_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_647_9_647_10&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><a href="#loc_653_1_653_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_653_1_653_6&#39;)"><span class="mpre">await</span></a><span class="mpre"> :: </span><a href="#loc_613_9_613_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_9_613_17&#39;)"><span class="hl_tyconref"><span class="mpre">Consumer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">)
</span><a name="loc_653_1_653_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_653_1_653_6&#39;)"><span class="hl_vardecl"><span class="mpre">await</span></span></a><span class="mpre"> = </span><a href="#loc_613_24_613_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_24_613_32&#39;)"><span class="hl_conref"><span class="mpre">Consumer</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><a href="#loc_658_1_658_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_658_1_658_13&#39;)"><span class="mpre">fromConsumer</span></a><span class="mpre"> :: </span><a href="#loc_613_9_613_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_9_613_17&#39;)"><span class="hl_tyconref"><span class="mpre">Consumer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">)
</span><a name="loc_658_1_658_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_658_1_658_13&#39;)"><span class="hl_fundecl"><span class="mpre">fromConsumer</span></span></a><span class="mpre"> </span><a name="loc_658_14_658_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_658_14_658_16&#39;)"><span class="hl_vardecl"><span class="mpre">c0</span></span></a><span class="mpre"> = </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_658_14_658_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_658_14_658_16&#39;)"><span class="hl_varref"><span class="mpre">c0</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="#loc_273_1_273_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_1_273_17&#39;)"><span class="hl_varref"><span class="mpre">makeOutputStream</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_660_5_660_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_660_5_660_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">
  where
    </span><a name="loc_660_5_660_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_660_5_660_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_660_8_660_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_660_8_660_11&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> </span><a name="loc_660_12_660_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_660_12_660_14&#39;)"><span class="hl_vardecl"><span class="mpre">mb</span></span></a><span class="mpre"> = do
        </span><a name="loc_661_9_661_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_9_661_10&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre">  &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_660_8_660_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_660_8_660_11&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">
        </span><a name="loc_662_9_662_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_662_9_662_11&#39;)"><span class="hl_vardecl"><span class="mpre">c&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_614_7_614_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_614_7_614_10&#39;)"><span class="hl_varref"><span class="mpre">unC</span></span></a><span class="mpre"> </span><a href="#loc_661_9_661_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_9_661_10&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">either</span></span><span class="mpre"> </span><a href="#loc_667_9_667_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_667_9_667_13&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_661_9_661_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_661_9_661_10&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">)
        </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_660_8_660_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_660_8_660_11&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><a href="#loc_662_9_662_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_662_9_662_11&#39;)"><span class="hl_varref"><span class="mpre">c&#39;</span></span></a><span class="mpre">
      where
        </span><a name="loc_665_9_665_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_665_9_665_14&#39;)"><span class="hl_fundecl"><span class="mpre">force</span></span></a><span class="mpre"> </span><a name="loc_665_15_665_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_665_15_665_16&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = do </span><a name="loc_665_22_665_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_665_22_665_23&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_614_7_614_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_614_7_614_10&#39;)"><span class="hl_varref"><span class="mpre">unC</span></span></a><span class="mpre"> </span><a href="#loc_665_15_665_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_665_15_665_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">
                     </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_613_24_613_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_24_613_32&#39;)"><span class="hl_conref"><span class="mpre">Consumer</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_665_22_665_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_665_22_665_23&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
        </span><a name="loc_667_9_667_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_667_9_667_13&#39;)"><span class="hl_fundecl"><span class="mpre">step</span></span></a><span class="mpre"> </span><a name="loc_667_14_667_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_667_14_667_15&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre">  = </span><a href="#loc_665_9_665_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_665_9_665_14&#39;)"><span class="hl_varref"><span class="mpre">force</span></span></a><span class="mpre"> </span><a href="Prelude.html#loc_160_3_160_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Prelude.html#loc_160_3_160_5&#39;)"><span class="hl_infix"><span class="mpre">$!</span></span></a><span class="mpre"> </span><a href="#loc_667_14_667_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_667_14_667_15&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre"> </span><a href="#loc_660_12_660_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_660_12_660_14&#39;)"><span class="hl_varref"><span class="mpre">mb</span></span></a><span class="mpre">
</span></div></body></html>