<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE OverloadedStrings, CPP #-}

module Network.Wai.Logger.Apache (
    IPAddrSource(..)
  , apacheLogStr
  ) where

#ifndef MIN_VERSION_base
#define MIN_VERSION_base(x,y,z) 1
#endif

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-logger-2.1.1/Network/Wai/Logger/Apache.hs&quot;, srcSpanStartLine = 12, srcSpanStartColumn = 8, srcSpanEndLine = 12, srcSpanEndColumn = 29}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-logger-2.1.1/Network/Wai/Logger/Apache.hs&quot;, srcSpanStartLine = 13, srcSpanStartColumn = 18, srcSpanEndLine = 13, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as BS
import Data.CaseInsensitive (</span><a href="Data.CaseInsensitive.Internal.html#loc_86_6_86_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.CaseInsensitive.Internal.html#loc_86_6_86_8&#39;)"><span class="mpre">CI</span></a><span class="mpre">)
import Data.List (</span><a href="Data.List.html#loc_261_1_261_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_261_1_261_5&#39;)"><span class="mpre">find</span></a><span class="mpre">)
import Data.Maybe (</span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="mpre">fromMaybe</span></a><span class="mpre">)
#if MIN_VERSION_base(4,5,0)
import Data.Monoid (</span><a href="Data.Monoid.html#loc_99_1_99_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_99_1_99_5&#39;)"><span class="mpre">(&lt;&gt;)</span></a><span class="mpre">)
#else
import Data.Monoid (</span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="mpre">mappend</span></a><span class="mpre">)
#endif
import Network.HTTP.Types (</span><a href="Network.HTTP.Types.Status.html#loc_114_6_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_114_6_114_12&#39;)"><span class="mpre">Status</span></a><span class="mpre">, statusCode)
import Network.Wai (</span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="mpre">Request</span></a><span class="mpre">(..))
import Network.Wai.Logger.Date
import Network.Wai.Logger.IP
import System.Log.FastLogger

</span><span class="hl_comment"><span class="mpre">-- $setup</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; :set -XOverloadedStrings</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; import Network.Wai.Test</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Source from which the IP source address of the client is obtained.</span></span><span class="mpre">
data </span><a name="loc_33_6_33_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_6_33_18&#39;)"><span class="hl_tycondecl"><span class="mpre">IPAddrSource</span></span></a><span class="mpre"> =
  </span><span class="hl_comment"><span class="mpre">-- | From the peer address of the HTTP connection.</span></span><span class="mpre">
    </span><a name="loc_35_5_35_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_5_35_15&#39;)"><span class="hl_condecl"><span class="mpre">FromSocket</span></span></a><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- | From X-Real-IP: or X-Forwarded-For: in the HTTP header.</span></span><span class="mpre">
  | </span><a name="loc_37_5_37_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_5_37_15&#39;)"><span class="hl_condecl"><span class="mpre">FromHeader</span></span></a><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- | From the peer address if header is not found.</span></span><span class="mpre">
  | </span><a name="loc_39_5_39_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_5_39_17&#39;)"><span class="hl_condecl"><span class="mpre">FromFallback</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Apache style log format.</span></span><span class="mpre">
</span><a href="#loc_43_1_43_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_13&#39;)"><span class="mpre">apacheLogStr</span></a><span class="mpre"> :: </span><a href="#loc_33_6_33_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_6_33_18&#39;)"><span class="hl_tyconref"><span class="mpre">IPAddrSource</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ZonedDate</span></span><span class="mpre"> -&gt; </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><a href="Network.HTTP.Types.Status.html#loc_114_6_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_114_6_114_12&#39;)"><span class="hl_tyconref"><span class="mpre">Status</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><a href="System.Log.FastLogger.LogStr.html#loc_59_6_59_12" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Log.FastLogger.LogStr.html#loc_59_6_59_12&#39;)"><span class="hl_tyconref"><span class="mpre">LogStr</span></span></a><span class="mpre">
</span><a name="loc_43_1_43_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_13&#39;)"><span class="hl_fundecl"><span class="mpre">apacheLogStr</span></span></a><span class="mpre"> </span><a name="loc_43_14_43_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_14_43_19&#39;)"><span class="hl_vardecl"><span class="mpre">ipsrc</span></span></a><span class="mpre"> </span><a name="loc_43_20_43_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_20_43_25&#39;)"><span class="hl_vardecl"><span class="mpre">tmstr</span></span></a><span class="mpre"> </span><a name="loc_43_26_43_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_26_43_29&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> </span><a name="loc_43_30_43_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_30_43_36&#39;)"><span class="hl_vardecl"><span class="mpre">status</span></span></a><span class="mpre"> </span><a name="loc_43_37_43_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_37_43_42&#39;)"><span class="hl_vardecl"><span class="mpre">msize</span></span></a><span class="mpre"> =
      </span><span class="hl_varref"><span class="mpre">toLogStr</span></span><span class="mpre"> (</span><a href="#loc_73_1_73_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_12&#39;)"><span class="hl_varref"><span class="mpre">getSourceIP</span></span></a><span class="mpre"> </span><a href="#loc_43_14_43_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_14_43_19&#39;)"><span class="hl_varref"><span class="mpre">ipsrc</span></span></a><span class="mpre"> </span><a href="#loc_43_26_43_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_26_43_29&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">)
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; - - [&quot;</span></span><span class="mpre">
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">toLogStr</span></span><span class="mpre"> </span><a href="#loc_43_20_43_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_20_43_25&#39;)"><span class="hl_varref"><span class="mpre">tmstr</span></span></a><span class="mpre">
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;] \&quot;&quot;</span></span><span class="mpre">
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">toLogStr</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">requestMethod</span></span><span class="mpre"> </span><a href="#loc_43_26_43_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_26_43_29&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">)
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; &quot;</span></span><span class="mpre">
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">toLogStr</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">rawPathInfo</span></span><span class="mpre"> </span><a href="#loc_43_26_43_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_26_43_29&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">)
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; &quot;</span></span><span class="mpre">
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">toLogStr</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">httpVersion</span></span><span class="mpre"> </span><a href="#loc_43_26_43_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_26_43_29&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">))
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;\&quot; &quot;</span></span><span class="mpre">
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">toLogStr</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">statusCode</span></span><span class="mpre"> </span><a href="#loc_43_30_43_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_30_43_36&#39;)"><span class="hl_varref"><span class="mpre">status</span></span></a><span class="mpre">))
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; &quot;</span></span><span class="mpre">
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">toLogStr</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;-&quot;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_43_37_43_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_37_43_42&#39;)"><span class="hl_varref"><span class="mpre">msize</span></span></a><span class="mpre">)
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; \&quot;&quot;</span></span><span class="mpre">
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">toLogStr</span></span><span class="mpre"> (</span><a href="#loc_68_1_68_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_1_68_20&#39;)"><span class="hl_varref"><span class="mpre">lookupRequestField&#39;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;referer&quot;</span></span><span class="mpre"> </span><a href="#loc_43_26_43_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_26_43_29&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">)
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;\&quot; \&quot;&quot;</span></span><span class="mpre">
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">toLogStr</span></span><span class="mpre"> (</span><a href="#loc_68_1_68_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_1_68_20&#39;)"><span class="hl_varref"><span class="mpre">lookupRequestField&#39;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;user-agent&quot;</span></span><span class="mpre"> </span><a href="#loc_43_26_43_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_26_43_29&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">)
  </span><a href="#loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;\&quot;\n&quot;</span></span><span class="mpre">
  where
#if !MIN_VERSION_base(4,5,0)
    </span><a name="loc_64_5_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_9&#39;)"><span class="hl_vardecl"><span class="mpre">(&lt;&gt;)</span></span></a><span class="mpre"> = </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_varref"><span class="mpre">mappend</span></span></a><span class="mpre">
#endif

</span><a href="#loc_68_1_68_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_1_68_20&#39;)"><span class="mpre">lookupRequestField&#39;</span></a><span class="mpre"> :: </span><a href="Data.CaseInsensitive.Internal.html#loc_86_6_86_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.CaseInsensitive.Internal.html#loc_86_6_86_8&#39;)"><span class="hl_tyconref"><span class="mpre">CI</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_68_1_68_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_1_68_20&#39;)"><span class="hl_fundecl"><span class="mpre">lookupRequestField&#39;</span></span></a><span class="mpre"> </span><a name="loc_68_21_68_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_21_68_22&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> </span><a name="loc_68_23_68_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_23_68_26&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> = </span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="hl_varref"><span class="mpre">fromMaybe</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><a href="#loc_68_21_68_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_21_68_22&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">requestHeaders</span></span><span class="mpre"> </span><a href="#loc_68_23_68_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_23_68_26&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- getSourceIP = getSourceIP fromString fromByteString</span></span><span class="mpre">

</span><a href="#loc_73_1_73_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_12&#39;)"><span class="mpre">getSourceIP</span></a><span class="mpre"> :: </span><a href="#loc_33_6_33_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_6_33_18&#39;)"><span class="hl_tyconref"><span class="mpre">IPAddrSource</span></span></a><span class="mpre"> -&gt; </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_73_1_73_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_12&#39;)"><span class="hl_fundecl"><span class="mpre">getSourceIP</span></span></a><span class="mpre"> </span><a href="#loc_35_5_35_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_5_35_15&#39;)"><span class="hl_conref"><span class="mpre">FromSocket</span></span></a><span class="mpre">   = </span><a href="#loc_81_1_81_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_1_81_20&#39;)"><span class="hl_varref"><span class="mpre">getSourceFromSocket</span></span></a><span class="mpre">
</span><a href="#loc_73_1_73_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_12&#39;)"><span class="hl_fundecl"><span class="mpre">getSourceIP</span></span></a><span class="mpre"> </span><a href="#loc_37_5_37_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_5_37_15&#39;)"><span class="hl_conref"><span class="mpre">FromHeader</span></span></a><span class="mpre">   = </span><a href="#loc_93_1_93_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_20&#39;)"><span class="hl_varref"><span class="mpre">getSourceFromHeader</span></span></a><span class="mpre">
</span><a href="#loc_73_1_73_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_12&#39;)"><span class="hl_fundecl"><span class="mpre">getSourceIP</span></span></a><span class="mpre"> </span><a href="#loc_39_5_39_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_5_39_17&#39;)"><span class="hl_conref"><span class="mpre">FromFallback</span></span></a><span class="mpre"> = </span><a href="#loc_105_1_105_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_1_105_22&#39;)"><span class="hl_varref"><span class="mpre">getSourceFromFallback</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; getSourceFromSocket defaultRequest</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;0.0.0.0&quot;</span></span><span class="mpre">
</span><a href="#loc_81_1_81_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_1_81_20&#39;)"><span class="mpre">getSourceFromSocket</span></a><span class="mpre"> :: </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_81_1_81_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_1_81_20&#39;)"><span class="hl_vardecl"><span class="mpre">getSourceFromSocket</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">BS.pack</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Network.Wai.Logger.IP.html#loc_44_1_44_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Logger.IP.html#loc_44_1_44_13&#39;)"><span class="hl_varref"><span class="mpre">showSockAddr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">remoteHost</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; getSourceFromHeader defaultRequest { requestHeaders = [ (&quot;X-Real-IP&quot;, &quot;127.0.0.1&quot;) ] }</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;127.0.0.1&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; getSourceFromHeader defaultRequest { requestHeaders = [ (&quot;X-Forwarded-For&quot;, &quot;127.0.0.1&quot;) ] }</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;127.0.0.1&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; getSourceFromHeader defaultRequest { requestHeaders = [ (&quot;Something&quot;, &quot;127.0.0.1&quot;) ] }</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; getSourceFromHeader defaultRequest { requestHeaders = [] }</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;&quot;</span></span><span class="mpre">
</span><a href="#loc_93_1_93_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_20&#39;)"><span class="mpre">getSourceFromHeader</span></a><span class="mpre"> :: </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_93_1_93_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_20&#39;)"><span class="hl_vardecl"><span class="mpre">getSourceFromHeader</span></span></a><span class="mpre"> = </span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="hl_varref"><span class="mpre">fromMaybe</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_117_1_117_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_10&#39;)"><span class="hl_varref"><span class="mpre">getSource</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; getSourceFromFallback defaultRequest { requestHeaders = [ (&quot;X-Real-IP&quot;, &quot;127.0.0.1&quot;) ] }</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;127.0.0.1&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; getSourceFromFallback defaultRequest { requestHeaders = [ (&quot;X-Forwarded-For&quot;, &quot;127.0.0.1&quot;) ] }</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;127.0.0.1&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; getSourceFromFallback defaultRequest { requestHeaders = [ (&quot;Something&quot;, &quot;127.0.0.1&quot;) ] }</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;0.0.0.0&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; getSourceFromFallback defaultRequest { requestHeaders = [] }</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;0.0.0.0&quot;</span></span><span class="mpre">
</span><a href="#loc_105_1_105_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_1_105_22&#39;)"><span class="mpre">getSourceFromFallback</span></a><span class="mpre"> :: </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_105_1_105_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_1_105_22&#39;)"><span class="hl_fundecl"><span class="mpre">getSourceFromFallback</span></span></a><span class="mpre"> </span><a name="loc_105_23_105_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_23_105_26&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> = </span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="hl_varref"><span class="mpre">fromMaybe</span></span></a><span class="mpre"> (</span><a href="#loc_81_1_81_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_1_81_20&#39;)"><span class="hl_varref"><span class="mpre">getSourceFromSocket</span></span></a><span class="mpre"> </span><a href="#loc_105_23_105_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_23_105_26&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_117_1_117_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_10&#39;)"><span class="hl_varref"><span class="mpre">getSource</span></span></a><span class="mpre"> </span><a href="#loc_105_23_105_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_23_105_26&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; getSource defaultRequest { requestHeaders = [ (&quot;X-Real-IP&quot;, &quot;127.0.0.1&quot;) ] }</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just &quot;127.0.0.1&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; getSource defaultRequest { requestHeaders = [ (&quot;X-Forwarded-For&quot;, &quot;127.0.0.1&quot;) ] }</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Just &quot;127.0.0.1&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; getSource defaultRequest { requestHeaders = [ (&quot;Something&quot;, &quot;127.0.0.1&quot;) ] }</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Nothing</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; getSource defaultRequest</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Nothing</span></span><span class="mpre">
</span><a href="#loc_117_1_117_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_10&#39;)"><span class="mpre">getSource</span></a><span class="mpre"> :: </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_117_1_117_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_10&#39;)"><span class="hl_fundecl"><span class="mpre">getSource</span></span></a><span class="mpre"> </span><a name="loc_117_11_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_11_117_14&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> = </span><a href="#loc_120_5_120_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_5_120_9&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre">
  where
    </span><a name="loc_119_5_119_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_5_119_10&#39;)"><span class="hl_vardecl"><span class="mpre">maddr</span></span></a><span class="mpre"> = </span><a href="Data.List.html#loc_261_1_261_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_261_1_261_5&#39;)"><span class="hl_varref"><span class="mpre">find</span></span></a><span class="mpre"> (\</span><a name="loc_119_20_119_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_20_119_21&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">fst</span></span><span class="mpre"> </span><a href="#loc_119_20_119_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_20_119_21&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`elem`</span></span><span class="mpre"> [</span><span class="hl_string"><span class="mpre">&quot;x-real-ip&quot;</span></span><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;x-forwarded-for&quot;</span></span><span class="mpre">]) </span><a href="#loc_121_5_121_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_5_121_9&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">
    </span><a name="loc_120_5_120_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_5_120_9&#39;)"><span class="hl_vardecl"><span class="mpre">addr</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">snd</span></span><span class="mpre"> </span><a href="#loc_119_5_119_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_5_119_10&#39;)"><span class="hl_varref"><span class="mpre">maddr</span></span></a><span class="mpre">
    </span><a name="loc_121_5_121_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_5_121_9&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">requestHeaders</span></span><span class="mpre"> </span><a href="#loc_117_11_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_11_117_14&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">
</span></div></body></html>