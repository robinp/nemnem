<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE BangPatterns #-}

module Network.Wai.Handler.Warp.IO where

import Blaze.ByteString.Builder.Internal.Types (</span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="mpre">Builder</span></a><span class="mpre">(..), </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_37_6_37_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_37_6_37_17&#39;)"><span class="mpre">BuildSignal</span></a><span class="mpre">(..), </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_35_6_35_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_35_6_35_14&#39;)"><span class="mpre">BufRange</span></a><span class="mpre">(..), </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_49_17_49_29" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_49_17_49_29&#39;)"><span class="mpre">runBuildStep</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_63_1_63_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_63_1_63_10&#39;)"><span class="mpre">buildStep</span></a><span class="mpre">)
import Data.ByteString.Internal (</span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="mpre">ByteString</span></a><span class="mpre">(..))
import Foreign.ForeignPtr (newForeignPtr_)
import Foreign.Ptr (plusPtr, minusPtr)
import Network.Wai.Handler.Warp.Buffer

</span><a href="#loc_12_1_12_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_1_12_12&#39;)"><span class="mpre">toBufIOWith</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Buffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">BufSize</span></span><span class="mpre"> -&gt; (</span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">ByteString</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">) -&gt; </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_12_1_12_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_1_12_12&#39;)"><span class="hl_fundecl"><span class="mpre">toBufIOWith</span></span></a><span class="mpre"> </span><a name="loc_12_13_12_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_13_12_16&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> !</span><a name="loc_12_18_12_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_18_12_22&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> </span><a name="loc_12_23_12_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_23_12_25&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Builder</span></span><span class="mpre"> </span><a name="loc_12_35_12_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_35_12_40&#39;)"><span class="hl_vardecl"><span class="mpre">build</span></span></a><span class="mpre">) = </span><a href="#loc_18_5_18_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_5_18_9&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_14_5_14_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_14_5_14_14&#39;)"><span class="hl_varref"><span class="mpre">firstStep</span></span></a><span class="mpre">
  where
    </span><a name="loc_14_5_14_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_14_5_14_14&#39;)"><span class="hl_vardecl"><span class="mpre">firstStep</span></span></a><span class="mpre"> = </span><a href="#loc_12_35_12_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_35_12_40&#39;)"><span class="hl_varref"><span class="mpre">build</span></span></a><span class="mpre"> (</span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_63_1_63_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_63_1_63_10&#39;)"><span class="hl_varref"><span class="mpre">buildStep</span></span></a><span class="mpre"> </span><a href="#loc_15_5_15_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_5_15_14&#39;)"><span class="hl_varref"><span class="mpre">finalStep</span></span></a><span class="mpre">)
    </span><a name="loc_15_5_15_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_5_15_14&#39;)"><span class="hl_fundecl"><span class="mpre">finalStep</span></span></a><span class="mpre"> (</span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_35_17_35_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_35_17_35_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_15_25_15_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_25_15_26&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> _) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_38_5_38_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_38_5_38_9&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> </span><a href="#loc_15_25_15_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_25_15_26&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    </span><a name="loc_16_5_16_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_5_16_13&#39;)"><span class="hl_vardecl"><span class="mpre">bufRange</span></span></a><span class="mpre"> = </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_35_17_35_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_35_17_35_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a href="#loc_12_13_12_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_13_12_16&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> (</span><a href="#loc_12_13_12_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_13_12_16&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_12_18_12_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_18_12_22&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">)
    </span><a name="loc_17_5_17_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_5_17_10&#39;)"><span class="hl_fundecl"><span class="mpre">runIO</span></span></a><span class="mpre"> </span><a name="loc_17_11_17_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_11_17_14&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> = </span><a href="#loc_33_1_33_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_5&#39;)"><span class="hl_varref"><span class="mpre">toBS</span></span></a><span class="mpre"> </span><a href="#loc_12_13_12_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_13_12_16&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> (</span><a href="#loc_17_11_17_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_11_17_14&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`minusPtr`</span></span><span class="mpre"> </span><a href="#loc_12_13_12_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_13_12_16&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="#loc_12_23_12_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_23_12_25&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre">
    </span><a name="loc_18_5_18_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_5_18_9&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_18_10_18_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_10_18_14&#39;)"><span class="hl_vardecl"><span class="mpre">step</span></span></a><span class="mpre"> = do
        </span><a name="loc_19_9_19_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_9_19_15&#39;)"><span class="hl_vardecl"><span class="mpre">signal</span></span></a><span class="mpre"> &lt;- </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_49_17_49_29" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_49_17_49_29&#39;)"><span class="hl_varref"><span class="mpre">runBuildStep</span></span></a><span class="mpre"> </span><a href="#loc_18_10_18_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_10_18_14&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_16_5_16_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_5_16_13&#39;)"><span class="hl_varref"><span class="mpre">bufRange</span></span></a><span class="mpre">
        case </span><a href="#loc_19_9_19_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_9_19_15&#39;)"><span class="hl_varref"><span class="mpre">signal</span></span></a><span class="mpre"> of
             </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_38_5_38_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_38_5_38_9&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> </span><a name="loc_21_19_21_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_19_21_22&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> _ -&gt; </span><a href="#loc_17_5_17_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_5_17_10&#39;)"><span class="hl_varref"><span class="mpre">runIO</span></span></a><span class="mpre"> </span><a href="#loc_21_19_21_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_19_21_22&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">
             </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_39_5_39_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_39_5_39_15&#39;)"><span class="hl_conref"><span class="mpre">BufferFull</span></span></a><span class="mpre"> </span><a name="loc_22_25_22_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_25_22_32&#39;)"><span class="hl_vardecl"><span class="mpre">minSize</span></span></a><span class="mpre"> </span><a name="loc_22_33_22_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_33_22_36&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_22_37_22_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_37_22_41&#39;)"><span class="hl_vardecl"><span class="mpre">next</span></span></a><span class="mpre">
               | </span><a href="#loc_12_18_12_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_18_12_22&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_22_25_22_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_25_22_32&#39;)"><span class="hl_varref"><span class="mpre">minSize</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;toBufIOWith: BufferFull: minSize&quot;</span></span><span class="mpre">
               | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">      -&gt; do
                   </span><a href="#loc_17_5_17_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_5_17_10&#39;)"><span class="hl_varref"><span class="mpre">runIO</span></span></a><span class="mpre"> </span><a href="#loc_22_33_22_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_33_22_36&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">
                   </span><a href="#loc_18_5_18_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_5_18_9&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_22_37_22_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_37_22_41&#39;)"><span class="hl_varref"><span class="mpre">next</span></span></a><span class="mpre">
             </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_43_5_43_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_43_5_43_21&#39;)"><span class="hl_conref"><span class="mpre">InsertByteString</span></span></a><span class="mpre"> </span><a name="loc_27_31_27_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_31_27_34&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_27_35_27_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_35_27_37&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a name="loc_27_38_27_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_38_27_42&#39;)"><span class="hl_vardecl"><span class="mpre">next</span></span></a><span class="mpre"> -&gt; do
                 </span><a href="#loc_17_5_17_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_5_17_10&#39;)"><span class="hl_varref"><span class="mpre">runIO</span></span></a><span class="mpre"> </span><a href="#loc_27_31_27_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_31_27_34&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">
                 </span><a href="#loc_12_23_12_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_23_12_25&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_27_35_27_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_35_27_37&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
                 </span><a href="#loc_18_5_18_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_5_18_9&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_27_38_27_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_38_27_42&#39;)"><span class="hl_varref"><span class="mpre">next</span></span></a><span class="mpre">

</span><a href="#loc_33_1_33_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_5&#39;)"><span class="mpre">toBS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Buffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">ByteString</span></span></a><span class="mpre">
</span><a name="loc_33_1_33_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_5&#39;)"><span class="hl_fundecl"><span class="mpre">toBS</span></span></a><span class="mpre"> </span><a name="loc_33_6_33_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_6_33_9&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_33_10_33_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_10_33_13&#39;)"><span class="hl_vardecl"><span class="mpre">siz</span></span></a><span class="mpre"> = do
    </span><a name="loc_34_5_34_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_5_34_9&#39;)"><span class="hl_vardecl"><span class="mpre">fptr</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newForeignPtr_</span></span><span class="mpre"> </span><a href="#loc_33_6_33_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_6_33_9&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">PS</span></span></a><span class="mpre"> </span><a href="#loc_34_5_34_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_5_34_9&#39;)"><span class="hl_varref"><span class="mpre">fptr</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_33_10_33_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_10_33_13&#39;)"><span class="hl_varref"><span class="mpre">siz</span></span></a><span class="mpre">
</span></div></body></html>