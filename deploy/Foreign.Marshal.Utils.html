<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Trustworthy #-}
{-# LANGUAGE NoImplicitPrelude #-}

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Foreign.Marshal.Utils</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The FFI task force 2001</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD-style (see the file libraries/base/LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  ffi@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  provisional</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Utilities for primitive marshaling</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module Foreign.Marshal.Utils (
  </span><span class="hl_comment"><span class="mpre">-- * General marshalling utilities</span></span><span class="mpre">

  </span><span class="hl_comment"><span class="mpre">-- ** Combined allocation and marshalling</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
  with,
  new,

  </span><span class="hl_comment"><span class="mpre">-- ** Marshalling of Boolean values (non-zero corresponds to &#39;True&#39;)</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
  fromBool,
  toBool,

  </span><span class="hl_comment"><span class="mpre">-- ** Marshalling of Maybe values</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
  maybeNew,
  maybeWith,
  maybePeek,

  </span><span class="hl_comment"><span class="mpre">-- ** Marshalling lists of storable objects</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
  withMany,

  </span><span class="hl_comment"><span class="mpre">-- ** Haskellish interface to memcpy and memmove</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- | (argument order: destination, source)</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
  copyBytes,
  moveBytes,
) where

import Data.Maybe
import Foreign.Ptr              ( Ptr, nullPtr )
import Foreign.Storable         ( Storable(poke) )
import Foreign.C.Types          ( CSize(..) )
import Foreign.Marshal.Alloc    ( malloc, alloca )

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 8, srcSpanEndLine = 54, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Real&quot;"><span class="mpre">GHC.Real</span></span><span class="mpre">                 ( fromIntegral )
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanStartLine = 55, srcSpanStartColumn = 8, srcSpanEndLine = 55, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;GHC.Num&quot;"><span class="mpre">GHC.Num</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanStartLine = 56, srcSpanStartColumn = 8, srcSpanEndLine = 56, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- combined allocation and marshalling</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- -----------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Allocate a block of memory and marshal a value into it</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (the combination of &#39;malloc&#39; and &#39;poke&#39;).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The size of the area allocated is determined by the &#39;Foreign.Storable.sizeOf&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- method from the instance of &#39;Storable&#39; for the appropriate type.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The memory may be deallocated using &#39;Foreign.Marshal.Alloc.free&#39; or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Foreign.Marshal.Alloc.finalizerFree&#39; when no longer required.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_70_1_70_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_1_70_4&#39;)"><span class="mpre">new</span></a><span class="mpre">     :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanStartLine = 69, srcSpanStartColumn = 12, srcSpanEndLine = 69, srcSpanEndColumn = 25}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanStartLine = 69, srcSpanStartColumn = 23, srcSpanEndLine = 69, srcSpanEndColumn = 25}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0"><span class="mpre">Storable a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_70_1_70_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_1_70_4&#39;)"><span class="hl_fundecl"><span class="mpre">new</span></span></a><span class="mpre"> </span><a name="loc_70_5_70_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_5_70_8&#39;)"><span class="hl_vardecl"><span class="mpre">val</span></span></a><span class="mpre">  = 
  do 
    </span><a name="loc_72_5_72_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_5_72_8&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">malloc</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_72_5_72_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_5_72_8&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_70_5_70_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_5_70_8&#39;)"><span class="hl_varref"><span class="mpre">val</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_72_5_72_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_5_72_8&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |@&#39;with&#39; val f@ executes the computation @f@, passing as argument</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a pointer to a temporarily allocated block of memory into which</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @val@ has been marshalled (the combination of &#39;alloca&#39; and &#39;poke&#39;).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The memory is freed when @f@ terminates (either normally or via an</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exception), so the pointer passed to @f@ must /not/ be used after this.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_84_1_84_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_5&#39;)"><span class="mpre">with</span></a><span class="mpre">       :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanStartLine = 83, srcSpanStartColumn = 15, srcSpanEndLine = 83, srcSpanEndColumn = 28}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanStartLine = 83, srcSpanStartColumn = 26, srcSpanEndLine = 83, srcSpanEndColumn = 28}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0"><span class="mpre">Storable a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
</span><a name="loc_84_1_84_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_5&#39;)"><span class="hl_fundecl"><span class="mpre">with</span></span></a><span class="mpre"> </span><a name="loc_84_6_84_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_6_84_9&#39;)"><span class="hl_vardecl"><span class="mpre">val</span></span></a><span class="mpre"> </span><a name="loc_84_10_84_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_10_84_11&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre">  =
  </span><span class="hl_varref"><span class="mpre">alloca</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_85_13_85_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_13_85_16&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_85_13_85_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_13_85_16&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_84_6_84_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_6_84_9&#39;)"><span class="hl_varref"><span class="mpre">val</span></span></a><span class="mpre">
    </span><a name="loc_87_5_87_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_8&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_84_10_84_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_10_84_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_85_13_85_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_13_85_16&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_8&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- marshalling of Boolean values (non-zero corresponds to &#39;True&#39;)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- -----------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Convert a Haskell &#39;Bool&#39; to its numeric representation</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_97_1_97_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_1_97_9&#39;)"><span class="mpre">fromBool</span></a><span class="mpre">       :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanStartLine = 96, srcSpanStartColumn = 19, srcSpanEndLine = 96, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanStartLine = 96, srcSpanStartColumn = 25, srcSpanEndLine = 96, srcSpanEndColumn = 27}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0"><span class="mpre">Num a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_97_1_97_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_1_97_9&#39;)"><span class="hl_fundecl"><span class="mpre">fromBool</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">  = </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
</span><a href="#loc_97_1_97_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_1_97_9&#39;)"><span class="hl_fundecl"><span class="mpre">fromBool</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">   = </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Convert a Boolean in numeric representation to a Haskell value</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_103_1_103_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_1_103_7&#39;)"><span class="mpre">toBool</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxTuple (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanStartLine = 102, srcSpanStartColumn = 11, srcSpanEndLine = 102, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanStartLine = 102, srcSpanStartColumn = 11, srcSpanEndLine = 102, srcSpanEndColumn = 12},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpa"><span class="mpre">(Eq a, Num a) =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_103_1_103_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_1_103_7&#39;)"><span class="hl_vardecl"><span class="mpre">toBool</span></span></a><span class="mpre">  = (</span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">-- marshalling of Maybe values</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ---------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Allocate storage and marshal a storable value wrapped into a &#39;Maybe&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * the &#39;nullPtr&#39; is used to represent &#39;Nothing&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_115_1_115_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_1_115_9&#39;)"><span class="mpre">maybeNew</span></a><span class="mpre"> :: (      </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">))
         -&gt; (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">))
</span><a name="loc_115_1_115_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_1_115_9&#39;)"><span class="hl_vardecl"><span class="mpre">maybeNew</span></span></a><span class="mpre">  = </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">nullPtr</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |Converts a @withXXX@ combinator into one marshalling a value wrapped</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- into a &#39;Maybe&#39;, using &#39;nullPtr&#39; to represent &#39;Nothing&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_122_1_122_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_1_122_10&#39;)"><span class="mpre">maybeWith</span></a><span class="mpre"> :: (      </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">) 
          -&gt; (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">)
</span><a name="loc_122_1_122_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_1_122_10&#39;)"><span class="hl_vardecl"><span class="mpre">maybeWith</span></span></a><span class="mpre">  = </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">nullPtr</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |Convert a peek combinator into a one returning &#39;Nothing&#39; if applied to a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;nullPtr&#39; </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_128_1_128_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_1_128_10&#39;)"><span class="mpre">maybePeek</span></a><span class="mpre">                           :: (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)
</span><a name="loc_128_1_128_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_1_128_10&#39;)"><span class="hl_fundecl"><span class="mpre">maybePeek</span></span></a><span class="mpre"> </span><a name="loc_128_11_128_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_11_128_15&#39;)"><span class="hl_vardecl"><span class="mpre">peek</span></span></a><span class="mpre"> </span><a name="loc_128_16_128_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_16_128_19&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> | </span><a href="#loc_128_16_128_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_16_128_19&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">nullPtr</span></span><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
                   | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">       = do </span><a name="loc_129_43_129_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_43_129_44&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_128_11_128_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_11_128_15&#39;)"><span class="hl_varref"><span class="mpre">peek</span></span></a><span class="mpre"> </span><a href="#loc_128_16_128_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_16_128_19&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_129_43_129_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_43_129_44&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">-- marshalling lists of storable objects</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- -------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Replicates a @withXXX@ combinator over a list of objects, yielding a list of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- marshalled objects</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_142_1_142_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_9&#39;)"><span class="mpre">withMany</span></a><span class="mpre"> :: (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">res</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">res</span></span><span class="mpre">)  </span><span class="hl_comment"><span class="mpre">-- withXXX combinator for one object</span></span><span class="mpre">
         -&gt; [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">]                       </span><span class="hl_comment"><span class="mpre">-- storable objects</span></span><span class="mpre">
         -&gt; ([</span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">] -&gt; </span><span class="hl_tyvar"><span class="mpre">res</span></span><span class="mpre">)              </span><span class="hl_comment"><span class="mpre">-- action on list of marshalled obj.s</span></span><span class="mpre">
         -&gt; </span><span class="hl_tyvar"><span class="mpre">res</span></span><span class="mpre">
</span><a name="loc_142_1_142_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_9&#39;)"><span class="hl_fundecl"><span class="mpre">withMany</span></span></a><span class="mpre"> _       []     </span><a name="loc_142_25_142_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_25_142_26&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_142_25_142_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_25_142_26&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> []
</span><a href="#loc_142_1_142_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_9&#39;)"><span class="hl_fundecl"><span class="mpre">withMany</span></span></a><span class="mpre"> </span><a name="loc_143_10_143_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_10_143_17&#39;)"><span class="hl_vardecl"><span class="mpre">withFoo</span></span></a><span class="mpre"> (</span><a name="loc_143_19_143_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_19_143_20&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_143_21_143_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_21_143_23&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre">) </span><a name="loc_143_25_143_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_25_143_26&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_143_10_143_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_10_143_17&#39;)"><span class="hl_varref"><span class="mpre">withFoo</span></span></a><span class="mpre"> </span><a href="#loc_143_19_143_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_19_143_20&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_143_42_143_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_42_143_44&#39;)"><span class="hl_vardecl"><span class="mpre">x&#39;</span></span></a><span class="mpre"> -&gt;
                              </span><a href="#loc_142_1_142_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_9&#39;)"><span class="hl_varref"><span class="mpre">withMany</span></span></a><span class="mpre"> </span><a href="#loc_143_10_143_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_10_143_17&#39;)"><span class="hl_varref"><span class="mpre">withFoo</span></span></a><span class="mpre"> </span><a href="#loc_143_21_143_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_21_143_23&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre"> (\</span><a name="loc_144_53_144_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_53_144_56&#39;)"><span class="hl_vardecl"><span class="mpre">xs&#39;</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_143_25_143_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_25_143_26&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> (</span><a href="#loc_143_42_143_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_42_143_44&#39;)"><span class="hl_varref"><span class="mpre">x&#39;</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_144_53_144_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_53_144_56&#39;)"><span class="hl_varref"><span class="mpre">xs&#39;</span></span></a><span class="mpre">))


</span><span class="hl_comment"><span class="mpre">-- Haskellish interface to memcpy and memmove</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Copies the given number of bytes from the second area (source) into the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- first (destination); the copied areas may /not/ overlap</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_154_1_154_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_10&#39;)"><span class="mpre">copyBytes</span></a><span class="mpre">               :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_154_1_154_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_10&#39;)"><span class="hl_fundecl"><span class="mpre">copyBytes</span></span></a><span class="mpre"> </span><a name="loc_154_11_154_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_11_154_15&#39;)"><span class="hl_vardecl"><span class="mpre">dest</span></span></a><span class="mpre"> </span><a name="loc_154_16_154_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_16_154_19&#39;)"><span class="hl_vardecl"><span class="mpre">src</span></span></a><span class="mpre"> </span><a name="loc_154_20_154_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_20_154_24&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre">  = do _ &lt;- </span><span class="hl_varref"><span class="mpre">memcpy</span></span><span class="mpre"> </span><a href="#loc_154_11_154_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_11_154_15&#39;)"><span class="hl_varref"><span class="mpre">dest</span></span></a><span class="mpre"> </span><a href="#loc_154_16_154_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_16_154_19&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_154_20_154_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_20_154_24&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">)
                              </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Copies the given number of bytes from the second area (source) into the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- first (destination); the copied areas /may/ overlap</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_161_1_161_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_1_161_10&#39;)"><span class="mpre">moveBytes</span></a><span class="mpre">               :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_161_1_161_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_1_161_10&#39;)"><span class="hl_fundecl"><span class="mpre">moveBytes</span></span></a><span class="mpre"> </span><a name="loc_161_11_161_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_11_161_15&#39;)"><span class="hl_vardecl"><span class="mpre">dest</span></span></a><span class="mpre"> </span><a name="loc_161_16_161_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_16_161_19&#39;)"><span class="hl_vardecl"><span class="mpre">src</span></span></a><span class="mpre"> </span><a name="loc_161_20_161_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_20_161_24&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre">  = do _ &lt;- </span><span class="hl_varref"><span class="mpre">memmove</span></span><span class="mpre"> </span><a href="#loc_161_11_161_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_11_161_15&#39;)"><span class="hl_varref"><span class="mpre">dest</span></span></a><span class="mpre"> </span><a href="#loc_161_16_161_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_16_161_19&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_161_20_161_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_20_161_24&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">)
                              </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- auxilliary routines</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- -------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Basic C routines needed for memory copying</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanStartLine = 170, srcSpanStartColumn = 1, srcSpanEndLine = 170, srcSpanEndColumn = 88}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanStartLine = 170, srcSpanStartColumn = 1, srcSpanEndLine = 170, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanSta"><span class="mpre">foreign import ccall unsafe &quot;string.h&quot; memcpy  :: Ptr a -&gt; Ptr a -&gt; CSize -&gt; IO (Ptr a)</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanStartLine = 171, srcSpanStartColumn = 1, srcSpanEndLine = 171, srcSpanEndColumn = 88}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanStartLine = 171, srcSpanStartColumn = 1, srcSpanEndLine = 171, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Utils.hs&quot;, srcSpanSta"><span class="mpre">foreign import ccall unsafe &quot;string.h&quot; memmove :: Ptr a -&gt; Ptr a -&gt; CSize -&gt; IO (Ptr a)</span></span><span class="mpre">

</span></div></body></html>