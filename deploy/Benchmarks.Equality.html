<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- | Compare a string with a copy of itself that is identical except</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- for the last character.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Tested in this benchmark:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Comparison of strings (Eq instance)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Benchmarks.Equality
    ( benchmark
    ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/benchmarks/haskell/Benchmarks/Equality.hs&quot;, srcSpanStartLine = 12, srcSpanStartColumn = 8, srcSpanEndLine = 12, srcSpanEndColumn = 17}, srcInfoPoints = []}) &quot;Criterion&quot;"><span class="mpre">Criterion</span></span><span class="mpre"> (Benchmark, bgroup, bench, whnf)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/benchmarks/haskell/Benchmarks/Equality.hs&quot;, srcSpanStartLine = 13, srcSpanStartColumn = 18, srcSpanEndLine = 13, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as B
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/benchmarks/haskell/Benchmarks/Equality.hs&quot;, srcSpanStartLine = 14, srcSpanStartColumn = 18, srcSpanEndLine = 14, srcSpanEndColumn = 44}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy.Char8&quot;"><span class="mpre">Data.ByteString.Lazy.Char8</span></span><span class="mpre"> as BL
import qualified Data.Text as T
import qualified Data.Text.Encoding as T
import qualified Data.Text.Lazy as TL
import qualified Data.Text.Lazy.Encoding as TL

</span><a href="#loc_21_1_21_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_1_21_10&#39;)"><span class="mpre">benchmark</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Benchmark</span></span><span class="mpre">
</span><a name="loc_21_1_21_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_1_21_10&#39;)"><span class="hl_fundecl"><span class="mpre">benchmark</span></span></a><span class="mpre"> </span><a name="loc_21_11_21_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_11_21_13&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> = do
  </span><a name="loc_22_3_22_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_3_22_4&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">B.readFile</span></span><span class="mpre"> </span><a href="#loc_21_11_21_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_11_21_13&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
  </span><a name="loc_23_3_23_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_3_23_6&#39;)"><span class="hl_vardecl"><span class="mpre">bl1</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">BL.readFile</span></span><span class="mpre"> </span><a href="#loc_21_11_21_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_11_21_13&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- A lazy bytestring is a list of chunks. When we do not explicitly create two</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- different lazy bytestrings at a different address, the bytestring library</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- will compare the chunk addresses instead of the chunk contents. This is why</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- we read the lazy bytestring twice here.</span></span><span class="mpre">
  </span><a name="loc_28_3_28_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_3_28_6&#39;)"><span class="hl_vardecl"><span class="mpre">bl2</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">BL.readFile</span></span><span class="mpre"> </span><a href="#loc_21_11_21_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_11_21_13&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
  </span><a name="loc_29_3_29_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_3_29_4&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readFile</span></span><span class="mpre"> </span><a href="#loc_21_11_21_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_11_21_13&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
  let </span><a name="loc_30_7_30_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_7_30_8&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre">  = </span><a href="Data.Text.Encoding.html#loc_307_1_307_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Encoding.html#loc_307_1_307_11&#39;)"><span class="hl_varref"><span class="mpre">T.decodeUtf8</span></span></a><span class="mpre"> </span><a href="#loc_22_3_22_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_3_22_4&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
      </span><a name="loc_31_7_31_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_7_31_9&#39;)"><span class="hl_vardecl"><span class="mpre">tl</span></span></a><span class="mpre"> = </span><a href="Data.Text.Lazy.Encoding.html#loc_127_1_127_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Lazy.Encoding.html#loc_127_1_127_11&#39;)"><span class="hl_varref"><span class="mpre">TL.decodeUtf8</span></span></a><span class="mpre"> </span><a href="#loc_23_3_23_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_3_23_6&#39;)"><span class="hl_varref"><span class="mpre">bl1</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">bgroup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Equality&quot;</span></span><span class="mpre">
    [ </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Text&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">whnf</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="Data.Text.html#loc_514_1_514_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.html#loc_514_1_514_5&#39;)"><span class="hl_varref"><span class="mpre">T.init</span></span></a><span class="mpre"> </span><a href="#loc_30_7_30_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_7_30_8&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><a href="Data.Text.html#loc_431_1_431_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.html#loc_431_1_431_5&#39;)"><span class="hl_infix"><span class="mpre">`T.snoc`</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\xfffd&#39;</span></span><span class="mpre">) </span><a href="#loc_30_7_30_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_7_30_8&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">
    , </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;LazyText&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">whnf</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="Data.Text.Lazy.html#loc_477_1_477_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Lazy.html#loc_477_1_477_5&#39;)"><span class="hl_varref"><span class="mpre">TL.init</span></span></a><span class="mpre"> </span><a href="#loc_31_7_31_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_7_31_9&#39;)"><span class="hl_varref"><span class="mpre">tl</span></span></a><span class="mpre"> </span><a href="Data.Text.Lazy.html#loc_423_1_423_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Lazy.html#loc_423_1_423_5&#39;)"><span class="hl_infix"><span class="mpre">`TL.snoc`</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\xfffd&#39;</span></span><span class="mpre">) </span><a href="#loc_31_7_31_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_7_31_9&#39;)"><span class="hl_varref"><span class="mpre">tl</span></span></a><span class="mpre">
    , </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;ByteString&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">whnf</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.init</span></span><span class="mpre"> </span><a href="#loc_22_3_22_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_3_22_4&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`B.snoc`</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\xfffd&#39;</span></span><span class="mpre">) </span><a href="#loc_22_3_22_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_3_22_4&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
    , </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;LazyByteString&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">whnf</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">BL.init</span></span><span class="mpre"> </span><a href="#loc_28_3_28_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_3_28_6&#39;)"><span class="hl_varref"><span class="mpre">bl2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`BL.snoc`</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\xfffd&#39;</span></span><span class="mpre">) </span><a href="#loc_23_3_23_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_3_23_6&#39;)"><span class="hl_varref"><span class="mpre">bl1</span></span></a><span class="mpre">
    , </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;String&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">whnf</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">init</span></span><span class="mpre"> </span><a href="#loc_29_3_29_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_3_29_4&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;\xfffd&quot;</span></span><span class="mpre">) </span><a href="#loc_29_3_29_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_3_29_4&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
    ]
</span></div></body></html>