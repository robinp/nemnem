<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE OverloadedStrings #-}
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Data.PEM.Parser</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Parse PEM content.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A PEM contains contains from one to many PEM sections.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Each section contains an optional key-value pair header</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- and a binary content encoded in base64.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
module Data.PEM.Parser
    ( pemParseBS
    , pemParseLBS
    ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pem-0.2.2/Data/PEM/Parser.hs&quot;, srcSpanStartLine = 20, srcSpanStartColumn = 8, srcSpanEndLine = 20, srcSpanEndColumn = 19}, srcInfoPoints = []}) &quot;Data.Either&quot;"><span class="mpre">Data.Either</span></span><span class="mpre"> (partitionEithers)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pem-0.2.2/Data/PEM/Parser.hs&quot;, srcSpanStartLine = 21, srcSpanStartColumn = 8, srcSpanEndLine = 21, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pem-0.2.2/Data/PEM/Parser.hs&quot;, srcSpanStartLine = 22, srcSpanStartColumn = 18, srcSpanEndLine = 22, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as BC
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pem-0.2.2/Data/PEM/Parser.hs&quot;, srcSpanStartLine = 23, srcSpanStartColumn = 18, srcSpanEndLine = 23, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pem-0.2.2/Data/PEM/Parser.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 18, srcSpanEndLine = 24, srcSpanEndColumn = 44}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy.Char8&quot;"><span class="mpre">Data.ByteString.Lazy.Char8</span></span><span class="mpre"> as LC
import qualified Data.ByteString.Base64.Lazy as Base64

import Data.PEM.Types

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pem-0.2.2/Data/PEM/Parser.hs&quot;, srcSpanStartLine = 29, srcSpanStartColumn = 1, srcSpanEndLine = 29, srcSpanEndColumn = 25}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pem-0.2.2/Data/PEM/Parser.hs&quot;, srcSpanStartLine = 29, srcSpanStartColumn = 1, srcSpanEndLine = 29, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pem-0.2.2/Data/PEM/Parser.hs&quot;, srcSpanStartLine = 29, srcSpanStartColu"><span class="mpre">type Line = L.ByteString</span></span><span class="mpre">

</span><a href="#loc_32_1_32_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_1_32_12&#39;)"><span class="mpre">parseOnePEM</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">Line</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">) (</span><a href="Data.PEM.Types.html#loc_16_6_16_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.PEM.Types.html#loc_16_6_16_9&#39;)"><span class="hl_tyconref"><span class="mpre">PEM</span></span></a><span class="mpre">, [</span><span class="hl_tyconref"><span class="mpre">Line</span></span><span class="mpre">])
</span><a name="loc_32_1_32_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_1_32_12&#39;)"><span class="hl_vardecl"><span class="mpre">parseOnePEM</span></span></a><span class="mpre"> = </span><a href="#loc_36_9_36_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_9_36_16&#39;)"><span class="hl_varref"><span class="mpre">findPem</span></span></a><span class="mpre">
  where </span><a name="loc_33_9_33_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_9_33_20&#39;)"><span class="hl_vardecl"><span class="mpre">beginMarker</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;-----BEGIN &quot;</span></span><span class="mpre">
        </span><a name="loc_34_9_34_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_9_34_18&#39;)"><span class="hl_vardecl"><span class="mpre">endMarker</span></span></a><span class="mpre">   = </span><span class="hl_string"><span class="mpre">&quot;-----END &quot;</span></span><span class="mpre">

        </span><a name="loc_36_9_36_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_9_36_16&#39;)"><span class="hl_fundecl"><span class="mpre">findPem</span></span></a><span class="mpre"> []     = </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
        </span><a href="#loc_36_9_36_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_9_36_16&#39;)"><span class="hl_fundecl"><span class="mpre">findPem</span></span></a><span class="mpre"> (</span><a name="loc_37_18_37_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_18_37_19&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_37_20_37_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_20_37_22&#39;)"><span class="hl_vardecl"><span class="mpre">ls</span></span></a><span class="mpre">) = case </span><a href="#loc_33_9_33_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_9_33_20&#39;)"><span class="hl_varref"><span class="mpre">beginMarker</span></span></a><span class="mpre"> </span><a href="#loc_72_9_72_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_18&#39;)"><span class="hl_infix"><span class="mpre">`prefixEat`</span></span></a><span class="mpre"> </span><a href="#loc_37_18_37_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_18_37_19&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> of
                             </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><a href="#loc_36_9_36_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_9_36_16&#39;)"><span class="hl_varref"><span class="mpre">findPem</span></span></a><span class="mpre"> </span><a href="#loc_37_20_37_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_20_37_22&#39;)"><span class="hl_varref"><span class="mpre">ls</span></span></a><span class="mpre">
                             </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_39_35_39_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_35_39_36&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">  -&gt; </span><a href="#loc_40_9_40_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_9_40_19&#39;)"><span class="hl_varref"><span class="mpre">getPemName</span></span></a><span class="mpre"> </span><a href="#loc_46_9_46_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_22&#39;)"><span class="hl_varref"><span class="mpre">getPemHeaders</span></span></a><span class="mpre"> </span><a href="#loc_39_35_39_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_35_39_36&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_37_20_37_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_20_37_22&#39;)"><span class="hl_varref"><span class="mpre">ls</span></span></a><span class="mpre">
        </span><a name="loc_40_9_40_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_9_40_19&#39;)"><span class="hl_fundecl"><span class="mpre">getPemName</span></span></a><span class="mpre"> </span><a name="loc_40_20_40_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_20_40_24&#39;)"><span class="hl_vardecl"><span class="mpre">next</span></span></a><span class="mpre"> </span><a name="loc_40_25_40_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_25_40_26&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> </span><a name="loc_40_27_40_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_27_40_29&#39;)"><span class="hl_vardecl"><span class="mpre">ls</span></span></a><span class="mpre"> =
            let (</span><a name="loc_41_18_41_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_18_41_22&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre">, </span><a name="loc_41_24_41_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_24_41_25&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">L.break</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x2d</span></span><span class="mpre">) </span><a href="#loc_40_25_40_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_25_40_26&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> in
            case </span><a href="#loc_41_24_41_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_24_41_25&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> of
                </span><span class="hl_string"><span class="mpre">&quot;-----&quot;</span></span><span class="mpre"> -&gt; </span><a href="#loc_40_20_40_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_20_40_24&#39;)"><span class="hl_varref"><span class="mpre">next</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">LC.unpack</span></span><span class="mpre"> </span><a href="#loc_41_18_41_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_18_41_22&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre">) </span><a href="#loc_40_27_40_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_27_40_29&#39;)"><span class="hl_varref"><span class="mpre">ls</span></span></a><span class="mpre">
                _       -&gt; </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;invalid PEM delimiter found&quot;</span></span><span class="mpre">

        </span><a name="loc_46_9_46_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_22&#39;)"><span class="hl_fundecl"><span class="mpre">getPemHeaders</span></span></a><span class="mpre"> </span><a name="loc_46_23_46_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_23_46_27&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre"> </span><a name="loc_46_28_46_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_28_46_31&#39;)"><span class="hl_vardecl"><span class="mpre">lbs</span></span></a><span class="mpre"> =
            case </span><a href="#loc_50_17_50_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_17_50_33&#39;)"><span class="hl_varref"><span class="mpre">getPemHeaderLoop</span></span></a><span class="mpre"> </span><a href="#loc_46_28_46_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_28_46_31&#39;)"><span class="hl_varref"><span class="mpre">lbs</span></span></a><span class="mpre"> of
                </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_48_22_48_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_22_48_25&#39;)"><span class="hl_vardecl"><span class="mpre">err</span></span></a><span class="mpre">           -&gt; </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_48_22_48_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_22_48_25&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre">
                </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a name="loc_49_24_49_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_24_49_28&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre">, </span><a name="loc_49_30_49_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_30_49_34&#39;)"><span class="hl_vardecl"><span class="mpre">lbs2</span></span></a><span class="mpre">) -&gt; </span><a href="#loc_54_9_54_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_9_54_22&#39;)"><span class="hl_varref"><span class="mpre">getPemContent</span></span></a><span class="mpre"> </span><a href="#loc_46_23_46_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_23_46_27&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre"> </span><a href="#loc_49_24_49_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_24_49_28&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre"> [] </span><a href="#loc_49_30_49_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_30_49_34&#39;)"><span class="hl_varref"><span class="mpre">lbs2</span></span></a><span class="mpre">
          where </span><a name="loc_50_17_50_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_17_50_33&#39;)"><span class="hl_fundecl"><span class="mpre">getPemHeaderLoop</span></span></a><span class="mpre"> []     = </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;invalid PEM: no more content in header context&quot;</span></span><span class="mpre">
                </span><a href="#loc_50_17_50_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_17_50_33&#39;)"><span class="hl_fundecl"><span class="mpre">getPemHeaderLoop</span></span></a><span class="mpre"> (</span><a name="loc_51_35_51_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_35_51_36&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_51_37_51_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_37_51_39&#39;)"><span class="hl_vardecl"><span class="mpre">rs</span></span></a><span class="mpre">) = </span><span class="hl_comment"><span class="mpre">-- FIXME doesn&#39;t properly parse headers yet</span></span><span class="mpre">
                    </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> ([], </span><a href="#loc_51_35_51_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_35_51_36&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_51_37_51_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_37_51_39&#39;)"><span class="hl_varref"><span class="mpre">rs</span></span></a><span class="mpre">)

        </span><a name="loc_54_9_54_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_9_54_22&#39;)"><span class="hl_fundecl"><span class="mpre">getPemContent</span></span></a><span class="mpre"> </span><a name="loc_54_23_54_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_23_54_27&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre"> </span><a name="loc_54_28_54_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_28_54_32&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre"> </span><a name="loc_54_33_54_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_33_54_45&#39;)"><span class="hl_vardecl"><span class="mpre">contentLines</span></span></a><span class="mpre"> </span><a name="loc_54_46_54_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_46_54_49&#39;)"><span class="hl_vardecl"><span class="mpre">lbs</span></span></a><span class="mpre"> =
            case </span><a href="#loc_54_46_54_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_46_54_49&#39;)"><span class="hl_varref"><span class="mpre">lbs</span></span></a><span class="mpre"> of
                []     -&gt; </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;invalid PEM: no end marker found&quot;</span></span><span class="mpre">
                (</span><a name="loc_57_18_57_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_18_57_19&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_57_20_57_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_20_57_22&#39;)"><span class="hl_vardecl"><span class="mpre">ls</span></span></a><span class="mpre">) -&gt; case </span><a href="#loc_34_9_34_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_9_34_18&#39;)"><span class="hl_varref"><span class="mpre">endMarker</span></span></a><span class="mpre"> </span><a href="#loc_72_9_72_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_18&#39;)"><span class="hl_infix"><span class="mpre">`prefixEat`</span></span></a><span class="mpre"> </span><a href="#loc_57_18_57_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_18_57_19&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> of
                              </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt;
                                  let </span><a name="loc_59_39_59_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_39_59_46&#39;)"><span class="hl_vardecl"><span class="mpre">content</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Base64.Lazy.html#loc_56_1_56_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Base64.Lazy.html#loc_56_1_56_14&#39;)"><span class="hl_varref"><span class="mpre">Base64.decodeLenient</span></span></a><span class="mpre"> </span><a href="#loc_57_18_57_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_18_57_19&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
                                   in </span><a href="#loc_54_9_54_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_9_54_22&#39;)"><span class="hl_varref"><span class="mpre">getPemContent</span></span></a><span class="mpre"> </span><a href="#loc_54_23_54_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_23_54_27&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre"> </span><a href="#loc_54_28_54_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_28_54_32&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre"> (</span><a href="#loc_59_39_59_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_39_59_46&#39;)"><span class="hl_varref"><span class="mpre">content</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_54_33_54_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_33_54_45&#39;)"><span class="hl_varref"><span class="mpre">contentLines</span></span></a><span class="mpre">) </span><a href="#loc_57_20_57_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_20_57_22&#39;)"><span class="hl_varref"><span class="mpre">ls</span></span></a><span class="mpre">
                              </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_61_36_61_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_36_61_37&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">  -&gt; </span><a href="#loc_40_9_40_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_9_40_19&#39;)"><span class="hl_varref"><span class="mpre">getPemName</span></span></a><span class="mpre"> (</span><a href="#loc_62_9_62_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_9_62_20&#39;)"><span class="hl_varref"><span class="mpre">finalizePem</span></span></a><span class="mpre"> </span><a href="#loc_54_23_54_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_23_54_27&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre"> </span><a href="#loc_54_28_54_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_28_54_32&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre"> </span><a href="#loc_54_33_54_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_33_54_45&#39;)"><span class="hl_varref"><span class="mpre">contentLines</span></span></a><span class="mpre">) </span><a href="#loc_61_36_61_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_36_61_37&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_57_20_57_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_20_57_22&#39;)"><span class="hl_varref"><span class="mpre">ls</span></span></a><span class="mpre">
        </span><a name="loc_62_9_62_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_9_62_20&#39;)"><span class="hl_fundecl"><span class="mpre">finalizePem</span></span></a><span class="mpre"> </span><a name="loc_62_21_62_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_21_62_25&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">hdrs</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">contentLines</span></span><span class="mpre"> </span><a name="loc_62_44_62_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_44_62_51&#39;)"><span class="hl_vardecl"><span class="mpre">nameEnd</span></span></a><span class="mpre"> </span><a name="loc_62_52_62_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_52_62_55&#39;)"><span class="hl_vardecl"><span class="mpre">lbs</span></span></a><span class="mpre">
            | </span><a href="#loc_62_44_62_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_44_62_51&#39;)"><span class="hl_varref"><span class="mpre">nameEnd</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="#loc_62_21_62_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_21_62_25&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;invalid PEM: end name doesn&#39;t match start name&quot;</span></span><span class="mpre">
            | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">       =
                let </span><a name="loc_65_21_65_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_21_65_24&#39;)"><span class="hl_vardecl"><span class="mpre">pem</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pem-0.2.2/Data/PEM/Parser.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 27, srcSpanEndLine = 67, srcSpanEndColumn = 87}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pem-0.2.2/Data/PEM/Parser.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 31, srcSpanEndLine = 65, srcSpanEndColumn = 32},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pem-0.2.2/Data/PEM/Parser.hs&quot;, srcSpanStartLine = 66, srcSpanStart"><span class="mpre">PEM { pemName    = name
                              , pemHeader  = hdrs
                              , pemContent = toSBS $ L.concat $ reverse contentLines }</span></span><span class="mpre">
                 in </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="#loc_65_21_65_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_21_65_24&#39;)"><span class="hl_varref"><span class="mpre">pem</span></span></a><span class="mpre">, </span><a href="#loc_62_52_62_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_52_62_55&#39;)"><span class="hl_varref"><span class="mpre">lbs</span></span></a><span class="mpre">)

        </span><span class="hl_vardecl"><span class="mpre">toSBS</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">BC.concat</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.toChunks</span></span><span class="mpre">

        </span><a name="loc_72_9_72_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_18&#39;)"><span class="hl_fundecl"><span class="mpre">prefixEat</span></span></a><span class="mpre"> </span><a name="loc_72_19_72_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_19_72_25&#39;)"><span class="hl_vardecl"><span class="mpre">prefix</span></span></a><span class="mpre"> </span><a name="loc_72_26_72_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_26_72_27&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> =
            let (</span><a name="loc_73_18_73_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_18_73_20&#39;)"><span class="hl_vardecl"><span class="mpre">x1</span></span></a><span class="mpre">, </span><a name="loc_73_22_73_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_22_73_24&#39;)"><span class="hl_vardecl"><span class="mpre">x2</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">L.splitAt</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">L.length</span></span><span class="mpre"> </span><a href="#loc_72_19_72_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_19_72_25&#39;)"><span class="hl_varref"><span class="mpre">prefix</span></span></a><span class="mpre">) </span><a href="#loc_72_26_72_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_26_72_27&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
             in if </span><a href="#loc_73_18_73_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_18_73_20&#39;)"><span class="hl_varref"><span class="mpre">x1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_72_19_72_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_19_72_25&#39;)"><span class="hl_varref"><span class="mpre">prefix</span></span></a><span class="mpre"> then </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_73_22_73_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_22_73_24&#39;)"><span class="hl_varref"><span class="mpre">x2</span></span></a><span class="mpre"> else </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | parser to get PEM sections</span></span><span class="mpre">
</span><a href="#loc_78_1_78_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_9&#39;)"><span class="mpre">pemParse</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">Line</span></span><span class="mpre">] -&gt; [</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> </span><a href="Data.PEM.Types.html#loc_16_6_16_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.PEM.Types.html#loc_16_6_16_9&#39;)"><span class="hl_tyconref"><span class="mpre">PEM</span></span></a><span class="mpre">]
</span><a name="loc_78_1_78_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_9&#39;)"><span class="hl_fundecl"><span class="mpre">pemParse</span></span></a><span class="mpre"> </span><a name="loc_78_10_78_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_10_78_11&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_78_10_78_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_10_78_11&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">    = []
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = case </span><a href="#loc_32_1_32_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_1_32_12&#39;)"><span class="hl_varref"><span class="mpre">parseOnePEM</span></span></a><span class="mpre"> </span><a href="#loc_78_10_78_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_10_78_11&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> of
                        </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">         -&gt; []
                        </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_82_36_82_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_36_82_39&#39;)"><span class="hl_vardecl"><span class="mpre">err</span></span></a><span class="mpre">)      -&gt; [</span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_82_36_82_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_36_82_39&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre">]
                        </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a name="loc_83_32_83_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_32_83_33&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre">, </span><a name="loc_83_35_83_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_35_83_44&#39;)"><span class="hl_vardecl"><span class="mpre">remaining</span></span></a><span class="mpre">) -&gt; </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a href="#loc_83_32_83_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_32_83_33&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_78_1_78_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_9&#39;)"><span class="hl_varref"><span class="mpre">pemParse</span></span></a><span class="mpre"> </span><a href="#loc_83_35_83_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_35_83_44&#39;)"><span class="hl_varref"><span class="mpre">remaining</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | parse a PEM content using a strict bytestring</span></span><span class="mpre">
</span><a href="#loc_87_1_87_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_1_87_11&#39;)"><span class="mpre">pemParseBS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> [</span><a href="Data.PEM.Types.html#loc_16_6_16_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.PEM.Types.html#loc_16_6_16_9&#39;)"><span class="hl_tyconref"><span class="mpre">PEM</span></span></a><span class="mpre">]
</span><a name="loc_87_1_87_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_1_87_11&#39;)"><span class="hl_fundecl"><span class="mpre">pemParseBS</span></span></a><span class="mpre"> </span><a name="loc_87_12_87_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_12_87_13&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = </span><a href="#loc_91_1_91_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_1_91_12&#39;)"><span class="hl_varref"><span class="mpre">pemParseLBS</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.fromChunks</span></span><span class="mpre"> [</span><a href="#loc_87_12_87_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_12_87_13&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">]

</span><span class="hl_comment"><span class="mpre">-- | parse a PEM content using a dynamic bytestring</span></span><span class="mpre">
</span><a href="#loc_91_1_91_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_1_91_12&#39;)"><span class="mpre">pemParseLBS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> [</span><a href="Data.PEM.Types.html#loc_16_6_16_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.PEM.Types.html#loc_16_6_16_9&#39;)"><span class="hl_tyconref"><span class="mpre">PEM</span></span></a><span class="mpre">]
</span><a name="loc_91_1_91_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_1_91_12&#39;)"><span class="hl_fundecl"><span class="mpre">pemParseLBS</span></span></a><span class="mpre"> </span><a name="loc_91_13_91_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_13_91_15&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = case </span><span class="hl_varref"><span class="mpre">partitionEithers</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_78_1_78_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_9&#39;)"><span class="hl_varref"><span class="mpre">pemParse</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_94_9_94_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_9_94_13&#39;)"><span class="hl_varref"><span class="mpre">unCR</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">LC.lines</span></span><span class="mpre"> </span><a href="#loc_91_13_91_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_13_91_15&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> of
                    (</span><a name="loc_92_22_92_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_22_92_23&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_,_   ) -&gt; </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_92_22_92_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_22_92_23&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
                    ([] ,</span><a name="loc_93_26_93_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_26_93_30&#39;)"><span class="hl_vardecl"><span class="mpre">pems</span></span></a><span class="mpre">) -&gt; </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a href="#loc_93_26_93_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_26_93_30&#39;)"><span class="hl_varref"><span class="mpre">pems</span></span></a><span class="mpre">
  where </span><a name="loc_94_9_94_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_9_94_13&#39;)"><span class="hl_fundecl"><span class="mpre">unCR</span></span></a><span class="mpre"> </span><a name="loc_94_14_94_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_14_94_15&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> | </span><span class="hl_varref"><span class="mpre">L.length</span></span><span class="mpre"> </span><a href="#loc_94_14_94_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_14_94_15&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.last</span></span><span class="mpre"> </span><a href="#loc_94_14_94_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_14_94_15&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_96_9_96_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_9_96_11&#39;)"><span class="hl_varref"><span class="mpre">cr</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">L.init</span></span><span class="mpre"> </span><a href="#loc_94_14_94_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_14_94_15&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
               | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">                        = </span><a href="#loc_94_14_94_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_14_94_15&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
        </span><a name="loc_96_9_96_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_9_96_11&#39;)"><span class="hl_vardecl"><span class="mpre">cr</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromEnum</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\r&#39;</span></span><span class="mpre">
</span></div></body></html>