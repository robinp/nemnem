<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Trustworthy #-}

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Control.Monad.Fix</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) Andy Gill 2001,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--                (c) Oregon Graduate Institute of Science and Technology, 2002</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD-style (see the file libraries/base/LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  libraries@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Monadic fixpoints.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- For a detailed discussion, see Levent Erkok&#39;s thesis,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /Value Recursion in Monadic Computations/, Oregon Graduate Institute, 2002.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module Control.Monad.Fix (
        MonadFix(mfix),
        fix
  ) where

import Prelude
import System.IO
import Data.Function (</span><a href="Data.Function.html#loc_32_1_32_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Function.html#loc_32_1_32_4&#39;)"><span class="mpre">fix</span></a><span class="mpre">)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Control/Monad/Fix.hs&quot;, srcSpanStartLine = 28, srcSpanStartColumn = 8, srcSpanEndLine = 28, srcSpanEndColumn = 14}, srcInfoPoints = []}) &quot;GHC.ST&quot;"><span class="mpre">GHC.ST</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Monads having fixed points with a \&#39;knot-tying\&#39; semantics.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Instances of &#39;MonadFix&#39; should satisfy the following laws:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [/purity/]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      @&#39;mfix&#39; (&#39;return&#39; . h)  =  &#39;return&#39; (&#39;fix&#39; h)@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [/left shrinking/ (or /tightening/)]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      @&#39;mfix&#39; (\\x -&gt; a &gt;&gt;= \\y -&gt; f x y)  =  a &gt;&gt;= \\y -&gt; &#39;mfix&#39; (\\x -&gt; f x y)@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [/sliding/]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      @&#39;mfix&#39; (&#39;Control.Monad.liftM&#39; h . f)  =  &#39;Control.Monad.liftM&#39; h (&#39;mfix&#39; (f . h))@,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      for strict @h@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [/nesting/]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      @&#39;mfix&#39; (\\x -&gt; &#39;mfix&#39; (\\y -&gt; f x y))  =  &#39;mfix&#39; (\\x -&gt; f x x)@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This class is used in the translation of the recursive @do@ notation</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- supported by GHC and Hugs.</span></span><span class="mpre">
class </span><span class="warning" data-warning="ClassDecl ContextCxParen (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Control/Monad/Fix.hs&quot;, srcSpanStartLine = 48, srcSpanStartColumn = 7, srcSpanEndLine = 48, srcSpanEndColumn = 19}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Control/Monad/Fix.hs&quot;, srcSpanStartLine = 48, srcSpanStartColumn = 7, srcSpanEndLine = 48, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Control/Monad/Fix.hs&quot;, srcSpanStartLine = 48, sr"><span class="mpre">(Monad m) =&gt;</span></span><span class="mpre"> </span><a name="loc_48_20_48_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_20_48_28&#39;)"><span class="hl_classdecl"><span class="mpre">MonadFix</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> where
        </span><span class="hl_comment"><span class="mpre">-- | The fixed point of a monadic computation.</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- @&#39;mfix&#39; f@ executes the action @f@ only once, with the eventual</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- output fed back as the input.  Hence @f@ should not be strict,</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- for then @&#39;mfix&#39; f@ would diverge.</span></span><span class="mpre">
        </span><a name="loc_53_9_53_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_13&#39;)"><span class="mpre">mfix</span></a><span class="mpre"> :: (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Instances of MonadFix for Prelude monads</span></span><span class="mpre">

instance </span><a href="#loc_48_20_48_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_20_48_28&#39;)"><span class="hl_classref"><span class="mpre">MonadFix</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> where
    </span><a href="#loc_53_9_53_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_13&#39;)"><span class="hl_fundecl"><span class="mpre">mfix</span></span></a><span class="mpre"> </span><a name="loc_58_10_58_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_10_58_11&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = let </span><a name="loc_58_18_58_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_18_58_19&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = </span><a href="#loc_58_10_58_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_10_58_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> (</span><a href="#loc_59_20_59_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_20_59_26&#39;)"><span class="hl_varref"><span class="mpre">unJust</span></span></a><span class="mpre"> </span><a href="#loc_58_18_58_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_18_58_19&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">) in </span><a href="#loc_58_18_58_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_18_58_19&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
             where </span><a name="loc_59_20_59_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_20_59_26&#39;)"><span class="hl_fundecl"><span class="mpre">unJust</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_59_33_59_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_33_59_34&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">) = </span><a href="#loc_59_33_59_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_33_59_34&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
                   </span><a href="#loc_59_20_59_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_20_59_26&#39;)"><span class="hl_fundecl"><span class="mpre">unJust</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;mfix Maybe: Nothing&quot;</span></span><span class="mpre">

instance </span><a href="#loc_48_20_48_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_20_48_28&#39;)"><span class="hl_classref"><span class="mpre">MonadFix</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">[]</span></span><span class="mpre"> where
    </span><a href="#loc_53_9_53_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_13&#39;)"><span class="hl_fundecl"><span class="mpre">mfix</span></span></a><span class="mpre"> </span><a name="loc_63_10_63_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_10_63_11&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = case </span><a href="Data.Function.html#loc_32_1_32_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Function.html#loc_32_1_32_4&#39;)"><span class="hl_varref"><span class="mpre">fix</span></span></a><span class="mpre"> (</span><a href="#loc_63_10_63_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_10_63_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">head</span></span><span class="mpre">) of
               []    -&gt; []
               (</span><a name="loc_65_17_65_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_17_65_18&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_) -&gt; </span><a href="#loc_65_17_65_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_17_65_18&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_53_9_53_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_13&#39;)"><span class="hl_varref"><span class="mpre">mfix</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">tail</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_63_10_63_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_10_63_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">)

instance </span><a href="#loc_48_20_48_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_20_48_28&#39;)"><span class="hl_classref"><span class="mpre">MonadFix</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> where
    </span><a href="#loc_53_9_53_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_13&#39;)"><span class="hl_vardecl"><span class="mpre">mfix</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fixIO</span></span><span class="mpre"> 

instance </span><a href="#loc_48_20_48_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_20_48_28&#39;)"><span class="hl_classref"><span class="mpre">MonadFix</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">(-&gt;)</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">) where
    </span><a href="#loc_53_9_53_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_13&#39;)"><span class="hl_fundecl"><span class="mpre">mfix</span></span></a><span class="mpre"> </span><a name="loc_71_10_71_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_10_71_11&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = \ </span><a name="loc_71_16_71_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_16_71_17&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> -&gt; let </span><a name="loc_71_25_71_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_25_71_26&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = </span><a href="#loc_71_10_71_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_10_71_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_71_25_71_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_25_71_26&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><a href="#loc_71_16_71_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_16_71_17&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> in </span><a href="#loc_71_25_71_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_25_71_26&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">

instance </span><a href="#loc_48_20_48_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_20_48_28&#39;)"><span class="hl_classref"><span class="mpre">MonadFix</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre">) where
    </span><a href="#loc_53_9_53_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_13&#39;)"><span class="hl_fundecl"><span class="mpre">mfix</span></span></a><span class="mpre"> </span><a name="loc_74_10_74_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_10_74_11&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = let </span><a name="loc_74_18_74_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_18_74_19&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = </span><a href="#loc_74_10_74_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_10_74_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> (</span><a href="#loc_75_20_75_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_20_75_27&#39;)"><span class="hl_varref"><span class="mpre">unRight</span></span></a><span class="mpre"> </span><a href="#loc_74_18_74_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_18_74_19&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">) in </span><a href="#loc_74_18_74_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_18_74_19&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
             where </span><a name="loc_75_20_75_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_20_75_27&#39;)"><span class="hl_fundecl"><span class="mpre">unRight</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a name="loc_75_35_75_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_35_75_36&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">) = </span><a href="#loc_75_35_75_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_35_75_36&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
                   </span><a href="#loc_75_20_75_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_20_75_27&#39;)"><span class="hl_fundecl"><span class="mpre">unRight</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre">  _) = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;mfix Either: Left&quot;</span></span><span class="mpre">

instance </span><a href="#loc_48_20_48_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_20_48_28&#39;)"><span class="hl_classref"><span class="mpre">MonadFix</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">ST</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre">) where
        </span><a href="#loc_53_9_53_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_13&#39;)"><span class="hl_vardecl"><span class="mpre">mfix</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fixST</span></span><span class="mpre">
</span></div></body></html>