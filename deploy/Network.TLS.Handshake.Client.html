<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE DeriveDataTypeable, OverloadedStrings #-}
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Network.TLS.Handshake.Client</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Network.TLS.Handshake.Client
    ( handshakeClient
    , handshakeClientWith
    ) where

import Network.TLS.Crypto
import Network.TLS.Context.Internal
import Network.TLS.Parameters
import Network.TLS.Struct
import Network.TLS.Cipher
import Network.TLS.Compression
import Network.TLS.Packet
import Network.TLS.Extension
import Network.TLS.IO
import Network.TLS.State hiding (</span><a href="Network.TLS.State.html#loc_186_1_186_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_186_1_186_22&#39;)"><span class="mpre">getNegotiatedProtocol</span></a><span class="mpre">)
import Network.TLS.Measurement
import Network.TLS.Wire (</span><a href="Network.TLS.Wire.html#loc_162_1_162_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Wire.html#loc_162_1_162_13&#39;)"><span class="mpre">encodeWord16</span></a><span class="mpre">)
import Network.TLS.Util (</span><a href="Network.TLS.Util.html#loc_71_1_71_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_71_1_71_8&#39;)"><span class="mpre">bytesEq</span></a><span class="mpre">, </span><a href="Network.TLS.Util.html#loc_81_1_81_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_81_1_81_15&#39;)"><span class="mpre">catchException</span></a><span class="mpre">)
import Network.TLS.Types
import Network.TLS.X509
import Data.Maybe
import Data.List (</span><a href="Data.List.html#loc_261_1_261_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_261_1_261_5&#39;)"><span class="mpre">find</span></a><span class="mpre">)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/Client.hs&quot;, srcSpanStartLine = 31, srcSpanStartColumn = 18, srcSpanEndLine = 31, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/Client.hs&quot;, srcSpanStartLine = 32, srcSpanStartColumn = 8, srcSpanEndLine = 32, srcSpanEndColumn = 29}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> ()

import Control.Applicative (</span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="mpre">(&lt;$&gt;)</span></a><span class="mpre">, </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="mpre">(&lt;*&gt;)</span></a><span class="mpre">)
import Control.Monad.State
import Control.Monad.Error
import Control.Exception (SomeException)

import Network.TLS.Handshake.Common
import Network.TLS.Handshake.Process
import Network.TLS.Handshake.Certificate
import Network.TLS.Handshake.Signature
import Network.TLS.Handshake.Key
import Network.TLS.Handshake.State

</span><a href="#loc_47_1_47_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_1_47_20&#39;)"><span class="mpre">handshakeClientWith</span></a><span class="mpre"> :: </span><a href="Network.TLS.Parameters.html#loc_43_6_43_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_43_6_43_18&#39;)"><span class="hl_tyconref"><span class="mpre">ClientParams</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Struct.html#loc_252_6_252_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_252_6_252_15&#39;)"><span class="hl_tyconref"><span class="mpre">Handshake</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_47_1_47_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_1_47_20&#39;)"><span class="hl_fundecl"><span class="mpre">handshakeClientWith</span></span></a><span class="mpre"> </span><a name="loc_47_21_47_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_21_47_28&#39;)"><span class="hl_vardecl"><span class="mpre">cparams</span></span></a><span class="mpre"> </span><a name="loc_47_29_47_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_29_47_32&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_256_7_256_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_256_7_256_19&#39;)"><span class="hl_conref"><span class="mpre">HelloRequest</span></span></a><span class="mpre"> = </span><a href="#loc_53_1_53_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_16&#39;)"><span class="hl_varref"><span class="mpre">handshakeClient</span></span></a><span class="mpre"> </span><a href="#loc_47_21_47_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_21_47_28&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre"> </span><a href="#loc_47_29_47_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_29_47_32&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
</span><a href="#loc_47_1_47_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_1_47_20&#39;)"><span class="hl_fundecl"><span class="mpre">handshakeClientWith</span></span></a><span class="mpre"> _       _   _            = </span><a href="Network.TLS.Context.Internal.html#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;unexpected handshake message received in handshakeClientWith&quot;</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_188_7_188_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_188_7_188_23&#39;)"><span class="hl_conref"><span class="mpre">HandshakeFailure</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- client part of handshake. send a bunch of handshake of client</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- values intertwined with response from the server.</span></span><span class="mpre">
</span><a href="#loc_53_1_53_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_16&#39;)"><span class="mpre">handshakeClient</span></a><span class="mpre"> :: </span><a href="Network.TLS.Parameters.html#loc_43_6_43_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_43_6_43_18&#39;)"><span class="hl_tyconref"><span class="mpre">ClientParams</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_53_1_53_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_16&#39;)"><span class="hl_fundecl"><span class="mpre">handshakeClient</span></span></a><span class="mpre"> </span><a name="loc_53_17_53_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_17_53_24&#39;)"><span class="hl_vardecl"><span class="mpre">cparams</span></span></a><span class="mpre"> </span><a name="loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> = do
    </span><a href="Network.TLS.Context.Internal.html#loc_111_1_111_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_111_1_111_14&#39;)"><span class="hl_varref"><span class="mpre">updateMeasure</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.Measurement.html#loc_45_1_45_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Measurement.html#loc_45_1_45_22&#39;)"><span class="hl_varref"><span class="mpre">incrementNbHandshakes</span></span></a><span class="mpre">
    </span><a name="loc_55_5_55_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_5_55_19&#39;)"><span class="hl_vardecl"><span class="mpre">sentExtensions</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_81_9_81_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_9_81_24&#39;)"><span class="hl_varref"><span class="mpre">sendClientHello</span></span></a><span class="mpre">
    </span><a href="#loc_106_9_106_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_9_106_24&#39;)"><span class="hl_varref"><span class="mpre">recvServerHello</span></span></a><span class="mpre"> </span><a href="#loc_55_5_55_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_5_55_19&#39;)"><span class="hl_varref"><span class="mpre">sentExtensions</span></span></a><span class="mpre">
    </span><a name="loc_57_5_57_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_5_57_20&#39;)"><span class="hl_vardecl"><span class="mpre">sessionResuming</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_153_1_153_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_153_1_153_18&#39;)"><span class="hl_varref"><span class="mpre">isSessionResuming</span></span></a><span class="mpre">
    if </span><a href="#loc_57_5_57_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_5_57_20&#39;)"><span class="hl_varref"><span class="mpre">sessionResuming</span></span></a><span class="mpre">
        then </span><a href="Network.TLS.Handshake.Common.html#loc_74_1_74_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_74_1_74_26&#39;)"><span class="hl_varref"><span class="mpre">sendChangeCipherAndFinish</span></span></a><span class="mpre"> </span><a href="#loc_94_9_94_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_9_94_21&#39;)"><span class="hl_varref"><span class="mpre">sendMaybeNPN</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_13_44_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_13_44_23&#39;)"><span class="hl_conref"><span class="mpre">ClientRole</span></span></a><span class="mpre">
        else do </span><a href="#loc_126_1_126_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_15&#39;)"><span class="hl_varref"><span class="mpre">sendClientData</span></span></a><span class="mpre"> </span><a href="#loc_53_17_53_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_17_53_24&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
                </span><a href="Network.TLS.Handshake.Common.html#loc_74_1_74_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_74_1_74_26&#39;)"><span class="hl_varref"><span class="mpre">sendChangeCipherAndFinish</span></span></a><span class="mpre"> </span><a href="#loc_94_9_94_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_9_94_21&#39;)"><span class="hl_varref"><span class="mpre">sendMaybeNPN</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_13_44_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_13_44_23&#39;)"><span class="hl_conref"><span class="mpre">ClientRole</span></span></a><span class="mpre">
                </span><a href="Network.TLS.Handshake.Common.html#loc_83_1_83_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_83_1_83_26&#39;)"><span class="hl_varref"><span class="mpre">recvChangeCipherAndFinish</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
    </span><a href="Network.TLS.Handshake.Common.html#loc_55_1_55_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_55_1_55_19&#39;)"><span class="hl_varref"><span class="mpre">handshakeTerminate</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
  where </span><a name="loc_64_9_64_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_16&#39;)"><span class="hl_vardecl"><span class="mpre">ciphers</span></span></a><span class="mpre">      = </span><a href="Network.TLS.Context.Internal.html#loc_89_7_89_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_89_7_89_17&#39;)"><span class="hl_varref"><span class="mpre">ctxCiphers</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
        </span><a name="loc_65_9_65_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_9_65_21&#39;)"><span class="hl_vardecl"><span class="mpre">compressions</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Parameters.html#loc_117_7_117_28" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_117_7_117_28&#39;)"><span class="hl_varref"><span class="mpre">supportedCompressions</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_87_7_87_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_87_7_87_19&#39;)"><span class="hl_varref"><span class="mpre">ctxSupported</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
        </span><a name="loc_66_9_66_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_9_66_22&#39;)"><span class="hl_vardecl"><span class="mpre">getExtensions</span></span></a><span class="mpre"> = </span><a href="Control.Monad.html#loc_98_1_98_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_98_1_98_9&#39;)"><span class="hl_varref"><span class="mpre">sequence</span></span></a><span class="mpre"> [</span><a href="#loc_78_9_78_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_9_78_21&#39;)"><span class="hl_varref"><span class="mpre">sniExtension</span></span></a><span class="mpre">,</span><a href="#loc_71_9_71_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_9_71_20&#39;)"><span class="hl_varref"><span class="mpre">secureReneg</span></span></a><span class="mpre">,</span><a href="#loc_75_9_75_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_9_75_21&#39;)"><span class="hl_varref"><span class="mpre">npnExtention</span></span></a><span class="mpre">] </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_115_1_115_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_115_1_115_10&#39;)"><span class="hl_varref"><span class="mpre">catMaybes</span></span></a><span class="mpre">

        </span><a href="#loc_69_9_69_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_9_69_23&#39;)"><span class="mpre">toExtensionRaw</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/Client.hs&quot;, srcSpanStartLine = 68, srcSpanStartColumn = 27, srcSpanEndLine = 68, srcSpanEndColumn = 41}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake/Client.hs&quot;, srcSpanStartLine = 68, srcSpanStartColumn = 39, srcSpanEndLine = 68, srcSpanEndColumn = 41}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tl"><span class="mpre">Extension e =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ExtensionRaw</span></span><span class="mpre">
        </span><a name="loc_69_9_69_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_9_69_23&#39;)"><span class="hl_fundecl"><span class="mpre">toExtensionRaw</span></span></a><span class="mpre"> </span><a name="loc_69_24_69_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_24_69_27&#39;)"><span class="hl_vardecl"><span class="mpre">ext</span></span></a><span class="mpre"> = (</span><a href="Network.TLS.Extension.html#loc_58_5_58_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Extension.html#loc_58_5_58_16&#39;)"><span class="hl_varref"><span class="mpre">extensionID</span></span></a><span class="mpre"> </span><a href="#loc_69_24_69_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_24_69_27&#39;)"><span class="hl_varref"><span class="mpre">ext</span></span></a><span class="mpre">, </span><a href="Network.TLS.Extension.html#loc_60_5_60_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Extension.html#loc_60_5_60_20&#39;)"><span class="hl_varref"><span class="mpre">extensionEncode</span></span></a><span class="mpre"> </span><a href="#loc_69_24_69_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_24_69_27&#39;)"><span class="hl_varref"><span class="mpre">ext</span></span></a><span class="mpre">)

        </span><a name="loc_71_9_71_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_9_71_20&#39;)"><span class="hl_vardecl"><span class="mpre">secureReneg</span></span></a><span class="mpre">  =
                if </span><a href="Network.TLS.Parameters.html#loc_122_7_122_35" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_122_7_122_35&#39;)"><span class="hl_varref"><span class="mpre">supportedSecureRenegotiation</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_87_7_87_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_87_7_87_19&#39;)"><span class="hl_varref"><span class="mpre">ctxSupported</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
                then </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="Network.TLS.State.html#loc_201_1_201_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_201_1_201_16&#39;)"><span class="hl_varref"><span class="mpre">getVerifiedData</span></span></a><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_13_44_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_13_44_23&#39;)"><span class="hl_conref"><span class="mpre">ClientRole</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> \</span><a name="loc_73_72_73_74" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_72_73_74&#39;)"><span class="hl_vardecl"><span class="mpre">vd</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_69_9_69_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_9_69_23&#39;)"><span class="hl_varref"><span class="mpre">toExtensionRaw</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Extension.html#loc_106_28_106_47" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Extension.html#loc_106_28_106_47&#39;)"><span class="hl_conref"><span class="mpre">SecureRenegotiation</span></span></a><span class="mpre"> </span><a href="#loc_73_72_73_74" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_72_73_74&#39;)"><span class="hl_varref"><span class="mpre">vd</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
                else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
        </span><a name="loc_75_9_75_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_9_75_21&#39;)"><span class="hl_vardecl"><span class="mpre">npnExtention</span></span></a><span class="mpre"> = if </span><a href="Data.Maybe.html#loc_80_1_80_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_80_1_80_7&#39;)"><span class="hl_varref"><span class="mpre">isJust</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Parameters.html#loc_186_7_186_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_186_7_186_25&#39;)"><span class="hl_varref"><span class="mpre">onNPNServerSuggest</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Parameters.html#loc_61_7_61_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_61_7_61_18&#39;)"><span class="hl_varref"><span class="mpre">clientHooks</span></span></a><span class="mpre"> </span><a href="#loc_53_17_53_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_17_53_24&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre">
                         then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_69_9_69_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_9_69_23&#39;)"><span class="hl_varref"><span class="mpre">toExtensionRaw</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Extension.html#loc_121_32_121_55" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Extension.html#loc_121_32_121_55&#39;)"><span class="hl_conref"><span class="mpre">NextProtocolNegotiation</span></span></a><span class="mpre"> []
                         else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
        </span><a name="loc_78_9_78_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_9_78_21&#39;)"><span class="hl_vardecl"><span class="mpre">sniExtension</span></span></a><span class="mpre"> = if </span><a href="Network.TLS.Parameters.html#loc_57_7_57_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_57_7_57_36&#39;)"><span class="hl_varref"><span class="mpre">clientUseServerNameIndication</span></span></a><span class="mpre"> </span><a href="#loc_53_17_53_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_17_53_24&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre">
                         then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_69_9_69_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_9_69_23&#39;)"><span class="hl_varref"><span class="mpre">toExtensionRaw</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Extension.html#loc_65_19_65_29" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Extension.html#loc_65_19_65_29&#39;)"><span class="hl_conref"><span class="mpre">ServerName</span></span></a><span class="mpre"> [</span><a href="Network.TLS.Extension.html#loc_68_23_68_41" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Extension.html#loc_68_23_68_41&#39;)"><span class="hl_conref"><span class="mpre">ServerNameHostName</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fst</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Parameters.html#loc_53_7_53_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_53_7_53_33&#39;)"><span class="hl_varref"><span class="mpre">clientServerIdentification</span></span></a><span class="mpre"> </span><a href="#loc_53_17_53_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_17_53_24&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre">]
                         else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
        </span><a name="loc_81_9_81_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_9_81_24&#39;)"><span class="hl_vardecl"><span class="mpre">sendClientHello</span></span></a><span class="mpre"> = do
            </span><a name="loc_82_13_82_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_13_82_18&#39;)"><span class="hl_vardecl"><span class="mpre">crand</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_211_1_211_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_211_1_211_12&#39;)"><span class="hl_varref"><span class="mpre">getStateRNG</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">32</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_160_24_160_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_160_24_160_36&#39;)"><span class="hl_conref"><span class="mpre">ClientRandom</span></span></a><span class="mpre">
            let </span><a name="loc_83_17_83_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_17_83_30&#39;)"><span class="hl_vardecl"><span class="mpre">clientSession</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Struct.html#loc_161_19_161_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_161_19_161_26&#39;)"><span class="hl_conref"><span class="mpre">Session</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fst</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Parameters.html#loc_59_7_59_30" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_59_7_59_30&#39;)"><span class="hl_varref"><span class="mpre">clientWantSessionResume</span></span></a><span class="mpre"> </span><a href="#loc_53_17_53_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_17_53_24&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre">
                </span><a name="loc_84_17_84_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_17_84_27&#39;)"><span class="hl_vardecl"><span class="mpre">highestVer</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">maximum</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Parameters.html#loc_113_7_113_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_113_7_113_24&#39;)"><span class="hl_varref"><span class="mpre">supportedVersions</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_87_7_87_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_87_7_87_19&#39;)"><span class="hl_varref"><span class="mpre">ctxSupported</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
            </span><a name="loc_85_13_85_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_13_85_23&#39;)"><span class="hl_vardecl"><span class="mpre">extensions</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_66_9_66_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_9_66_22&#39;)"><span class="hl_varref"><span class="mpre">getExtensions</span></span></a><span class="mpre">
            </span><a href="Network.TLS.Handshake.Process.html#loc_104_1_104_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Process.html#loc_104_1_104_15&#39;)"><span class="hl_varref"><span class="mpre">startHandshake</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_84_17_84_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_17_84_27&#39;)"><span class="hl_varref"><span class="mpre">highestVer</span></span></a><span class="mpre"> </span><a href="#loc_82_13_82_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_13_82_18&#39;)"><span class="hl_varref"><span class="mpre">crand</span></span></a><span class="mpre">
            </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.State.html#loc_159_1_159_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_159_1_159_18&#39;)"><span class="hl_varref"><span class="mpre">setVersionIfUnset</span></span></a><span class="mpre"> </span><a href="#loc_84_17_84_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_17_84_27&#39;)"><span class="hl_varref"><span class="mpre">highestVer</span></span></a><span class="mpre">
            </span><a href="Network.TLS.IO.html#loc_106_1_106_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.IO.html#loc_106_1_106_11&#39;)"><span class="hl_varref"><span class="mpre">sendPacket</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_151_7_151_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_151_7_151_16&#39;)"><span class="hl_conref"><span class="mpre">Handshake</span></span></a><span class="mpre">
                [ </span><a href="Network.TLS.Struct.html#loc_253_7_253_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_253_7_253_18&#39;)"><span class="hl_conref"><span class="mpre">ClientHello</span></span></a><span class="mpre"> </span><a href="#loc_84_17_84_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_17_84_27&#39;)"><span class="hl_varref"><span class="mpre">highestVer</span></span></a><span class="mpre"> </span><a href="#loc_82_13_82_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_13_82_18&#39;)"><span class="hl_varref"><span class="mpre">crand</span></span></a><span class="mpre"> </span><a href="#loc_83_17_83_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_17_83_30&#39;)"><span class="hl_varref"><span class="mpre">clientSession</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="Network.TLS.Cipher.html#loc_83_7_83_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_83_7_83_15&#39;)"><span class="hl_varref"><span class="mpre">cipherID</span></span></a><span class="mpre"> </span><a href="#loc_64_9_64_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_16&#39;)"><span class="hl_varref"><span class="mpre">ciphers</span></span></a><span class="mpre">)
                              (</span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="Network.TLS.Compression.html#loc_42_1_42_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Compression.html#loc_42_1_42_14&#39;)"><span class="hl_varref"><span class="mpre">compressionID</span></span></a><span class="mpre"> </span><a href="#loc_65_9_65_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_9_65_21&#39;)"><span class="hl_varref"><span class="mpre">compressions</span></span></a><span class="mpre">) </span><a href="#loc_85_13_85_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_13_85_23&#39;)"><span class="hl_varref"><span class="mpre">extensions</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
                ]
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fst</span></span><span class="mpre"> </span><a href="#loc_85_13_85_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_13_85_23&#39;)"><span class="hl_varref"><span class="mpre">extensions</span></span></a><span class="mpre">

        </span><a name="loc_94_9_94_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_9_94_21&#39;)"><span class="hl_vardecl"><span class="mpre">sendMaybeNPN</span></span></a><span class="mpre"> = do
            </span><a name="loc_95_13_95_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_13_95_20&#39;)"><span class="hl_vardecl"><span class="mpre">suggest</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.State.html#loc_192_1_192_29" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_192_1_192_29&#39;)"><span class="hl_varref"><span class="mpre">getServerNextProtocolSuggest</span></span></a><span class="mpre">
            case (</span><a href="Network.TLS.Parameters.html#loc_186_7_186_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_186_7_186_25&#39;)"><span class="hl_varref"><span class="mpre">onNPNServerSuggest</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Parameters.html#loc_61_7_61_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_61_7_61_18&#39;)"><span class="hl_varref"><span class="mpre">clientHooks</span></span></a><span class="mpre"> </span><a href="#loc_53_17_53_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_17_53_24&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre">, </span><a href="#loc_95_13_95_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_13_95_20&#39;)"><span class="hl_varref"><span class="mpre">suggest</span></span></a><span class="mpre">) of
                </span><span class="hl_comment"><span class="mpre">-- client offered, server picked up. send NPN handshake.</span></span><span class="mpre">
                (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_98_23_98_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_23_98_25&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre">, </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_98_32_98_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_32_98_38&#39;)"><span class="hl_vardecl"><span class="mpre">protos</span></span></a><span class="mpre">) -&gt; do </span><a name="loc_98_46_98_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_46_98_51&#39;)"><span class="hl_vardecl"><span class="mpre">proto</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_98_23_98_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_23_98_25&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_98_32_98_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_32_98_38&#39;)"><span class="hl_varref"><span class="mpre">protos</span></span></a><span class="mpre">
                                             </span><a href="Network.TLS.IO.html#loc_106_1_106_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.IO.html#loc_106_1_106_11&#39;)"><span class="hl_varref"><span class="mpre">sendPacket</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_151_7_151_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_151_7_151_16&#39;)"><span class="hl_conref"><span class="mpre">Handshake</span></span></a><span class="mpre"> [</span><a href="Network.TLS.Struct.html#loc_263_7_263_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_263_7_263_32&#39;)"><span class="hl_conref"><span class="mpre">HsNextProtocolNegotiation</span></span></a><span class="mpre"> </span><a href="#loc_98_46_98_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_46_98_51&#39;)"><span class="hl_varref"><span class="mpre">proto</span></span></a><span class="mpre">])
                                             </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.State.html#loc_183_1_183_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_183_1_183_22&#39;)"><span class="hl_varref"><span class="mpre">setNegotiatedProtocol</span></span></a><span class="mpre"> </span><a href="#loc_98_46_98_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_46_98_51&#39;)"><span class="hl_varref"><span class="mpre">proto</span></span></a><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- client offered, server didn&#39;t pick up. do nothing.</span></span><span class="mpre">
                (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> _, </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">) -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- client didn&#39;t offer. do nothing.</span></span><span class="mpre">
                (</span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">, _) -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

        </span><a name="loc_106_9_106_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_9_106_24&#39;)"><span class="hl_fundecl"><span class="mpre">recvServerHello</span></span></a><span class="mpre"> </span><a name="loc_106_25_106_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_25_106_33&#39;)"><span class="hl_vardecl"><span class="mpre">sentExts</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Handshake.Common.html#loc_112_1_112_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_112_1_112_13&#39;)"><span class="hl_varref"><span class="mpre">runRecvState</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_107_17_107_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_17_107_26&#39;)"><span class="hl_varref"><span class="mpre">recvState</span></span></a><span class="mpre">
          where </span><a name="loc_107_17_107_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_17_107_26&#39;)"><span class="hl_vardecl"><span class="mpre">recvState</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Handshake.Common.html#loc_90_7_90_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_90_7_90_20&#39;)"><span class="hl_conref"><span class="mpre">RecvStateNext</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_107_46_107_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_46_107_47&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt;
                    case </span><a href="#loc_107_46_107_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_46_107_47&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> of
                        </span><a href="Network.TLS.Struct.html#loc_151_7_151_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_151_7_151_16&#39;)"><span class="hl_conref"><span class="mpre">Handshake</span></span></a><span class="mpre"> </span><a name="loc_109_35_109_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_35_109_37&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Handshake.Common.html#loc_104_1_104_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_104_1_104_21&#39;)"><span class="hl_varref"><span class="mpre">onRecvStateHandshake</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Handshake.Common.html#loc_91_7_91_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_91_7_91_25&#39;)"><span class="hl_conref"><span class="mpre">RecvStateHandshake</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_250_1_250_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_1_250_14&#39;)"><span class="hl_varref"><span class="mpre">onServerHello</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_53_17_53_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_17_53_24&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre"> </span><a href="#loc_106_25_106_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_25_106_33&#39;)"><span class="hl_varref"><span class="mpre">sentExts</span></span></a><span class="mpre">) </span><a href="#loc_109_35_109_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_35_109_37&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">
                        </span><a href="Network.TLS.Struct.html#loc_152_7_152_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_152_7_152_12&#39;)"><span class="hl_conref"><span class="mpre">Alert</span></span></a><span class="mpre"> </span><a name="loc_110_31_110_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_31_110_32&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">      -&gt;
                            case </span><a href="#loc_110_31_110_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_31_110_32&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> of
                                [(</span><a href="Network.TLS.Struct.html#loc_177_7_177_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_177_7_177_25&#39;)"><span class="hl_conref"><span class="mpre">AlertLevel_Warning</span></span></a><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_207_7_207_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_207_7_207_23&#39;)"><span class="hl_conref"><span class="mpre">UnrecognizedName</span></span></a><span class="mpre">)] -&gt;
                                    if </span><a href="Network.TLS.Parameters.html#loc_57_7_57_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_57_7_57_36&#39;)"><span class="hl_varref"><span class="mpre">clientUseServerNameIndication</span></span></a><span class="mpre"> </span><a href="#loc_53_17_53_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_17_53_24&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre">
                                        then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_107_17_107_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_17_107_26&#39;)"><span class="hl_varref"><span class="mpre">recvState</span></span></a><span class="mpre">
                                        else </span><a href="#loc_118_17_118_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_17_118_27&#39;)"><span class="hl_varref"><span class="mpre">throwAlert</span></span></a><span class="mpre"> </span><a href="#loc_110_31_110_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_31_110_32&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
                                _ -&gt; </span><a href="#loc_118_17_118_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_17_118_27&#39;)"><span class="hl_varref"><span class="mpre">throwAlert</span></span></a><span class="mpre"> </span><a href="#loc_110_31_110_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_31_110_32&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
                        _ -&gt; </span><span class="hl_varref"><span class="mpre">fail</span></span><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;unexepected type received. expecting handshake and got: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_107_46_107_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_46_107_47&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">)
                </span><a name="loc_118_17_118_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_17_118_27&#39;)"><span class="hl_fundecl"><span class="mpre">throwAlert</span></span></a><span class="mpre"> </span><a name="loc_118_28_118_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_28_118_29&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_53_25_53_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_25_53_28&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">throwError</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;expecting server hello, got alert : &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_118_28_118_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_28_118_29&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_188_7_188_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_188_7_188_23&#39;)"><span class="hl_conref"><span class="mpre">HandshakeFailure</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | send client Data after receiving all server data (hello/certificates/key).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--       -&gt; [certificate]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--       -&gt; client key exchange</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--       -&gt; [cert verify]</span></span><span class="mpre">
</span><a href="#loc_126_1_126_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_15&#39;)"><span class="mpre">sendClientData</span></a><span class="mpre"> :: </span><a href="Network.TLS.Parameters.html#loc_43_6_43_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_43_6_43_18&#39;)"><span class="hl_tyconref"><span class="mpre">ClientParams</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_126_1_126_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_15&#39;)"><span class="hl_fundecl"><span class="mpre">sendClientData</span></span></a><span class="mpre"> </span><a name="loc_126_16_126_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_16_126_23&#39;)"><span class="hl_vardecl"><span class="mpre">cparams</span></span></a><span class="mpre"> </span><a name="loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> = </span><a href="#loc_135_9_135_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_9_135_24&#39;)"><span class="hl_varref"><span class="mpre">sendCertificate</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_157_9_157_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_26&#39;)"><span class="hl_varref"><span class="mpre">sendClientKeyXchg</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_198_9_198_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_9_198_30&#39;)"><span class="hl_varref"><span class="mpre">sendCertificateVerify</span></span></a><span class="mpre">
  where
        </span><span class="hl_comment"><span class="mpre">-- When the server requests a client certificate, we</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- fetch a certificate chain from the callback in the</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- client parameters and send it to the server.</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- Additionally, we store the private key associated</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- with the first certificate in the chain for later</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- use.</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
        </span><a name="loc_135_9_135_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_9_135_24&#39;)"><span class="hl_vardecl"><span class="mpre">sendCertificate</span></span></a><span class="mpre"> = do
            </span><a name="loc_136_13_136_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_13_136_26&#39;)"><span class="hl_vardecl"><span class="mpre">certRequested</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_160_1_160_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_160_1_160_21&#39;)"><span class="hl_varref"><span class="mpre">getClientCertRequest</span></span></a><span class="mpre">
            case </span><a href="#loc_136_13_136_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_13_136_26&#39;)"><span class="hl_varref"><span class="mpre">certRequested</span></span></a><span class="mpre"> of
                </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt;
                    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

                </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_141_22_141_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_22_141_25&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> -&gt; do
                    </span><a name="loc_142_21_142_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_21_142_30&#39;)"><span class="hl_vardecl"><span class="mpre">certChain</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> (</span><a href="Network.TLS.Parameters.html#loc_183_7_183_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_183_7_183_27&#39;)"><span class="hl_varref"><span class="mpre">onCertificateRequest</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Parameters.html#loc_61_7_61_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_61_7_61_18&#39;)"><span class="hl_varref"><span class="mpre">clientHooks</span></span></a><span class="mpre"> </span><a href="#loc_126_16_126_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_16_126_23&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre">) </span><a href="#loc_141_22_141_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_22_141_25&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><a href="Network.TLS.Util.html#loc_81_1_81_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_81_1_81_15&#39;)"><span class="hl_infix"><span class="mpre">`catchException`</span></span></a><span class="mpre">
                                 </span><a href="#loc_237_1_237_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_1_237_26&#39;)"><span class="hl_varref"><span class="mpre">throwMiscErrorOnException</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;certificate request callback failed&quot;</span></span><span class="mpre">

                    </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_145_1_145_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_145_1_145_18&#39;)"><span class="hl_varref"><span class="mpre">setClientCertSent</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
                    case </span><a href="#loc_142_21_142_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_21_142_30&#39;)"><span class="hl_varref"><span class="mpre">certChain</span></span></a><span class="mpre"> of
                        </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">                       -&gt; </span><a href="Network.TLS.IO.html#loc_106_1_106_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.IO.html#loc_106_1_106_11&#39;)"><span class="hl_varref"><span class="mpre">sendPacket</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_151_7_151_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_151_7_151_16&#39;)"><span class="hl_conref"><span class="mpre">Handshake</span></span></a><span class="mpre"> [</span><a href="Network.TLS.Struct.html#loc_255_7_255_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_255_7_255_19&#39;)"><span class="hl_conref"><span class="mpre">Certificates</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">CertificateChain</span></span><span class="mpre"> [])]
                        </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">CertificateChain</span></span><span class="mpre"> [], _) -&gt; </span><a href="Network.TLS.IO.html#loc_106_1_106_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.IO.html#loc_106_1_106_11&#39;)"><span class="hl_varref"><span class="mpre">sendPacket</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_151_7_151_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_151_7_151_16&#39;)"><span class="hl_conref"><span class="mpre">Handshake</span></span></a><span class="mpre"> [</span><a href="Network.TLS.Struct.html#loc_255_7_255_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_255_7_255_19&#39;)"><span class="hl_conref"><span class="mpre">Certificates</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">CertificateChain</span></span><span class="mpre"> [])]
                        </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a name="loc_149_31_149_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_31_149_33&#39;)"><span class="hl_specname"><span class="mpre">cc</span></span></a><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">CertificateChain</span></span><span class="mpre"> (</span><a name="loc_149_53_149_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_53_149_54&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_)), </span><a name="loc_149_60_149_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_60_149_62&#39;)"><span class="hl_vardecl"><span class="mpre">pk</span></span></a><span class="mpre">) -&gt; do
                            case </span><span class="hl_varref"><span class="mpre">certPubKey</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.X509.html#loc_87_1_87_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.html#loc_87_1_87_15&#39;)"><span class="hl_varref"><span class="mpre">getCertificate</span></span></a><span class="mpre"> </span><a href="#loc_149_53_149_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_53_149_54&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> of
                                </span><span class="hl_conref"><span class="mpre">PubKeyRSA</span></span><span class="mpre"> _ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
                                _           -&gt; </span><a href="Network.TLS.Context.Internal.html#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;no supported certificate type&quot;</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_188_7_188_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_188_7_188_23&#39;)"><span class="hl_conref"><span class="mpre">HandshakeFailure</span></span></a><span class="mpre">)
                            </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_126_1_126_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_126_1_126_14&#39;)"><span class="hl_varref"><span class="mpre">setPrivateKey</span></span></a><span class="mpre"> </span><a href="#loc_149_60_149_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_60_149_62&#39;)"><span class="hl_varref"><span class="mpre">pk</span></span></a><span class="mpre">
                            </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_145_1_145_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_145_1_145_18&#39;)"><span class="hl_varref"><span class="mpre">setClientCertSent</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
                            </span><a href="Network.TLS.IO.html#loc_106_1_106_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.IO.html#loc_106_1_106_11&#39;)"><span class="hl_varref"><span class="mpre">sendPacket</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_151_7_151_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_151_7_151_16&#39;)"><span class="hl_conref"><span class="mpre">Handshake</span></span></a><span class="mpre"> [</span><a href="Network.TLS.Struct.html#loc_255_7_255_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_255_7_255_19&#39;)"><span class="hl_conref"><span class="mpre">Certificates</span></span></a><span class="mpre"> </span><a href="#loc_149_31_149_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_31_149_33&#39;)"><span class="hl_varref"><span class="mpre">cc</span></span></a><span class="mpre">]

        </span><a name="loc_157_9_157_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_26&#39;)"><span class="hl_vardecl"><span class="mpre">sendClientKeyXchg</span></span></a><span class="mpre"> = do
            </span><a name="loc_158_13_158_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_13_158_19&#39;)"><span class="hl_vardecl"><span class="mpre">cipher</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_163_1_163_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_163_1_163_17&#39;)"><span class="hl_varref"><span class="mpre">getPendingCipher</span></span></a><span class="mpre">
            </span><a name="loc_159_13_159_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_13_159_16&#39;)"><span class="hl_vardecl"><span class="mpre">ckx</span></span></a><span class="mpre"> &lt;- case </span><a href="Network.TLS.Cipher.html#loc_87_7_87_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_87_7_87_24&#39;)"><span class="hl_varref"><span class="mpre">cipherKeyExchange</span></span></a><span class="mpre"> </span><a href="#loc_158_13_158_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_13_158_19&#39;)"><span class="hl_varref"><span class="mpre">cipher</span></span></a><span class="mpre"> of
                </span><a href="Network.TLS.Cipher.html#loc_41_7_41_28" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_41_7_41_28&#39;)"><span class="hl_conref"><span class="mpre">CipherKeyExchange_RSA</span></span></a><span class="mpre"> -&gt; do
                    </span><a name="loc_161_21_161_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_21_161_34&#39;)"><span class="hl_vardecl"><span class="mpre">clientVersion</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_63_7_63_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_63_7_63_23&#39;)"><span class="hl_varref"><span class="mpre">hstClientVersion</span></span></a><span class="mpre">
                    (</span><a name="loc_162_22_162_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_22_162_26&#39;)"><span class="hl_vardecl"><span class="mpre">xver</span></span></a><span class="mpre">, </span><a name="loc_162_28_162_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_28_162_35&#39;)"><span class="hl_vardecl"><span class="mpre">prerand</span></span></a><span class="mpre">) &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">(,)</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_165_1_165_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_165_1_165_11&#39;)"><span class="hl_varref"><span class="mpre">getVersion</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_207_1_207_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_207_1_207_10&#39;)"><span class="hl_varref"><span class="mpre">genRandom</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">46</span></span><span class="mpre">

                    let </span><a name="loc_164_25_164_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_25_164_34&#39;)"><span class="hl_vardecl"><span class="mpre">premaster</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Packet.html#loc_497_1_497_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Packet.html#loc_497_1_497_22&#39;)"><span class="hl_varref"><span class="mpre">encodePreMasterSecret</span></span></a><span class="mpre"> </span><a href="#loc_161_21_161_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_21_161_34&#39;)"><span class="hl_varref"><span class="mpre">clientVersion</span></span></a><span class="mpre"> </span><a href="#loc_162_28_162_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_28_162_35&#39;)"><span class="hl_varref"><span class="mpre">prerand</span></span></a><span class="mpre">
                    </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_193_1_193_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_193_1_193_23&#39;)"><span class="hl_varref"><span class="mpre">setMasterSecretFromPre</span></span></a><span class="mpre"> </span><a href="#loc_162_22_162_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_22_162_26&#39;)"><span class="hl_varref"><span class="mpre">xver</span></span></a><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_13_44_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_13_44_23&#39;)"><span class="hl_conref"><span class="mpre">ClientRole</span></span></a><span class="mpre"> </span><a href="#loc_164_25_164_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_25_164_34&#39;)"><span class="hl_varref"><span class="mpre">premaster</span></span></a><span class="mpre">
                    </span><a name="loc_166_21_166_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_21_166_39&#39;)"><span class="hl_vardecl"><span class="mpre">encryptedPreMaster</span></span></a><span class="mpre"> &lt;- do
                        </span><span class="hl_comment"><span class="mpre">-- SSL3 implementation generally forget this length field since it&#39;s redundant,</span></span><span class="mpre">
                        </span><span class="hl_comment"><span class="mpre">-- however TLS10 make it clear that the length field need to be present.</span></span><span class="mpre">
                        </span><a name="loc_169_25_169_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_25_169_26&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Handshake.Key.html#loc_31_1_31_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Key.html#loc_31_1_31_11&#39;)"><span class="hl_varref"><span class="mpre">encryptRSA</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_164_25_164_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_25_164_34&#39;)"><span class="hl_varref"><span class="mpre">premaster</span></span></a><span class="mpre">
                        let </span><a name="loc_170_29_170_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_29_170_34&#39;)"><span class="hl_vardecl"><span class="mpre">extra</span></span></a><span class="mpre"> = if </span><a href="#loc_162_22_162_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_22_162_26&#39;)"><span class="hl_varref"><span class="mpre">xver</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_25_30_25_35" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_30_25_35&#39;)"><span class="hl_conref"><span class="mpre">TLS10</span></span></a><span class="mpre">
                                        then </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">
                                        else </span><a href="Network.TLS.Wire.html#loc_162_1_162_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Wire.html#loc_162_1_162_13&#39;)"><span class="hl_varref"><span class="mpre">encodeWord16</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_169_25_169_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_25_169_26&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
                        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_170_29_170_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_29_170_34&#39;)"><span class="hl_varref"><span class="mpre">extra</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`B.append`</span></span><span class="mpre"> </span><a href="#loc_169_25_169_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_25_169_26&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
                    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_246_7_246_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_246_7_246_14&#39;)"><span class="hl_conref"><span class="mpre">CKX_RSA</span></span></a><span class="mpre"> </span><a href="#loc_166_21_166_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_21_166_39&#39;)"><span class="hl_varref"><span class="mpre">encryptedPreMaster</span></span></a><span class="mpre">
                </span><a href="Network.TLS.Cipher.html#loc_43_7_43_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_43_7_43_32&#39;)"><span class="hl_conref"><span class="mpre">CipherKeyExchange_DHE_RSA</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_179_17_179_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_17_179_27&#39;)"><span class="hl_varref"><span class="mpre">getCKX_DHE</span></span></a><span class="mpre">
                </span><a href="Network.TLS.Cipher.html#loc_45_7_45_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_45_7_45_32&#39;)"><span class="hl_conref"><span class="mpre">CipherKeyExchange_DHE_DSS</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_179_17_179_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_17_179_27&#39;)"><span class="hl_varref"><span class="mpre">getCKX_DHE</span></span></a><span class="mpre">
                _ -&gt; </span><a href="Network.TLS.Context.Internal.html#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;client key exchange unsupported type&quot;</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_188_7_188_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_188_7_188_23&#39;)"><span class="hl_conref"><span class="mpre">HandshakeFailure</span></span></a><span class="mpre">)
            </span><a href="Network.TLS.IO.html#loc_106_1_106_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.IO.html#loc_106_1_106_11&#39;)"><span class="hl_varref"><span class="mpre">sendPacket</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_151_7_151_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_151_7_151_16&#39;)"><span class="hl_conref"><span class="mpre">Handshake</span></span></a><span class="mpre"> [</span><a href="Network.TLS.Struct.html#loc_258_7_258_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_258_7_258_20&#39;)"><span class="hl_conref"><span class="mpre">ClientKeyXchg</span></span></a><span class="mpre"> </span><a href="#loc_159_13_159_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_13_159_16&#39;)"><span class="hl_varref"><span class="mpre">ckx</span></span></a><span class="mpre">]
          where </span><a name="loc_179_17_179_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_17_179_27&#39;)"><span class="hl_vardecl"><span class="mpre">getCKX_DHE</span></span></a><span class="mpre"> = do
                    </span><a name="loc_180_21_180_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_21_180_25&#39;)"><span class="hl_vardecl"><span class="mpre">xver</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_165_1_165_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_165_1_165_11&#39;)"><span class="hl_varref"><span class="mpre">getVersion</span></span></a><span class="mpre">
                    (</span><a href="Network.TLS.Struct.html#loc_226_23_226_37" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_226_23_226_37&#39;)"><span class="hl_conref"><span class="mpre">ServerDHParams</span></span></a><span class="mpre"> </span><a name="loc_181_37_181_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_37_181_45&#39;)"><span class="hl_vardecl"><span class="mpre">dhparams</span></span></a><span class="mpre"> </span><a name="loc_181_46_181_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_46_181_57&#39;)"><span class="hl_vardecl"><span class="mpre">serverDHPub</span></span></a><span class="mpre">) &lt;- </span><a href="Data.Maybe.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_91_1_91_9&#39;)"><span class="hl_varref"><span class="mpre">fromJust</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_68_7_68_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_68_7_68_24&#39;)"><span class="hl_varref"><span class="mpre">hstServerDHParams</span></span></a><span class="mpre">)
                    (</span><a name="loc_182_22_182_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_22_182_34&#39;)"><span class="hl_vardecl"><span class="mpre">clientDHPriv</span></span></a><span class="mpre">, </span><a name="loc_182_36_182_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_36_182_47&#39;)"><span class="hl_vardecl"><span class="mpre">clientDHPub</span></span></a><span class="mpre">) &lt;- </span><a href="Network.TLS.Handshake.Key.html#loc_62_1_62_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Key.html#loc_62_1_62_12&#39;)"><span class="hl_varref"><span class="mpre">generateDHE</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_181_37_181_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_37_181_45&#39;)"><span class="hl_varref"><span class="mpre">dhparams</span></span></a><span class="mpre">

                    let </span><a name="loc_184_25_184_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_25_184_34&#39;)"><span class="hl_vardecl"><span class="mpre">premaster</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Crypto.DH.html#loc_45_1_45_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Crypto.DH.html#loc_45_1_45_12&#39;)"><span class="hl_varref"><span class="mpre">dhGetShared</span></span></a><span class="mpre"> </span><a href="#loc_181_37_181_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_37_181_45&#39;)"><span class="hl_varref"><span class="mpre">dhparams</span></span></a><span class="mpre"> </span><a href="#loc_182_22_182_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_22_182_34&#39;)"><span class="hl_varref"><span class="mpre">clientDHPriv</span></span></a><span class="mpre"> </span><a href="#loc_181_46_181_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_46_181_57&#39;)"><span class="hl_varref"><span class="mpre">serverDHPub</span></span></a><span class="mpre">
                    </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_193_1_193_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_193_1_193_23&#39;)"><span class="hl_varref"><span class="mpre">setMasterSecretFromPre</span></span></a><span class="mpre"> </span><a href="#loc_180_21_180_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_21_180_25&#39;)"><span class="hl_varref"><span class="mpre">xver</span></span></a><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_13_44_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_13_44_23&#39;)"><span class="hl_conref"><span class="mpre">ClientRole</span></span></a><span class="mpre"> </span><a href="#loc_184_25_184_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_25_184_34&#39;)"><span class="hl_varref"><span class="mpre">premaster</span></span></a><span class="mpre">

                    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_247_7_247_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_247_7_247_13&#39;)"><span class="hl_conref"><span class="mpre">CKX_DH</span></span></a><span class="mpre"> </span><a href="#loc_182_36_182_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_36_182_47&#39;)"><span class="hl_varref"><span class="mpre">clientDHPub</span></span></a><span class="mpre">

        </span><span class="hl_comment"><span class="mpre">-- In order to send a proper certificate verify message,</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- we have to do the following:</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- 1. Determine which signing algorithm(s) the server supports</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--    (we currently only support RSA).</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- 2. Get the current handshake hash from the handshake state.</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- 3. Sign the handshake hash</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- 4. Send it to the server.</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
        </span><a name="loc_198_9_198_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_9_198_30&#39;)"><span class="hl_vardecl"><span class="mpre">sendCertificateVerify</span></span></a><span class="mpre"> = do
            </span><a name="loc_199_13_199_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_13_199_24&#39;)"><span class="hl_vardecl"><span class="mpre">usedVersion</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_165_1_165_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_165_1_165_11&#39;)"><span class="hl_varref"><span class="mpre">getVersion</span></span></a><span class="mpre">

            </span><span class="hl_comment"><span class="mpre">-- Only send a certificate verify message when we</span></span><span class="mpre">
            </span><span class="hl_comment"><span class="mpre">-- have sent a non-empty list of certificates.</span></span><span class="mpre">
            </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
            </span><a name="loc_204_13_204_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_13_204_21&#39;)"><span class="hl_vardecl"><span class="mpre">certSent</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_148_1_148_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_148_1_148_18&#39;)"><span class="hl_varref"><span class="mpre">getClientCertSent</span></span></a><span class="mpre">
            case </span><a href="#loc_204_13_204_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_13_204_21&#39;)"><span class="hl_varref"><span class="mpre">certSent</span></span></a><span class="mpre"> of
                </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> -&gt; do
                    </span><a name="loc_207_21_207_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_21_207_25&#39;)"><span class="hl_vardecl"><span class="mpre">malg</span></span></a><span class="mpre"> &lt;- case </span><a href="#loc_199_13_199_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_13_199_24&#39;)"><span class="hl_varref"><span class="mpre">usedVersion</span></span></a><span class="mpre"> of
                        </span><a href="Network.TLS.Types.html#loc_25_46_25_51" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_46_25_51&#39;)"><span class="hl_conref"><span class="mpre">TLS12</span></span></a><span class="mpre"> -&gt; do
                            </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (_, </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_209_43_209_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_43_209_51&#39;)"><span class="hl_vardecl"><span class="mpre">hashSigs</span></span></a><span class="mpre">, _) &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_160_1_160_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_160_1_160_21&#39;)"><span class="hl_varref"><span class="mpre">getClientCertRequest</span></span></a><span class="mpre">
                            let </span><a name="loc_210_33_210_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_33_210_45&#39;)"><span class="hl_vardecl"><span class="mpre">suppHashSigs</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Parameters.html#loc_120_7_120_30" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_120_7_120_30&#39;)"><span class="hl_varref"><span class="mpre">supportedHashSignatures</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_87_7_87_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_87_7_87_19&#39;)"><span class="hl_varref"><span class="mpre">ctxSupported</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
                                </span><a name="loc_211_33_211_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_33_211_42&#39;)"><span class="hl_vardecl"><span class="mpre">hashSigs&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">filter</span></span><span class="mpre"> (\ </span><a name="loc_211_55_211_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_55_211_56&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_211_55_211_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_55_211_56&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`elem`</span></span><span class="mpre"> </span><a href="#loc_209_43_209_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_43_209_51&#39;)"><span class="hl_varref"><span class="mpre">hashSigs</span></span></a><span class="mpre">) </span><a href="#loc_210_33_210_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_33_210_45&#39;)"><span class="hl_varref"><span class="mpre">suppHashSigs</span></span></a><span class="mpre">

                            </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_211_33_211_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_33_211_42&#39;)"><span class="hl_varref"><span class="mpre">hashSigs&#39;</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
                                </span><a href="Network.TLS.Context.Internal.html#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;no hash/signature algorithms in common with the server&quot;</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_188_7_188_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_188_7_188_23&#39;)"><span class="hl_conref"><span class="mpre">HandshakeFailure</span></span></a><span class="mpre">)
                            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">head</span></span><span class="mpre"> </span><a href="#loc_211_33_211_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_33_211_42&#39;)"><span class="hl_varref"><span class="mpre">hashSigs&#39;</span></span></a><span class="mpre">
                        _     -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">

                    </span><span class="hl_comment"><span class="mpre">-- Fetch all handshake messages up to now.</span></span><span class="mpre">
                    </span><a name="loc_219_21_219_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_21_219_25&#39;)"><span class="hl_vardecl"><span class="mpre">msgs</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_169_1_169_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_169_1_169_21&#39;)"><span class="hl_varref"><span class="mpre">getHandshakeMessages</span></span></a><span class="mpre">
                    (</span><a name="loc_220_22_220_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_22_220_32&#39;)"><span class="hl_vardecl"><span class="mpre">hashMethod</span></span></a><span class="mpre">, </span><a name="loc_220_34_220_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_34_220_40&#39;)"><span class="hl_vardecl"><span class="mpre">toSign</span></span></a><span class="mpre">) &lt;- </span><a href="Network.TLS.Handshake.Signature.html#loc_46_1_46_38" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Signature.html#loc_46_1_46_38&#39;)"><span class="hl_varref"><span class="mpre">prepareCertificateVerifySignatureData</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_199_13_199_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_13_199_24&#39;)"><span class="hl_varref"><span class="mpre">usedVersion</span></span></a><span class="mpre"> </span><a href="#loc_207_21_207_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_21_207_25&#39;)"><span class="hl_varref"><span class="mpre">malg</span></span></a><span class="mpre"> </span><a href="#loc_219_21_219_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_21_219_25&#39;)"><span class="hl_varref"><span class="mpre">msgs</span></span></a><span class="mpre">

                    </span><a name="loc_222_21_222_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_21_222_27&#39;)"><span class="hl_vardecl"><span class="mpre">sigDig</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Handshake.Signature.html#loc_77_1_77_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Signature.html#loc_77_1_77_16&#39;)"><span class="hl_varref"><span class="mpre">signatureCreate</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_207_21_207_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_21_207_25&#39;)"><span class="hl_varref"><span class="mpre">malg</span></span></a><span class="mpre"> </span><a href="#loc_220_22_220_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_22_220_32&#39;)"><span class="hl_varref"><span class="mpre">hashMethod</span></span></a><span class="mpre"> </span><a href="#loc_220_34_220_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_34_220_40&#39;)"><span class="hl_varref"><span class="mpre">toSign</span></span></a><span class="mpre">
                    </span><a href="Network.TLS.IO.html#loc_106_1_106_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.IO.html#loc_106_1_106_11&#39;)"><span class="hl_varref"><span class="mpre">sendPacket</span></span></a><span class="mpre"> </span><a href="#loc_126_24_126_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_24_126_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_151_7_151_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_151_7_151_16&#39;)"><span class="hl_conref"><span class="mpre">Handshake</span></span></a><span class="mpre"> [</span><a href="Network.TLS.Struct.html#loc_261_7_261_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_261_7_261_17&#39;)"><span class="hl_conref"><span class="mpre">CertVerify</span></span></a><span class="mpre"> </span><a href="#loc_222_21_222_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_21_222_27&#39;)"><span class="hl_varref"><span class="mpre">sigDig</span></span></a><span class="mpre">]

                _ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><a href="#loc_228_1_228_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_1_228_23&#39;)"><span class="mpre">processServerExtension</span></a><span class="mpre"> :: (</span><span class="hl_tyconref"><span class="mpre">ExtensionID</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre">) -&gt; </span><a href="Network.TLS.State.html#loc_77_9_77_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_77_9_77_14&#39;)"><span class="hl_tyconref"><span class="mpre">TLSSt</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_228_1_228_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_1_228_23&#39;)"><span class="hl_fundecl"><span class="mpre">processServerExtension</span></span></a><span class="mpre"> (</span><span class="hl_num"><span class="mpre">0xff01</span></span><span class="mpre">, </span><a name="loc_228_33_228_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_33_228_40&#39;)"><span class="hl_vardecl"><span class="mpre">content</span></span></a><span class="mpre">) = do
    </span><a name="loc_229_5_229_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_5_229_7&#39;)"><span class="hl_vardecl"><span class="mpre">cv</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.State.html#loc_201_1_201_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_201_1_201_16&#39;)"><span class="hl_varref"><span class="mpre">getVerifiedData</span></span></a><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_13_44_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_13_44_23&#39;)"><span class="hl_conref"><span class="mpre">ClientRole</span></span></a><span class="mpre">
    </span><a name="loc_230_5_230_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_5_230_7&#39;)"><span class="hl_vardecl"><span class="mpre">sv</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.State.html#loc_201_1_201_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_201_1_201_16&#39;)"><span class="hl_varref"><span class="mpre">getVerifiedData</span></span></a><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_26_44_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_26_44_36&#39;)"><span class="hl_conref"><span class="mpre">ServerRole</span></span></a><span class="mpre">
    let </span><a name="loc_231_9_231_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_9_231_11&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Extension.html#loc_60_5_60_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Extension.html#loc_60_5_60_20&#39;)"><span class="hl_varref"><span class="mpre">extensionEncode</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Extension.html#loc_106_28_106_47" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Extension.html#loc_106_28_106_47&#39;)"><span class="hl_conref"><span class="mpre">SecureRenegotiation</span></span></a><span class="mpre"> </span><a href="#loc_229_5_229_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_5_229_7&#39;)"><span class="hl_varref"><span class="mpre">cv</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_230_5_230_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_5_230_7&#39;)"><span class="hl_varref"><span class="mpre">sv</span></span></a><span class="mpre">)
    </span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="hl_varref"><span class="mpre">unless</span></span></a><span class="mpre"> (</span><a href="#loc_231_9_231_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_9_231_11&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a href="Network.TLS.Util.html#loc_71_1_71_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_71_1_71_8&#39;)"><span class="hl_infix"><span class="mpre">`bytesEq`</span></span></a><span class="mpre"> </span><a href="#loc_228_33_228_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_33_228_40&#39;)"><span class="hl_varref"><span class="mpre">content</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">throwError</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;server secure renegotiation data not matching&quot;</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_188_7_188_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_188_7_188_23&#39;)"><span class="hl_conref"><span class="mpre">HandshakeFailure</span></span></a><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
</span><a href="#loc_228_1_228_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_1_228_23&#39;)"><span class="hl_fundecl"><span class="mpre">processServerExtension</span></span></a><span class="mpre"> _ = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><a href="#loc_237_1_237_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_1_237_26&#39;)"><span class="mpre">throwMiscErrorOnException</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">SomeException</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_237_1_237_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_1_237_26&#39;)"><span class="hl_fundecl"><span class="mpre">throwMiscErrorOnException</span></span></a><span class="mpre"> </span><a name="loc_237_27_237_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_27_237_30&#39;)"><span class="hl_vardecl"><span class="mpre">msg</span></span></a><span class="mpre"> </span><a name="loc_237_31_237_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_31_237_32&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> =
    </span><a href="Network.TLS.Context.Internal.html#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_122_7_122_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_122_7_122_17&#39;)"><span class="hl_conref"><span class="mpre">Error_Misc</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_237_27_237_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_27_237_30&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_237_31_237_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_31_237_32&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | onServerHello process the ServerHello message on the client.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 1) check the version chosen by the server is one allowed by parameters.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 2) check that our compression and cipher algorithms are part of the list we sent</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 3) check extensions received are part of the one we sent</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 4) process the session parameter to see if the server want to start a new session or can resume</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 5) process NPN extension</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 6) if no resume switch to processCertificate SM or in resume switch to expectChangeCipher</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_250_1_250_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_1_250_14&#39;)"><span class="mpre">onServerHello</span></a><span class="mpre"> :: </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Parameters.html#loc_43_6_43_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_43_6_43_18&#39;)"><span class="hl_tyconref"><span class="mpre">ClientParams</span></span></a><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">ExtensionID</span></span><span class="mpre">] -&gt; </span><a href="Network.TLS.Struct.html#loc_252_6_252_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_252_6_252_15&#39;)"><span class="hl_tyconref"><span class="mpre">Handshake</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.TLS.Handshake.Common.html#loc_89_6_89_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_89_6_89_15&#39;)"><span class="hl_tyconref"><span class="mpre">RecvState</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre">)
</span><a name="loc_250_1_250_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_1_250_14&#39;)"><span class="hl_fundecl"><span class="mpre">onServerHello</span></span></a><span class="mpre"> </span><a name="loc_250_15_250_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_15_250_18&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_250_19_250_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_19_250_26&#39;)"><span class="hl_vardecl"><span class="mpre">cparams</span></span></a><span class="mpre"> </span><a name="loc_250_27_250_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_27_250_35&#39;)"><span class="hl_vardecl"><span class="mpre">sentExts</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_254_7_254_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_254_7_254_18&#39;)"><span class="hl_conref"><span class="mpre">ServerHello</span></span></a><span class="mpre"> </span><a name="loc_250_49_250_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_49_250_53&#39;)"><span class="hl_vardecl"><span class="mpre">rver</span></span></a><span class="mpre"> </span><a name="loc_250_54_250_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_54_250_63&#39;)"><span class="hl_vardecl"><span class="mpre">serverRan</span></span></a><span class="mpre"> </span><a name="loc_250_64_250_77" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_64_250_77&#39;)"><span class="hl_vardecl"><span class="mpre">serverSession</span></span></a><span class="mpre"> </span><a name="loc_250_78_250_84" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_78_250_84&#39;)"><span class="hl_vardecl"><span class="mpre">cipher</span></span></a><span class="mpre"> </span><a name="loc_250_85_250_96" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_85_250_96&#39;)"><span class="hl_vardecl"><span class="mpre">compression</span></span></a><span class="mpre"> </span><a name="loc_250_97_250_101" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_97_250_101&#39;)"><span class="hl_vardecl"><span class="mpre">exts</span></span></a><span class="mpre">) = do
    </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_250_49_250_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_49_250_53&#39;)"><span class="hl_varref"><span class="mpre">rver</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_25_16_25_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_16_25_20&#39;)"><span class="hl_conref"><span class="mpre">SSL2</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;ssl2 is not supported&quot;</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_200_7_200_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_200_7_200_22&#39;)"><span class="hl_conref"><span class="mpre">ProtocolVersion</span></span></a><span class="mpre">)
    case </span><a href="Data.List.html#loc_261_1_261_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_261_1_261_5&#39;)"><span class="hl_varref"><span class="mpre">find</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">(==)</span></span><span class="mpre"> </span><a href="#loc_250_49_250_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_49_250_53&#39;)"><span class="hl_varref"><span class="mpre">rver</span></span></a><span class="mpre">) (</span><a href="Network.TLS.Parameters.html#loc_113_7_113_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_113_7_113_24&#39;)"><span class="hl_varref"><span class="mpre">supportedVersions</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_87_7_87_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_87_7_87_19&#39;)"><span class="hl_varref"><span class="mpre">ctxSupported</span></span></a><span class="mpre"> </span><a href="#loc_250_15_250_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_15_250_18&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) of
        </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Context.Internal.html#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;server version &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_250_49_250_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_49_250_53&#39;)"><span class="hl_varref"><span class="mpre">rver</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; is not supported&quot;</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_200_7_200_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_200_7_200_22&#39;)"><span class="hl_conref"><span class="mpre">ProtocolVersion</span></span></a><span class="mpre">)
        </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> _  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- find the compression and cipher methods that the server want to use.</span></span><span class="mpre">
    </span><a name="loc_256_5_256_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_256_5_256_14&#39;)"><span class="hl_vardecl"><span class="mpre">cipherAlg</span></span></a><span class="mpre"> &lt;- case </span><a href="Data.List.html#loc_261_1_261_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_261_1_261_5&#39;)"><span class="hl_varref"><span class="mpre">find</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">(==)</span></span><span class="mpre"> </span><a href="#loc_250_78_250_84" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_78_250_84&#39;)"><span class="hl_varref"><span class="mpre">cipher</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Network.TLS.Cipher.html#loc_83_7_83_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_83_7_83_15&#39;)"><span class="hl_varref"><span class="mpre">cipherID</span></span></a><span class="mpre">) (</span><a href="Network.TLS.Context.Internal.html#loc_89_7_89_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_89_7_89_17&#39;)"><span class="hl_varref"><span class="mpre">ctxCiphers</span></span></a><span class="mpre"> </span><a href="#loc_250_15_250_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_15_250_18&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) of
                     </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">  -&gt; </span><a href="Network.TLS.Context.Internal.html#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;server choose unknown cipher&quot;</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_188_7_188_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_188_7_188_23&#39;)"><span class="hl_conref"><span class="mpre">HandshakeFailure</span></span></a><span class="mpre">)
                     </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_258_27_258_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_258_27_258_30&#39;)"><span class="hl_vardecl"><span class="mpre">alg</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_258_27_258_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_258_27_258_30&#39;)"><span class="hl_varref"><span class="mpre">alg</span></span></a><span class="mpre">
    </span><a name="loc_259_5_259_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_5_259_16&#39;)"><span class="hl_vardecl"><span class="mpre">compressAlg</span></span></a><span class="mpre"> &lt;- case </span><a href="Data.List.html#loc_261_1_261_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_261_1_261_5&#39;)"><span class="hl_varref"><span class="mpre">find</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">(==)</span></span><span class="mpre"> </span><a href="#loc_250_85_250_96" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_85_250_96&#39;)"><span class="hl_varref"><span class="mpre">compression</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Network.TLS.Compression.html#loc_42_1_42_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Compression.html#loc_42_1_42_14&#39;)"><span class="hl_varref"><span class="mpre">compressionID</span></span></a><span class="mpre">) (</span><a href="Network.TLS.Parameters.html#loc_117_7_117_28" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_117_7_117_28&#39;)"><span class="hl_varref"><span class="mpre">supportedCompressions</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_87_7_87_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_87_7_87_19&#39;)"><span class="hl_varref"><span class="mpre">ctxSupported</span></span></a><span class="mpre"> </span><a href="#loc_250_15_250_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_15_250_18&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) of
                       </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">  -&gt; </span><a href="Network.TLS.Context.Internal.html#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;server choose unknown compression&quot;</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_188_7_188_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_188_7_188_23&#39;)"><span class="hl_conref"><span class="mpre">HandshakeFailure</span></span></a><span class="mpre">)
                       </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_261_29_261_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_29_261_32&#39;)"><span class="hl_vardecl"><span class="mpre">alg</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_261_29_261_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_29_261_32&#39;)"><span class="hl_varref"><span class="mpre">alg</span></span></a><span class="mpre">

    </span><span class="hl_comment"><span class="mpre">-- intersect sent extensions in client and the received extensions from server.</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- if server returns extensions that we didn&#39;t request, fail.</span></span><span class="mpre">
    </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">filter</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">flip</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">elem</span></span><span class="mpre"> </span><a href="#loc_250_27_250_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_27_250_35&#39;)"><span class="hl_varref"><span class="mpre">sentExts</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fst</span></span><span class="mpre">) </span><a href="#loc_250_97_250_101" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_97_250_101&#39;)"><span class="hl_varref"><span class="mpre">exts</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
        </span><a href="Network.TLS.Context.Internal.html#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;spurious extensions received&quot;</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_205_7_205_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_205_7_205_27&#39;)"><span class="hl_conref"><span class="mpre">UnsupportedExtension</span></span></a><span class="mpre">)

    let </span><a name="loc_268_9_268_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_268_9_268_24&#39;)"><span class="hl_vardecl"><span class="mpre">resumingSession</span></span></a><span class="mpre"> =
            case </span><a href="Network.TLS.Parameters.html#loc_59_7_59_30" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_59_7_59_30&#39;)"><span class="hl_varref"><span class="mpre">clientWantSessionResume</span></span></a><span class="mpre"> </span><a href="#loc_250_19_250_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_19_250_26&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre"> of
                </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a name="loc_270_23_270_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_23_270_32&#39;)"><span class="hl_vardecl"><span class="mpre">sessionId</span></span></a><span class="mpre">, </span><a name="loc_270_34_270_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_34_270_45&#39;)"><span class="hl_vardecl"><span class="mpre">sessionData</span></span></a><span class="mpre">) -&gt; if </span><a href="#loc_250_64_250_77" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_64_250_77&#39;)"><span class="hl_varref"><span class="mpre">serverSession</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_161_19_161_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_161_19_161_26&#39;)"><span class="hl_conref"><span class="mpre">Session</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_270_23_270_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_23_270_32&#39;)"><span class="hl_varref"><span class="mpre">sessionId</span></span></a><span class="mpre">) then </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_270_34_270_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_34_270_45&#39;)"><span class="hl_varref"><span class="mpre">sessionData</span></span></a><span class="mpre"> else </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
                </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">                       -&gt; </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
    </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_250_15_250_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_15_250_18&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><a href="Network.TLS.State.html#loc_147_1_147_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_147_1_147_11&#39;)"><span class="hl_varref"><span class="mpre">setSession</span></span></a><span class="mpre"> </span><a href="#loc_250_64_250_77" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_64_250_77&#39;)"><span class="hl_varref"><span class="mpre">serverSession</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_80_1_80_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_80_1_80_7&#39;)"><span class="hl_varref"><span class="mpre">isJust</span></span></a><span class="mpre"> </span><a href="#loc_268_9_268_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_268_9_268_24&#39;)"><span class="hl_varref"><span class="mpre">resumingSession</span></span></a><span class="mpre">)
        </span><a href="Control.Monad.html#loc_116_1_116_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_116_1_116_6&#39;)"><span class="hl_varref"><span class="mpre">mapM_</span></span></a><span class="mpre"> </span><a href="#loc_228_1_228_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_1_228_23&#39;)"><span class="hl_varref"><span class="mpre">processServerExtension</span></span></a><span class="mpre"> </span><a href="#loc_250_97_250_101" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_97_250_101&#39;)"><span class="hl_varref"><span class="mpre">exts</span></span></a><span class="mpre">
        </span><a href="Network.TLS.State.html#loc_156_1_156_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_156_1_156_11&#39;)"><span class="hl_varref"><span class="mpre">setVersion</span></span></a><span class="mpre"> </span><a href="#loc_250_49_250_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_49_250_53&#39;)"><span class="hl_varref"><span class="mpre">rver</span></span></a><span class="mpre">
    </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_250_15_250_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_15_250_18&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_253_1_253_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_253_1_253_25&#39;)"><span class="hl_varref"><span class="mpre">setServerHelloParameters</span></span></a><span class="mpre"> </span><a href="#loc_250_49_250_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_49_250_53&#39;)"><span class="hl_varref"><span class="mpre">rver</span></span></a><span class="mpre"> </span><a href="#loc_250_54_250_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_54_250_63&#39;)"><span class="hl_varref"><span class="mpre">serverRan</span></span></a><span class="mpre"> </span><a href="#loc_256_5_256_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_256_5_256_14&#39;)"><span class="hl_varref"><span class="mpre">cipherAlg</span></span></a><span class="mpre"> </span><a href="#loc_259_5_259_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_5_259_16&#39;)"><span class="hl_varref"><span class="mpre">compressAlg</span></span></a><span class="mpre">

    case </span><a href="Network.TLS.Extension.html#loc_59_5_59_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Extension.html#loc_59_5_59_20&#39;)"><span class="hl_varref"><span class="mpre">extensionDecode</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><a href="Network.TLS.Extension.html#loc_46_1_46_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Extension.html#loc_46_1_46_36&#39;)"><span class="hl_varref"><span class="mpre">extensionID_NextProtocolNegotiation</span></span></a><span class="mpre"> </span><a href="#loc_250_97_250_101" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_97_250_101&#39;)"><span class="hl_varref"><span class="mpre">exts</span></span></a><span class="mpre">) of
        </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Extension.html#loc_121_32_121_55" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Extension.html#loc_121_32_121_55&#39;)"><span class="hl_conref"><span class="mpre">NextProtocolNegotiation</span></span></a><span class="mpre"> </span><a name="loc_279_45_279_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_45_279_51&#39;)"><span class="hl_vardecl"><span class="mpre">protos</span></span></a><span class="mpre">)) -&gt; </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_250_15_250_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_15_250_18&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a href="Network.TLS.State.html#loc_177_1_177_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_177_1_177_16&#39;)"><span class="hl_varref"><span class="mpre">setExtensionNPN</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
            </span><a href="Network.TLS.State.html#loc_189_1_189_29" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_189_1_189_29&#39;)"><span class="hl_varref"><span class="mpre">setServerNextProtocolSuggest</span></span></a><span class="mpre"> </span><a href="#loc_279_45_279_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_45_279_51&#39;)"><span class="hl_varref"><span class="mpre">protos</span></span></a><span class="mpre">
        _ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

    case </span><a href="#loc_268_9_268_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_268_9_268_24&#39;)"><span class="hl_varref"><span class="mpre">resumingSession</span></span></a><span class="mpre"> of
        </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">          -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.Common.html#loc_91_7_91_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_91_7_91_25&#39;)"><span class="hl_conref"><span class="mpre">RecvStateHandshake</span></span></a><span class="mpre"> (</span><a href="#loc_292_1_292_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_292_1_292_19&#39;)"><span class="hl_varref"><span class="mpre">processCertificate</span></span></a><span class="mpre"> </span><a href="#loc_250_19_250_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_19_250_26&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre"> </span><a href="#loc_250_15_250_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_15_250_18&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">)
        </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_286_14_286_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_14_286_25&#39;)"><span class="hl_vardecl"><span class="mpre">sessionData</span></span></a><span class="mpre"> -&gt; do
            </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_250_15_250_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_15_250_18&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Handshake.State.html#loc_204_1_204_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_204_1_204_16&#39;)"><span class="hl_varref"><span class="mpre">setMasterSecret</span></span></a><span class="mpre"> </span><a href="#loc_250_49_250_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_49_250_53&#39;)"><span class="hl_varref"><span class="mpre">rver</span></span></a><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_13_44_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_13_44_23&#39;)"><span class="hl_conref"><span class="mpre">ClientRole</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_34_7_34_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_34_7_34_20&#39;)"><span class="hl_varref"><span class="mpre">sessionSecret</span></span></a><span class="mpre"> </span><a href="#loc_286_14_286_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_14_286_25&#39;)"><span class="hl_varref"><span class="mpre">sessionData</span></span></a><span class="mpre">)
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.Common.html#loc_90_7_90_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_90_7_90_20&#39;)"><span class="hl_conref"><span class="mpre">RecvStateNext</span></span></a><span class="mpre"> </span><a href="#loc_309_1_309_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_1_309_19&#39;)"><span class="hl_varref"><span class="mpre">expectChangeCipher</span></span></a><span class="mpre">
</span><a href="#loc_250_1_250_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_1_250_14&#39;)"><span class="hl_fundecl"><span class="mpre">onServerHello</span></span></a><span class="mpre"> _ _ _ </span><a name="loc_289_21_289_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_289_21_289_22&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Handshake.Common.html#loc_46_1_46_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_46_1_46_11&#39;)"><span class="hl_varref"><span class="mpre">unexpected</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_289_21_289_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_289_21_289_22&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">) (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;server hello&quot;</span></span><span class="mpre">)

</span><a href="#loc_292_1_292_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_292_1_292_19&#39;)"><span class="mpre">processCertificate</span></a><span class="mpre"> :: </span><a href="Network.TLS.Parameters.html#loc_43_6_43_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_43_6_43_18&#39;)"><span class="hl_tyconref"><span class="mpre">ClientParams</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Struct.html#loc_252_6_252_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_252_6_252_15&#39;)"><span class="hl_tyconref"><span class="mpre">Handshake</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.TLS.Handshake.Common.html#loc_89_6_89_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_89_6_89_15&#39;)"><span class="hl_tyconref"><span class="mpre">RecvState</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre">)
</span><a name="loc_292_1_292_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_292_1_292_19&#39;)"><span class="hl_fundecl"><span class="mpre">processCertificate</span></span></a><span class="mpre"> </span><a name="loc_292_20_292_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_292_20_292_27&#39;)"><span class="hl_vardecl"><span class="mpre">cparams</span></span></a><span class="mpre"> </span><a name="loc_292_28_292_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_292_28_292_31&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_255_7_255_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_255_7_255_19&#39;)"><span class="hl_conref"><span class="mpre">Certificates</span></span></a><span class="mpre"> </span><a name="loc_292_46_292_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_292_46_292_51&#39;)"><span class="hl_vardecl"><span class="mpre">certs</span></span></a><span class="mpre">) = do
    </span><span class="hl_comment"><span class="mpre">-- run certificate recv hook</span></span><span class="mpre">
    </span><a href="Network.TLS.Context.Internal.html#loc_155_1_155_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_155_1_155_13&#39;)"><span class="hl_varref"><span class="mpre">ctxWithHooks</span></span></a><span class="mpre"> </span><a href="#loc_292_28_292_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_292_28_292_31&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> (\</span><a name="loc_294_24_294_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_24_294_29&#39;)"><span class="hl_vardecl"><span class="mpre">hooks</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">hookRecvCertificates</span></span><span class="mpre"> </span><a href="#loc_294_24_294_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_24_294_29&#39;)"><span class="hl_varref"><span class="mpre">hooks</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_292_46_292_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_292_46_292_51&#39;)"><span class="hl_varref"><span class="mpre">certs</span></span></a><span class="mpre">)
    </span><span class="hl_comment"><span class="mpre">-- then run certificate validation</span></span><span class="mpre">
    </span><a name="loc_296_5_296_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_296_5_296_10&#39;)"><span class="hl_vardecl"><span class="mpre">usage</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Util.html#loc_81_1_81_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_81_1_81_15&#39;)"><span class="hl_varref"><span class="mpre">catchException</span></span></a><span class="mpre"> (</span><a href="Network.TLS.X509.html#loc_54_1_54_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.X509.html#loc_54_1_54_22&#39;)"><span class="hl_varref"><span class="mpre">wrapCertificateChecks</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="#loc_302_9_302_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_9_302_18&#39;)"><span class="hl_varref"><span class="mpre">checkCert</span></span></a><span class="mpre">) </span><a href="Network.TLS.Handshake.Certificate.html#loc_31_1_31_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Certificate.html#loc_31_1_31_18&#39;)"><span class="hl_varref"><span class="mpre">rejectOnException</span></span></a><span class="mpre">
    case </span><a href="#loc_296_5_296_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_296_5_296_10&#39;)"><span class="hl_varref"><span class="mpre">usage</span></span></a><span class="mpre"> of
        </span><a href="Network.TLS.X509.html#loc_49_11_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.X509.html#loc_49_11_49_33&#39;)"><span class="hl_conref"><span class="mpre">CertificateUsageAccept</span></span></a><span class="mpre">        -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
        </span><a href="Network.TLS.X509.html#loc_50_11_50_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.X509.html#loc_50_11_50_33&#39;)"><span class="hl_conref"><span class="mpre">CertificateUsageReject</span></span></a><span class="mpre"> </span><a name="loc_299_32_299_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_32_299_38&#39;)"><span class="hl_vardecl"><span class="mpre">reason</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Handshake.Certificate.html#loc_21_1_21_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Certificate.html#loc_21_1_21_20&#39;)"><span class="hl_varref"><span class="mpre">certificateRejected</span></span></a><span class="mpre"> </span><a href="#loc_299_32_299_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_32_299_38&#39;)"><span class="hl_varref"><span class="mpre">reason</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.Common.html#loc_91_7_91_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_91_7_91_25&#39;)"><span class="hl_conref"><span class="mpre">RecvStateHandshake</span></span></a><span class="mpre"> (</span><a href="#loc_317_1_317_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_1_317_25&#39;)"><span class="hl_varref"><span class="mpre">processServerKeyExchange</span></span></a><span class="mpre"> </span><a href="#loc_292_28_292_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_292_28_292_31&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">)
  where </span><a name="loc_301_9_301_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_301_9_301_15&#39;)"><span class="hl_vardecl"><span class="mpre">shared</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Parameters.html#loc_60_7_60_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_60_7_60_19&#39;)"><span class="hl_varref"><span class="mpre">clientShared</span></span></a><span class="mpre"> </span><a href="#loc_292_20_292_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_292_20_292_27&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre">
        </span><a name="loc_302_9_302_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_9_302_18&#39;)"><span class="hl_vardecl"><span class="mpre">checkCert</span></span></a><span class="mpre"> = (</span><a href="Network.TLS.Parameters.html#loc_187_7_187_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_187_7_187_26&#39;)"><span class="hl_varref"><span class="mpre">onServerCertificate</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Parameters.html#loc_61_7_61_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_61_7_61_18&#39;)"><span class="hl_varref"><span class="mpre">clientHooks</span></span></a><span class="mpre"> </span><a href="#loc_292_20_292_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_292_20_292_27&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre">) (</span><a href="Network.TLS.Parameters.html#loc_148_7_148_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_148_7_148_20&#39;)"><span class="hl_varref"><span class="mpre">sharedCAStore</span></span></a><span class="mpre"> </span><a href="#loc_301_9_301_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_301_9_301_15&#39;)"><span class="hl_varref"><span class="mpre">shared</span></span></a><span class="mpre">)
                                                                (</span><a href="Network.TLS.Parameters.html#loc_149_7_149_28" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_149_7_149_28&#39;)"><span class="hl_varref"><span class="mpre">sharedValidationCache</span></span></a><span class="mpre"> </span><a href="#loc_301_9_301_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_301_9_301_15&#39;)"><span class="hl_varref"><span class="mpre">shared</span></span></a><span class="mpre">)
                                                                (</span><a href="Network.TLS.Parameters.html#loc_53_7_53_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_53_7_53_33&#39;)"><span class="hl_varref"><span class="mpre">clientServerIdentification</span></span></a><span class="mpre"> </span><a href="#loc_292_20_292_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_292_20_292_27&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre">)
                                                                </span><a href="#loc_292_46_292_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_292_46_292_51&#39;)"><span class="hl_varref"><span class="mpre">certs</span></span></a><span class="mpre">
</span><a href="#loc_292_1_292_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_292_1_292_19&#39;)"><span class="hl_fundecl"><span class="mpre">processCertificate</span></span></a><span class="mpre"> _ </span><a name="loc_306_22_306_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_306_22_306_25&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_306_26_306_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_306_26_306_27&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = </span><a href="#loc_317_1_317_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_1_317_25&#39;)"><span class="hl_varref"><span class="mpre">processServerKeyExchange</span></span></a><span class="mpre"> </span><a href="#loc_306_22_306_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_306_22_306_25&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_306_26_306_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_306_26_306_27&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">

</span><a href="#loc_309_1_309_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_1_309_19&#39;)"><span class="mpre">expectChangeCipher</span></a><span class="mpre"> :: </span><a href="Network.TLS.Struct.html#loc_150_6_150_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_150_6_150_12&#39;)"><span class="hl_tyconref"><span class="mpre">Packet</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.TLS.Handshake.Common.html#loc_89_6_89_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_89_6_89_15&#39;)"><span class="hl_tyconref"><span class="mpre">RecvState</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre">)
</span><a name="loc_309_1_309_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_1_309_19&#39;)"><span class="hl_fundecl"><span class="mpre">expectChangeCipher</span></span></a><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_153_7_153_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_153_7_153_23&#39;)"><span class="hl_conref"><span class="mpre">ChangeCipherSpec</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.Common.html#loc_91_7_91_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_91_7_91_25&#39;)"><span class="hl_conref"><span class="mpre">RecvStateHandshake</span></span></a><span class="mpre"> </span><a href="#loc_313_1_313_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_1_313_13&#39;)"><span class="hl_varref"><span class="mpre">expectFinish</span></span></a><span class="mpre">
</span><a href="#loc_309_1_309_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_1_309_19&#39;)"><span class="hl_fundecl"><span class="mpre">expectChangeCipher</span></span></a><span class="mpre"> </span><a name="loc_310_20_310_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_310_20_310_21&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre">                = </span><a href="Network.TLS.Handshake.Common.html#loc_46_1_46_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_46_1_46_11&#39;)"><span class="hl_varref"><span class="mpre">unexpected</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_310_20_310_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_310_20_310_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">) (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;change cipher&quot;</span></span><span class="mpre">)

</span><a href="#loc_313_1_313_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_1_313_13&#39;)"><span class="mpre">expectFinish</span></a><span class="mpre"> :: </span><a href="Network.TLS.Struct.html#loc_252_6_252_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_252_6_252_15&#39;)"><span class="hl_tyconref"><span class="mpre">Handshake</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.TLS.Handshake.Common.html#loc_89_6_89_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_89_6_89_15&#39;)"><span class="hl_tyconref"><span class="mpre">RecvState</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre">)
</span><a name="loc_313_1_313_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_1_313_13&#39;)"><span class="hl_fundecl"><span class="mpre">expectFinish</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_262_7_262_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_262_7_262_15&#39;)"><span class="hl_conref"><span class="mpre">Finished</span></span></a><span class="mpre"> _) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.Common.html#loc_92_7_92_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_92_7_92_20&#39;)"><span class="hl_conref"><span class="mpre">RecvStateDone</span></span></a><span class="mpre">
</span><a href="#loc_313_1_313_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_1_313_13&#39;)"><span class="hl_fundecl"><span class="mpre">expectFinish</span></span></a><span class="mpre"> </span><a name="loc_314_14_314_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_314_14_314_15&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre">            = </span><a href="Network.TLS.Handshake.Common.html#loc_46_1_46_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_46_1_46_11&#39;)"><span class="hl_varref"><span class="mpre">unexpected</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_314_14_314_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_314_14_314_15&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">) (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Handshake Finished&quot;</span></span><span class="mpre">)

</span><a href="#loc_317_1_317_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_1_317_25&#39;)"><span class="mpre">processServerKeyExchange</span></a><span class="mpre"> :: </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Struct.html#loc_252_6_252_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_252_6_252_15&#39;)"><span class="hl_tyconref"><span class="mpre">Handshake</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.TLS.Handshake.Common.html#loc_89_6_89_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_89_6_89_15&#39;)"><span class="hl_tyconref"><span class="mpre">RecvState</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre">)
</span><a name="loc_317_1_317_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_1_317_25&#39;)"><span class="hl_fundecl"><span class="mpre">processServerKeyExchange</span></span></a><span class="mpre"> </span><a name="loc_317_26_317_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_26_317_29&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_259_7_259_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_259_7_259_20&#39;)"><span class="hl_conref"><span class="mpre">ServerKeyXchg</span></span></a><span class="mpre"> </span><a name="loc_317_45_317_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_45_317_52&#39;)"><span class="hl_vardecl"><span class="mpre">origSkx</span></span></a><span class="mpre">) = do
    </span><a name="loc_318_5_318_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_5_318_11&#39;)"><span class="hl_vardecl"><span class="mpre">cipher</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_317_26_317_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_26_317_29&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_163_1_163_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_163_1_163_17&#39;)"><span class="hl_varref"><span class="mpre">getPendingCipher</span></span></a><span class="mpre">
    </span><a href="#loc_321_9_321_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_9_321_26&#39;)"><span class="hl_varref"><span class="mpre">processWithCipher</span></span></a><span class="mpre"> </span><a href="#loc_318_5_318_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_5_318_11&#39;)"><span class="hl_varref"><span class="mpre">cipher</span></span></a><span class="mpre"> </span><a href="#loc_317_45_317_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_45_317_52&#39;)"><span class="hl_varref"><span class="mpre">origSkx</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.Common.html#loc_91_7_91_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_91_7_91_25&#39;)"><span class="hl_conref"><span class="mpre">RecvStateHandshake</span></span></a><span class="mpre"> (</span><a href="#loc_344_1_344_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_1_344_26&#39;)"><span class="hl_varref"><span class="mpre">processCertificateRequest</span></span></a><span class="mpre"> </span><a href="#loc_317_26_317_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_26_317_29&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">)
  where </span><a name="loc_321_9_321_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_9_321_26&#39;)"><span class="hl_fundecl"><span class="mpre">processWithCipher</span></span></a><span class="mpre"> </span><a name="loc_321_27_321_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_27_321_33&#39;)"><span class="hl_vardecl"><span class="mpre">cipher</span></span></a><span class="mpre"> </span><a name="loc_321_34_321_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_34_321_37&#39;)"><span class="hl_vardecl"><span class="mpre">skx</span></span></a><span class="mpre"> =
            case (</span><a href="Network.TLS.Cipher.html#loc_87_7_87_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_87_7_87_24&#39;)"><span class="hl_varref"><span class="mpre">cipherKeyExchange</span></span></a><span class="mpre"> </span><a href="#loc_321_27_321_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_27_321_33&#39;)"><span class="hl_varref"><span class="mpre">cipher</span></span></a><span class="mpre">, </span><a href="#loc_321_34_321_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_34_321_37&#39;)"><span class="hl_varref"><span class="mpre">skx</span></span></a><span class="mpre">) of
                (</span><a href="Network.TLS.Cipher.html#loc_43_7_43_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_43_7_43_32&#39;)"><span class="hl_conref"><span class="mpre">CipherKeyExchange_DHE_RSA</span></span></a><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_237_7_237_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_237_7_237_18&#39;)"><span class="hl_conref"><span class="mpre">SKX_DHE_RSA</span></span></a><span class="mpre"> </span><a name="loc_323_57_323_65" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_57_323_65&#39;)"><span class="hl_vardecl"><span class="mpre">dhparams</span></span></a><span class="mpre"> </span><a name="loc_323_66_323_75" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_66_323_75&#39;)"><span class="hl_vardecl"><span class="mpre">signature</span></span></a><span class="mpre">) -&gt; do
                    </span><a href="#loc_334_9_334_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_334_9_334_23&#39;)"><span class="hl_varref"><span class="mpre">doDHESignature</span></span></a><span class="mpre"> </span><a href="#loc_323_57_323_65" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_57_323_65&#39;)"><span class="hl_varref"><span class="mpre">dhparams</span></span></a><span class="mpre"> </span><a href="#loc_323_66_323_75" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_66_323_75&#39;)"><span class="hl_varref"><span class="mpre">signature</span></span></a><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_99_7_99_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_99_7_99_19&#39;)"><span class="hl_conref"><span class="mpre">SignatureRSA</span></span></a><span class="mpre">
                (</span><a href="Network.TLS.Cipher.html#loc_45_7_45_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_45_7_45_32&#39;)"><span class="hl_conref"><span class="mpre">CipherKeyExchange_DHE_DSS</span></span></a><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_236_7_236_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_236_7_236_18&#39;)"><span class="hl_conref"><span class="mpre">SKX_DHE_DSS</span></span></a><span class="mpre"> </span><a name="loc_325_57_325_65" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_325_57_325_65&#39;)"><span class="hl_vardecl"><span class="mpre">dhparams</span></span></a><span class="mpre"> </span><a name="loc_325_66_325_75" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_325_66_325_75&#39;)"><span class="hl_vardecl"><span class="mpre">signature</span></span></a><span class="mpre">) -&gt; do
                    </span><a href="#loc_334_9_334_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_334_9_334_23&#39;)"><span class="hl_varref"><span class="mpre">doDHESignature</span></span></a><span class="mpre"> </span><a href="#loc_325_57_325_65" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_325_57_325_65&#39;)"><span class="hl_varref"><span class="mpre">dhparams</span></span></a><span class="mpre"> </span><a href="#loc_325_66_325_75" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_325_66_325_75&#39;)"><span class="hl_varref"><span class="mpre">signature</span></span></a><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_100_7_100_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_100_7_100_19&#39;)"><span class="hl_conref"><span class="mpre">SignatureDSS</span></span></a><span class="mpre">
                (</span><a name="loc_327_18_327_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_18_327_21&#39;)"><span class="hl_vardecl"><span class="mpre">cke</span></span></a><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_241_7_241_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_241_7_241_19&#39;)"><span class="hl_conref"><span class="mpre">SKX_Unparsed</span></span></a><span class="mpre"> </span><a name="loc_327_36_327_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_36_327_41&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre">) -&gt; do
                    </span><a name="loc_328_21_328_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_328_21_328_24&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_317_26_317_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_26_317_29&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_165_1_165_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_165_1_165_11&#39;)"><span class="hl_varref"><span class="mpre">getVersion</span></span></a><span class="mpre">
                    case </span><a href="Network.TLS.Packet.html#loc_507_1_507_39" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Packet.html#loc_507_1_507_39&#39;)"><span class="hl_varref"><span class="mpre">decodeReallyServerKeyXchgAlgorithmData</span></span></a><span class="mpre"> </span><a href="#loc_328_21_328_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_328_21_328_24&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_327_18_327_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_18_327_21&#39;)"><span class="hl_varref"><span class="mpre">cke</span></span></a><span class="mpre"> </span><a href="#loc_327_36_327_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_36_327_41&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre"> of
                        </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> _        -&gt; </span><a href="Network.TLS.Context.Internal.html#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;unknown server key exchange received, expecting: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_327_18_327_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_327_18_327_21&#39;)"><span class="hl_varref"><span class="mpre">cke</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_188_7_188_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_188_7_188_23&#39;)"><span class="hl_conref"><span class="mpre">HandshakeFailure</span></span></a><span class="mpre">)
                        </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a name="loc_331_31_331_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_331_31_331_38&#39;)"><span class="hl_vardecl"><span class="mpre">realSkx</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_321_9_321_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_9_321_26&#39;)"><span class="hl_varref"><span class="mpre">processWithCipher</span></span></a><span class="mpre"> </span><a href="#loc_321_27_321_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_27_321_33&#39;)"><span class="hl_varref"><span class="mpre">cipher</span></span></a><span class="mpre"> </span><a href="#loc_331_31_331_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_331_31_331_38&#39;)"><span class="hl_varref"><span class="mpre">realSkx</span></span></a><span class="mpre">
                    </span><span class="hl_comment"><span class="mpre">-- we need to resolve the result. and recall processWithCipher ..</span></span><span class="mpre">
                (</span><a name="loc_333_18_333_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_333_18_333_19&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre">,_)           -&gt; </span><a href="Network.TLS.Context.Internal.html#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;unknown server key exchange received, expecting: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_333_18_333_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_333_18_333_19&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_188_7_188_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_188_7_188_23&#39;)"><span class="hl_conref"><span class="mpre">HandshakeFailure</span></span></a><span class="mpre">)
        </span><a name="loc_334_9_334_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_334_9_334_23&#39;)"><span class="hl_fundecl"><span class="mpre">doDHESignature</span></span></a><span class="mpre"> </span><a name="loc_334_24_334_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_334_24_334_32&#39;)"><span class="hl_vardecl"><span class="mpre">dhparams</span></span></a><span class="mpre"> </span><a name="loc_334_33_334_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_334_33_334_42&#39;)"><span class="hl_vardecl"><span class="mpre">signature</span></span></a><span class="mpre"> </span><a name="loc_334_43_334_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_334_43_334_56&#39;)"><span class="hl_vardecl"><span class="mpre">signatureType</span></span></a><span class="mpre"> = do
            </span><span class="hl_comment"><span class="mpre">-- TODO verify DHParams</span></span><span class="mpre">
            </span><a name="loc_336_13_336_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_336_13_336_25&#39;)"><span class="hl_vardecl"><span class="mpre">expectedData</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Handshake.Signature.html#loc_106_1_106_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Signature.html#loc_106_1_106_23&#39;)"><span class="hl_varref"><span class="mpre">generateSignedDHParams</span></span></a><span class="mpre"> </span><a href="#loc_317_26_317_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_26_317_29&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_334_24_334_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_334_24_334_32&#39;)"><span class="hl_varref"><span class="mpre">dhparams</span></span></a><span class="mpre">
            </span><a name="loc_337_13_337_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_337_13_337_21&#39;)"><span class="hl_vardecl"><span class="mpre">verified</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Handshake.Signature.html#loc_82_1_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Signature.html#loc_82_1_82_16&#39;)"><span class="hl_varref"><span class="mpre">signatureVerify</span></span></a><span class="mpre"> </span><a href="#loc_317_26_317_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_26_317_29&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_334_43_334_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_334_43_334_56&#39;)"><span class="hl_varref"><span class="mpre">signatureType</span></span></a><span class="mpre"> </span><a href="#loc_336_13_336_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_336_13_336_25&#39;)"><span class="hl_varref"><span class="mpre">expectedData</span></span></a><span class="mpre"> </span><a href="#loc_334_33_334_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_334_33_334_42&#39;)"><span class="hl_varref"><span class="mpre">signature</span></span></a><span class="mpre">
            </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><a href="#loc_337_13_337_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_337_13_337_21&#39;)"><span class="hl_varref"><span class="mpre">verified</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;bad &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_334_43_334_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_334_43_334_56&#39;)"><span class="hl_varref"><span class="mpre">signatureType</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; for dhparams&quot;</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_188_7_188_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_188_7_188_23&#39;)"><span class="hl_conref"><span class="mpre">HandshakeFailure</span></span></a><span class="mpre">)
            </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_317_26_317_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_26_317_29&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_136_1_136_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_136_1_136_18&#39;)"><span class="hl_varref"><span class="mpre">setServerDHParams</span></span></a><span class="mpre"> </span><a href="#loc_334_24_334_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_334_24_334_32&#39;)"><span class="hl_varref"><span class="mpre">dhparams</span></span></a><span class="mpre">

</span><a href="#loc_317_1_317_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_1_317_25&#39;)"><span class="hl_fundecl"><span class="mpre">processServerKeyExchange</span></span></a><span class="mpre"> </span><a name="loc_341_26_341_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_341_26_341_29&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_341_30_341_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_341_30_341_31&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = </span><a href="#loc_344_1_344_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_1_344_26&#39;)"><span class="hl_varref"><span class="mpre">processCertificateRequest</span></span></a><span class="mpre"> </span><a href="#loc_341_26_341_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_341_26_341_29&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_341_30_341_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_341_30_341_31&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">

</span><a href="#loc_344_1_344_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_1_344_26&#39;)"><span class="mpre">processCertificateRequest</span></a><span class="mpre"> :: </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Struct.html#loc_252_6_252_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_252_6_252_15&#39;)"><span class="hl_tyconref"><span class="mpre">Handshake</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.TLS.Handshake.Common.html#loc_89_6_89_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_89_6_89_15&#39;)"><span class="hl_tyconref"><span class="mpre">RecvState</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre">)
</span><a name="loc_344_1_344_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_1_344_26&#39;)"><span class="hl_fundecl"><span class="mpre">processCertificateRequest</span></span></a><span class="mpre"> </span><a name="loc_344_27_344_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_27_344_30&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_260_7_260_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_260_7_260_18&#39;)"><span class="hl_conref"><span class="mpre">CertRequest</span></span></a><span class="mpre"> </span><a name="loc_344_44_344_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_44_344_50&#39;)"><span class="hl_vardecl"><span class="mpre">cTypes</span></span></a><span class="mpre"> </span><a name="loc_344_51_344_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_51_344_58&#39;)"><span class="hl_vardecl"><span class="mpre">sigAlgs</span></span></a><span class="mpre"> </span><a name="loc_344_59_344_65" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_59_344_65&#39;)"><span class="hl_vardecl"><span class="mpre">dNames</span></span></a><span class="mpre">) = do
    </span><span class="hl_comment"><span class="mpre">-- When the server requests a client</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- certificate, we simply store the</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- information for later.</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
    </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_344_27_344_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_27_344_30&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_157_1_157_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_157_1_157_21&#39;)"><span class="hl_varref"><span class="mpre">setClientCertRequest</span></span></a><span class="mpre"> (</span><a href="#loc_344_44_344_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_44_344_50&#39;)"><span class="hl_varref"><span class="mpre">cTypes</span></span></a><span class="mpre">, </span><a href="#loc_344_51_344_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_51_344_58&#39;)"><span class="hl_varref"><span class="mpre">sigAlgs</span></span></a><span class="mpre">, </span><a href="#loc_344_59_344_65" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_59_344_65&#39;)"><span class="hl_varref"><span class="mpre">dNames</span></span></a><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.Common.html#loc_91_7_91_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_91_7_91_25&#39;)"><span class="hl_conref"><span class="mpre">RecvStateHandshake</span></span></a><span class="mpre"> (</span><a href="#loc_354_1_354_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_1_354_23&#39;)"><span class="hl_varref"><span class="mpre">processServerHelloDone</span></span></a><span class="mpre"> </span><a href="#loc_344_27_344_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_27_344_30&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">)
</span><a href="#loc_344_1_344_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_1_344_26&#39;)"><span class="hl_fundecl"><span class="mpre">processCertificateRequest</span></span></a><span class="mpre"> </span><a name="loc_351_27_351_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_27_351_30&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_351_31_351_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_31_351_32&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = </span><a href="#loc_354_1_354_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_1_354_23&#39;)"><span class="hl_varref"><span class="mpre">processServerHelloDone</span></span></a><span class="mpre"> </span><a href="#loc_351_27_351_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_27_351_30&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_351_31_351_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_31_351_32&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">

</span><a href="#loc_354_1_354_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_1_354_23&#39;)"><span class="mpre">processServerHelloDone</span></a><span class="mpre"> :: </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Struct.html#loc_252_6_252_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_252_6_252_15&#39;)"><span class="hl_tyconref"><span class="mpre">Handshake</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.TLS.Handshake.Common.html#loc_89_6_89_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_89_6_89_15&#39;)"><span class="hl_tyconref"><span class="mpre">RecvState</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre">)
</span><a name="loc_354_1_354_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_1_354_23&#39;)"><span class="hl_fundecl"><span class="mpre">processServerHelloDone</span></span></a><span class="mpre"> _ </span><a href="Network.TLS.Struct.html#loc_257_7_257_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_257_7_257_22&#39;)"><span class="hl_conref"><span class="mpre">ServerHelloDone</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.Common.html#loc_92_7_92_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_92_7_92_20&#39;)"><span class="hl_conref"><span class="mpre">RecvStateDone</span></span></a><span class="mpre">
</span><a href="#loc_354_1_354_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_1_354_23&#39;)"><span class="hl_fundecl"><span class="mpre">processServerHelloDone</span></span></a><span class="mpre"> _ </span><a name="loc_355_26_355_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_355_26_355_27&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Handshake.Common.html#loc_46_1_46_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_46_1_46_11&#39;)"><span class="hl_varref"><span class="mpre">unexpected</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_355_26_355_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_355_26_355_27&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">) (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;server hello data&quot;</span></span><span class="mpre">)
</span></div></body></html>