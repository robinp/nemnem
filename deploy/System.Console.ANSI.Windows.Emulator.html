<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">module System.Console.ANSI.Windows.Emulator (
#include &quot;Exports-Include.hs&quot;
    ) where

import System.Console.ANSI.Common
import qualified System.Console.ANSI.Unix as Unix
import System.Console.ANSI.Windows.Foreign

import System.IO

import Control.Exception (SomeException, </span><a href="Control.Exception.Base.html#loc_170_1_170_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_170_1_170_10&#39;)"><span class="mpre">catchJust</span></a><span class="mpre">)
import Control.Monad (</span><a href="Control.Monad.html#loc_148_1_148_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_148_1_148_6&#39;)"><span class="mpre">guard</span></a><span class="mpre">)

import Data.Bits
import Data.Char (</span><a href="GHC.Unicode.html#loc_143_1_143_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_143_1_143_8&#39;)"><span class="mpre">toLower</span></a><span class="mpre">)
import Data.List


#include &quot;Common-Include.hs&quot;


</span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="mpre">withHandle</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">HANDLE</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_fundecl"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a name="loc_23_12_23_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_12_23_18&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_23_19_23_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_19_23_25&#39;)"><span class="hl_vardecl"><span class="mpre">action</span></span></a><span class="mpre"> = do
    </span><span class="hl_comment"><span class="mpre">-- It&#39;s VERY IMPORTANT that we flush before issuing any sort of Windows API call to change the console</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- because on Windows the arrival of API-initiated state changes is not necessarily synchronised with that</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- of the text they are attempting to modify.</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">hFlush</span></span><span class="mpre"> </span><a href="#loc_23_12_23_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_12_23_18&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">
    </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_303_1_303_19" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_303_1_303_19&#39;)"><span class="hl_varref"><span class="mpre">withHandleToHANDLE</span></span></a><span class="mpre"> </span><a href="#loc_23_12_23_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_12_23_18&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_23_19_23_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_19_23_25&#39;)"><span class="hl_varref"><span class="mpre">action</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- Unfortunately, the emulator is not perfect. In particular, it has a tendency to die with exceptions about</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- invalid handles when it is used with certain Windows consoles (e.g. mintty, terminator, or cygwin sshd).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This happens because in those environments the stdout family of handles are not actually associated with</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a real console.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- My observation is that every time I&#39;ve seen this in practice, the handle we have instead of the actual console</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- handle is there so that the terminal supports ANSI escape codes. So 99% of the time, the correct thing to do is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- just to fall back on the Unix module to output the ANSI codes and hope for the best.</span></span><span class="mpre">
</span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="mpre">emulatorFallback</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_fundecl"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> </span><a name="loc_41_18_41_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_18_41_26&#39;)"><span class="hl_vardecl"><span class="mpre">fallback</span></span></a><span class="mpre"> </span><a name="loc_41_27_41_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_27_41_36&#39;)"><span class="hl_vardecl"><span class="mpre">first_try</span></span></a><span class="mpre"> = </span><a href="Control.Exception.Base.html#loc_170_1_170_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_170_1_170_10&#39;)"><span class="hl_varref"><span class="mpre">catchJust</span></span></a><span class="mpre"> (\</span><a name="loc_41_51_41_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_51_41_52&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; </span><a href="Control.Monad.html#loc_148_1_148_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_148_1_148_6&#39;)"><span class="hl_varref"><span class="mpre">guard</span></span></a><span class="mpre"> (</span><a href="#loc_46_5_46_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_5_46_31&#39;)"><span class="hl_varref"><span class="mpre">isHandleIsInvalidException</span></span></a><span class="mpre"> </span><a href="#loc_41_51_41_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_51_41_52&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">) </span><a href="#loc_41_27_41_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_27_41_36&#39;)"><span class="hl_varref"><span class="mpre">first_try</span></span></a><span class="mpre"> (\</span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><a href="#loc_41_18_41_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_18_41_26&#39;)"><span class="hl_varref"><span class="mpre">fallback</span></span></a><span class="mpre">)
  where
    </span><span class="hl_comment"><span class="mpre">-- NB: this is a pretty hacked-up way to find out if we have the right sort of exception, but System.Win32.Types.fail* call into</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- the fail :: String -&gt; IO a function, and so we don&#39;t get any nice exception object we can extract information from.</span></span><span class="mpre">
    </span><a href="#loc_46_5_46_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_5_46_31&#39;)"><span class="mpre">isHandleIsInvalidException</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">SomeException</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
    </span><a name="loc_46_5_46_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_5_46_31&#39;)"><span class="hl_fundecl"><span class="mpre">isHandleIsInvalidException</span></span></a><span class="mpre"> </span><a name="loc_46_32_46_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_32_46_33&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;the handle is invalid&quot;</span></span><span class="mpre"> </span><a href="Data.List.html#loc_305_1_305_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_305_1_305_10&#39;)"><span class="hl_infix"><span class="mpre">`isInfixOf`</span></span></a><span class="mpre"> </span><a href="#loc_47_13_47_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_13_47_21&#39;)"><span class="hl_varref"><span class="mpre">e_string</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;invalid handle&quot;</span></span><span class="mpre"> </span><a href="Data.List.html#loc_305_1_305_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_305_1_305_10&#39;)"><span class="hl_infix"><span class="mpre">`isInfixOf`</span></span></a><span class="mpre"> </span><a href="#loc_47_13_47_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_13_47_21&#39;)"><span class="hl_varref"><span class="mpre">e_string</span></span></a><span class="mpre">
      where </span><a name="loc_47_13_47_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_13_47_21&#39;)"><span class="hl_vardecl"><span class="mpre">e_string</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="GHC.Unicode.html#loc_143_1_143_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_143_1_143_8&#39;)"><span class="hl_varref"><span class="mpre">toLower</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_46_32_46_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_32_46_33&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">)


</span><a href="#loc_51_1_51_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_21&#39;)"><span class="mpre">adjustCursorPosition</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">HANDLE</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">SHORT</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">SHORT</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">SHORT</span></span><span class="mpre">) -&gt; (</span><span class="hl_tyconref"><span class="mpre">SHORT</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">SHORT</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">SHORT</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_51_1_51_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_21&#39;)"><span class="hl_fundecl"><span class="mpre">adjustCursorPosition</span></span></a><span class="mpre"> </span><a name="loc_51_22_51_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_22_51_28&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_51_29_51_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_29_51_37&#39;)"><span class="hl_vardecl"><span class="mpre">change_x</span></span></a><span class="mpre"> </span><a name="loc_51_38_51_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_38_51_46&#39;)"><span class="hl_vardecl"><span class="mpre">change_y</span></span></a><span class="mpre"> = do
    </span><a name="loc_52_5_52_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_23&#39;)"><span class="hl_vardecl"><span class="mpre">screen_buffer_info</span></span></a><span class="mpre"> &lt;- </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_248_1_248_27" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_248_1_248_27&#39;)"><span class="hl_varref"><span class="mpre">getConsoleScreenBufferInfo</span></span></a><span class="mpre"> </span><a href="#loc_51_22_51_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_22_51_28&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">
    let </span><a name="loc_53_9_53_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_15&#39;)"><span class="hl_vardecl"><span class="mpre">window</span></span></a><span class="mpre"> = </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_165_9_165_20" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_165_9_165_20&#39;)"><span class="hl_varref"><span class="mpre">csbi_window</span></span></a><span class="mpre"> </span><a href="#loc_52_5_52_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_23&#39;)"><span class="hl_varref"><span class="mpre">screen_buffer_info</span></span></a><span class="mpre">
        (</span><span class="hl_conref"><span class="mpre">COORD</span></span><span class="mpre"> </span><a name="loc_54_16_54_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_16_54_17&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> </span><a name="loc_54_18_54_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_18_54_19&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre">) = </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_163_9_163_29" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_163_9_163_29&#39;)"><span class="hl_varref"><span class="mpre">csbi_cursor_position</span></span></a><span class="mpre"> </span><a href="#loc_52_5_52_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_23&#39;)"><span class="hl_varref"><span class="mpre">screen_buffer_info</span></span></a><span class="mpre">
        </span><a name="loc_55_9_55_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_9_55_20&#39;)"><span class="hl_vardecl"><span class="mpre">cursor_pos&#39;</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">COORD</span></span><span class="mpre"> (</span><a href="#loc_51_29_51_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_29_51_37&#39;)"><span class="hl_varref"><span class="mpre">change_x</span></span></a><span class="mpre"> (</span><a href="System.Console.ANSI.Windows.Foreign.html#loc_118_1_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_118_1_118_10&#39;)"><span class="hl_varref"><span class="mpre">rect_left</span></span></a><span class="mpre"> </span><a href="#loc_53_9_53_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_15&#39;)"><span class="hl_varref"><span class="mpre">window</span></span></a><span class="mpre">) </span><a href="#loc_54_16_54_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_16_54_17&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) (</span><a href="#loc_51_38_51_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_38_51_46&#39;)"><span class="hl_varref"><span class="mpre">change_y</span></span></a><span class="mpre"> (</span><a href="System.Console.ANSI.Windows.Foreign.html#loc_117_1_117_9" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_117_1_117_9&#39;)"><span class="hl_varref"><span class="mpre">rect_top</span></span></a><span class="mpre"> </span><a href="#loc_53_9_53_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_15&#39;)"><span class="hl_varref"><span class="mpre">window</span></span></a><span class="mpre">) </span><a href="#loc_54_18_54_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_18_54_19&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">)
    </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_262_1_262_25" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_262_1_262_25&#39;)"><span class="hl_varref"><span class="mpre">setConsoleCursorPosition</span></span></a><span class="mpre"> </span><a href="#loc_51_22_51_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_22_51_28&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_55_9_55_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_9_55_20&#39;)"><span class="hl_varref"><span class="mpre">cursor_pos&#39;</span></span></a><span class="mpre">

</span><span class="hl_fundecl"><span class="mpre">hCursorUp</span></span><span class="mpre"> </span><a name="loc_58_11_58_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_11_58_12&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_58_13_58_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_13_58_14&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">       = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hCursorUp</span></span><span class="mpre"> </span><a href="#loc_58_11_58_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_11_58_12&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_58_13_58_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_13_58_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">)       </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_58_11_58_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_11_58_12&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_58_85_58_91" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_85_58_91&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_51_1_51_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_21&#39;)"><span class="hl_varref"><span class="mpre">adjustCursorPosition</span></span></a><span class="mpre"> </span><a href="#loc_58_85_58_91" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_85_58_91&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> (\_ </span><a name="loc_58_127_58_128" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_127_58_128&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_58_127_58_128" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_127_58_128&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) (\_ </span><a name="loc_58_139_58_140" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_139_58_140&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_58_139_58_140" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_139_58_140&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_58_13_58_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_13_58_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">)
</span><span class="hl_fundecl"><span class="mpre">hCursorDown</span></span><span class="mpre"> </span><a name="loc_59_13_59_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_13_59_14&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_59_15_59_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_15_59_16&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">     = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hCursorDown</span></span><span class="mpre"> </span><a href="#loc_59_13_59_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_13_59_14&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_59_15_59_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_15_59_16&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">)     </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_59_13_59_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_13_59_14&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_59_85_59_91" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_85_59_91&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_51_1_51_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_21&#39;)"><span class="hl_varref"><span class="mpre">adjustCursorPosition</span></span></a><span class="mpre"> </span><a href="#loc_59_85_59_91" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_85_59_91&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> (\_ </span><a name="loc_59_127_59_128" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_127_59_128&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_59_127_59_128" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_127_59_128&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) (\_ </span><a name="loc_59_139_59_140" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_139_59_140&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_59_139_59_140" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_139_59_140&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_59_15_59_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_15_59_16&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">)
</span><span class="hl_fundecl"><span class="mpre">hCursorForward</span></span><span class="mpre"> </span><a name="loc_60_16_60_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_16_60_17&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_60_18_60_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_18_60_19&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">  = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hCursorForward</span></span><span class="mpre"> </span><a href="#loc_60_16_60_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_16_60_17&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_60_18_60_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_18_60_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">)  </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_60_16_60_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_16_60_17&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_60_85_60_91" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_85_60_91&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_51_1_51_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_21&#39;)"><span class="hl_varref"><span class="mpre">adjustCursorPosition</span></span></a><span class="mpre"> </span><a href="#loc_60_85_60_91" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_85_60_91&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> (\_ </span><a name="loc_60_127_60_128" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_127_60_128&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_60_127_60_128" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_127_60_128&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_60_18_60_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_18_60_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">) (\_ </span><a name="loc_60_156_60_157" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_156_60_157&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_60_156_60_157" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_156_60_157&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">)
</span><span class="hl_fundecl"><span class="mpre">hCursorBackward</span></span><span class="mpre"> </span><a name="loc_61_17_61_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_17_61_18&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_61_19_61_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_19_61_20&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hCursorBackward</span></span><span class="mpre"> </span><a href="#loc_61_17_61_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_17_61_18&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_61_19_61_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_19_61_20&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_61_17_61_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_17_61_18&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_61_85_61_91" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_85_61_91&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_51_1_51_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_21&#39;)"><span class="hl_varref"><span class="mpre">adjustCursorPosition</span></span></a><span class="mpre"> </span><a href="#loc_61_85_61_91" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_85_61_91&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> (\_ </span><a name="loc_61_127_61_128" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_127_61_128&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_61_127_61_128" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_127_61_128&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_61_19_61_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_19_61_20&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">) (\_ </span><a name="loc_61_156_61_157" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_156_61_157&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_61_156_61_157" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_156_61_157&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">)

</span><span class="hl_fundecl"><span class="mpre">cursorUpCode</span></span><span class="mpre"> _       = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
</span><span class="hl_fundecl"><span class="mpre">cursorDownCode</span></span><span class="mpre"> _     = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
</span><span class="hl_fundecl"><span class="mpre">cursorForwardCode</span></span><span class="mpre"> _  = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
</span><span class="hl_fundecl"><span class="mpre">cursorBackwardCode</span></span><span class="mpre"> _ = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">


</span><a href="#loc_70_1_70_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_1_70_11&#39;)"><span class="mpre">adjustLine</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">HANDLE</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">SHORT</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">SHORT</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">SHORT</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_70_1_70_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_1_70_11&#39;)"><span class="hl_fundecl"><span class="mpre">adjustLine</span></span></a><span class="mpre"> </span><a name="loc_70_12_70_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_12_70_18&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_70_19_70_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_19_70_27&#39;)"><span class="hl_vardecl"><span class="mpre">change_y</span></span></a><span class="mpre"> = </span><a href="#loc_51_1_51_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_21&#39;)"><span class="hl_varref"><span class="mpre">adjustCursorPosition</span></span></a><span class="mpre"> </span><a href="#loc_70_12_70_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_12_70_18&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> (\</span><a name="loc_70_60_70_71" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_60_70_71&#39;)"><span class="hl_vardecl"><span class="mpre">window_left</span></span></a><span class="mpre"> _ -&gt; </span><a href="#loc_70_60_70_71" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_60_70_71&#39;)"><span class="hl_varref"><span class="mpre">window_left</span></span></a><span class="mpre">) </span><a href="#loc_70_19_70_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_19_70_27&#39;)"><span class="hl_varref"><span class="mpre">change_y</span></span></a><span class="mpre">

</span><span class="hl_fundecl"><span class="mpre">hCursorDownLine</span></span><span class="mpre"> </span><a name="loc_72_17_72_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_17_72_18&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_72_19_72_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_19_72_20&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hCursorDownLine</span></span><span class="mpre"> </span><a href="#loc_72_17_72_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_17_72_18&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_72_19_72_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_19_72_20&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_72_17_72_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_17_72_18&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_72_85_72_91" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_85_72_91&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_70_1_70_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_1_70_11&#39;)"><span class="hl_varref"><span class="mpre">adjustLine</span></span></a><span class="mpre"> </span><a href="#loc_72_85_72_91" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_85_72_91&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> (\_ </span><a name="loc_72_117_72_118" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_117_72_118&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_72_117_72_118" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_117_72_118&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_72_19_72_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_19_72_20&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">)
</span><span class="hl_fundecl"><span class="mpre">hCursorUpLine</span></span><span class="mpre"> </span><a name="loc_73_15_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_15_73_16&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_73_17_73_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_17_73_18&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">   = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hCursorUpLine</span></span><span class="mpre"> </span><a href="#loc_73_15_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_15_73_16&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_73_17_73_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_17_73_18&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">)   </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_73_15_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_15_73_16&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_73_85_73_91" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_85_73_91&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_70_1_70_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_1_70_11&#39;)"><span class="hl_varref"><span class="mpre">adjustLine</span></span></a><span class="mpre"> </span><a href="#loc_73_85_73_91" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_85_73_91&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> (\_ </span><a name="loc_73_117_73_118" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_117_73_118&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_73_117_73_118" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_117_73_118&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_73_17_73_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_17_73_18&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">)

</span><span class="hl_fundecl"><span class="mpre">cursorDownLineCode</span></span><span class="mpre"> _   = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
</span><span class="hl_fundecl"><span class="mpre">cursorUpLineCode</span></span><span class="mpre"> _ = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">


</span><span class="hl_fundecl"><span class="mpre">hSetCursorColumn</span></span><span class="mpre"> </span><a name="loc_79_18_79_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_18_79_19&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_79_20_79_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_20_79_21&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hSetCursorColumn</span></span><span class="mpre"> </span><a href="#loc_79_18_79_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_18_79_19&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_79_20_79_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_20_79_21&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_79_18_79_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_18_79_19&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_79_87_79_93" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_87_79_93&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_51_1_51_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_21&#39;)"><span class="hl_varref"><span class="mpre">adjustCursorPosition</span></span></a><span class="mpre"> </span><a href="#loc_79_87_79_93" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_87_79_93&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> (\</span><a name="loc_79_127_79_138" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_127_79_138&#39;)"><span class="hl_vardecl"><span class="mpre">window_left</span></span></a><span class="mpre"> _ -&gt; </span><a href="#loc_79_127_79_138" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_127_79_138&#39;)"><span class="hl_varref"><span class="mpre">window_left</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_79_20_79_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_20_79_21&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) (\_ </span><a name="loc_79_178_79_179" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_178_79_179&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_79_178_79_179" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_178_79_179&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">)

</span><span class="hl_fundecl"><span class="mpre">setCursorColumnCode</span></span><span class="mpre"> _ = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">


</span><span class="hl_fundecl"><span class="mpre">hSetCursorPosition</span></span><span class="mpre"> </span><a name="loc_84_20_84_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_20_84_21&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_84_22_84_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_22_84_23&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre"> </span><a name="loc_84_24_84_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_24_84_25&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hSetCursorPosition</span></span><span class="mpre"> </span><a href="#loc_84_20_84_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_20_84_21&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_84_22_84_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_22_84_23&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre"> </span><a href="#loc_84_24_84_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_24_84_25&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_84_20_84_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_20_84_21&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_84_95_84_101" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_95_84_101&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_51_1_51_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_21&#39;)"><span class="hl_varref"><span class="mpre">adjustCursorPosition</span></span></a><span class="mpre"> </span><a href="#loc_84_95_84_101" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_95_84_101&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> (\</span><a name="loc_84_135_84_146" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_135_84_146&#39;)"><span class="hl_vardecl"><span class="mpre">window_left</span></span></a><span class="mpre"> _ -&gt; </span><a href="#loc_84_135_84_146" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_135_84_146&#39;)"><span class="hl_varref"><span class="mpre">window_left</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_84_24_84_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_24_84_25&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) (\</span><a name="loc_84_184_84_194" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_184_84_194&#39;)"><span class="hl_vardecl"><span class="mpre">window_top</span></span></a><span class="mpre"> _ -&gt; </span><a href="#loc_84_184_84_194" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_184_84_194&#39;)"><span class="hl_varref"><span class="mpre">window_top</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_84_22_84_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_22_84_23&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">)

</span><span class="hl_fundecl"><span class="mpre">setCursorPositionCode</span></span><span class="mpre"> _ _ = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">


</span><a href="#loc_90_1_90_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_10&#39;)"><span class="mpre">clearChar</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">WCHAR</span></span><span class="mpre">
</span><a name="loc_90_1_90_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_10&#39;)"><span class="hl_vardecl"><span class="mpre">clearChar</span></span></a><span class="mpre"> = </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_63_1_63_12" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_63_1_63_12&#39;)"><span class="hl_varref"><span class="mpre">charToWCHAR</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39; &#39;</span></span><span class="mpre">

</span><a href="#loc_93_1_93_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_15&#39;)"><span class="mpre">clearAttribute</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">WORD</span></span><span class="mpre">
</span><a name="loc_93_1_93_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_15&#39;)"><span class="hl_vardecl"><span class="mpre">clearAttribute</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">

</span><a href="#loc_96_1_96_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_21&#39;)"><span class="mpre">hClearScreenFraction</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">HANDLE</span></span><span class="mpre"> -&gt; (</span><a href="System.Console.ANSI.Windows.Foreign.html#loc_111_6_111_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_111_6_111_16&#39;)"><span class="hl_tyconref"><span class="mpre">SMALL_RECT</span></span></a><span class="mpre"> -&gt; </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_89_6_89_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_89_6_89_11&#39;)"><span class="hl_tyconref"><span class="mpre">COORD</span></span></a><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">DWORD</span></span><span class="mpre">, </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_89_6_89_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_89_6_89_11&#39;)"><span class="hl_tyconref"><span class="mpre">COORD</span></span></a><span class="mpre">)) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_96_1_96_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_21&#39;)"><span class="hl_fundecl"><span class="mpre">hClearScreenFraction</span></span></a><span class="mpre"> </span><a name="loc_96_22_96_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_22_96_28&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_96_29_96_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_29_96_44&#39;)"><span class="hl_vardecl"><span class="mpre">fraction_finder</span></span></a><span class="mpre"> = do
    </span><a name="loc_97_5_97_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_5_97_23&#39;)"><span class="hl_vardecl"><span class="mpre">screen_buffer_info</span></span></a><span class="mpre"> &lt;- </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_248_1_248_27" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_248_1_248_27&#39;)"><span class="hl_varref"><span class="mpre">getConsoleScreenBufferInfo</span></span></a><span class="mpre"> </span><a href="#loc_96_22_96_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_22_96_28&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">
    
    let </span><a name="loc_99_9_99_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_9_99_15&#39;)"><span class="hl_vardecl"><span class="mpre">window</span></span></a><span class="mpre"> = </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_165_9_165_20" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_165_9_165_20&#39;)"><span class="hl_varref"><span class="mpre">csbi_window</span></span></a><span class="mpre"> </span><a href="#loc_97_5_97_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_5_97_23&#39;)"><span class="hl_varref"><span class="mpre">screen_buffer_info</span></span></a><span class="mpre">
        </span><a name="loc_100_9_100_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_9_100_19&#39;)"><span class="hl_vardecl"><span class="mpre">cursor_pos</span></span></a><span class="mpre"> = </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_163_9_163_29" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_163_9_163_29&#39;)"><span class="hl_varref"><span class="mpre">csbi_cursor_position</span></span></a><span class="mpre"> </span><a href="#loc_97_5_97_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_5_97_23&#39;)"><span class="hl_varref"><span class="mpre">screen_buffer_info</span></span></a><span class="mpre">
        (</span><a name="loc_101_10_101_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_10_101_21&#39;)"><span class="hl_vardecl"><span class="mpre">fill_length</span></span></a><span class="mpre">, </span><a name="loc_101_23_101_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_23_101_38&#39;)"><span class="hl_vardecl"><span class="mpre">fill_cursor_pos</span></span></a><span class="mpre">) = </span><a href="#loc_96_29_96_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_29_96_44&#39;)"><span class="hl_varref"><span class="mpre">fraction_finder</span></span></a><span class="mpre"> </span><a href="#loc_99_9_99_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_9_99_15&#39;)"><span class="hl_varref"><span class="mpre">window</span></span></a><span class="mpre"> </span><a href="#loc_100_9_100_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_9_100_19&#39;)"><span class="hl_varref"><span class="mpre">cursor_pos</span></span></a><span class="mpre">
    
    </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_278_1_278_27" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_278_1_278_27&#39;)"><span class="hl_varref"><span class="mpre">fillConsoleOutputCharacter</span></span></a><span class="mpre"> </span><a href="#loc_96_22_96_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_22_96_28&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_90_1_90_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_10&#39;)"><span class="hl_varref"><span class="mpre">clearChar</span></span></a><span class="mpre"> </span><a href="#loc_101_10_101_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_10_101_21&#39;)"><span class="hl_varref"><span class="mpre">fill_length</span></span></a><span class="mpre"> </span><a href="#loc_101_23_101_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_23_101_38&#39;)"><span class="hl_varref"><span class="mpre">fill_cursor_pos</span></span></a><span class="mpre">
    </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_273_1_273_27" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_273_1_273_27&#39;)"><span class="hl_varref"><span class="mpre">fillConsoleOutputAttribute</span></span></a><span class="mpre"> </span><a href="#loc_96_22_96_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_22_96_28&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_93_1_93_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_15&#39;)"><span class="hl_varref"><span class="mpre">clearAttribute</span></span></a><span class="mpre"> </span><a href="#loc_101_10_101_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_10_101_21&#39;)"><span class="hl_varref"><span class="mpre">fill_length</span></span></a><span class="mpre"> </span><a href="#loc_101_23_101_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_23_101_38&#39;)"><span class="hl_varref"><span class="mpre">fill_cursor_pos</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><span class="hl_fundecl"><span class="mpre">hClearFromCursorToScreenEnd</span></span><span class="mpre"> </span><a name="loc_107_29_107_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_29_107_30&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hClearFromCursorToScreenEnd</span></span><span class="mpre"> </span><a href="#loc_107_29_107_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_29_107_30&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_107_29_107_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_29_107_30&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_107_105_107_111" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_105_107_111&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_96_1_96_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_21&#39;)"><span class="hl_varref"><span class="mpre">hClearScreenFraction</span></span></a><span class="mpre"> </span><a href="#loc_107_105_107_111" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_105_107_111&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_109_5_109_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_5_109_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">
  where
    </span><a name="loc_109_5_109_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_5_109_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_109_8_109_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_8_109_14&#39;)"><span class="hl_vardecl"><span class="mpre">window</span></span></a><span class="mpre"> </span><a name="loc_109_15_109_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_15_109_25&#39;)"><span class="hl_vardecl"><span class="mpre">cursor_pos</span></span></a><span class="mpre"> = (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_114_9_114_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_9_114_20&#39;)"><span class="hl_varref"><span class="mpre">fill_length</span></span></a><span class="mpre">, </span><a href="#loc_109_15_109_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_15_109_25&#39;)"><span class="hl_varref"><span class="mpre">cursor_pos</span></span></a><span class="mpre">)
      where
        </span><a name="loc_111_9_111_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_9_111_15&#39;)"><span class="hl_vardecl"><span class="mpre">size_x</span></span></a><span class="mpre"> = </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_123_1_123_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_123_1_123_11&#39;)"><span class="hl_varref"><span class="mpre">rect_width</span></span></a><span class="mpre"> </span><a href="#loc_109_8_109_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_8_109_14&#39;)"><span class="hl_varref"><span class="mpre">window</span></span></a><span class="mpre">
        </span><a name="loc_112_9_112_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_9_112_15&#39;)"><span class="hl_vardecl"><span class="mpre">size_y</span></span></a><span class="mpre"> = </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_119_1_119_12" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_119_1_119_12&#39;)"><span class="hl_varref"><span class="mpre">rect_bottom</span></span></a><span class="mpre"> </span><a href="#loc_109_8_109_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_8_109_14&#39;)"><span class="hl_varref"><span class="mpre">window</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_91_9_91_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_91_9_91_16&#39;)"><span class="hl_varref"><span class="mpre">coord_y</span></span></a><span class="mpre"> </span><a href="#loc_109_15_109_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_15_109_25&#39;)"><span class="hl_varref"><span class="mpre">cursor_pos</span></span></a><span class="mpre">
        </span><a name="loc_113_9_113_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_9_113_23&#39;)"><span class="hl_vardecl"><span class="mpre">line_remainder</span></span></a><span class="mpre"> = </span><a href="#loc_111_9_111_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_9_111_15&#39;)"><span class="hl_varref"><span class="mpre">size_x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_90_9_90_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_90_9_90_16&#39;)"><span class="hl_varref"><span class="mpre">coord_x</span></span></a><span class="mpre"> </span><a href="#loc_109_15_109_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_15_109_25&#39;)"><span class="hl_varref"><span class="mpre">cursor_pos</span></span></a><span class="mpre">
        </span><a name="loc_114_9_114_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_9_114_20&#39;)"><span class="hl_vardecl"><span class="mpre">fill_length</span></span></a><span class="mpre"> = </span><a href="#loc_111_9_111_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_9_111_15&#39;)"><span class="hl_varref"><span class="mpre">size_x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><a href="#loc_112_9_112_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_9_112_15&#39;)"><span class="hl_varref"><span class="mpre">size_y</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_113_9_113_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_9_113_23&#39;)"><span class="hl_varref"><span class="mpre">line_remainder</span></span></a><span class="mpre">

</span><span class="hl_fundecl"><span class="mpre">hClearFromCursorToScreenBeginning</span></span><span class="mpre"> </span><a name="loc_116_35_116_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_35_116_36&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hClearFromCursorToScreenBeginning</span></span><span class="mpre"> </span><a href="#loc_116_35_116_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_35_116_36&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_116_35_116_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_35_116_36&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_116_117_116_123" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_117_116_123&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_96_1_96_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_21&#39;)"><span class="hl_varref"><span class="mpre">hClearScreenFraction</span></span></a><span class="mpre"> </span><a href="#loc_116_117_116_123" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_117_116_123&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_118_5_118_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_5_118_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">
  where
    </span><a name="loc_118_5_118_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_5_118_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_118_8_118_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_8_118_14&#39;)"><span class="hl_vardecl"><span class="mpre">window</span></span></a><span class="mpre"> </span><a name="loc_118_15_118_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_15_118_25&#39;)"><span class="hl_vardecl"><span class="mpre">cursor_pos</span></span></a><span class="mpre"> = (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_123_9_123_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_9_123_20&#39;)"><span class="hl_varref"><span class="mpre">fill_length</span></span></a><span class="mpre">, </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_112_9_112_22" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_112_9_112_22&#39;)"><span class="hl_varref"><span class="mpre">rect_top_left</span></span></a><span class="mpre"> </span><a href="#loc_118_8_118_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_8_118_14&#39;)"><span class="hl_varref"><span class="mpre">window</span></span></a><span class="mpre">)
      where
        </span><a name="loc_120_9_120_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_9_120_15&#39;)"><span class="hl_vardecl"><span class="mpre">size_x</span></span></a><span class="mpre"> = </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_123_1_123_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_123_1_123_11&#39;)"><span class="hl_varref"><span class="mpre">rect_width</span></span></a><span class="mpre"> </span><a href="#loc_118_8_118_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_8_118_14&#39;)"><span class="hl_varref"><span class="mpre">window</span></span></a><span class="mpre">
        </span><a name="loc_121_9_121_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_9_121_15&#39;)"><span class="hl_vardecl"><span class="mpre">size_y</span></span></a><span class="mpre"> = </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_91_9_91_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_91_9_91_16&#39;)"><span class="hl_varref"><span class="mpre">coord_y</span></span></a><span class="mpre"> </span><a href="#loc_118_15_118_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_15_118_25&#39;)"><span class="hl_varref"><span class="mpre">cursor_pos</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_117_1_117_9" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_117_1_117_9&#39;)"><span class="hl_varref"><span class="mpre">rect_top</span></span></a><span class="mpre"> </span><a href="#loc_118_8_118_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_8_118_14&#39;)"><span class="hl_varref"><span class="mpre">window</span></span></a><span class="mpre">
        </span><a name="loc_122_9_122_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_9_122_23&#39;)"><span class="hl_vardecl"><span class="mpre">line_remainder</span></span></a><span class="mpre"> = </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_90_9_90_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_90_9_90_16&#39;)"><span class="hl_varref"><span class="mpre">coord_x</span></span></a><span class="mpre"> </span><a href="#loc_118_15_118_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_15_118_25&#39;)"><span class="hl_varref"><span class="mpre">cursor_pos</span></span></a><span class="mpre">
        </span><a name="loc_123_9_123_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_9_123_20&#39;)"><span class="hl_vardecl"><span class="mpre">fill_length</span></span></a><span class="mpre"> = </span><a href="#loc_120_9_120_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_9_120_15&#39;)"><span class="hl_varref"><span class="mpre">size_x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><a href="#loc_121_9_121_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_9_121_15&#39;)"><span class="hl_varref"><span class="mpre">size_y</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_122_9_122_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_9_122_23&#39;)"><span class="hl_varref"><span class="mpre">line_remainder</span></span></a><span class="mpre">

</span><span class="hl_fundecl"><span class="mpre">hClearScreen</span></span><span class="mpre"> </span><a name="loc_125_14_125_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_14_125_15&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hClearScreen</span></span><span class="mpre"> </span><a href="#loc_125_14_125_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_14_125_15&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_125_14_125_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_14_125_15&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_125_75_125_81" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_75_125_81&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_96_1_96_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_21&#39;)"><span class="hl_varref"><span class="mpre">hClearScreenFraction</span></span></a><span class="mpre"> </span><a href="#loc_125_75_125_81" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_75_125_81&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_127_5_127_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_5_127_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">
  where
    </span><a name="loc_127_5_127_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_5_127_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_127_8_127_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_8_127_14&#39;)"><span class="hl_vardecl"><span class="mpre">window</span></span></a><span class="mpre"> _ = (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_131_9_131_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_9_131_20&#39;)"><span class="hl_varref"><span class="mpre">fill_length</span></span></a><span class="mpre">, </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_112_9_112_22" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_112_9_112_22&#39;)"><span class="hl_varref"><span class="mpre">rect_top_left</span></span></a><span class="mpre"> </span><a href="#loc_127_8_127_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_8_127_14&#39;)"><span class="hl_varref"><span class="mpre">window</span></span></a><span class="mpre">)
      where
        </span><a name="loc_129_9_129_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_9_129_15&#39;)"><span class="hl_vardecl"><span class="mpre">size_x</span></span></a><span class="mpre"> = </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_123_1_123_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_123_1_123_11&#39;)"><span class="hl_varref"><span class="mpre">rect_width</span></span></a><span class="mpre"> </span><a href="#loc_127_8_127_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_8_127_14&#39;)"><span class="hl_varref"><span class="mpre">window</span></span></a><span class="mpre">
        </span><a name="loc_130_9_130_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_9_130_15&#39;)"><span class="hl_vardecl"><span class="mpre">size_y</span></span></a><span class="mpre"> = </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_124_1_124_12" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_124_1_124_12&#39;)"><span class="hl_varref"><span class="mpre">rect_height</span></span></a><span class="mpre"> </span><a href="#loc_127_8_127_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_8_127_14&#39;)"><span class="hl_varref"><span class="mpre">window</span></span></a><span class="mpre">
        </span><a name="loc_131_9_131_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_9_131_20&#39;)"><span class="hl_vardecl"><span class="mpre">fill_length</span></span></a><span class="mpre"> = </span><a href="#loc_129_9_129_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_9_129_15&#39;)"><span class="hl_varref"><span class="mpre">size_x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><a href="#loc_130_9_130_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_9_130_15&#39;)"><span class="hl_varref"><span class="mpre">size_y</span></span></a><span class="mpre">

</span><span class="hl_fundecl"><span class="mpre">hClearFromCursorToLineEnd</span></span><span class="mpre"> </span><a name="loc_133_27_133_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_27_133_28&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hClearFromCursorToLineEnd</span></span><span class="mpre"> </span><a href="#loc_133_27_133_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_27_133_28&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_133_27_133_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_27_133_28&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_133_101_133_107" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_101_133_107&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_96_1_96_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_21&#39;)"><span class="hl_varref"><span class="mpre">hClearScreenFraction</span></span></a><span class="mpre"> </span><a href="#loc_133_101_133_107" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_101_133_107&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_135_5_135_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_5_135_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">
  where
    </span><a name="loc_135_5_135_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_5_135_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_135_8_135_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_8_135_14&#39;)"><span class="hl_vardecl"><span class="mpre">window</span></span></a><span class="mpre"> </span><a name="loc_135_15_135_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_15_135_25&#39;)"><span class="hl_vardecl"><span class="mpre">cursor_pos</span></span></a><span class="mpre"> = (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="System.Console.ANSI.Windows.Foreign.html#loc_120_1_120_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_120_1_120_11&#39;)"><span class="hl_varref"><span class="mpre">rect_right</span></span></a><span class="mpre"> </span><a href="#loc_135_8_135_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_8_135_14&#39;)"><span class="hl_varref"><span class="mpre">window</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_90_9_90_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_90_9_90_16&#39;)"><span class="hl_varref"><span class="mpre">coord_x</span></span></a><span class="mpre"> </span><a href="#loc_135_15_135_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_15_135_25&#39;)"><span class="hl_varref"><span class="mpre">cursor_pos</span></span></a><span class="mpre">), </span><a href="#loc_135_15_135_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_15_135_25&#39;)"><span class="hl_varref"><span class="mpre">cursor_pos</span></span></a><span class="mpre">)

</span><span class="hl_fundecl"><span class="mpre">hClearFromCursorToLineBeginning</span></span><span class="mpre"> </span><a name="loc_137_33_137_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_33_137_34&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hClearFromCursorToLineBeginning</span></span><span class="mpre"> </span><a href="#loc_137_33_137_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_33_137_34&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_137_33_137_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_33_137_34&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_137_113_137_119" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_113_137_119&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_96_1_96_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_21&#39;)"><span class="hl_varref"><span class="mpre">hClearScreenFraction</span></span></a><span class="mpre"> </span><a href="#loc_137_113_137_119" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_113_137_119&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_139_5_139_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_5_139_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">
  where
    </span><a name="loc_139_5_139_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_5_139_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">window</span></span><span class="mpre"> </span><a name="loc_139_15_139_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_15_139_25&#39;)"><span class="hl_vardecl"><span class="mpre">cursor_pos</span></span></a><span class="mpre"> = (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="System.Console.ANSI.Windows.Foreign.html#loc_90_9_90_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_90_9_90_16&#39;)"><span class="hl_varref"><span class="mpre">coord_x</span></span></a><span class="mpre"> </span><a href="#loc_139_15_139_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_15_139_25&#39;)"><span class="hl_varref"><span class="mpre">cursor_pos</span></span></a><span class="mpre">), </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/ansi-terminal-0.6.1.1/System/Console/ANSI/Windows/Emulator.hs&quot;, srcSpanStartLine = 139, srcSpanStartColumn = 64, srcSpanEndLine = 139, srcSpanEndColumn = 105}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/ansi-terminal-0.6.1.1/System/Console/ANSI/Windows/Emulator.hs&quot;, srcSpanStartLine = 139, srcSpanStartColumn = 75, srcSpanEndLine = 139, srcSpanEndColumn = 76},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/"><span class="mpre">cursor_pos { coord_x = rect_left window }</span></span><span class="mpre">)

</span><span class="hl_fundecl"><span class="mpre">hClearLine</span></span><span class="mpre"> </span><a name="loc_141_12_141_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_12_141_13&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hClearLine</span></span><span class="mpre"> </span><a href="#loc_141_12_141_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_12_141_13&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_141_12_141_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_12_141_13&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_141_71_141_77" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_71_141_77&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_96_1_96_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_21&#39;)"><span class="hl_varref"><span class="mpre">hClearScreenFraction</span></span></a><span class="mpre"> </span><a href="#loc_141_71_141_77" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_71_141_77&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_143_5_143_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_5_143_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">
  where
    </span><a name="loc_143_5_143_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_5_143_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_143_8_143_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_8_143_14&#39;)"><span class="hl_vardecl"><span class="mpre">window</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">cursor_pos</span></span><span class="mpre"> = (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="System.Console.ANSI.Windows.Foreign.html#loc_123_1_123_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_123_1_123_11&#39;)"><span class="hl_varref"><span class="mpre">rect_width</span></span></a><span class="mpre"> </span><a href="#loc_143_8_143_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_8_143_14&#39;)"><span class="hl_varref"><span class="mpre">window</span></span></a><span class="mpre">), </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/ansi-terminal-0.6.1.1/System/Console/ANSI/Windows/Emulator.hs&quot;, srcSpanStartLine = 143, srcSpanStartColumn = 63, srcSpanEndLine = 143, srcSpanEndColumn = 104}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/ansi-terminal-0.6.1.1/System/Console/ANSI/Windows/Emulator.hs&quot;, srcSpanStartLine = 143, srcSpanStartColumn = 74, srcSpanEndLine = 143, srcSpanEndColumn = 75},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/"><span class="mpre">cursor_pos { coord_x = rect_left window }</span></span><span class="mpre">)

</span><span class="hl_vardecl"><span class="mpre">clearFromCursorToScreenEndCode</span></span><span class="mpre">       = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
</span><span class="hl_vardecl"><span class="mpre">clearFromCursorToScreenBeginningCode</span></span><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
</span><span class="hl_vardecl"><span class="mpre">clearScreenCode</span></span><span class="mpre">                      = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
</span><span class="hl_vardecl"><span class="mpre">clearFromCursorToLineEndCode</span></span><span class="mpre">         = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
</span><span class="hl_vardecl"><span class="mpre">clearFromCursorToLineBeginningCode</span></span><span class="mpre">   = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
</span><span class="hl_vardecl"><span class="mpre">clearLineCode</span></span><span class="mpre">                        = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">


</span><a href="#loc_154_1_154_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_12&#39;)"><span class="mpre">hScrollPage</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">HANDLE</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_154_1_154_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_12&#39;)"><span class="hl_fundecl"><span class="mpre">hScrollPage</span></span></a><span class="mpre"> </span><a name="loc_154_13_154_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_13_154_19&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_154_20_154_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_20_154_32&#39;)"><span class="hl_vardecl"><span class="mpre">new_origin_y</span></span></a><span class="mpre"> = do
    </span><a name="loc_155_5_155_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_5_155_23&#39;)"><span class="hl_vardecl"><span class="mpre">screen_buffer_info</span></span></a><span class="mpre"> &lt;- </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_248_1_248_27" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_248_1_248_27&#39;)"><span class="hl_varref"><span class="mpre">getConsoleScreenBufferInfo</span></span></a><span class="mpre"> </span><a href="#loc_154_13_154_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_13_154_19&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">
    let </span><a name="loc_156_9_156_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_9_156_13&#39;)"><span class="hl_vardecl"><span class="mpre">fill</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">CHAR_INFO</span></span><span class="mpre"> </span><a href="#loc_90_1_90_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_10&#39;)"><span class="hl_varref"><span class="mpre">clearChar</span></span></a><span class="mpre"> </span><a href="#loc_93_1_93_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_15&#39;)"><span class="hl_varref"><span class="mpre">clearAttribute</span></span></a><span class="mpre">
        </span><a name="loc_157_9_157_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_15&#39;)"><span class="hl_vardecl"><span class="mpre">window</span></span></a><span class="mpre"> = </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_165_9_165_20" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_165_9_165_20&#39;)"><span class="hl_varref"><span class="mpre">csbi_window</span></span></a><span class="mpre"> </span><a href="#loc_155_5_155_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_5_155_23&#39;)"><span class="hl_varref"><span class="mpre">screen_buffer_info</span></span></a><span class="mpre">
        </span><a name="loc_158_9_158_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_9_158_15&#39;)"><span class="hl_vardecl"><span class="mpre">origin</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">COORD</span></span><span class="mpre"> (</span><a href="System.Console.ANSI.Windows.Foreign.html#loc_118_1_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_118_1_118_10&#39;)"><span class="hl_varref"><span class="mpre">rect_left</span></span></a><span class="mpre"> </span><a href="#loc_157_9_157_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_15&#39;)"><span class="hl_varref"><span class="mpre">window</span></span></a><span class="mpre">) (</span><a href="System.Console.ANSI.Windows.Foreign.html#loc_117_1_117_9" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_117_1_117_9&#39;)"><span class="hl_varref"><span class="mpre">rect_top</span></span></a><span class="mpre"> </span><a href="#loc_157_9_157_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_15&#39;)"><span class="hl_varref"><span class="mpre">window</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_154_20_154_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_20_154_32&#39;)"><span class="hl_varref"><span class="mpre">new_origin_y</span></span></a><span class="mpre">)
    </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_283_1_283_26" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_283_1_283_26&#39;)"><span class="hl_varref"><span class="mpre">scrollConsoleScreenBuffer</span></span></a><span class="mpre"> </span><a href="#loc_154_13_154_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_13_154_19&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_157_9_157_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_15&#39;)"><span class="hl_varref"><span class="mpre">window</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> </span><a href="#loc_158_9_158_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_9_158_15&#39;)"><span class="hl_varref"><span class="mpre">origin</span></span></a><span class="mpre"> </span><a href="#loc_156_9_156_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_9_156_13&#39;)"><span class="hl_varref"><span class="mpre">fill</span></span></a><span class="mpre">

</span><span class="hl_fundecl"><span class="mpre">hScrollPageUp</span></span><span class="mpre">   </span><a name="loc_161_17_161_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_17_161_18&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_161_19_161_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_19_161_20&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hScrollPageUp</span></span><span class="mpre">   </span><a href="#loc_161_17_161_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_17_161_18&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_161_19_161_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_19_161_20&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_161_17_161_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_17_161_18&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_161_85_161_91" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_85_161_91&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_154_1_154_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_12&#39;)"><span class="hl_varref"><span class="mpre">hScrollPage</span></span></a><span class="mpre"> </span><a href="#loc_161_85_161_91" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_85_161_91&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">negate</span></span><span class="mpre"> </span><a href="#loc_161_19_161_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_19_161_20&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">)
</span><span class="hl_fundecl"><span class="mpre">hScrollPageDown</span></span><span class="mpre"> </span><a name="loc_162_17_162_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_17_162_18&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_162_19_162_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_19_162_20&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hScrollPageDown</span></span><span class="mpre"> </span><a href="#loc_162_17_162_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_17_162_18&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_162_19_162_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_19_162_20&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_162_17_162_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_17_162_18&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_162_85_162_91" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_85_162_91&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_154_1_154_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_12&#39;)"><span class="hl_varref"><span class="mpre">hScrollPage</span></span></a><span class="mpre"> </span><a href="#loc_162_85_162_91" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_85_162_91&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_162_19_162_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_19_162_20&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">

</span><span class="hl_fundecl"><span class="mpre">scrollPageUpCode</span></span><span class="mpre"> _   = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
</span><span class="hl_fundecl"><span class="mpre">scrollPageDownCode</span></span><span class="mpre"> _ = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">


</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_170_1_170_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_26&#39;)"><span class="mpre">applyANSIColorToAttribute</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_170_1_170_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_26&#39;)"><span class="mpre">applyANSIColorToAttribute</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">WORD</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">WORD</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">WORD</span></span><span class="mpre"> -&gt; </span><a href="System.Console.ANSI.Common.html#loc_6_6_6_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_6_6_6_11&#39;)"><span class="hl_tyconref"><span class="mpre">Color</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">WORD</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">WORD</span></span><span class="mpre">
</span><a name="loc_170_1_170_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_26&#39;)"><span class="hl_fundecl"><span class="mpre">applyANSIColorToAttribute</span></span></a><span class="mpre"> </span><a name="loc_170_27_170_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_27_170_30&#39;)"><span class="hl_vardecl"><span class="mpre">rED</span></span></a><span class="mpre"> </span><a name="loc_170_31_170_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_31_170_36&#39;)"><span class="hl_vardecl"><span class="mpre">gREEN</span></span></a><span class="mpre"> </span><a name="loc_170_37_170_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_37_170_41&#39;)"><span class="hl_vardecl"><span class="mpre">bLUE</span></span></a><span class="mpre"> </span><a name="loc_170_42_170_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_42_170_47&#39;)"><span class="hl_vardecl"><span class="mpre">color</span></span></a><span class="mpre"> </span><a name="loc_170_48_170_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_48_170_57&#39;)"><span class="hl_vardecl"><span class="mpre">attribute</span></span></a><span class="mpre"> = case </span><a href="#loc_170_42_170_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_42_170_47&#39;)"><span class="hl_varref"><span class="mpre">color</span></span></a><span class="mpre"> of
    </span><a href="System.Console.ANSI.Common.html#loc_6_14_6_19" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_6_14_6_19&#39;)"><span class="hl_conref"><span class="mpre">Black</span></span></a><span class="mpre">   -&gt; </span><a href="#loc_181_5_181_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_5_181_15&#39;)"><span class="hl_varref"><span class="mpre">attribute&#39;</span></span></a><span class="mpre">
    </span><a href="System.Console.ANSI.Common.html#loc_7_14_7_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_7_14_7_17&#39;)"><span class="hl_conref"><span class="mpre">Red</span></span></a><span class="mpre">     -&gt; </span><a href="#loc_181_5_181_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_5_181_15&#39;)"><span class="hl_varref"><span class="mpre">attribute&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_170_27_170_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_27_170_30&#39;)"><span class="hl_varref"><span class="mpre">rED</span></span></a><span class="mpre">
    </span><a href="System.Console.ANSI.Common.html#loc_8_14_8_19" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_8_14_8_19&#39;)"><span class="hl_conref"><span class="mpre">Green</span></span></a><span class="mpre">   -&gt; </span><a href="#loc_181_5_181_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_5_181_15&#39;)"><span class="hl_varref"><span class="mpre">attribute&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_170_31_170_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_31_170_36&#39;)"><span class="hl_varref"><span class="mpre">gREEN</span></span></a><span class="mpre">
    </span><a href="System.Console.ANSI.Common.html#loc_9_14_9_20" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_9_14_9_20&#39;)"><span class="hl_conref"><span class="mpre">Yellow</span></span></a><span class="mpre">  -&gt; </span><a href="#loc_181_5_181_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_5_181_15&#39;)"><span class="hl_varref"><span class="mpre">attribute&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_170_27_170_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_27_170_30&#39;)"><span class="hl_varref"><span class="mpre">rED</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_170_31_170_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_31_170_36&#39;)"><span class="hl_varref"><span class="mpre">gREEN</span></span></a><span class="mpre">
    </span><a href="System.Console.ANSI.Common.html#loc_10_14_10_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_10_14_10_18&#39;)"><span class="hl_conref"><span class="mpre">Blue</span></span></a><span class="mpre">    -&gt; </span><a href="#loc_181_5_181_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_5_181_15&#39;)"><span class="hl_varref"><span class="mpre">attribute&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_170_37_170_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_37_170_41&#39;)"><span class="hl_varref"><span class="mpre">bLUE</span></span></a><span class="mpre">
    </span><a href="System.Console.ANSI.Common.html#loc_11_14_11_21" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_11_14_11_21&#39;)"><span class="hl_conref"><span class="mpre">Magenta</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_181_5_181_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_5_181_15&#39;)"><span class="hl_varref"><span class="mpre">attribute&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_170_27_170_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_27_170_30&#39;)"><span class="hl_varref"><span class="mpre">rED</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_170_37_170_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_37_170_41&#39;)"><span class="hl_varref"><span class="mpre">bLUE</span></span></a><span class="mpre">
    </span><a href="System.Console.ANSI.Common.html#loc_12_14_12_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_12_14_12_18&#39;)"><span class="hl_conref"><span class="mpre">Cyan</span></span></a><span class="mpre">    -&gt; </span><a href="#loc_181_5_181_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_5_181_15&#39;)"><span class="hl_varref"><span class="mpre">attribute&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_170_31_170_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_31_170_36&#39;)"><span class="hl_varref"><span class="mpre">gREEN</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_170_37_170_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_37_170_41&#39;)"><span class="hl_varref"><span class="mpre">bLUE</span></span></a><span class="mpre">
    </span><a href="System.Console.ANSI.Common.html#loc_13_14_13_19" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_13_14_13_19&#39;)"><span class="hl_conref"><span class="mpre">White</span></span></a><span class="mpre">   -&gt; </span><a href="#loc_181_5_181_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_5_181_15&#39;)"><span class="hl_varref"><span class="mpre">attribute&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_180_5_180_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_5_180_10&#39;)"><span class="hl_varref"><span class="mpre">wHITE</span></span></a><span class="mpre">
  where
    </span><a name="loc_180_5_180_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_5_180_10&#39;)"><span class="hl_vardecl"><span class="mpre">wHITE</span></span></a><span class="mpre"> = </span><a href="#loc_170_27_170_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_27_170_30&#39;)"><span class="hl_varref"><span class="mpre">rED</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_170_31_170_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_31_170_36&#39;)"><span class="hl_varref"><span class="mpre">gREEN</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_170_37_170_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_37_170_41&#39;)"><span class="hl_varref"><span class="mpre">bLUE</span></span></a><span class="mpre">
    </span><a name="loc_181_5_181_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_5_181_15&#39;)"><span class="hl_vardecl"><span class="mpre">attribute&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_170_48_170_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_48_170_57&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> (</span><a href="Data.Bits.html#loc_90_5_90_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_90_5_90_15&#39;)"><span class="hl_varref"><span class="mpre">complement</span></span></a><span class="mpre"> </span><a href="#loc_180_5_180_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_5_180_10&#39;)"><span class="hl_varref"><span class="mpre">wHITE</span></span></a><span class="mpre">)

</span><a href="#loc_184_1_184_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_1_184_36&#39;)"><span class="mpre">applyForegroundANSIColorToAttribute</span></a><span class="mpre">, </span><a href="#loc_185_1_185_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_1_185_36&#39;)"><span class="mpre">applyBackgroundANSIColorToAttribute</span></a><span class="mpre"> :: </span><a href="System.Console.ANSI.Common.html#loc_6_6_6_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_6_6_6_11&#39;)"><span class="hl_tyconref"><span class="mpre">Color</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">WORD</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">WORD</span></span><span class="mpre">
</span><a name="loc_184_1_184_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_1_184_36&#39;)"><span class="hl_vardecl"><span class="mpre">applyForegroundANSIColorToAttribute</span></span></a><span class="mpre"> = </span><a href="#loc_170_1_170_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_26&#39;)"><span class="hl_varref"><span class="mpre">applyANSIColorToAttribute</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_217_1_217_15" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_217_1_217_15&#39;)"><span class="hl_varref"><span class="mpre">fOREGROUND_RED</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_216_1_216_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_216_1_216_17&#39;)"><span class="hl_varref"><span class="mpre">fOREGROUND_GREEN</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_215_1_215_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_215_1_215_16&#39;)"><span class="hl_varref"><span class="mpre">fOREGROUND_BLUE</span></span></a><span class="mpre">
</span><a name="loc_185_1_185_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_1_185_36&#39;)"><span class="hl_vardecl"><span class="mpre">applyBackgroundANSIColorToAttribute</span></span></a><span class="mpre"> = </span><a href="#loc_170_1_170_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_26&#39;)"><span class="hl_varref"><span class="mpre">applyANSIColorToAttribute</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_221_1_221_15" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_221_1_221_15&#39;)"><span class="hl_varref"><span class="mpre">bACKGROUND_RED</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_220_1_220_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_220_1_220_17&#39;)"><span class="hl_varref"><span class="mpre">bACKGROUND_GREEN</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_219_1_219_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_219_1_219_16&#39;)"><span class="hl_varref"><span class="mpre">bACKGROUND_BLUE</span></span></a><span class="mpre">

</span><a href="#loc_188_1_188_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_1_188_31&#39;)"><span class="mpre">swapForegroundBackgroundColors</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">WORD</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">WORD</span></span><span class="mpre">
</span><a name="loc_188_1_188_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_1_188_31&#39;)"><span class="hl_fundecl"><span class="mpre">swapForegroundBackgroundColors</span></span></a><span class="mpre"> </span><a name="loc_188_32_188_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_32_188_41&#39;)"><span class="hl_vardecl"><span class="mpre">attribute</span></span></a><span class="mpre"> = </span><a href="#loc_192_5_192_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_5_192_20&#39;)"><span class="hl_varref"><span class="mpre">clean_attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_193_5_193_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_5_193_26&#39;)"><span class="hl_varref"><span class="mpre">foreground_attribute&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_194_5_194_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_5_194_26&#39;)"><span class="hl_varref"><span class="mpre">background_attribute&#39;</span></span></a><span class="mpre">
  where
    </span><a name="loc_190_5_190_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_5_190_25&#39;)"><span class="hl_vardecl"><span class="mpre">foreground_attribute</span></span></a><span class="mpre"> = </span><a href="#loc_188_32_188_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_32_188_41&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_229_1_229_25" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_229_1_229_25&#39;)"><span class="hl_varref"><span class="mpre">fOREGROUND_INTENSE_WHITE</span></span></a><span class="mpre">
    </span><a name="loc_191_5_191_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_5_191_25&#39;)"><span class="hl_vardecl"><span class="mpre">background_attribute</span></span></a><span class="mpre"> = </span><a href="#loc_188_32_188_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_32_188_41&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_230_1_230_25" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_230_1_230_25&#39;)"><span class="hl_varref"><span class="mpre">bACKGROUND_INTENSE_WHITE</span></span></a><span class="mpre">
    </span><a name="loc_192_5_192_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_5_192_20&#39;)"><span class="hl_vardecl"><span class="mpre">clean_attribute</span></span></a><span class="mpre"> = </span><a href="#loc_188_32_188_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_32_188_41&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><a href="Data.Bits.html#loc_90_5_90_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_90_5_90_15&#39;)"><span class="hl_varref"><span class="mpre">complement</span></span></a><span class="mpre"> (</span><a href="System.Console.ANSI.Windows.Foreign.html#loc_229_1_229_25" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_229_1_229_25&#39;)"><span class="hl_varref"><span class="mpre">fOREGROUND_INTENSE_WHITE</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_230_1_230_25" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_230_1_230_25&#39;)"><span class="hl_varref"><span class="mpre">bACKGROUND_INTENSE_WHITE</span></span></a><span class="mpre">)
    </span><a name="loc_193_5_193_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_5_193_26&#39;)"><span class="hl_vardecl"><span class="mpre">foreground_attribute&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_191_5_191_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_5_191_25&#39;)"><span class="hl_varref"><span class="mpre">background_attribute</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">4</span></span><span class="mpre">
    </span><a name="loc_194_5_194_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_5_194_26&#39;)"><span class="hl_vardecl"><span class="mpre">background_attribute&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_190_5_190_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_5_190_25&#39;)"><span class="hl_varref"><span class="mpre">foreground_attribute</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_200_5_200_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_200_5_200_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftL`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">4</span></span><span class="mpre">

</span><a href="#loc_197_1_197_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_1_197_24&#39;)"><span class="mpre">applyANSISGRToAttribute</span></a><span class="mpre"> :: </span><a href="System.Console.ANSI.Common.html#loc_45_6_45_9" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_45_6_45_9&#39;)"><span class="hl_tyconref"><span class="mpre">SGR</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">WORD</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">WORD</span></span><span class="mpre">
</span><a name="loc_197_1_197_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_1_197_24&#39;)"><span class="hl_fundecl"><span class="mpre">applyANSISGRToAttribute</span></span></a><span class="mpre"> </span><a name="loc_197_25_197_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_25_197_28&#39;)"><span class="hl_vardecl"><span class="mpre">sgr</span></span></a><span class="mpre"> </span><a name="loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_vardecl"><span class="mpre">attribute</span></span></a><span class="mpre"> = case </span><a href="#loc_197_25_197_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_25_197_28&#39;)"><span class="hl_varref"><span class="mpre">sgr</span></span></a><span class="mpre"> of
    </span><a href="System.Console.ANSI.Common.html#loc_45_12_45_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_45_12_45_17&#39;)"><span class="hl_conref"><span class="mpre">Reset</span></span></a><span class="mpre"> -&gt; </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_227_1_227_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_227_1_227_17&#39;)"><span class="hl_varref"><span class="mpre">fOREGROUND_WHITE</span></span></a><span class="mpre">
    </span><a href="System.Console.ANSI.Common.html#loc_46_12_46_31" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_46_12_46_31&#39;)"><span class="hl_conref"><span class="mpre">SetConsoleIntensity</span></span></a><span class="mpre"> </span><a name="loc_199_25_199_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_25_199_34&#39;)"><span class="hl_vardecl"><span class="mpre">intensity</span></span></a><span class="mpre"> -&gt; case </span><a href="#loc_199_25_199_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_25_199_34&#39;)"><span class="hl_varref"><span class="mpre">intensity</span></span></a><span class="mpre"> of
        </span><a href="System.Console.ANSI.Common.html#loc_39_25_39_38" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_39_25_39_38&#39;)"><span class="hl_conref"><span class="mpre">BoldIntensity</span></span></a><span class="mpre">   -&gt; </span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_226_5_226_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_5_226_14&#39;)"><span class="hl_varref"><span class="mpre">iNTENSITY</span></span></a><span class="mpre">
        </span><a href="System.Console.ANSI.Common.html#loc_40_25_40_39" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_40_25_40_39&#39;)"><span class="hl_conref"><span class="mpre">FaintIntensity</span></span></a><span class="mpre">  -&gt; </span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> (</span><a href="Data.Bits.html#loc_90_5_90_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_90_5_90_15&#39;)"><span class="hl_varref"><span class="mpre">complement</span></span></a><span class="mpre"> </span><a href="#loc_226_5_226_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_5_226_14&#39;)"><span class="hl_varref"><span class="mpre">iNTENSITY</span></span></a><span class="mpre">) </span><span class="hl_comment"><span class="mpre">-- Not supported</span></span><span class="mpre">
        </span><a href="System.Console.ANSI.Common.html#loc_41_25_41_40" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_41_25_41_40&#39;)"><span class="hl_conref"><span class="mpre">NormalIntensity</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> (</span><a href="Data.Bits.html#loc_90_5_90_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_90_5_90_15&#39;)"><span class="hl_varref"><span class="mpre">complement</span></span></a><span class="mpre"> </span><a href="#loc_226_5_226_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_5_226_14&#39;)"><span class="hl_varref"><span class="mpre">iNTENSITY</span></span></a><span class="mpre">)
    </span><a href="System.Console.ANSI.Common.html#loc_47_12_47_25" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_47_12_47_25&#39;)"><span class="hl_conref"><span class="mpre">SetItalicized</span></span></a><span class="mpre"> _ -&gt; </span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- Not supported</span></span><span class="mpre">
    </span><a href="System.Console.ANSI.Common.html#loc_48_12_48_26" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_48_12_48_26&#39;)"><span class="hl_conref"><span class="mpre">SetUnderlining</span></span></a><span class="mpre"> </span><a name="loc_204_20_204_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_20_204_31&#39;)"><span class="hl_vardecl"><span class="mpre">underlining</span></span></a><span class="mpre"> -&gt; case </span><a href="#loc_204_20_204_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_20_204_31&#39;)"><span class="hl_varref"><span class="mpre">underlining</span></span></a><span class="mpre"> of
        </span><a href="System.Console.ANSI.Common.html#loc_35_20_35_31" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_35_20_35_31&#39;)"><span class="hl_conref"><span class="mpre">NoUnderline</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> (</span><a href="Data.Bits.html#loc_90_5_90_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_90_5_90_15&#39;)"><span class="hl_varref"><span class="mpre">complement</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_224_1_224_22" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_224_1_224_22&#39;)"><span class="hl_varref"><span class="mpre">cOMMON_LVB_UNDERSCORE</span></span></a><span class="mpre">)
        _           -&gt; </span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_224_1_224_22" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_224_1_224_22&#39;)"><span class="hl_varref"><span class="mpre">cOMMON_LVB_UNDERSCORE</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- Not supported, since cOMMON_LVB_UNDERSCORE seems to have no effect</span></span><span class="mpre">
    </span><a href="System.Console.ANSI.Common.html#loc_49_12_49_25" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_49_12_49_25&#39;)"><span class="hl_conref"><span class="mpre">SetBlinkSpeed</span></span></a><span class="mpre"> _ -&gt; </span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- Not supported</span></span><span class="mpre">
    </span><a href="System.Console.ANSI.Common.html#loc_50_12_50_22" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_50_12_50_22&#39;)"><span class="hl_conref"><span class="mpre">SetVisible</span></span></a><span class="mpre"> _    -&gt; </span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- Not supported</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- The cOMMON_LVB_REVERSE_VIDEO doesn&#39;t actually appear to have any affect on the colors being displayed, so the emulator</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- just uses it to carry information and implements the color-swapping behaviour itself. Bit of a hack, I guess :-)</span></span><span class="mpre">
    </span><a href="System.Console.ANSI.Common.html#loc_51_12_51_39" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_51_12_51_39&#39;)"><span class="hl_conref"><span class="mpre">SetSwapForegroundBackground</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> -&gt;
        </span><span class="hl_comment"><span class="mpre">-- Check if the color-swapping flag is already set</span></span><span class="mpre">
        if </span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_223_1_223_25" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_223_1_223_25&#39;)"><span class="hl_varref"><span class="mpre">cOMMON_LVB_REVERSE_VIDEO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
         then </span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre">
         else </span><a href="#loc_188_1_188_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_1_188_31&#39;)"><span class="hl_varref"><span class="mpre">swapForegroundBackgroundColors</span></span></a><span class="mpre"> </span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_223_1_223_25" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_223_1_223_25&#39;)"><span class="hl_varref"><span class="mpre">cOMMON_LVB_REVERSE_VIDEO</span></span></a><span class="mpre">
    </span><a href="System.Console.ANSI.Common.html#loc_51_12_51_39" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_51_12_51_39&#39;)"><span class="hl_conref"><span class="mpre">SetSwapForegroundBackground</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> -&gt;
        </span><span class="hl_comment"><span class="mpre">-- Check if the color-swapping flag is already not set</span></span><span class="mpre">
        if </span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_223_1_223_25" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_223_1_223_25&#39;)"><span class="hl_varref"><span class="mpre">cOMMON_LVB_REVERSE_VIDEO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
         then </span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre">
         else </span><a href="#loc_188_1_188_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_1_188_31&#39;)"><span class="hl_varref"><span class="mpre">swapForegroundBackgroundColors</span></span></a><span class="mpre"> </span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> (</span><a href="Data.Bits.html#loc_90_5_90_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_90_5_90_15&#39;)"><span class="hl_varref"><span class="mpre">complement</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_223_1_223_25" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_223_1_223_25&#39;)"><span class="hl_varref"><span class="mpre">cOMMON_LVB_REVERSE_VIDEO</span></span></a><span class="mpre">)
    </span><a href="System.Console.ANSI.Common.html#loc_52_12_52_20" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_52_12_52_20&#39;)"><span class="hl_conref"><span class="mpre">SetColor</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Common.html#loc_22_21_22_31" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_22_21_22_31&#39;)"><span class="hl_conref"><span class="mpre">Foreground</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Common.html#loc_17_23_17_27" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_17_23_17_27&#39;)"><span class="hl_conref"><span class="mpre">Dull</span></span></a><span class="mpre"> </span><a name="loc_221_30_221_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_30_221_35&#39;)"><span class="hl_vardecl"><span class="mpre">color</span></span></a><span class="mpre">  -&gt; </span><a href="#loc_184_1_184_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_1_184_36&#39;)"><span class="hl_varref"><span class="mpre">applyForegroundANSIColorToAttribute</span></span></a><span class="mpre"> </span><a href="#loc_221_30_221_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_30_221_35&#39;)"><span class="hl_varref"><span class="mpre">color</span></span></a><span class="mpre"> (</span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> (</span><a href="Data.Bits.html#loc_90_5_90_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_90_5_90_15&#39;)"><span class="hl_varref"><span class="mpre">complement</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_218_1_218_21" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_218_1_218_21&#39;)"><span class="hl_varref"><span class="mpre">fOREGROUND_INTENSITY</span></span></a><span class="mpre">))
    </span><a href="System.Console.ANSI.Common.html#loc_52_12_52_20" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_52_12_52_20&#39;)"><span class="hl_conref"><span class="mpre">SetColor</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Common.html#loc_22_21_22_31" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_22_21_22_31&#39;)"><span class="hl_conref"><span class="mpre">Foreground</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Common.html#loc_18_23_18_28" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_18_23_18_28&#39;)"><span class="hl_conref"><span class="mpre">Vivid</span></span></a><span class="mpre"> </span><a name="loc_222_31_222_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_31_222_36&#39;)"><span class="hl_vardecl"><span class="mpre">color</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_184_1_184_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_1_184_36&#39;)"><span class="hl_varref"><span class="mpre">applyForegroundANSIColorToAttribute</span></span></a><span class="mpre"> </span><a href="#loc_222_31_222_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_31_222_36&#39;)"><span class="hl_varref"><span class="mpre">color</span></span></a><span class="mpre"> (</span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_218_1_218_21" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_218_1_218_21&#39;)"><span class="hl_varref"><span class="mpre">fOREGROUND_INTENSITY</span></span></a><span class="mpre">)
    </span><a href="System.Console.ANSI.Common.html#loc_52_12_52_20" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_52_12_52_20&#39;)"><span class="hl_conref"><span class="mpre">SetColor</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Common.html#loc_23_21_23_31" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_23_21_23_31&#39;)"><span class="hl_conref"><span class="mpre">Background</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Common.html#loc_17_23_17_27" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_17_23_17_27&#39;)"><span class="hl_conref"><span class="mpre">Dull</span></span></a><span class="mpre"> </span><a name="loc_223_30_223_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_30_223_35&#39;)"><span class="hl_vardecl"><span class="mpre">color</span></span></a><span class="mpre">  -&gt; </span><a href="#loc_185_1_185_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_1_185_36&#39;)"><span class="hl_varref"><span class="mpre">applyBackgroundANSIColorToAttribute</span></span></a><span class="mpre"> </span><a href="#loc_223_30_223_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_30_223_35&#39;)"><span class="hl_varref"><span class="mpre">color</span></span></a><span class="mpre"> (</span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> (</span><a href="Data.Bits.html#loc_90_5_90_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_90_5_90_15&#39;)"><span class="hl_varref"><span class="mpre">complement</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_222_1_222_21" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_222_1_222_21&#39;)"><span class="hl_varref"><span class="mpre">bACKGROUND_INTENSITY</span></span></a><span class="mpre">))
    </span><a href="System.Console.ANSI.Common.html#loc_52_12_52_20" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_52_12_52_20&#39;)"><span class="hl_conref"><span class="mpre">SetColor</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Common.html#loc_23_21_23_31" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_23_21_23_31&#39;)"><span class="hl_conref"><span class="mpre">Background</span></span></a><span class="mpre"> </span><a href="System.Console.ANSI.Common.html#loc_18_23_18_28" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_18_23_18_28&#39;)"><span class="hl_conref"><span class="mpre">Vivid</span></span></a><span class="mpre"> </span><a name="loc_224_31_224_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_31_224_36&#39;)"><span class="hl_vardecl"><span class="mpre">color</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_185_1_185_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_1_185_36&#39;)"><span class="hl_varref"><span class="mpre">applyBackgroundANSIColorToAttribute</span></span></a><span class="mpre"> </span><a href="#loc_224_31_224_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_31_224_36&#39;)"><span class="hl_varref"><span class="mpre">color</span></span></a><span class="mpre"> (</span><a href="#loc_197_29_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_29_197_38&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_222_1_222_21" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_222_1_222_21&#39;)"><span class="hl_varref"><span class="mpre">bACKGROUND_INTENSITY</span></span></a><span class="mpre">)
  where
    </span><a name="loc_226_5_226_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_5_226_14&#39;)"><span class="hl_vardecl"><span class="mpre">iNTENSITY</span></span></a><span class="mpre"> = </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_218_1_218_21" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_218_1_218_21&#39;)"><span class="hl_varref"><span class="mpre">fOREGROUND_INTENSITY</span></span></a><span class="mpre">

</span><span class="hl_fundecl"><span class="mpre">hSetSGR</span></span><span class="mpre"> </span><a name="loc_228_9_228_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_9_228_10&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_228_11_228_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_11_228_14&#39;)"><span class="hl_vardecl"><span class="mpre">sgr</span></span></a><span class="mpre"> = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hSetSGR</span></span><span class="mpre"> </span><a href="#loc_228_9_228_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_9_228_10&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_228_11_228_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_11_228_14&#39;)"><span class="hl_varref"><span class="mpre">sgr</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_228_9_228_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_9_228_10&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_228_73_228_79" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_73_228_79&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_229_5_229_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_5_229_23&#39;)"><span class="hl_vardecl"><span class="mpre">screen_buffer_info</span></span></a><span class="mpre"> &lt;- </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_248_1_248_27" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_248_1_248_27&#39;)"><span class="hl_varref"><span class="mpre">getConsoleScreenBufferInfo</span></span></a><span class="mpre"> </span><a href="#loc_228_73_228_79" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_73_228_79&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">
    let </span><a name="loc_230_9_230_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_9_230_18&#39;)"><span class="hl_vardecl"><span class="mpre">attribute</span></span></a><span class="mpre"> = </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_164_9_164_24" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_164_9_164_24&#39;)"><span class="hl_varref"><span class="mpre">csbi_attributes</span></span></a><span class="mpre"> </span><a href="#loc_229_5_229_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_5_229_23&#39;)"><span class="hl_varref"><span class="mpre">screen_buffer_info</span></span></a><span class="mpre">
        </span><a name="loc_231_9_231_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_9_231_19&#39;)"><span class="hl_vardecl"><span class="mpre">attribute&#39;</span></span></a><span class="mpre"> = </span><a href="Data.List.html#loc_993_1_993_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_993_1_993_7&#39;)"><span class="hl_varref"><span class="mpre">foldl&#39;</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">flip</span></span><span class="mpre"> </span><a href="#loc_197_1_197_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_1_197_24&#39;)"><span class="hl_varref"><span class="mpre">applyANSISGRToAttribute</span></span></a><span class="mpre">) </span><a href="#loc_230_9_230_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_9_230_18&#39;)"><span class="hl_varref"><span class="mpre">attribute</span></span></a><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- make [] equivalent to [Reset], as documented</span></span><span class="mpre">
          (if </span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_228_11_228_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_11_228_14&#39;)"><span class="hl_varref"><span class="mpre">sgr</span></span></a><span class="mpre"> then [</span><a href="System.Console.ANSI.Common.html#loc_45_12_45_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Common.html#loc_45_12_45_17&#39;)"><span class="hl_conref"><span class="mpre">Reset</span></span></a><span class="mpre">] else </span><a href="#loc_228_11_228_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_11_228_14&#39;)"><span class="hl_varref"><span class="mpre">sgr</span></span></a><span class="mpre">)
    </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_259_1_259_24" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_259_1_259_24&#39;)"><span class="hl_varref"><span class="mpre">setConsoleTextAttribute</span></span></a><span class="mpre"> </span><a href="#loc_228_73_228_79" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_73_228_79&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_231_9_231_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_9_231_19&#39;)"><span class="hl_varref"><span class="mpre">attribute&#39;</span></span></a><span class="mpre">

</span><span class="hl_fundecl"><span class="mpre">setSGRCode</span></span><span class="mpre"> _ = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">


</span><a href="#loc_240_1_240_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_1_240_24&#39;)"><span class="mpre">hChangeCursorVisibility</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">HANDLE</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_240_1_240_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_1_240_24&#39;)"><span class="hl_fundecl"><span class="mpre">hChangeCursorVisibility</span></span></a><span class="mpre"> </span><a name="loc_240_25_240_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_25_240_31&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">cursor_visible</span></span><span class="mpre"> = do
    </span><span class="hl_vardecl"><span class="mpre">cursor_info</span></span><span class="mpre"> &lt;- </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_253_1_253_21" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_253_1_253_21&#39;)"><span class="hl_varref"><span class="mpre">getConsoleCursorInfo</span></span></a><span class="mpre"> </span><a href="#loc_240_25_240_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_25_240_31&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">
    </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_265_1_265_21" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_265_1_265_21&#39;)"><span class="hl_varref"><span class="mpre">setConsoleCursorInfo</span></span></a><span class="mpre"> </span><a href="#loc_240_25_240_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_25_240_31&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> (</span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/ansi-terminal-0.6.1.1/System/Console/ANSI/Windows/Emulator.hs&quot;, srcSpanStartLine = 242, srcSpanStartColumn = 34, srcSpanEndLine = 242, srcSpanEndColumn = 85}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/ansi-terminal-0.6.1.1/System/Console/ANSI/Windows/Emulator.hs&quot;, srcSpanStartLine = 242, srcSpanStartColumn = 46, srcSpanEndLine = 242, srcSpanEndColumn = 47},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/p"><span class="mpre">cursor_info { cci_cursor_visible = cursor_visible }</span></span><span class="mpre">)

</span><span class="hl_fundecl"><span class="mpre">hHideCursor</span></span><span class="mpre"> </span><a name="loc_244_13_244_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_13_244_14&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hHideCursor</span></span><span class="mpre"> </span><a href="#loc_244_13_244_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_13_244_14&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_244_13_244_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_13_244_14&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_244_73_244_79" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_73_244_79&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_240_1_240_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_1_240_24&#39;)"><span class="hl_varref"><span class="mpre">hChangeCursorVisibility</span></span></a><span class="mpre"> </span><a href="#loc_244_73_244_79" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_73_244_79&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
</span><span class="hl_fundecl"><span class="mpre">hShowCursor</span></span><span class="mpre"> </span><a name="loc_245_13_245_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_13_245_14&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hShowCursor</span></span><span class="mpre"> </span><a href="#loc_245_13_245_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_13_245_14&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><a href="#loc_245_13_245_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_13_245_14&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_245_73_245_79" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_73_245_79&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_240_1_240_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_1_240_24&#39;)"><span class="hl_varref"><span class="mpre">hChangeCursorVisibility</span></span></a><span class="mpre"> </span><a href="#loc_245_73_245_79" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_73_245_79&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">

</span><span class="hl_vardecl"><span class="mpre">hideCursorCode</span></span><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
</span><span class="hl_vardecl"><span class="mpre">showCursorCode</span></span><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- Windows only supports setting the terminal title on a process-wide basis, so for now we will</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- assume that that is what the user intended. This will fail if they are sending the command</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- over e.g. a network link... but that&#39;s not really what I&#39;m designing for.</span></span><span class="mpre">
</span><span class="hl_fundecl"><span class="mpre">hSetTitle</span></span><span class="mpre"> </span><a name="loc_254_11_254_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_11_254_12&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_254_13_254_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_13_254_18&#39;)"><span class="hl_vardecl"><span class="mpre">title</span></span></a><span class="mpre"> = </span><a href="#loc_41_1_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_17&#39;)"><span class="hl_varref"><span class="mpre">emulatorFallback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">Unix.hSetTitle</span></span><span class="mpre"> </span><a href="#loc_254_11_254_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_11_254_12&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_254_13_254_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_13_254_18&#39;)"><span class="hl_varref"><span class="mpre">title</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">withTString</span></span><span class="mpre"> </span><a href="#loc_254_13_254_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_13_254_18&#39;)"><span class="hl_varref"><span class="mpre">title</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="System.Console.ANSI.Windows.Foreign.html#loc_269_1_269_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Console.ANSI.Windows.Foreign.html#loc_269_1_269_16&#39;)"><span class="hl_varref"><span class="mpre">setConsoleTitle</span></span></a><span class="mpre">

</span><span class="hl_fundecl"><span class="mpre">setTitleCode</span></span><span class="mpre"> _ = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
</span></div></body></html>