<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE ForeignFunctionInterface, CPP #-}
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Crypto.Cipher.RC4</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : stable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : Good</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Simple implementation of the RC4 stream cipher.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- http://en.wikipedia.org/wiki/RC4</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Initial FFI implementation by Peter White &lt;peter@janrain.com&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Reorganized and simplified to have an opaque context.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Crypto.Cipher.RC4
    (
      RC4
    </span><span class="hl_comment"><span class="mpre">-- * deprecated types</span></span><span class="mpre">
    , Ctx(..)
    </span><span class="hl_comment"><span class="mpre">-- * deprecated functions, use crypto-cipher-types StreamCipher function</span></span><span class="mpre">
    , initCtx
    , generate
    , combine
    , encrypt
    , decrypt
    ) where

import Data.Word
import Data.Byteable
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cipher-rc4-0.1.4/Crypto/Cipher/RC4.hs&quot;, srcSpanStartLine = 31, srcSpanStartColumn = 8, srcSpanEndLine = 31, srcSpanEndColumn = 19}, srcInfoPoints = []}) &quot;Foreign.Ptr&quot;"><span class="mpre">Foreign.Ptr</span></span><span class="mpre">
import Foreign.ForeignPtr
import System.IO.Unsafe
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cipher-rc4-0.1.4/Crypto/Cipher/RC4.hs&quot;, srcSpanStartLine = 34, srcSpanStartColumn = 8, srcSpanEndLine = 34, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cipher-rc4-0.1.4/Crypto/Cipher/RC4.hs&quot;, srcSpanStartLine = 35, srcSpanStartColumn = 18, srcSpanEndLine = 35, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import qualified Data.ByteString.Internal as B
import Control.Applicative (</span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="mpre">(&lt;$&gt;)</span></a><span class="mpre">)
import Crypto.Cipher.Types

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------------</span></span><span class="mpre">
</span><a href="#loc_43_1_43_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_11&#39;)"><span class="mpre">unsafeDoIO</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
#if __GLASGOW_HASKELL__ &gt; 704
</span><a name="loc_43_1_43_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_11&#39;)"><span class="hl_vardecl"><span class="mpre">unsafeDoIO</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_182_1_182_23" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_182_1_182_23&#39;)"><span class="hl_varref"><span class="mpre">unsafeDupablePerformIO</span></span></a><span class="mpre">
#else
</span><span class="hl_vardecl"><span class="mpre">unsafeDoIO</span></span><span class="mpre"> = </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre">
#endif

</span><span class="hl_comment"><span class="mpre">-- | RC4 Stream cipher</span></span><span class="mpre">
newtype </span><a name="loc_49_9_49_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_9_49_12&#39;)"><span class="hl_tycondecl"><span class="mpre">RC4</span></span></a><span class="mpre"> = </span><a name="loc_49_15_49_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_15_49_18&#39;)"><span class="hl_condecl"><span class="mpre">RC4</span></span></a><span class="mpre"> </span><a href="#loc_63_9_63_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_12&#39;)"><span class="hl_tyconref"><span class="mpre">Ctx</span></span></a><span class="mpre">

instance </span><a href="Data.Byteable.html#loc_22_7_22_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Byteable.html#loc_22_7_22_15&#39;)"><span class="hl_classref"><span class="mpre">Byteable</span></span></a><span class="mpre"> </span><a href="#loc_49_9_49_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_9_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">RC4</span></span></a><span class="mpre"> where
    </span><a href="Data.Byteable.html#loc_24_5_24_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Byteable.html#loc_24_5_24_12&#39;)"><span class="hl_fundecl"><span class="mpre">toBytes</span></span></a><span class="mpre"> (</span><a href="#loc_49_15_49_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_15_49_18&#39;)"><span class="hl_conref"><span class="mpre">RC4</span></span></a><span class="mpre"> (</span><a href="#loc_63_15_63_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_15_63_18&#39;)"><span class="hl_conref"><span class="mpre">Ctx</span></span></a><span class="mpre"> </span><a name="loc_52_23_52_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_23_52_24&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">)) = </span><a href="#loc_52_23_52_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_23_52_24&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

instance </span><a href="Crypto.Cipher.Types.Base.html#loc_76_7_76_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Cipher.Types.Base.html#loc_76_7_76_13&#39;)"><span class="hl_classref"><span class="mpre">Cipher</span></span></a><span class="mpre"> </span><a href="#loc_49_9_49_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_9_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">RC4</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">cipherInit</span></span><span class="mpre"> </span><a name="loc_55_16_55_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_19&#39;)"><span class="hl_vardecl"><span class="mpre">key</span></span></a><span class="mpre">  = </span><a href="#loc_49_15_49_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_15_49_18&#39;)"><span class="hl_conref"><span class="mpre">RC4</span></span></a><span class="mpre"> (</span><a href="#loc_92_1_92_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_8&#39;)"><span class="hl_varref"><span class="mpre">initCtx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Byteable.html#loc_24_5_24_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Byteable.html#loc_24_5_24_12&#39;)"><span class="hl_varref"><span class="mpre">toBytes</span></span></a><span class="mpre"> </span><a href="#loc_55_16_55_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_19&#39;)"><span class="hl_varref"><span class="mpre">key</span></span></a><span class="mpre">)
    </span><span class="hl_fundecl"><span class="mpre">cipherName</span></span><span class="mpre"> _    = </span><span class="hl_string"><span class="mpre">&quot;RC4&quot;</span></span><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">cipherKeySize</span></span><span class="mpre"> _ = </span><span class="hl_conref"><span class="mpre">KeySizeRange</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1024</span></span><span class="mpre">

instance </span><a href="Crypto.Cipher.Types.Stream.html#loc_18_24_18_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Cipher.Types.Stream.html#loc_18_24_18_36&#39;)"><span class="hl_classref"><span class="mpre">StreamCipher</span></span></a><span class="mpre"> </span><a href="#loc_49_9_49_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_9_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">RC4</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">streamCombine</span></span><span class="mpre"> (</span><a href="#loc_49_15_49_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_15_49_18&#39;)"><span class="hl_conref"><span class="mpre">RC4</span></span></a><span class="mpre"> </span><a name="loc_60_24_60_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_24_60_27&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><a name="loc_60_29_60_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_29_60_30&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = (\(</span><a name="loc_60_36_60_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_36_60_40&#39;)"><span class="hl_vardecl"><span class="mpre">ctx2</span></span></a><span class="mpre">, </span><a name="loc_60_42_60_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_42_60_43&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">) -&gt; (</span><a href="#loc_60_42_60_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_42_60_43&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">, </span><a href="#loc_49_15_49_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_15_49_18&#39;)"><span class="hl_conref"><span class="mpre">RC4</span></span></a><span class="mpre"> </span><a href="#loc_60_36_60_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_36_60_40&#39;)"><span class="hl_varref"><span class="mpre">ctx2</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_104_1_104_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_8&#39;)"><span class="hl_varref"><span class="mpre">combine</span></span></a><span class="mpre"> </span><a href="#loc_60_24_60_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_24_60_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_60_29_60_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_29_60_30&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | The encryption context for RC4</span></span><span class="mpre">
newtype </span><a name="loc_63_9_63_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_12&#39;)"><span class="hl_tycondecl"><span class="mpre">Ctx</span></span></a><span class="mpre"> = </span><a name="loc_63_15_63_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_15_63_18&#39;)"><span class="hl_condecl"><span class="mpre">Ctx</span></span></a><span class="mpre"> </span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span></a><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Show</span></span><span class="mpre"> </span><a href="#loc_63_9_63_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_12&#39;)"><span class="hl_tyconref"><span class="mpre">Ctx</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">show</span></span><span class="mpre"> _ = </span><span class="hl_string"><span class="mpre">&quot;RC4.Ctx&quot;</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | C Call for initializing the encryptor</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cipher-rc4-0.1.4/Crypto/Cipher/RC4.hs&quot;, srcSpanStartLine = 69, srcSpanStartColumn = 1, srcSpanEndLine = 73, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cipher-rc4-0.1.4/Crypto/Cipher/RC4.hs&quot;, srcSpanStartLine = 69, srcSpanStartColumn = 1, srcSpanEndLine = 69, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cipher-rc4-0.1.4/Crypto/Cipher/RC4.hs&quot;, srcSpanStartLi"><span class="mpre">foreign import ccall unsafe &quot;rc4.h rc4_init&quot;
    c_rc4_init :: Ptr Word8 </span><span class="hl_comment"><span class="mpre">-- ^ The rc4 key</span></span><span class="mpre">
               -&gt; Word32    </span><span class="hl_comment"><span class="mpre">-- ^ The key length</span></span><span class="mpre">
               -&gt; Ptr Ctx   </span><span class="hl_comment"><span class="mpre">-- ^ The context</span></span><span class="mpre">
               -&gt; IO ()</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cipher-rc4-0.1.4/Crypto/Cipher/RC4.hs&quot;, srcSpanStartLine = 75, srcSpanStartColumn = 1, srcSpanEndLine = 80, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cipher-rc4-0.1.4/Crypto/Cipher/RC4.hs&quot;, srcSpanStartLine = 75, srcSpanStartColumn = 1, srcSpanEndLine = 75, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cipher-rc4-0.1.4/Crypto/Cipher/RC4.hs&quot;, srcSpanStartLi"><span class="mpre">foreign import ccall unsafe &quot;rc4.h rc4_combine&quot;
    c_rc4_combine :: Ptr Ctx        </span><span class="hl_comment"><span class="mpre">-- ^ Pointer to the permutation</span></span><span class="mpre">
                  -&gt; Ptr Word8      </span><span class="hl_comment"><span class="mpre">-- ^ Pointer to the clear text</span></span><span class="mpre">
                  -&gt; Word32         </span><span class="hl_comment"><span class="mpre">-- ^ Length of the clear text</span></span><span class="mpre">
                  -&gt; Ptr Word8      </span><span class="hl_comment"><span class="mpre">-- ^ Output buffer</span></span><span class="mpre">
                  -&gt; IO ()</span></span><span class="mpre">

</span><a href="#loc_83_1_83_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_18&#39;)"><span class="mpre">withByteStringPtr</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_83_1_83_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_18&#39;)"><span class="hl_fundecl"><span class="mpre">withByteStringPtr</span></span></a><span class="mpre"> </span><a name="loc_83_19_83_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_19_83_20&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> </span><a name="loc_83_21_83_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_21_83_22&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> </span><a href="#loc_84_12_84_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_12_84_16&#39;)"><span class="hl_varref"><span class="mpre">fptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_83_48_83_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_48_83_51&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_83_21_83_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_21_83_22&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> (</span><a href="#loc_83_48_83_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_48_83_51&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_84_18_84_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_18_84_21&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre">)
    where (</span><a name="loc_84_12_84_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_12_84_16&#39;)"><span class="hl_vardecl"><span class="mpre">fptr</span></span></a><span class="mpre">, </span><a name="loc_84_18_84_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_18_84_21&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre">, _) = </span><a href="Data.ByteString.Internal.html#loc_405_1_405_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_405_1_405_13&#39;)"><span class="hl_varref"><span class="mpre">B.toForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_83_19_83_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_19_83_20&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | RC4 context initialization.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- seed the context with an initial key. the key size need to be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- adequate otherwise security takes a hit.</span></span><span class="mpre">
</span><a href="#loc_92_1_92_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_8&#39;)"><span class="mpre">initCtx</span></a><span class="mpre"> :: </span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ The key</span></span><span class="mpre">
        -&gt; </span><a href="#loc_63_9_63_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_12&#39;)"><span class="hl_tyconref"><span class="mpre">Ctx</span></span></a><span class="mpre">          </span><span class="hl_comment"><span class="mpre">-- ^ The RC4 context with the key mixed in</span></span><span class="mpre">
</span><a name="loc_92_1_92_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_8&#39;)"><span class="hl_fundecl"><span class="mpre">initCtx</span></span></a><span class="mpre"> </span><a name="loc_92_9_92_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_9_92_12&#39;)"><span class="hl_vardecl"><span class="mpre">key</span></span></a><span class="mpre"> = </span><a href="#loc_43_1_43_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_11&#39;)"><span class="hl_varref"><span class="mpre">unsafeDoIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
    </span><a href="#loc_63_15_63_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_15_63_18&#39;)"><span class="hl_conref"><span class="mpre">Ctx</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Internal.html#loc_434_1_434_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_434_1_434_7&#39;)"><span class="hl_varref"><span class="mpre">B.create</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">264</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_93_30_93_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_30_93_33&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">B.useAsCStringLen</span></span><span class="mpre"> </span><a href="#loc_92_9_92_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_9_92_12&#39;)"><span class="hl_varref"><span class="mpre">key</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_93_63_93_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_63_93_69&#39;)"><span class="hl_vardecl"><span class="mpre">keyPtr</span></span></a><span class="mpre">,</span><a name="loc_93_70_93_76" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_70_93_76&#39;)"><span class="hl_vardecl"><span class="mpre">keyLen</span></span></a><span class="mpre">) -&gt; </span><span class="hl_varref"><span class="mpre">c_rc4_init</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_93_63_93_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_63_93_69&#39;)"><span class="hl_varref"><span class="mpre">keyPtr</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_93_70_93_76" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_70_93_76&#39;)"><span class="hl_varref"><span class="mpre">keyLen</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_93_30_93_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_30_93_33&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">))

</span><span class="hl_comment"><span class="mpre">-- | generate the next len bytes of the rc4 stream without combining</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- it to anything.</span></span><span class="mpre">
</span><a href="#loc_98_1_98_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_9&#39;)"><span class="mpre">generate</span></a><span class="mpre"> :: </span><a href="#loc_63_9_63_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_12&#39;)"><span class="hl_tyconref"><span class="mpre">Ctx</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; (</span><a href="#loc_63_9_63_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_12&#39;)"><span class="hl_tyconref"><span class="mpre">Ctx</span></span></a><span class="mpre">, </span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span></a><span class="mpre">)
</span><a name="loc_98_1_98_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_9&#39;)"><span class="hl_fundecl"><span class="mpre">generate</span></span></a><span class="mpre"> </span><a name="loc_98_10_98_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_10_98_13&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_98_14_98_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_14_98_17&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = </span><a href="#loc_104_1_104_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_8&#39;)"><span class="hl_varref"><span class="mpre">combine</span></span></a><span class="mpre"> </span><a href="#loc_98_10_98_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_10_98_13&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.replicate</span></span><span class="mpre"> </span><a href="#loc_98_14_98_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_14_98_17&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | RC4 xor combination of the rc4 stream with an input</span></span><span class="mpre">
</span><a href="#loc_104_1_104_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_8&#39;)"><span class="mpre">combine</span></a><span class="mpre"> :: </span><a href="#loc_63_9_63_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_12&#39;)"><span class="hl_tyconref"><span class="mpre">Ctx</span></span></a><span class="mpre">                 </span><span class="hl_comment"><span class="mpre">-- ^ rc4 context</span></span><span class="mpre">
        -&gt; </span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span></a><span class="mpre">        </span><span class="hl_comment"><span class="mpre">-- ^ input</span></span><span class="mpre">
        -&gt; (</span><a href="#loc_63_9_63_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_12&#39;)"><span class="hl_tyconref"><span class="mpre">Ctx</span></span></a><span class="mpre">, </span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span></a><span class="mpre">) </span><span class="hl_comment"><span class="mpre">-- ^ new rc4 context, and the output</span></span><span class="mpre">
</span><a name="loc_104_1_104_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_8&#39;)"><span class="hl_fundecl"><span class="mpre">combine</span></span></a><span class="mpre"> (</span><a href="#loc_63_15_63_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_15_63_18&#39;)"><span class="hl_conref"><span class="mpre">Ctx</span></span></a><span class="mpre"> </span><a name="loc_104_14_104_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_14_104_18&#39;)"><span class="hl_vardecl"><span class="mpre">cctx</span></span></a><span class="mpre">) </span><a name="loc_104_20_104_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_20_104_29&#39;)"><span class="hl_vardecl"><span class="mpre">clearText</span></span></a><span class="mpre"> = </span><a href="#loc_43_1_43_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_11&#39;)"><span class="hl_varref"><span class="mpre">unsafeDoIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
    </span><a href="Data.ByteString.Internal.html#loc_489_1_489_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_489_1_489_17&#39;)"><span class="hl_varref"><span class="mpre">B.mallocByteString</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">264</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> \</span><a name="loc_105_33_105_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_33_105_37&#39;)"><span class="hl_vardecl"><span class="mpre">dctx</span></span></a><span class="mpre"> -&gt;
    </span><a href="Data.ByteString.Internal.html#loc_489_1_489_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_489_1_489_17&#39;)"><span class="hl_varref"><span class="mpre">B.mallocByteString</span></span></a><span class="mpre"> </span><a href="#loc_114_11_114_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_11_114_14&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> \</span><a name="loc_106_33_106_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_33_106_40&#39;)"><span class="hl_vardecl"><span class="mpre">outfptr</span></span></a><span class="mpre"> -&gt;
    </span><a href="#loc_83_1_83_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_18&#39;)"><span class="hl_varref"><span class="mpre">withByteStringPtr</span></span></a><span class="mpre"> </span><a href="#loc_104_20_104_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_20_104_29&#39;)"><span class="hl_varref"><span class="mpre">clearText</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_107_36_107_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_36_107_44&#39;)"><span class="hl_vardecl"><span class="mpre">clearPtr</span></span></a><span class="mpre"> -&gt;
    </span><a href="#loc_83_1_83_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_18&#39;)"><span class="hl_varref"><span class="mpre">withByteStringPtr</span></span></a><span class="mpre"> </span><a href="#loc_104_14_104_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_14_104_18&#39;)"><span class="hl_varref"><span class="mpre">cctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_108_31_108_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_31_108_37&#39;)"><span class="hl_vardecl"><span class="mpre">srcCtx</span></span></a><span class="mpre"> -&gt;
    </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> </span><a href="#loc_105_33_105_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_33_105_37&#39;)"><span class="hl_varref"><span class="mpre">dctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_109_28_109_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_28_109_34&#39;)"><span class="hl_vardecl"><span class="mpre">dstCtx</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> </span><a href="#loc_106_33_106_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_33_106_40&#39;)"><span class="hl_varref"><span class="mpre">outfptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_110_31_110_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_31_110_37&#39;)"><span class="hl_vardecl"><span class="mpre">outptr</span></span></a><span class="mpre"> -&gt; do
        </span><a href="Data.ByteString.Internal.html#loc_624_1_624_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_624_1_624_7&#39;)"><span class="hl_varref"><span class="mpre">B.memcpy</span></span></a><span class="mpre"> </span><a href="#loc_109_28_109_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_28_109_34&#39;)"><span class="hl_varref"><span class="mpre">dstCtx</span></span></a><span class="mpre"> </span><a href="#loc_108_31_108_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_31_108_37&#39;)"><span class="hl_varref"><span class="mpre">srcCtx</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">264</span></span><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">c_rc4_combine</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_109_28_109_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_28_109_34&#39;)"><span class="hl_varref"><span class="mpre">dstCtx</span></span></a><span class="mpre">) </span><a href="#loc_107_36_107_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_36_107_44&#39;)"><span class="hl_varref"><span class="mpre">clearPtr</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_114_11_114_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_11_114_14&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">) </span><a href="#loc_110_31_110_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_31_110_37&#39;)"><span class="hl_varref"><span class="mpre">outptr</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> (</span><a href="#loc_63_15_63_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_15_63_18&#39;)"><span class="hl_conref"><span class="mpre">Ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">B.PS</span></span></a><span class="mpre"> </span><a href="#loc_105_33_105_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_33_105_37&#39;)"><span class="hl_varref"><span class="mpre">dctx</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">264</span></span><span class="mpre">, </span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">B.PS</span></span></a><span class="mpre"> </span><a href="#loc_106_33_106_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_33_106_40&#39;)"><span class="hl_varref"><span class="mpre">outfptr</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_114_11_114_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_11_114_14&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">)
    where </span><a name="loc_114_11_114_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_11_114_14&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_104_20_104_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_20_104_29&#39;)"><span class="hl_varref"><span class="mpre">clearText</span></span></a><span class="mpre">

</span><span class="warning" data-warning="DeclDeprPragmaDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cipher-rc4-0.1.4/Crypto/Cipher/RC4.hs&quot;, srcSpanStartLine = 116, srcSpanStartColumn = 1, srcSpanEndLine = 116, srcSpanEndColumn = 49}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cipher-rc4-0.1.4/Crypto/Cipher/RC4.hs&quot;, srcSpanStartLine = 116, srcSpanStartColumn = 1, srcSpanEndLine = 116, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cipher-rc4-0.1.4/Crypto/Cipher/RC4.hs&quot;, s"><span class="mpre">{-# DEPRECATED encrypt &quot;use combine instead&quot; #-}</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclDeprPragmaDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cipher-rc4-0.1.4/Crypto/Cipher/RC4.hs&quot;, srcSpanStartLine = 117, srcSpanStartColumn = 1, srcSpanEndLine = 117, srcSpanEndColumn = 49}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cipher-rc4-0.1.4/Crypto/Cipher/RC4.hs&quot;, srcSpanStartLine = 117, srcSpanStartColumn = 1, srcSpanEndLine = 117, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cipher-rc4-0.1.4/Crypto/Cipher/RC4.hs&quot;, s"><span class="mpre">{-# DEPRECATED decrypt &quot;use combine instead&quot; #-}</span></span><span class="mpre">
</span><a href="#loc_119_1_119_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_8&#39;)"><span class="mpre">encrypt</span></a><span class="mpre">,</span><a href="#loc_120_1_120_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_1_120_8&#39;)"><span class="mpre">decrypt</span></a><span class="mpre"> :: </span><a href="#loc_63_9_63_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_12&#39;)"><span class="hl_tyconref"><span class="mpre">Ctx</span></span></a><span class="mpre"> -&gt; </span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_63_9_63_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_12&#39;)"><span class="hl_tyconref"><span class="mpre">Ctx</span></span></a><span class="mpre">, </span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span></a><span class="mpre">)
</span><a name="loc_119_1_119_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_8&#39;)"><span class="hl_vardecl"><span class="mpre">encrypt</span></span></a><span class="mpre"> = </span><a href="#loc_104_1_104_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_8&#39;)"><span class="hl_varref"><span class="mpre">combine</span></span></a><span class="mpre">
</span><a name="loc_120_1_120_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_1_120_8&#39;)"><span class="hl_vardecl"><span class="mpre">decrypt</span></span></a><span class="mpre"> = </span><a href="#loc_104_1_104_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_8&#39;)"><span class="hl_varref"><span class="mpre">combine</span></span></a><span class="mpre">
</span></div></body></html>