<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- | This is the non-capturing form of Text.Regex.TDFA.NewDFA.String</span></span><span class="mpre">
module Text.Regex.TDFA.NewDFA.Engine_NC_FA(execMatch) where

import Control.Monad(</span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="mpre">unless</span></a><span class="mpre">)
import Prelude hiding ((!!))

import Data.Array.MArray(MArray(..))
import Data.Array.Unsafe(unsafeFreeze)
import Data.Array.ST(STArray)
import qualified Data.IntMap.CharMap2 as CMap(</span><a href="Data.IntMap.CharMap2.html#loc_52_1_52_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IntMap.CharMap2.html#loc_52_1_52_16&#39;)"><span class="mpre">findWithDefault</span></a><span class="mpre">)
import qualified Data.IntMap as IMap(null)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 12, srcSpanStartColumn = 18, srcSpanEndLine = 12, srcSpanEndColumn = 29}, srcInfoPoints = []}) &quot;Data.IntSet&quot;"><span class="mpre">Data.IntSet</span></span><span class="mpre"> as ISet(null)
import qualified Data.Array.MArray()
import Data.STRef(newSTRef,readSTRef,writeSTRef)
import qualified Control.Monad.ST.Strict as S(ST,runST)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 16, srcSpanStartColumn = 8, srcSpanEndLine = 16, srcSpanEndColumn = 21}, srcInfoPoints = []}) &quot;Data.Sequence&quot;"><span class="mpre">Data.Sequence</span></span><span class="mpre">(Seq)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 17, srcSpanStartColumn = 18, srcSpanEndLine = 17, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as SBS(ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 18, srcSpanStartColumn = 18, srcSpanEndLine = 18, srcSpanEndColumn = 44}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy.Char8&quot;"><span class="mpre">Data.ByteString.Lazy.Char8</span></span><span class="mpre"> as LBS(ByteString)

import Text.Regex.Base(MatchArray,MatchOffset,MatchLength)
import Text.Regex.TDFA.Common hiding (</span><a href="Text.Regex.TDFA.Common.html#loc_292_1_292_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.TDFA.Common.html#loc_292_1_292_7&#39;)"><span class="mpre">indent</span></a><span class="mpre">)
import Text.Regex.TDFA.NewDFA.Uncons(</span><a href="Text.Regex.TDFA.NewDFA.Uncons.html#loc_7_7_7_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.TDFA.NewDFA.Uncons.html#loc_7_7_7_13&#39;)"><span class="mpre">Uncons</span></a><span class="mpre">(</span><a href="Text.Regex.TDFA.NewDFA.Uncons.html#loc_9_3_9_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.TDFA.NewDFA.Uncons.html#loc_9_3_9_9&#39;)"><span class="mpre">uncons</span></a><span class="mpre">))
import Text.Regex.TDFA.NewDFA.MakeTest(</span><a href="Text.Regex.TDFA.NewDFA.MakeTest.html#loc_17_1_17_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.TDFA.NewDFA.MakeTest.html#loc_17_1_17_16&#39;)"><span class="mpre">test_singleline</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">--import Debug.Trace</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- trace :: String -&gt; a -&gt; a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- trace _ a = a</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclSpecSig (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 30, srcSpanStartColumn = 1, srcSpanEndLine = 30, srcSpanEndColumn = 87}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 30, srcSpanStartColumn = 1, srcSpanEndLine = 30, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0"><span class="mpre">{-# SPECIALIZE execMatch :: Regex -&gt; Position -&gt; Char -&gt; ([] Char) -&gt; [MatchArray] #-}</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclSpecSig (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 31, srcSpanStartColumn = 1, srcSpanEndLine = 31, srcSpanEndColumn = 88}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 31, srcSpanStartColumn = 1, srcSpanEndLine = 31, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0"><span class="mpre">{-# SPECIALIZE execMatch :: Regex -&gt; Position -&gt; Char -&gt; (Seq Char) -&gt; [MatchArray] #-}</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclSpecSig (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 32, srcSpanStartColumn = 1, srcSpanEndLine = 32, srcSpanEndColumn = 92}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 32, srcSpanStartColumn = 1, srcSpanEndLine = 32, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0"><span class="mpre">{-# SPECIALIZE execMatch :: Regex -&gt; Position -&gt; Char -&gt; SBS.ByteString -&gt; [MatchArray] #-}</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclSpecSig (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 33, srcSpanStartColumn = 1, srcSpanEndLine = 33, srcSpanEndColumn = 92}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 33, srcSpanStartColumn = 1, srcSpanEndLine = 33, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0"><span class="mpre">{-# SPECIALIZE execMatch :: Regex -&gt; Position -&gt; Char -&gt; LBS.ByteString -&gt; [MatchArray] #-}</span></span><span class="mpre">
</span><a href="#loc_35_1_35_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_1_35_10&#39;)"><span class="mpre">execMatch</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 34, srcSpanStartColumn = 14, srcSpanEndLine = 34, srcSpanEndColumn = 28}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 34, srcSpanStartColumn = 26, srcSpanEndLine = 34, srcSpanEndColumn = 28}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;"><span class="mpre">Uncons text =&gt;</span></span><span class="mpre"> </span><a href="Text.Regex.TDFA.Common.html#loc_128_6_128_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.TDFA.Common.html#loc_128_6_128_11&#39;)"><span class="hl_tyconref"><span class="mpre">Regex</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Position</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">text</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">MatchArray</span></span><span class="mpre">]
</span><a name="loc_35_1_35_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_1_35_10&#39;)"><span class="hl_fundecl"><span class="mpre">execMatch</span></span></a><span class="mpre"> (</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 35, srcSpanStartColumn = 12, srcSpanEndLine = 35, srcSpanEndColumn = 49}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 35, srcSpanStartColumn = 18, srcSpanEndLine = 35, srcSpanEndColumn = 19},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/"><span class="mpre">Regex { regex_dfa = DFA {d_dt=dtIn} }</span></span><span class="mpre">)
          </span><span class="hl_vardecl"><span class="mpre">offsetIn</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_prevIn</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">inputIn</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.runST</span></span><span class="mpre"> </span><a href="#loc_40_3_40_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_3_40_9&#39;)"><span class="hl_varref"><span class="mpre">goNext</span></span></a><span class="mpre"> where

  </span><span class="hl_fundecl"><span class="mpre">test</span></span><span class="mpre"> </span><a name="loc_38_8_38_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_8_38_10&#39;)"><span class="hl_vardecl"><span class="mpre">wt</span></span></a><span class="mpre"> </span><a name="loc_38_11_38_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_11_38_14&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_38_15_38_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_15_38_20&#39;)"><span class="hl_vardecl"><span class="mpre">input</span></span></a><span class="mpre"> = </span><a href="Text.Regex.TDFA.NewDFA.MakeTest.html#loc_17_1_17_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.TDFA.NewDFA.MakeTest.html#loc_17_1_17_16&#39;)"><span class="hl_varref"><span class="mpre">test_singleline</span></span></a><span class="mpre"> </span><a href="#loc_38_8_38_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_8_38_10&#39;)"><span class="hl_varref"><span class="mpre">wt</span></span></a><span class="mpre"> </span><a href="#loc_38_11_38_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_11_38_14&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre"> </span><a href="#loc_38_15_38_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_15_38_20&#39;)"><span class="hl_varref"><span class="mpre">input</span></span></a><span class="mpre">

  </span><a name="loc_40_3_40_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_3_40_9&#39;)"><span class="hl_vardecl"><span class="mpre">goNext</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpSCCPragma (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 40, srcSpanStartColumn = 12, srcSpanEndLine = 73, srcSpanEndColumn = 0}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/NewDFA/Engine_NC_FA.hs&quot;, srcSpanStartLine = 40, srcSpanStartColumn = 20, srcSpanEndLine = 40, srcSpanEndColumn = 28},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1."><span class="mpre">{-# SCC &quot;goNext&quot; #-} do
    winQ &lt;- newSTRef Nothing
    let next dt offset input = {-# SCC &quot;goNext.next&quot; #-}
          case dt of
            Testing&#39; {dt_test=wt,dt_a=a,dt_b=b} -&gt;
              if test wt offset input
                then next a offset input
                else next b offset input
            Simple&#39; {dt_win=w,dt_trans=t, dt_other=o} -&gt; do
              unless (IMap.null w) $
                writeSTRef winQ (Just offset)
              case uncons input of
                Nothing -&gt; finalizeWinner
                Just (c,input&#39;) -&gt; do
                  case CMap.findWithDefault o c t of
                    Transition {trans_single=DFA {d_id=did&#39;,d_dt=dt&#39;}}
                      | ISet.null did&#39; -&gt; finalizeWinner
                      | otherwise -&gt;
                          let offset&#39; = succ offset
                          in seq offset&#39; $ next dt&#39; offset&#39; input&#39;

        finalizeWinner = do
          mWinner &lt;- readSTRef winQ
          case mWinner of
            Nothing -&gt; return []
            Just winner -&gt; mapM (makeGroup offsetIn) [winner]

    next dtIn offsetIn inputIn

</span><span class="hl_comment"><span class="mpre">----</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{- CONVERT WINNERS TO MATCHARRAY -}</span></span><span class="mpre">
</span></span><span class="mpre">
</span><a href="#loc_74_1_74_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_10&#39;)"><span class="mpre">makeGroup</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Position</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Position</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">S.ST</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">MatchArray</span></span><span class="mpre">
</span><a name="loc_74_1_74_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_10&#39;)"><span class="hl_fundecl"><span class="mpre">makeGroup</span></span></a><span class="mpre"> </span><a name="loc_74_11_74_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_11_74_16&#39;)"><span class="hl_vardecl"><span class="mpre">start</span></span></a><span class="mpre"> </span><a name="loc_74_17_74_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_17_74_21&#39;)"><span class="hl_vardecl"><span class="mpre">stop</span></span></a><span class="mpre"> = do
  </span><a name="loc_75_3_75_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_3_75_5&#39;)"><span class="hl_vardecl"><span class="mpre">ma</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newArray</span></span><span class="mpre"> (</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">,</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">) (</span><a href="#loc_74_11_74_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_11_74_16&#39;)"><span class="hl_varref"><span class="mpre">start</span></span></a><span class="mpre">,</span><a href="#loc_74_17_74_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_17_74_21&#39;)"><span class="hl_varref"><span class="mpre">stop</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><a href="#loc_74_11_74_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_11_74_16&#39;)"><span class="hl_varref"><span class="mpre">start</span></span></a><span class="mpre">)  :: </span><span class="hl_tyconref"><span class="mpre">S.ST</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">STArray</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">MatchOffset</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">MatchLength</span></span><span class="mpre">))
  </span><span class="hl_varref"><span class="mpre">unsafeFreeze</span></span><span class="mpre"> </span><a href="#loc_75_3_75_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_3_75_5&#39;)"><span class="hl_varref"><span class="mpre">ma</span></span></a><span class="mpre">
</span></div></body></html>