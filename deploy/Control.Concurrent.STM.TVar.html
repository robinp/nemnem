<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE CPP, MagicHash, UnboxedTuples #-}

#if __GLASGOW_HASKELL__ &gt;= 701
{-# LANGUAGE Trustworthy #-}
#endif

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Control.Concurrent.STM.TVar</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow 2004</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD-style (see the file libraries/base/LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  libraries@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (requires STM)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- TVar: Transactional variables</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module Control.Concurrent.STM.TVar (
        </span><span class="hl_comment"><span class="mpre">-- * TVars</span></span><span class="mpre">
        TVar,
        newTVar,
        newTVarIO,
        readTVar,
        readTVarIO,
        writeTVar,
        modifyTVar,
        modifyTVar&#39;,
        swapTVar,
#ifdef __GLASGOW_HASKELL__
        registerDelay,
#endif
        mkWeakTVar
  ) where

#ifdef __GLASGOW_HASKELL__
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TVar.hs&quot;, srcSpanStartLine = 39, srcSpanStartColumn = 8, srcSpanEndLine = 39, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TVar.hs&quot;, srcSpanStartLine = 40, srcSpanStartColumn = 8, srcSpanEndLine = 40, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Conc&quot;"><span class="mpre">GHC.Conc</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TVar.hs&quot;, srcSpanStartLine = 41, srcSpanStartColumn = 8, srcSpanEndLine = 41, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Weak&quot;"><span class="mpre">GHC.Weak</span></span><span class="mpre">
#else
import Control.Sequential.STM
#endif

</span><span class="hl_comment"><span class="mpre">-- Like &#39;modifyIORef&#39; but for &#39;TVar&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Mutate the contents of a &#39;TVar&#39;. /N.B./, this version is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- non-strict.</span></span><span class="mpre">
</span><a href="#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_11&#39;)"><span class="mpre">modifyTVar</span></a><span class="mpre"> :: </span><a href="Control.Sequential.STM.html#loc_68_9_68_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_68_9_68_13&#39;)"><span class="hl_tyconref"><span class="mpre">TVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">STM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_50_1_50_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_11&#39;)"><span class="hl_fundecl"><span class="mpre">modifyTVar</span></span></a><span class="mpre"> </span><a name="loc_50_12_50_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_12_50_15&#39;)"><span class="hl_vardecl"><span class="mpre">var</span></span></a><span class="mpre"> </span><a name="loc_50_16_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_16_50_17&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = do
    </span><a name="loc_51_5_51_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_5_51_6&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Sequential.STM.html#loc_80_1_80_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_80_1_80_9&#39;)"><span class="hl_varref"><span class="mpre">readTVar</span></span></a><span class="mpre"> </span><a href="#loc_50_12_50_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_12_50_15&#39;)"><span class="hl_varref"><span class="mpre">var</span></span></a><span class="mpre">
    </span><a href="Control.Sequential.STM.html#loc_86_1_86_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_86_1_86_10&#39;)"><span class="hl_varref"><span class="mpre">writeTVar</span></span></a><span class="mpre"> </span><a href="#loc_50_12_50_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_12_50_15&#39;)"><span class="hl_varref"><span class="mpre">var</span></span></a><span class="mpre"> (</span><a href="#loc_50_16_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_16_50_17&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_51_5_51_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_5_51_6&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_11&#39;)"><span class="mpre">modifyTVar</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | Strict version of &#39;modifyTVar&#39;.</span></span><span class="mpre">
</span><a href="#loc_58_1_58_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_12&#39;)"><span class="mpre">modifyTVar&#39;</span></a><span class="mpre"> :: </span><a href="Control.Sequential.STM.html#loc_68_9_68_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_68_9_68_13&#39;)"><span class="hl_tyconref"><span class="mpre">TVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">STM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_58_1_58_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_12&#39;)"><span class="hl_fundecl"><span class="mpre">modifyTVar&#39;</span></span></a><span class="mpre"> </span><a name="loc_58_13_58_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_13_58_16&#39;)"><span class="hl_vardecl"><span class="mpre">var</span></span></a><span class="mpre"> </span><a name="loc_58_17_58_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_17_58_18&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = do
    </span><a name="loc_59_5_59_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_5_59_6&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Sequential.STM.html#loc_80_1_80_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_80_1_80_9&#39;)"><span class="hl_varref"><span class="mpre">readTVar</span></span></a><span class="mpre"> </span><a href="#loc_58_13_58_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_13_58_16&#39;)"><span class="hl_varref"><span class="mpre">var</span></span></a><span class="mpre">
    </span><a href="Control.Sequential.STM.html#loc_86_1_86_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_86_1_86_10&#39;)"><span class="hl_varref"><span class="mpre">writeTVar</span></span></a><span class="mpre"> </span><a href="#loc_58_13_58_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_13_58_16&#39;)"><span class="hl_varref"><span class="mpre">var</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="#loc_58_17_58_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_17_58_18&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_59_5_59_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_5_59_6&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_58_1_58_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_12&#39;)"><span class="mpre">modifyTVar&#39;</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- Like &#39;swapTMVar&#39; but for &#39;TVar&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Swap the contents of a &#39;TVar&#39; for a new value.</span></span><span class="mpre">
</span><a href="#loc_67_1_67_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_9&#39;)"><span class="mpre">swapTVar</span></a><span class="mpre"> :: </span><a href="Control.Sequential.STM.html#loc_68_9_68_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_68_9_68_13&#39;)"><span class="hl_tyconref"><span class="mpre">TVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">STM</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_67_1_67_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_9&#39;)"><span class="hl_fundecl"><span class="mpre">swapTVar</span></span></a><span class="mpre"> </span><a name="loc_67_10_67_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_10_67_13&#39;)"><span class="hl_vardecl"><span class="mpre">var</span></span></a><span class="mpre"> </span><a name="loc_67_14_67_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_14_67_17&#39;)"><span class="hl_vardecl"><span class="mpre">new</span></span></a><span class="mpre"> = do
    </span><a name="loc_68_5_68_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_5_68_8&#39;)"><span class="hl_vardecl"><span class="mpre">old</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Sequential.STM.html#loc_80_1_80_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_80_1_80_9&#39;)"><span class="hl_varref"><span class="mpre">readTVar</span></span></a><span class="mpre"> </span><a href="#loc_67_10_67_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_10_67_13&#39;)"><span class="hl_varref"><span class="mpre">var</span></span></a><span class="mpre">
    </span><a href="Control.Sequential.STM.html#loc_86_1_86_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_86_1_86_10&#39;)"><span class="hl_varref"><span class="mpre">writeTVar</span></span></a><span class="mpre"> </span><a href="#loc_67_10_67_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_10_67_13&#39;)"><span class="hl_varref"><span class="mpre">var</span></span></a><span class="mpre"> </span><a href="#loc_67_14_67_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_14_67_17&#39;)"><span class="hl_varref"><span class="mpre">new</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_68_5_68_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_5_68_8&#39;)"><span class="hl_varref"><span class="mpre">old</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_67_1_67_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_9&#39;)"><span class="mpre">swapTVar</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | Make a &#39;Weak&#39; pointer to a &#39;TVar&#39;, using the second argument as</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a finalizer to run when &#39;TVar&#39; is garbage-collected</span></span><span class="mpre">
</span><a href="#loc_77_1_77_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_1_77_11&#39;)"><span class="mpre">mkWeakTVar</span></a><span class="mpre"> :: </span><a href="Control.Sequential.STM.html#loc_68_9_68_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_68_9_68_13&#39;)"><span class="hl_tyconref"><span class="mpre">TVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Weak</span></span><span class="mpre"> (</span><a href="Control.Sequential.STM.html#loc_68_9_68_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_68_9_68_13&#39;)"><span class="hl_tyconref"><span class="mpre">TVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">))
</span><a name="loc_77_1_77_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_1_77_11&#39;)"><span class="hl_fundecl"><span class="mpre">mkWeakTVar</span></span></a><span class="mpre"> </span><a name="loc_77_12_77_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_12_77_13&#39;)"><span class="hl_specname"><span class="mpre">t</span></span></a><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">TVar</span></span><span class="mpre"> </span><a name="loc_77_20_77_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_20_77_22&#39;)"><span class="hl_vardecl"><span class="mpre">t#</span></span></a><span class="mpre">) </span><a name="loc_77_24_77_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_24_77_25&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_77_34_77_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_34_77_35&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
    case </span><span class="hl_varref"><span class="mpre">mkWeak#</span></span><span class="mpre"> </span><a href="#loc_77_20_77_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_20_77_22&#39;)"><span class="hl_varref"><span class="mpre">t#</span></span></a><span class="mpre"> </span><a href="#loc_77_12_77_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_12_77_13&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><a href="#loc_77_24_77_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_24_77_25&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_77_34_77_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_34_77_35&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of (# </span><a name="loc_78_33_78_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_33_78_35&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">, </span><a name="loc_78_37_78_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_37_78_38&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> #) -&gt; (# </span><a href="#loc_78_33_78_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_33_78_35&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">Weak</span></span><span class="mpre"> </span><a href="#loc_78_37_78_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_37_78_38&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> #)
</span></div></body></html>