<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# OPTIONS_GHC -fno-warn-name-shadowing #-}
{-# LANGUAGE CPP, DeriveDataTypeable #-}

#if __GLASGOW_HASKELL__ &gt;= 701
{-# LANGUAGE Trustworthy #-}
#endif

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Control.Concurrent.STM.TChan</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow 2004</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD-style (see the file libraries/base/LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  libraries@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (requires STM)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- TChan: Transactional channels</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (GHC only)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module Control.Concurrent.STM.TChan (
#ifdef __GLASGOW_HASKELL__
        </span><span class="hl_comment"><span class="mpre">-- * TChans</span></span><span class="mpre">
        TChan,

        </span><span class="hl_comment"><span class="mpre">-- ** Construction</span></span><span class="mpre">
        newTChan,
        newTChanIO,
        newBroadcastTChan,
        newBroadcastTChanIO,
        dupTChan,
        cloneTChan,

        </span><span class="hl_comment"><span class="mpre">-- ** Reading and writing</span></span><span class="mpre">
        readTChan,
        tryReadTChan,
        peekTChan,
        tryPeekTChan,
        writeTChan,
        unGetTChan,
        isEmptyTChan
#endif
  ) where

#ifdef __GLASGOW_HASKELL__
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TChan.hs&quot;, srcSpanStartLine = 48, srcSpanStartColumn = 8, srcSpanEndLine = 48, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Conc&quot;"><span class="mpre">GHC.Conc</span></span><span class="mpre">

import Data.Typeable (</span><a href="Data.Typeable.Internal.html#loc_196_7_196_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Typeable.Internal.html#loc_196_7_196_15&#39;)"><span class="mpre">Typeable</span></a><span class="mpre">)

#define _UPK_(x) {-# UNPACK #-} !(x)

</span><span class="hl_comment"><span class="mpre">-- | &#39;TChan&#39; is an abstract type representing an unbounded FIFO channel.</span></span><span class="mpre">
data </span><a name="loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tycondecl"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_55_16_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_21&#39;)"><span class="hl_condecl"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">_UPK_</span></span><span class="mpre">(</span><span class="hl_tyconref"><span class="mpre">TVar</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">TVarList</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">))
                     </span><span class="hl_tyvar"><span class="mpre">_UPK_</span></span><span class="mpre">(</span><span class="hl_tyconref"><span class="mpre">TVar</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">TVarList</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">))
  </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TChan.hs&quot;, srcSpanStartLine = 57, srcSpanStartColumn = 3, srcSpanEndLine = 57, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TChan.hs&quot;, srcSpanStartLine = 57, srcSpanStartColumn = 3, srcSpanEndLine = 57, srcSpanEndColumn = 11},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TChan.hs&quot;,"><span class="mpre">deriving (Eq, Typeable)</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TChan.hs&quot;, srcSpanStartLine = 59, srcSpanStartColumn = 1, srcSpanEndLine = 59, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TChan.hs&quot;, srcSpanStartLine = 59, srcSpanStartColumn = 1, srcSpanEndLine = 59, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TChan.hs&quot;, "><span class="mpre">type TVarList a = TVar (TList a)</span></span><span class="mpre">
data </span><span class="hl_tycondecl"><span class="mpre">TList</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_60_16_60_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_16_60_20&#39;)"><span class="hl_condecl"><span class="mpre">TNil</span></span></a><span class="mpre"> | </span><a name="loc_60_23_60_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_23_60_28&#39;)"><span class="hl_condecl"><span class="mpre">TCons</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">_UPK_</span></span><span class="mpre">(</span><span class="hl_tyconref"><span class="mpre">TVarList</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |Build and return a new instance of &#39;TChan&#39;</span></span><span class="mpre">
</span><a href="#loc_64_1_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_9&#39;)"><span class="mpre">newTChan</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> (</span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_64_1_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_9&#39;)"><span class="hl_vardecl"><span class="mpre">newTChan</span></span></a><span class="mpre"> = do
  </span><a name="loc_65_3_65_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_3_65_7&#39;)"><span class="hl_vardecl"><span class="mpre">hole</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVar</span></span><span class="mpre"> </span><a href="#loc_60_16_60_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_16_60_20&#39;)"><span class="hl_conref"><span class="mpre">TNil</span></span></a><span class="mpre">
  </span><a name="loc_66_3_66_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_3_66_7&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVar</span></span><span class="mpre"> </span><a href="#loc_65_3_65_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_3_65_7&#39;)"><span class="hl_varref"><span class="mpre">hole</span></span></a><span class="mpre">
  </span><a name="loc_67_3_67_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_3_67_8&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVar</span></span><span class="mpre"> </span><a href="#loc_65_3_65_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_3_65_7&#39;)"><span class="hl_varref"><span class="mpre">hole</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_55_16_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_21&#39;)"><span class="hl_conref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><a href="#loc_66_3_66_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_3_66_7&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_67_3_67_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_3_67_8&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |@IO@ version of &#39;newTChan&#39;.  This is useful for creating top-level</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;TChan&#39;s using &#39;System.IO.Unsafe.unsafePerformIO&#39;, because using</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;atomically&#39; inside &#39;System.IO.Unsafe.unsafePerformIO&#39; isn&#39;t</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- possible.</span></span><span class="mpre">
</span><a href="#loc_75_1_75_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_11&#39;)"><span class="mpre">newTChanIO</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_75_1_75_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_11&#39;)"><span class="hl_vardecl"><span class="mpre">newTChanIO</span></span></a><span class="mpre"> = do
  </span><a name="loc_76_3_76_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_3_76_7&#39;)"><span class="hl_vardecl"><span class="mpre">hole</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVarIO</span></span><span class="mpre"> </span><a href="#loc_60_16_60_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_16_60_20&#39;)"><span class="hl_conref"><span class="mpre">TNil</span></span></a><span class="mpre">
  </span><a name="loc_77_3_77_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_3_77_7&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVarIO</span></span><span class="mpre"> </span><a href="#loc_76_3_76_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_3_76_7&#39;)"><span class="hl_varref"><span class="mpre">hole</span></span></a><span class="mpre">
  </span><a name="loc_78_3_78_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_3_78_8&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVarIO</span></span><span class="mpre"> </span><a href="#loc_76_3_76_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_3_76_7&#39;)"><span class="hl_varref"><span class="mpre">hole</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_55_16_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_21&#39;)"><span class="hl_conref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><a href="#loc_77_3_77_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_3_77_7&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_78_3_78_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_3_78_8&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Create a write-only &#39;TChan&#39;.  More precisely, &#39;readTChan&#39; will &#39;retry&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- even after items have been written to the channel.  The only way to read</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a broadcast channel is to duplicate it with &#39;dupTChan&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Consider a server that broadcasts messages to clients:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;serve :: TChan Message -&gt; Client -&gt; IO loop</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;serve broadcastChan client = do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;    myChan &lt;- dupTChan broadcastChan</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;    forever $ do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;        message &lt;- readTChan myChan</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;        send client message</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The problem with using &#39;newTChan&#39; to create the broadcast channel is that if</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- it is only written to and never read, items will pile up in memory.  By</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- using &#39;newBroadcastTChan&#39; to create the broadcast channel, items can be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- garbage collected after clients have seen them.</span></span><span class="mpre">
</span><a href="#loc_99_1_99_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_18&#39;)"><span class="mpre">newBroadcastTChan</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> (</span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_99_1_99_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_18&#39;)"><span class="hl_vardecl"><span class="mpre">newBroadcastTChan</span></span></a><span class="mpre"> = do
    </span><a name="loc_100_5_100_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_5_100_15&#39;)"><span class="hl_vardecl"><span class="mpre">write_hole</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVar</span></span><span class="mpre"> </span><a href="#loc_60_16_60_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_16_60_20&#39;)"><span class="hl_conref"><span class="mpre">TNil</span></span></a><span class="mpre">
    </span><a name="loc_101_5_101_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_5_101_9&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVar</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;reading from a TChan created by newBroadcastTChan; use dupTChan first&quot;</span></span><span class="mpre">)
    </span><a name="loc_102_5_102_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_5_102_10&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVar</span></span><span class="mpre"> </span><a href="#loc_100_5_100_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_5_100_15&#39;)"><span class="hl_varref"><span class="mpre">write_hole</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_55_16_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_21&#39;)"><span class="hl_conref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><a href="#loc_101_5_101_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_5_101_9&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_102_5_102_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_5_102_10&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | @IO@ version of &#39;newBroadcastTChan&#39;.</span></span><span class="mpre">
</span><a href="#loc_107_1_107_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_1_107_20&#39;)"><span class="mpre">newBroadcastTChanIO</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_107_1_107_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_1_107_20&#39;)"><span class="hl_vardecl"><span class="mpre">newBroadcastTChanIO</span></span></a><span class="mpre"> = do
    </span><a name="loc_108_5_108_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_5_108_15&#39;)"><span class="hl_vardecl"><span class="mpre">write_hole</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVarIO</span></span><span class="mpre"> </span><a href="#loc_60_16_60_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_16_60_20&#39;)"><span class="hl_conref"><span class="mpre">TNil</span></span></a><span class="mpre">
    </span><a name="loc_109_5_109_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_5_109_9&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVarIO</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;reading from a TChan created by newBroadcastTChanIO; use dupTChan first&quot;</span></span><span class="mpre">)
    </span><a name="loc_110_5_110_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_5_110_10&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVarIO</span></span><span class="mpre"> </span><a href="#loc_108_5_108_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_5_108_15&#39;)"><span class="hl_varref"><span class="mpre">write_hole</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_55_16_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_21&#39;)"><span class="hl_conref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><a href="#loc_109_5_109_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_5_109_9&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_110_5_110_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_5_110_10&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |Write a value to a &#39;TChan&#39;.</span></span><span class="mpre">
</span><a href="#loc_115_1_115_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_1_115_11&#39;)"><span class="mpre">writeTChan</span></a><span class="mpre"> :: </span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_115_1_115_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_1_115_11&#39;)"><span class="hl_fundecl"><span class="mpre">writeTChan</span></span></a><span class="mpre"> (</span><a href="#loc_55_16_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_21&#39;)"><span class="hl_conref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_read</span></span><span class="mpre"> </span><a name="loc_115_25_115_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_25_115_30&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre">) </span><a name="loc_115_32_115_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_32_115_33&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = do
  </span><a name="loc_116_3_116_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_3_116_10&#39;)"><span class="hl_vardecl"><span class="mpre">listend</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_115_25_115_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_25_115_30&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- listend == TVar pointing to TNil</span></span><span class="mpre">
  </span><a name="loc_117_3_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_3_117_14&#39;)"><span class="hl_vardecl"><span class="mpre">new_listend</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVar</span></span><span class="mpre"> </span><a href="#loc_60_16_60_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_16_60_20&#39;)"><span class="hl_conref"><span class="mpre">TNil</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_116_3_116_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_3_116_10&#39;)"><span class="hl_varref"><span class="mpre">listend</span></span></a><span class="mpre"> (</span><a href="#loc_60_23_60_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_23_60_28&#39;)"><span class="hl_conref"><span class="mpre">TCons</span></span></a><span class="mpre"> </span><a href="#loc_115_32_115_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_32_115_33&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><a href="#loc_117_3_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_3_117_14&#39;)"><span class="hl_varref"><span class="mpre">new_listend</span></span></a><span class="mpre">)
  </span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_115_25_115_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_25_115_30&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_117_3_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_3_117_14&#39;)"><span class="hl_varref"><span class="mpre">new_listend</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Read the next value from the &#39;TChan&#39;.</span></span><span class="mpre">
</span><a href="#loc_123_1_123_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_10&#39;)"><span class="mpre">readTChan</span></a><span class="mpre"> :: </span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_123_1_123_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_10&#39;)"><span class="hl_fundecl"><span class="mpre">readTChan</span></span></a><span class="mpre"> (</span><a href="#loc_55_16_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_21&#39;)"><span class="hl_conref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><a name="loc_123_18_123_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_18_123_22&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_write</span></span><span class="mpre">) = do
  </span><a name="loc_124_3_124_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_3_124_11&#39;)"><span class="hl_vardecl"><span class="mpre">listhead</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_123_18_123_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_18_123_22&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre">
  </span><a name="loc_125_3_125_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_3_125_7&#39;)"><span class="hl_vardecl"><span class="mpre">head</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_124_3_124_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_3_124_11&#39;)"><span class="hl_varref"><span class="mpre">listhead</span></span></a><span class="mpre">
  case </span><a href="#loc_125_3_125_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_3_125_7&#39;)"><span class="hl_varref"><span class="mpre">head</span></span></a><span class="mpre"> of
    </span><a href="#loc_60_16_60_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_16_60_20&#39;)"><span class="hl_conref"><span class="mpre">TNil</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">retry</span></span><span class="mpre">
    </span><a href="#loc_60_23_60_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_23_60_28&#39;)"><span class="hl_conref"><span class="mpre">TCons</span></span></a><span class="mpre"> </span><a name="loc_128_11_128_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_11_128_12&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> </span><a name="loc_128_13_128_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_13_128_17&#39;)"><span class="hl_vardecl"><span class="mpre">tail</span></span></a><span class="mpre"> -&gt; do
        </span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_123_18_123_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_18_123_22&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_128_13_128_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_13_128_17&#39;)"><span class="hl_varref"><span class="mpre">tail</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_128_11_128_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_11_128_12&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A version of &#39;readTChan&#39; which does not retry. Instead it</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- returns @Nothing@ if no value is available.</span></span><span class="mpre">
</span><a href="#loc_135_1_135_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_1_135_13&#39;)"><span class="mpre">tryReadTChan</span></a><span class="mpre"> :: </span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_135_1_135_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_1_135_13&#39;)"><span class="hl_fundecl"><span class="mpre">tryReadTChan</span></span></a><span class="mpre"> (</span><a href="#loc_55_16_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_21&#39;)"><span class="hl_conref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><a name="loc_135_21_135_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_21_135_25&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_write</span></span><span class="mpre">) = do
  </span><a name="loc_136_3_136_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_3_136_11&#39;)"><span class="hl_vardecl"><span class="mpre">listhead</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_135_21_135_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_21_135_25&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre">
  </span><a name="loc_137_3_137_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_3_137_7&#39;)"><span class="hl_vardecl"><span class="mpre">head</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_136_3_136_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_3_136_11&#39;)"><span class="hl_varref"><span class="mpre">listhead</span></span></a><span class="mpre">
  case </span><a href="#loc_137_3_137_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_3_137_7&#39;)"><span class="hl_varref"><span class="mpre">head</span></span></a><span class="mpre"> of
    </span><a href="#loc_60_16_60_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_16_60_20&#39;)"><span class="hl_conref"><span class="mpre">TNil</span></span></a><span class="mpre">       -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
    </span><a href="#loc_60_23_60_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_23_60_28&#39;)"><span class="hl_conref"><span class="mpre">TCons</span></span></a><span class="mpre"> </span><a name="loc_140_11_140_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_11_140_12&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> </span><a name="loc_140_13_140_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_13_140_15&#39;)"><span class="hl_vardecl"><span class="mpre">tl</span></span></a><span class="mpre"> -&gt; do
      </span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_135_21_135_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_21_135_25&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_140_13_140_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_13_140_15&#39;)"><span class="hl_varref"><span class="mpre">tl</span></span></a><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_140_11_140_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_11_140_12&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Get the next value from the @TChan@ without removing it,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- retrying if the channel is empty.</span></span><span class="mpre">
</span><a href="#loc_147_1_147_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_10&#39;)"><span class="mpre">peekTChan</span></a><span class="mpre"> :: </span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_147_1_147_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_1_147_10&#39;)"><span class="hl_fundecl"><span class="mpre">peekTChan</span></span></a><span class="mpre"> (</span><a href="#loc_55_16_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_21&#39;)"><span class="hl_conref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><a name="loc_147_18_147_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_18_147_22&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_write</span></span><span class="mpre">) = do
  </span><a name="loc_148_3_148_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_3_148_11&#39;)"><span class="hl_vardecl"><span class="mpre">listhead</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_147_18_147_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_18_147_22&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre">
  </span><a name="loc_149_3_149_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_3_149_7&#39;)"><span class="hl_vardecl"><span class="mpre">head</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_148_3_148_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_3_148_11&#39;)"><span class="hl_varref"><span class="mpre">listhead</span></span></a><span class="mpre">
  case </span><a href="#loc_149_3_149_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_3_149_7&#39;)"><span class="hl_varref"><span class="mpre">head</span></span></a><span class="mpre"> of
    </span><a href="#loc_60_16_60_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_16_60_20&#39;)"><span class="hl_conref"><span class="mpre">TNil</span></span></a><span class="mpre">      -&gt; </span><span class="hl_varref"><span class="mpre">retry</span></span><span class="mpre">
    </span><a href="#loc_60_23_60_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_23_60_28&#39;)"><span class="hl_conref"><span class="mpre">TCons</span></span></a><span class="mpre"> </span><a name="loc_152_11_152_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_11_152_12&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> _ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_152_11_152_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_11_152_12&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A version of &#39;peekTChan&#39; which does not retry. Instead it</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- returns @Nothing@ if no value is available.</span></span><span class="mpre">
</span><a href="#loc_157_1_157_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_1_157_13&#39;)"><span class="mpre">tryPeekTChan</span></a><span class="mpre"> :: </span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_157_1_157_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_1_157_13&#39;)"><span class="hl_fundecl"><span class="mpre">tryPeekTChan</span></span></a><span class="mpre"> (</span><a href="#loc_55_16_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_21&#39;)"><span class="hl_conref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><a name="loc_157_21_157_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_21_157_25&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_write</span></span><span class="mpre">) = do
  </span><a name="loc_158_3_158_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_3_158_11&#39;)"><span class="hl_vardecl"><span class="mpre">listhead</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_157_21_157_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_21_157_25&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre">
  </span><a name="loc_159_3_159_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_3_159_7&#39;)"><span class="hl_vardecl"><span class="mpre">head</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_158_3_158_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_3_158_11&#39;)"><span class="hl_varref"><span class="mpre">listhead</span></span></a><span class="mpre">
  case </span><a href="#loc_159_3_159_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_3_159_7&#39;)"><span class="hl_varref"><span class="mpre">head</span></span></a><span class="mpre"> of
    </span><a href="#loc_60_16_60_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_16_60_20&#39;)"><span class="hl_conref"><span class="mpre">TNil</span></span></a><span class="mpre">      -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
    </span><a href="#loc_60_23_60_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_23_60_28&#39;)"><span class="hl_conref"><span class="mpre">TCons</span></span></a><span class="mpre"> </span><a name="loc_162_11_162_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_11_162_12&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> _ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_162_11_162_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_11_162_12&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |Duplicate a &#39;TChan&#39;: the duplicate channel begins empty, but data written to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- either channel from then on will be available from both.  Hence this creates</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a kind of broadcast channel, where data written by anyone is seen by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- everyone else.</span></span><span class="mpre">
</span><a href="#loc_169_1_169_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_1_169_9&#39;)"><span class="mpre">dupTChan</span></a><span class="mpre"> :: </span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> (</span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_169_1_169_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_1_169_9&#39;)"><span class="hl_fundecl"><span class="mpre">dupTChan</span></span></a><span class="mpre"> (</span><a href="#loc_55_16_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_21&#39;)"><span class="hl_conref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_read</span></span><span class="mpre"> </span><a name="loc_169_23_169_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_23_169_28&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre">) = do
  </span><a name="loc_170_3_170_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_3_170_7&#39;)"><span class="hl_vardecl"><span class="mpre">hole</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_169_23_169_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_23_169_28&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre">  
  </span><a name="loc_171_3_171_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_3_171_11&#39;)"><span class="hl_vardecl"><span class="mpre">new_read</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVar</span></span><span class="mpre"> </span><a href="#loc_170_3_170_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_3_170_7&#39;)"><span class="hl_varref"><span class="mpre">hole</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_55_16_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_21&#39;)"><span class="hl_conref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><a href="#loc_171_3_171_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_3_171_11&#39;)"><span class="hl_varref"><span class="mpre">new_read</span></span></a><span class="mpre"> </span><a href="#loc_169_23_169_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_23_169_28&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |Put a data item back onto a channel, where it will be the next item read.</span></span><span class="mpre">
</span><a href="#loc_176_1_176_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_1_176_11&#39;)"><span class="mpre">unGetTChan</span></a><span class="mpre"> :: </span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_176_1_176_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_1_176_11&#39;)"><span class="hl_fundecl"><span class="mpre">unGetTChan</span></span></a><span class="mpre"> (</span><a href="#loc_55_16_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_21&#39;)"><span class="hl_conref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><a name="loc_176_19_176_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_19_176_23&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_write</span></span><span class="mpre">) </span><a name="loc_176_32_176_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_32_176_33&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = do
   </span><a name="loc_177_4_177_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_4_177_12&#39;)"><span class="hl_vardecl"><span class="mpre">listhead</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_176_19_176_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_19_176_23&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre">
   </span><a name="loc_178_4_178_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_4_178_11&#39;)"><span class="hl_vardecl"><span class="mpre">newhead</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVar</span></span><span class="mpre"> (</span><a href="#loc_60_23_60_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_23_60_28&#39;)"><span class="hl_conref"><span class="mpre">TCons</span></span></a><span class="mpre"> </span><a href="#loc_176_32_176_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_32_176_33&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><a href="#loc_177_4_177_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_4_177_12&#39;)"><span class="hl_varref"><span class="mpre">listhead</span></span></a><span class="mpre">)
   </span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_176_19_176_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_19_176_23&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_178_4_178_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_4_178_11&#39;)"><span class="hl_varref"><span class="mpre">newhead</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Returns &#39;True&#39; if the supplied &#39;TChan&#39; is empty.</span></span><span class="mpre">
</span><a href="#loc_183_1_183_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_13&#39;)"><span class="mpre">isEmptyTChan</span></a><span class="mpre"> :: </span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_183_1_183_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_13&#39;)"><span class="hl_fundecl"><span class="mpre">isEmptyTChan</span></span></a><span class="mpre"> (</span><a href="#loc_55_16_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_21&#39;)"><span class="hl_conref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><a name="loc_183_21_183_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_21_183_25&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_write</span></span><span class="mpre">) = do
  </span><a name="loc_184_3_184_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_3_184_11&#39;)"><span class="hl_vardecl"><span class="mpre">listhead</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_183_21_183_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_21_183_25&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre">
  </span><a name="loc_185_3_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_3_185_7&#39;)"><span class="hl_vardecl"><span class="mpre">head</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_184_3_184_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_3_184_11&#39;)"><span class="hl_varref"><span class="mpre">listhead</span></span></a><span class="mpre">
  case </span><a href="#loc_185_3_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_3_185_7&#39;)"><span class="hl_varref"><span class="mpre">head</span></span></a><span class="mpre"> of
    </span><a href="#loc_60_16_60_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_16_60_20&#39;)"><span class="hl_conref"><span class="mpre">TNil</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
    </span><a href="#loc_60_23_60_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_23_60_28&#39;)"><span class="hl_conref"><span class="mpre">TCons</span></span></a><span class="mpre"> _ _ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Clone a &#39;TChan&#39;: similar to dupTChan, but the cloned channel starts with the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- same content available as the original channel.</span></span><span class="mpre">
</span><a href="#loc_193_1_193_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_1_193_11&#39;)"><span class="mpre">cloneTChan</span></a><span class="mpre"> :: </span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> (</span><a href="#loc_55_6_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_11&#39;)"><span class="hl_tyconref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_193_1_193_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_1_193_11&#39;)"><span class="hl_fundecl"><span class="mpre">cloneTChan</span></span></a><span class="mpre"> (</span><a href="#loc_55_16_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_21&#39;)"><span class="hl_conref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><a name="loc_193_19_193_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_19_193_23&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre"> </span><a name="loc_193_24_193_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_24_193_29&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre">) = do
  </span><a name="loc_194_3_194_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_3_194_10&#39;)"><span class="hl_vardecl"><span class="mpre">readpos</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_193_19_193_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_19_193_23&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre">
  </span><a name="loc_195_3_195_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_3_195_11&#39;)"><span class="hl_vardecl"><span class="mpre">new_read</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVar</span></span><span class="mpre"> </span><a href="#loc_194_3_194_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_3_194_10&#39;)"><span class="hl_varref"><span class="mpre">readpos</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_55_16_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_16_55_21&#39;)"><span class="hl_conref"><span class="mpre">TChan</span></span></a><span class="mpre"> </span><a href="#loc_195_3_195_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_3_195_11&#39;)"><span class="hl_varref"><span class="mpre">new_read</span></span></a><span class="mpre"> </span><a href="#loc_193_24_193_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_24_193_29&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre">)
#endif
</span></div></body></html>