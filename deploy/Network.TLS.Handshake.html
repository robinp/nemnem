<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Network.TLS.Handshake</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Network.TLS.Handshake
    ( handshake
    , handshakeClientWith
    , handshakeServerWith
    , handshakeClient
    , handshakeServer
    ) where

import Network.TLS.Context.Internal
import Network.TLS.Struct
import Network.TLS.IO
import Network.TLS.Util (</span><a href="Network.TLS.Util.html#loc_81_1_81_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_81_1_81_15&#39;)"><span class="mpre">catchException</span></a><span class="mpre">)

import Network.TLS.Handshake.Common
import Network.TLS.Handshake.Client
import Network.TLS.Handshake.Server

import Control.Monad.State
import Control.Exception (fromException)

</span><span class="hl_comment"><span class="mpre">-- | Handshake for a new TLS connection</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This is to be called at the beginning of a connection, and during renegotiation</span></span><span class="mpre">
</span><a href="#loc_31_1_31_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_1_31_10&#39;)"><span class="mpre">handshake</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake.hs&quot;, srcSpanStartLine = 30, srcSpanStartColumn = 14, srcSpanEndLine = 30, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Handshake.hs&quot;, srcSpanStartLine = 30, srcSpanStartColumn = 24, srcSpanEndLine = 30, srcSpanEndColumn = 26}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Networ"><span class="mpre">MonadIO m =&gt;</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_31_1_31_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_1_31_10&#39;)"><span class="hl_fundecl"><span class="mpre">handshake</span></span></a><span class="mpre"> </span><a name="loc_31_11_31_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_14&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> =
    </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_33_9_33_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_9_33_24&#39;)"><span class="hl_varref"><span class="mpre">handleException</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_220_1_220_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_220_1_220_11&#39;)"><span class="hl_varref"><span class="mpre">withRWLock</span></span></a><span class="mpre"> </span><a href="#loc_31_11_31_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_14&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Context.Internal.html#loc_101_7_101_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_101_7_101_21&#39;)"><span class="hl_varref"><span class="mpre">ctxDoHandshake</span></span></a><span class="mpre"> </span><a href="#loc_31_11_31_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_14&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_31_11_31_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_14&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">)
  where </span><a name="loc_33_9_33_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_9_33_24&#39;)"><span class="hl_fundecl"><span class="mpre">handleException</span></span></a><span class="mpre"> </span><a name="loc_33_25_33_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_25_33_26&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Util.html#loc_81_1_81_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_81_1_81_15&#39;)"><span class="hl_varref"><span class="mpre">catchException</span></span></a><span class="mpre"> </span><a href="#loc_33_25_33_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_25_33_26&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_33_49_33_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_49_33_58&#39;)"><span class="hl_vardecl"><span class="mpre">exception</span></span></a><span class="mpre"> -&gt; do
            let </span><a name="loc_34_17_34_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_17_34_25&#39;)"><span class="hl_vardecl"><span class="mpre">tlserror</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_122_7_122_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_122_7_122_17&#39;)"><span class="hl_conref"><span class="mpre">Error_Misc</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_33_49_33_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_49_33_58&#39;)"><span class="hl_varref"><span class="mpre">exception</span></span></a><span class="mpre">) </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromException</span></span><span class="mpre"> </span><a href="#loc_33_49_33_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_49_33_58&#39;)"><span class="hl_varref"><span class="mpre">exception</span></span></a><span class="mpre">
            </span><a href="Network.TLS.Context.Internal.html#loc_161_1_161_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_161_1_161_15&#39;)"><span class="hl_varref"><span class="mpre">setEstablished</span></span></a><span class="mpre"> </span><a href="#loc_31_11_31_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_14&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
            </span><a href="Network.TLS.IO.html#loc_106_1_106_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.IO.html#loc_106_1_106_11&#39;)"><span class="hl_varref"><span class="mpre">sendPacket</span></span></a><span class="mpre"> </span><a href="#loc_31_11_31_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_14&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Handshake.Common.html#loc_42_1_42_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_42_1_42_13&#39;)"><span class="hl_varref"><span class="mpre">errorToAlert</span></span></a><span class="mpre"> </span><a href="#loc_34_17_34_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_17_34_25&#39;)"><span class="hl_varref"><span class="mpre">tlserror</span></span></a><span class="mpre">)
            </span><a href="Network.TLS.Handshake.Common.html#loc_39_1_39_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Common.html#loc_39_1_39_16&#39;)"><span class="hl_varref"><span class="mpre">handshakeFailed</span></span></a><span class="mpre"> </span><a href="#loc_34_17_34_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_17_34_25&#39;)"><span class="hl_varref"><span class="mpre">tlserror</span></span></a><span class="mpre">
</span></div></body></html>