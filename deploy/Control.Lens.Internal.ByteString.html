<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE CPP #-}
{-# LANGUAGE Rank2Types #-}
{-# LANGUAGE BangPatterns #-}
{-# LANGUAGE PatternGuards #-}
{-# LANGUAGE FlexibleContexts #-}
#ifdef TRUSTWORTHY
{-# LANGUAGE Trustworthy #-}
#endif
#ifndef MIN_VERSION_base
#define MIN_VERSION_base(x,y,z) 1
#endif
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Data.ByteString.Strict.Lens</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (C) 2012-2014 Edward Kmett</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD-style (see the file LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  Edward Kmett &lt;ekmett@gmail.com&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This module spends a lot of time fiddling around with &#39;Data.ByteString&#39; internals</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to work around &lt;http://hackage.haskell.org/trac/ghc/ticket/7556&gt; on older</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Haskell Platforms and to improve constant and asymptotic factors in our performance.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------------------</span></span><span class="mpre">
module Control.Lens.Internal.ByteString
  ( unpackStrict, traversedStrict, traversedStrictTree
  , unpackStrict8, traversedStrict8, traversedStrictTree8
  , unpackLazy, traversedLazy
  , unpackLazy8, traversedLazy8
  ) where

import Control.Applicative
import Control.Lens
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/lens-4.3/src/Control/Lens/Internal/ByteString.hs&quot;, srcSpanStartLine = 34, srcSpanStartColumn = 18, srcSpanEndLine = 34, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre">               as B
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/lens-4.3/src/Control/Lens/Internal/ByteString.hs&quot;, srcSpanStartLine = 35, srcSpanStartColumn = 18, srcSpanEndLine = 35, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre">          as BL
import qualified Data.ByteString.Lazy.Internal as BLI
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/lens-4.3/src/Control/Lens/Internal/ByteString.hs&quot;, srcSpanStartLine = 37, srcSpanStartColumn = 18, srcSpanEndLine = 37, srcSpanEndColumn = 44}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy.Char8&quot;"><span class="mpre">Data.ByteString.Lazy.Char8</span></span><span class="mpre">    as BL8
import qualified Data.ByteString.Internal      as BI
import Data.Bits
import Data.Char
import Data.Int (</span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="mpre">Int64</span></a><span class="mpre">)
import Data.Word (Word8)
import Foreign.Ptr
import Foreign.Storable
#if MIN_VERSION_base(4,4,0)
import Foreign.ForeignPtr.Safe
import Foreign.ForeignPtr.Unsafe
#else
import Foreign.ForeignPtr
#endif
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/lens-4.3/src/Control/Lens/Internal/ByteString.hs&quot;, srcSpanStartLine = 51, srcSpanStartColumn = 8, srcSpanEndLine = 51, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre"> (unsafeChr)
import GHC.ForeignPtr (</span><a href="GHC.ForeignPtr.html#loc_227_1_227_27" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.ForeignPtr.html#loc_227_1_227_27&#39;)"><span class="mpre">mallocPlainForeignPtrBytes</span></a><span class="mpre">)
import GHC.IO (</span><a href="GHC.IO.html#loc_182_1_182_23" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_182_1_182_23&#39;)"><span class="mpre">unsafeDupablePerformIO</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Traverse a strict &#39;B.ByteString&#39; from left to right in a biased fashion.</span></span><span class="mpre">
</span><a href="#loc_57_1_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_16&#39;)"><span class="mpre">traversedStrict</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IndexedTraversal&#39;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">
</span><a name="loc_57_1_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_16&#39;)"><span class="hl_fundecl"><span class="mpre">traversedStrict</span></span></a><span class="mpre"> </span><a name="loc_57_17_57_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_17_57_19&#39;)"><span class="hl_vardecl"><span class="mpre">i0</span></span></a><span class="mpre"> </span><a name="loc_57_20_57_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_20_57_24&#39;)"><span class="hl_vardecl"><span class="mpre">pafb</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">BI.PS</span></span></a><span class="mpre"> </span><a name="loc_57_32_57_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_32_57_34&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a name="loc_57_35_57_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_35_57_38&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_57_39_57_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_39_57_42&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">) =
  let </span><a name="loc_58_7_58_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_7_58_8&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span><span class="mpre"> </span><a href="#loc_57_32_57_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_32_57_34&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
   in </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> (</span><a href="#loc_61_4_61_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_4_61_11&#39;)"><span class="hl_varref"><span class="mpre">rebuild</span></span></a><span class="mpre"> </span><a href="#loc_57_39_57_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_39_57_42&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">) (</span><a href="#loc_65_4_65_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_4_65_6&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_57_17_57_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_17_57_19&#39;)"><span class="hl_varref"><span class="mpre">i0</span></span></a><span class="mpre"> (</span><a href="#loc_58_7_58_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_7_58_8&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_57_35_57_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_35_57_38&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre">) (</span><a href="#loc_58_7_58_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_7_58_8&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (</span><a href="#loc_57_35_57_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_35_57_38&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_57_39_57_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_39_57_42&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">)))
 where
   </span><a name="loc_61_4_61_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_4_61_11&#39;)"><span class="hl_fundecl"><span class="mpre">rebuild</span></span></a><span class="mpre"> </span><a name="loc_61_12_61_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_12_61_13&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = \</span><a name="loc_61_17_61_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_17_61_19&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_216_1_216_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_1_216_13&#39;)"><span class="hl_varref"><span class="mpre">unsafeCreate</span></span></a><span class="mpre"> </span><a href="#loc_61_12_61_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_12_61_13&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_61_41_61_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_41_61_42&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_62_4_62_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_4_62_7&#39;)"><span class="hl_varref"><span class="mpre">go2</span></span></a><span class="mpre"> </span><a href="#loc_61_41_61_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_41_61_42&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_61_17_61_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_17_61_19&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">
   </span><a name="loc_62_4_62_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_4_62_7&#39;)"><span class="hl_fundecl"><span class="mpre">go2</span></span></a><span class="mpre"> !</span><a name="loc_62_9_62_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_9_62_10&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> (</span><a name="loc_62_12_62_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_12_62_13&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_62_14_62_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_14_62_16&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_62_9_62_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_9_62_10&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_62_12_62_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_12_62_13&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_62_4_62_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_4_62_7&#39;)"><span class="hl_varref"><span class="mpre">go2</span></span></a><span class="mpre"> (</span><a href="#loc_62_9_62_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_9_62_10&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_62_14_62_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_14_62_16&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">
   </span><a href="#loc_62_4_62_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_4_62_7&#39;)"><span class="hl_fundecl"><span class="mpre">go2</span></span></a><span class="mpre"> _  []     = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
   </span><span class="hl_comment"><span class="mpre">-- TODO: use a balanced tree (up to some grain size)</span></span><span class="mpre">
   </span><a name="loc_65_4_65_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_4_65_6&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> !</span><a name="loc_65_8_65_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_8_65_9&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> !</span><a name="loc_65_11_65_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_11_65_12&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> !</span><a name="loc_65_14_65_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_14_65_15&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre">
     | </span><a href="#loc_65_11_65_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_11_65_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_65_14_65_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_14_65_15&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre"> = </span><a href="Control.Applicative.html#loc_115_5_115_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_115_5_115_9&#39;)"><span class="hl_varref"><span class="mpre">pure</span></span></a><span class="mpre"> []
     | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = let !</span><a name="loc_67_25_67_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_25_67_26&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">BI.inlinePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
                              </span><a name="loc_68_31_68_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_31_68_33&#39;)"><span class="hl_vardecl"><span class="mpre">x&#39;</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peek</span></span><span class="mpre"> </span><a href="#loc_65_11_65_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_11_65_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">
                              </span><span class="hl_varref"><span class="mpre">touchForeignPtr</span></span><span class="mpre"> </span><a href="#loc_57_32_57_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_32_57_34&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
                              </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_68_31_68_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_31_68_33&#39;)"><span class="hl_varref"><span class="mpre">x&#39;</span></span></a><span class="mpre">
                   in </span><span class="hl_conref"><span class="mpre">(:)</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">indexed</span></span><span class="mpre"> </span><a href="#loc_57_20_57_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_20_57_24&#39;)"><span class="hl_varref"><span class="mpre">pafb</span></span></a><span class="mpre"> (</span><a href="#loc_65_8_65_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_8_65_9&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">) </span><a href="#loc_67_25_67_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_25_67_26&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="#loc_65_4_65_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_4_65_6&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><a href="#loc_65_8_65_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_8_65_9&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><a href="#loc_65_11_65_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_11_65_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_65_14_65_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_14_65_15&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_57_1_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_16&#39;)"><span class="mpre">traversedStrict</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Traverse a strict &#39;B.ByteString&#39; from left to right in a biased fashion</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- pretending the bytes are characters.</span></span><span class="mpre">
</span><a href="#loc_77_1_77_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_1_77_17&#39;)"><span class="mpre">traversedStrict8</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IndexedTraversal&#39;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">
</span><a name="loc_77_1_77_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_1_77_17&#39;)"><span class="hl_fundecl"><span class="mpre">traversedStrict8</span></span></a><span class="mpre"> </span><a name="loc_77_18_77_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_18_77_20&#39;)"><span class="hl_vardecl"><span class="mpre">i0</span></span></a><span class="mpre"> </span><a name="loc_77_21_77_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_21_77_25&#39;)"><span class="hl_vardecl"><span class="mpre">pafb</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">BI.PS</span></span></a><span class="mpre"> </span><a name="loc_77_33_77_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_33_77_35&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a name="loc_77_36_77_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_36_77_39&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_77_40_77_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_40_77_43&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">) =
  let </span><a name="loc_78_7_78_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_7_78_8&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span><span class="mpre"> </span><a href="#loc_77_33_77_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_33_77_35&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
   in </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> (</span><a href="#loc_81_4_81_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_4_81_11&#39;)"><span class="hl_varref"><span class="mpre">rebuild</span></span></a><span class="mpre"> </span><a href="#loc_77_40_77_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_40_77_43&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">) (</span><a href="#loc_85_4_85_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_4_85_6&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_77_18_77_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_18_77_20&#39;)"><span class="hl_varref"><span class="mpre">i0</span></span></a><span class="mpre"> (</span><a href="#loc_78_7_78_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_7_78_8&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_77_36_77_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_36_77_39&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre">) (</span><a href="#loc_78_7_78_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_7_78_8&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (</span><a href="#loc_77_36_77_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_36_77_39&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_77_40_77_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_40_77_43&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">)))
 where
   </span><a name="loc_81_4_81_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_4_81_11&#39;)"><span class="hl_fundecl"><span class="mpre">rebuild</span></span></a><span class="mpre"> </span><a name="loc_81_12_81_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_12_81_13&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = \</span><a name="loc_81_17_81_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_17_81_19&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_216_1_216_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_1_216_13&#39;)"><span class="hl_varref"><span class="mpre">unsafeCreate</span></span></a><span class="mpre"> </span><a href="#loc_81_12_81_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_12_81_13&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_81_41_81_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_41_81_42&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_82_4_82_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_4_82_7&#39;)"><span class="hl_varref"><span class="mpre">go2</span></span></a><span class="mpre"> </span><a href="#loc_81_41_81_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_41_81_42&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_81_17_81_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_17_81_19&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">
   </span><a name="loc_82_4_82_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_4_82_7&#39;)"><span class="hl_fundecl"><span class="mpre">go2</span></span></a><span class="mpre"> !</span><a name="loc_82_9_82_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_9_82_10&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> (</span><a name="loc_82_12_82_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_12_82_13&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_82_14_82_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_14_82_16&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_82_9_82_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_9_82_10&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> (</span><a href="#loc_175_1_175_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_1_175_4&#39;)"><span class="hl_varref"><span class="mpre">c2w</span></span></a><span class="mpre"> </span><a href="#loc_82_12_82_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_12_82_13&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_82_4_82_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_4_82_7&#39;)"><span class="hl_varref"><span class="mpre">go2</span></span></a><span class="mpre"> (</span><a href="#loc_82_9_82_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_9_82_10&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_82_14_82_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_14_82_16&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">
   </span><a href="#loc_82_4_82_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_4_82_7&#39;)"><span class="hl_fundecl"><span class="mpre">go2</span></span></a><span class="mpre"> _  []     = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
   </span><span class="hl_comment"><span class="mpre">-- TODO: use a balanced tree (up to some grain size)</span></span><span class="mpre">
   </span><a name="loc_85_4_85_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_4_85_6&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> !</span><a name="loc_85_8_85_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_8_85_9&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> !</span><a name="loc_85_11_85_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_11_85_12&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> !</span><a name="loc_85_14_85_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_14_85_15&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre">
     | </span><a href="#loc_85_11_85_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_11_85_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_85_14_85_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_14_85_15&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre"> = </span><a href="Control.Applicative.html#loc_115_5_115_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_115_5_115_9&#39;)"><span class="hl_varref"><span class="mpre">pure</span></span></a><span class="mpre"> []
     | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = let !</span><a name="loc_87_25_87_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_25_87_26&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">BI.inlinePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
                              </span><a name="loc_88_31_88_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_31_88_33&#39;)"><span class="hl_vardecl"><span class="mpre">x&#39;</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peek</span></span><span class="mpre"> </span><a href="#loc_85_11_85_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_11_85_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">
                              </span><span class="hl_varref"><span class="mpre">touchForeignPtr</span></span><span class="mpre"> </span><a href="#loc_77_33_77_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_33_77_35&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
                              </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_88_31_88_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_31_88_33&#39;)"><span class="hl_varref"><span class="mpre">x&#39;</span></span></a><span class="mpre">
                   in </span><span class="hl_conref"><span class="mpre">(:)</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">indexed</span></span><span class="mpre"> </span><a href="#loc_77_21_77_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_21_77_25&#39;)"><span class="hl_varref"><span class="mpre">pafb</span></span></a><span class="mpre"> (</span><a href="#loc_85_8_85_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_8_85_9&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">) (</span><a href="#loc_168_1_168_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_1_168_4&#39;)"><span class="hl_varref"><span class="mpre">w2c</span></span></a><span class="mpre"> </span><a href="#loc_87_25_87_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_25_87_26&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="#loc_85_4_85_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_4_85_6&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><a href="#loc_85_8_85_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_8_85_9&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><a href="#loc_85_11_85_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_11_85_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_85_14_85_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_14_85_15&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_77_1_77_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_1_77_17&#39;)"><span class="mpre">traversedStrict8</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_95_1_95_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_1_95_6&#39;)"><span class="mpre">grain</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_95_1_95_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_1_95_6&#39;)"><span class="hl_vardecl"><span class="mpre">grain</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">32</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_95_1_95_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_1_95_6&#39;)"><span class="mpre">grain</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Traverse a strict &#39;B.ByteString&#39; in a relatively balanced fashion, as a balanced tree with biased runs of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- elements at the leaves.</span></span><span class="mpre">
</span><a href="#loc_101_1_101_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_20&#39;)"><span class="mpre">traversedStrictTree</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IndexedTraversal&#39;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">
</span><a name="loc_101_1_101_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_20&#39;)"><span class="hl_fundecl"><span class="mpre">traversedStrictTree</span></span></a><span class="mpre"> </span><a name="loc_101_21_101_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_21_101_23&#39;)"><span class="hl_vardecl"><span class="mpre">i0</span></span></a><span class="mpre"> </span><a name="loc_101_24_101_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_24_101_28&#39;)"><span class="hl_vardecl"><span class="mpre">pafb</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">BI.PS</span></span></a><span class="mpre"> </span><a name="loc_101_36_101_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_36_101_38&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a name="loc_101_39_101_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_39_101_42&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_101_43_101_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_43_101_46&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">) = </span><a href="#loc_103_4_103_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_4_103_11&#39;)"><span class="hl_varref"><span class="mpre">rebuild</span></span></a><span class="mpre"> </span><a href="#loc_101_43_101_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_43_101_46&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="#loc_104_4_104_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_4_104_6&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span><span class="mpre"> </span><a href="#loc_101_36_101_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_36_101_38&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (</span><a href="#loc_101_39_101_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_39_101_42&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_101_21_101_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_21_101_23&#39;)"><span class="hl_varref"><span class="mpre">i0</span></span></a><span class="mpre">)) </span><a href="#loc_101_21_101_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_21_101_23&#39;)"><span class="hl_varref"><span class="mpre">i0</span></span></a><span class="mpre"> (</span><a href="#loc_101_21_101_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_21_101_23&#39;)"><span class="hl_varref"><span class="mpre">i0</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_101_43_101_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_43_101_46&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">)
 where
   </span><a name="loc_103_4_103_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_4_103_11&#39;)"><span class="hl_fundecl"><span class="mpre">rebuild</span></span></a><span class="mpre"> </span><a name="loc_103_12_103_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_12_103_13&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> </span><a name="loc_103_14_103_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_14_103_15&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_216_1_216_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_1_216_13&#39;)"><span class="hl_varref"><span class="mpre">unsafeCreate</span></span></a><span class="mpre"> </span><a href="#loc_103_12_103_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_12_103_13&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_103_36_103_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_36_103_37&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_103_14_103_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_14_103_15&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> (</span><a href="#loc_103_36_103_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_36_103_37&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (</span><a href="#loc_101_39_101_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_39_101_42&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_101_21_101_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_21_101_23&#39;)"><span class="hl_varref"><span class="mpre">i0</span></span></a><span class="mpre">))
   </span><a name="loc_104_4_104_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_4_104_6&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> !</span><a name="loc_104_8_104_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_8_104_9&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> !</span><a name="loc_104_11_104_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_11_104_12&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> !</span><a name="loc_104_14_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_14_104_15&#39;)"><span class="hl_vardecl"><span class="mpre">j</span></span></a><span class="mpre">
     | </span><a href="#loc_104_11_104_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_11_104_12&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_95_1_95_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_1_95_6&#39;)"><span class="hl_varref"><span class="mpre">grain</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_104_14_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_14_104_15&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">k</span></span><span class="mpre"> &lt;- </span><a href="#loc_104_11_104_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_11_104_12&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_varref"><span class="mpre">shiftR</span></span></a><span class="mpre"> (</span><a href="#loc_104_14_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_14_104_15&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_104_11_104_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_11_104_12&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> = (\</span><a name="loc_105_53_105_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_53_105_54&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> </span><a name="loc_105_55_105_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_55_105_56&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> </span><a name="loc_105_57_105_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_57_105_58&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_105_53_105_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_53_105_54&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><a href="#loc_105_57_105_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_57_105_58&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_105_55_105_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_55_105_56&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><a href="#loc_105_57_105_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_57_105_58&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">) </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="#loc_104_4_104_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_4_104_6&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_104_8_104_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_8_104_9&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_104_11_104_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_11_104_12&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">k</span></span><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="#loc_104_4_104_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_4_104_6&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_104_8_104_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_8_104_9&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">k</span></span><span class="mpre"> </span><a href="#loc_104_14_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_14_104_15&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre">
     | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="#loc_107_4_107_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_4_107_7&#39;)"><span class="hl_varref"><span class="mpre">run</span></span></a><span class="mpre"> </span><a href="#loc_104_8_104_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_8_104_9&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_104_11_104_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_11_104_12&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="#loc_104_14_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_14_104_15&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre">
   </span><a name="loc_107_4_107_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_4_107_7&#39;)"><span class="hl_fundecl"><span class="mpre">run</span></span></a><span class="mpre"> !</span><a name="loc_107_9_107_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_10&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> !</span><a name="loc_107_12_107_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_12_107_13&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> !</span><a name="loc_107_15_107_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_15_107_16&#39;)"><span class="hl_vardecl"><span class="mpre">j</span></span></a><span class="mpre">
     | </span><a href="#loc_107_12_107_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_12_107_13&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_107_15_107_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_15_107_16&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre">    = </span><a href="Control.Applicative.html#loc_115_5_115_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_115_5_115_9&#39;)"><span class="hl_varref"><span class="mpre">pure</span></span></a><span class="mpre"> (\_ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)
     | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = let !</span><a name="loc_109_25_109_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_25_109_26&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">BI.inlinePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
                          </span><a name="loc_110_27_110_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_27_110_29&#39;)"><span class="hl_vardecl"><span class="mpre">x&#39;</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekByteOff</span></span><span class="mpre"> </span><a href="#loc_107_9_107_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_10&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_107_12_107_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_12_107_13&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
                          </span><span class="hl_varref"><span class="mpre">touchForeignPtr</span></span><span class="mpre"> </span><a href="#loc_101_36_101_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_36_101_38&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
                          </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_110_27_110_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_27_110_29&#39;)"><span class="hl_varref"><span class="mpre">x&#39;</span></span></a><span class="mpre">
                   in (\</span><a name="loc_113_25_113_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_25_113_26&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre"> </span><a name="loc_113_27_113_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_27_113_29&#39;)"><span class="hl_vardecl"><span class="mpre">ys</span></span></a><span class="mpre"> !</span><a name="loc_113_31_113_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_31_113_32&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">pokeByteOff</span></span><span class="mpre"> </span><a href="#loc_113_31_113_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_31_113_32&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre"> </span><a href="#loc_107_12_107_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_12_107_13&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="#loc_113_25_113_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_25_113_26&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_113_27_113_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_27_113_29&#39;)"><span class="hl_varref"><span class="mpre">ys</span></span></a><span class="mpre"> </span><a href="#loc_113_31_113_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_31_113_32&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">) </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">indexed</span></span><span class="mpre"> </span><a href="#loc_101_24_101_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_24_101_28&#39;)"><span class="hl_varref"><span class="mpre">pafb</span></span></a><span class="mpre"> (</span><a href="#loc_107_12_107_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_12_107_13&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">) </span><a href="#loc_109_25_109_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_25_109_26&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="#loc_107_4_107_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_4_107_7&#39;)"><span class="hl_varref"><span class="mpre">run</span></span></a><span class="mpre"> </span><a href="#loc_107_9_107_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_10&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> (</span><a href="#loc_107_12_107_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_12_107_13&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_107_15_107_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_15_107_16&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_101_1_101_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_20&#39;)"><span class="mpre">traversedStrictTree</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Traverse a strict &#39;B.ByteString&#39; in a relatively balanced fashion, as a balanced tree with biased runs of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- elements at the leaves, pretending the bytes are chars.</span></span><span class="mpre">
</span><a href="#loc_119_1_119_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_21&#39;)"><span class="mpre">traversedStrictTree8</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IndexedTraversal&#39;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">
</span><a name="loc_119_1_119_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_21&#39;)"><span class="hl_fundecl"><span class="mpre">traversedStrictTree8</span></span></a><span class="mpre"> </span><a name="loc_119_22_119_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_22_119_24&#39;)"><span class="hl_vardecl"><span class="mpre">i0</span></span></a><span class="mpre"> </span><a name="loc_119_25_119_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_25_119_29&#39;)"><span class="hl_vardecl"><span class="mpre">pafb</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">BI.PS</span></span></a><span class="mpre"> </span><a name="loc_119_37_119_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_37_119_39&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a name="loc_119_40_119_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_40_119_43&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_119_44_119_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_44_119_47&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">) = </span><a href="#loc_122_4_122_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_4_122_11&#39;)"><span class="hl_varref"><span class="mpre">rebuild</span></span></a><span class="mpre"> </span><a href="#loc_119_44_119_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_44_119_47&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="#loc_123_4_123_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_4_123_6&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_119_22_119_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_22_119_24&#39;)"><span class="hl_varref"><span class="mpre">i0</span></span></a><span class="mpre"> (</span><a href="#loc_119_22_119_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_22_119_24&#39;)"><span class="hl_varref"><span class="mpre">i0</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_119_44_119_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_44_119_47&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">)
 where
   </span><a name="loc_121_4_121_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_4_121_5&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span><span class="mpre"> </span><a href="#loc_119_37_119_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_37_119_39&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (</span><a href="#loc_119_40_119_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_40_119_43&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_119_22_119_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_22_119_24&#39;)"><span class="hl_varref"><span class="mpre">i0</span></span></a><span class="mpre">)
   </span><a name="loc_122_4_122_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_4_122_11&#39;)"><span class="hl_fundecl"><span class="mpre">rebuild</span></span></a><span class="mpre"> </span><a name="loc_122_12_122_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_12_122_13&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> </span><a name="loc_122_14_122_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_14_122_15&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_216_1_216_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_1_216_13&#39;)"><span class="hl_varref"><span class="mpre">unsafeCreate</span></span></a><span class="mpre"> </span><a href="#loc_122_12_122_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_12_122_13&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_122_36_122_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_36_122_37&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_122_14_122_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_14_122_15&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> (</span><a href="#loc_122_36_122_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_36_122_37&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (</span><a href="#loc_119_40_119_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_40_119_43&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_119_22_119_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_22_119_24&#39;)"><span class="hl_varref"><span class="mpre">i0</span></span></a><span class="mpre">))
   </span><a name="loc_123_4_123_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_4_123_6&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> !</span><a name="loc_123_8_123_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_8_123_9&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> !</span><a name="loc_123_11_123_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_11_123_12&#39;)"><span class="hl_vardecl"><span class="mpre">j</span></span></a><span class="mpre">
     | </span><a href="#loc_123_8_123_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_8_123_9&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_95_1_95_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_1_95_6&#39;)"><span class="hl_varref"><span class="mpre">grain</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_123_11_123_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_11_123_12&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">k</span></span><span class="mpre"> &lt;- </span><a href="#loc_123_8_123_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_8_123_9&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_varref"><span class="mpre">shiftR</span></span></a><span class="mpre"> (</span><a href="#loc_123_11_123_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_11_123_12&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_123_8_123_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_8_123_9&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> = (\</span><a name="loc_124_53_124_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_53_124_54&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> </span><a name="loc_124_55_124_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_55_124_56&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> </span><a name="loc_124_57_124_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_57_124_58&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_124_53_124_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_53_124_54&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><a href="#loc_124_57_124_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_57_124_58&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_124_55_124_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_55_124_56&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><a href="#loc_124_57_124_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_57_124_58&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">) </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="#loc_123_4_123_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_4_123_6&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_123_8_123_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_8_123_9&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">k</span></span><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="#loc_123_4_123_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_4_123_6&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">k</span></span><span class="mpre"> </span><a href="#loc_123_11_123_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_11_123_12&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre">
     | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="#loc_126_4_126_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_4_126_7&#39;)"><span class="hl_varref"><span class="mpre">run</span></span></a><span class="mpre"> </span><a href="#loc_123_8_123_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_8_123_9&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="#loc_123_11_123_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_11_123_12&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre">
   </span><a name="loc_126_4_126_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_4_126_7&#39;)"><span class="hl_fundecl"><span class="mpre">run</span></span></a><span class="mpre"> !</span><a name="loc_126_9_126_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_9_126_10&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> !</span><a name="loc_126_12_126_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_12_126_13&#39;)"><span class="hl_vardecl"><span class="mpre">j</span></span></a><span class="mpre">
     | </span><a href="#loc_126_9_126_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_9_126_10&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_126_12_126_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_12_126_13&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre">    = </span><a href="Control.Applicative.html#loc_115_5_115_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_115_5_115_9&#39;)"><span class="hl_varref"><span class="mpre">pure</span></span></a><span class="mpre"> (\_ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)
     | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = let !</span><a name="loc_128_25_128_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_25_128_26&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">BI.inlinePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
                          </span><a name="loc_129_27_129_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_27_129_29&#39;)"><span class="hl_vardecl"><span class="mpre">x&#39;</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekByteOff</span></span><span class="mpre"> </span><a href="#loc_121_4_121_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_4_121_5&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_126_9_126_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_9_126_10&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
                          </span><span class="hl_varref"><span class="mpre">touchForeignPtr</span></span><span class="mpre"> </span><a href="#loc_119_37_119_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_37_119_39&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
                          </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_129_27_129_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_27_129_29&#39;)"><span class="hl_varref"><span class="mpre">x&#39;</span></span></a><span class="mpre">
                   in (\</span><a name="loc_132_25_132_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_25_132_26&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre"> </span><a name="loc_132_27_132_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_27_132_29&#39;)"><span class="hl_vardecl"><span class="mpre">ys</span></span></a><span class="mpre"> </span><a name="loc_132_30_132_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_30_132_31&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_132_30_132_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_30_132_31&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_126_9_126_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_9_126_10&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">) (</span><a href="#loc_175_1_175_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_1_175_4&#39;)"><span class="hl_varref"><span class="mpre">c2w</span></span></a><span class="mpre"> </span><a href="#loc_132_25_132_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_25_132_26&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_132_27_132_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_27_132_29&#39;)"><span class="hl_varref"><span class="mpre">ys</span></span></a><span class="mpre"> </span><a href="#loc_132_30_132_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_30_132_31&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">) </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">indexed</span></span><span class="mpre"> </span><a href="#loc_119_25_119_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_25_119_29&#39;)"><span class="hl_varref"><span class="mpre">pafb</span></span></a><span class="mpre"> (</span><a href="#loc_126_9_126_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_9_126_10&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">) (</span><a href="#loc_168_1_168_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_1_168_4&#39;)"><span class="hl_varref"><span class="mpre">w2c</span></span></a><span class="mpre"> </span><a href="#loc_128_25_128_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_25_128_26&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="#loc_126_4_126_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_4_126_7&#39;)"><span class="hl_varref"><span class="mpre">run</span></span></a><span class="mpre"> (</span><a href="#loc_126_9_126_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_9_126_10&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_126_12_126_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_12_126_13&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_119_1_119_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_21&#39;)"><span class="mpre">traversedStrictTree8</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Unpack a lazy &#39;Bytestring&#39;</span></span><span class="mpre">
</span><a href="#loc_137_1_137_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_11&#39;)"><span class="mpre">unpackLazy</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">BL.ByteString</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">]
</span><a name="loc_137_1_137_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_11&#39;)"><span class="hl_vardecl"><span class="mpre">unpackLazy</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">BL.unpack</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_137_1_137_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_11&#39;)"><span class="mpre">unpackLazy</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | An &#39;IndexedTraversal&#39; of the individual bytes in a lazy &#39;BL.ByteString&#39;</span></span><span class="mpre">
</span><a href="#loc_142_1_142_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_14&#39;)"><span class="mpre">traversedLazy</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IndexedTraversal&#39;</span></span><span class="mpre"> </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">BL.ByteString</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">
</span><a name="loc_142_1_142_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_14&#39;)"><span class="hl_fundecl"><span class="mpre">traversedLazy</span></span></a><span class="mpre"> </span><a name="loc_142_15_142_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_15_142_19&#39;)"><span class="hl_vardecl"><span class="mpre">pafb</span></span></a><span class="mpre"> = </span><a href="#loc_143_3_143_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_3_143_5&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> where
  </span><a name="loc_143_3_143_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_3_143_5&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> _ </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_19_82_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_19_82_24&#39;)"><span class="hl_conref"><span class="mpre">BLI.Empty</span></span></a><span class="mpre">        = </span><a href="Control.Applicative.html#loc_115_5_115_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_115_5_115_9&#39;)"><span class="hl_varref"><span class="mpre">pure</span></span></a><span class="mpre"> </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_19_82_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_19_82_24&#39;)"><span class="hl_conref"><span class="mpre">BLI.Empty</span></span></a><span class="mpre">
  </span><a href="#loc_143_3_143_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_3_143_5&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_144_6_144_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_6_144_7&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Lazy.Internal.html#loc_82_27_82_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_27_82_32&#39;)"><span class="hl_conref"><span class="mpre">BLI.Chunk</span></span></a><span class="mpre"> </span><a name="loc_144_19_144_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_19_144_20&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> </span><a name="loc_144_21_144_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_21_144_23&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">) = </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_27_82_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_27_82_32&#39;)"><span class="hl_conref"><span class="mpre">BLI.Chunk</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">reindexed</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre">) (</span><a href="#loc_101_1_101_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_20&#39;)"><span class="hl_varref"><span class="mpre">traversedStrictTree</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_144_6_144_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_6_144_7&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">)) </span><a href="#loc_142_15_142_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_15_142_19&#39;)"><span class="hl_varref"><span class="mpre">pafb</span></span></a><span class="mpre"> </span><a href="#loc_144_19_144_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_19_144_20&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="#loc_143_3_143_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_3_143_5&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_145_12_145_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_12_145_14&#39;)"><span class="hl_varref"><span class="mpre">i&#39;</span></span></a><span class="mpre"> </span><a href="#loc_144_21_144_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_21_144_23&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
    where !</span><a name="loc_145_12_145_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_12_145_14&#39;)"><span class="hl_vardecl"><span class="mpre">i&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_144_6_144_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_6_144_7&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_144_19_144_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_19_144_20&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_142_1_142_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_14&#39;)"><span class="mpre">traversedLazy</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | Unpack a lazy &#39;BL.ByteString&#39; pretending the bytes are chars.</span></span><span class="mpre">
</span><a href="#loc_151_1_151_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_1_151_12&#39;)"><span class="mpre">unpackLazy8</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">BL.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_151_1_151_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_1_151_12&#39;)"><span class="hl_vardecl"><span class="mpre">unpackLazy8</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">BL8.unpack</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_151_1_151_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_1_151_12&#39;)"><span class="mpre">unpackLazy8</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | An &#39;IndexedTraversal&#39; of the individual bytes in a lazy &#39;BL.ByteString&#39; pretending the bytes are chars.</span></span><span class="mpre">
</span><a href="#loc_156_1_156_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_1_156_15&#39;)"><span class="mpre">traversedLazy8</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IndexedTraversal&#39;</span></span><span class="mpre"> </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">BL.ByteString</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">
</span><a name="loc_156_1_156_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_1_156_15&#39;)"><span class="hl_fundecl"><span class="mpre">traversedLazy8</span></span></a><span class="mpre"> </span><a name="loc_156_16_156_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_16_156_20&#39;)"><span class="hl_vardecl"><span class="mpre">pafb</span></span></a><span class="mpre"> = </span><a href="#loc_157_3_157_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_3_157_5&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> where
  </span><a name="loc_157_3_157_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_3_157_5&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> _ </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_19_82_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_19_82_24&#39;)"><span class="hl_conref"><span class="mpre">BLI.Empty</span></span></a><span class="mpre"> = </span><a href="Control.Applicative.html#loc_115_5_115_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_115_5_115_9&#39;)"><span class="hl_varref"><span class="mpre">pure</span></span></a><span class="mpre"> </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_19_82_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_19_82_24&#39;)"><span class="hl_conref"><span class="mpre">BLI.Empty</span></span></a><span class="mpre">
  </span><a href="#loc_157_3_157_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_3_157_5&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_158_6_158_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_6_158_7&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Lazy.Internal.html#loc_82_27_82_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_27_82_32&#39;)"><span class="hl_conref"><span class="mpre">BLI.Chunk</span></span></a><span class="mpre"> </span><a name="loc_158_19_158_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_19_158_20&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> </span><a name="loc_158_21_158_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_21_158_23&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">) = </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_27_82_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_27_82_32&#39;)"><span class="hl_conref"><span class="mpre">BLI.Chunk</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">reindexed</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="GHC.Int.html#loc_551_30_551_35" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Int.html#loc_551_30_551_35&#39;)"><span class="hl_tyconref"><span class="mpre">Int64</span></span></a><span class="mpre">) (</span><a href="#loc_119_1_119_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_21&#39;)"><span class="hl_varref"><span class="mpre">traversedStrictTree8</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_158_6_158_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_6_158_7&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">)) </span><a href="#loc_156_16_156_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_16_156_20&#39;)"><span class="hl_varref"><span class="mpre">pafb</span></span></a><span class="mpre"> </span><a href="#loc_158_19_158_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_19_158_20&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="#loc_157_3_157_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_3_157_5&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_159_12_159_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_12_159_14&#39;)"><span class="hl_varref"><span class="mpre">i&#39;</span></span></a><span class="mpre"> </span><a href="#loc_158_21_158_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_21_158_23&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
    where !</span><a name="loc_159_12_159_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_12_159_14&#39;)"><span class="hl_vardecl"><span class="mpre">i&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_158_6_158_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_6_158_7&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_158_19_158_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_19_158_20&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_156_1_156_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_1_156_15&#39;)"><span class="mpre">traversedLazy8</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ByteString guts</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Conversion between &#39;Word8&#39; and &#39;Char&#39;. Should compile to a no-op.</span></span><span class="mpre">
</span><a href="#loc_168_1_168_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_1_168_4&#39;)"><span class="mpre">w2c</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">
</span><a name="loc_168_1_168_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_1_168_4&#39;)"><span class="hl_vardecl"><span class="mpre">w2c</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">unsafeChr</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_168_1_168_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_1_168_4&#39;)"><span class="mpre">w2c</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Unsafe conversion between &#39;Char&#39; and &#39;Word8&#39;. This is a no-op and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- silently truncates to 8 bits Chars &gt; &#39;\255&#39;. It is provided as</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- convenience for ByteString construction.</span></span><span class="mpre">
</span><a href="#loc_175_1_175_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_1_175_4&#39;)"><span class="mpre">c2w</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">
</span><a name="loc_175_1_175_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_1_175_4&#39;)"><span class="hl_vardecl"><span class="mpre">c2w</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">ord</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_175_1_175_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_1_175_4&#39;)"><span class="mpre">c2w</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- TODO: Should this create the list in chunks, like unpackBytes does in 0.10?</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Unpack a strict &#39;B.Bytestring&#39;</span></span><span class="mpre">
</span><a href="#loc_182_1_182_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_13&#39;)"><span class="mpre">unpackStrict</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">]
</span><a name="loc_182_1_182_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_13&#39;)"><span class="hl_fundecl"><span class="mpre">unpackStrict</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">BI.PS</span></span></a><span class="mpre"> </span><a name="loc_182_21_182_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_21_182_23&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a name="loc_182_24_182_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_24_182_27&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_182_28_182_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_28_182_31&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">) =
      let </span><a name="loc_183_11_183_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_11_183_12&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span><span class="mpre"> </span><a href="#loc_182_21_182_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_21_182_23&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
       in </span><a href="#loc_186_7_186_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_7_186_9&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><a href="#loc_183_11_183_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_11_183_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_182_24_182_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_24_182_27&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre">) (</span><a href="#loc_183_11_183_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_11_183_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (</span><a href="#loc_182_24_182_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_24_182_27&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_182_28_182_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_28_182_31&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">))
    where
      </span><a name="loc_186_7_186_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_7_186_9&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> !</span><a name="loc_186_11_186_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_11_186_12&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> !</span><a name="loc_186_14_186_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_14_186_15&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre"> | </span><a href="#loc_186_11_186_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_11_186_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_186_14_186_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_14_186_15&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">    = []
               | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = let !</span><a name="loc_187_35_187_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_35_187_36&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">BI.inlinePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
                                        </span><a name="loc_188_41_188_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_41_188_43&#39;)"><span class="hl_vardecl"><span class="mpre">x&#39;</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peek</span></span><span class="mpre"> </span><a href="#loc_186_11_186_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_11_186_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">
                                        </span><span class="hl_varref"><span class="mpre">touchForeignPtr</span></span><span class="mpre"> </span><a href="#loc_182_21_182_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_21_182_23&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
                                        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_188_41_188_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_41_188_43&#39;)"><span class="hl_varref"><span class="mpre">x&#39;</span></span></a><span class="mpre">
                             in </span><a href="#loc_187_35_187_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_35_187_36&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_186_7_186_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_7_186_9&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><a href="#loc_186_11_186_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_11_186_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_186_14_186_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_14_186_15&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_182_1_182_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_13&#39;)"><span class="mpre">unpackStrict</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- TODO: Should this create the list in chunks, like unpackBytes does in 0.10?</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Unpack a strict &#39;B.Bytestring&#39;, pretending the bytes are chars.</span></span><span class="mpre">
</span><a href="#loc_198_1_198_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_1_198_14&#39;)"><span class="mpre">unpackStrict8</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_198_1_198_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_1_198_14&#39;)"><span class="hl_fundecl"><span class="mpre">unpackStrict8</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">BI.PS</span></span></a><span class="mpre"> </span><a name="loc_198_22_198_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_22_198_24&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a name="loc_198_25_198_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_25_198_28&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_198_29_198_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_29_198_32&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">) =
      let </span><a name="loc_199_11_199_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_11_199_12&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span><span class="mpre"> </span><a href="#loc_198_22_198_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_22_198_24&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
       in </span><a href="#loc_202_7_202_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_7_202_9&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><a href="#loc_199_11_199_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_11_199_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_198_25_198_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_25_198_28&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre">) (</span><a href="#loc_199_11_199_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_11_199_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (</span><a href="#loc_198_25_198_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_25_198_28&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_198_29_198_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_29_198_32&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">))
    where
      </span><a name="loc_202_7_202_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_7_202_9&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> !</span><a name="loc_202_11_202_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_11_202_12&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> !</span><a name="loc_202_14_202_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_14_202_15&#39;)"><span class="hl_vardecl"><span class="mpre">q</span></span></a><span class="mpre"> | </span><a href="#loc_202_11_202_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_11_202_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_202_14_202_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_14_202_15&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">    = []
               | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = let !</span><a name="loc_203_35_203_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_35_203_36&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">BI.inlinePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
                                        </span><a name="loc_204_41_204_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_41_204_43&#39;)"><span class="hl_vardecl"><span class="mpre">x&#39;</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peek</span></span><span class="mpre"> </span><a href="#loc_202_11_202_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_11_202_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">
                                        </span><span class="hl_varref"><span class="mpre">touchForeignPtr</span></span><span class="mpre"> </span><a href="#loc_198_22_198_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_22_198_24&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
                                        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_204_41_204_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_41_204_43&#39;)"><span class="hl_varref"><span class="mpre">x&#39;</span></span></a><span class="mpre">
                             in </span><a href="#loc_168_1_168_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_1_168_4&#39;)"><span class="hl_varref"><span class="mpre">w2c</span></span></a><span class="mpre"> </span><a href="#loc_203_35_203_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_35_203_36&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_202_7_202_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_7_202_9&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><a href="#loc_202_11_202_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_11_202_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_202_14_202_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_14_202_15&#39;)"><span class="hl_varref"><span class="mpre">q</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_198_1_198_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_1_198_14&#39;)"><span class="mpre">unpackStrict8</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | A way of creating ByteStrings outside the IO monad. The @Int@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- argument gives the final size of the ByteString. Unlike</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;createAndTrim&#39; the ByteString is not reallocated if the final size</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is less than the estimated size.</span></span><span class="mpre">
</span><a href="#loc_216_1_216_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_1_216_13&#39;)"><span class="mpre">unsafeCreate</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_216_1_216_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_1_216_13&#39;)"><span class="hl_fundecl"><span class="mpre">unsafeCreate</span></span></a><span class="mpre"> </span><a name="loc_216_14_216_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_14_216_15&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> </span><a name="loc_216_16_216_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_16_216_17&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_182_1_182_23" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_182_1_182_23&#39;)"><span class="hl_varref"><span class="mpre">unsafeDupablePerformIO</span></span></a><span class="mpre"> (</span><a href="#loc_221_1_221_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_1_221_7&#39;)"><span class="hl_varref"><span class="mpre">create</span></span></a><span class="mpre"> </span><a href="#loc_216_14_216_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_14_216_15&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><a href="#loc_216_16_216_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_16_216_17&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_216_1_216_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_1_216_13&#39;)"><span class="mpre">unsafeCreate</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Create ByteString of size @l@ and use action @f@ to fill it&#39;s contents.</span></span><span class="mpre">
</span><a href="#loc_221_1_221_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_1_221_7&#39;)"><span class="mpre">create</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_221_1_221_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_1_221_7&#39;)"><span class="hl_fundecl"><span class="mpre">create</span></span></a><span class="mpre"> </span><a name="loc_221_8_221_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_8_221_9&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> </span><a name="loc_221_10_221_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_10_221_11&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = do
    </span><a name="loc_222_5_222_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_5_222_7&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.ForeignPtr.html#loc_227_1_227_27" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.ForeignPtr.html#loc_227_1_227_27&#39;)"><span class="hl_varref"><span class="mpre">mallocPlainForeignPtrBytes</span></span></a><span class="mpre"> </span><a href="#loc_221_8_221_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_8_221_9&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
    </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="hl_varref"><span class="mpre">withForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_222_5_222_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_5_222_7&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_223_26_223_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_26_223_27&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_221_10_221_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_10_221_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_223_26_223_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_26_223_27&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">BI.PS</span></span></a><span class="mpre"> </span><a href="#loc_222_5_222_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_5_222_7&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_221_8_221_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_8_221_9&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_221_1_221_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_1_221_7&#39;)"><span class="mpre">create</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span></div></body></html>