<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Crypto.PubKey.RSA.PSS</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : Good</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Crypto.PubKey.RSA.PSS
    ( PSSParams(..)
    , defaultPSSParams
    , defaultPSSParamsSHA1
    </span><span class="hl_comment"><span class="mpre">-- * Sign and verify functions</span></span><span class="mpre">
    , signWithSalt
    , sign
    , signSafer
    , verify
    ) where

import Crypto.Random
import Crypto.Types.PubKey.RSA
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA/PSS.hs&quot;, srcSpanStartLine = 21, srcSpanStartColumn = 8, srcSpanEndLine = 21, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import Data.Byteable
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA/PSS.hs&quot;, srcSpanStartLine = 23, srcSpanStartColumn = 18, srcSpanEndLine = 23, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import Crypto.PubKey.RSA.Prim
import Crypto.PubKey.RSA.Types
import Crypto.PubKey.RSA (</span><a href="Crypto.PubKey.RSA.html#loc_91_1_91_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.PubKey.RSA.html#loc_91_1_91_16&#39;)"><span class="mpre">generateBlinder</span></a><span class="mpre">)
import Crypto.PubKey.HashDescr
import Crypto.PubKey.MaskGenFunction
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA/PSS.hs&quot;, srcSpanStartLine = 29, srcSpanStartColumn = 8, srcSpanEndLine = 29, srcSpanEndColumn = 19}, srcInfoPoints = []}) &quot;Crypto.Hash&quot;"><span class="mpre">Crypto.Hash</span></span><span class="mpre">
import Data.Bits (</span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="mpre">xor</span></a><span class="mpre">, </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="mpre">shiftR</span></a><span class="mpre">, (.&amp;.))
import Data.Word

</span><span class="hl_comment"><span class="mpre">-- | Parameters for PSS signature/verification.</span></span><span class="mpre">
data </span><a name="loc_34_6_34_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_6_34_15&#39;)"><span class="hl_tycondecl"><span class="mpre">PSSParams</span></span></a><span class="mpre"> = </span><span class="hl_condecl"><span class="mpre">PSSParams</span></span><span class="mpre"> { </span><a name="loc_34_30_34_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_30_34_37&#39;)"><span class="hl_fielddecl"><span class="mpre">pssHash</span></span></a><span class="mpre">         :: </span><span class="hl_tyconref"><span class="mpre">HashFunction</span></span><span class="mpre">     </span><span class="hl_comment"><span class="mpre">-- ^ Hash function to use</span></span><span class="mpre">
                           , </span><a name="loc_35_30_35_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_30_35_43&#39;)"><span class="hl_fielddecl"><span class="mpre">pssMaskGenAlg</span></span></a><span class="mpre">   :: </span><span class="hl_tyconref"><span class="mpre">MaskGenAlgorithm</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ Mask Gen algorithm to use</span></span><span class="mpre">
                           , </span><a name="loc_36_30_36_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_30_36_43&#39;)"><span class="hl_fielddecl"><span class="mpre">pssSaltLength</span></span></a><span class="mpre">   :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">              </span><span class="hl_comment"><span class="mpre">-- ^ Length of salt. need to be &lt;= to hLen.</span></span><span class="mpre">
                           , </span><a name="loc_37_30_37_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_30_37_45&#39;)"><span class="hl_fielddecl"><span class="mpre">pssTrailerField</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">            </span><span class="hl_comment"><span class="mpre">-- ^ Trailer field, usually 0xbc</span></span><span class="mpre">
                           }

</span><span class="hl_comment"><span class="mpre">-- | Default Params with a specified hash function</span></span><span class="mpre">
</span><a href="#loc_42_1_42_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_17&#39;)"><span class="mpre">defaultPSSParams</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">HashFunction</span></span><span class="mpre"> -&gt; </span><a href="#loc_34_6_34_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_6_34_15&#39;)"><span class="hl_tyconref"><span class="mpre">PSSParams</span></span></a><span class="mpre">
</span><a name="loc_42_1_42_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_17&#39;)"><span class="hl_fundecl"><span class="mpre">defaultPSSParams</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">hashF</span></span><span class="mpre"> =
    </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA/PSS.hs&quot;, srcSpanStartLine = 43, srcSpanStartColumn = 5, srcSpanEndLine = 47, srcSpanEndColumn = 16}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA/PSS.hs&quot;, srcSpanStartLine = 43, srcSpanStartColumn = 15, srcSpanEndLine = 43, srcSpanEndColumn = 16},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/R"><span class="mpre">PSSParams { pssHash         = hashF
              , pssMaskGenAlg   = mgf1
              , pssSaltLength   = B.length $ hashF B.empty
              , pssTrailerField = 0xbc
              }</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Default Params using SHA1 algorithm.</span></span><span class="mpre">
</span><a href="#loc_51_1_51_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_21&#39;)"><span class="mpre">defaultPSSParamsSHA1</span></a><span class="mpre"> :: </span><a href="#loc_34_6_34_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_6_34_15&#39;)"><span class="hl_tyconref"><span class="mpre">PSSParams</span></span></a><span class="mpre">
</span><a name="loc_51_1_51_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_21&#39;)"><span class="hl_vardecl"><span class="mpre">defaultPSSParamsSHA1</span></span></a><span class="mpre"> = </span><a href="#loc_42_1_42_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_17&#39;)"><span class="hl_varref"><span class="mpre">defaultPSSParams</span></span></a><span class="mpre"> (</span><a href="Data.Byteable.html#loc_24_5_24_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Byteable.html#loc_24_5_24_12&#39;)"><span class="hl_varref"><span class="mpre">toBytes</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">hash</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Digest</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">SHA1</span></span><span class="mpre">))

</span><span class="hl_comment"><span class="mpre">-- | Sign using the PSS parameters and the salt explicitely passed as parameters.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the function ignore SaltLength from the PSS Parameters</span></span><span class="mpre">
</span><a href="#loc_62_1_62_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_13&#39;)"><span class="mpre">signWithSalt</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ Salt to use</span></span><span class="mpre">
             -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Crypto.PubKey.RSA.Types.html#loc_15_6_15_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.PubKey.RSA.Types.html#loc_15_6_15_13&#39;)"><span class="hl_tyconref"><span class="mpre">Blinder</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ optional blinder to use</span></span><span class="mpre">
             -&gt; </span><a href="#loc_34_6_34_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_6_34_15&#39;)"><span class="hl_tyconref"><span class="mpre">PSSParams</span></span></a><span class="mpre">     </span><span class="hl_comment"><span class="mpre">-- ^ PSS Parameters to use</span></span><span class="mpre">
             -&gt; </span><a href="Crypto.Types.PubKey.RSA.html#loc_60_6_60_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.RSA.html#loc_60_6_60_16&#39;)"><span class="hl_tyconref"><span class="mpre">PrivateKey</span></span></a><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ RSA Private Key</span></span><span class="mpre">
             -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ Message to sign</span></span><span class="mpre">
             -&gt; </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="Crypto.PubKey.RSA.Types.html#loc_19_6_19_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.PubKey.RSA.Types.html#loc_19_6_19_11&#39;)"><span class="hl_tyconref"><span class="mpre">Error</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_62_1_62_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_13&#39;)"><span class="hl_fundecl"><span class="mpre">signWithSalt</span></span></a><span class="mpre"> </span><a name="loc_62_14_62_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_14_62_18&#39;)"><span class="hl_vardecl"><span class="mpre">salt</span></span></a><span class="mpre"> </span><a name="loc_62_19_62_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_19_62_26&#39;)"><span class="hl_vardecl"><span class="mpre">blinder</span></span></a><span class="mpre"> </span><a name="loc_62_27_62_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_27_62_33&#39;)"><span class="hl_vardecl"><span class="mpre">params</span></span></a><span class="mpre"> </span><a name="loc_62_34_62_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_34_62_36&#39;)"><span class="hl_vardecl"><span class="mpre">pk</span></span></a><span class="mpre"> </span><a name="loc_62_37_62_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_37_62_38&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">
    | </span><a href="#loc_66_11_66_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_11_66_12&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_69_11_69_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_11_69_18&#39;)"><span class="hl_varref"><span class="mpre">hashLen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_68_11_68_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_11_68_18&#39;)"><span class="hl_varref"><span class="mpre">saltLen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="Crypto.PubKey.RSA.Types.html#loc_24_7_24_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.PubKey.RSA.Types.html#loc_24_7_24_24&#39;)"><span class="hl_conref"><span class="mpre">InvalidParameters</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">                 = </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Crypto.PubKey.RSA.Prim.html#loc_51_1_51_3" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.PubKey.RSA.Prim.html#loc_51_1_51_3&#39;)"><span class="hl_varref"><span class="mpre">dp</span></span></a><span class="mpre"> </span><a href="#loc_62_19_62_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_19_62_26&#39;)"><span class="hl_varref"><span class="mpre">blinder</span></span></a><span class="mpre"> </span><a href="#loc_62_34_62_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_34_62_36&#39;)"><span class="hl_varref"><span class="mpre">pk</span></span></a><span class="mpre"> </span><a href="#loc_78_11_78_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_11_78_13&#39;)"><span class="hl_varref"><span class="mpre">em</span></span></a><span class="mpre">
    where </span><a name="loc_65_11_65_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_11_65_16&#39;)"><span class="hl_vardecl"><span class="mpre">mHash</span></span></a><span class="mpre">    = (</span><a href="#loc_34_30_34_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_30_34_37&#39;)"><span class="hl_varref"><span class="mpre">pssHash</span></span></a><span class="mpre"> </span><a href="#loc_62_27_62_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_27_62_33&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre">) </span><a href="#loc_62_37_62_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_37_62_38&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
          </span><a name="loc_66_11_66_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_11_66_12&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre">        = </span><a href="Crypto.Types.PubKey.RSA.html#loc_71_1_71_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.RSA.html#loc_71_1_71_13&#39;)"><span class="hl_varref"><span class="mpre">private_size</span></span></a><span class="mpre"> </span><a href="#loc_62_34_62_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_34_62_36&#39;)"><span class="hl_varref"><span class="mpre">pk</span></span></a><span class="mpre">
          </span><a name="loc_67_11_67_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_11_67_16&#39;)"><span class="hl_vardecl"><span class="mpre">dbLen</span></span></a><span class="mpre">    = </span><a href="#loc_66_11_66_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_11_66_12&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_69_11_69_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_11_69_18&#39;)"><span class="hl_varref"><span class="mpre">hashLen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
          </span><a name="loc_68_11_68_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_11_68_18&#39;)"><span class="hl_vardecl"><span class="mpre">saltLen</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_62_14_62_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_14_62_18&#39;)"><span class="hl_varref"><span class="mpre">salt</span></span></a><span class="mpre">
          </span><a name="loc_69_11_69_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_11_69_18&#39;)"><span class="hl_vardecl"><span class="mpre">hashLen</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> (</span><a href="#loc_70_11_70_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_11_70_16&#39;)"><span class="hl_varref"><span class="mpre">hashF</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">)
          </span><a name="loc_70_11_70_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_11_70_16&#39;)"><span class="hl_vardecl"><span class="mpre">hashF</span></span></a><span class="mpre">    = </span><a href="#loc_34_30_34_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_30_34_37&#39;)"><span class="hl_varref"><span class="mpre">pssHash</span></span></a><span class="mpre"> </span><a href="#loc_62_27_62_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_27_62_33&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre">
          </span><a name="loc_71_11_71_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_18&#39;)"><span class="hl_vardecl"><span class="mpre">pubBits</span></span></a><span class="mpre">  = </span><a href="Crypto.Types.PubKey.RSA.html#loc_71_1_71_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.RSA.html#loc_71_1_71_13&#39;)"><span class="hl_varref"><span class="mpre">private_size</span></span></a><span class="mpre"> </span><a href="#loc_62_34_62_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_34_62_36&#39;)"><span class="hl_varref"><span class="mpre">pk</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- to change if public_size is converted in bytes</span></span><span class="mpre">

          </span><a name="loc_73_11_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_11_73_13&#39;)"><span class="hl_vardecl"><span class="mpre">m&#39;</span></span></a><span class="mpre">       = </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> [</span><span class="hl_varref"><span class="mpre">B.replicate</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">,</span><a href="#loc_65_11_65_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_11_65_16&#39;)"><span class="hl_varref"><span class="mpre">mHash</span></span></a><span class="mpre">,</span><a href="#loc_62_14_62_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_14_62_18&#39;)"><span class="hl_varref"><span class="mpre">salt</span></span></a><span class="mpre">]
          </span><a name="loc_74_11_74_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_11_74_12&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre">        = </span><a href="#loc_70_11_70_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_11_70_16&#39;)"><span class="hl_varref"><span class="mpre">hashF</span></span></a><span class="mpre"> </span><a href="#loc_73_11_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_11_73_13&#39;)"><span class="hl_varref"><span class="mpre">m&#39;</span></span></a><span class="mpre">
          </span><a name="loc_75_11_75_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_11_75_13&#39;)"><span class="hl_vardecl"><span class="mpre">db</span></span></a><span class="mpre">       = </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> [</span><span class="hl_varref"><span class="mpre">B.replicate</span></span><span class="mpre"> (</span><a href="#loc_67_11_67_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_11_67_16&#39;)"><span class="hl_varref"><span class="mpre">dbLen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_68_11_68_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_11_68_18&#39;)"><span class="hl_varref"><span class="mpre">saltLen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">,</span><span class="hl_varref"><span class="mpre">B.singleton</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">,</span><a href="#loc_62_14_62_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_14_62_18&#39;)"><span class="hl_varref"><span class="mpre">salt</span></span></a><span class="mpre">]
          </span><a name="loc_76_11_76_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_11_76_17&#39;)"><span class="hl_vardecl"><span class="mpre">dbmask</span></span></a><span class="mpre">   = (</span><a href="#loc_35_30_35_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_30_35_43&#39;)"><span class="hl_varref"><span class="mpre">pssMaskGenAlg</span></span></a><span class="mpre"> </span><a href="#loc_62_27_62_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_27_62_33&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre">) </span><a href="#loc_70_11_70_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_11_70_16&#39;)"><span class="hl_varref"><span class="mpre">hashF</span></span></a><span class="mpre"> </span><a href="#loc_74_11_74_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_11_74_12&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_67_11_67_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_11_67_16&#39;)"><span class="hl_varref"><span class="mpre">dbLen</span></span></a><span class="mpre">
          </span><a name="loc_77_11_77_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_11_77_19&#39;)"><span class="hl_vardecl"><span class="mpre">maskedDB</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.pack</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_132_1_132_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_19&#39;)"><span class="hl_varref"><span class="mpre">normalizeToKeySize</span></span></a><span class="mpre"> </span><a href="#loc_71_11_71_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_18&#39;)"><span class="hl_varref"><span class="mpre">pubBits</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.zipWith</span></span><span class="mpre"> </span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="hl_varref"><span class="mpre">xor</span></span></a><span class="mpre"> </span><a href="#loc_75_11_75_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_11_75_13&#39;)"><span class="hl_varref"><span class="mpre">db</span></span></a><span class="mpre"> </span><a href="#loc_76_11_76_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_11_76_17&#39;)"><span class="hl_varref"><span class="mpre">dbmask</span></span></a><span class="mpre">
          </span><a name="loc_78_11_78_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_11_78_13&#39;)"><span class="hl_vardecl"><span class="mpre">em</span></span></a><span class="mpre">       = </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> [</span><a href="#loc_77_11_77_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_11_77_19&#39;)"><span class="hl_varref"><span class="mpre">maskedDB</span></span></a><span class="mpre">, </span><a href="#loc_74_11_74_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_11_74_12&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">B.singleton</span></span><span class="mpre"> (</span><a href="#loc_37_30_37_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_30_37_45&#39;)"><span class="hl_varref"><span class="mpre">pssTrailerField</span></span></a><span class="mpre"> </span><a href="#loc_62_27_62_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_27_62_33&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre">)]

</span><span class="hl_comment"><span class="mpre">-- | Sign using the PSS Parameters</span></span><span class="mpre">
</span><a href="#loc_88_1_88_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_5&#39;)"><span class="mpre">sign</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA/PSS.hs&quot;, srcSpanStartLine = 81, srcSpanStartColumn = 9, srcSpanEndLine = 82, srcSpanEndColumn = 8}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA/PSS.hs&quot;, srcSpanStartLine = 82, srcSpanStartColumn = 6, srcSpanEndLine = 82, srcSpanEndColumn = 8}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/"><span class="mpre">CPRG g
     =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">               </span><span class="hl_comment"><span class="mpre">-- ^ random generator to use to generate the salt</span></span><span class="mpre">
     -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Crypto.PubKey.RSA.Types.html#loc_15_6_15_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.PubKey.RSA.Types.html#loc_15_6_15_13&#39;)"><span class="hl_tyconref"><span class="mpre">Blinder</span></span></a><span class="mpre">   </span><span class="hl_comment"><span class="mpre">-- ^ optional blinder to use</span></span><span class="mpre">
     -&gt; </span><a href="#loc_34_6_34_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_6_34_15&#39;)"><span class="hl_tyconref"><span class="mpre">PSSParams</span></span></a><span class="mpre">       </span><span class="hl_comment"><span class="mpre">-- ^ PSS Parameters to use</span></span><span class="mpre">
     -&gt; </span><a href="Crypto.Types.PubKey.RSA.html#loc_60_6_60_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.RSA.html#loc_60_6_60_16&#39;)"><span class="hl_tyconref"><span class="mpre">PrivateKey</span></span></a><span class="mpre">      </span><span class="hl_comment"><span class="mpre">-- ^ RSA Private Key</span></span><span class="mpre">
     -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">      </span><span class="hl_comment"><span class="mpre">-- ^ Message to sign</span></span><span class="mpre">
     -&gt; (</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="Crypto.PubKey.RSA.Types.html#loc_19_6_19_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.PubKey.RSA.Types.html#loc_19_6_19_11&#39;)"><span class="hl_tyconref"><span class="mpre">Error</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">, </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">)
</span><a name="loc_88_1_88_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_5&#39;)"><span class="hl_fundecl"><span class="mpre">sign</span></span></a><span class="mpre"> </span><a name="loc_88_6_88_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_6_88_9&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a name="loc_88_10_88_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_10_88_17&#39;)"><span class="hl_vardecl"><span class="mpre">blinder</span></span></a><span class="mpre"> </span><a name="loc_88_18_88_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_18_88_24&#39;)"><span class="hl_vardecl"><span class="mpre">params</span></span></a><span class="mpre"> </span><a name="loc_88_25_88_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_25_88_27&#39;)"><span class="hl_vardecl"><span class="mpre">pk</span></span></a><span class="mpre"> </span><a name="loc_88_28_88_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_28_88_29&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = (</span><a href="#loc_62_1_62_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_13&#39;)"><span class="hl_varref"><span class="mpre">signWithSalt</span></span></a><span class="mpre"> </span><a href="#loc_89_12_89_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_12_89_16&#39;)"><span class="hl_varref"><span class="mpre">salt</span></span></a><span class="mpre"> </span><a href="#loc_88_10_88_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_10_88_17&#39;)"><span class="hl_varref"><span class="mpre">blinder</span></span></a><span class="mpre"> </span><a href="#loc_88_18_88_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_18_88_24&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre"> </span><a href="#loc_88_25_88_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_25_88_27&#39;)"><span class="hl_varref"><span class="mpre">pk</span></span></a><span class="mpre"> </span><a href="#loc_88_28_88_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_28_88_29&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">, </span><a href="#loc_89_17_89_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_17_89_21&#39;)"><span class="hl_varref"><span class="mpre">rng&#39;</span></span></a><span class="mpre">)
    where (</span><a name="loc_89_12_89_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_12_89_16&#39;)"><span class="hl_vardecl"><span class="mpre">salt</span></span></a><span class="mpre">,</span><a name="loc_89_17_89_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_17_89_21&#39;)"><span class="hl_vardecl"><span class="mpre">rng&#39;</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">cprgGenerate</span></span><span class="mpre"> (</span><a href="#loc_36_30_36_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_30_36_43&#39;)"><span class="hl_varref"><span class="mpre">pssSaltLength</span></span></a><span class="mpre"> </span><a href="#loc_88_18_88_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_18_88_24&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre">) </span><a href="#loc_88_6_88_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_6_88_9&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Sign using the PSS Parameters and an automatically generated blinder.</span></span><span class="mpre">
</span><a href="#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_10&#39;)"><span class="mpre">signSafer</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA/PSS.hs&quot;, srcSpanStartLine = 92, srcSpanStartColumn = 14, srcSpanEndLine = 93, srcSpanEndColumn = 13}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/RSA/PSS.hs&quot;, srcSpanStartLine = 93, srcSpanStartColumn = 11, srcSpanEndLine = 93, srcSpanEndColumn = 13}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/p"><span class="mpre">CPRG g
          =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">          </span><span class="hl_comment"><span class="mpre">-- ^ random generator</span></span><span class="mpre">
          -&gt; </span><a href="#loc_34_6_34_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_6_34_15&#39;)"><span class="hl_tyconref"><span class="mpre">PSSParams</span></span></a><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^ PSS Parameters to use</span></span><span class="mpre">
          -&gt; </span><a href="Crypto.Types.PubKey.RSA.html#loc_60_6_60_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.RSA.html#loc_60_6_60_16&#39;)"><span class="hl_tyconref"><span class="mpre">PrivateKey</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ private key</span></span><span class="mpre">
          -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ message to sign</span></span><span class="mpre">
          -&gt; (</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="Crypto.PubKey.RSA.Types.html#loc_19_6_19_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.PubKey.RSA.Types.html#loc_19_6_19_11&#39;)"><span class="hl_tyconref"><span class="mpre">Error</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">, </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">)
</span><a name="loc_98_1_98_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_10&#39;)"><span class="hl_fundecl"><span class="mpre">signSafer</span></span></a><span class="mpre"> </span><a name="loc_98_11_98_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_11_98_14&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a name="loc_98_15_98_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_15_98_21&#39;)"><span class="hl_vardecl"><span class="mpre">params</span></span></a><span class="mpre"> </span><a name="loc_98_22_98_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_22_98_24&#39;)"><span class="hl_vardecl"><span class="mpre">pk</span></span></a><span class="mpre"> </span><a name="loc_98_25_98_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_25_98_26&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><a href="#loc_88_1_88_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_5&#39;)"><span class="hl_varref"><span class="mpre">sign</span></span></a><span class="mpre"> </span><a href="#loc_99_21_99_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_21_99_25&#39;)"><span class="hl_varref"><span class="mpre">rng&#39;</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_99_12_99_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_12_99_19&#39;)"><span class="hl_varref"><span class="mpre">blinder</span></span></a><span class="mpre">) </span><a href="#loc_98_15_98_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_15_98_21&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre"> </span><a href="#loc_98_22_98_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_22_98_24&#39;)"><span class="hl_varref"><span class="mpre">pk</span></span></a><span class="mpre"> </span><a href="#loc_98_25_98_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_25_98_26&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
    where (</span><a name="loc_99_12_99_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_12_99_19&#39;)"><span class="hl_vardecl"><span class="mpre">blinder</span></span></a><span class="mpre">, </span><a name="loc_99_21_99_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_21_99_25&#39;)"><span class="hl_vardecl"><span class="mpre">rng&#39;</span></span></a><span class="mpre">) = </span><a href="Crypto.PubKey.RSA.html#loc_91_1_91_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.PubKey.RSA.html#loc_91_1_91_16&#39;)"><span class="hl_varref"><span class="mpre">generateBlinder</span></span></a><span class="mpre"> </span><a href="#loc_98_11_98_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_11_98_14&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre"> (</span><a href="Crypto.Types.PubKey.RSA.html#loc_74_1_74_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.RSA.html#loc_74_1_74_10&#39;)"><span class="hl_varref"><span class="mpre">private_n</span></span></a><span class="mpre"> </span><a href="#loc_98_22_98_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_22_98_24&#39;)"><span class="hl_varref"><span class="mpre">pk</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Verify a signature using the PSS Parameters</span></span><span class="mpre">
</span><a href="#loc_108_1_108_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_7&#39;)"><span class="mpre">verify</span></a><span class="mpre"> :: </span><a href="#loc_34_6_34_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_6_34_15&#39;)"><span class="hl_tyconref"><span class="mpre">PSSParams</span></span></a><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^ PSS Parameters to use to verify,</span></span><span class="mpre">
                     </span><span class="hl_comment"><span class="mpre">--   this need to be identical to the parameters when signing</span></span><span class="mpre">
       -&gt; </span><a href="Crypto.Types.PubKey.RSA.html#loc_25_6_25_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.RSA.html#loc_25_6_25_15&#39;)"><span class="hl_tyconref"><span class="mpre">PublicKey</span></span></a><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^ RSA Public Key</span></span><span class="mpre">
       -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ Message to verify</span></span><span class="mpre">
       -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ Signature</span></span><span class="mpre">
       -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_108_1_108_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_7&#39;)"><span class="hl_fundecl"><span class="mpre">verify</span></span></a><span class="mpre"> </span><a name="loc_108_8_108_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_8_108_14&#39;)"><span class="hl_vardecl"><span class="mpre">params</span></span></a><span class="mpre"> </span><a name="loc_108_15_108_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_15_108_17&#39;)"><span class="hl_vardecl"><span class="mpre">pk</span></span></a><span class="mpre"> </span><a name="loc_108_18_108_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_18_108_19&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><a name="loc_108_20_108_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_20_108_21&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">
    | </span><a href="Crypto.Types.PubKey.RSA.html#loc_26_7_26_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.RSA.html#loc_26_7_26_18&#39;)"><span class="hl_varref"><span class="mpre">public_size</span></span></a><span class="mpre"> </span><a href="#loc_108_15_108_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_15_108_17&#39;)"><span class="hl_varref"><span class="mpre">pk</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_108_20_108_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_20_108_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">        = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">B.last</span></span><span class="mpre"> </span><a href="#loc_120_15_120_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_15_120_17&#39;)"><span class="hl_varref"><span class="mpre">em</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="#loc_37_30_37_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_30_37_45&#39;)"><span class="hl_varref"><span class="mpre">pssTrailerField</span></span></a><span class="mpre"> </span><a href="#loc_108_8_108_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_8_108_14&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.all</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">) </span><a href="#loc_125_16_125_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_16_125_19&#39;)"><span class="hl_varref"><span class="mpre">ps0</span></span></a><span class="mpre">)              = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
    | </span><a href="#loc_126_16_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_16_126_18&#39;)"><span class="hl_varref"><span class="mpre">b1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.singleton</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">                 = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">                           = </span><a href="#loc_122_15_122_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_15_122_16&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_129_15_129_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_15_129_17&#39;)"><span class="hl_varref"><span class="mpre">h&#39;</span></span></a><span class="mpre">
        where </span><span class="hl_comment"><span class="mpre">-- parameters</span></span><span class="mpre">
              </span><a name="loc_115_15_115_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_15_115_20&#39;)"><span class="hl_vardecl"><span class="mpre">hashF</span></span></a><span class="mpre">     = </span><a href="#loc_34_30_34_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_30_34_37&#39;)"><span class="hl_varref"><span class="mpre">pssHash</span></span></a><span class="mpre"> </span><a href="#loc_108_8_108_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_8_108_14&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre">
              </span><a name="loc_116_15_116_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_15_116_22&#39;)"><span class="hl_vardecl"><span class="mpre">hashLen</span></span></a><span class="mpre">   = </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> (</span><a href="#loc_115_15_115_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_15_115_20&#39;)"><span class="hl_varref"><span class="mpre">hashF</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">)
              </span><a name="loc_117_15_117_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_15_117_20&#39;)"><span class="hl_vardecl"><span class="mpre">dbLen</span></span></a><span class="mpre">     = </span><a href="Crypto.Types.PubKey.RSA.html#loc_26_7_26_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.RSA.html#loc_26_7_26_18&#39;)"><span class="hl_varref"><span class="mpre">public_size</span></span></a><span class="mpre"> </span><a href="#loc_108_15_108_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_15_108_17&#39;)"><span class="hl_varref"><span class="mpre">pk</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_116_15_116_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_15_116_22&#39;)"><span class="hl_varref"><span class="mpre">hashLen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
              </span><a name="loc_118_15_118_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_15_118_22&#39;)"><span class="hl_vardecl"><span class="mpre">pubBits</span></span></a><span class="mpre">   = </span><a href="Crypto.Types.PubKey.RSA.html#loc_26_7_26_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.RSA.html#loc_26_7_26_18&#39;)"><span class="hl_varref"><span class="mpre">public_size</span></span></a><span class="mpre"> </span><a href="#loc_108_15_108_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_15_108_17&#39;)"><span class="hl_varref"><span class="mpre">pk</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- to change if public_size is converted in bytes</span></span><span class="mpre">
              </span><span class="hl_comment"><span class="mpre">-- unmarshall fields</span></span><span class="mpre">
              </span><a name="loc_120_15_120_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_15_120_17&#39;)"><span class="hl_vardecl"><span class="mpre">em</span></span></a><span class="mpre">        = </span><a href="Crypto.PubKey.RSA.Prim.html#loc_57_1_57_3" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.PubKey.RSA.Prim.html#loc_57_1_57_3&#39;)"><span class="hl_varref"><span class="mpre">ep</span></span></a><span class="mpre"> </span><a href="#loc_108_15_108_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_15_108_17&#39;)"><span class="hl_varref"><span class="mpre">pk</span></span></a><span class="mpre"> </span><a href="#loc_108_20_108_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_20_108_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
              </span><a name="loc_121_15_121_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_15_121_23&#39;)"><span class="hl_vardecl"><span class="mpre">maskedDB</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">B.take</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_120_15_120_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_15_120_17&#39;)"><span class="hl_varref"><span class="mpre">em</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_116_15_116_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_15_116_22&#39;)"><span class="hl_varref"><span class="mpre">hashLen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_120_15_120_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_15_120_17&#39;)"><span class="hl_varref"><span class="mpre">em</span></span></a><span class="mpre">
              </span><a name="loc_122_15_122_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_15_122_16&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre">         = </span><span class="hl_varref"><span class="mpre">B.take</span></span><span class="mpre"> </span><a href="#loc_116_15_116_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_15_116_22&#39;)"><span class="hl_varref"><span class="mpre">hashLen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.drop</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_121_15_121_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_15_121_23&#39;)"><span class="hl_varref"><span class="mpre">maskedDB</span></span></a><span class="mpre">) </span><a href="#loc_120_15_120_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_15_120_17&#39;)"><span class="hl_varref"><span class="mpre">em</span></span></a><span class="mpre">
              </span><a name="loc_123_15_123_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_15_123_21&#39;)"><span class="hl_vardecl"><span class="mpre">dbmask</span></span></a><span class="mpre">    = (</span><a href="#loc_35_30_35_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_30_35_43&#39;)"><span class="hl_varref"><span class="mpre">pssMaskGenAlg</span></span></a><span class="mpre"> </span><a href="#loc_108_8_108_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_8_108_14&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre">) </span><a href="#loc_115_15_115_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_15_115_20&#39;)"><span class="hl_varref"><span class="mpre">hashF</span></span></a><span class="mpre"> </span><a href="#loc_122_15_122_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_15_122_16&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_117_15_117_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_15_117_20&#39;)"><span class="hl_varref"><span class="mpre">dbLen</span></span></a><span class="mpre">
              </span><a name="loc_124_15_124_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_15_124_17&#39;)"><span class="hl_vardecl"><span class="mpre">db</span></span></a><span class="mpre">        = </span><span class="hl_varref"><span class="mpre">B.pack</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_132_1_132_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_19&#39;)"><span class="hl_varref"><span class="mpre">normalizeToKeySize</span></span></a><span class="mpre"> </span><a href="#loc_118_15_118_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_15_118_22&#39;)"><span class="hl_varref"><span class="mpre">pubBits</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.zipWith</span></span><span class="mpre"> </span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="hl_varref"><span class="mpre">xor</span></span></a><span class="mpre"> </span><a href="#loc_121_15_121_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_15_121_23&#39;)"><span class="hl_varref"><span class="mpre">maskedDB</span></span></a><span class="mpre"> </span><a href="#loc_123_15_123_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_15_123_21&#39;)"><span class="hl_varref"><span class="mpre">dbmask</span></span></a><span class="mpre">
              (</span><a name="loc_125_16_125_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_16_125_19&#39;)"><span class="hl_vardecl"><span class="mpre">ps0</span></span></a><span class="mpre">,</span><a name="loc_125_20_125_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_20_125_21&#39;)"><span class="hl_vardecl"><span class="mpre">z</span></span></a><span class="mpre">)   = </span><span class="hl_varref"><span class="mpre">B.break</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_124_15_124_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_15_124_17&#39;)"><span class="hl_varref"><span class="mpre">db</span></span></a><span class="mpre">
              (</span><a name="loc_126_16_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_16_126_18&#39;)"><span class="hl_vardecl"><span class="mpre">b1</span></span></a><span class="mpre">,</span><a name="loc_126_19_126_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_19_126_23&#39;)"><span class="hl_vardecl"><span class="mpre">salt</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">B.splitAt</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><a href="#loc_125_20_125_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_20_125_21&#39;)"><span class="hl_varref"><span class="mpre">z</span></span></a><span class="mpre">
              </span><a name="loc_127_15_127_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_15_127_20&#39;)"><span class="hl_vardecl"><span class="mpre">mHash</span></span></a><span class="mpre">     = </span><a href="#loc_115_15_115_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_15_115_20&#39;)"><span class="hl_varref"><span class="mpre">hashF</span></span></a><span class="mpre"> </span><a href="#loc_108_18_108_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_18_108_19&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
              </span><a name="loc_128_15_128_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_15_128_17&#39;)"><span class="hl_vardecl"><span class="mpre">m&#39;</span></span></a><span class="mpre">        = </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> [</span><span class="hl_varref"><span class="mpre">B.replicate</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">,</span><a href="#loc_127_15_127_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_15_127_20&#39;)"><span class="hl_varref"><span class="mpre">mHash</span></span></a><span class="mpre">,</span><a href="#loc_126_19_126_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_19_126_23&#39;)"><span class="hl_varref"><span class="mpre">salt</span></span></a><span class="mpre">]
              </span><a name="loc_129_15_129_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_15_129_17&#39;)"><span class="hl_vardecl"><span class="mpre">h&#39;</span></span></a><span class="mpre">        = </span><a href="#loc_115_15_115_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_15_115_20&#39;)"><span class="hl_varref"><span class="mpre">hashF</span></span></a><span class="mpre"> </span><a href="#loc_128_15_128_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_15_128_17&#39;)"><span class="hl_varref"><span class="mpre">m&#39;</span></span></a><span class="mpre">

</span><a href="#loc_132_1_132_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_19&#39;)"><span class="mpre">normalizeToKeySize</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">] -&gt; [</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">]
</span><a name="loc_132_1_132_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_19&#39;)"><span class="hl_fundecl"><span class="mpre">normalizeToKeySize</span></span></a><span class="mpre"> _    []     = [] </span><span class="hl_comment"><span class="mpre">-- very unlikely</span></span><span class="mpre">
</span><a href="#loc_132_1_132_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_19&#39;)"><span class="hl_fundecl"><span class="mpre">normalizeToKeySize</span></span></a><span class="mpre"> </span><a name="loc_133_20_133_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_20_133_24&#39;)"><span class="hl_vardecl"><span class="mpre">bits</span></span></a><span class="mpre"> (</span><a name="loc_133_26_133_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_26_133_27&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_133_28_133_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_28_133_30&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre">) = </span><a href="#loc_133_26_133_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_26_133_27&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><a href="#loc_134_11_134_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_11_134_15&#39;)"><span class="hl_varref"><span class="mpre">mask</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_133_28_133_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_28_133_30&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">
    where </span><a name="loc_134_11_134_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_11_134_15&#39;)"><span class="hl_vardecl"><span class="mpre">mask</span></span></a><span class="mpre"> = if </span><a href="#loc_135_11_135_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_11_135_13&#39;)"><span class="hl_varref"><span class="mpre">sh</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> then </span><span class="hl_num"><span class="mpre">0xff</span></span><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> (</span><span class="hl_num"><span class="mpre">8</span></span><span class="hl_infix"><span class="mpre">-</span></span><a href="#loc_135_11_135_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_11_135_13&#39;)"><span class="hl_varref"><span class="mpre">sh</span></span></a><span class="mpre">) else </span><span class="hl_num"><span class="mpre">0xff</span></span><span class="mpre">
          </span><a name="loc_135_11_135_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_11_135_13&#39;)"><span class="hl_vardecl"><span class="mpre">sh</span></span></a><span class="mpre">   = ((</span><a href="#loc_133_20_133_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_20_133_24&#39;)"><span class="hl_varref"><span class="mpre">bits</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x7</span></span><span class="mpre">)
</span></div></body></html>