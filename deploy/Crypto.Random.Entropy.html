<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Crypto.Random.Entropy</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : Good</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
{-# LANGUAGE CPP #-}
{-# LANGUAGE ExistentialQuantification #-}
module Crypto.Random.Entropy
    ( EntropyPool
    , createEntropyPool
    , createTestEntropyPool
    , grabEntropyPtr
    , grabEntropy
    , grabEntropyIO
    ) where

import Control.Monad (</span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">)
import Control.Concurrent.MVar
import System.IO.Unsafe (</span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="mpre">unsafePerformIO</span></a><span class="mpre">)
import Data.Maybe (</span><a href="Data.Maybe.html#loc_115_1_115_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_115_1_115_10&#39;)"><span class="mpre">catMaybes</span></a><span class="mpre">)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy.hs&quot;, srcSpanStartLine = 23, srcSpanStartColumn = 8, srcSpanEndLine = 23, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Data.SecureMem&quot;"><span class="mpre">Data.SecureMem</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 8, srcSpanEndLine = 24, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy.hs&quot;, srcSpanStartLine = 25, srcSpanStartColumn = 18, srcSpanEndLine = 25, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import qualified Data.ByteString.Internal as B
import Data.Word (Word8)
import Foreign.Marshal.Utils (</span><a href="Foreign.Marshal.Utils.html#loc_154_1_154_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Utils.html#loc_154_1_154_10&#39;)"><span class="mpre">copyBytes</span></a><span class="mpre">)
import Foreign.Ptr (plusPtr, Ptr)
import Foreign.ForeignPtr (</span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="mpre">withForeignPtr</span></a><span class="mpre">)

import Crypto.Random.Entropy.Source
#ifdef SUPPORT_RDRAND
import Crypto.Random.Entropy.RDRand
#endif
#ifdef WINDOWS
import Crypto.Random.Entropy.Windows
#else
import Crypto.Random.Entropy.Unix
#endif

</span><a href="#loc_43_1_43_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_18&#39;)"><span class="mpre">supportedBackends</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="#loc_55_6_55_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_20&#39;)"><span class="hl_tyconref"><span class="mpre">EntropyBackend</span></span></a><span class="mpre">)]
</span><a name="loc_43_1_43_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_18&#39;)"><span class="hl_vardecl"><span class="mpre">supportedBackends</span></span></a><span class="mpre"> =
    [
#ifdef SUPPORT_RDRAND
    </span><a href="#loc_73_1_73_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_12&#39;)"><span class="hl_varref"><span class="mpre">openBackend</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> :: </span><a href="Crypto.Random.Entropy.RDRand.html#loc_25_6_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.RDRand.html#loc_25_6_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">RDRand</span></span></a><span class="mpre">),
#endif
#ifdef WINDOWS
    </span><a href="#loc_73_1_73_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_12&#39;)"><span class="hl_varref"><span class="mpre">openBackend</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> :: </span><a href="Crypto.Random.Entropy.Windows.html#loc_37_6_37_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Windows.html#loc_37_6_37_18&#39;)"><span class="hl_tyconref"><span class="mpre">WinCryptoAPI</span></span></a><span class="mpre">)
#else
    </span><a href="#loc_73_1_73_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_12&#39;)"><span class="hl_varref"><span class="mpre">openBackend</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> :: </span><a href="Crypto.Random.Entropy.Unix.html#loc_26_9_26_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Unix.html#loc_26_9_26_18&#39;)"><span class="hl_tyconref"><span class="mpre">DevRandom</span></span></a><span class="mpre">), </span><a href="#loc_73_1_73_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_12&#39;)"><span class="hl_varref"><span class="mpre">openBackend</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> :: </span><a href="Crypto.Random.Entropy.Unix.html#loc_29_9_29_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Unix.html#loc_29_9_29_19&#39;)"><span class="hl_tyconref"><span class="mpre">DevURandom</span></span></a><span class="mpre">)
#endif
    ]

data </span><a name="loc_55_6_55_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_20&#39;)"><span class="hl_tycondecl"><span class="mpre">EntropyBackend</span></span></a><span class="mpre"> = forall b . EntropySource b =&gt; </span><a name="loc_55_53_55_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_53_55_67&#39;)"><span class="hl_condecl"><span class="mpre">EntropyBackend</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">

newtype </span><a name="loc_57_9_57_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_26&#39;)"><span class="hl_tycondecl"><span class="mpre">TestEntropySource</span></span></a><span class="mpre"> = </span><a name="loc_57_29_57_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_29_57_46&#39;)"><span class="hl_condecl"><span class="mpre">TestEntropySource</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">

instance </span><a href="Crypto.Random.Entropy.Source.html#loc_15_7_15_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Source.html#loc_15_7_15_20&#39;)"><span class="hl_classref"><span class="mpre">EntropySource</span></span></a><span class="mpre"> </span><a href="#loc_57_9_57_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_26&#39;)"><span class="hl_tyconref"><span class="mpre">TestEntropySource</span></span></a><span class="mpre"> where
    </span><a href="Crypto.Random.Entropy.Source.html#loc_17_5_17_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Source.html#loc_17_5_17_16&#39;)"><span class="hl_vardecl"><span class="mpre">entropyOpen</span></span></a><span class="mpre">    = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
    </span><a href="Crypto.Random.Entropy.Source.html#loc_20_5_20_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Source.html#loc_20_5_20_18&#39;)"><span class="hl_fundecl"><span class="mpre">entropyGather</span></span></a><span class="mpre"> (</span><a href="#loc_57_29_57_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_29_57_46&#39;)"><span class="hl_conref"><span class="mpre">TestEntropySource</span></span></a><span class="mpre"> </span><a name="loc_61_38_61_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_38_61_40&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">) </span><a name="loc_61_42_61_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_42_61_45&#39;)"><span class="hl_vardecl"><span class="mpre">dst</span></span></a><span class="mpre"> </span><a name="loc_61_46_61_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_46_61_47&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">
        | </span><a href="#loc_65_26_65_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_26_65_29&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">  = </span><a href="Data.ByteString.Internal.html#loc_639_1_639_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_639_1_639_7&#39;)"><span class="hl_varref"><span class="mpre">B.memset</span></span></a><span class="mpre"> </span><a href="#loc_61_42_61_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_42_61_45&#39;)"><span class="hl_varref"><span class="mpre">dst</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.index</span></span><span class="mpre"> </span><a href="#loc_61_38_61_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_38_61_40&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_61_46_61_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_46_61_47&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_61_46_61_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_46_61_47&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
        | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="hl_varref"><span class="mpre">withForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_65_19_65_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_19_65_23&#39;)"><span class="hl_varref"><span class="mpre">fptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_63_49_63_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_49_63_52&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_66_13_66_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_13_66_17&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_61_42_61_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_42_61_45&#39;)"><span class="hl_varref"><span class="mpre">dst</span></span></a><span class="mpre"> (</span><a href="#loc_63_49_63_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_49_63_52&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_65_24_65_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_24_65_25&#39;)"><span class="hl_varref"><span class="mpre">o</span></span></a><span class="mpre">) </span><a href="#loc_61_46_61_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_46_61_47&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
                         </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_61_46_61_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_46_61_47&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
      where (</span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">B.PS</span></span></a><span class="mpre"> </span><a name="loc_65_19_65_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_19_65_23&#39;)"><span class="hl_vardecl"><span class="mpre">fptr</span></span></a><span class="mpre"> </span><a name="loc_65_24_65_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_24_65_25&#39;)"><span class="hl_vardecl"><span class="mpre">o</span></span></a><span class="mpre"> </span><a name="loc_65_26_65_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_26_65_29&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">) = </span><a href="#loc_61_38_61_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_38_61_40&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
            </span><a name="loc_66_13_66_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_13_66_17&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_66_18_66_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_18_66_19&#39;)"><span class="hl_vardecl"><span class="mpre">d</span></span></a><span class="mpre"> </span><a name="loc_66_20_66_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_20_66_21&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_66_22_66_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_22_66_23&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">
                | </span><a href="#loc_66_22_66_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_22_66_23&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">    = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
                | </span><a href="#loc_66_22_66_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_22_66_23&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><a href="#loc_65_26_65_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_26_65_29&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">  = </span><a href="Data.ByteString.Internal.html#loc_624_1_624_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_624_1_624_7&#39;)"><span class="hl_varref"><span class="mpre">B.memcpy</span></span></a><span class="mpre"> </span><a href="#loc_66_18_66_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_18_66_19&#39;)"><span class="hl_varref"><span class="mpre">d</span></span></a><span class="mpre"> </span><a href="#loc_66_20_66_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_20_66_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_66_22_66_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_22_66_23&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">)
                | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="Data.ByteString.Internal.html#loc_624_1_624_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_624_1_624_7&#39;)"><span class="hl_varref"><span class="mpre">B.memcpy</span></span></a><span class="mpre"> </span><a href="#loc_66_18_66_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_18_66_19&#39;)"><span class="hl_varref"><span class="mpre">d</span></span></a><span class="mpre"> </span><a href="#loc_66_20_66_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_20_66_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_65_26_65_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_26_65_29&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_66_13_66_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_13_66_17&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> (</span><a href="#loc_66_18_66_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_18_66_19&#39;)"><span class="hl_varref"><span class="mpre">d</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_65_26_65_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_26_65_29&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">) </span><a href="#loc_66_20_66_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_20_66_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> (</span><a href="#loc_66_22_66_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_22_66_23&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><a href="#loc_65_26_65_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_26_65_29&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">)
    </span><a href="Crypto.Random.Entropy.Source.html#loc_22_5_22_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Source.html#loc_22_5_22_17&#39;)"><span class="hl_fundecl"><span class="mpre">entropyClose</span></span></a><span class="mpre"> _ = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><a href="#loc_73_1_73_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_12&#39;)"><span class="mpre">openBackend</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy.hs&quot;, srcSpanStartLine = 72, srcSpanStartColumn = 16, srcSpanEndLine = 72, srcSpanEndColumn = 34}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy.hs&quot;, srcSpanStartLine = 72, srcSpanStartColumn = 32, srcSpanEndLine = 72, srcSpanEndColumn = 34}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/p"><span class="mpre">EntropySource b =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="#loc_55_6_55_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_20&#39;)"><span class="hl_tyconref"><span class="mpre">EntropyBackend</span></span></a><span class="mpre">)
</span><a name="loc_73_1_73_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_12&#39;)"><span class="hl_fundecl"><span class="mpre">openBackend</span></span></a><span class="mpre"> </span><a name="loc_73_13_73_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_13_73_14&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> </span><a href="#loc_55_53_55_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_53_55_67&#39;)"><span class="hl_conref"><span class="mpre">EntropyBackend</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><a href="#loc_75_9_75_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_9_75_17&#39;)"><span class="hl_varref"><span class="mpre">callOpen</span></span></a><span class="mpre"> </span><a href="#loc_73_13_73_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_13_73_14&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
  where </span><a href="#loc_75_9_75_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_9_75_17&#39;)"><span class="mpre">callOpen</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy.hs&quot;, srcSpanStartLine = 74, srcSpanStartColumn = 21, srcSpanEndLine = 74, srcSpanEndColumn = 39}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy.hs&quot;, srcSpanStartLine = 74, srcSpanStartColumn = 37, srcSpanEndLine = 74, srcSpanEndColumn = 39}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/p"><span class="mpre">EntropySource b =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)
        </span><a name="loc_75_9_75_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_9_75_17&#39;)"><span class="hl_fundecl"><span class="mpre">callOpen</span></span></a><span class="mpre"> _ = </span><a href="Crypto.Random.Entropy.Source.html#loc_17_5_17_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Source.html#loc_17_5_17_16&#39;)"><span class="hl_varref"><span class="mpre">entropyOpen</span></span></a><span class="mpre">

</span><a href="#loc_78_1_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_14&#39;)"><span class="mpre">gatherBackend</span></a><span class="mpre"> :: </span><a href="#loc_55_6_55_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_20&#39;)"><span class="hl_tyconref"><span class="mpre">EntropyBackend</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_78_1_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_14&#39;)"><span class="hl_fundecl"><span class="mpre">gatherBackend</span></span></a><span class="mpre"> (</span><a href="#loc_55_53_55_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_53_55_67&#39;)"><span class="hl_conref"><span class="mpre">EntropyBackend</span></span></a><span class="mpre"> </span><a name="loc_78_31_78_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_31_78_38&#39;)"><span class="hl_vardecl"><span class="mpre">backend</span></span></a><span class="mpre">) </span><a name="loc_78_40_78_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_40_78_43&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_78_44_78_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_44_78_45&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><a href="Crypto.Random.Entropy.Source.html#loc_20_5_20_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Source.html#loc_20_5_20_18&#39;)"><span class="hl_varref"><span class="mpre">entropyGather</span></span></a><span class="mpre"> </span><a href="#loc_78_31_78_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_31_78_38&#39;)"><span class="hl_varref"><span class="mpre">backend</span></span></a><span class="mpre"> </span><a href="#loc_78_40_78_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_40_78_43&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_78_44_78_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_44_78_45&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Pool of Entropy. contains a self mutating pool of entropy,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- that is always guarantee to contains data.</span></span><span class="mpre">
data </span><a name="loc_82_6_82_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_6_82_17&#39;)"><span class="hl_tycondecl"><span class="mpre">EntropyPool</span></span></a><span class="mpre"> = </span><a name="loc_82_20_82_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_20_82_31&#39;)"><span class="hl_condecl"><span class="mpre">EntropyPool</span></span></a><span class="mpre"> [</span><a href="#loc_55_6_55_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_20&#39;)"><span class="hl_tyconref"><span class="mpre">EntropyBackend</span></span></a><span class="mpre">] (</span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">) </span><span class="hl_tyconref"><span class="mpre">SecureMem</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- size of entropy pool by default</span></span><span class="mpre">
</span><a href="#loc_86_1_86_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_1_86_16&#39;)"><span class="mpre">defaultPoolSize</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_86_1_86_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_1_86_16&#39;)"><span class="hl_vardecl"><span class="mpre">defaultPoolSize</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">4096</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Create a new entropy pool of a specific size</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- While you can create as many entropy pool as you want, the pool can be shared between multiples RNGs.</span></span><span class="mpre">
</span><a href="#loc_92_1_92_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_22&#39;)"><span class="mpre">createEntropyPoolWith</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; [</span><a href="#loc_55_6_55_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_20&#39;)"><span class="hl_tyconref"><span class="mpre">EntropyBackend</span></span></a><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_82_6_82_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_6_82_17&#39;)"><span class="hl_tyconref"><span class="mpre">EntropyPool</span></span></a><span class="mpre">
</span><a name="loc_92_1_92_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_22&#39;)"><span class="hl_fundecl"><span class="mpre">createEntropyPoolWith</span></span></a><span class="mpre"> </span><a name="loc_92_23_92_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_23_92_31&#39;)"><span class="hl_vardecl"><span class="mpre">poolSize</span></span></a><span class="mpre"> </span><a name="loc_92_32_92_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_32_92_40&#39;)"><span class="hl_vardecl"><span class="mpre">backends</span></span></a><span class="mpre"> = do
    </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_92_32_92_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_32_92_40&#39;)"><span class="hl_varref"><span class="mpre">backends</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fail</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;cannot get any source of entropy on this system&quot;</span></span><span class="mpre">
    </span><a name="loc_94_5_94_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_5_94_7&#39;)"><span class="hl_vardecl"><span class="mpre">sm</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">allocateSecureMem</span></span><span class="mpre"> </span><a href="#loc_92_23_92_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_23_92_31&#39;)"><span class="hl_varref"><span class="mpre">poolSize</span></span></a><span class="mpre">
    </span><a name="loc_95_5_95_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_5_95_6&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">  &lt;- </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="hl_varref"><span class="mpre">newMVar</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">withSecureMemPtr</span></span><span class="mpre"> </span><a href="#loc_94_5_94_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_5_94_7&#39;)"><span class="hl_varref"><span class="mpre">sm</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_155_1_155_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_10&#39;)"><span class="hl_varref"><span class="mpre">replenish</span></span></a><span class="mpre"> </span><a href="#loc_92_23_92_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_23_92_31&#39;)"><span class="hl_varref"><span class="mpre">poolSize</span></span></a><span class="mpre"> </span><a href="#loc_92_32_92_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_32_92_40&#39;)"><span class="hl_varref"><span class="mpre">backends</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_82_20_82_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_20_82_31&#39;)"><span class="hl_conref"><span class="mpre">EntropyPool</span></span></a><span class="mpre"> </span><a href="#loc_92_32_92_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_32_92_40&#39;)"><span class="hl_varref"><span class="mpre">backends</span></span></a><span class="mpre"> </span><a href="#loc_95_5_95_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_5_95_6&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_94_5_94_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_5_94_7&#39;)"><span class="hl_varref"><span class="mpre">sm</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Create a new entropy pool with a default size.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- While you can create as many entropy pool as you want, the pool can be shared between multiples RNGs.</span></span><span class="mpre">
</span><a href="#loc_103_1_103_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_1_103_18&#39;)"><span class="mpre">createEntropyPool</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_82_6_82_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_6_82_17&#39;)"><span class="hl_tyconref"><span class="mpre">EntropyPool</span></span></a><span class="mpre">
</span><a name="loc_103_1_103_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_1_103_18&#39;)"><span class="hl_vardecl"><span class="mpre">createEntropyPool</span></span></a><span class="mpre"> = do
    </span><a name="loc_104_5_104_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_5_104_13&#39;)"><span class="hl_vardecl"><span class="mpre">backends</span></span></a><span class="mpre"> &lt;- </span><a href="Data.Maybe.html#loc_115_1_115_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_115_1_115_10&#39;)"><span class="hl_varref"><span class="mpre">catMaybes</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">sequence</span></span><span class="mpre"> </span><a href="#loc_43_1_43_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_18&#39;)"><span class="hl_varref"><span class="mpre">supportedBackends</span></span></a><span class="mpre">
    </span><a href="#loc_92_1_92_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_22&#39;)"><span class="hl_varref"><span class="mpre">createEntropyPoolWith</span></span></a><span class="mpre"> </span><a href="#loc_86_1_86_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_1_86_16&#39;)"><span class="hl_varref"><span class="mpre">defaultPoolSize</span></span></a><span class="mpre"> </span><a href="#loc_104_5_104_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_5_104_13&#39;)"><span class="hl_varref"><span class="mpre">backends</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Create a dummy entropy pool that is deterministic, and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- dependant on the input bytestring only.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This is stricly reserved for testing purpose when a deterministic seed need</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to be generated with deterministic RNGs.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Do not use in production code.</span></span><span class="mpre">
</span><a href="#loc_115_1_115_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_1_115_22&#39;)"><span class="mpre">createTestEntropyPool</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><a href="#loc_82_6_82_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_6_82_17&#39;)"><span class="hl_tyconref"><span class="mpre">EntropyPool</span></span></a><span class="mpre">
</span><a name="loc_115_1_115_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_1_115_22&#39;)"><span class="hl_fundecl"><span class="mpre">createTestEntropyPool</span></span></a><span class="mpre"> </span><a name="loc_115_23_115_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_23_115_25&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">B.null</span></span><span class="mpre"> </span><a href="#loc_115_23_115_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_23_115_25&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;cannot create entropy pool from an empty bytestring&quot;</span></span><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_92_1_92_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_22&#39;)"><span class="hl_varref"><span class="mpre">createEntropyPoolWith</span></span></a><span class="mpre"> </span><a href="#loc_86_1_86_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_1_86_16&#39;)"><span class="hl_varref"><span class="mpre">defaultPoolSize</span></span></a><span class="mpre"> [</span><a href="#loc_55_53_55_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_53_55_67&#39;)"><span class="hl_conref"><span class="mpre">EntropyBackend</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_57_29_57_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_29_57_46&#39;)"><span class="hl_conref"><span class="mpre">TestEntropySource</span></span></a><span class="mpre"> </span><a href="#loc_115_23_115_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_23_115_25&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">]

</span><span class="hl_comment"><span class="mpre">-- | Put a chunk of the entropy pool into a buffer</span></span><span class="mpre">
</span><a href="#loc_121_1_121_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_1_121_15&#39;)"><span class="mpre">grabEntropyPtr</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_82_6_82_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_6_82_17&#39;)"><span class="hl_tyconref"><span class="mpre">EntropyPool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_121_1_121_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_1_121_15&#39;)"><span class="hl_fundecl"><span class="mpre">grabEntropyPtr</span></span></a><span class="mpre"> </span><a name="loc_121_16_121_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_16_121_17&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> (</span><a href="#loc_82_20_82_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_20_82_31&#39;)"><span class="hl_conref"><span class="mpre">EntropyPool</span></span></a><span class="mpre"> </span><a name="loc_121_31_121_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_31_121_39&#39;)"><span class="hl_vardecl"><span class="mpre">backends</span></span></a><span class="mpre"> </span><a name="loc_121_40_121_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_40_121_44&#39;)"><span class="hl_vardecl"><span class="mpre">posM</span></span></a><span class="mpre"> </span><a name="loc_121_45_121_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_45_121_47&#39;)"><span class="hl_vardecl"><span class="mpre">sm</span></span></a><span class="mpre">) </span><a name="loc_121_49_121_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_49_121_55&#39;)"><span class="hl_vardecl"><span class="mpre">outPtr</span></span></a><span class="mpre"> =
    </span><span class="hl_varref"><span class="mpre">withSecureMemPtr</span></span><span class="mpre"> </span><a href="#loc_121_45_121_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_45_121_47&#39;)"><span class="hl_varref"><span class="mpre">sm</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_122_28_122_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_28_122_42&#39;)"><span class="hl_vardecl"><span class="mpre">entropyPoolPtr</span></span></a><span class="mpre"> -&gt;
        </span><a href="Control.Concurrent.MVar.html#loc_216_1_216_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_216_1_216_12&#39;)"><span class="hl_varref"><span class="mpre">modifyMVar_</span></span></a><span class="mpre"> </span><a href="#loc_121_40_121_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_40_121_44&#39;)"><span class="hl_varref"><span class="mpre">posM</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_123_29_123_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_29_123_32&#39;)"><span class="hl_vardecl"><span class="mpre">pos</span></span></a><span class="mpre"> -&gt;
            </span><a href="#loc_126_9_126_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_9_126_17&#39;)"><span class="hl_varref"><span class="mpre">copyLoop</span></span></a><span class="mpre"> </span><a href="#loc_121_49_121_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_49_121_55&#39;)"><span class="hl_varref"><span class="mpre">outPtr</span></span></a><span class="mpre"> </span><a href="#loc_122_28_122_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_28_122_42&#39;)"><span class="hl_varref"><span class="mpre">entropyPoolPtr</span></span></a><span class="mpre"> </span><a href="#loc_123_29_123_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_29_123_32&#39;)"><span class="hl_varref"><span class="mpre">pos</span></span></a><span class="mpre"> </span><a href="#loc_121_16_121_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_16_121_17&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
  where </span><a name="loc_125_9_125_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_9_125_17&#39;)"><span class="hl_vardecl"><span class="mpre">poolSize</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">secureMemGetSize</span></span><span class="mpre"> </span><a href="#loc_121_45_121_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_45_121_47&#39;)"><span class="hl_varref"><span class="mpre">sm</span></span></a><span class="mpre">
        </span><a name="loc_126_9_126_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_9_126_17&#39;)"><span class="hl_fundecl"><span class="mpre">copyLoop</span></span></a><span class="mpre"> </span><a name="loc_126_18_126_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_18_126_19&#39;)"><span class="hl_vardecl"><span class="mpre">d</span></span></a><span class="mpre"> </span><a name="loc_126_20_126_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_20_126_21&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_126_22_126_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_22_126_25&#39;)"><span class="hl_vardecl"><span class="mpre">pos</span></span></a><span class="mpre"> </span><a name="loc_126_26_126_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_26_126_30&#39;)"><span class="hl_vardecl"><span class="mpre">left</span></span></a><span class="mpre">
            | </span><a href="#loc_126_26_126_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_26_126_30&#39;)"><span class="hl_varref"><span class="mpre">left</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_126_22_126_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_22_126_25&#39;)"><span class="hl_varref"><span class="mpre">pos</span></span></a><span class="mpre">
            | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do
                </span><a name="loc_129_17_129_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_17_129_27&#39;)"><span class="hl_vardecl"><span class="mpre">wrappedPos</span></span></a><span class="mpre"> &lt;-
                    if </span><a href="#loc_126_22_126_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_22_126_25&#39;)"><span class="hl_varref"><span class="mpre">pos</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_125_9_125_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_9_125_17&#39;)"><span class="hl_varref"><span class="mpre">poolSize</span></span></a><span class="mpre">
                        then </span><a href="#loc_155_1_155_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_10&#39;)"><span class="hl_varref"><span class="mpre">replenish</span></span></a><span class="mpre"> </span><a href="#loc_125_9_125_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_9_125_17&#39;)"><span class="hl_varref"><span class="mpre">poolSize</span></span></a><span class="mpre"> </span><a href="#loc_121_31_121_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_31_121_39&#39;)"><span class="hl_varref"><span class="mpre">backends</span></span></a><span class="mpre"> </span><a href="#loc_126_20_126_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_20_126_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
                        else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_126_22_126_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_22_126_25&#39;)"><span class="hl_varref"><span class="mpre">pos</span></span></a><span class="mpre">
                let </span><a name="loc_133_21_133_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_21_133_22&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">min</span></span><span class="mpre"> (</span><a href="#loc_125_9_125_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_9_125_17&#39;)"><span class="hl_varref"><span class="mpre">poolSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_129_17_129_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_17_129_27&#39;)"><span class="hl_varref"><span class="mpre">wrappedPos</span></span></a><span class="mpre">) </span><a href="#loc_126_26_126_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_26_126_30&#39;)"><span class="hl_varref"><span class="mpre">left</span></span></a><span class="mpre">
                </span><a href="Foreign.Marshal.Utils.html#loc_154_1_154_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Utils.html#loc_154_1_154_10&#39;)"><span class="hl_varref"><span class="mpre">copyBytes</span></span></a><span class="mpre"> </span><a href="#loc_126_18_126_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_18_126_19&#39;)"><span class="hl_varref"><span class="mpre">d</span></span></a><span class="mpre"> (</span><a href="#loc_126_20_126_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_20_126_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_129_17_129_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_17_129_27&#39;)"><span class="hl_varref"><span class="mpre">wrappedPos</span></span></a><span class="mpre">) </span><a href="#loc_133_21_133_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_21_133_22&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
                </span><a href="#loc_126_9_126_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_9_126_17&#39;)"><span class="hl_varref"><span class="mpre">copyLoop</span></span></a><span class="mpre"> (</span><a href="#loc_126_18_126_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_18_126_19&#39;)"><span class="hl_varref"><span class="mpre">d</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_133_21_133_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_21_133_22&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">) </span><a href="#loc_126_20_126_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_20_126_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> (</span><a href="#loc_129_17_129_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_17_129_27&#39;)"><span class="hl_varref"><span class="mpre">wrappedPos</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_133_21_133_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_21_133_22&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">) (</span><a href="#loc_126_26_126_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_26_126_30&#39;)"><span class="hl_varref"><span class="mpre">left</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_133_21_133_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_21_133_22&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Grab a chunk of entropy from the entropy pool.</span></span><span class="mpre">
</span><a href="#loc_139_1_139_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_14&#39;)"><span class="mpre">grabEntropyIO</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_82_6_82_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_6_82_17&#39;)"><span class="hl_tyconref"><span class="mpre">EntropyPool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">SecureMem</span></span><span class="mpre">
</span><a name="loc_139_1_139_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_14&#39;)"><span class="hl_fundecl"><span class="mpre">grabEntropyIO</span></span></a><span class="mpre"> </span><a name="loc_139_15_139_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_15_139_16&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> </span><a name="loc_139_17_139_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_17_139_21&#39;)"><span class="hl_vardecl"><span class="mpre">pool</span></span></a><span class="mpre"> = do
    </span><a name="loc_140_5_140_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_5_140_8&#39;)"><span class="hl_vardecl"><span class="mpre">out</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">allocateSecureMem</span></span><span class="mpre"> </span><a href="#loc_139_15_139_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_15_139_16&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">withSecureMemPtr</span></span><span class="mpre"> </span><a href="#loc_140_5_140_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_5_140_8&#39;)"><span class="hl_varref"><span class="mpre">out</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_121_1_121_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_1_121_15&#39;)"><span class="hl_varref"><span class="mpre">grabEntropyPtr</span></span></a><span class="mpre"> </span><a href="#loc_139_15_139_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_15_139_16&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_139_17_139_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_17_139_21&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_140_5_140_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_5_140_8&#39;)"><span class="hl_varref"><span class="mpre">out</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Grab a chunk of entropy from the entropy pool.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Great care need to be taken here when using the output,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- as this use unsafePerformIO to actually get entropy.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Use grabEntropyIO if unsure.</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_152_1_152_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_1_152_12&#39;)"><span class="mpre">grabEntropy</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_152_1_152_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_1_152_12&#39;)"><span class="mpre">grabEntropy</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_82_6_82_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_6_82_17&#39;)"><span class="hl_tyconref"><span class="mpre">EntropyPool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">SecureMem</span></span><span class="mpre">
</span><a name="loc_152_1_152_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_1_152_12&#39;)"><span class="hl_fundecl"><span class="mpre">grabEntropy</span></span></a><span class="mpre"> </span><a name="loc_152_13_152_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_13_152_14&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> </span><a name="loc_152_15_152_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_15_152_19&#39;)"><span class="hl_vardecl"><span class="mpre">pool</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_139_1_139_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_14&#39;)"><span class="hl_varref"><span class="mpre">grabEntropyIO</span></span></a><span class="mpre"> </span><a href="#loc_152_13_152_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_13_152_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_152_15_152_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_15_152_19&#39;)"><span class="hl_varref"><span class="mpre">pool</span></span></a><span class="mpre">

</span><a href="#loc_155_1_155_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_10&#39;)"><span class="mpre">replenish</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; [</span><a href="#loc_55_6_55_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_20&#39;)"><span class="hl_tyconref"><span class="mpre">EntropyBackend</span></span></a><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_155_1_155_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_10&#39;)"><span class="hl_fundecl"><span class="mpre">replenish</span></span></a><span class="mpre"> </span><a name="loc_155_11_155_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_11_155_19&#39;)"><span class="hl_vardecl"><span class="mpre">poolSize</span></span></a><span class="mpre"> </span><a name="loc_155_20_155_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_20_155_28&#39;)"><span class="hl_vardecl"><span class="mpre">backends</span></span></a><span class="mpre"> </span><a name="loc_155_29_155_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_29_155_32&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> = </span><a href="#loc_157_9_157_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_13&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_155_20_155_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_20_155_28&#39;)"><span class="hl_varref"><span class="mpre">backends</span></span></a><span class="mpre"> </span><a href="#loc_155_29_155_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_29_155_32&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_155_11_155_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_11_155_19&#39;)"><span class="hl_varref"><span class="mpre">poolSize</span></span></a><span class="mpre">
  where </span><a href="#loc_157_9_157_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_13&#39;)"><span class="mpre">loop</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; [</span><a href="#loc_55_6_55_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_6_55_20&#39;)"><span class="hl_tyconref"><span class="mpre">EntropyBackend</span></span></a><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
        </span><a name="loc_157_9_157_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_13&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_157_14_157_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_14_157_19&#39;)"><span class="hl_vardecl"><span class="mpre">retry</span></span></a><span class="mpre"> [] </span><a name="loc_157_23_157_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_23_157_24&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_157_25_157_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_25_157_26&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> | </span><a href="#loc_157_25_157_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_25_157_26&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">     = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
                          | </span><a href="#loc_157_14_157_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_14_157_19&#39;)"><span class="hl_varref"><span class="mpre">retry</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">3</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;cannot fully replenish&quot;</span></span><span class="mpre">
                          | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">  = </span><a href="#loc_157_9_157_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_13&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> (</span><a href="#loc_157_14_157_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_14_157_19&#39;)"><span class="hl_varref"><span class="mpre">retry</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_155_20_155_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_20_155_28&#39;)"><span class="hl_varref"><span class="mpre">backends</span></span></a><span class="mpre"> </span><a href="#loc_157_23_157_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_23_157_24&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_157_25_157_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_25_157_26&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
        </span><a href="#loc_157_9_157_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_13&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> _     (_</span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_)  _ </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
        </span><a href="#loc_157_9_157_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_13&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_161_14_161_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_14_161_19&#39;)"><span class="hl_vardecl"><span class="mpre">retry</span></span></a><span class="mpre"> (</span><a name="loc_161_21_161_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_21_161_22&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_161_23_161_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_23_161_25&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">) </span><a name="loc_161_27_161_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_27_161_28&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_161_29_161_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_29_161_30&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = do
            </span><a name="loc_162_13_162_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_13_162_14&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_78_1_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_14&#39;)"><span class="hl_varref"><span class="mpre">gatherBackend</span></span></a><span class="mpre"> </span><a href="#loc_161_21_161_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_21_161_22&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><a href="#loc_161_27_161_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_27_161_28&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_161_29_161_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_29_161_30&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
            </span><a href="#loc_157_9_157_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_13&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_161_14_161_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_14_161_19&#39;)"><span class="hl_varref"><span class="mpre">retry</span></span></a><span class="mpre"> </span><a href="#loc_161_23_161_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_23_161_25&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> (</span><a href="#loc_161_27_161_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_27_161_28&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_162_13_162_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_13_162_14&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">) (</span><a href="#loc_161_29_161_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_29_161_30&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_162_13_162_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_13_162_14&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">)
</span></div></body></html>