<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Trustworthy #-}
{-# LANGUAGE CPP
           , NoImplicitPrelude
           , BangPatterns
  #-}

</span><span class="hl_comment"><span class="mpre">-- ----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  (c) The University of Glasgow 2006</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Fingerprints for recompilation checking and ABI versioning, and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- implementing fast comparison of Typeable.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ----------------------------------------------------------------------------</span></span><span class="mpre">

module GHC.Fingerprint (
        Fingerprint(..), fingerprint0,
        fingerprintData,
        fingerprintString,
        fingerprintFingerprints,
        getFileHash
   ) where

import GHC.IO
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Fingerprint.hs&quot;, srcSpanStartLine = 25, srcSpanStartColumn = 8, srcSpanEndLine = 25, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Fingerprint.hs&quot;, srcSpanStartLine = 26, srcSpanStartColumn = 8, srcSpanEndLine = 26, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;GHC.Num&quot;"><span class="mpre">GHC.Num</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Fingerprint.hs&quot;, srcSpanStartLine = 27, srcSpanStartColumn = 8, srcSpanEndLine = 27, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.List&quot;"><span class="mpre">GHC.List</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Fingerprint.hs&quot;, srcSpanStartLine = 28, srcSpanStartColumn = 8, srcSpanEndLine = 28, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Real&quot;"><span class="mpre">GHC.Real</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Fingerprint.hs&quot;, srcSpanStartLine = 29, srcSpanStartColumn = 8, srcSpanEndLine = 29, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Show&quot;"><span class="mpre">GHC.Show</span></span><span class="mpre">
import Foreign
import Foreign.C
import System.IO
import Control.Monad (</span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">)

import GHC.Fingerprint.Type

</span><span class="hl_comment"><span class="mpre">-- for SIZEOF_STRUCT_MD5CONTEXT:</span></span><span class="mpre">
#include &quot;HsBaseConfig.h&quot;

</span><span class="hl_comment"><span class="mpre">-- XXX instance Storable Fingerprint</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- defined in Foreign.Storable to avoid orphan instance</span></span><span class="mpre">

</span><a href="#loc_44_1_44_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_13&#39;)"><span class="mpre">fingerprint0</span></a><span class="mpre"> :: </span><a href="GHC.Fingerprint.Type.html#loc_23_6_23_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Fingerprint.Type.html#loc_23_6_23_17&#39;)"><span class="hl_tyconref"><span class="mpre">Fingerprint</span></span></a><span class="mpre">
</span><a name="loc_44_1_44_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_13&#39;)"><span class="hl_vardecl"><span class="mpre">fingerprint0</span></span></a><span class="mpre"> = </span><a href="GHC.Fingerprint.Type.html#loc_23_20_23_31" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Fingerprint.Type.html#loc_23_20_23_31&#39;)"><span class="hl_conref"><span class="mpre">Fingerprint</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">

</span><a href="#loc_47_1_47_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_1_47_24&#39;)"><span class="mpre">fingerprintFingerprints</span></a><span class="mpre"> :: [</span><a href="GHC.Fingerprint.Type.html#loc_23_6_23_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Fingerprint.Type.html#loc_23_6_23_17&#39;)"><span class="hl_tyconref"><span class="mpre">Fingerprint</span></span></a><span class="mpre">] -&gt; </span><a href="GHC.Fingerprint.Type.html#loc_23_6_23_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Fingerprint.Type.html#loc_23_6_23_17&#39;)"><span class="hl_tyconref"><span class="mpre">Fingerprint</span></span></a><span class="mpre">
</span><a name="loc_47_1_47_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_1_47_24&#39;)"><span class="hl_fundecl"><span class="mpre">fingerprintFingerprints</span></span></a><span class="mpre"> </span><a name="loc_47_25_47_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_25_47_27&#39;)"><span class="hl_vardecl"><span class="mpre">fs</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_182_1_182_23" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_182_1_182_23&#39;)"><span class="hl_varref"><span class="mpre">unsafeDupablePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
  </span><a href="Foreign.Marshal.Array.html#loc_194_1_194_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Array.html#loc_194_1_194_13&#39;)"><span class="hl_varref"><span class="mpre">withArrayLen</span></span></a><span class="mpre"> </span><a href="#loc_47_25_47_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_25_47_27&#39;)"><span class="hl_varref"><span class="mpre">fs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_48_22_48_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_22_48_25&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_48_26_48_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_26_48_27&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; do
    </span><a href="#loc_52_1_52_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_16&#39;)"><span class="hl_varref"><span class="mpre">fingerprintData</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_48_26_48_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_26_48_27&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">) (</span><a href="#loc_48_22_48_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_22_48_25&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">head</span></span><span class="mpre"> </span><a href="#loc_47_25_47_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_25_47_27&#39;)"><span class="hl_varref"><span class="mpre">fs</span></span></a><span class="mpre">))

</span><a href="#loc_52_1_52_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_16&#39;)"><span class="mpre">fingerprintData</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.Fingerprint.Type.html#loc_23_6_23_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Fingerprint.Type.html#loc_23_6_23_17&#39;)"><span class="hl_tyconref"><span class="mpre">Fingerprint</span></span></a><span class="mpre">
</span><a name="loc_52_1_52_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_16&#39;)"><span class="hl_fundecl"><span class="mpre">fingerprintData</span></span></a><span class="mpre"> </span><a name="loc_52_17_52_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_20&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a name="loc_52_21_52_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_21_52_24&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = do
  </span><a href="Foreign.Marshal.Alloc.html#loc_121_1_121_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_121_1_121_12&#39;)"><span class="hl_varref"><span class="mpre">allocaBytes</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">SIZEOF_STRUCT_MD5CONTEXT</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_53_43_53_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_43_53_48&#39;)"><span class="hl_vardecl"><span class="mpre">pctxt</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">c_MD5Init</span></span><span class="mpre"> </span><a href="#loc_53_43_53_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_43_53_48&#39;)"><span class="hl_varref"><span class="mpre">pctxt</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">c_MD5Update</span></span><span class="mpre"> </span><a href="#loc_53_43_53_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_43_53_48&#39;)"><span class="hl_varref"><span class="mpre">pctxt</span></span></a><span class="mpre"> </span><a href="#loc_52_17_52_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_20&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_52_21_52_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_21_52_24&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">)
    </span><a href="Foreign.Marshal.Alloc.html#loc_121_1_121_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_121_1_121_12&#39;)"><span class="hl_varref"><span class="mpre">allocaBytes</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_56_23_56_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_23_56_30&#39;)"><span class="hl_vardecl"><span class="mpre">pdigest</span></span></a><span class="mpre"> -&gt; do
      </span><span class="hl_varref"><span class="mpre">c_MD5Final</span></span><span class="mpre"> </span><a href="#loc_56_23_56_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_23_56_30&#39;)"><span class="hl_varref"><span class="mpre">pdigest</span></span></a><span class="mpre"> </span><a href="#loc_53_43_53_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_43_53_48&#39;)"><span class="hl_varref"><span class="mpre">pctxt</span></span></a><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">peek</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_56_23_56_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_23_56_30&#39;)"><span class="hl_varref"><span class="mpre">pdigest</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><a href="GHC.Fingerprint.Type.html#loc_23_6_23_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Fingerprint.Type.html#loc_23_6_23_17&#39;)"><span class="hl_tyconref"><span class="mpre">Fingerprint</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- This is duplicated in compiler/utils/Fingerprint.hsc</span></span><span class="mpre">
</span><a href="#loc_62_1_62_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_18&#39;)"><span class="mpre">fingerprintString</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="GHC.Fingerprint.Type.html#loc_23_6_23_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Fingerprint.Type.html#loc_23_6_23_17&#39;)"><span class="hl_tyconref"><span class="mpre">Fingerprint</span></span></a><span class="mpre">
</span><a name="loc_62_1_62_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_18&#39;)"><span class="hl_fundecl"><span class="mpre">fingerprintString</span></span></a><span class="mpre"> </span><a name="loc_62_19_62_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_19_62_22&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_182_1_182_23" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_182_1_182_23&#39;)"><span class="hl_varref"><span class="mpre">unsafeDupablePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
  </span><a href="Foreign.Marshal.Array.html#loc_194_1_194_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Array.html#loc_194_1_194_13&#39;)"><span class="hl_varref"><span class="mpre">withArrayLen</span></span></a><span class="mpre"> </span><a href="#loc_65_11_65_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_11_65_17&#39;)"><span class="hl_varref"><span class="mpre">word8s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_63_26_63_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_26_63_29&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_63_30_63_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_30_63_31&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt;
     </span><a href="#loc_52_1_52_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_16&#39;)"><span class="hl_varref"><span class="mpre">fingerprintData</span></span></a><span class="mpre"> </span><a href="#loc_63_30_63_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_30_63_31&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_63_26_63_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_26_63_29&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
    where </span><a name="loc_65_11_65_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_11_65_17&#39;)"><span class="hl_vardecl"><span class="mpre">word8s</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">concatMap</span></span><span class="mpre"> </span><a href="#loc_66_11_66_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_11_66_12&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_62_19_62_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_19_62_22&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
          </span><a name="loc_66_11_66_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_11_66_12&#39;)"><span class="hl_fundecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_66_13_66_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_13_66_14&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = let </span><a href="#loc_67_21_67_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_21_67_24&#39;)"><span class="mpre">w32</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word32</span></span><span class="mpre">
                    </span><a name="loc_67_21_67_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_21_67_24&#39;)"><span class="hl_vardecl"><span class="mpre">w32</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">ord</span></span><span class="mpre"> </span><a href="#loc_66_13_66_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_13_66_14&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">)
                in [</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_67_21_67_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_21_67_24&#39;)"><span class="hl_varref"><span class="mpre">w32</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">24</span></span><span class="mpre">),
                    </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_67_21_67_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_21_67_24&#39;)"><span class="hl_varref"><span class="mpre">w32</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre">),
                    </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_67_21_67_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_21_67_24&#39;)"><span class="hl_varref"><span class="mpre">w32</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">),
                    </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_67_21_67_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_21_67_24&#39;)"><span class="hl_varref"><span class="mpre">w32</span></span></a><span class="mpre">]

</span><span class="hl_comment"><span class="mpre">-- | Computes the hash of a given file.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This function loops over the handle, running in constant memory.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /Since: 4.7.0.0/</span></span><span class="mpre">
</span><a href="#loc_78_1_78_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_12&#39;)"><span class="mpre">getFileHash</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.Fingerprint.Type.html#loc_23_6_23_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Fingerprint.Type.html#loc_23_6_23_17&#39;)"><span class="hl_tyconref"><span class="mpre">Fingerprint</span></span></a><span class="mpre">
</span><a name="loc_78_1_78_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_12&#39;)"><span class="hl_fundecl"><span class="mpre">getFileHash</span></span></a><span class="mpre"> </span><a name="loc_78_13_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_13_78_17&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> = </span><a href="System.IO.html#loc_397_1_397_15" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.html#loc_397_1_397_15&#39;)"><span class="hl_varref"><span class="mpre">withBinaryFile</span></span></a><span class="mpre"> </span><a href="#loc_78_13_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_13_78_17&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre"> </span><a href="GHC.IO.IOMode.html#loc_28_21_28_29" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.IOMode.html#loc_28_21_28_29&#39;)"><span class="hl_conref"><span class="mpre">ReadMode</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_78_52_78_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_52_78_53&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> -&gt; do
  </span><a href="Foreign.Marshal.Alloc.html#loc_121_1_121_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_121_1_121_12&#39;)"><span class="hl_varref"><span class="mpre">allocaBytes</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">SIZEOF_STRUCT_MD5CONTEXT</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_79_43_79_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_43_79_48&#39;)"><span class="hl_vardecl"><span class="mpre">pctxt</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">c_MD5Init</span></span><span class="mpre"> </span><a href="#loc_79_43_79_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_43_79_48&#39;)"><span class="hl_varref"><span class="mpre">pctxt</span></span></a><span class="mpre">

    </span><a href="#loc_94_5_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_5_94_18&#39;)"><span class="hl_varref"><span class="mpre">processChunks</span></span></a><span class="mpre"> </span><a href="#loc_78_52_78_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_52_78_53&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> (\</span><a name="loc_82_23_82_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_23_82_26&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a name="loc_82_27_82_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_27_82_31&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">c_MD5Update</span></span><span class="mpre"> </span><a href="#loc_79_43_79_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_43_79_48&#39;)"><span class="hl_varref"><span class="mpre">pctxt</span></span></a><span class="mpre"> </span><a href="#loc_82_23_82_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_23_82_26&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_82_27_82_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_27_82_31&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">))

    </span><a href="Foreign.Marshal.Alloc.html#loc_121_1_121_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_121_1_121_12&#39;)"><span class="hl_varref"><span class="mpre">allocaBytes</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_84_23_84_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_23_84_30&#39;)"><span class="hl_vardecl"><span class="mpre">pdigest</span></span></a><span class="mpre"> -&gt; do
      </span><span class="hl_varref"><span class="mpre">c_MD5Final</span></span><span class="mpre"> </span><a href="#loc_84_23_84_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_23_84_30&#39;)"><span class="hl_varref"><span class="mpre">pdigest</span></span></a><span class="mpre"> </span><a href="#loc_79_43_79_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_43_79_48&#39;)"><span class="hl_varref"><span class="mpre">pctxt</span></span></a><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">peek</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_84_23_84_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_23_84_30&#39;)"><span class="hl_varref"><span class="mpre">pdigest</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><a href="GHC.Fingerprint.Type.html#loc_23_6_23_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Fingerprint.Type.html#loc_23_6_23_17&#39;)"><span class="hl_tyconref"><span class="mpre">Fingerprint</span></span></a><span class="mpre">)

  where
    </span><a name="loc_89_5_89_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_5_89_13&#39;)"><span class="hl_vardecl"><span class="mpre">_BUFSIZE</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">4096</span></span><span class="mpre">

    </span><span class="hl_comment"><span class="mpre">-- | Loop over _BUFSIZE sized chunks read from the handle,</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- passing the callback a block of bytes and its size.</span></span><span class="mpre">
    </span><a href="#loc_94_5_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_5_94_18&#39;)"><span class="mpre">processChunks</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
    </span><a name="loc_94_5_94_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_5_94_18&#39;)"><span class="hl_fundecl"><span class="mpre">processChunks</span></span></a><span class="mpre"> </span><a name="loc_94_19_94_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_19_94_20&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_94_21_94_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_22&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="Foreign.Marshal.Alloc.html#loc_121_1_121_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_121_1_121_12&#39;)"><span class="hl_varref"><span class="mpre">allocaBytes</span></span></a><span class="mpre"> </span><a href="#loc_89_5_89_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_5_89_13&#39;)"><span class="hl_varref"><span class="mpre">_BUFSIZE</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_94_49_94_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_49_94_55&#39;)"><span class="hl_vardecl"><span class="mpre">arrPtr</span></span></a><span class="mpre"> -&gt;

      let </span><a name="loc_96_11_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_11_96_15&#39;)"><span class="hl_vardecl"><span class="mpre">loop</span></span></a><span class="mpre"> = do
            </span><a name="loc_97_13_97_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_13_97_18&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">hGetBuf</span></span><span class="mpre"> </span><a href="#loc_94_19_94_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_19_94_20&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_94_49_94_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_49_94_55&#39;)"><span class="hl_varref"><span class="mpre">arrPtr</span></span></a><span class="mpre"> </span><a href="#loc_89_5_89_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_5_89_13&#39;)"><span class="hl_varref"><span class="mpre">_BUFSIZE</span></span></a><span class="mpre">
            </span><a name="loc_98_13_98_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_13_98_16&#39;)"><span class="hl_vardecl"><span class="mpre">eof</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Handle.html#loc_150_1_150_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_150_1_150_7&#39;)"><span class="hl_varref"><span class="mpre">hIsEOF</span></span></a><span class="mpre"> </span><a href="#loc_94_19_94_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_19_94_20&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
            </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_97_13_97_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_13_97_18&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="#loc_89_5_89_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_5_89_13&#39;)"><span class="hl_varref"><span class="mpre">_BUFSIZE</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><a href="#loc_98_13_98_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_13_98_16&#39;)"><span class="hl_varref"><span class="mpre">eof</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
              </span><span class="hl_string"><span class="mpre">&quot;GHC.Fingerprint.getFileHash: only read &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_97_13_97_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_13_97_18&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; bytes&quot;</span></span><span class="mpre">

            </span><a href="#loc_94_21_94_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_21_94_22&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_94_49_94_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_49_94_55&#39;)"><span class="hl_varref"><span class="mpre">arrPtr</span></span></a><span class="mpre"> </span><a href="#loc_97_13_97_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_13_97_18&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">

            </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><a href="#loc_98_13_98_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_13_98_16&#39;)"><span class="hl_varref"><span class="mpre">eof</span></span></a><span class="mpre">) </span><a href="#loc_96_11_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_11_96_15&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre">

      in </span><a href="#loc_96_11_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_11_96_15&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre">

data </span><span class="hl_tycondecl"><span class="mpre">MD5Context</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Fingerprint.hs&quot;, srcSpanStartLine = 110, srcSpanStartColumn = 1, srcSpanEndLine = 111, srcSpanEndColumn = 42}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Fingerprint.hs&quot;, srcSpanStartLine = 110, srcSpanStartColumn = 1, srcSpanEndLine = 110, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Fingerprint.hs&quot;, srcSpanStartLine = 110, srcS"><span class="mpre">foreign import ccall unsafe &quot;__hsbase_MD5Init&quot;
   c_MD5Init   :: Ptr MD5Context -&gt; IO ()</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Fingerprint.hs&quot;, srcSpanStartLine = 112, srcSpanStartColumn = 1, srcSpanEndLine = 113, srcSpanEndColumn = 63}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Fingerprint.hs&quot;, srcSpanStartLine = 112, srcSpanStartColumn = 1, srcSpanEndLine = 112, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Fingerprint.hs&quot;, srcSpanStartLine = 112, srcS"><span class="mpre">foreign import ccall unsafe &quot;__hsbase_MD5Update&quot;
   c_MD5Update :: Ptr MD5Context -&gt; Ptr Word8 -&gt; CInt -&gt; IO ()</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Fingerprint.hs&quot;, srcSpanStartLine = 114, srcSpanStartColumn = 1, srcSpanEndLine = 115, srcSpanEndColumn = 55}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Fingerprint.hs&quot;, srcSpanStartLine = 114, srcSpanStartColumn = 1, srcSpanEndLine = 114, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Fingerprint.hs&quot;, srcSpanStartLine = 114, srcS"><span class="mpre">foreign import ccall unsafe &quot;__hsbase_MD5Final&quot;
   c_MD5Final  :: Ptr Word8 -&gt; Ptr MD5Context -&gt; IO ()</span></span><span class="mpre">
</span></div></body></html>