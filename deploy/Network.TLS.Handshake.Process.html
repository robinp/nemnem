<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Network.TLS.Handshake.Process</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- process handshake message received</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Network.TLS.Handshake.Process
    ( processHandshake
    , startHandshake
    , getHandshakeDigest
    ) where

import Control.Applicative
import Control.Concurrent.MVar
import Control.Monad.Error
import Control.Monad.State (</span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="mpre">gets</span></a><span class="mpre">)

import Network.TLS.Types (</span><a href="Network.TLS.Types.html#loc_44_6_44_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_6_44_10&#39;)"><span class="mpre">Role</span></a><span class="mpre">(..), </span><a href="Network.TLS.Types.html#loc_52_1_52_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_52_1_52_11&#39;)"><span class="mpre">invertRole</span></a><span class="mpre">)
import Network.TLS.Util
import Network.TLS.Packet
import Network.TLS.Struct
import Network.TLS.State
import Network.TLS.Context.Internal
import Network.TLS.Crypto
import Network.TLS.Handshake.State
import Network.TLS.Handshake.Key
import Network.TLS.Extension
import Data.X509 (</span><a href="Data.X509.CertificateChain.html#loc_21_9_21_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.CertificateChain.html#loc_21_9_21_25&#39;)"><span class="mpre">CertificateChain</span></a><span class="mpre">(..), </span><a href="Data.X509.Cert.html#loc_38_6_38_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.Cert.html#loc_38_6_38_17&#39;)"><span class="mpre">Certificate</span></a><span class="mpre">(..), </span><a href="Data.X509.html#loc_87_1_87_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.html#loc_87_1_87_15&#39;)"><span class="mpre">getCertificate</span></a><span class="mpre">)

</span><a href="#loc_34_1_34_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_17&#39;)"><span class="mpre">processHandshake</span></a><span class="mpre"> :: </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Struct.html#loc_252_6_252_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_252_6_252_15&#39;)"><span class="hl_tyconref"><span class="mpre">Handshake</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_34_1_34_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_17&#39;)"><span class="hl_fundecl"><span class="mpre">processHandshake</span></span></a><span class="mpre"> </span><a name="loc_34_18_34_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_18_34_21&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_34_22_34_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_22_34_24&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> = do
    </span><a name="loc_35_5_35_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_5_35_9&#39;)"><span class="hl_vardecl"><span class="mpre">role</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_34_18_34_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_18_34_21&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_204_1_204_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_204_1_204_16&#39;)"><span class="hl_varref"><span class="mpre">isClientContext</span></span></a><span class="mpre">
    case </span><a href="#loc_34_22_34_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_22_34_24&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> of
        </span><a href="Network.TLS.Struct.html#loc_253_7_253_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_253_7_253_18&#39;)"><span class="hl_conref"><span class="mpre">ClientHello</span></span></a><span class="mpre"> </span><a name="loc_37_21_37_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_21_37_25&#39;)"><span class="hl_vardecl"><span class="mpre">cver</span></span></a><span class="mpre"> </span><a name="loc_37_26_37_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_26_37_29&#39;)"><span class="hl_vardecl"><span class="mpre">ran</span></span></a><span class="mpre"> _ _ _ </span><a name="loc_37_36_37_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_36_37_38&#39;)"><span class="hl_vardecl"><span class="mpre">ex</span></span></a><span class="mpre"> _ -&gt; </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_35_5_35_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_5_35_9&#39;)"><span class="hl_varref"><span class="mpre">role</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_26_44_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_26_44_36&#39;)"><span class="hl_conref"><span class="mpre">ServerRole</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a href="Control.Monad.html#loc_116_1_116_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_116_1_116_6&#39;)"><span class="hl_varref"><span class="mpre">mapM_</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_34_18_34_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_18_34_21&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_51_9_51_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_9_51_31&#39;)"><span class="hl_varref"><span class="mpre">processClientExtension</span></span></a><span class="mpre">) </span><a href="#loc_37_36_37_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_36_37_38&#39;)"><span class="hl_varref"><span class="mpre">ex</span></span></a><span class="mpre">
            </span><a href="#loc_104_1_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_15&#39;)"><span class="hl_varref"><span class="mpre">startHandshake</span></span></a><span class="mpre"> </span><a href="#loc_34_18_34_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_18_34_21&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_37_21_37_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_21_37_25&#39;)"><span class="hl_varref"><span class="mpre">cver</span></span></a><span class="mpre"> </span><a href="#loc_37_26_37_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_26_37_29&#39;)"><span class="hl_varref"><span class="mpre">ran</span></span></a><span class="mpre">
        </span><a href="Network.TLS.Struct.html#loc_255_7_255_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_255_7_255_19&#39;)"><span class="hl_conref"><span class="mpre">Certificates</span></span></a><span class="mpre"> </span><a name="loc_40_22_40_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_22_40_27&#39;)"><span class="hl_vardecl"><span class="mpre">certs</span></span></a><span class="mpre">            -&gt; </span><a href="#loc_61_9_61_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_9_61_28&#39;)"><span class="hl_varref"><span class="mpre">processCertificates</span></span></a><span class="mpre"> </span><a href="#loc_35_5_35_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_5_35_9&#39;)"><span class="hl_varref"><span class="mpre">role</span></span></a><span class="mpre"> </span><a href="#loc_40_22_40_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_22_40_27&#39;)"><span class="hl_varref"><span class="mpre">certs</span></span></a><span class="mpre">
        </span><a href="Network.TLS.Struct.html#loc_258_7_258_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_258_7_258_20&#39;)"><span class="hl_conref"><span class="mpre">ClientKeyXchg</span></span></a><span class="mpre"> </span><a name="loc_41_23_41_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_23_41_30&#39;)"><span class="hl_vardecl"><span class="mpre">content</span></span></a><span class="mpre">         -&gt; </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_35_5_35_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_5_35_9&#39;)"><span class="hl_varref"><span class="mpre">role</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_26_44_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_26_44_36&#39;)"><span class="hl_conref"><span class="mpre">ServerRole</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a href="#loc_72_1_72_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_1_72_21&#39;)"><span class="hl_varref"><span class="mpre">processClientKeyXchg</span></span></a><span class="mpre"> </span><a href="#loc_34_18_34_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_18_34_21&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_41_23_41_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_23_41_30&#39;)"><span class="hl_varref"><span class="mpre">content</span></span></a><span class="mpre">
        </span><a href="Network.TLS.Struct.html#loc_263_7_263_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_263_7_263_32&#39;)"><span class="hl_conref"><span class="mpre">HsNextProtocolNegotiation</span></span></a><span class="mpre"> </span><a name="loc_43_35_43_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_35_43_52&#39;)"><span class="hl_vardecl"><span class="mpre">selected_protocol</span></span></a><span class="mpre"> -&gt;
            </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_35_5_35_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_5_35_9&#39;)"><span class="hl_varref"><span class="mpre">role</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_26_44_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_26_44_36&#39;)"><span class="hl_conref"><span class="mpre">ServerRole</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_34_18_34_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_18_34_21&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.State.html#loc_183_1_183_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_183_1_183_22&#39;)"><span class="hl_varref"><span class="mpre">setNegotiatedProtocol</span></span></a><span class="mpre"> </span><a href="#loc_43_35_43_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_35_43_52&#39;)"><span class="hl_varref"><span class="mpre">selected_protocol</span></span></a><span class="mpre">
        </span><a href="Network.TLS.Struct.html#loc_262_7_262_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_262_7_262_15&#39;)"><span class="hl_conref"><span class="mpre">Finished</span></span></a><span class="mpre"> </span><a name="loc_45_18_45_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_18_45_23&#39;)"><span class="hl_vardecl"><span class="mpre">fdata</span></span></a><span class="mpre">                -&gt; </span><a href="#loc_95_1_95_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_1_95_22&#39;)"><span class="hl_varref"><span class="mpre">processClientFinished</span></span></a><span class="mpre"> </span><a href="#loc_34_18_34_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_18_34_21&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_45_18_45_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_18_45_23&#39;)"><span class="hl_varref"><span class="mpre">fdata</span></span></a><span class="mpre">
        _                             -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    let </span><a name="loc_47_9_47_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_9_47_16&#39;)"><span class="hl_vardecl"><span class="mpre">encoded</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Packet.html#loc_326_1_326_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Packet.html#loc_326_1_326_16&#39;)"><span class="hl_varref"><span class="mpre">encodeHandshake</span></span></a><span class="mpre"> </span><a href="#loc_34_22_34_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_22_34_24&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">
    </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="Network.TLS.State.html#loc_144_1_144_28" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_144_1_144_28&#39;)"><span class="hl_varref"><span class="mpre">certVerifyHandshakeMaterial</span></span></a><span class="mpre"> </span><a href="#loc_34_22_34_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_22_34_24&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_34_18_34_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_18_34_21&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_166_1_166_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_166_1_166_20&#39;)"><span class="hl_varref"><span class="mpre">addHandshakeMessage</span></span></a><span class="mpre"> </span><a href="#loc_47_9_47_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_9_47_16&#39;)"><span class="hl_varref"><span class="mpre">encoded</span></span></a><span class="mpre">
    </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="Network.TLS.State.html#loc_115_1_115_28" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_115_1_115_28&#39;)"><span class="hl_varref"><span class="mpre">finishHandshakeTypeMaterial</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_273_1_273_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_273_1_273_16&#39;)"><span class="hl_varref"><span class="mpre">typeOfHandshake</span></span></a><span class="mpre"> </span><a href="#loc_34_22_34_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_22_34_24&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_34_18_34_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_18_34_21&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_172_1_172_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_172_1_172_22&#39;)"><span class="hl_varref"><span class="mpre">updateHandshakeDigest</span></span></a><span class="mpre"> </span><a href="#loc_47_9_47_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_9_47_16&#39;)"><span class="hl_varref"><span class="mpre">encoded</span></span></a><span class="mpre">
  where </span><span class="hl_comment"><span class="mpre">-- secure renegotiation</span></span><span class="mpre">
        </span><a name="loc_51_9_51_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_9_51_31&#39;)"><span class="hl_fundecl"><span class="mpre">processClientExtension</span></span></a><span class="mpre"> (</span><span class="hl_num"><span class="mpre">0xff01</span></span><span class="mpre">, </span><a name="loc_51_41_51_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_41_51_48&#39;)"><span class="hl_vardecl"><span class="mpre">content</span></span></a><span class="mpre">) = do
            </span><a name="loc_52_13_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_13_52_14&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.State.html#loc_201_1_201_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_201_1_201_16&#39;)"><span class="hl_varref"><span class="mpre">getVerifiedData</span></span></a><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_13_44_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_13_44_23&#39;)"><span class="hl_conref"><span class="mpre">ClientRole</span></span></a><span class="mpre">
            let </span><a name="loc_53_17_53_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_17_53_19&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Extension.html#loc_60_5_60_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Extension.html#loc_60_5_60_20&#39;)"><span class="hl_varref"><span class="mpre">extensionEncode</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Extension.html#loc_106_28_106_47" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Extension.html#loc_106_28_106_47&#39;)"><span class="hl_conref"><span class="mpre">SecureRenegotiation</span></span></a><span class="mpre"> </span><a href="#loc_52_13_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_13_52_14&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">)
            </span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="hl_varref"><span class="mpre">unless</span></span></a><span class="mpre"> (</span><a href="#loc_53_17_53_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_17_53_19&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a href="Network.TLS.Util.html#loc_71_1_71_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_71_1_71_8&#39;)"><span class="hl_infix"><span class="mpre">`bytesEq`</span></span></a><span class="mpre"> </span><a href="#loc_51_41_51_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_41_51_48&#39;)"><span class="hl_varref"><span class="mpre">content</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">throwError</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;client verified data not matching: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_52_13_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_13_52_14&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;:&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_51_41_51_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_41_51_48&#39;)"><span class="hl_varref"><span class="mpre">content</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_188_7_188_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_188_7_188_23&#39;)"><span class="hl_conref"><span class="mpre">HandshakeFailure</span></span></a><span class="mpre">)

            </span><a href="Network.TLS.State.html#loc_171_1_171_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_171_1_171_23&#39;)"><span class="hl_varref"><span class="mpre">setSecureRenegotiation</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- unknown extensions</span></span><span class="mpre">
        </span><a href="#loc_51_9_51_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_9_51_31&#39;)"><span class="hl_fundecl"><span class="mpre">processClientExtension</span></span></a><span class="mpre"> _ = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

        </span><a href="#loc_61_9_61_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_9_61_28&#39;)"><span class="mpre">processCertificates</span></a><span class="mpre"> :: </span><a href="Network.TLS.Types.html#loc_44_6_44_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_6_44_10&#39;)"><span class="hl_tyconref"><span class="mpre">Role</span></span></a><span class="mpre"> -&gt; </span><a href="Data.X509.CertificateChain.html#loc_21_9_21_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.CertificateChain.html#loc_21_9_21_25&#39;)"><span class="hl_tyconref"><span class="mpre">CertificateChain</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
        </span><a name="loc_61_9_61_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_9_61_28&#39;)"><span class="hl_fundecl"><span class="mpre">processCertificates</span></span></a><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_26_44_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_26_44_36&#39;)"><span class="hl_conref"><span class="mpre">ServerRole</span></span></a><span class="mpre"> (</span><a href="Data.X509.CertificateChain.html#loc_21_28_21_44" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.CertificateChain.html#loc_21_28_21_44&#39;)"><span class="hl_conref"><span class="mpre">CertificateChain</span></span></a><span class="mpre"> []) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
        </span><a href="#loc_61_9_61_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_9_61_28&#39;)"><span class="hl_fundecl"><span class="mpre">processCertificates</span></span></a><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_13_44_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_13_44_23&#39;)"><span class="hl_conref"><span class="mpre">ClientRole</span></span></a><span class="mpre"> (</span><a href="Data.X509.CertificateChain.html#loc_21_28_21_44" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.CertificateChain.html#loc_21_28_21_44&#39;)"><span class="hl_conref"><span class="mpre">CertificateChain</span></span></a><span class="mpre"> []) =
            </span><a href="Network.TLS.Context.Internal.html#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;server certificate missing&quot;</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_188_7_188_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_188_7_188_23&#39;)"><span class="hl_conref"><span class="mpre">HandshakeFailure</span></span></a><span class="mpre">)
        </span><a href="#loc_61_9_61_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_9_61_28&#39;)"><span class="hl_fundecl"><span class="mpre">processCertificates</span></span></a><span class="mpre"> _ (</span><a href="Data.X509.CertificateChain.html#loc_21_28_21_44" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.CertificateChain.html#loc_21_28_21_44&#39;)"><span class="hl_conref"><span class="mpre">CertificateChain</span></span></a><span class="mpre"> (</span><a name="loc_64_50_64_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_50_64_51&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_)) =
            </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_34_18_34_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_18_34_21&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_122_1_122_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_122_1_122_13&#39;)"><span class="hl_varref"><span class="mpre">setPublicKey</span></span></a><span class="mpre"> </span><a href="#loc_66_17_66_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_17_66_23&#39;)"><span class="hl_varref"><span class="mpre">pubkey</span></span></a><span class="mpre">
          where </span><a name="loc_66_17_66_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_17_66_23&#39;)"><span class="hl_vardecl"><span class="mpre">pubkey</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">certPubKey</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.X509.html#loc_87_1_87_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.html#loc_87_1_87_15&#39;)"><span class="hl_varref"><span class="mpre">getCertificate</span></span></a><span class="mpre"> </span><a href="#loc_64_50_64_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_50_64_51&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- process the client key exchange message. the protocol expects the initial</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- client version received in ClientHello, not the negotiated version.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in case the version mismatch, generate a random master secret</span></span><span class="mpre">
</span><a href="#loc_72_1_72_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_1_72_21&#39;)"><span class="mpre">processClientKeyXchg</span></a><span class="mpre"> :: </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Struct.html#loc_245_6_245_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_245_6_245_32&#39;)"><span class="hl_tyconref"><span class="mpre">ClientKeyXchgAlgorithmData</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_72_1_72_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_1_72_21&#39;)"><span class="hl_fundecl"><span class="mpre">processClientKeyXchg</span></span></a><span class="mpre"> </span><a name="loc_72_22_72_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_22_72_25&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_246_7_246_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_246_7_246_14&#39;)"><span class="hl_conref"><span class="mpre">CKX_RSA</span></span></a><span class="mpre"> </span><a name="loc_72_35_72_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_35_72_53&#39;)"><span class="hl_vardecl"><span class="mpre">encryptedPremaster</span></span></a><span class="mpre">) = do
    (</span><a name="loc_73_6_73_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_10&#39;)"><span class="hl_vardecl"><span class="mpre">rver</span></span></a><span class="mpre">, </span><a name="loc_73_12_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_12_73_16&#39;)"><span class="hl_vardecl"><span class="mpre">role</span></span></a><span class="mpre">, </span><a name="loc_73_18_73_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_18_73_24&#39;)"><span class="hl_vardecl"><span class="mpre">random</span></span></a><span class="mpre">) &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_72_22_72_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_22_72_25&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><span class="hl_conref"><span class="mpre">(,,)</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_165_1_165_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_165_1_165_11&#39;)"><span class="hl_varref"><span class="mpre">getVersion</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_204_1_204_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_204_1_204_16&#39;)"><span class="hl_varref"><span class="mpre">isClientContext</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_207_1_207_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_207_1_207_10&#39;)"><span class="hl_varref"><span class="mpre">genRandom</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">48</span></span><span class="mpre">
    </span><a name="loc_75_5_75_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_5_75_15&#39;)"><span class="hl_vardecl"><span class="mpre">ePremaster</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Handshake.Key.html#loc_49_1_49_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Key.html#loc_49_1_49_11&#39;)"><span class="hl_varref"><span class="mpre">decryptRSA</span></span></a><span class="mpre"> </span><a href="#loc_72_22_72_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_22_72_25&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_72_35_72_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_35_72_53&#39;)"><span class="hl_varref"><span class="mpre">encryptedPremaster</span></span></a><span class="mpre">
    </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_72_22_72_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_22_72_25&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><a name="loc_77_9_77_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_9_77_20&#39;)"><span class="hl_vardecl"><span class="mpre">expectedVer</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_63_7_63_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_63_7_63_23&#39;)"><span class="hl_varref"><span class="mpre">hstClientVersion</span></span></a><span class="mpre">
        case </span><a href="#loc_75_5_75_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_5_75_15&#39;)"><span class="hl_varref"><span class="mpre">ePremaster</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> _          -&gt; </span><a href="Network.TLS.Handshake.State.html#loc_193_1_193_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_193_1_193_23&#39;)"><span class="hl_varref"><span class="mpre">setMasterSecretFromPre</span></span></a><span class="mpre"> </span><a href="#loc_73_6_73_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_10&#39;)"><span class="hl_varref"><span class="mpre">rver</span></span></a><span class="mpre"> </span><a href="#loc_73_12_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_12_73_16&#39;)"><span class="hl_varref"><span class="mpre">role</span></span></a><span class="mpre"> </span><a href="#loc_73_18_73_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_18_73_24&#39;)"><span class="hl_varref"><span class="mpre">random</span></span></a><span class="mpre">
            </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a name="loc_80_19_80_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_19_80_28&#39;)"><span class="hl_vardecl"><span class="mpre">premaster</span></span></a><span class="mpre"> -&gt; case </span><a href="Network.TLS.Packet.html#loc_493_1_493_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Packet.html#loc_493_1_493_22&#39;)"><span class="hl_varref"><span class="mpre">decodePreMasterSecret</span></span></a><span class="mpre"> </span><a href="#loc_80_19_80_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_19_80_28&#39;)"><span class="hl_varref"><span class="mpre">premaster</span></span></a><span class="mpre"> of
                </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> _                   -&gt; </span><a href="Network.TLS.Handshake.State.html#loc_193_1_193_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_193_1_193_23&#39;)"><span class="hl_varref"><span class="mpre">setMasterSecretFromPre</span></span></a><span class="mpre"> </span><a href="#loc_73_6_73_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_10&#39;)"><span class="hl_varref"><span class="mpre">rver</span></span></a><span class="mpre"> </span><a href="#loc_73_12_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_12_73_16&#39;)"><span class="hl_varref"><span class="mpre">role</span></span></a><span class="mpre"> </span><a href="#loc_73_18_73_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_18_73_24&#39;)"><span class="hl_varref"><span class="mpre">random</span></span></a><span class="mpre">
                </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a name="loc_82_24_82_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_24_82_27&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre">, _)
                    | </span><a href="#loc_82_24_82_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_24_82_27&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="#loc_77_9_77_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_9_77_20&#39;)"><span class="hl_varref"><span class="mpre">expectedVer</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Handshake.State.html#loc_193_1_193_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_193_1_193_23&#39;)"><span class="hl_varref"><span class="mpre">setMasterSecretFromPre</span></span></a><span class="mpre"> </span><a href="#loc_73_6_73_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_10&#39;)"><span class="hl_varref"><span class="mpre">rver</span></span></a><span class="mpre"> </span><a href="#loc_73_12_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_12_73_16&#39;)"><span class="hl_varref"><span class="mpre">role</span></span></a><span class="mpre"> </span><a href="#loc_73_18_73_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_18_73_24&#39;)"><span class="hl_varref"><span class="mpre">random</span></span></a><span class="mpre">
                    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">          -&gt; </span><a href="Network.TLS.Handshake.State.html#loc_193_1_193_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_193_1_193_23&#39;)"><span class="hl_varref"><span class="mpre">setMasterSecretFromPre</span></span></a><span class="mpre"> </span><a href="#loc_73_6_73_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_6_73_10&#39;)"><span class="hl_varref"><span class="mpre">rver</span></span></a><span class="mpre"> </span><a href="#loc_73_12_73_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_12_73_16&#39;)"><span class="hl_varref"><span class="mpre">role</span></span></a><span class="mpre"> </span><a href="#loc_80_19_80_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_19_80_28&#39;)"><span class="hl_varref"><span class="mpre">premaster</span></span></a><span class="mpre">
</span><a href="#loc_72_1_72_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_1_72_21&#39;)"><span class="hl_fundecl"><span class="mpre">processClientKeyXchg</span></span></a><span class="mpre"> </span><a name="loc_85_22_85_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_22_85_25&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_247_7_247_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_247_7_247_13&#39;)"><span class="hl_conref"><span class="mpre">CKX_DH</span></span></a><span class="mpre"> </span><a name="loc_85_34_85_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_34_85_47&#39;)"><span class="hl_vardecl"><span class="mpre">clientDHValue</span></span></a><span class="mpre">) = do
    </span><a name="loc_86_5_86_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_9&#39;)"><span class="hl_vardecl"><span class="mpre">rver</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_85_22_85_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_22_85_25&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_165_1_165_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_165_1_165_11&#39;)"><span class="hl_varref"><span class="mpre">getVersion</span></span></a><span class="mpre">
    </span><a name="loc_87_5_87_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_9&#39;)"><span class="hl_vardecl"><span class="mpre">role</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_85_22_85_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_22_85_25&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_204_1_204_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_204_1_204_16&#39;)"><span class="hl_varref"><span class="mpre">isClientContext</span></span></a><span class="mpre">

    (</span><a href="Network.TLS.Struct.html#loc_226_23_226_37" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_226_23_226_37&#39;)"><span class="hl_conref"><span class="mpre">ServerDHParams</span></span></a><span class="mpre"> </span><a name="loc_89_21_89_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_21_89_29&#39;)"><span class="hl_vardecl"><span class="mpre">dhparams</span></span></a><span class="mpre"> _) &lt;- </span><a href="Network.TLS.Util.html#loc_53_1_53_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_53_1_53_9&#39;)"><span class="hl_varref"><span class="mpre">fromJust</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;server dh params&quot;</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_85_22_85_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_22_85_25&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_68_7_68_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_68_7_68_24&#39;)"><span class="hl_varref"><span class="mpre">hstServerDHParams</span></span></a><span class="mpre">)
    </span><a name="loc_90_5_90_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_11&#39;)"><span class="hl_vardecl"><span class="mpre">dhpriv</span></span></a><span class="mpre">                      &lt;- </span><a href="Network.TLS.Util.html#loc_53_1_53_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_53_1_53_9&#39;)"><span class="hl_varref"><span class="mpre">fromJust</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;dh private&quot;</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_85_22_85_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_22_85_25&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_69_7_69_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_69_7_69_19&#39;)"><span class="hl_varref"><span class="mpre">hstDHPrivate</span></span></a><span class="mpre">)
    let </span><a name="loc_91_9_91_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_9_91_18&#39;)"><span class="hl_vardecl"><span class="mpre">premaster</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Crypto.DH.html#loc_45_1_45_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Crypto.DH.html#loc_45_1_45_12&#39;)"><span class="hl_varref"><span class="mpre">dhGetShared</span></span></a><span class="mpre"> </span><a href="#loc_89_21_89_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_21_89_29&#39;)"><span class="hl_varref"><span class="mpre">dhparams</span></span></a><span class="mpre"> </span><a href="#loc_90_5_90_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_11&#39;)"><span class="hl_varref"><span class="mpre">dhpriv</span></span></a><span class="mpre"> </span><a href="#loc_85_34_85_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_34_85_47&#39;)"><span class="hl_varref"><span class="mpre">clientDHValue</span></span></a><span class="mpre">
    </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_85_22_85_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_22_85_25&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_193_1_193_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_193_1_193_23&#39;)"><span class="hl_varref"><span class="mpre">setMasterSecretFromPre</span></span></a><span class="mpre"> </span><a href="#loc_86_5_86_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_9&#39;)"><span class="hl_varref"><span class="mpre">rver</span></span></a><span class="mpre"> </span><a href="#loc_87_5_87_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_9&#39;)"><span class="hl_varref"><span class="mpre">role</span></span></a><span class="mpre"> </span><a href="#loc_91_9_91_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_9_91_18&#39;)"><span class="hl_varref"><span class="mpre">premaster</span></span></a><span class="mpre">

</span><a href="#loc_95_1_95_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_1_95_22&#39;)"><span class="mpre">processClientFinished</span></a><span class="mpre"> :: </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">FinishedData</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_95_1_95_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_1_95_22&#39;)"><span class="hl_fundecl"><span class="mpre">processClientFinished</span></span></a><span class="mpre"> </span><a name="loc_95_23_95_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_23_95_26&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_95_27_95_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_27_95_32&#39;)"><span class="hl_vardecl"><span class="mpre">fdata</span></span></a><span class="mpre"> = do
    (</span><a name="loc_96_6_96_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_6_96_8&#39;)"><span class="hl_vardecl"><span class="mpre">cc</span></span></a><span class="mpre">,</span><a name="loc_96_9_96_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_9_96_12&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre">) &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_95_23_95_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_23_95_26&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">(,)</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_204_1_204_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_204_1_204_16&#39;)"><span class="hl_varref"><span class="mpre">isClientContext</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;*&gt;</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_165_1_165_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_165_1_165_11&#39;)"><span class="hl_varref"><span class="mpre">getVersion</span></span></a><span class="mpre">
    </span><a name="loc_97_5_97_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_5_97_13&#39;)"><span class="hl_vardecl"><span class="mpre">expected</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_95_23_95_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_23_95_26&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_178_1_178_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_178_1_178_19&#39;)"><span class="hl_varref"><span class="mpre">getHandshakeDigest</span></span></a><span class="mpre"> </span><a href="#loc_96_9_96_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_9_96_12&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_52_1_52_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_52_1_52_11&#39;)"><span class="hl_varref"><span class="mpre">invertRole</span></span></a><span class="mpre"> </span><a href="#loc_96_6_96_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_6_96_8&#39;)"><span class="hl_varref"><span class="mpre">cc</span></span></a><span class="mpre">
    </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_97_5_97_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_5_97_13&#39;)"><span class="hl_varref"><span class="mpre">expected</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="#loc_95_27_95_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_27_95_32&#39;)"><span class="hl_varref"><span class="mpre">fdata</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><a href="Network.TLS.Context.Internal.html#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_123_7_123_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_123_7_123_21&#39;)"><span class="hl_conref"><span class="mpre">Error_Protocol</span></span></a><span class="mpre">(</span><span class="hl_string"><span class="mpre">&quot;bad record mac&quot;</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="Network.TLS.Struct.html#loc_184_7_184_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_184_7_184_19&#39;)"><span class="hl_conref"><span class="mpre">BadRecordMac</span></span></a><span class="mpre">)
    </span><a href="Network.TLS.Context.Internal.html#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_95_23_95_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_23_95_26&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.State.html#loc_108_1_108_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_108_1_108_19&#39;)"><span class="hl_varref"><span class="mpre">updateVerifiedData</span></span></a><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_26_44_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_26_44_36&#39;)"><span class="hl_conref"><span class="mpre">ServerRole</span></span></a><span class="mpre"> </span><a href="#loc_95_27_95_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_27_95_32&#39;)"><span class="hl_varref"><span class="mpre">fdata</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><a href="#loc_104_1_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_15&#39;)"><span class="mpre">startHandshake</span></a><span class="mpre"> :: </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Types.html#loc_25_6_25_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_6_25_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Struct.html#loc_160_9_160_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_160_9_160_21&#39;)"><span class="hl_tyconref"><span class="mpre">ClientRandom</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_104_1_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_15&#39;)"><span class="hl_fundecl"><span class="mpre">startHandshake</span></span></a><span class="mpre"> </span><a name="loc_104_16_104_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_16_104_19&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_104_20_104_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_20_104_23&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a name="loc_104_24_104_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_24_104_29&#39;)"><span class="hl_vardecl"><span class="mpre">crand</span></span></a><span class="mpre"> = do
    </span><span class="hl_comment"><span class="mpre">-- FIXME check if handshake is already not null</span></span><span class="mpre">
    </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Concurrent.MVar.html#loc_216_1_216_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_216_1_216_12&#39;)"><span class="hl_varref"><span class="mpre">modifyMVar_</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Context.Internal.html#loc_100_7_100_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_100_7_100_19&#39;)"><span class="hl_varref"><span class="mpre">ctxHandshake</span></span></a><span class="mpre"> </span><a href="#loc_104_16_104_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_16_104_19&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_106_48_106_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_48_106_50&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> -&gt;
        case </span><a href="#loc_106_48_106_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_48_106_50&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_98_1_98_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_98_1_98_18&#39;)"><span class="hl_varref"><span class="mpre">newEmptyHandshake</span></span></a><span class="mpre"> </span><a href="#loc_104_20_104_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_20_104_23&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_104_24_104_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_24_104_29&#39;)"><span class="hl_varref"><span class="mpre">crand</span></span></a><span class="mpre">
            </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> _  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_106_48_106_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_48_106_50&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">
</span></div></body></html>