<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE OverloadedStrings #-}
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Data.PEM.Writer</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Data.PEM.Writer
    ( pemWriteLBS
    , pemWriteBS
    ) where

import Data.PEM.Types
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pem-0.2.2/Data/PEM/Writer.hs&quot;, srcSpanStartLine = 15, srcSpanStartColumn = 8, srcSpanEndLine = 15, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pem-0.2.2/Data/PEM/Writer.hs&quot;, srcSpanStartLine = 16, srcSpanStartColumn = 18, srcSpanEndLine = 16, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pem-0.2.2/Data/PEM/Writer.hs&quot;, srcSpanStartLine = 17, srcSpanStartColumn = 18, srcSpanEndLine = 17, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as BC
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/pem-0.2.2/Data/PEM/Writer.hs&quot;, srcSpanStartLine = 18, srcSpanStartColumn = 18, srcSpanEndLine = 18, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L
import qualified Data.ByteString.Base64 as Base64

</span><span class="hl_comment"><span class="mpre">-- | write a PEM structure to a builder</span></span><span class="mpre">
</span><a href="#loc_23_1_23_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_9&#39;)"><span class="mpre">pemWrite</span></a><span class="mpre"> :: </span><a href="Data.PEM.Types.html#loc_16_6_16_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.PEM.Types.html#loc_16_6_16_9&#39;)"><span class="hl_tyconref"><span class="mpre">PEM</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre">
</span><a name="loc_23_1_23_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_9&#39;)"><span class="hl_fundecl"><span class="mpre">pemWrite</span></span></a><span class="mpre"> </span><a name="loc_23_10_23_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_10_23_13&#39;)"><span class="hl_vardecl"><span class="mpre">pem</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">L.fromChunks</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> ([</span><a href="#loc_24_11_24_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_11_24_16&#39;)"><span class="hl_varref"><span class="mpre">begin</span></span></a><span class="mpre">,</span><a href="#loc_29_11_29_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_11_29_17&#39;)"><span class="hl_varref"><span class="mpre">header</span></span></a><span class="mpre">]</span><span class="hl_infix"><span class="mpre">++</span></span><a href="#loc_27_11_27_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_11_27_18&#39;)"><span class="hl_varref"><span class="mpre">section</span></span></a><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">[</span><a href="#loc_25_11_25_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_11_25_14&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre">])
    where </span><a name="loc_24_11_24_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_11_24_16&#39;)"><span class="hl_vardecl"><span class="mpre">begin</span></span></a><span class="mpre">   = </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> [</span><span class="hl_string"><span class="mpre">&quot;-----BEGIN &quot;</span></span><span class="mpre">, </span><a href="#loc_35_11_35_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_11_35_22&#39;)"><span class="hl_varref"><span class="mpre">sectionName</span></span></a><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;-----\n&quot;</span></span><span class="mpre">]
          </span><a name="loc_25_11_25_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_11_25_14&#39;)"><span class="hl_vardecl"><span class="mpre">end</span></span></a><span class="mpre">     = </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> [</span><span class="hl_string"><span class="mpre">&quot;-----END &quot;</span></span><span class="mpre">, </span><a href="#loc_35_11_35_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_11_35_22&#39;)"><span class="hl_varref"><span class="mpre">sectionName</span></span></a><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;-----\n&quot;</span></span><span class="mpre"> ]
          </span><a href="#loc_27_11_27_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_11_27_18&#39;)"><span class="mpre">section</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">]
          </span><a name="loc_27_11_27_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_11_27_18&#39;)"><span class="hl_vardecl"><span class="mpre">section</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_36_11_36_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_21&#39;)"><span class="hl_varref"><span class="mpre">encodeLine</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_38_11_38_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_11_38_22&#39;)"><span class="hl_varref"><span class="mpre">splitChunks</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.PEM.Types.html#loc_19_11_19_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.PEM.Types.html#loc_19_11_19_21&#39;)"><span class="hl_varref"><span class="mpre">pemContent</span></span></a><span class="mpre"> </span><a href="#loc_23_10_23_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_10_23_13&#39;)"><span class="hl_varref"><span class="mpre">pem</span></span></a><span class="mpre">
          </span><a href="#loc_29_11_29_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_11_29_17&#39;)"><span class="mpre">header</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
          </span><a name="loc_29_11_29_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_11_29_17&#39;)"><span class="hl_vardecl"><span class="mpre">header</span></span></a><span class="mpre">  = if </span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.PEM.Types.html#loc_18_11_18_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.PEM.Types.html#loc_18_11_18_20&#39;)"><span class="hl_varref"><span class="mpre">pemHeader</span></span></a><span class="mpre"> </span><a href="#loc_23_10_23_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_10_23_13&#39;)"><span class="hl_varref"><span class="mpre">pem</span></span></a><span class="mpre">
                        then </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">
                        else </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> ((</span><span class="hl_varref"><span class="mpre">concatMap</span></span><span class="mpre"> </span><a href="#loc_33_11_33_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_11_33_19&#39;)"><span class="hl_varref"><span class="mpre">toHeader</span></span></a><span class="mpre"> (</span><a href="Data.PEM.Types.html#loc_18_11_18_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.PEM.Types.html#loc_18_11_18_20&#39;)"><span class="hl_varref"><span class="mpre">pemHeader</span></span></a><span class="mpre"> </span><a href="#loc_23_10_23_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_10_23_13&#39;)"><span class="hl_varref"><span class="mpre">pem</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> [</span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">])
          </span><a href="#loc_33_11_33_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_11_33_19&#39;)"><span class="mpre">toHeader</span></a><span class="mpre"> :: (</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">) -&gt; [</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">]
          </span><a name="loc_33_11_33_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_11_33_19&#39;)"><span class="hl_fundecl"><span class="mpre">toHeader</span></span></a><span class="mpre"> (</span><a name="loc_33_21_33_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_21_33_22&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre">,</span><a name="loc_33_23_33_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_23_33_24&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre">) = [ </span><span class="hl_varref"><span class="mpre">BC.pack</span></span><span class="mpre"> </span><a href="#loc_33_21_33_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_21_33_22&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;:&quot;</span></span><span class="mpre">, </span><a href="#loc_33_23_33_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_23_33_24&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre"> ]
          </span><span class="hl_comment"><span class="mpre">-- expect only ASCII. need to find a type to represent it.</span></span><span class="mpre">
          </span><a name="loc_35_11_35_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_11_35_22&#39;)"><span class="hl_vardecl"><span class="mpre">sectionName</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">BC.pack</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.PEM.Types.html#loc_17_11_17_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.PEM.Types.html#loc_17_11_17_18&#39;)"><span class="hl_varref"><span class="mpre">pemName</span></span></a><span class="mpre"> </span><a href="#loc_23_10_23_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_10_23_13&#39;)"><span class="hl_varref"><span class="mpre">pem</span></span></a><span class="mpre">
          </span><a name="loc_36_11_36_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_21&#39;)"><span class="hl_fundecl"><span class="mpre">encodeLine</span></span></a><span class="mpre"> </span><a name="loc_36_22_36_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_22_36_23&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Base64.html#loc_34_1_34_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Base64.html#loc_34_1_34_7&#39;)"><span class="hl_varref"><span class="mpre">Base64.encode</span></span></a><span class="mpre"> </span><a href="#loc_36_22_36_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_22_36_23&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`B.append`</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">

          </span><a name="loc_38_11_38_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_11_38_22&#39;)"><span class="hl_fundecl"><span class="mpre">splitChunks</span></span></a><span class="mpre"> </span><a name="loc_38_23_38_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_23_38_24&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">
                  | </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_38_23_38_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_23_38_24&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">48</span></span><span class="mpre"> = let (</span><a name="loc_39_44_39_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_44_39_45&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">,</span><a name="loc_39_46_39_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_46_39_47&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">B.splitAt</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">48</span></span><span class="mpre"> </span><a href="#loc_38_23_38_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_23_38_24&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> in </span><a href="#loc_39_44_39_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_44_39_45&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_38_11_38_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_11_38_22&#39;)"><span class="hl_varref"><span class="mpre">splitChunks</span></span></a><span class="mpre"> </span><a href="#loc_39_46_39_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_46_39_47&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">
                  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">       = [</span><a href="#loc_38_23_38_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_23_38_24&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">]

</span><span class="hl_comment"><span class="mpre">-- | convert a PEM structure to a bytestring</span></span><span class="mpre">
</span><a href="#loc_44_1_44_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_11&#39;)"><span class="mpre">pemWriteBS</span></a><span class="mpre"> :: </span><a href="Data.PEM.Types.html#loc_16_6_16_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.PEM.Types.html#loc_16_6_16_9&#39;)"><span class="hl_tyconref"><span class="mpre">PEM</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_44_1_44_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_11&#39;)"><span class="hl_vardecl"><span class="mpre">pemWriteBS</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.toChunks</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_23_1_23_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_9&#39;)"><span class="hl_varref"><span class="mpre">pemWrite</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | convert a PEM structure to a lazy bytestring</span></span><span class="mpre">
</span><a href="#loc_48_1_48_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_1_48_12&#39;)"><span class="mpre">pemWriteLBS</span></a><span class="mpre"> :: </span><a href="Data.PEM.Types.html#loc_16_6_16_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.PEM.Types.html#loc_16_6_16_9&#39;)"><span class="hl_tyconref"><span class="mpre">PEM</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre">
</span><a name="loc_48_1_48_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_1_48_12&#39;)"><span class="hl_vardecl"><span class="mpre">pemWriteLBS</span></span></a><span class="mpre"> = </span><a href="#loc_23_1_23_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_9&#39;)"><span class="hl_varref"><span class="mpre">pemWrite</span></span></a><span class="mpre">
</span></div></body></html>