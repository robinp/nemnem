<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE RecordWildCards #-}

</span><span class="hl_comment"><span class="mpre">-- NOTE: Due to https://github.com/yesodweb/wai/issues/192, this module should</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- not use CPP.</span></span><span class="mpre">
module Network.Wai.Middleware.RequestLogger
    ( </span><span class="hl_comment"><span class="mpre">-- * Basic stdout logging</span></span><span class="mpre">
      logStdout
    , logStdoutDev
      </span><span class="hl_comment"><span class="mpre">-- * Create more versions</span></span><span class="mpre">
    , mkRequestLogger
    , RequestLoggerSettings
    , outputFormat
    , autoFlush
    , destination
    , OutputFormat (..)
    , OutputFormatter
    , Destination (..)
    , Callback
    , IPAddrSource (..)
    ) where

import System.IO (</span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="mpre">Handle</span></a><span class="mpre">, </span><a href="GHC.IO.Handle.FD.html#loc_63_1_63_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.FD.html#loc_63_1_63_7&#39;)"><span class="mpre">stdout</span></a><span class="mpre">)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 18, srcSpanEndLine = 24, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as BS
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 25, srcSpanStartColumn = 8, srcSpanEndLine = 25, srcSpanEndColumn = 29}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> (pack, unpack)
import Control.Monad.IO.Class (</span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="mpre">liftIO</span></a><span class="mpre">)
import Network.Wai (</span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="mpre">Request</span></a><span class="mpre">(..), Middleware, </span><a href="Network.Wai.html#loc_180_1_180_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_180_1_180_15&#39;)"><span class="mpre">responseStatus</span></a><span class="mpre">, </span><a href="Network.Wai.Internal.html#loc_74_6_74_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_74_6_74_14&#39;)"><span class="mpre">Response</span></a><span class="mpre">, </span><a href="Network.Wai.html#loc_187_1_187_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_187_1_187_16&#39;)"><span class="mpre">responseHeaders</span></a><span class="mpre">)
import System.Log.FastLogger
import Network.HTTP.Types as H
import Data.Maybe (</span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="mpre">fromMaybe</span></a><span class="mpre">)
import Data.Monoid (</span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="mpre">mconcat</span></a><span class="mpre">)

import Network.Wai.Parse (</span><a href="Network.Wai.Parse.html#loc_186_1_186_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Parse.html#loc_186_1_186_16&#39;)"><span class="mpre">sinkRequestBody</span></a><span class="mpre">, </span><a href="Network.Wai.Parse.html#loc_80_1_80_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Parse.html#loc_80_1_80_11&#39;)"><span class="mpre">lbsBackEnd</span></a><span class="mpre">, </span><a href="Network.Wai.Parse.html#loc_120_7_120_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Parse.html#loc_120_7_120_15&#39;)"><span class="mpre">fileName</span></a><span class="mpre">, Param, File, </span><a href="Network.Wai.Parse.html#loc_142_1_142_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Parse.html#loc_142_1_142_19&#39;)"><span class="mpre">getRequestBodyType</span></a><span class="mpre">)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 34, srcSpanStartColumn = 18, srcSpanEndLine = 34, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as LBS
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 35, srcSpanStartColumn = 18, srcSpanEndLine = 35, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as S8

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 37, srcSpanStartColumn = 8, srcSpanEndLine = 37, srcSpanEndColumn = 27}, srcInfoPoints = []}) &quot;System.Console.ANSI&quot;"><span class="mpre">System.Console.ANSI</span></span><span class="mpre">
import Data.IORef.Lifted
import System.IO.Unsafe
import Control.Monad (</span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="mpre">unless</span></a><span class="mpre">)
import Network.Wai.Internal (</span><a href="Network.Wai.Internal.html#loc_74_6_74_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_74_6_74_14&#39;)"><span class="mpre">Response</span></a><span class="mpre"> (</span><a href="Network.Wai.Internal.html#loc_78_7_78_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_78_7_78_18&#39;)"><span class="mpre">ResponseRaw</span></a><span class="mpre">))

import Data.Default.Class (</span><a href="Data.Default.Class.html#loc_38_7_38_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Default.Class.html#loc_38_7_38_14&#39;)"><span class="mpre">Default</span></a><span class="mpre"> (</span><a href="Data.Default.Class.html#loc_40_5_40_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Default.Class.html#loc_40_5_40_8&#39;)"><span class="mpre">def</span></a><span class="mpre">))
import Network.Wai.Logger
import Network.Wai.Middleware.RequestLogger.Internal

data </span><a name="loc_47_6_47_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_6_47_18&#39;)"><span class="hl_tycondecl"><span class="mpre">OutputFormat</span></span></a><span class="mpre"> = </span><a name="loc_47_21_47_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_21_47_27&#39;)"><span class="hl_condecl"><span class="mpre">Apache</span></span></a><span class="mpre"> </span><a href="Network.Wai.Logger.Apache.html#loc_33_6_33_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Logger.Apache.html#loc_33_6_33_18&#39;)"><span class="hl_tyconref"><span class="mpre">IPAddrSource</span></span></a><span class="mpre">
                  | </span><a name="loc_48_21_48_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_21_48_29&#39;)"><span class="hl_condecl"><span class="mpre">Detailed</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ use colors?</span></span><span class="mpre">
                  | </span><a name="loc_49_21_49_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_21_49_39&#39;)"><span class="hl_condecl"><span class="mpre">CustomOutputFormat</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">OutputFormatter</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 51, srcSpanStartColumn = 1, srcSpanEndLine = 51, srcSpanEndColumn = 81}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 51, srcSpanStartColumn = 1, srcSpanEndLine = 51, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3."><span class="mpre">type OutputFormatter = ZonedDate -&gt; Request -&gt; Status -&gt; Maybe Integer -&gt; LogStr</span></span><span class="mpre">

data </span><a name="loc_53_6_53_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_6_53_17&#39;)"><span class="hl_tycondecl"><span class="mpre">Destination</span></span></a><span class="mpre"> = </span><a name="loc_53_20_53_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_20_53_26&#39;)"><span class="hl_condecl"><span class="mpre">Handle</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre">
                 | </span><a name="loc_54_20_54_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_20_54_26&#39;)"><span class="hl_condecl"><span class="mpre">Logger</span></span></a><span class="mpre"> </span><a href="System.Log.FastLogger.html#loc_57_6_57_15" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Log.FastLogger.html#loc_57_6_57_15&#39;)"><span class="hl_tyconref"><span class="mpre">LoggerSet</span></span></a><span class="mpre">
                 | </span><a name="loc_55_20_55_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_20_55_28&#39;)"><span class="hl_condecl"><span class="mpre">Callback</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Callback</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 57, srcSpanStartColumn = 1, srcSpanEndLine = 57, srcSpanEndColumn = 32}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 57, srcSpanStartColumn = 1, srcSpanEndLine = 57, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3."><span class="mpre">type Callback = LogStr -&gt; IO ()</span></span><span class="mpre">

data </span><a name="loc_59_6_59_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_6_59_27&#39;)"><span class="hl_tycondecl"><span class="mpre">RequestLoggerSettings</span></span></a><span class="mpre"> = </span><span class="hl_condecl"><span class="mpre">RequestLoggerSettings</span></span><span class="mpre">
    {
      </span><span class="hl_comment"><span class="mpre">-- | Default value: @Detailed@ @True@.</span></span><span class="mpre">
      </span><a name="loc_62_7_62_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_7_62_19&#39;)"><span class="hl_fielddecl"><span class="mpre">outputFormat</span></span></a><span class="mpre"> :: </span><a href="#loc_47_6_47_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_6_47_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputFormat</span></span></a><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">-- | Only applies when using the @Handle@ constructor for @destination@.</span></span><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">-- Default value: @True@.</span></span><span class="mpre">
    , </span><a name="loc_66_7_66_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_7_66_16&#39;)"><span class="hl_fielddecl"><span class="mpre">autoFlush</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">-- | Default: @Handle@ @stdout@.</span></span><span class="mpre">
    , </span><a name="loc_68_7_68_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_7_68_18&#39;)"><span class="hl_fielddecl"><span class="mpre">destination</span></span></a><span class="mpre"> :: </span><a href="#loc_53_6_53_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_6_53_17&#39;)"><span class="hl_tyconref"><span class="mpre">Destination</span></span></a><span class="mpre">
    }

instance </span><a href="Data.Default.Class.html#loc_38_7_38_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Default.Class.html#loc_38_7_38_14&#39;)"><span class="hl_classref"><span class="mpre">Default</span></span></a><span class="mpre"> </span><a href="#loc_59_6_59_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_6_59_27&#39;)"><span class="hl_tyconref"><span class="mpre">RequestLoggerSettings</span></span></a><span class="mpre"> where
    </span><a href="Data.Default.Class.html#loc_40_5_40_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Default.Class.html#loc_40_5_40_8&#39;)"><span class="hl_vardecl"><span class="mpre">def</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 72, srcSpanStartColumn = 11, srcSpanEndLine = 76, srcSpanEndColumn = 10}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 73, srcSpanStartColumn = 9, srcSpanEndLine = 73, srcSpanEndColumn = 10},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra"><span class="mpre">RequestLoggerSettings
        { outputFormat = Detailed True
        , autoFlush = True
        , destination = Handle stdout
        }</span></span><span class="mpre">

</span><a href="#loc_79_1_79_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_16&#39;)"><span class="mpre">mkRequestLogger</span></a><span class="mpre"> :: </span><a href="#loc_59_6_59_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_6_59_27&#39;)"><span class="hl_tyconref"><span class="mpre">RequestLoggerSettings</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Middleware</span></span><span class="mpre">
</span><a name="loc_79_1_79_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_16&#39;)"><span class="hl_fundecl"><span class="mpre">mkRequestLogger</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 79, srcSpanStartColumn = 17, srcSpanEndLine = 79, srcSpanEndColumn = 42}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 79, srcSpanStartColumn = 38, srcSpanEndLine = 79, srcSpanEndColumn = 39},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0"><span class="mpre">RequestLoggerSettings{..}</span></span><span class="mpre"> = do
    let (</span><a name="loc_80_10_80_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_10_80_18&#39;)"><span class="hl_vardecl"><span class="mpre">callback</span></span></a><span class="mpre">, </span><a name="loc_80_20_80_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_20_80_27&#39;)"><span class="hl_vardecl"><span class="mpre">flusher</span></span></a><span class="mpre">) =
            case </span><a href="#loc_68_7_68_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_7_68_18&#39;)"><span class="hl_varref"><span class="mpre">destination</span></span></a><span class="mpre"> of
                </span><a href="#loc_53_20_53_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_20_53_26&#39;)"><span class="hl_conref"><span class="mpre">Handle</span></span></a><span class="mpre"> </span><a name="loc_82_24_82_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_24_82_25&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> -&gt; (</span><span class="hl_varref"><span class="mpre">BS.hPutStr</span></span><span class="mpre"> </span><a href="#loc_82_24_82_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_24_82_25&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">logToByteString</span></span><span class="mpre">, </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)
                </span><a href="#loc_54_20_54_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_20_54_26&#39;)"><span class="hl_conref"><span class="mpre">Logger</span></span></a><span class="mpre"> </span><a name="loc_83_24_83_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_24_83_25&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> -&gt; (</span><a href="System.Log.FastLogger.html#loc_92_1_92_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Log.FastLogger.html#loc_92_1_92_11&#39;)"><span class="hl_varref"><span class="mpre">pushLogStr</span></span></a><span class="mpre"> </span><a href="#loc_83_24_83_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_24_83_25&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">, </span><a href="System.Log.FastLogger.html#loc_108_1_108_12" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Log.FastLogger.html#loc_108_1_108_12&#39;)"><span class="hl_varref"><span class="mpre">flushLogStr</span></span></a><span class="mpre"> </span><a href="#loc_83_24_83_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_24_83_25&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">)
                </span><a href="#loc_55_20_55_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_20_55_28&#39;)"><span class="hl_conref"><span class="mpre">Callback</span></span></a><span class="mpre"> </span><a name="loc_84_26_84_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_26_84_27&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_84_26_84_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_26_84_27&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)
    case </span><a href="#loc_62_7_62_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_7_62_19&#39;)"><span class="hl_varref"><span class="mpre">outputFormat</span></span></a><span class="mpre"> of
        </span><a href="#loc_47_21_47_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_21_47_27&#39;)"><span class="hl_conref"><span class="mpre">Apache</span></span></a><span class="mpre"> </span><a name="loc_86_16_86_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_16_86_21&#39;)"><span class="hl_vardecl"><span class="mpre">ipsrc</span></span></a><span class="mpre"> -&gt; do
            </span><a name="loc_87_13_87_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_13_87_20&#39;)"><span class="hl_vardecl"><span class="mpre">getdate</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getDateGetter</span></span><span class="mpre"> </span><a href="#loc_80_20_80_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_20_80_27&#39;)"><span class="hl_varref"><span class="mpre">flusher</span></span></a><span class="mpre">
            </span><a name="loc_88_13_88_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_13_88_19&#39;)"><span class="hl_vardecl"><span class="mpre">apache</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Wai.Logger.html#loc_128_1_128_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Logger.html#loc_128_1_128_11&#39;)"><span class="hl_varref"><span class="mpre">initLogger</span></span></a><span class="mpre"> </span><a href="#loc_86_16_86_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_16_86_21&#39;)"><span class="hl_varref"><span class="mpre">ipsrc</span></span></a><span class="mpre"> (</span><a href="Network.Wai.Logger.html#loc_120_16_120_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Logger.html#loc_120_16_120_27&#39;)"><span class="hl_conref"><span class="mpre">LogCallback</span></span></a><span class="mpre"> </span><a href="#loc_80_10_80_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_10_80_18&#39;)"><span class="hl_varref"><span class="mpre">callback</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)) </span><a href="#loc_87_13_87_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_13_87_20&#39;)"><span class="hl_varref"><span class="mpre">getdate</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_98_1_98_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_17&#39;)"><span class="hl_varref"><span class="mpre">apacheMiddleware</span></span></a><span class="mpre"> </span><a href="#loc_88_13_88_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_13_88_19&#39;)"><span class="hl_varref"><span class="mpre">apache</span></span></a><span class="mpre">
        </span><a href="#loc_48_21_48_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_21_48_29&#39;)"><span class="hl_conref"><span class="mpre">Detailed</span></span></a><span class="mpre"> </span><a name="loc_90_18_90_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_18_90_27&#39;)"><span class="hl_vardecl"><span class="mpre">useColors</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_167_1_167_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_1_167_19&#39;)"><span class="hl_varref"><span class="mpre">detailedMiddleware</span></span></a><span class="mpre">
                                  (\</span><a name="loc_91_37_91_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_37_91_40&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_80_10_80_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_10_80_18&#39;)"><span class="hl_varref"><span class="mpre">callback</span></span></a><span class="mpre"> </span><a href="#loc_91_37_91_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_37_91_40&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_80_20_80_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_20_80_27&#39;)"><span class="hl_varref"><span class="mpre">flusher</span></span></a><span class="mpre">)
                                  </span><a href="#loc_90_18_90_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_18_90_27&#39;)"><span class="hl_varref"><span class="mpre">useColors</span></span></a><span class="mpre">
        </span><a href="#loc_49_21_49_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_21_49_39&#39;)"><span class="hl_conref"><span class="mpre">CustomOutputFormat</span></span></a><span class="mpre"> </span><a name="loc_93_28_93_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_28_93_37&#39;)"><span class="hl_vardecl"><span class="mpre">formatter</span></span></a><span class="mpre"> -&gt; do
            </span><a name="loc_94_13_94_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_13_94_20&#39;)"><span class="hl_vardecl"><span class="mpre">getdate</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getDateGetter</span></span><span class="mpre"> </span><a href="#loc_80_20_80_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_20_80_27&#39;)"><span class="hl_varref"><span class="mpre">flusher</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_108_1_108_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_17&#39;)"><span class="hl_varref"><span class="mpre">customMiddleware</span></span></a><span class="mpre"> </span><a href="#loc_80_10_80_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_10_80_18&#39;)"><span class="hl_varref"><span class="mpre">callback</span></span></a><span class="mpre"> </span><a href="#loc_94_13_94_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_13_94_20&#39;)"><span class="hl_varref"><span class="mpre">getdate</span></span></a><span class="mpre"> </span><a href="#loc_93_28_93_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_28_93_37&#39;)"><span class="hl_varref"><span class="mpre">formatter</span></span></a><span class="mpre">

</span><a href="#loc_98_1_98_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_17&#39;)"><span class="mpre">apacheMiddleware</span></a><span class="mpre"> :: </span><a href="Network.Wai.Logger.html#loc_96_6_96_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Logger.html#loc_96_6_96_25&#39;)"><span class="hl_tyconref"><span class="mpre">ApacheLoggerActions</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Middleware</span></span><span class="mpre">
</span><a name="loc_98_1_98_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_17&#39;)"><span class="hl_fundecl"><span class="mpre">apacheMiddleware</span></span></a><span class="mpre"> </span><a name="loc_98_18_98_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_18_98_21&#39;)"><span class="hl_vardecl"><span class="mpre">ala</span></span></a><span class="mpre"> </span><a name="loc_98_22_98_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_22_98_25&#39;)"><span class="hl_vardecl"><span class="mpre">app</span></span></a><span class="mpre"> </span><a name="loc_98_26_98_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_26_98_29&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> </span><a name="loc_98_30_98_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_30_98_42&#39;)"><span class="hl_vardecl"><span class="mpre">sendResponse</span></span></a><span class="mpre"> = </span><a href="#loc_98_22_98_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_22_98_25&#39;)"><span class="hl_varref"><span class="mpre">app</span></span></a><span class="mpre"> </span><a href="#loc_98_26_98_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_26_98_29&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_98_56_98_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_56_98_59&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> -&gt; do
    let </span><a name="loc_99_9_99_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_9_99_14&#39;)"><span class="hl_vardecl"><span class="mpre">msize</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;content-length&quot;</span></span><span class="mpre"> (</span><a href="Network.Wai.html#loc_187_1_187_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_187_1_187_16&#39;)"><span class="hl_varref"><span class="mpre">responseHeaders</span></span></a><span class="mpre"> </span><a href="#loc_98_56_98_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_56_98_59&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="#loc_100_9_100_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_9_100_17&#39;)"><span class="hl_varref"><span class="mpre">readInt&#39;</span></span></a><span class="mpre">
        </span><a name="loc_100_9_100_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_9_100_17&#39;)"><span class="hl_fundecl"><span class="mpre">readInt&#39;</span></span></a><span class="mpre"> </span><a name="loc_100_18_100_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_18_100_20&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> =
            case </span><span class="hl_varref"><span class="mpre">S8.readInteger</span></span><span class="mpre"> </span><a href="#loc_100_18_100_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_18_100_20&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> of
                </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a name="loc_102_23_102_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_23_102_24&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">) -&gt; </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_102_23_102_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_23_102_24&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
                _ -&gt; </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
    </span><a href="Network.Wai.Logger.html#loc_97_5_97_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Logger.html#loc_97_5_97_17&#39;)"><span class="hl_varref"><span class="mpre">apacheLogger</span></span></a><span class="mpre"> </span><a href="#loc_98_18_98_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_18_98_21&#39;)"><span class="hl_varref"><span class="mpre">ala</span></span></a><span class="mpre"> </span><a href="#loc_98_26_98_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_26_98_29&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> (</span><a href="Network.Wai.html#loc_180_1_180_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_180_1_180_15&#39;)"><span class="hl_varref"><span class="mpre">responseStatus</span></span></a><span class="mpre"> </span><a href="#loc_98_56_98_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_56_98_59&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">) </span><a href="#loc_99_9_99_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_9_99_14&#39;)"><span class="hl_varref"><span class="mpre">msize</span></span></a><span class="mpre">
    </span><a href="#loc_98_30_98_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_30_98_42&#39;)"><span class="hl_varref"><span class="mpre">sendResponse</span></span></a><span class="mpre"> </span><a href="#loc_98_56_98_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_56_98_59&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">

</span><a href="#loc_108_1_108_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_17&#39;)"><span class="mpre">customMiddleware</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Callback</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ZonedDate</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">OutputFormatter</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Middleware</span></span><span class="mpre">
</span><a name="loc_108_1_108_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_17&#39;)"><span class="hl_fundecl"><span class="mpre">customMiddleware</span></span></a><span class="mpre"> </span><a name="loc_108_18_108_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_18_108_20&#39;)"><span class="hl_vardecl"><span class="mpre">cb</span></span></a><span class="mpre"> </span><a name="loc_108_21_108_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_21_108_28&#39;)"><span class="hl_vardecl"><span class="mpre">getdate</span></span></a><span class="mpre"> </span><a name="loc_108_29_108_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_29_108_38&#39;)"><span class="hl_vardecl"><span class="mpre">formatter</span></span></a><span class="mpre"> </span><a name="loc_108_39_108_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_39_108_42&#39;)"><span class="hl_vardecl"><span class="mpre">app</span></span></a><span class="mpre"> </span><a name="loc_108_43_108_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_43_108_46&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> </span><a name="loc_108_47_108_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_47_108_59&#39;)"><span class="hl_vardecl"><span class="mpre">sendResponse</span></span></a><span class="mpre"> = </span><a href="#loc_108_39_108_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_39_108_42&#39;)"><span class="hl_varref"><span class="mpre">app</span></span></a><span class="mpre"> </span><a href="#loc_108_43_108_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_43_108_46&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_108_73_108_76" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_73_108_76&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_109_5_109_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_5_109_9&#39;)"><span class="hl_vardecl"><span class="mpre">date</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><a href="#loc_108_21_108_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_21_108_28&#39;)"><span class="hl_varref"><span class="mpre">getdate</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- We use Nothing for the response size since we generally don&#39;t know it</span></span><span class="mpre">
    </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_108_18_108_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_18_108_20&#39;)"><span class="hl_varref"><span class="mpre">cb</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_108_29_108_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_29_108_38&#39;)"><span class="hl_varref"><span class="mpre">formatter</span></span></a><span class="mpre"> </span><a href="#loc_109_5_109_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_5_109_9&#39;)"><span class="hl_varref"><span class="mpre">date</span></span></a><span class="mpre"> </span><a href="#loc_108_43_108_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_43_108_46&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> (</span><a href="Network.Wai.html#loc_180_1_180_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_180_1_180_15&#39;)"><span class="hl_varref"><span class="mpre">responseStatus</span></span></a><span class="mpre"> </span><a href="#loc_108_73_108_76" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_73_108_76&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">) </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
    </span><a href="#loc_108_47_108_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_47_108_59&#39;)"><span class="hl_varref"><span class="mpre">sendResponse</span></span></a><span class="mpre"> </span><a href="#loc_108_73_108_76" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_73_108_76&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Production request logger middleware.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Implemented on top of &quot;logCallback&quot;, but prints to &#39;stdout&#39;</span></span><span class="mpre">
</span><a href="#loc_117_1_117_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_10&#39;)"><span class="mpre">logStdout</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Middleware</span></span><span class="mpre">
</span><a name="loc_117_1_117_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_10&#39;)"><span class="hl_vardecl"><span class="mpre">logStdout</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_79_1_79_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_16&#39;)"><span class="hl_varref"><span class="mpre">mkRequestLogger</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 117, srcSpanStartColumn = 47, srcSpanEndLine = 117, srcSpanEndColumn = 87}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 117, srcSpanStartColumn = 51, srcSpanEndLine = 117, srcSpanEndColumn = 52},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-"><span class="mpre">def { outputFormat = Apache FromSocket }</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Development request logger middleware.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Implemented on top of &quot;logCallbackDev&quot;, but prints to &#39;stdout&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Flushes &#39;stdout&#39; on each request, which would be inefficient in production use.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Use &quot;logStdout&quot; in production.</span></span><span class="mpre">
</span><a href="#loc_125_1_125_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_1_125_13&#39;)"><span class="mpre">logStdoutDev</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Middleware</span></span><span class="mpre">
</span><a name="loc_125_1_125_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_1_125_13&#39;)"><span class="hl_vardecl"><span class="mpre">logStdoutDev</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_79_1_79_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_16&#39;)"><span class="hl_varref"><span class="mpre">mkRequestLogger</span></span></a><span class="mpre"> </span><a href="Data.Default.Class.html#loc_40_5_40_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Default.Class.html#loc_40_5_40_8&#39;)"><span class="hl_varref"><span class="mpre">def</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- no black or white which are expected to be existing terminal colors.</span></span><span class="mpre">
</span><a href="#loc_129_1_129_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_8&#39;)"><span class="mpre">colors0</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">Color</span></span><span class="mpre">]
</span><a name="loc_129_1_129_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_8&#39;)"><span class="hl_vardecl"><span class="mpre">colors0</span></span></a><span class="mpre"> = [
    </span><span class="hl_conref"><span class="mpre">Green</span></span><span class="mpre">
  , </span><span class="hl_conref"><span class="mpre">Yellow</span></span><span class="mpre">
  , </span><span class="hl_conref"><span class="mpre">Blue</span></span><span class="mpre">
  , </span><span class="hl_conref"><span class="mpre">Magenta</span></span><span class="mpre">
  , </span><span class="hl_conref"><span class="mpre">Cyan</span></span><span class="mpre">
  ]

</span><a href="#loc_138_1_138_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_13&#39;)"><span class="mpre">rotateColors</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">Color</span></span><span class="mpre">] -&gt; ([</span><span class="hl_tyconref"><span class="mpre">Color</span></span><span class="mpre">], </span><span class="hl_tyconref"><span class="mpre">Color</span></span><span class="mpre">)
</span><a name="loc_138_1_138_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_13&#39;)"><span class="hl_fundecl"><span class="mpre">rotateColors</span></span></a><span class="mpre"> [] = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Impossible! There must be colors!&quot;</span></span><span class="mpre">
</span><a href="#loc_138_1_138_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_13&#39;)"><span class="hl_fundecl"><span class="mpre">rotateColors</span></span></a><span class="mpre"> (</span><a name="loc_139_15_139_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_15_139_16&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_139_17_139_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_17_139_19&#39;)"><span class="hl_vardecl"><span class="mpre">cs</span></span></a><span class="mpre">) = (</span><a href="#loc_139_17_139_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_17_139_19&#39;)"><span class="hl_varref"><span class="mpre">cs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> [</span><a href="#loc_139_15_139_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_15_139_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">], </span><a href="#loc_139_15_139_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_15_139_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Prints a message using the given callback function for each request.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This is not for serious production use- it is inefficient.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- It immediately consumes a POST body and fills it back in and is otherwise inefficient</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that it logs the request immediately when it is received.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This meanst that you can accurately see the interleaving of requests.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- And if the app crashes you have still logged the request.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- However, if you are simulating 10 simultaneous users you may find this confusing.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The request and response are connected by color on Unix and also by the request path.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This is lower-level - use &#39;logStdoutDev&#39; unless you need greater control.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example ouput:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; GET search</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; Status: 200 OK. search</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; GET static/css/normalize.css</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; Accept: text/css,*/*;q=0.1</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; GET [(&quot;LXwioiBG&quot;,&quot;&quot;)]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; Status: 304 Not Modified. static/css/normalize.css</span></span><span class="mpre">

</span><a href="#loc_167_1_167_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_1_167_19&#39;)"><span class="mpre">detailedMiddleware</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Callback</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Middleware</span></span><span class="mpre">
</span><a name="loc_167_1_167_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_1_167_19&#39;)"><span class="hl_fundecl"><span class="mpre">detailedMiddleware</span></span></a><span class="mpre"> </span><a name="loc_167_20_167_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_20_167_22&#39;)"><span class="hl_vardecl"><span class="mpre">cb</span></span></a><span class="mpre"> </span><a name="loc_167_23_167_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_23_167_32&#39;)"><span class="hl_vardecl"><span class="mpre">useColors</span></span></a><span class="mpre"> = do
    </span><a name="loc_168_5_168_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_5_168_16&#39;)"><span class="hl_vardecl"><span class="mpre">getAddColor</span></span></a><span class="mpre"> &lt;-
        if </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><a href="#loc_167_23_167_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_23_167_32&#39;)"><span class="hl_varref"><span class="mpre">useColors</span></span></a><span class="mpre"> then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre">) else do
                </span><a name="loc_170_17_170_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_17_170_24&#39;)"><span class="hl_vardecl"><span class="mpre">icolors</span></span></a><span class="mpre"> &lt;- </span><a href="Data.IORef.Lifted.html#loc_63_1_63_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.Lifted.html#loc_63_1_63_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_129_1_129_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_8&#39;)"><span class="hl_varref"><span class="mpre">colors0</span></span></a><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
                    </span><a name="loc_172_21_172_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_21_172_26&#39;)"><span class="hl_vardecl"><span class="mpre">color</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.IORef.Lifted.html#loc_83_1_83_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.Lifted.html#loc_83_1_83_18&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef</span></span></a><span class="mpre"> </span><a href="#loc_170_17_170_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_17_170_24&#39;)"><span class="hl_varref"><span class="mpre">icolors</span></span></a><span class="mpre"> </span><a href="#loc_138_1_138_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_13&#39;)"><span class="hl_varref"><span class="mpre">rotateColors</span></span></a><span class="mpre">
                    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_177_1_177_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_10&#39;)"><span class="hl_varref"><span class="mpre">ansiColor</span></span></a><span class="mpre"> </span><a href="#loc_172_21_172_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_21_172_26&#39;)"><span class="hl_varref"><span class="mpre">color</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_186_1_186_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_1_186_20&#39;)"><span class="hl_varref"><span class="mpre">detailedMiddleware&#39;</span></span></a><span class="mpre"> </span><a href="#loc_167_20_167_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_20_167_22&#39;)"><span class="hl_varref"><span class="mpre">cb</span></span></a><span class="mpre"> </span><a href="#loc_168_5_168_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_5_168_16&#39;)"><span class="hl_varref"><span class="mpre">getAddColor</span></span></a><span class="mpre">

</span><a href="#loc_177_1_177_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_10&#39;)"><span class="mpre">ansiColor</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Color</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">BS.ByteString</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">BS.ByteString</span></span><span class="mpre">]
</span><a name="loc_177_1_177_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_10&#39;)"><span class="hl_fundecl"><span class="mpre">ansiColor</span></span></a><span class="mpre"> </span><a name="loc_177_11_177_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_11_177_16&#39;)"><span class="hl_vardecl"><span class="mpre">color</span></span></a><span class="mpre"> </span><a name="loc_177_17_177_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_17_177_19&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = [
    </span><span class="hl_varref"><span class="mpre">pack</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">setSGRCode</span></span><span class="mpre"> [</span><span class="hl_conref"><span class="mpre">SetColor</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Foreground</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Vivid</span></span><span class="mpre"> </span><a href="#loc_177_11_177_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_11_177_16&#39;)"><span class="hl_varref"><span class="mpre">color</span></span></a><span class="mpre">]
  , </span><a href="#loc_177_17_177_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_17_177_19&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
  , </span><span class="hl_varref"><span class="mpre">pack</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">setSGRCode</span></span><span class="mpre"> [</span><span class="hl_conref"><span class="mpre">Reset</span></span><span class="mpre">]
  ]

</span><a href="#loc_186_1_186_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_1_186_20&#39;)"><span class="mpre">detailedMiddleware&#39;</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Callback</span></span><span class="mpre">
                    -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">BS.ByteString</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">BS.ByteString</span></span><span class="mpre">])
                    -&gt; </span><span class="hl_tyconref"><span class="mpre">Middleware</span></span><span class="mpre">
</span><a name="loc_186_1_186_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_1_186_20&#39;)"><span class="hl_fundecl"><span class="mpre">detailedMiddleware&#39;</span></span></a><span class="mpre"> </span><a name="loc_186_21_186_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_21_186_23&#39;)"><span class="hl_vardecl"><span class="mpre">cb</span></span></a><span class="mpre"> </span><a name="loc_186_24_186_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_24_186_35&#39;)"><span class="hl_vardecl"><span class="mpre">getAddColor</span></span></a><span class="mpre"> </span><a name="loc_186_36_186_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_36_186_39&#39;)"><span class="hl_vardecl"><span class="mpre">app</span></span></a><span class="mpre"> </span><a name="loc_186_40_186_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_40_186_43&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> </span><a name="loc_186_44_186_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_44_186_56&#39;)"><span class="hl_vardecl"><span class="mpre">sendResponse</span></span></a><span class="mpre"> = do
    let </span><a name="loc_187_9_187_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_9_187_13&#39;)"><span class="hl_vardecl"><span class="mpre">mlen</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;content-length&quot;</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">requestHeaders</span></span><span class="mpre"> </span><a href="#loc_186_40_186_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_40_186_43&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="#loc_280_5_280_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_5_280_12&#39;)"><span class="hl_varref"><span class="mpre">readInt</span></span></a><span class="mpre">
    (</span><a name="loc_188_6_188_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_6_188_10&#39;)"><span class="hl_vardecl"><span class="mpre">req&#39;</span></span></a><span class="mpre">, </span><a name="loc_188_12_188_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_12_188_16&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre">) &lt;-
        case </span><a href="#loc_187_9_187_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_9_187_13&#39;)"><span class="hl_varref"><span class="mpre">mlen</span></span></a><span class="mpre"> of
            </span><span class="hl_comment"><span class="mpre">-- log the request body if it is small</span></span><span class="mpre">
            </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_191_18_191_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_18_191_21&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> | </span><a href="#loc_191_18_191_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_18_191_21&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2048</span></span><span class="mpre"> -&gt; do
                 let </span><a name="loc_192_22_192_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_22_192_26&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_192_27_192_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_27_192_32&#39;)"><span class="hl_vardecl"><span class="mpre">front</span></span></a><span class="mpre"> = do
                        </span><a name="loc_193_25_193_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_25_193_27&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">requestBody</span></span><span class="mpre"> </span><a href="#loc_186_40_186_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_40_186_43&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">
                        if </span><span class="hl_varref"><span class="mpre">S8.null</span></span><span class="mpre"> </span><a href="#loc_193_25_193_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_25_193_27&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
                            then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_192_27_192_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_27_192_32&#39;)"><span class="hl_varref"><span class="mpre">front</span></span></a><span class="mpre"> []
                            else </span><a href="#loc_192_22_192_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_22_192_26&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_192_27_192_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_27_192_32&#39;)"><span class="hl_varref"><span class="mpre">front</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (</span><a href="#loc_193_25_193_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_25_193_27&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">)
                 </span><a name="loc_197_18_197_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_18_197_22&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_192_22_192_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_22_192_26&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">
                 </span><span class="hl_comment"><span class="mpre">-- logging the body here consumes it, so fill it back up</span></span><span class="mpre">
                 </span><span class="hl_comment"><span class="mpre">-- obviously not efficient, but this is the development logger</span></span><span class="mpre">
                 </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
                 </span><span class="hl_comment"><span class="mpre">-- Note: previously, we simply used CL.sourceList. However,</span></span><span class="mpre">
                 </span><span class="hl_comment"><span class="mpre">-- that meant that you could read the request body in twice.</span></span><span class="mpre">
                 </span><span class="hl_comment"><span class="mpre">-- While that in itself is not a problem, the issue is that,</span></span><span class="mpre">
                 </span><span class="hl_comment"><span class="mpre">-- in production, you wouldn&#39;t be able to do this, and</span></span><span class="mpre">
                 </span><span class="hl_comment"><span class="mpre">-- therefore some bugs wouldn&#39;t show up during testing. This</span></span><span class="mpre">
                 </span><span class="hl_comment"><span class="mpre">-- implementation ensures that each chunk is only returned</span></span><span class="mpre">
                 </span><span class="hl_comment"><span class="mpre">-- once.</span></span><span class="mpre">
                 </span><a name="loc_208_18_208_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_18_208_25&#39;)"><span class="hl_vardecl"><span class="mpre">ichunks</span></span></a><span class="mpre"> &lt;- </span><a href="Data.IORef.Lifted.html#loc_63_1_63_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.Lifted.html#loc_63_1_63_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_197_18_197_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_18_197_22&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre">
                 let </span><span class="hl_vardecl"><span class="mpre">rbody</span></span><span class="mpre"> = </span><a href="Data.IORef.Lifted.html#loc_83_1_83_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.Lifted.html#loc_83_1_83_18&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef</span></span></a><span class="mpre"> </span><a href="#loc_208_18_208_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_18_208_25&#39;)"><span class="hl_varref"><span class="mpre">ichunks</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_209_59_209_65" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_59_209_65&#39;)"><span class="hl_vardecl"><span class="mpre">chunks</span></span></a><span class="mpre"> -&gt;
                        case </span><a href="#loc_209_59_209_65" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_59_209_65&#39;)"><span class="hl_varref"><span class="mpre">chunks</span></span></a><span class="mpre"> of
                            [] -&gt; ([], </span><span class="hl_varref"><span class="mpre">S8.empty</span></span><span class="mpre">)
                            </span><a name="loc_212_29_212_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_29_212_30&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_212_31_212_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_31_212_32&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_212_31_212_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_31_212_32&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">, </span><a href="#loc_212_29_212_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_29_212_30&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)
                 let </span><a name="loc_213_22_213_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_22_213_26&#39;)"><span class="hl_vardecl"><span class="mpre">req&#39;</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 213, srcSpanStartColumn = 29, srcSpanEndLine = 213, srcSpanEndColumn = 56}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 213, srcSpanStartColumn = 33, srcSpanEndLine = 213, srcSpanEndColumn = 34},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-"><span class="mpre">req { requestBody = rbody }</span></span><span class="mpre">
                 </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_213_22_213_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_22_213_26&#39;)"><span class="hl_varref"><span class="mpre">req&#39;</span></span></a><span class="mpre">, </span><a href="#loc_197_18_197_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_18_197_22&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre">)
            _ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_186_40_186_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_40_186_43&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">, [])

    </span><a name="loc_217_5_217_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_5_217_15&#39;)"><span class="hl_vardecl"><span class="mpre">postParams</span></span></a><span class="mpre"> &lt;- if </span><span class="hl_varref"><span class="mpre">requestMethod</span></span><span class="mpre"> </span><a href="#loc_186_40_186_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_40_186_43&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`elem`</span></span><span class="mpre"> [</span><span class="hl_string"><span class="mpre">&quot;GET&quot;</span></span><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;HEAD&quot;</span></span><span class="mpre">]
      then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> []
      else do </span><a name="loc_219_15_219_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_15_219_25&#39;)"><span class="hl_vardecl"><span class="mpre">postParams</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_261_5_261_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_5_261_18&#39;)"><span class="hl_varref"><span class="mpre">allPostParams</span></span></a><span class="mpre"> </span><a href="#loc_188_12_188_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_12_188_16&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre">
              </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_277_5_277_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_5_277_22&#39;)"><span class="hl_varref"><span class="mpre">collectPostParams</span></span></a><span class="mpre"> </span><a href="#loc_219_15_219_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_15_219_25&#39;)"><span class="hl_varref"><span class="mpre">postParams</span></span></a><span class="mpre">

    let </span><a name="loc_222_9_222_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_9_222_18&#39;)"><span class="hl_vardecl"><span class="mpre">getParams</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_273_5_273_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_5_273_18&#39;)"><span class="hl_varref"><span class="mpre">emptyGetParam</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">queryString</span></span><span class="mpre"> </span><a href="#loc_186_40_186_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_40_186_43&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">

    </span><a name="loc_224_5_224_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_5_224_13&#39;)"><span class="hl_vardecl"><span class="mpre">addColor</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_186_24_186_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_24_186_35&#39;)"><span class="hl_varref"><span class="mpre">getAddColor</span></span></a><span class="mpre">
    let </span><a name="loc_225_9_225_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_9_225_15&#39;)"><span class="hl_vardecl"><span class="mpre">accept</span></span></a><span class="mpre"> = </span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="hl_varref"><span class="mpre">fromMaybe</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Accept&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">requestHeaders</span></span><span class="mpre"> </span><a href="#loc_186_40_186_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_40_186_43&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">

    </span><span class="hl_comment"><span class="mpre">-- log the request immediately.</span></span><span class="mpre">
    </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_186_21_186_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_21_186_23&#39;)"><span class="hl_varref"><span class="mpre">cb</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">toLogStr</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_224_5_224_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_5_224_13&#39;)"><span class="hl_varref"><span class="mpre">addColor</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">requestMethod</span></span><span class="mpre"> </span><a href="#loc_186_40_186_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_40_186_43&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">
        [ </span><span class="hl_string"><span class="mpre">&quot; &quot;</span></span><span class="mpre">
        , </span><span class="hl_varref"><span class="mpre">rawPathInfo</span></span><span class="mpre"> </span><a href="#loc_186_40_186_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_40_186_43&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">
        , </span><span class="hl_string"><span class="mpre">&quot; :: &quot;</span></span><span class="mpre">
        , </span><a href="#loc_225_9_225_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_9_225_15&#39;)"><span class="hl_varref"><span class="mpre">accept</span></span></a><span class="mpre">
        , </span><a href="#loc_257_5_257_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_5_257_15&#39;)"><span class="hl_varref"><span class="mpre">paramsToBS</span></span></a><span class="mpre">  </span><span class="hl_string"><span class="mpre">&quot;GET &quot;</span></span><span class="mpre"> </span><a href="#loc_222_9_222_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_9_222_18&#39;)"><span class="hl_varref"><span class="mpre">getParams</span></span></a><span class="mpre">
        , </span><a href="#loc_257_5_257_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_5_257_15&#39;)"><span class="hl_varref"><span class="mpre">paramsToBS</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;POST &quot;</span></span><span class="mpre"> </span><a href="#loc_217_5_217_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_5_217_15&#39;)"><span class="hl_varref"><span class="mpre">postParams</span></span></a><span class="mpre">
        , </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">
        ]

    </span><a href="#loc_186_36_186_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_36_186_39&#39;)"><span class="hl_varref"><span class="mpre">app</span></span></a><span class="mpre"> </span><a href="#loc_188_6_188_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_6_188_10&#39;)"><span class="hl_varref"><span class="mpre">req&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_238_17_238_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_238_17_238_20&#39;)"><span class="hl_vardecl"><span class="mpre">rsp</span></span></a><span class="mpre"> -&gt; do
        let </span><a name="loc_239_13_239_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_13_239_18&#39;)"><span class="hl_vardecl"><span class="mpre">isRaw</span></span></a><span class="mpre"> =
                case </span><a href="#loc_238_17_238_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_238_17_238_20&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre"> of
                    </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 241, srcSpanStartColumn = 21, srcSpanEndLine = 241, srcSpanEndColumn = 34}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/RequestLogger.hs&quot;, srcSpanStartLine = 241, srcSpanStartColumn = 32, srcSpanEndLine = 241, srcSpanEndColumn = 33},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra"><span class="mpre">ResponseRaw{}</span></span><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
                    _ -&gt; </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

        </span><span class="hl_comment"><span class="mpre">-- log the status of the response</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- this is color coordinated with the request logging</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- also includes the request path to connect it to the request</span></span><span class="mpre">
        </span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="hl_varref"><span class="mpre">unless</span></span></a><span class="mpre"> </span><a href="#loc_239_13_239_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_13_239_18&#39;)"><span class="hl_varref"><span class="mpre">isRaw</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_186_21_186_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_21_186_23&#39;)"><span class="hl_varref"><span class="mpre">cb</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">toLogStr</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
            </span><a href="#loc_224_5_224_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_5_224_13&#39;)"><span class="hl_varref"><span class="mpre">addColor</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Status: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_286_1_286_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_1_286_9&#39;)"><span class="hl_varref"><span class="mpre">statusBS</span></span></a><span class="mpre"> </span><a href="#loc_238_17_238_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_238_17_238_20&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">
            [ </span><span class="hl_string"><span class="mpre">&quot; &quot;</span></span><span class="mpre">
            , </span><a href="#loc_293_1_293_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_1_293_6&#39;)"><span class="hl_varref"><span class="mpre">msgBS</span></span></a><span class="mpre"> </span><a href="#loc_238_17_238_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_238_17_238_20&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre">
            , </span><span class="hl_string"><span class="mpre">&quot;. &quot;</span></span><span class="mpre">
            , </span><span class="hl_varref"><span class="mpre">rawPathInfo</span></span><span class="mpre"> </span><a href="#loc_186_40_186_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_40_186_43&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- if you need help matching the 2 logging statements</span></span><span class="mpre">
            , </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">
            ]
        </span><a href="#loc_186_44_186_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_44_186_56&#39;)"><span class="hl_varref"><span class="mpre">sendResponse</span></span></a><span class="mpre"> </span><a href="#loc_238_17_238_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_238_17_238_20&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre">
  where
    </span><a name="loc_257_5_257_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_5_257_15&#39;)"><span class="hl_fundecl"><span class="mpre">paramsToBS</span></span></a><span class="mpre"> </span><a name="loc_257_16_257_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_16_257_22&#39;)"><span class="hl_vardecl"><span class="mpre">prefix</span></span></a><span class="mpre"> </span><a name="loc_257_23_257_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_23_257_29&#39;)"><span class="hl_vardecl"><span class="mpre">params</span></span></a><span class="mpre"> =
      if </span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_257_23_257_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_23_257_29&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre"> then </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
        else </span><span class="hl_varref"><span class="mpre">BS.concat</span></span><span class="mpre"> [</span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">, </span><a href="#loc_257_16_257_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_16_257_22&#39;)"><span class="hl_varref"><span class="mpre">prefix</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">pack</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_257_23_257_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_23_257_29&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre">)]

    </span><a name="loc_261_5_261_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_5_261_18&#39;)"><span class="hl_fundecl"><span class="mpre">allPostParams</span></span></a><span class="mpre"> </span><a name="loc_261_19_261_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_19_261_23&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre"> =
        case </span><a href="Network.Wai.Parse.html#loc_142_1_142_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Parse.html#loc_142_1_142_19&#39;)"><span class="hl_varref"><span class="mpre">getRequestBodyType</span></span></a><span class="mpre"> </span><a href="#loc_186_40_186_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_40_186_43&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> ([], [])
            </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_264_18_264_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_18_264_21&#39;)"><span class="hl_vardecl"><span class="mpre">rbt</span></span></a><span class="mpre"> -&gt; do
                </span><a name="loc_265_17_265_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_17_265_24&#39;)"><span class="hl_vardecl"><span class="mpre">ichunks</span></span></a><span class="mpre"> &lt;- </span><a href="Data.IORef.Lifted.html#loc_63_1_63_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.Lifted.html#loc_63_1_63_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_261_19_261_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_261_19_261_23&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre">
                let </span><a name="loc_266_21_266_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_21_266_26&#39;)"><span class="hl_vardecl"><span class="mpre">rbody</span></span></a><span class="mpre"> = </span><a href="Data.IORef.Lifted.html#loc_83_1_83_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.Lifted.html#loc_83_1_83_18&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef</span></span></a><span class="mpre"> </span><a href="#loc_265_17_265_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_265_17_265_24&#39;)"><span class="hl_varref"><span class="mpre">ichunks</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_266_58_266_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_58_266_64&#39;)"><span class="hl_vardecl"><span class="mpre">chunks</span></span></a><span class="mpre"> -&gt;
                        case </span><a href="#loc_266_58_266_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_58_266_64&#39;)"><span class="hl_varref"><span class="mpre">chunks</span></span></a><span class="mpre"> of
                            [] -&gt; ([], </span><span class="hl_varref"><span class="mpre">S8.empty</span></span><span class="mpre">)
                            </span><a name="loc_269_29_269_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_29_269_30&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_269_31_269_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_31_269_32&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_269_31_269_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_31_269_32&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">, </span><a href="#loc_269_29_269_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_29_269_30&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)
                </span><a href="Network.Wai.Parse.html#loc_186_1_186_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Parse.html#loc_186_1_186_16&#39;)"><span class="hl_varref"><span class="mpre">sinkRequestBody</span></span></a><span class="mpre"> </span><a href="Network.Wai.Parse.html#loc_80_1_80_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Parse.html#loc_80_1_80_11&#39;)"><span class="hl_varref"><span class="mpre">lbsBackEnd</span></span></a><span class="mpre"> </span><a href="#loc_264_18_264_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_18_264_21&#39;)"><span class="hl_varref"><span class="mpre">rbt</span></span></a><span class="mpre"> </span><a href="#loc_266_21_266_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_21_266_26&#39;)"><span class="hl_varref"><span class="mpre">rbody</span></span></a><span class="mpre">

    </span><a href="#loc_273_5_273_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_5_273_18&#39;)"><span class="mpre">emptyGetParam</span></a><span class="mpre"> :: (</span><span class="hl_tyconref"><span class="mpre">BS.ByteString</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">BS.ByteString</span></span><span class="mpre">) -&gt; (</span><span class="hl_tyconref"><span class="mpre">BS.ByteString</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">BS.ByteString</span></span><span class="mpre">)
    </span><a name="loc_273_5_273_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_5_273_18&#39;)"><span class="hl_fundecl"><span class="mpre">emptyGetParam</span></span></a><span class="mpre"> (</span><a name="loc_273_20_273_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_20_273_21&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_273_28_273_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_28_273_29&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre">) = (</span><a href="#loc_273_20_273_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_20_273_21&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">,</span><a href="#loc_273_28_273_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_28_273_29&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">)
    </span><a href="#loc_273_5_273_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_5_273_18&#39;)"><span class="hl_fundecl"><span class="mpre">emptyGetParam</span></span></a><span class="mpre"> (</span><a name="loc_274_20_274_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_20_274_21&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">) = (</span><a href="#loc_274_20_274_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_20_274_21&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">,</span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">)

    </span><a href="#loc_277_5_277_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_5_277_22&#39;)"><span class="mpre">collectPostParams</span></a><span class="mpre"> :: ([</span><span class="hl_tyconref"><span class="mpre">Param</span></span><span class="mpre">], [</span><span class="hl_tyconref"><span class="mpre">File</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">LBS.ByteString</span></span><span class="mpre">]) -&gt; [</span><span class="hl_tyconref"><span class="mpre">Param</span></span><span class="mpre">]
    </span><a name="loc_277_5_277_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_5_277_22&#39;)"><span class="hl_fundecl"><span class="mpre">collectPostParams</span></span></a><span class="mpre"> (</span><a name="loc_277_24_277_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_24_277_34&#39;)"><span class="hl_vardecl"><span class="mpre">postParams</span></span></a><span class="mpre">, </span><a name="loc_277_36_277_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_36_277_41&#39;)"><span class="hl_vardecl"><span class="mpre">files</span></span></a><span class="mpre">) = </span><a href="#loc_277_24_277_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_24_277_34&#39;)"><span class="hl_varref"><span class="mpre">postParams</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> (\(</span><a name="loc_278_14_278_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_14_278_15&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre">,</span><a name="loc_278_16_278_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_16_278_17&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre">) -&gt; (</span><a href="#loc_278_14_278_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_14_278_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">BS.append</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;FILE: &quot;</span></span><span class="mpre"> (</span><a href="Network.Wai.Parse.html#loc_120_7_120_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Parse.html#loc_120_7_120_15&#39;)"><span class="hl_varref"><span class="mpre">fileName</span></span></a><span class="mpre"> </span><a href="#loc_278_16_278_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_16_278_17&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">))) </span><a href="#loc_277_36_277_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_36_277_41&#39;)"><span class="hl_varref"><span class="mpre">files</span></span></a><span class="mpre">

    </span><a name="loc_280_5_280_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_5_280_12&#39;)"><span class="hl_fundecl"><span class="mpre">readInt</span></span></a><span class="mpre"> </span><a name="loc_280_13_280_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_13_280_15&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> =
        case </span><span class="hl_varref"><span class="mpre">reads</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">unpack</span></span><span class="mpre"> </span><a href="#loc_280_13_280_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_13_280_15&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> of
            (</span><a name="loc_282_14_282_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_282_14_282_15&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">, _)</span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_ -&gt; </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a href="#loc_282_14_282_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_282_14_282_15&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)
            [] -&gt; </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">

</span><a href="#loc_286_1_286_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_1_286_9&#39;)"><span class="mpre">statusBS</span></a><span class="mpre"> :: </span><a href="Network.Wai.Internal.html#loc_74_6_74_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_74_6_74_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">BS.ByteString</span></span><span class="mpre">]
</span><a name="loc_286_1_286_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_1_286_9&#39;)"><span class="hl_fundecl"><span class="mpre">statusBS</span></span></a><span class="mpre"> </span><a name="loc_286_10_286_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_10_286_13&#39;)"><span class="hl_vardecl"><span class="mpre">rsp</span></span></a><span class="mpre"> =
    if </span><a href="#loc_290_5_290_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_290_5_290_11&#39;)"><span class="hl_varref"><span class="mpre">status</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">400</span></span><span class="mpre"> then </span><a href="#loc_177_1_177_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_10&#39;)"><span class="hl_varref"><span class="mpre">ansiColor</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Red</span></span><span class="mpre"> </span><a href="#loc_289_5_289_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_289_5_289_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> else [</span><a href="#loc_289_5_289_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_289_5_289_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">]
  where
    </span><a name="loc_289_5_289_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_289_5_289_7&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">pack</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_290_5_290_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_290_5_290_11&#39;)"><span class="hl_varref"><span class="mpre">status</span></span></a><span class="mpre">
    </span><a name="loc_290_5_290_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_290_5_290_11&#39;)"><span class="hl_vardecl"><span class="mpre">status</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">statusCode</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Wai.html#loc_180_1_180_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_180_1_180_15&#39;)"><span class="hl_varref"><span class="mpre">responseStatus</span></span></a><span class="mpre"> </span><a href="#loc_286_10_286_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_10_286_13&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre">

</span><a href="#loc_293_1_293_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_1_293_6&#39;)"><span class="mpre">msgBS</span></a><span class="mpre"> :: </span><a href="Network.Wai.Internal.html#loc_74_6_74_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_74_6_74_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">BS.ByteString</span></span><span class="mpre">
</span><a name="loc_293_1_293_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_1_293_6&#39;)"><span class="hl_vardecl"><span class="mpre">msgBS</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">statusMessage</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Network.Wai.html#loc_180_1_180_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_180_1_180_15&#39;)"><span class="hl_varref"><span class="mpre">responseStatus</span></span></a><span class="mpre">
</span></div></body></html>