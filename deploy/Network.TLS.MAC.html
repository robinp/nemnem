<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Network.TLS.MAC</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Network.TLS.MAC
    ( hmacMD5
    , hmacSHA1
    , hmacSHA256
    , macSSL
    , hmac
    , prf_MD5
    , prf_SHA1
    , prf_SHA256
    , prf_MD5SHA1
    ) where

import qualified Crypto.Hash.MD5 as MD5
import qualified Crypto.Hash.SHA1 as SHA1
import qualified Crypto.Hash.SHA256 as SHA256
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/MAC.hs&quot;, srcSpanStartLine = 23, srcSpanStartColumn = 18, srcSpanEndLine = 23, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/MAC.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 8, srcSpanEndLine = 24, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import Data.Bits (</span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="mpre">xor</span></a><span class="mpre">)

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/MAC.hs&quot;, srcSpanStartLine = 27, srcSpanStartColumn = 1, srcSpanEndLine = 27, srcSpanEndColumn = 51}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/MAC.hs&quot;, srcSpanStartLine = 27, srcSpanStartColumn = 1, srcSpanEndLine = 27, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/MAC.hs&quot;, srcSpanStartLine = 27, srcSpanStartColu"><span class="mpre">type HMAC = ByteString -&gt; ByteString -&gt; ByteString</span></span><span class="mpre">

</span><a href="#loc_30_1_30_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_1_30_7&#39;)"><span class="mpre">macSSL</span></a><span class="mpre"> :: (</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">HMAC</span></span><span class="mpre">
</span><a name="loc_30_1_30_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_1_30_7&#39;)"><span class="hl_fundecl"><span class="mpre">macSSL</span></span></a><span class="mpre"> </span><a name="loc_30_8_30_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_8_30_9&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_30_10_30_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_10_30_16&#39;)"><span class="hl_vardecl"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a name="loc_30_17_30_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_17_30_20&#39;)"><span class="hl_vardecl"><span class="mpre">msg</span></span></a><span class="mpre"> = </span><a href="#loc_30_8_30_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_8_30_9&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> [ </span><a href="#loc_30_10_30_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_10_30_16&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">B.replicate</span></span><span class="mpre"> </span><a href="#loc_33_9_33_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_9_33_15&#39;)"><span class="hl_varref"><span class="mpre">padlen</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x5c</span></span><span class="mpre">,
                        </span><a href="#loc_30_8_30_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_8_30_9&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> [ </span><a href="#loc_30_10_30_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_10_30_16&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">B.replicate</span></span><span class="mpre"> </span><a href="#loc_33_9_33_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_9_33_15&#39;)"><span class="hl_varref"><span class="mpre">padlen</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x36</span></span><span class="mpre">, </span><a href="#loc_30_17_30_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_17_30_20&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre"> ] ]
  where </span><span class="hl_comment"><span class="mpre">-- get the type of algorithm out of the digest length by using the hash fct.</span></span><span class="mpre">
        </span><a name="loc_33_9_33_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_9_33_15&#39;)"><span class="hl_vardecl"><span class="mpre">padlen</span></span></a><span class="mpre"> = if (</span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_30_8_30_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_8_30_9&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre"> then </span><span class="hl_num"><span class="mpre">48</span></span><span class="mpre"> else </span><span class="hl_num"><span class="mpre">40</span></span><span class="mpre">

</span><a href="#loc_36_1_36_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_5&#39;)"><span class="mpre">hmac</span></a><span class="mpre"> :: (</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">HMAC</span></span><span class="mpre">
</span><a name="loc_36_1_36_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_5&#39;)"><span class="hl_fundecl"><span class="mpre">hmac</span></span></a><span class="mpre"> </span><a name="loc_36_6_36_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_6_36_7&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_36_8_36_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_8_36_10&#39;)"><span class="hl_vardecl"><span class="mpre">bl</span></span></a><span class="mpre"> </span><a name="loc_36_11_36_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_17&#39;)"><span class="hl_vardecl"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a name="loc_36_18_36_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_18_36_21&#39;)"><span class="hl_vardecl"><span class="mpre">msg</span></span></a><span class="mpre"> =
    </span><a href="#loc_36_6_36_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_6_36_7&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.append</span></span><span class="mpre"> </span><a href="#loc_38_9_38_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_9_38_13&#39;)"><span class="hl_varref"><span class="mpre">opad</span></span></a><span class="mpre"> (</span><a href="#loc_36_6_36_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_6_36_7&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.append</span></span><span class="mpre"> </span><a href="#loc_39_9_39_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_9_39_13&#39;)"><span class="hl_varref"><span class="mpre">ipad</span></span></a><span class="mpre"> </span><a href="#loc_36_18_36_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_18_36_21&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre">)
  where </span><a name="loc_38_9_38_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_9_38_13&#39;)"><span class="hl_vardecl"><span class="mpre">opad</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.map</span></span><span class="mpre"> (</span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="hl_varref"><span class="mpre">xor</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x5c</span></span><span class="mpre">) </span><a href="#loc_41_9_41_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_9_41_11&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre">
        </span><a name="loc_39_9_39_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_9_39_13&#39;)"><span class="hl_vardecl"><span class="mpre">ipad</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.map</span></span><span class="mpre"> (</span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="hl_varref"><span class="mpre">xor</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x36</span></span><span class="mpre">) </span><a href="#loc_41_9_41_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_9_41_11&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre">

        </span><a name="loc_41_9_41_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_9_41_11&#39;)"><span class="hl_vardecl"><span class="mpre">k&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.append</span></span><span class="mpre"> </span><a href="#loc_42_17_42_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_17_42_19&#39;)"><span class="hl_varref"><span class="mpre">kt</span></span></a><span class="mpre"> </span><a href="#loc_43_17_43_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_17_43_20&#39;)"><span class="hl_varref"><span class="mpre">pad</span></span></a><span class="mpre">
          where </span><a name="loc_42_17_42_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_17_42_19&#39;)"><span class="hl_vardecl"><span class="mpre">kt</span></span></a><span class="mpre">  = if </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_36_11_36_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_17&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_36_8_36_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_8_36_10&#39;)"><span class="hl_varref"><span class="mpre">bl</span></span></a><span class="mpre"> then </span><a href="#loc_36_6_36_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_6_36_7&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_36_11_36_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_17&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre"> else </span><a href="#loc_36_11_36_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_11_36_17&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre">
                </span><a name="loc_43_17_43_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_17_43_20&#39;)"><span class="hl_vardecl"><span class="mpre">pad</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.replicate</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_36_8_36_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_8_36_10&#39;)"><span class="hl_varref"><span class="mpre">bl</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_42_17_42_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_17_42_19&#39;)"><span class="hl_varref"><span class="mpre">kt</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">

</span><a href="#loc_46_1_46_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_1_46_8&#39;)"><span class="mpre">hmacMD5</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">HMAC</span></span><span class="mpre">
</span><a name="loc_46_1_46_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_1_46_8&#39;)"><span class="hl_fundecl"><span class="mpre">hmacMD5</span></span></a><span class="mpre"> </span><a name="loc_46_9_46_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_15&#39;)"><span class="hl_vardecl"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a name="loc_46_16_46_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_16_46_19&#39;)"><span class="hl_vardecl"><span class="mpre">msg</span></span></a><span class="mpre"> = </span><a href="#loc_36_1_36_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_5&#39;)"><span class="hl_varref"><span class="mpre">hmac</span></span></a><span class="mpre"> </span><a href="Crypto.Hash.MD5.html#loc_126_1_126_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Hash.MD5.html#loc_126_1_126_5&#39;)"><span class="hl_varref"><span class="mpre">MD5.hash</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">64</span></span><span class="mpre"> </span><a href="#loc_46_9_46_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_15&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a href="#loc_46_16_46_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_16_46_19&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre">

</span><a href="#loc_49_1_49_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_1_49_9&#39;)"><span class="mpre">hmacSHA1</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">HMAC</span></span><span class="mpre">
</span><a name="loc_49_1_49_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_1_49_9&#39;)"><span class="hl_fundecl"><span class="mpre">hmacSHA1</span></span></a><span class="mpre"> </span><a name="loc_49_10_49_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_10_49_16&#39;)"><span class="hl_vardecl"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a name="loc_49_17_49_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_17_49_20&#39;)"><span class="hl_vardecl"><span class="mpre">msg</span></span></a><span class="mpre"> = </span><a href="#loc_36_1_36_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_5&#39;)"><span class="hl_varref"><span class="mpre">hmac</span></span></a><span class="mpre"> </span><a href="Crypto.Hash.SHA1.html#loc_126_1_126_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Hash.SHA1.html#loc_126_1_126_5&#39;)"><span class="hl_varref"><span class="mpre">SHA1.hash</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">64</span></span><span class="mpre"> </span><a href="#loc_49_10_49_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_10_49_16&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a href="#loc_49_17_49_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_17_49_20&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre">

</span><a href="#loc_52_1_52_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_11&#39;)"><span class="mpre">hmacSHA256</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">HMAC</span></span><span class="mpre">
</span><a name="loc_52_1_52_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_11&#39;)"><span class="hl_fundecl"><span class="mpre">hmacSHA256</span></span></a><span class="mpre"> </span><a name="loc_52_12_52_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_12_52_18&#39;)"><span class="hl_vardecl"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a name="loc_52_19_52_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_19_52_22&#39;)"><span class="hl_vardecl"><span class="mpre">msg</span></span></a><span class="mpre"> = </span><a href="#loc_36_1_36_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_5&#39;)"><span class="hl_varref"><span class="mpre">hmac</span></span></a><span class="mpre"> </span><a href="Crypto.Hash.SHA256.html#loc_126_1_126_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Hash.SHA256.html#loc_126_1_126_5&#39;)"><span class="hl_varref"><span class="mpre">SHA256.hash</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">64</span></span><span class="mpre"> </span><a href="#loc_52_12_52_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_12_52_18&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a href="#loc_52_19_52_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_19_52_22&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre">

</span><a href="#loc_55_1_55_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_9&#39;)"><span class="mpre">hmacIter</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">HMAC</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">]
</span><a name="loc_55_1_55_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_9&#39;)"><span class="hl_fundecl"><span class="mpre">hmacIter</span></span></a><span class="mpre"> </span><a name="loc_55_10_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_10_55_11&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_55_12_55_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_12_55_18&#39;)"><span class="hl_vardecl"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a name="loc_55_19_55_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_19_55_23&#39;)"><span class="hl_vardecl"><span class="mpre">seed</span></span></a><span class="mpre"> </span><a name="loc_55_24_55_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_24_55_29&#39;)"><span class="hl_vardecl"><span class="mpre">aprev</span></span></a><span class="mpre"> </span><a name="loc_55_30_55_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_30_55_33&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> =
    let </span><a name="loc_56_9_56_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_9_56_11&#39;)"><span class="hl_vardecl"><span class="mpre">an</span></span></a><span class="mpre"> = </span><a href="#loc_55_10_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_10_55_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_55_12_55_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_12_55_18&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a href="#loc_55_24_55_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_24_55_29&#39;)"><span class="hl_varref"><span class="mpre">aprev</span></span></a><span class="mpre"> in
    let </span><a name="loc_57_9_57_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_12&#39;)"><span class="hl_vardecl"><span class="mpre">out</span></span></a><span class="mpre"> = </span><a href="#loc_55_10_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_10_55_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_55_12_55_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_12_55_18&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> [</span><a href="#loc_56_9_56_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_9_56_11&#39;)"><span class="hl_varref"><span class="mpre">an</span></span></a><span class="mpre">, </span><a href="#loc_55_19_55_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_19_55_23&#39;)"><span class="hl_varref"><span class="mpre">seed</span></span></a><span class="mpre">]) in
    let </span><a name="loc_58_9_58_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_19&#39;)"><span class="hl_vardecl"><span class="mpre">digestsize</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_57_9_57_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_12&#39;)"><span class="hl_varref"><span class="mpre">out</span></span></a><span class="mpre"> in
    if </span><a href="#loc_58_9_58_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_19&#39;)"><span class="hl_varref"><span class="mpre">digestsize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="#loc_55_30_55_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_30_55_33&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
        then [ </span><span class="hl_varref"><span class="mpre">B.take</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_55_30_55_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_30_55_33&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">) </span><a href="#loc_57_9_57_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_12&#39;)"><span class="hl_varref"><span class="mpre">out</span></span></a><span class="mpre"> ]
        else </span><a href="#loc_57_9_57_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_12&#39;)"><span class="hl_varref"><span class="mpre">out</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_55_1_55_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_9&#39;)"><span class="hl_varref"><span class="mpre">hmacIter</span></span></a><span class="mpre"> </span><a href="#loc_55_10_55_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_10_55_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_55_12_55_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_12_55_18&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a href="#loc_55_19_55_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_19_55_23&#39;)"><span class="hl_varref"><span class="mpre">seed</span></span></a><span class="mpre"> </span><a href="#loc_56_9_56_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_9_56_11&#39;)"><span class="hl_varref"><span class="mpre">an</span></span></a><span class="mpre"> (</span><a href="#loc_55_30_55_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_30_55_33&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_58_9_58_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_19&#39;)"><span class="hl_varref"><span class="mpre">digestsize</span></span></a><span class="mpre">)

</span><a href="#loc_64_1_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_9&#39;)"><span class="mpre">prf_SHA1</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_64_1_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_9&#39;)"><span class="hl_fundecl"><span class="mpre">prf_SHA1</span></span></a><span class="mpre"> </span><a name="loc_64_10_64_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_10_64_16&#39;)"><span class="hl_vardecl"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a name="loc_64_17_64_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_17_64_21&#39;)"><span class="hl_vardecl"><span class="mpre">seed</span></span></a><span class="mpre"> </span><a name="loc_64_22_64_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_22_64_25&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_55_1_55_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_9&#39;)"><span class="hl_varref"><span class="mpre">hmacIter</span></span></a><span class="mpre"> </span><a href="#loc_49_1_49_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_1_49_9&#39;)"><span class="hl_varref"><span class="mpre">hmacSHA1</span></span></a><span class="mpre"> </span><a href="#loc_64_10_64_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_10_64_16&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a href="#loc_64_17_64_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_17_64_21&#39;)"><span class="hl_varref"><span class="mpre">seed</span></span></a><span class="mpre"> </span><a href="#loc_64_17_64_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_17_64_21&#39;)"><span class="hl_varref"><span class="mpre">seed</span></span></a><span class="mpre"> </span><a href="#loc_64_22_64_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_22_64_25&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">

</span><a href="#loc_67_1_67_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_8&#39;)"><span class="mpre">prf_MD5</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_67_1_67_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_8&#39;)"><span class="hl_fundecl"><span class="mpre">prf_MD5</span></span></a><span class="mpre"> </span><a name="loc_67_9_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_9_67_15&#39;)"><span class="hl_vardecl"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a name="loc_67_16_67_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_16_67_20&#39;)"><span class="hl_vardecl"><span class="mpre">seed</span></span></a><span class="mpre"> </span><a name="loc_67_21_67_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_21_67_24&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_55_1_55_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_9&#39;)"><span class="hl_varref"><span class="mpre">hmacIter</span></span></a><span class="mpre"> </span><a href="#loc_46_1_46_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_1_46_8&#39;)"><span class="hl_varref"><span class="mpre">hmacMD5</span></span></a><span class="mpre"> </span><a href="#loc_67_9_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_9_67_15&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a href="#loc_67_16_67_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_16_67_20&#39;)"><span class="hl_varref"><span class="mpre">seed</span></span></a><span class="mpre"> </span><a href="#loc_67_16_67_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_16_67_20&#39;)"><span class="hl_varref"><span class="mpre">seed</span></span></a><span class="mpre"> </span><a href="#loc_67_21_67_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_21_67_24&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">

</span><a href="#loc_70_1_70_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_1_70_12&#39;)"><span class="mpre">prf_MD5SHA1</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_70_1_70_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_1_70_12&#39;)"><span class="hl_fundecl"><span class="mpre">prf_MD5SHA1</span></span></a><span class="mpre"> </span><a name="loc_70_13_70_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_13_70_19&#39;)"><span class="hl_vardecl"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a name="loc_70_20_70_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_20_70_24&#39;)"><span class="hl_vardecl"><span class="mpre">seed</span></span></a><span class="mpre"> </span><a name="loc_70_25_70_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_25_70_28&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> =
    </span><span class="hl_varref"><span class="mpre">B.pack</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.zipWith</span></span><span class="mpre"> </span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="hl_varref"><span class="mpre">xor</span></span></a><span class="mpre"> (</span><a href="#loc_67_1_67_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_8&#39;)"><span class="hl_varref"><span class="mpre">prf_MD5</span></span></a><span class="mpre"> </span><a href="#loc_73_9_73_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_9_73_11&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre"> </span><a href="#loc_70_20_70_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_20_70_24&#39;)"><span class="hl_varref"><span class="mpre">seed</span></span></a><span class="mpre"> </span><a href="#loc_70_25_70_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_25_70_28&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">) (</span><a href="#loc_64_1_64_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_9&#39;)"><span class="hl_varref"><span class="mpre">prf_SHA1</span></span></a><span class="mpre"> </span><a href="#loc_74_9_74_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_9_74_11&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre"> </span><a href="#loc_70_20_70_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_20_70_24&#39;)"><span class="hl_varref"><span class="mpre">seed</span></span></a><span class="mpre"> </span><a href="#loc_70_25_70_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_25_70_28&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">)
  where </span><a name="loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_vardecl"><span class="mpre">slen</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_70_13_70_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_13_70_19&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre">
        </span><a name="loc_73_9_73_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_9_73_11&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">    = </span><span class="hl_varref"><span class="mpre">B.take</span></span><span class="mpre"> (</span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_varref"><span class="mpre">slen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`div`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_varref"><span class="mpre">slen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`mod`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">) </span><a href="#loc_70_13_70_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_13_70_19&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre">
        </span><a name="loc_74_9_74_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_9_74_11&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">    = </span><span class="hl_varref"><span class="mpre">B.drop</span></span><span class="mpre"> (</span><a href="#loc_72_9_72_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_9_72_13&#39;)"><span class="hl_varref"><span class="mpre">slen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`div`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">) </span><a href="#loc_70_13_70_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_13_70_19&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre">

</span><a href="#loc_77_1_77_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_1_77_11&#39;)"><span class="mpre">prf_SHA256</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_77_1_77_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_1_77_11&#39;)"><span class="hl_fundecl"><span class="mpre">prf_SHA256</span></span></a><span class="mpre"> </span><a name="loc_77_12_77_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_12_77_18&#39;)"><span class="hl_vardecl"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a name="loc_77_19_77_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_19_77_23&#39;)"><span class="hl_vardecl"><span class="mpre">seed</span></span></a><span class="mpre"> </span><a name="loc_77_24_77_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_24_77_27&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_55_1_55_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_9&#39;)"><span class="hl_varref"><span class="mpre">hmacIter</span></span></a><span class="mpre"> </span><a href="#loc_52_1_52_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_11&#39;)"><span class="hl_varref"><span class="mpre">hmacSHA256</span></span></a><span class="mpre"> </span><a href="#loc_77_12_77_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_12_77_18&#39;)"><span class="hl_varref"><span class="mpre">secret</span></span></a><span class="mpre"> </span><a href="#loc_77_19_77_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_19_77_23&#39;)"><span class="hl_varref"><span class="mpre">seed</span></span></a><span class="mpre"> </span><a href="#loc_77_19_77_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_19_77_23&#39;)"><span class="hl_varref"><span class="mpre">seed</span></span></a><span class="mpre"> </span><a href="#loc_77_24_77_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_24_77_27&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
</span></div></body></html>