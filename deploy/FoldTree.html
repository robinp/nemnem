<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE DeriveDataTypeable  #-}
{-# LANGUAGE ScopedTypeVariables #-}

</span><span class="hl_comment"><span class="mpre">{-

A very, very simple example: &quot;extract all Ints from a tree of Ints&quot;.
The text book approach is to write a generalised fold for that. One
can also turn the Tree datatype into functorial style and then write a
Functor instance for the functorial datatype including a definition of
fmap. (The original Tree datatype can be related to the functorial
version by the usual injection and projection.)

You can scrap all such boilerplate by using a traversal scheme based
on gmap combinators as illustrated below. To get it a little more
interesting, we use a datatype Tree with not just a case for leafs and
fork trees, but we also add a case for trees with a weight.

For completeness&#39; sake, we mention that the fmap/generalised fold
approach differs from the gmap approach in some details. Most notably,
the gmap approach does not generally facilitate the identification of
term components that relate to the type parameter of a parameterised
datatype. The consequence of this is illustrated below as well.
Sec. 6.3 in &quot;Scrap Your Boilerplate ...&quot; discusses such `type
distinctions&#39; as well.

-}</span></span><span class="mpre">

module FoldTree (tests) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/FoldTree.hs&quot;, srcSpanStartLine = 30, srcSpanStartColumn = 8, srcSpanEndLine = 30, srcSpanEndColumn = 18}, srcInfoPoints = []}) &quot;Test.HUnit&quot;"><span class="mpre">Test.HUnit</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Enable &quot;ScrapYourBoilerplate&quot;</span></span><span class="mpre">
import Data.Generics


</span><span class="hl_comment"><span class="mpre">-- A parameterised datatype for binary trees with data at the leafs</span></span><span class="mpre">
data </span><a name="loc_37_6_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_6_37_10&#39;)"><span class="hl_tycondecl"><span class="mpre">Tree</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">w</span></span><span class="mpre"> = </span><a name="loc_37_17_37_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_17_37_21&#39;)"><span class="hl_condecl"><span class="mpre">Leaf</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
              | </span><a name="loc_38_17_38_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_17_38_21&#39;)"><span class="hl_condecl"><span class="mpre">Fork</span></span></a><span class="mpre"> (</span><a href="#loc_37_6_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_6_37_10&#39;)"><span class="hl_tyconref"><span class="mpre">Tree</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">w</span></span><span class="mpre">) (</span><a href="#loc_37_6_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_6_37_10&#39;)"><span class="hl_tyconref"><span class="mpre">Tree</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">w</span></span><span class="mpre">)
              | </span><a name="loc_39_17_39_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_17_39_27&#39;)"><span class="hl_condecl"><span class="mpre">WithWeight</span></span></a><span class="mpre"> (</span><a href="#loc_37_6_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_6_37_10&#39;)"><span class="hl_tyconref"><span class="mpre">Tree</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">w</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">w</span></span><span class="mpre">  
       </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/FoldTree.hs&quot;, srcSpanStartLine = 40, srcSpanStartColumn = 8, srcSpanEndLine = 40, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/FoldTree.hs&quot;, srcSpanStartLine = 40, srcSpanStartColumn = 8, srcSpanEndLine = 40, srcSpanEndColumn = 16},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/FoldTree.hs&quot;, srcSpanStartLine = 40, srcSpanStartColumn"><span class="mpre">deriving (Typeable, Data)</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- A typical tree</span></span><span class="mpre">
</span><a href="#loc_45_1_45_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_7&#39;)"><span class="mpre">mytree</span></a><span class="mpre"> :: </span><a href="#loc_37_6_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_6_37_10&#39;)"><span class="hl_tyconref"><span class="mpre">Tree</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_45_1_45_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_7&#39;)"><span class="hl_vardecl"><span class="mpre">mytree</span></span></a><span class="mpre"> = </span><a href="#loc_38_17_38_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_17_38_21&#39;)"><span class="hl_conref"><span class="mpre">Fork</span></span></a><span class="mpre"> (</span><a href="#loc_39_17_39_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_17_39_27&#39;)"><span class="hl_conref"><span class="mpre">WithWeight</span></span></a><span class="mpre"> (</span><a href="#loc_37_17_37_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_17_37_21&#39;)"><span class="hl_conref"><span class="mpre">Leaf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">42</span></span><span class="mpre">) </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
              (</span><a href="#loc_39_17_39_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_17_39_27&#39;)"><span class="hl_conref"><span class="mpre">WithWeight</span></span></a><span class="mpre"> (</span><a href="#loc_38_17_38_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_17_38_21&#39;)"><span class="hl_conref"><span class="mpre">Fork</span></span></a><span class="mpre"> (</span><a href="#loc_37_17_37_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_17_37_21&#39;)"><span class="hl_conref"><span class="mpre">Leaf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">88</span></span><span class="mpre">) (</span><a href="#loc_37_17_37_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_17_37_21&#39;)"><span class="hl_conref"><span class="mpre">Leaf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">37</span></span><span class="mpre">)) </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- A less typical tree, used for testing everythingBut</span></span><span class="mpre">
</span><a href="#loc_50_1_50_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_8&#39;)"><span class="mpre">mytree&#39;</span></a><span class="mpre"> :: </span><a href="#loc_37_6_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_6_37_10&#39;)"><span class="hl_tyconref"><span class="mpre">Tree</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_50_1_50_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_8&#39;)"><span class="hl_vardecl"><span class="mpre">mytree&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_38_17_38_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_17_38_21&#39;)"><span class="hl_conref"><span class="mpre">Fork</span></span></a><span class="mpre"> (</span><a href="#loc_37_17_37_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_17_37_21&#39;)"><span class="hl_conref"><span class="mpre">Leaf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">42</span></span><span class="mpre">)
               (</span><a href="#loc_39_17_39_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_17_39_27&#39;)"><span class="hl_conref"><span class="mpre">WithWeight</span></span></a><span class="mpre"> (</span><a href="#loc_38_17_38_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_17_38_21&#39;)"><span class="hl_conref"><span class="mpre">Fork</span></span></a><span class="mpre"> (</span><a href="#loc_37_17_37_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_17_37_21&#39;)"><span class="hl_conref"><span class="mpre">Leaf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">88</span></span><span class="mpre">) (</span><a href="#loc_37_17_37_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_17_37_21&#39;)"><span class="hl_conref"><span class="mpre">Leaf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">37</span></span><span class="mpre">)) </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">-- Print everything like an Int in mytree</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- In fact, we show two attempts:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   1. print really just everything like an Int</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   2. print everything wrapped with Leaf</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- So (1.) confuses leafs and weights whereas (2.) does not.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Additionally we test everythingBut, stopping when we see a WithWeight node</span></span><span class="mpre">
</span><a name="loc_60_1_60_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_1_60_6&#39;)"><span class="hl_vardecl"><span class="mpre">tests</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> ( </span><a href="Data.Generics.Schemes.html#loc_122_1_122_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Generics.Schemes.html#loc_122_1_122_8&#39;)"><span class="hl_varref"><span class="mpre">listify</span></span></a><span class="mpre"> (\(_::</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">) -&gt; </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">)         </span><a href="#loc_45_1_45_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_7&#39;)"><span class="hl_varref"><span class="mpre">mytree</span></span></a><span class="mpre">
             , </span><a href="Data.Generics.Schemes.html#loc_104_1_104_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Generics.Schemes.html#loc_104_1_104_11&#39;)"><span class="hl_varref"><span class="mpre">everything</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">(++)</span></span><span class="mpre"> ([] </span><a href="Data.Generics.Aliases.html#loc_100_4_100_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Generics.Aliases.html#loc_100_4_100_9&#39;)"><span class="hl_infix"><span class="mpre">`mkQ`</span></span></a><span class="mpre"> </span><a href="#loc_67_5_67_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_5_67_13&#39;)"><span class="hl_varref"><span class="mpre">fromLeaf</span></span></a><span class="mpre">) </span><a href="#loc_45_1_45_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_7&#39;)"><span class="hl_varref"><span class="mpre">mytree</span></span></a><span class="mpre">
             , </span><a href="Data.Generics.Schemes.html#loc_108_1_108_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Generics.Schemes.html#loc_108_1_108_14&#39;)"><span class="hl_varref"><span class="mpre">everythingBut</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">(++)</span></span><span class="mpre"> 
                 (([],</span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">) </span><a href="Data.Generics.Aliases.html#loc_100_4_100_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Generics.Aliases.html#loc_100_4_100_9&#39;)"><span class="hl_infix"><span class="mpre">`mkQ`</span></span></a><span class="mpre"> (\</span><a name="loc_63_38_63_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_38_63_39&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_67_5_67_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_5_67_13&#39;)"><span class="hl_varref"><span class="mpre">fromLeaf</span></span></a><span class="mpre"> </span><a href="#loc_63_38_63_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_38_63_39&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">, </span><a href="#loc_70_5_70_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_5_70_9&#39;)"><span class="hl_varref"><span class="mpre">stop</span></span></a><span class="mpre"> </span><a href="#loc_63_38_63_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_38_63_39&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">))) </span><a href="#loc_50_1_50_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_8&#39;)"><span class="hl_varref"><span class="mpre">mytree&#39;</span></span></a><span class="mpre">
             ) </span><span class="hl_infix"><span class="mpre">~=?</span></span><span class="mpre"> </span><a href="#loc_73_1_73_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_7&#39;)"><span class="hl_varref"><span class="mpre">output</span></span></a><span class="mpre">
  where
    </span><a href="#loc_67_5_67_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_5_67_13&#39;)"><span class="mpre">fromLeaf</span></a><span class="mpre"> :: </span><a href="#loc_37_6_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_6_37_10&#39;)"><span class="hl_tyconref"><span class="mpre">Tree</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">]
    </span><a name="loc_67_5_67_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_5_67_13&#39;)"><span class="hl_fundecl"><span class="mpre">fromLeaf</span></span></a><span class="mpre"> (</span><a href="#loc_37_17_37_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_17_37_21&#39;)"><span class="hl_conref"><span class="mpre">Leaf</span></span></a><span class="mpre"> </span><a name="loc_67_20_67_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_20_67_21&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">) = [</span><a href="#loc_67_20_67_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_20_67_21&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">]
    </span><a href="#loc_67_5_67_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_5_67_13&#39;)"><span class="hl_fundecl"><span class="mpre">fromLeaf</span></span></a><span class="mpre"> _        = []
    </span><a href="#loc_70_5_70_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_5_70_9&#39;)"><span class="mpre">stop</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxTuple (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/FoldTree.hs&quot;, srcSpanStartLine = 69, srcSpanStartColumn = 13, srcSpanEndLine = 69, srcSpanEndColumn = 32}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/FoldTree.hs&quot;, srcSpanStartLine = 69, srcSpanStartColumn = 13, srcSpanEndLine = 69, srcSpanEndColumn = 14},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/FoldTree.hs&quot;, srcSpanStartLine = 69, srcSpanStartColum"><span class="mpre">(Data a, Data b) =&gt;</span></span><span class="mpre"> </span><a href="#loc_37_6_37_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_6_37_10&#39;)"><span class="hl_tyconref"><span class="mpre">Tree</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
    </span><a name="loc_70_5_70_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_5_70_9&#39;)"><span class="hl_fundecl"><span class="mpre">stop</span></span></a><span class="mpre"> (</span><a href="#loc_39_17_39_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_17_39_27&#39;)"><span class="hl_conref"><span class="mpre">WithWeight</span></span></a><span class="mpre"> _ _) = </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
    </span><a href="#loc_70_5_70_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_5_70_9&#39;)"><span class="hl_fundecl"><span class="mpre">stop</span></span></a><span class="mpre"> _                = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

</span><a name="loc_73_1_73_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_7&#39;)"><span class="hl_vardecl"><span class="mpre">output</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;([42,1,88,37,2],[42,88,37],[42])&quot;</span></span><span class="mpre">
</span></div></body></html>