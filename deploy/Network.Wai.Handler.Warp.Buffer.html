<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">module Network.Wai.Handler.Warp.Buffer where

import qualified Blaze.ByteString.Builder.Internal.Buffer as B (</span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_71_6_71_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_71_6_71_12&#39;)"><span class="mpre">Buffer</span></a><span class="mpre"> (..))
import Data.Word (Word8)
import Foreign.ForeignPtr (newForeignPtr_)
import Foreign.Marshal.Alloc (</span><a href="Foreign.Marshal.Alloc.html#loc_96_1_96_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_96_1_96_12&#39;)"><span class="mpre">mallocBytes</span></a><span class="mpre">, </span><a href="Foreign.Marshal.Alloc.html#loc_184_1_184_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_184_1_184_5&#39;)"><span class="mpre">free</span></a><span class="mpre">)
import Foreign.Ptr (Ptr, plusPtr)

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Buffer.hs&quot;, srcSpanStartLine = 9, srcSpanStartColumn = 1, srcSpanEndLine = 9, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Buffer.hs&quot;, srcSpanStartLine = 9, srcSpanStartColumn = 1, srcSpanEndLine = 9, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/War"><span class="mpre">type Buffer = Ptr Word8</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Buffer.hs&quot;, srcSpanStartLine = 10, srcSpanStartColumn = 1, srcSpanEndLine = 10, srcSpanEndColumn = 19}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Buffer.hs&quot;, srcSpanStartLine = 10, srcSpanStartColumn = 1, srcSpanEndLine = 10, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler"><span class="mpre">type BufSize = Int</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- FIXME come up with good values here</span></span><span class="mpre">
</span><a href="#loc_14_1_14_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_14_1_14_11&#39;)"><span class="mpre">bufferSize</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">BufSize</span></span><span class="mpre">
</span><a name="loc_14_1_14_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_14_1_14_11&#39;)"><span class="hl_vardecl"><span class="mpre">bufferSize</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">4096</span></span><span class="mpre">

</span><a href="#loc_17_1_17_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_1_17_15&#39;)"><span class="mpre">allocateBuffer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Buffer</span></span><span class="mpre">
</span><a name="loc_17_1_17_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_1_17_15&#39;)"><span class="hl_vardecl"><span class="mpre">allocateBuffer</span></span></a><span class="mpre"> = </span><a href="Foreign.Marshal.Alloc.html#loc_96_1_96_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_96_1_96_12&#39;)"><span class="hl_varref"><span class="mpre">mallocBytes</span></span></a><span class="mpre">

</span><a href="#loc_20_1_20_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_1_20_11&#39;)"><span class="mpre">freeBuffer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Buffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_20_1_20_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_1_20_11&#39;)"><span class="hl_vardecl"><span class="mpre">freeBuffer</span></span></a><span class="mpre"> = </span><a href="Foreign.Marshal.Alloc.html#loc_184_1_184_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Alloc.html#loc_184_1_184_5&#39;)"><span class="hl_varref"><span class="mpre">free</span></span></a><span class="mpre">

</span><a href="#loc_23_1_23_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_14&#39;)"><span class="mpre">toBlazeBuffer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Buffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">BufSize</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_71_6_71_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_71_6_71_12&#39;)"><span class="hl_tyconref"><span class="mpre">B.Buffer</span></span></a><span class="mpre">
</span><a name="loc_23_1_23_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_14&#39;)"><span class="hl_fundecl"><span class="mpre">toBlazeBuffer</span></span></a><span class="mpre"> </span><a name="loc_23_15_23_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_15_23_18&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_23_19_23_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_19_23_23&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> = do
    </span><a name="loc_24_5_24_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_5_24_9&#39;)"><span class="hl_vardecl"><span class="mpre">fptr</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newForeignPtr_</span></span><span class="mpre"> </span><a href="#loc_23_15_23_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_15_23_18&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_71_15_71_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_71_15_71_21&#39;)"><span class="hl_conref"><span class="mpre">B.Buffer</span></span></a><span class="mpre"> </span><a href="#loc_24_5_24_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_5_24_9&#39;)"><span class="hl_varref"><span class="mpre">fptr</span></span></a><span class="mpre"> </span><a href="#loc_23_15_23_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_15_23_18&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_23_15_23_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_15_23_18&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> (</span><a href="#loc_23_15_23_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_15_23_18&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_23_19_23_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_19_23_23&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">)
</span></div></body></html>