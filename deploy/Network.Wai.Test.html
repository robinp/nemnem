<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE CPP #-}
{-# LANGUAGE DeriveDataTypeable #-}
module Network.Wai.Test
    ( </span><span class="hl_comment"><span class="mpre">-- * Session</span></span><span class="mpre">
      Session
    , runSession
      </span><span class="hl_comment"><span class="mpre">-- * Requests</span></span><span class="mpre">
    , request
    , srequest
    , SRequest (..)
    , SResponse (..)
    , defaultRequest
    , setPath
    , setRawPathInfo
      </span><span class="hl_comment"><span class="mpre">-- * Assertions</span></span><span class="mpre">
    , assertStatus
    , assertContentType
    , assertBody
    , assertBodyContains
    , assertHeader
    , assertNoHeader
    , WaiTestFailure (..)
    ) where

import Network.Wai
import Network.Wai.Internal (</span><a href="Network.Wai.Internal.html#loc_112_6_112_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_112_6_112_22&#39;)"><span class="mpre">ResponseReceived</span></a><span class="mpre"> (</span><a href="Network.Wai.Internal.html#loc_112_25_112_41" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_112_25_112_41&#39;)"><span class="mpre">ResponseReceived</span></a><span class="mpre">))
import Control.Monad.IO.Class (</span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="mpre">liftIO</span></a><span class="mpre">)
import Control.Monad.Trans.State (</span><a href="Control.Monad.Trans.State.Lazy.html#loc_142_9_142_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.State.Lazy.html#loc_142_9_142_15&#39;)"><span class="mpre">StateT</span></a><span class="mpre">, </span><a href="Control.Monad.Trans.State.Lazy.html#loc_149_1_149_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.State.Lazy.html#loc_149_1_149_11&#39;)"><span class="mpre">evalStateT</span></a><span class="mpre">)
import Control.Monad.Trans.Reader (</span><a href="Control.Monad.Trans.Reader.html#loc_92_9_92_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.Reader.html#loc_92_9_92_16&#39;)"><span class="mpre">ReaderT</span></a><span class="mpre">, </span><a href="Control.Monad.Trans.Reader.html#loc_92_35_92_45" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.Reader.html#loc_92_35_92_45&#39;)"><span class="mpre">runReaderT</span></a><span class="mpre">, </span><a href="Control.Monad.Trans.Reader.html#loc_146_1_146_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.Reader.html#loc_146_1_146_4&#39;)"><span class="mpre">ask</span></a><span class="mpre">)
import Control.Monad (</span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="mpre">unless</span></a><span class="mpre">)
import Control.DeepSeq (</span><a href="Control.DeepSeq.html#loc_85_1_85_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.DeepSeq.html#loc_85_1_85_8&#39;)"><span class="mpre">deepseq</span></a><span class="mpre">)
import Control.Exception (</span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="mpre">throwIO</span></a><span class="mpre">, Exception)
import Data.Typeable (</span><a href="Data.Typeable.Internal.html#loc_196_7_196_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Typeable.Internal.html#loc_196_7_196_15&#39;)"><span class="mpre">Typeable</span></a><span class="mpre">)
import Data.Map (Map)
import qualified Data.Map as Map
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 37, srcSpanStartColumn = 8, srcSpanEndLine = 37, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 38, srcSpanStartColumn = 18, srcSpanEndLine = 38, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as S8
import Blaze.ByteString.Builder (</span><a href="Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17&#39;)"><span class="mpre">toLazyByteString</span></a><span class="mpre">)
import qualified Blaze.ByteString.Builder as B
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 41, srcSpanStartColumn = 18, srcSpanEndLine = 41, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 42, srcSpanStartColumn = 18, srcSpanEndLine = 42, srcSpanEndColumn = 44}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy.Char8&quot;"><span class="mpre">Data.ByteString.Lazy.Char8</span></span><span class="mpre"> as L8
import qualified Network.HTTP.Types as H
import Data.CaseInsensitive (</span><a href="Data.CaseInsensitive.Internal.html#loc_86_6_86_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.CaseInsensitive.Internal.html#loc_86_6_86_8&#39;)"><span class="mpre">CI</span></a><span class="mpre">)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 45, srcSpanStartColumn = 18, srcSpanEndLine = 45, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as S
import qualified Data.Text as T
import qualified Data.Text.Encoding as TE
import Data.IORef
import Data.Monoid (</span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="mpre">mempty</span></a><span class="mpre">, </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="mpre">mappend</span></a><span class="mpre">)

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 51, srcSpanStartColumn = 1, srcSpanEndLine = 51, srcSpanEndColumn = 59}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 51, srcSpanStartColumn = 1, srcSpanEndLine = 51, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStart"><span class="mpre">type Session = ReaderT Application (StateT ClientState IO)</span></span><span class="mpre">

data </span><a name="loc_53_6_53_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_6_53_17&#39;)"><span class="hl_tycondecl"><span class="mpre">ClientState</span></span></a><span class="mpre"> = </span><a name="loc_53_20_53_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_20_53_31&#39;)"><span class="hl_condecl"><span class="mpre">ClientState</span></span></a><span class="mpre">
    { </span><span class="hl_fielddecl"><span class="mpre">_clientCookies</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Map</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
    }

</span><a href="#loc_58_1_58_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_10&#39;)"><span class="mpre">initState</span></a><span class="mpre"> :: </span><a href="#loc_53_6_53_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_6_53_17&#39;)"><span class="hl_tyconref"><span class="mpre">ClientState</span></span></a><span class="mpre">
</span><a name="loc_58_1_58_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_10&#39;)"><span class="hl_vardecl"><span class="mpre">initState</span></span></a><span class="mpre"> = </span><a href="#loc_53_20_53_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_20_53_31&#39;)"><span class="hl_conref"><span class="mpre">ClientState</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">Map.empty</span></span><span class="mpre">

</span><a href="#loc_61_1_61_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_11&#39;)"><span class="mpre">runSession</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Session</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Application</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_61_1_61_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_11&#39;)"><span class="hl_fundecl"><span class="mpre">runSession</span></span></a><span class="mpre"> </span><a name="loc_61_12_61_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_12_61_19&#39;)"><span class="hl_vardecl"><span class="mpre">session</span></span></a><span class="mpre"> </span><a name="loc_61_20_61_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_20_61_23&#39;)"><span class="hl_vardecl"><span class="mpre">app</span></span></a><span class="mpre"> = </span><a href="Control.Monad.Trans.State.Lazy.html#loc_149_1_149_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.State.Lazy.html#loc_149_1_149_11&#39;)"><span class="hl_varref"><span class="mpre">evalStateT</span></span></a><span class="mpre"> (</span><a href="Control.Monad.Trans.Reader.html#loc_92_35_92_45" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.Reader.html#loc_92_35_92_45&#39;)"><span class="hl_varref"><span class="mpre">runReaderT</span></span></a><span class="mpre"> </span><a href="#loc_61_12_61_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_12_61_19&#39;)"><span class="hl_varref"><span class="mpre">session</span></span></a><span class="mpre"> </span><a href="#loc_61_20_61_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_20_61_23&#39;)"><span class="hl_varref"><span class="mpre">app</span></span></a><span class="mpre">) </span><a href="#loc_58_1_58_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_10&#39;)"><span class="hl_varref"><span class="mpre">initState</span></span></a><span class="mpre">

data </span><a name="loc_63_6_63_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_6_63_14&#39;)"><span class="hl_tycondecl"><span class="mpre">SRequest</span></span></a><span class="mpre"> = </span><a name="loc_63_17_63_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_17_63_25&#39;)"><span class="hl_condecl"><span class="mpre">SRequest</span></span></a><span class="mpre">
    { </span><a name="loc_64_7_64_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_7_64_20&#39;)"><span class="hl_fielddecl"><span class="mpre">simpleRequest</span></span></a><span class="mpre"> :: </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre">
    , </span><a name="loc_65_7_65_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_7_65_24&#39;)"><span class="hl_fielddecl"><span class="mpre">simpleRequestBody</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre">
    }
data </span><a name="loc_67_6_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_6_67_15&#39;)"><span class="hl_tycondecl"><span class="mpre">SResponse</span></span></a><span class="mpre"> = </span><a name="loc_67_18_67_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_18_67_27&#39;)"><span class="hl_condecl"><span class="mpre">SResponse</span></span></a><span class="mpre">
    { </span><a name="loc_68_7_68_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_7_68_19&#39;)"><span class="hl_fielddecl"><span class="mpre">simpleStatus</span></span></a><span class="mpre"> :: </span><a href="Network.HTTP.Types.Status.html#loc_114_6_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_114_6_114_12&#39;)"><span class="hl_tyconref"><span class="mpre">H.Status</span></span></a><span class="mpre">
    , </span><a name="loc_69_7_69_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_7_69_20&#39;)"><span class="hl_fielddecl"><span class="mpre">simpleHeaders</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre">
    , </span><a name="loc_70_7_70_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_7_70_17&#39;)"><span class="hl_fielddecl"><span class="mpre">simpleBody</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre">
    }
    </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 72, srcSpanStartColumn = 5, srcSpanEndLine = 72, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 72, srcSpanStartColumn = 5, srcSpanEndLine = 72, srcSpanEndColumn = 13},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStar"><span class="mpre">deriving (Show, Eq)</span></span><span class="mpre">
</span><a href="#loc_74_1_74_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_8&#39;)"><span class="mpre">request</span></a><span class="mpre"> :: </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Session</span></span><span class="mpre"> </span><a href="#loc_67_6_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_6_67_15&#39;)"><span class="hl_tyconref"><span class="mpre">SResponse</span></span></a><span class="mpre">
</span><a name="loc_74_1_74_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_8&#39;)"><span class="hl_vardecl"><span class="mpre">request</span></span></a><span class="mpre"> = </span><a href="#loc_97_1_97_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_1_97_9&#39;)"><span class="hl_varref"><span class="mpre">srequest</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">flip</span></span><span class="mpre"> </span><a href="#loc_63_17_63_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_17_63_25&#39;)"><span class="hl_conref"><span class="mpre">SRequest</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.empty</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Set whole path (request path + query string).</span></span><span class="mpre">
</span><a href="#loc_78_1_78_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_8&#39;)"><span class="mpre">setPath</span></a><span class="mpre"> :: </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">S8.ByteString</span></span><span class="mpre"> -&gt; </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre">
</span><a name="loc_78_1_78_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_8&#39;)"><span class="hl_fundecl"><span class="mpre">setPath</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">req</span></span><span class="mpre"> </span><a name="loc_78_13_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_13_78_17&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 78, srcSpanStartColumn = 20, srcSpanEndLine = 83, srcSpanEndColumn = 4}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 78, srcSpanStartColumn = 24, srcSpanEndLine = 78, srcSpanEndColumn = 25},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanSt"><span class="mpre">req {
    pathInfo = segments
  , rawPathInfo = B.toByteString (H.encodePathSegments segments)
  , queryString = query
  , rawQueryString = (H.renderQuery True query)
  }</span></span><span class="mpre">
  where
    (</span><span class="hl_vardecl"><span class="mpre">segments</span></span><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">query</span></span><span class="mpre">) = </span><a href="Network.HTTP.Types.URI.html#loc_320_1_320_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.URI.html#loc_320_1_320_11&#39;)"><span class="hl_varref"><span class="mpre">H.decodePath</span></span></a><span class="mpre"> </span><a href="#loc_78_13_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_13_78_17&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre">

</span><a href="#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_15&#39;)"><span class="mpre">setRawPathInfo</span></a><span class="mpre"> :: </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">S8.ByteString</span></span><span class="mpre"> -&gt; </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre">
</span><a name="loc_88_1_88_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_15&#39;)"><span class="hl_fundecl"><span class="mpre">setRawPathInfo</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">r</span></span><span class="mpre"> </span><a name="loc_88_18_88_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_18_88_26&#39;)"><span class="hl_vardecl"><span class="mpre">rawPinfo</span></span></a><span class="mpre"> =
    let </span><span class="hl_vardecl"><span class="mpre">pInfo</span></span><span class="mpre"> = </span><a href="#loc_92_5_92_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_19&#39;)"><span class="hl_varref"><span class="mpre">dropFrontSlash</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Text.html#loc_1280_1_1280_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.html#loc_1280_1_1280_6&#39;)"><span class="hl_varref"><span class="mpre">T.split</span></span></a><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;/&#39;</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Text.Encoding.html#loc_307_1_307_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Encoding.html#loc_307_1_307_11&#39;)"><span class="hl_varref"><span class="mpre">TE.decodeUtf8</span></span></a><span class="mpre"> </span><a href="#loc_88_18_88_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_18_88_26&#39;)"><span class="hl_varref"><span class="mpre">rawPinfo</span></span></a><span class="mpre">
    in  </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 90, srcSpanStartColumn = 9, srcSpanEndLine = 90, srcSpanEndColumn = 55}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 90, srcSpanStartColumn = 11, srcSpanEndLine = 90, srcSpanEndColumn = 12},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanSt"><span class="mpre">r { rawPathInfo = rawPinfo, pathInfo = pInfo }</span></span><span class="mpre">
  where
    </span><a name="loc_92_5_92_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_19&#39;)"><span class="hl_fundecl"><span class="mpre">dropFrontSlash</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="hl_infix"><span class="mpre">:</span></span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">[]) = [] </span><span class="hl_comment"><span class="mpre">-- homepage, a single slash</span></span><span class="mpre">
    </span><a href="#loc_92_5_92_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_19&#39;)"><span class="hl_fundecl"><span class="mpre">dropFrontSlash</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_93_24_93_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_24_93_28&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre">) = </span><a href="#loc_93_24_93_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_24_93_28&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre">
    </span><a href="#loc_92_5_92_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_19&#39;)"><span class="hl_fundecl"><span class="mpre">dropFrontSlash</span></span></a><span class="mpre"> </span><a name="loc_94_20_94_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_20_94_24&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> = </span><a href="#loc_94_20_94_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_20_94_24&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre">

</span><a href="#loc_97_1_97_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_1_97_9&#39;)"><span class="mpre">srequest</span></a><span class="mpre"> :: </span><a href="#loc_63_6_63_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_6_63_14&#39;)"><span class="hl_tyconref"><span class="mpre">SRequest</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Session</span></span><span class="mpre"> </span><a href="#loc_67_6_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_6_67_15&#39;)"><span class="hl_tyconref"><span class="mpre">SResponse</span></span></a><span class="mpre">
</span><a name="loc_97_1_97_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_1_97_9&#39;)"><span class="hl_fundecl"><span class="mpre">srequest</span></span></a><span class="mpre"> (</span><a href="#loc_63_17_63_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_17_63_25&#39;)"><span class="hl_conref"><span class="mpre">SRequest</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">req</span></span><span class="mpre"> </span><a name="loc_97_24_97_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_24_97_27&#39;)"><span class="hl_vardecl"><span class="mpre">bod</span></span></a><span class="mpre">) = do
    </span><a name="loc_98_5_98_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_5_98_8&#39;)"><span class="hl_vardecl"><span class="mpre">app</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.Trans.Reader.html#loc_146_1_146_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.Reader.html#loc_146_1_146_4&#39;)"><span class="hl_varref"><span class="mpre">ask</span></span></a><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">refChunks</span></span><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.toChunks</span></span><span class="mpre"> </span><a href="#loc_97_24_97_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_24_97_27&#39;)"><span class="hl_varref"><span class="mpre">bod</span></span></a><span class="mpre">
    let </span><a name="loc_100_9_100_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_9_100_13&#39;)"><span class="hl_vardecl"><span class="mpre">req&#39;</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 100, srcSpanStartColumn = 16, srcSpanEndLine = 105, srcSpanEndColumn = 14}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 101, srcSpanStartColumn = 13, srcSpanEndLine = 101, srcSpanEndColumn = 14},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcS"><span class="mpre">req
            { requestBody = atomicModifyIORef refChunks $ \bss -&gt;
                case bss of
                    [] -&gt; ([], S.empty)
                    x:y -&gt; (y, x)
            }</span></span><span class="mpre">
    </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><a name="loc_107_9_107_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_12&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;runResponse gave no result&quot;</span></span><span class="mpre">
        </span><a href="Network.Wai.Internal.html#loc_112_25_112_41" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_112_25_112_41&#39;)"><span class="hl_conref"><span class="mpre">ResponseReceived</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_98_5_98_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_5_98_8&#39;)"><span class="hl_varref"><span class="mpre">app</span></span></a><span class="mpre"> </span><a href="#loc_100_9_100_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_9_100_13&#39;)"><span class="hl_varref"><span class="mpre">req&#39;</span></span></a><span class="mpre"> (</span><a href="#loc_114_1_114_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_1_114_12&#39;)"><span class="hl_varref"><span class="mpre">runResponse</span></span></a><span class="mpre"> </span><a href="#loc_107_9_107_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_12&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">)
        </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_107_9_107_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_12&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- FIXME cookie processing</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">--return sres</span></span><span class="mpre">

</span><a href="#loc_114_1_114_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_1_114_12&#39;)"><span class="mpre">runResponse</span></a><span class="mpre"> :: </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><a href="#loc_67_6_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_6_67_15&#39;)"><span class="hl_tyconref"><span class="mpre">SResponse</span></span></a><span class="mpre"> -&gt; </span><a href="Network.Wai.Internal.html#loc_74_6_74_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_74_6_74_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="Network.Wai.Internal.html#loc_112_6_112_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_112_6_112_22&#39;)"><span class="hl_tyconref"><span class="mpre">ResponseReceived</span></span></a><span class="mpre">
</span><a name="loc_114_1_114_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_1_114_12&#39;)"><span class="hl_fundecl"><span class="mpre">runResponse</span></span></a><span class="mpre"> </span><a name="loc_114_13_114_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_13_114_16&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> </span><a name="loc_114_17_114_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_17_114_20&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> = do
    </span><a name="loc_115_5_115_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_5_115_15&#39;)"><span class="hl_vardecl"><span class="mpre">refBuilder</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">
    let </span><a name="loc_116_9_116_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_9_116_12&#39;)"><span class="hl_fundecl"><span class="mpre">add</span></span></a><span class="mpre"> </span><a name="loc_116_13_116_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_13_116_14&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre"> = </span><a href="Data.IORef.html#loc_101_1_101_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_101_1_101_18&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef</span></span></a><span class="mpre"> </span><a href="#loc_115_5_115_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_5_115_15&#39;)"><span class="hl_varref"><span class="mpre">refBuilder</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_116_49_116_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_49_116_50&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_116_49_116_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_49_116_50&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_infix"><span class="mpre">`mappend`</span></span></a><span class="mpre"> </span><a href="#loc_116_13_116_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_13_116_14&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)
    </span><a href="#loc_126_12_126_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_12_126_20&#39;)"><span class="hl_varref"><span class="mpre">withBody</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_117_17_117_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_17_117_21&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_117_17_117_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_17_117_21&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre"> </span><a href="#loc_116_9_116_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_9_116_12&#39;)"><span class="hl_varref"><span class="mpre">add</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)
    </span><a name="loc_118_5_118_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_5_118_12&#39;)"><span class="hl_vardecl"><span class="mpre">builder</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_115_5_115_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_5_115_15&#39;)"><span class="hl_varref"><span class="mpre">refBuilder</span></span></a><span class="mpre">
    let </span><a name="loc_119_9_119_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_9_119_12&#39;)"><span class="hl_vardecl"><span class="mpre">lbs</span></span></a><span class="mpre"> = </span><a href="Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17&#39;)"><span class="hl_varref"><span class="mpre">toLazyByteString</span></span></a><span class="mpre"> </span><a href="#loc_118_5_118_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_5_118_12&#39;)"><span class="hl_varref"><span class="mpre">builder</span></span></a><span class="mpre">
        </span><a name="loc_120_9_120_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_9_120_12&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">L.length</span></span><span class="mpre"> </span><a href="#loc_119_9_119_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_9_119_12&#39;)"><span class="hl_varref"><span class="mpre">lbs</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- Force evaluation of the body to have exceptions thrown at the right</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- time.</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">seq</span></span><span class="mpre"> </span><a href="#loc_120_9_120_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_9_120_12&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_114_13_114_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_13_114_16&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_67_18_67_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_18_67_27&#39;)"><span class="hl_conref"><span class="mpre">SResponse</span></span></a><span class="mpre"> </span><a href="#loc_126_6_126_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_6_126_7&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_126_9_126_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_9_126_10&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17&#39;)"><span class="hl_varref"><span class="mpre">toLazyByteString</span></span></a><span class="mpre"> </span><a href="#loc_118_5_118_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_5_118_12&#39;)"><span class="hl_varref"><span class="mpre">builder</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Network.Wai.Internal.html#loc_112_25_112_41" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_112_25_112_41&#39;)"><span class="hl_conref"><span class="mpre">ResponseReceived</span></span></a><span class="mpre">
  where
    (</span><a name="loc_126_6_126_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_6_126_7&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">, </span><a name="loc_126_9_126_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_9_126_10&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre">, </span><a name="loc_126_12_126_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_12_126_20&#39;)"><span class="hl_vardecl"><span class="mpre">withBody</span></span></a><span class="mpre">) = </span><a href="Network.Wai.html#loc_198_1_198_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_198_1_198_17&#39;)"><span class="hl_varref"><span class="mpre">responseToStream</span></span></a><span class="mpre"> </span><a href="#loc_114_17_114_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_17_114_20&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">

</span><a href="#loc_129_1_129_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_11&#39;)"><span class="mpre">assertBool</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Session</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_129_1_129_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_11&#39;)"><span class="hl_fundecl"><span class="mpre">assertBool</span></span></a><span class="mpre"> </span><a name="loc_129_12_129_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_12_129_13&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_129_14_129_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_14_129_15&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = </span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="hl_varref"><span class="mpre">unless</span></span></a><span class="mpre"> </span><a href="#loc_129_14_129_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_14_129_15&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_135_1_135_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_1_135_14&#39;)"><span class="hl_varref"><span class="mpre">assertFailure</span></span></a><span class="mpre"> </span><a href="#loc_129_12_129_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_12_129_13&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">

</span><a href="#loc_132_1_132_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_13&#39;)"><span class="mpre">assertString</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Session</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_132_1_132_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_13&#39;)"><span class="hl_fundecl"><span class="mpre">assertString</span></span></a><span class="mpre"> </span><a name="loc_132_14_132_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_14_132_15&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = </span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="hl_varref"><span class="mpre">unless</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_132_14_132_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_14_132_15&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_135_1_135_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_1_135_14&#39;)"><span class="hl_varref"><span class="mpre">assertFailure</span></span></a><span class="mpre"> </span><a href="#loc_132_14_132_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_14_132_15&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">

</span><a href="#loc_135_1_135_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_1_135_14&#39;)"><span class="mpre">assertFailure</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Session</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_135_1_135_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_1_135_14&#39;)"><span class="hl_fundecl"><span class="mpre">assertFailure</span></span></a><span class="mpre"> </span><a name="loc_135_15_135_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_15_135_18&#39;)"><span class="hl_vardecl"><span class="mpre">msg</span></span></a><span class="mpre"> = </span><a href="#loc_135_15_135_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_15_135_18&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre"> </span><a href="Control.DeepSeq.html#loc_85_1_85_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.DeepSeq.html#loc_85_1_85_8&#39;)"><span class="hl_infix"><span class="mpre">`deepseq`</span></span></a><span class="mpre"> </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> (</span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> (</span><a href="#loc_137_23_137_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_23_137_37&#39;)"><span class="hl_conref"><span class="mpre">WaiTestFailure</span></span></a><span class="mpre"> </span><a href="#loc_135_15_135_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_15_135_18&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre">))

data </span><a name="loc_137_6_137_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_6_137_20&#39;)"><span class="hl_tycondecl"><span class="mpre">WaiTestFailure</span></span></a><span class="mpre"> = </span><a name="loc_137_23_137_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_23_137_37&#39;)"><span class="hl_condecl"><span class="mpre">WaiTestFailure</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
    </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 138, srcSpanStartColumn = 5, srcSpanEndLine = 138, srcSpanEndColumn = 34}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 138, srcSpanStartColumn = 5, srcSpanEndLine = 138, srcSpanEndColumn = 13},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpan"><span class="mpre">deriving (Show, Eq, Typeable)</span></span><span class="mpre">
instance </span><span class="hl_classref"><span class="mpre">Exception</span></span><span class="mpre"> </span><a href="#loc_137_6_137_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_6_137_20&#39;)"><span class="hl_tyconref"><span class="mpre">WaiTestFailure</span></span></a><span class="mpre">

</span><a href="#loc_142_1_142_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_18&#39;)"><span class="mpre">assertContentType</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><a href="#loc_67_6_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_6_67_15&#39;)"><span class="hl_tyconref"><span class="mpre">SResponse</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Session</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_142_1_142_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_18&#39;)"><span class="hl_fundecl"><span class="mpre">assertContentType</span></span></a><span class="mpre"> </span><a name="loc_142_19_142_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_19_142_21&#39;)"><span class="hl_vardecl"><span class="mpre">ct</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 142, srcSpanStartColumn = 22, srcSpanEndLine = 142, srcSpanEndColumn = 50}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 142, srcSpanStartColumn = 31, srcSpanEndLine = 142, srcSpanEndColumn = 32},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanSt"><span class="mpre">SResponse{simpleHeaders = h}</span></span><span class="mpre"> =
    case </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;content-type&quot;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">h</span></span><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><a href="#loc_132_1_132_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_13&#39;)"><span class="hl_varref"><span class="mpre">assertString</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre">
            [ </span><span class="hl_string"><span class="mpre">&quot;Expected content type &quot;</span></span><span class="mpre">
            , </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_142_19_142_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_19_142_21&#39;)"><span class="hl_varref"><span class="mpre">ct</span></span></a><span class="mpre">
            , </span><span class="hl_string"><span class="mpre">&quot;, but no content type provided&quot;</span></span><span class="mpre">
            ]
        </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_149_14_149_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_14_149_17&#39;)"><span class="hl_vardecl"><span class="mpre">ct&#39;</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_129_1_129_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_11&#39;)"><span class="hl_varref"><span class="mpre">assertBool</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre">
            [ </span><span class="hl_string"><span class="mpre">&quot;Expected content type &quot;</span></span><span class="mpre">
            , </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_142_19_142_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_19_142_21&#39;)"><span class="hl_varref"><span class="mpre">ct</span></span></a><span class="mpre">
            , </span><span class="hl_string"><span class="mpre">&quot;, but received &quot;</span></span><span class="mpre">
            , </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_149_14_149_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_14_149_17&#39;)"><span class="hl_varref"><span class="mpre">ct&#39;</span></span></a><span class="mpre">
            ]) (</span><a href="#loc_156_5_156_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_5_156_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_142_19_142_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_19_142_21&#39;)"><span class="hl_varref"><span class="mpre">ct</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_156_5_156_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_5_156_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_149_14_149_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_14_149_17&#39;)"><span class="hl_varref"><span class="mpre">ct&#39;</span></span></a><span class="mpre">)
  where
    </span><a name="loc_156_5_156_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_5_156_7&#39;)"><span class="hl_vardecl"><span class="mpre">go</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S8.takeWhile</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;;&#39;</span></span><span class="mpre">)

</span><a href="#loc_159_1_159_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_1_159_13&#39;)"><span class="mpre">assertStatus</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_67_6_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_6_67_15&#39;)"><span class="hl_tyconref"><span class="mpre">SResponse</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Session</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_159_1_159_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_1_159_13&#39;)"><span class="hl_fundecl"><span class="mpre">assertStatus</span></span></a><span class="mpre"> </span><a name="loc_159_14_159_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_14_159_15&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 159, srcSpanStartColumn = 16, srcSpanEndLine = 159, srcSpanEndColumn = 43}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 159, srcSpanStartColumn = 25, srcSpanEndLine = 159, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanSt"><span class="mpre">SResponse{simpleStatus = s}</span></span><span class="mpre"> = </span><a href="#loc_129_1_129_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_11&#39;)"><span class="hl_varref"><span class="mpre">assertBool</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre">
    [ </span><span class="hl_string"><span class="mpre">&quot;Expected status code &quot;</span></span><span class="mpre">
    , </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_159_14_159_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_14_159_15&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
    , </span><span class="hl_string"><span class="mpre">&quot;, but received &quot;</span></span><span class="mpre">
    , </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_166_5_166_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_5_166_7&#39;)"><span class="hl_varref"><span class="mpre">sc</span></span></a><span class="mpre">
    ]) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_159_14_159_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_14_159_15&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_166_5_166_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_5_166_7&#39;)"><span class="hl_varref"><span class="mpre">sc</span></span></a><span class="mpre">
  where
    </span><a name="loc_166_5_166_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_5_166_7&#39;)"><span class="hl_vardecl"><span class="mpre">sc</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">H.statusCode</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">s</span></span><span class="mpre">

</span><a href="#loc_169_1_169_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_1_169_11&#39;)"><span class="mpre">assertBody</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre"> -&gt; </span><a href="#loc_67_6_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_6_67_15&#39;)"><span class="hl_tyconref"><span class="mpre">SResponse</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Session</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_169_1_169_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_1_169_11&#39;)"><span class="hl_fundecl"><span class="mpre">assertBody</span></span></a><span class="mpre"> </span><a name="loc_169_12_169_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_12_169_15&#39;)"><span class="hl_vardecl"><span class="mpre">lbs</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 169, srcSpanStartColumn = 16, srcSpanEndLine = 169, srcSpanEndColumn = 44}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 169, srcSpanStartColumn = 25, srcSpanEndLine = 169, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanSt"><span class="mpre">SResponse{simpleBody = lbs&#39;}</span></span><span class="mpre"> = </span><a href="#loc_129_1_129_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_11&#39;)"><span class="hl_varref"><span class="mpre">assertBool</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre">
    [ </span><span class="hl_string"><span class="mpre">&quot;Expected response body &quot;</span></span><span class="mpre">
    , </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L8.unpack</span></span><span class="mpre"> </span><a href="#loc_169_12_169_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_12_169_15&#39;)"><span class="hl_varref"><span class="mpre">lbs</span></span></a><span class="mpre">
    , </span><span class="hl_string"><span class="mpre">&quot;, but received &quot;</span></span><span class="mpre">
    , </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L8.unpack</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">lbs&#39;</span></span><span class="mpre">
    ]) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_169_12_169_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_12_169_15&#39;)"><span class="hl_varref"><span class="mpre">lbs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">lbs&#39;</span></span><span class="mpre">

</span><a href="#loc_177_1_177_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_19&#39;)"><span class="mpre">assertBodyContains</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre"> -&gt; </span><a href="#loc_67_6_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_6_67_15&#39;)"><span class="hl_tyconref"><span class="mpre">SResponse</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Session</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_177_1_177_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_19&#39;)"><span class="hl_fundecl"><span class="mpre">assertBodyContains</span></span></a><span class="mpre"> </span><a name="loc_177_20_177_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_20_177_23&#39;)"><span class="hl_vardecl"><span class="mpre">lbs</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 177, srcSpanStartColumn = 24, srcSpanEndLine = 177, srcSpanEndColumn = 52}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 177, srcSpanStartColumn = 33, srcSpanEndLine = 177, srcSpanEndColumn = 34},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanSt"><span class="mpre">SResponse{simpleBody = lbs&#39;}</span></span><span class="mpre"> = </span><a href="#loc_129_1_129_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_11&#39;)"><span class="hl_varref"><span class="mpre">assertBool</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre">
    [ </span><span class="hl_string"><span class="mpre">&quot;Expected response body to contain &quot;</span></span><span class="mpre">
    , </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L8.unpack</span></span><span class="mpre"> </span><a href="#loc_177_20_177_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_20_177_23&#39;)"><span class="hl_varref"><span class="mpre">lbs</span></span></a><span class="mpre">
    , </span><span class="hl_string"><span class="mpre">&quot;, but received &quot;</span></span><span class="mpre">
    , </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L8.unpack</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">lbs&#39;</span></span><span class="mpre">
    ]) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_184_5_184_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_5_184_11&#39;)"><span class="hl_varref"><span class="mpre">strict</span></span></a><span class="mpre"> </span><a href="#loc_177_20_177_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_20_177_23&#39;)"><span class="hl_varref"><span class="mpre">lbs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`S.isInfixOf`</span></span><span class="mpre"> </span><a href="#loc_184_5_184_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_5_184_11&#39;)"><span class="hl_varref"><span class="mpre">strict</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">lbs&#39;</span></span><span class="mpre">
  where
    </span><a name="loc_184_5_184_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_5_184_11&#39;)"><span class="hl_vardecl"><span class="mpre">strict</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.concat</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.toChunks</span></span><span class="mpre">

</span><a href="#loc_187_1_187_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_1_187_13&#39;)"><span class="mpre">assertHeader</span></a><span class="mpre"> :: </span><a href="Data.CaseInsensitive.Internal.html#loc_86_6_86_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.CaseInsensitive.Internal.html#loc_86_6_86_8&#39;)"><span class="hl_tyconref"><span class="mpre">CI</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><a href="#loc_67_6_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_6_67_15&#39;)"><span class="hl_tyconref"><span class="mpre">SResponse</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Session</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_187_1_187_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_1_187_13&#39;)"><span class="hl_fundecl"><span class="mpre">assertHeader</span></span></a><span class="mpre"> </span><a name="loc_187_14_187_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_14_187_20&#39;)"><span class="hl_vardecl"><span class="mpre">header</span></span></a><span class="mpre"> </span><a name="loc_187_21_187_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_21_187_26&#39;)"><span class="hl_vardecl"><span class="mpre">value</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 187, srcSpanStartColumn = 27, srcSpanEndLine = 187, srcSpanEndColumn = 55}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 187, srcSpanStartColumn = 36, srcSpanEndLine = 187, srcSpanEndColumn = 37},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanSt"><span class="mpre">SResponse{simpleHeaders = h}</span></span><span class="mpre"> =
    case </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><a href="#loc_187_14_187_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_14_187_20&#39;)"><span class="hl_varref"><span class="mpre">header</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">h</span></span><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><a href="#loc_132_1_132_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_13&#39;)"><span class="hl_varref"><span class="mpre">assertString</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre">
            [ </span><span class="hl_string"><span class="mpre">&quot;Expected header &quot;</span></span><span class="mpre">
            , </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_187_14_187_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_14_187_20&#39;)"><span class="hl_varref"><span class="mpre">header</span></span></a><span class="mpre">
            , </span><span class="hl_string"><span class="mpre">&quot; to be &quot;</span></span><span class="mpre">
            , </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_187_21_187_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_21_187_26&#39;)"><span class="hl_varref"><span class="mpre">value</span></span></a><span class="mpre">
            , </span><span class="hl_string"><span class="mpre">&quot;, but it was not present&quot;</span></span><span class="mpre">
            ]
        </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_196_14_196_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_14_196_20&#39;)"><span class="hl_vardecl"><span class="mpre">value&#39;</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_129_1_129_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_11&#39;)"><span class="hl_varref"><span class="mpre">assertBool</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre">
            [ </span><span class="hl_string"><span class="mpre">&quot;Expected header &quot;</span></span><span class="mpre">
            , </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_187_14_187_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_14_187_20&#39;)"><span class="hl_varref"><span class="mpre">header</span></span></a><span class="mpre">
            , </span><span class="hl_string"><span class="mpre">&quot; to be &quot;</span></span><span class="mpre">
            , </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_187_21_187_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_21_187_26&#39;)"><span class="hl_varref"><span class="mpre">value</span></span></a><span class="mpre">
            , </span><span class="hl_string"><span class="mpre">&quot;, but received &quot;</span></span><span class="mpre">
            , </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_196_14_196_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_14_196_20&#39;)"><span class="hl_varref"><span class="mpre">value&#39;</span></span></a><span class="mpre">
            ]) (</span><a href="#loc_187_21_187_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_21_187_26&#39;)"><span class="hl_varref"><span class="mpre">value</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_196_14_196_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_14_196_20&#39;)"><span class="hl_varref"><span class="mpre">value&#39;</span></span></a><span class="mpre">)

</span><a href="#loc_206_1_206_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_1_206_15&#39;)"><span class="mpre">assertNoHeader</span></a><span class="mpre"> :: </span><a href="Data.CaseInsensitive.Internal.html#loc_86_6_86_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.CaseInsensitive.Internal.html#loc_86_6_86_8&#39;)"><span class="hl_tyconref"><span class="mpre">CI</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><a href="#loc_67_6_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_6_67_15&#39;)"><span class="hl_tyconref"><span class="mpre">SResponse</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Session</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_206_1_206_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_1_206_15&#39;)"><span class="hl_fundecl"><span class="mpre">assertNoHeader</span></span></a><span class="mpre"> </span><a name="loc_206_16_206_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_16_206_22&#39;)"><span class="hl_vardecl"><span class="mpre">header</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 206, srcSpanStartColumn = 23, srcSpanEndLine = 206, srcSpanEndColumn = 51}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanStartLine = 206, srcSpanStartColumn = 32, srcSpanEndLine = 206, srcSpanEndColumn = 33},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Test.hs&quot;, srcSpanSt"><span class="mpre">SResponse{simpleHeaders = h}</span></span><span class="mpre"> =
    case </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><a href="#loc_206_16_206_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_16_206_22&#39;)"><span class="hl_varref"><span class="mpre">header</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">h</span></span><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_209_14_209_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_14_209_15&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_132_1_132_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_13&#39;)"><span class="hl_varref"><span class="mpre">assertString</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre">
            [ </span><span class="hl_string"><span class="mpre">&quot;Unexpected header &quot;</span></span><span class="mpre">
            , </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_206_16_206_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_16_206_22&#39;)"><span class="hl_varref"><span class="mpre">header</span></span></a><span class="mpre">
            , </span><span class="hl_string"><span class="mpre">&quot; containing &quot;</span></span><span class="mpre">
            , </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_209_14_209_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_14_209_15&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
            ]
</span></div></body></html>