<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Data.ASN1.Serialize</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Data.ASN1.Serialize (getHeader, putHeader) where

import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/asn1-encoding-0.8.1.3/Data/ASN1/Serialize.hs&quot;, srcSpanStartLine = 10, srcSpanStartColumn = 18, srcSpanEndLine = 10, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import Data.ASN1.Get
import Data.ASN1.Internal
import Data.ASN1.Types
import Data.ASN1.Types.Lowlevel
import Data.Bits
import Data.Word
import Control.Applicative (</span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="mpre">(&lt;$&gt;)</span></a><span class="mpre">)
import Control.Monad

</span><span class="hl_comment"><span class="mpre">-- | parse an ASN1 header</span></span><span class="mpre">
</span><a href="#loc_22_1_22_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_1_22_10&#39;)"><span class="mpre">getHeader</span></a><span class="mpre"> :: </span><a href="Data.ASN1.Get.html#loc_74_9_74_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Get.html#loc_74_9_74_12&#39;)"><span class="hl_tyconref"><span class="mpre">Get</span></span></a><span class="mpre"> </span><a href="Data.ASN1.Types.Lowlevel.html#loc_39_6_39_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_39_6_39_16&#39;)"><span class="hl_tyconref"><span class="mpre">ASN1Header</span></span></a><span class="mpre">
</span><a name="loc_22_1_22_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_1_22_10&#39;)"><span class="hl_vardecl"><span class="mpre">getHeader</span></span></a><span class="mpre"> = do
        (</span><a name="loc_23_10_23_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_10_23_12&#39;)"><span class="hl_vardecl"><span class="mpre">cl</span></span></a><span class="mpre">,</span><a name="loc_23_13_23_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_13_23_15&#39;)"><span class="hl_vardecl"><span class="mpre">pc</span></span></a><span class="mpre">,</span><a name="loc_23_16_23_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_16_23_18&#39;)"><span class="hl_vardecl"><span class="mpre">t1</span></span></a><span class="mpre">) &lt;- </span><a href="#loc_30_1_30_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_1_30_15&#39;)"><span class="hl_varref"><span class="mpre">parseFirstWord</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Data.ASN1.Get.html#loc_194_1_194_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Get.html#loc_194_1_194_9&#39;)"><span class="hl_varref"><span class="mpre">getWord8</span></span></a><span class="mpre">
        </span><a name="loc_24_9_24_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_9_24_12&#39;)"><span class="hl_vardecl"><span class="mpre">tag</span></span></a><span class="mpre">        &lt;- if </span><a href="#loc_23_16_23_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_16_23_18&#39;)"><span class="hl_varref"><span class="mpre">t1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x1f</span></span><span class="mpre"> then </span><a href="#loc_39_1_39_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_11&#39;)"><span class="hl_varref"><span class="mpre">getTagLong</span></span></a><span class="mpre"> else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_23_16_23_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_16_23_18&#39;)"><span class="hl_varref"><span class="mpre">t1</span></span></a><span class="mpre">
        </span><a name="loc_25_9_25_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_9_25_12&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">        &lt;- </span><a href="#loc_57_1_57_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_10&#39;)"><span class="hl_varref"><span class="mpre">getLength</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.ASN1.Types.Lowlevel.html#loc_39_19_39_29" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_39_19_39_29&#39;)"><span class="hl_conref"><span class="mpre">ASN1Header</span></span></a><span class="mpre"> </span><a href="#loc_23_10_23_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_10_23_12&#39;)"><span class="hl_varref"><span class="mpre">cl</span></span></a><span class="mpre"> </span><a href="#loc_24_9_24_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_9_24_12&#39;)"><span class="hl_varref"><span class="mpre">tag</span></span></a><span class="mpre"> </span><a href="#loc_23_13_23_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_13_23_15&#39;)"><span class="hl_varref"><span class="mpre">pc</span></span></a><span class="mpre"> </span><a href="#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_9_25_12&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Parse the first word of an header</span></span><span class="mpre">
</span><a href="#loc_30_1_30_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_1_30_15&#39;)"><span class="mpre">parseFirstWord</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; (</span><a href="Data.ASN1.Types.Lowlevel.html#loc_23_6_23_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_23_6_23_15&#39;)"><span class="hl_tyconref"><span class="mpre">ASN1Class</span></span></a><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">ASN1Tag</span></span><span class="mpre">)
</span><a name="loc_30_1_30_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_1_30_15&#39;)"><span class="hl_fundecl"><span class="mpre">parseFirstWord</span></span></a><span class="mpre"> </span><a name="loc_30_16_30_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_16_30_17&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> = (</span><a href="#loc_32_17_32_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_17_32_19&#39;)"><span class="hl_varref"><span class="mpre">cl</span></span></a><span class="mpre">,</span><a href="#loc_33_17_33_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_17_33_19&#39;)"><span class="hl_varref"><span class="mpre">pc</span></span></a><span class="mpre">,</span><a href="#loc_34_17_34_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_17_34_19&#39;)"><span class="hl_varref"><span class="mpre">t1</span></span></a><span class="mpre">)
        where
                </span><a name="loc_32_17_32_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_17_32_19&#39;)"><span class="hl_vardecl"><span class="mpre">cl</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">toEnum</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> (</span><a href="#loc_30_16_30_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_16_30_17&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">6</span></span><span class="mpre">)
                </span><a name="loc_33_17_33_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_17_33_19&#39;)"><span class="hl_vardecl"><span class="mpre">pc</span></span></a><span class="mpre"> = </span><a href="Data.Bits.html#loc_167_5_167_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_167_5_167_12&#39;)"><span class="hl_varref"><span class="mpre">testBit</span></span></a><span class="mpre"> </span><a href="#loc_30_16_30_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_16_30_17&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">5</span></span><span class="mpre">
                </span><a name="loc_34_17_34_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_17_34_19&#39;)"><span class="hl_vardecl"><span class="mpre">t1</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_30_16_30_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_16_30_17&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x1f</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">{- when the first tag is 0x1f, the tag is in long form, where
 - we get bytes while the 7th bit is set. -}</span></span><span class="mpre">
</span><a href="#loc_39_1_39_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_11&#39;)"><span class="mpre">getTagLong</span></a><span class="mpre"> :: </span><a href="Data.ASN1.Get.html#loc_74_9_74_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Get.html#loc_74_9_74_12&#39;)"><span class="hl_tyconref"><span class="mpre">Get</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ASN1Tag</span></span><span class="mpre">
</span><a name="loc_39_1_39_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_11&#39;)"><span class="hl_vardecl"><span class="mpre">getTagLong</span></span></a><span class="mpre"> = do
        </span><a name="loc_40_9_40_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_9_40_10&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Data.ASN1.Get.html#loc_194_1_194_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Get.html#loc_194_1_194_9&#39;)"><span class="hl_varref"><span class="mpre">getWord8</span></span></a><span class="mpre">
        </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_40_9_40_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_9_40_10&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x80</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;not canonical encoding of tag&quot;</span></span><span class="mpre">
        if </span><a href="Data.Bits.html#loc_167_5_167_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_167_5_167_12&#39;)"><span class="hl_varref"><span class="mpre">testBit</span></span></a><span class="mpre"> </span><a href="#loc_40_9_40_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_9_40_10&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">7</span></span><span class="mpre">
                then </span><a href="#loc_45_15_45_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_15_45_19&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> (</span><a href="Data.Bits.html#loc_161_5_161_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_161_5_161_13&#39;)"><span class="hl_varref"><span class="mpre">clearBit</span></span></a><span class="mpre"> </span><a href="#loc_40_9_40_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_9_40_10&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">7</span></span><span class="mpre">)
                else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_40_9_40_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_9_40_10&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">
        where </span><a name="loc_45_15_45_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_15_45_19&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_45_20_45_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_20_45_21&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = do
                </span><a name="loc_46_17_46_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_17_46_18&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Data.ASN1.Get.html#loc_194_1_194_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Get.html#loc_194_1_194_9&#39;)"><span class="hl_varref"><span class="mpre">getWord8</span></span></a><span class="mpre">
                if </span><a href="Data.Bits.html#loc_167_5_167_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_167_5_167_12&#39;)"><span class="hl_varref"><span class="mpre">testBit</span></span></a><span class="mpre"> </span><a href="#loc_46_17_46_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_17_46_18&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">7</span></span><span class="mpre">
                        then </span><a href="#loc_45_15_45_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_15_45_19&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> (</span><a href="#loc_45_20_45_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_20_45_21&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_200_5_200_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_200_5_200_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftL`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">7</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="Data.Bits.html#loc_161_5_161_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_161_5_161_13&#39;)"><span class="hl_varref"><span class="mpre">clearBit</span></span></a><span class="mpre"> </span><a href="#loc_46_17_46_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_17_46_18&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">7</span></span><span class="mpre">)
                        else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_45_20_45_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_20_45_21&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_200_5_200_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_200_5_200_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftL`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">7</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_46_17_46_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_17_46_18&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">{- get the asn1 length which is either short form if 7th bit is not set,
 - indefinite form is the 7 bit is set and every other bits clear,
 - or long form otherwise, where the next bytes will represent the length
 -}</span></span><span class="mpre">
</span><a href="#loc_57_1_57_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_10&#39;)"><span class="mpre">getLength</span></a><span class="mpre"> :: </span><a href="Data.ASN1.Get.html#loc_74_9_74_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Get.html#loc_74_9_74_12&#39;)"><span class="hl_tyconref"><span class="mpre">Get</span></span></a><span class="mpre"> </span><a href="Data.ASN1.Types.Lowlevel.html#loc_33_6_33_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_33_6_33_16&#39;)"><span class="hl_tyconref"><span class="mpre">ASN1Length</span></span></a><span class="mpre">
</span><a name="loc_57_1_57_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_10&#39;)"><span class="hl_vardecl"><span class="mpre">getLength</span></span></a><span class="mpre"> = do
        </span><a name="loc_58_9_58_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_11&#39;)"><span class="hl_vardecl"><span class="mpre">l1</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Data.ASN1.Get.html#loc_194_1_194_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Get.html#loc_194_1_194_9&#39;)"><span class="hl_varref"><span class="mpre">getWord8</span></span></a><span class="mpre">
        if </span><a href="Data.Bits.html#loc_167_5_167_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_167_5_167_12&#39;)"><span class="hl_varref"><span class="mpre">testBit</span></span></a><span class="mpre"> </span><a href="#loc_58_9_58_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_11&#39;)"><span class="hl_varref"><span class="mpre">l1</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">7</span></span><span class="mpre">
                then case </span><a href="Data.Bits.html#loc_161_5_161_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_161_5_161_13&#39;)"><span class="hl_varref"><span class="mpre">clearBit</span></span></a><span class="mpre"> </span><a href="#loc_58_9_58_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_11&#39;)"><span class="hl_varref"><span class="mpre">l1</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">7</span></span><span class="mpre"> of
                        </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">   -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.ASN1.Types.Lowlevel.html#loc_35_19_35_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_35_19_35_32&#39;)"><span class="hl_conref"><span class="mpre">LenIndefinite</span></span></a><span class="mpre">
                        </span><a name="loc_62_25_62_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_25_62_28&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> -&gt; do
                                </span><a name="loc_63_33_63_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_33_63_35&#39;)"><span class="hl_vardecl"><span class="mpre">lw</span></span></a><span class="mpre"> &lt;- </span><a href="Data.ASN1.Get.html#loc_188_1_188_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Get.html#loc_188_1_188_9&#39;)"><span class="hl_varref"><span class="mpre">getBytes</span></span></a><span class="mpre"> </span><a href="#loc_62_25_62_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_25_62_28&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
                                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Data.ASN1.Types.Lowlevel.html#loc_34_19_34_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_34_19_34_26&#39;)"><span class="hl_conref"><span class="mpre">LenLong</span></span></a><span class="mpre"> </span><a href="#loc_62_25_62_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_25_62_28&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_69_17_69_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_17_69_23&#39;)"><span class="hl_varref"><span class="mpre">uintbs</span></span></a><span class="mpre"> </span><a href="#loc_63_33_63_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_33_63_35&#39;)"><span class="hl_varref"><span class="mpre">lw</span></span></a><span class="mpre">)
                else
                        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Data.ASN1.Types.Lowlevel.html#loc_33_19_33_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_33_19_33_27&#39;)"><span class="hl_conref"><span class="mpre">LenShort</span></span></a><span class="mpre"> </span><a href="#loc_58_9_58_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_11&#39;)"><span class="hl_varref"><span class="mpre">l1</span></span></a><span class="mpre">)
        where
                </span><span class="hl_comment"><span class="mpre">{- uintbs return the unsigned int represented by the bytes -}</span></span><span class="mpre">
                </span><a name="loc_69_17_69_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_17_69_23&#39;)"><span class="hl_vardecl"><span class="mpre">uintbs</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.foldl</span></span><span class="mpre"> (\</span><a name="loc_69_36_69_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_36_69_39&#39;)"><span class="hl_vardecl"><span class="mpre">acc</span></span></a><span class="mpre"> </span><a name="loc_69_40_69_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_40_69_41&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_69_36_69_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_36_69_39&#39;)"><span class="hl_varref"><span class="mpre">acc</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_200_5_200_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_200_5_200_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftL`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_69_40_69_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_40_69_41&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | putIdentifier encode an ASN1 Identifier into a marshalled value</span></span><span class="mpre">
</span><a href="#loc_73_1_73_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_10&#39;)"><span class="mpre">putHeader</span></a><span class="mpre"> :: </span><a href="Data.ASN1.Types.Lowlevel.html#loc_39_6_39_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_39_6_39_16&#39;)"><span class="hl_tyconref"><span class="mpre">ASN1Header</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_73_1_73_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_10&#39;)"><span class="hl_fundecl"><span class="mpre">putHeader</span></span></a><span class="mpre"> (</span><a href="Data.ASN1.Types.Lowlevel.html#loc_39_19_39_29" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_39_19_39_29&#39;)"><span class="hl_conref"><span class="mpre">ASN1Header</span></span></a><span class="mpre"> </span><a name="loc_73_23_73_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_23_73_25&#39;)"><span class="hl_vardecl"><span class="mpre">cl</span></span></a><span class="mpre"> </span><a name="loc_73_26_73_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_26_73_29&#39;)"><span class="hl_vardecl"><span class="mpre">tag</span></span></a><span class="mpre"> </span><a name="loc_73_30_73_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_30_73_32&#39;)"><span class="hl_vardecl"><span class="mpre">pc</span></span></a><span class="mpre"> </span><a name="loc_73_33_73_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_33_73_36&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre">
    [</span><span class="hl_varref"><span class="mpre">B.singleton</span></span><span class="mpre"> </span><a href="#loc_80_9_80_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_14&#39;)"><span class="hl_varref"><span class="mpre">word1</span></span></a><span class="mpre">
    ,if </span><a href="#loc_73_26_73_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_26_73_29&#39;)"><span class="hl_varref"><span class="mpre">tag</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x1f</span></span><span class="mpre"> then </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre"> else </span><a href="#loc_82_9_82_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_9_82_14&#39;)"><span class="hl_varref"><span class="mpre">tagBS</span></span></a><span class="mpre">
    ,</span><a href="#loc_81_9_81_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_9_81_14&#39;)"><span class="hl_varref"><span class="mpre">lenBS</span></span></a><span class="mpre">]
  where </span><a name="loc_77_9_77_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_9_77_12&#39;)"><span class="hl_vardecl"><span class="mpre">cli</span></span></a><span class="mpre">   = </span><a href="Data.Bits.html#loc_200_5_200_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_200_5_200_11&#39;)"><span class="hl_varref"><span class="mpre">shiftL</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromEnum</span></span><span class="mpre"> </span><a href="#loc_73_23_73_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_23_73_25&#39;)"><span class="hl_varref"><span class="mpre">cl</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">6</span></span><span class="mpre">
        </span><a name="loc_78_9_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_9_78_14&#39;)"><span class="hl_vardecl"><span class="mpre">pcval</span></span></a><span class="mpre"> = </span><a href="Data.Bits.html#loc_200_5_200_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_200_5_200_11&#39;)"><span class="hl_varref"><span class="mpre">shiftL</span></span></a><span class="mpre"> (if </span><a href="#loc_73_30_73_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_30_73_32&#39;)"><span class="hl_varref"><span class="mpre">pc</span></span></a><span class="mpre"> then </span><span class="hl_num"><span class="mpre">0x1</span></span><span class="mpre"> else </span><span class="hl_num"><span class="mpre">0x0</span></span><span class="mpre">) </span><span class="hl_num"><span class="mpre">5</span></span><span class="mpre">
        </span><a name="loc_79_9_79_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_9_79_13&#39;)"><span class="hl_vardecl"><span class="mpre">tag0</span></span></a><span class="mpre">  = if </span><a href="#loc_73_26_73_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_26_73_29&#39;)"><span class="hl_varref"><span class="mpre">tag</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x1f</span></span><span class="mpre"> then </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_73_26_73_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_26_73_29&#39;)"><span class="hl_varref"><span class="mpre">tag</span></span></a><span class="mpre"> else </span><span class="hl_num"><span class="mpre">0x1f</span></span><span class="mpre">
        </span><a name="loc_80_9_80_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_14&#39;)"><span class="hl_vardecl"><span class="mpre">word1</span></span></a><span class="mpre"> = </span><a href="#loc_77_9_77_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_9_77_12&#39;)"><span class="hl_varref"><span class="mpre">cli</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_78_9_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_9_78_14&#39;)"><span class="hl_varref"><span class="mpre">pcval</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_79_9_79_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_9_79_13&#39;)"><span class="hl_varref"><span class="mpre">tag0</span></span></a><span class="mpre">
        </span><a name="loc_81_9_81_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_9_81_14&#39;)"><span class="hl_vardecl"><span class="mpre">lenBS</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.pack</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_87_1_87_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_1_87_10&#39;)"><span class="hl_varref"><span class="mpre">putLength</span></span></a><span class="mpre"> </span><a href="#loc_73_33_73_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_33_73_36&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
        </span><a name="loc_82_9_82_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_9_82_14&#39;)"><span class="hl_vardecl"><span class="mpre">tagBS</span></span></a><span class="mpre"> = </span><a href="Data.ASN1.Internal.html#loc_65_1_65_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Internal.html#loc_65_1_65_23&#39;)"><span class="hl_varref"><span class="mpre">putVarEncodingIntegral</span></span></a><span class="mpre"> </span><a href="#loc_73_26_73_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_26_73_29&#39;)"><span class="hl_varref"><span class="mpre">tag</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{- | putLength encode a length into a ASN1 length.
 - see getLength for the encoding rules -}</span></span><span class="mpre">
</span><a href="#loc_87_1_87_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_1_87_10&#39;)"><span class="mpre">putLength</span></a><span class="mpre"> :: </span><a href="Data.ASN1.Types.Lowlevel.html#loc_33_6_33_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_33_6_33_16&#39;)"><span class="hl_tyconref"><span class="mpre">ASN1Length</span></span></a><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">]
</span><a name="loc_87_1_87_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_1_87_10&#39;)"><span class="hl_fundecl"><span class="mpre">putLength</span></span></a><span class="mpre"> (</span><a href="Data.ASN1.Types.Lowlevel.html#loc_33_19_33_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_33_19_33_27&#39;)"><span class="hl_conref"><span class="mpre">LenShort</span></span></a><span class="mpre"> </span><a name="loc_87_21_87_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_21_87_22&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">)
        | </span><a href="#loc_87_21_87_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_21_87_22&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><a href="#loc_87_21_87_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_21_87_22&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x7f</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;putLength: short length is not between 0x0 and 0x80&quot;</span></span><span class="mpre">
        | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">         = [</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_87_21_87_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_21_87_22&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">]
</span><a href="#loc_87_1_87_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_1_87_10&#39;)"><span class="hl_fundecl"><span class="mpre">putLength</span></span></a><span class="mpre"> (</span><a href="Data.ASN1.Types.Lowlevel.html#loc_34_19_34_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_34_19_34_26&#39;)"><span class="hl_conref"><span class="mpre">LenLong</span></span></a><span class="mpre"> _ </span><a name="loc_90_22_90_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_22_90_23&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">)
        | </span><a href="#loc_90_22_90_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_22_90_23&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">     = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;putLength: long length is negative&quot;</span></span><span class="mpre">
        | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="#loc_95_25_95_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_25_95_33&#39;)"><span class="hl_varref"><span class="mpre">lenbytes</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_94_25_94_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_25_94_27&#39;)"><span class="hl_varref"><span class="mpre">lw</span></span></a><span class="mpre">
                where
                        </span><a name="loc_94_25_94_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_25_94_27&#39;)"><span class="hl_vardecl"><span class="mpre">lw</span></span></a><span class="mpre">       = </span><a href="Data.ASN1.Internal.html#loc_27_1_27_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Internal.html#loc_27_1_27_12&#39;)"><span class="hl_varref"><span class="mpre">bytesOfUInt</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_90_22_90_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_22_90_23&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
                        </span><a name="loc_95_25_95_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_25_95_33&#39;)"><span class="hl_vardecl"><span class="mpre">lenbytes</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">length</span></span><span class="mpre"> </span><a href="#loc_94_25_94_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_25_94_27&#39;)"><span class="hl_varref"><span class="mpre">lw</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x80</span></span><span class="mpre">)
</span><a href="#loc_87_1_87_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_1_87_10&#39;)"><span class="hl_fundecl"><span class="mpre">putLength</span></span></a><span class="mpre"> (</span><a href="Data.ASN1.Types.Lowlevel.html#loc_35_19_35_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ASN1.Types.Lowlevel.html#loc_35_19_35_32&#39;)"><span class="hl_conref"><span class="mpre">LenIndefinite</span></span></a><span class="mpre">) = [</span><span class="hl_num"><span class="mpre">0x80</span></span><span class="mpre">]
</span></div></body></html>