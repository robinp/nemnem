<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE GeneralizedNewtypeDeriving #-}
{-# LANGUAGE MultiParamTypeClasses #-}
{-# LANGUAGE CPP #-}
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Network.TLS.Record.State</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Network.TLS.Record.State
    ( CryptState(..)
    , MacState(..)
    , RecordState(..)
    , newRecordState
    , RecordM
    , runRecordM
    , getRecordVersion
    , setRecordIV
    , withCompression
    , computeDigest
    , makeDigest
    ) where

import Data.Word
import Control.Applicative
import Control.Monad.State
import Control.Monad.Error
import Network.TLS.Compression
import Network.TLS.Cipher
import Network.TLS.Struct
import Network.TLS.Wire

import Network.TLS.Packet
import Network.TLS.MAC
import Network.TLS.Util

import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStartLine = 38, srcSpanStartColumn = 18, srcSpanEndLine = 38, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B

data </span><a name="loc_40_6_40_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_6_40_16&#39;)"><span class="hl_tycondecl"><span class="mpre">CryptState</span></span></a><span class="mpre"> = </span><span class="hl_condecl"><span class="mpre">CryptState</span></span><span class="mpre">
    { </span><a name="loc_41_7_41_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_7_41_13&#39;)"><span class="hl_fielddecl"><span class="mpre">cstKey</span></span></a><span class="mpre">        :: !</span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre">
    , </span><a name="loc_42_7_42_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_7_42_12&#39;)"><span class="hl_fielddecl"><span class="mpre">cstIV</span></span></a><span class="mpre">         :: !</span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre">
    , </span><a name="loc_43_7_43_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_7_43_19&#39;)"><span class="hl_fielddecl"><span class="mpre">cstMacSecret</span></span></a><span class="mpre">  :: !</span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre">
    } </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStartLine = 44, srcSpanStartColumn = 7, srcSpanEndLine = 44, srcSpanEndColumn = 22}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStartLine = 44, srcSpanStartColumn = 7, srcSpanEndLine = 44, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStar"><span class="mpre">deriving (Show)</span></span><span class="mpre">

newtype </span><a name="loc_46_9_46_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_17&#39;)"><span class="hl_tycondecl"><span class="mpre">MacState</span></span></a><span class="mpre"> = </span><a name="loc_46_20_46_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_20_46_28&#39;)"><span class="hl_condecl"><span class="mpre">MacState</span></span></a><span class="mpre">
    { </span><a name="loc_47_7_47_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_7_47_17&#39;)"><span class="hl_fielddecl"><span class="mpre">msSequence</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word64</span></span><span class="mpre">
    } </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStartLine = 48, srcSpanStartColumn = 7, srcSpanEndLine = 48, srcSpanEndColumn = 22}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStartLine = 48, srcSpanStartColumn = 7, srcSpanEndLine = 48, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStar"><span class="mpre">deriving (Show)</span></span><span class="mpre">

data </span><a name="loc_50_6_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_17&#39;)"><span class="hl_tycondecl"><span class="mpre">RecordState</span></span></a><span class="mpre"> = </span><span class="hl_condecl"><span class="mpre">RecordState</span></span><span class="mpre">
    { </span><a name="loc_51_7_51_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_7_51_15&#39;)"><span class="hl_fielddecl"><span class="mpre">stCipher</span></span></a><span class="mpre">      :: </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.TLS.Cipher.html#loc_82_6_82_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_82_6_82_12&#39;)"><span class="hl_tyconref"><span class="mpre">Cipher</span></span></a><span class="mpre">
    , </span><a name="loc_52_7_52_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_7_52_20&#39;)"><span class="hl_fielddecl"><span class="mpre">stCompression</span></span></a><span class="mpre"> :: </span><a href="Network.TLS.Compression.html#loc_38_6_38_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Compression.html#loc_38_6_38_17&#39;)"><span class="hl_tyconref"><span class="mpre">Compression</span></span></a><span class="mpre">
    , </span><a name="loc_53_7_53_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_7_53_19&#39;)"><span class="hl_fielddecl"><span class="mpre">stCryptState</span></span></a><span class="mpre">  :: !</span><a href="#loc_40_6_40_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_6_40_16&#39;)"><span class="hl_tyconref"><span class="mpre">CryptState</span></span></a><span class="mpre">
    , </span><a name="loc_54_7_54_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_7_54_17&#39;)"><span class="hl_fielddecl"><span class="mpre">stMacState</span></span></a><span class="mpre">    :: !</span><a href="#loc_46_9_46_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_17&#39;)"><span class="hl_tyconref"><span class="mpre">MacState</span></span></a><span class="mpre">
    } </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStartLine = 55, srcSpanStartColumn = 7, srcSpanEndLine = 55, srcSpanEndColumn = 22}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStartLine = 55, srcSpanStartColumn = 7, srcSpanEndLine = 55, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStar"><span class="mpre">deriving (Show)</span></span><span class="mpre">

newtype </span><a name="loc_57_9_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_16&#39;)"><span class="hl_tycondecl"><span class="mpre">RecordM</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_57_21_57_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_21_57_28&#39;)"><span class="hl_condecl"><span class="mpre">RecordM</span></span></a><span class="mpre"> { </span><a name="loc_57_31_57_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_31_57_41&#39;)"><span class="hl_fielddecl"><span class="mpre">runRecordM</span></span></a><span class="mpre"> :: </span><a href="Network.TLS.Types.html#loc_25_6_25_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_6_25_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre">
                                         -&gt; </span><a href="#loc_50_6_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_17&#39;)"><span class="hl_tyconref"><span class="mpre">RecordState</span></span></a><span class="mpre">
                                         -&gt; </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_121_6_121_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_121_6_121_14&#39;)"><span class="hl_tyconref"><span class="mpre">TLSError</span></span></a><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><a href="#loc_50_6_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_17&#39;)"><span class="hl_tyconref"><span class="mpre">RecordState</span></span></a><span class="mpre">) }

instance </span><a href="Control.Applicative.html#loc_113_20_113_31" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_113_20_113_31&#39;)"><span class="hl_classref"><span class="mpre">Applicative</span></span></a><span class="mpre"> </span><a href="#loc_57_9_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_16&#39;)"><span class="hl_tyconref"><span class="mpre">RecordM</span></span></a><span class="mpre"> where
    </span><a href="Control.Applicative.html#loc_115_5_115_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_115_5_115_9&#39;)"><span class="hl_vardecl"><span class="mpre">pure</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre">
    </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_vardecl"><span class="mpre">(&lt;*&gt;)</span></span></a><span class="mpre"> = </span><a href="Control.Monad.html#loc_312_1_312_3" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_312_1_312_3&#39;)"><span class="hl_varref"><span class="mpre">ap</span></span></a><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Monad</span></span><span class="mpre"> </span><a href="#loc_57_9_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_16&#39;)"><span class="hl_tyconref"><span class="mpre">RecordM</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">return</span></span><span class="mpre"> </span><a name="loc_66_12_66_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_12_66_13&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">  = </span><a href="#loc_57_21_57_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_21_57_28&#39;)"><span class="hl_conref"><span class="mpre">RecordM</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \_ </span><a name="loc_66_30_66_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_30_66_32&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre">  -&gt; </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="#loc_66_12_66_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_12_66_13&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">, </span><a href="#loc_66_30_66_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_30_66_32&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">)
    </span><a name="loc_67_5_67_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_5_67_7&#39;)"><span class="hl_vardecl"><span class="mpre">m1</span></span></a><span class="mpre"> </span><span class="hl_fundecl"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a name="loc_67_12_67_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_12_67_14&#39;)"><span class="hl_vardecl"><span class="mpre">m2</span></span></a><span class="mpre"> = </span><a href="#loc_57_21_57_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_21_57_28&#39;)"><span class="hl_conref"><span class="mpre">RecordM</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_67_28_67_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_28_67_31&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a name="loc_67_32_67_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_32_67_34&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> -&gt; do
                    case </span><a href="#loc_57_31_57_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_31_57_41&#39;)"><span class="hl_varref"><span class="mpre">runRecordM</span></span></a><span class="mpre"> </span><a href="#loc_67_5_67_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_5_67_7&#39;)"><span class="hl_varref"><span class="mpre">m1</span></span></a><span class="mpre"> </span><a href="#loc_67_28_67_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_28_67_31&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_67_32_67_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_32_67_34&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre"> of
                        </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_69_30_69_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_30_69_33&#39;)"><span class="hl_vardecl"><span class="mpre">err</span></span></a><span class="mpre">       -&gt; </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_69_30_69_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_30_69_33&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre">
                        </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a name="loc_70_32_70_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_32_70_33&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">, </span><a name="loc_70_35_70_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_35_70_38&#39;)"><span class="hl_vardecl"><span class="mpre">st2</span></span></a><span class="mpre">) -&gt; </span><a href="#loc_57_31_57_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_31_57_41&#39;)"><span class="hl_varref"><span class="mpre">runRecordM</span></span></a><span class="mpre"> (</span><a href="#loc_67_12_67_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_12_67_14&#39;)"><span class="hl_varref"><span class="mpre">m2</span></span></a><span class="mpre"> </span><a href="#loc_70_32_70_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_32_70_33&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">) </span><a href="#loc_67_28_67_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_28_67_31&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_70_35_70_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_35_70_38&#39;)"><span class="hl_varref"><span class="mpre">st2</span></span></a><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Functor</span></span><span class="mpre"> </span><a href="#loc_57_9_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_16&#39;)"><span class="hl_tyconref"><span class="mpre">RecordM</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">fmap</span></span><span class="mpre"> </span><a name="loc_73_10_73_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_11&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_73_12_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_12_73_13&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><a href="#loc_57_21_57_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_21_57_28&#39;)"><span class="hl_conref"><span class="mpre">RecordM</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_73_27_73_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_27_73_30&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a name="loc_73_31_73_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_31_73_33&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> -&gt;
                case </span><a href="#loc_57_31_57_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_31_57_41&#39;)"><span class="hl_varref"><span class="mpre">runRecordM</span></span></a><span class="mpre"> </span><a href="#loc_73_12_73_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_12_73_13&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_73_27_73_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_27_73_30&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_73_31_73_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_31_73_33&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre"> of
                    </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_75_26_75_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_26_75_29&#39;)"><span class="hl_vardecl"><span class="mpre">err</span></span></a><span class="mpre">       -&gt; </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_75_26_75_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_26_75_29&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre">
                    </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a name="loc_76_28_76_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_28_76_29&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">, </span><a name="loc_76_31_76_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_31_76_34&#39;)"><span class="hl_vardecl"><span class="mpre">st2</span></span></a><span class="mpre">) -&gt; </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="#loc_73_10_73_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_10_73_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_76_28_76_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_28_76_29&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">, </span><a href="#loc_76_31_76_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_31_76_34&#39;)"><span class="hl_varref"><span class="mpre">st2</span></span></a><span class="mpre">)

</span><a href="#loc_79_1_79_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_17&#39;)"><span class="mpre">getRecordVersion</span></a><span class="mpre"> :: </span><a href="#loc_57_9_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_16&#39;)"><span class="hl_tyconref"><span class="mpre">RecordM</span></span></a><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_25_6_25_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_6_25_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre">
</span><a name="loc_79_1_79_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_17&#39;)"><span class="hl_vardecl"><span class="mpre">getRecordVersion</span></span></a><span class="mpre"> = </span><a href="#loc_57_21_57_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_21_57_28&#39;)"><span class="hl_conref"><span class="mpre">RecordM</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_79_31_79_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_31_79_34&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a name="loc_79_35_79_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_35_79_37&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="#loc_79_31_79_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_31_79_34&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre">, </span><a href="#loc_79_35_79_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_35_79_37&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">)

instance </span><a href="Control.Monad.State.Class.html#loc_53_18_53_28" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_53_18_53_28&#39;)"><span class="hl_classref"><span class="mpre">MonadState</span></span></a><span class="mpre"> </span><a href="#loc_50_6_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_17&#39;)"><span class="hl_tyconref"><span class="mpre">RecordState</span></span></a><span class="mpre"> </span><a href="#loc_57_9_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_16&#39;)"><span class="hl_tyconref"><span class="mpre">RecordM</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">put</span></span><span class="mpre"> </span><a name="loc_82_9_82_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_9_82_10&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="#loc_57_21_57_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_21_57_28&#39;)"><span class="hl_conref"><span class="mpre">RecordM</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \_  _  -&gt; </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">, </span><a href="#loc_82_9_82_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_9_82_10&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)
    </span><span class="hl_vardecl"><span class="mpre">get</span></span><span class="mpre">   = </span><a href="#loc_57_21_57_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_21_57_28&#39;)"><span class="hl_conref"><span class="mpre">RecordM</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \_  </span><a name="loc_83_27_83_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_27_83_29&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="#loc_83_27_83_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_27_83_29&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">, </span><a href="#loc_83_27_83_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_27_83_29&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">)
#if MIN_VERSION_mtl(2,1,0)
    </span><span class="hl_fundecl"><span class="mpre">state</span></span><span class="mpre"> </span><a name="loc_85_11_85_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_11_85_12&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_57_21_57_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_21_57_28&#39;)"><span class="hl_conref"><span class="mpre">RecordM</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \_ </span><a name="loc_85_28_85_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_28_85_30&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="#loc_85_11_85_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_11_85_12&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_85_28_85_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_28_85_30&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">)
#endif

instance </span><a href="Control.Monad.Error.Class.html#loc_85_20_85_30" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Error.Class.html#loc_85_20_85_30&#39;)"><span class="hl_classref"><span class="mpre">MonadError</span></span></a><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_121_6_121_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_121_6_121_14&#39;)"><span class="hl_tyconref"><span class="mpre">TLSError</span></span></a><span class="mpre"> </span><a href="#loc_57_9_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_16&#39;)"><span class="hl_tyconref"><span class="mpre">RecordM</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">throwError</span></span><span class="mpre"> </span><a name="loc_89_16_89_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_16_89_17&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre">   = </span><a href="#loc_57_21_57_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_21_57_28&#39;)"><span class="hl_conref"><span class="mpre">RecordM</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \_ _ -&gt; </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_89_16_89_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_16_89_17&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">catchError</span></span><span class="mpre"> </span><a name="loc_90_16_90_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_16_90_17&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><a name="loc_90_18_90_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_18_90_19&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_57_21_57_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_21_57_28&#39;)"><span class="hl_conref"><span class="mpre">RecordM</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_90_33_90_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_33_90_36&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a name="loc_90_37_90_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_37_90_39&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> -&gt;
                        case </span><a href="#loc_57_31_57_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_31_57_41&#39;)"><span class="hl_varref"><span class="mpre">runRecordM</span></span></a><span class="mpre"> </span><a href="#loc_90_16_90_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_16_90_17&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_90_33_90_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_33_90_36&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_90_37_90_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_37_90_39&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre"> of
                            </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_92_34_92_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_34_92_37&#39;)"><span class="hl_vardecl"><span class="mpre">err</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_57_31_57_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_31_57_41&#39;)"><span class="hl_varref"><span class="mpre">runRecordM</span></span></a><span class="mpre"> (</span><a href="#loc_90_18_90_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_18_90_19&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_92_34_92_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_34_92_37&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre">) </span><a href="#loc_90_33_90_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_33_90_36&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_90_37_90_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_37_90_39&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">
                            </span><a name="loc_93_29_93_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_29_93_30&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">        -&gt; </span><a href="#loc_93_29_93_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_29_93_30&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

</span><a href="#loc_96_1_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_15&#39;)"><span class="mpre">newRecordState</span></a><span class="mpre"> :: </span><a href="#loc_50_6_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_17&#39;)"><span class="hl_tyconref"><span class="mpre">RecordState</span></span></a><span class="mpre">
</span><a name="loc_96_1_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_15&#39;)"><span class="hl_vardecl"><span class="mpre">newRecordState</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStartLine = 96, srcSpanStartColumn = 18, srcSpanEndLine = 101, srcSpanEndColumn = 6}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStartLine = 97, srcSpanStartColumn = 5, srcSpanEndLine = 97, srcSpanEndColumn = 6},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanSta"><span class="mpre">RecordState
    { stCipher      = Nothing
    , stCompression = nullCompression
    , stCryptState  = CryptState B.empty B.empty B.empty
    , stMacState    = MacState 0
    }</span></span><span class="mpre">

</span><a href="#loc_104_1_104_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_16&#39;)"><span class="mpre">incrRecordState</span></a><span class="mpre"> :: </span><a href="#loc_50_6_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_17&#39;)"><span class="hl_tyconref"><span class="mpre">RecordState</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_50_6_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_17&#39;)"><span class="hl_tyconref"><span class="mpre">RecordState</span></span></a><span class="mpre">
</span><a name="loc_104_1_104_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_16&#39;)"><span class="hl_fundecl"><span class="mpre">incrRecordState</span></span></a><span class="mpre"> </span><a name="loc_104_17_104_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_17_104_19&#39;)"><span class="hl_vardecl"><span class="mpre">ts</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStartLine = 104, srcSpanStartColumn = 22, srcSpanEndLine = 104, srcSpanEndColumn = 59}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStartLine = 104, srcSpanStartColumn = 25, srcSpanEndLine = 104, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcS"><span class="mpre">ts { stMacState = MacState (ms + 1) }</span></span><span class="mpre">
  where (</span><a href="#loc_46_20_46_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_20_46_28&#39;)"><span class="hl_conref"><span class="mpre">MacState</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">ms</span></span><span class="mpre">) = </span><a href="#loc_54_7_54_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_7_54_17&#39;)"><span class="hl_varref"><span class="mpre">stMacState</span></span></a><span class="mpre"> </span><a href="#loc_104_17_104_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_17_104_19&#39;)"><span class="hl_varref"><span class="mpre">ts</span></span></a><span class="mpre">

</span><a href="#loc_108_1_108_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_12&#39;)"><span class="mpre">setRecordIV</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre"> -&gt; </span><a href="#loc_50_6_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_17&#39;)"><span class="hl_tyconref"><span class="mpre">RecordState</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_50_6_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_17&#39;)"><span class="hl_tyconref"><span class="mpre">RecordState</span></span></a><span class="mpre">
</span><a name="loc_108_1_108_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_12&#39;)"><span class="hl_fundecl"><span class="mpre">setRecordIV</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">iv</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">st</span></span><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStartLine = 108, srcSpanStartColumn = 21, srcSpanEndLine = 108, srcSpanEndColumn = 75}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStartLine = 108, srcSpanStartColumn = 24, srcSpanEndLine = 108, srcSpanEndColumn = 25},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcS"><span class="mpre">st { stCryptState = (stCryptState st) { cstIV = iv } }</span></span><span class="mpre">

</span><a href="#loc_111_1_111_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_1_111_16&#39;)"><span class="mpre">withCompression</span></a><span class="mpre"> :: (</span><a href="Network.TLS.Compression.html#loc_38_6_38_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Compression.html#loc_38_6_38_17&#39;)"><span class="hl_tyconref"><span class="mpre">Compression</span></span></a><span class="mpre"> -&gt; (</span><a href="Network.TLS.Compression.html#loc_38_6_38_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Compression.html#loc_38_6_38_17&#39;)"><span class="hl_tyconref"><span class="mpre">Compression</span></span></a><span class="mpre">, </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)) -&gt; </span><a href="#loc_57_9_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_16&#39;)"><span class="hl_tyconref"><span class="mpre">RecordM</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_111_1_111_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_1_111_16&#39;)"><span class="hl_fundecl"><span class="mpre">withCompression</span></span></a><span class="mpre"> </span><a name="loc_111_17_111_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_17_111_18&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = do
    </span><a name="loc_112_5_112_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_5_112_7&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">get</span></span><span class="mpre">
    let (</span><span class="hl_vardecl"><span class="mpre">nc</span></span><span class="mpre">, </span><a name="loc_113_14_113_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_14_113_15&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">) = </span><a href="#loc_111_17_111_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_17_111_18&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_52_7_52_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_7_52_20&#39;)"><span class="hl_varref"><span class="mpre">stCompression</span></span></a><span class="mpre"> </span><a href="#loc_112_5_112_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_5_112_7&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">put</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStartLine = 114, srcSpanStartColumn = 11, srcSpanEndLine = 114, srcSpanEndColumn = 36}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcSpanStartLine = 114, srcSpanStartColumn = 14, srcSpanEndLine = 114, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Record/State.hs&quot;, srcS"><span class="mpre">st { stCompression = nc }</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_113_14_113_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_14_113_15&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">

</span><a href="#loc_118_1_118_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_1_118_14&#39;)"><span class="mpre">computeDigest</span></a><span class="mpre"> :: </span><a href="Network.TLS.Types.html#loc_25_6_25_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_6_25_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_50_6_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_17&#39;)"><span class="hl_tyconref"><span class="mpre">RecordState</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Struct.html#loc_157_6_157_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_157_6_157_12&#39;)"><span class="hl_tyconref"><span class="mpre">Header</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre">, </span><a href="#loc_50_6_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_17&#39;)"><span class="hl_tyconref"><span class="mpre">RecordState</span></span></a><span class="mpre">)
</span><a name="loc_118_1_118_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_1_118_14&#39;)"><span class="hl_fundecl"><span class="mpre">computeDigest</span></span></a><span class="mpre"> </span><a name="loc_118_15_118_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_15_118_18&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a name="loc_118_19_118_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_19_118_25&#39;)"><span class="hl_vardecl"><span class="mpre">tstate</span></span></a><span class="mpre"> </span><a name="loc_118_26_118_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_26_118_29&#39;)"><span class="hl_vardecl"><span class="mpre">hdr</span></span></a><span class="mpre"> </span><a name="loc_118_30_118_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_30_118_37&#39;)"><span class="hl_vardecl"><span class="mpre">content</span></span></a><span class="mpre"> = (</span><a href="#loc_119_9_119_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_9_119_15&#39;)"><span class="hl_varref"><span class="mpre">digest</span></span></a><span class="mpre">, </span><a href="#loc_104_1_104_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_1_104_16&#39;)"><span class="hl_varref"><span class="mpre">incrRecordState</span></span></a><span class="mpre"> </span><a href="#loc_118_19_118_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_19_118_25&#39;)"><span class="hl_varref"><span class="mpre">tstate</span></span></a><span class="mpre">)
  where </span><a name="loc_119_9_119_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_9_119_15&#39;)"><span class="hl_vardecl"><span class="mpre">digest</span></span></a><span class="mpre"> = </span><a href="#loc_125_10_125_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_10_125_14&#39;)"><span class="hl_varref"><span class="mpre">macF</span></span></a><span class="mpre"> (</span><a href="#loc_43_7_43_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_7_43_19&#39;)"><span class="hl_varref"><span class="mpre">cstMacSecret</span></span></a><span class="mpre"> </span><a href="#loc_120_9_120_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_9_120_12&#39;)"><span class="hl_varref"><span class="mpre">cst</span></span></a><span class="mpre">) </span><a href="#loc_125_16_125_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_16_125_19&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre">
        </span><a name="loc_120_9_120_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_9_120_12&#39;)"><span class="hl_vardecl"><span class="mpre">cst</span></span></a><span class="mpre">    = </span><a href="#loc_53_7_53_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_7_53_19&#39;)"><span class="hl_varref"><span class="mpre">stCryptState</span></span></a><span class="mpre"> </span><a href="#loc_118_19_118_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_19_118_25&#39;)"><span class="hl_varref"><span class="mpre">tstate</span></span></a><span class="mpre">
        </span><a name="loc_121_9_121_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_9_121_15&#39;)"><span class="hl_vardecl"><span class="mpre">cipher</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Util.html#loc_53_1_53_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_53_1_53_9&#39;)"><span class="hl_varref"><span class="mpre">fromJust</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;cipher&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_51_7_51_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_7_51_15&#39;)"><span class="hl_varref"><span class="mpre">stCipher</span></span></a><span class="mpre"> </span><a href="#loc_118_19_118_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_19_118_25&#39;)"><span class="hl_varref"><span class="mpre">tstate</span></span></a><span class="mpre">
        </span><a name="loc_122_9_122_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_9_122_14&#39;)"><span class="hl_vardecl"><span class="mpre">hashf</span></span></a><span class="mpre">  = </span><a href="Network.TLS.Cipher.html#loc_73_7_73_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_73_7_73_12&#39;)"><span class="hl_varref"><span class="mpre">hashF</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Cipher.html#loc_85_7_85_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_85_7_85_17&#39;)"><span class="hl_varref"><span class="mpre">cipherHash</span></span></a><span class="mpre"> </span><a href="#loc_121_9_121_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_9_121_15&#39;)"><span class="hl_varref"><span class="mpre">cipher</span></span></a><span class="mpre">
        </span><a name="loc_123_9_123_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_9_123_19&#39;)"><span class="hl_vardecl"><span class="mpre">encodedSeq</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Wire.html#loc_165_1_165_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Wire.html#loc_165_1_165_13&#39;)"><span class="hl_varref"><span class="mpre">encodeWord64</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_47_7_47_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_7_47_17&#39;)"><span class="hl_varref"><span class="mpre">msSequence</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_54_7_54_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_7_54_17&#39;)"><span class="hl_varref"><span class="mpre">stMacState</span></span></a><span class="mpre"> </span><a href="#loc_118_19_118_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_19_118_25&#39;)"><span class="hl_varref"><span class="mpre">tstate</span></span></a><span class="mpre">

        (</span><a name="loc_125_10_125_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_10_125_14&#39;)"><span class="hl_vardecl"><span class="mpre">macF</span></span></a><span class="mpre">, </span><a name="loc_125_16_125_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_16_125_19&#39;)"><span class="hl_vardecl"><span class="mpre">msg</span></span></a><span class="mpre">)
            | </span><a href="#loc_118_15_118_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_15_118_18&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">TLS10</span></span><span class="mpre"> = (</span><a href="Network.TLS.MAC.html#loc_30_1_30_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.MAC.html#loc_30_1_30_7&#39;)"><span class="hl_varref"><span class="mpre">macSSL</span></span></a><span class="mpre"> </span><a href="#loc_122_9_122_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_9_122_14&#39;)"><span class="hl_varref"><span class="mpre">hashf</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> [ </span><a href="#loc_123_9_123_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_9_123_19&#39;)"><span class="hl_varref"><span class="mpre">encodedSeq</span></span></a><span class="mpre">, </span><a href="Network.TLS.Packet.html#loc_134_1_134_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Packet.html#loc_134_1_134_18&#39;)"><span class="hl_varref"><span class="mpre">encodeHeaderNoVer</span></span></a><span class="mpre"> </span><a href="#loc_118_26_118_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_26_118_29&#39;)"><span class="hl_varref"><span class="mpre">hdr</span></span></a><span class="mpre">, </span><a href="#loc_118_30_118_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_30_118_37&#39;)"><span class="hl_varref"><span class="mpre">content</span></span></a><span class="mpre"> ])
            | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">   = (</span><a href="Network.TLS.MAC.html#loc_36_1_36_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.MAC.html#loc_36_1_36_5&#39;)"><span class="hl_varref"><span class="mpre">hmac</span></span></a><span class="mpre"> </span><a href="#loc_122_9_122_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_9_122_14&#39;)"><span class="hl_varref"><span class="mpre">hashf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">64</span></span><span class="mpre">, </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> [ </span><a href="#loc_123_9_123_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_9_123_19&#39;)"><span class="hl_varref"><span class="mpre">encodedSeq</span></span></a><span class="mpre">, </span><a href="Network.TLS.Packet.html#loc_130_1_130_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Packet.html#loc_130_1_130_13&#39;)"><span class="hl_varref"><span class="mpre">encodeHeader</span></span></a><span class="mpre"> </span><a href="#loc_118_26_118_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_26_118_29&#39;)"><span class="hl_varref"><span class="mpre">hdr</span></span></a><span class="mpre">, </span><a href="#loc_118_30_118_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_30_118_37&#39;)"><span class="hl_varref"><span class="mpre">content</span></span></a><span class="mpre"> ])

</span><a href="#loc_130_1_130_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_11&#39;)"><span class="mpre">makeDigest</span></a><span class="mpre"> :: </span><a href="Network.TLS.Struct.html#loc_157_6_157_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_157_6_157_12&#39;)"><span class="hl_tyconref"><span class="mpre">Header</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre"> -&gt; </span><a href="#loc_57_9_57_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_16&#39;)"><span class="hl_tyconref"><span class="mpre">RecordM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre">
</span><a name="loc_130_1_130_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_11&#39;)"><span class="hl_fundecl"><span class="mpre">makeDigest</span></span></a><span class="mpre"> </span><a name="loc_130_12_130_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_12_130_15&#39;)"><span class="hl_vardecl"><span class="mpre">hdr</span></span></a><span class="mpre"> </span><a name="loc_130_16_130_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_16_130_23&#39;)"><span class="hl_vardecl"><span class="mpre">content</span></span></a><span class="mpre"> = do
    </span><a name="loc_131_5_131_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_5_131_8&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_79_1_79_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_17&#39;)"><span class="hl_varref"><span class="mpre">getRecordVersion</span></span></a><span class="mpre">
    </span><a name="loc_132_5_132_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_5_132_7&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">get</span></span><span class="mpre">
    let (</span><a name="loc_133_10_133_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_10_133_16&#39;)"><span class="hl_vardecl"><span class="mpre">digest</span></span></a><span class="mpre">, </span><a name="loc_133_18_133_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_18_133_24&#39;)"><span class="hl_vardecl"><span class="mpre">nstate</span></span></a><span class="mpre">) = </span><a href="#loc_118_1_118_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_1_118_14&#39;)"><span class="hl_varref"><span class="mpre">computeDigest</span></span></a><span class="mpre"> </span><a href="#loc_131_5_131_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_5_131_8&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_132_5_132_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_5_132_7&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre"> </span><a href="#loc_130_12_130_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_12_130_15&#39;)"><span class="hl_varref"><span class="mpre">hdr</span></span></a><span class="mpre"> </span><a href="#loc_130_16_130_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_16_130_23&#39;)"><span class="hl_varref"><span class="mpre">content</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">put</span></span><span class="mpre"> </span><a href="#loc_133_18_133_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_18_133_24&#39;)"><span class="hl_varref"><span class="mpre">nstate</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_133_10_133_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_10_133_16&#39;)"><span class="hl_varref"><span class="mpre">digest</span></span></a><span class="mpre">
</span></div></body></html>