<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- | POSIX time, if you need to deal with timestamps and the like.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Most people won&#39;t need this module.</span></span><span class="mpre">
module Data.Time.Clock.POSIX
(
        posixDayLength,POSIXTime,posixSecondsToUTCTime,utcTimeToPOSIXSeconds,getPOSIXTime
) where

import Data.Time.Clock.UTC
import Data.Time.Calendar.Days
import Data.Fixed
import Control.Monad

#ifdef mingw32_HOST_OS
import Data.Word        ( Word64)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/time-1.4.2/Data/Time/Clock/POSIX.hs&quot;, srcSpanStartLine = 15, srcSpanStartColumn = 8, srcSpanEndLine = 15, srcSpanEndColumn = 25}, srcInfoPoints = []}) &quot;System.Win32.Time&quot;"><span class="mpre">System.Win32.Time</span></span><span class="mpre">
#else
import Data.Time.Clock.CTimeval
#endif

</span><span class="hl_comment"><span class="mpre">-- | 86400 nominal seconds in every day</span></span><span class="mpre">
</span><a href="#loc_22_1_22_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_1_22_15&#39;)"><span class="mpre">posixDayLength</span></a><span class="mpre"> :: </span><a href="Data.Time.Clock.UTC.html#loc_62_9_62_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Time.Clock.UTC.html#loc_62_9_62_24&#39;)"><span class="hl_tyconref"><span class="mpre">NominalDiffTime</span></span></a><span class="mpre">
</span><a name="loc_22_1_22_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_1_22_15&#39;)"><span class="hl_vardecl"><span class="mpre">posixDayLength</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">86400</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | POSIX time is the nominal time since 1970-01-01 00:00 UTC</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- To convert from a &#39;Foreign.C.CTime&#39; or &#39;System.Posix.EpochTime&#39;, use &#39;realToFrac&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/time-1.4.2/Data/Time/Clock/POSIX.hs&quot;, srcSpanStartLine = 28, srcSpanStartColumn = 1, srcSpanEndLine = 28, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/time-1.4.2/Data/Time/Clock/POSIX.hs&quot;, srcSpanStartLine = 28, srcSpanStartColumn = 1, srcSpanEndLine = 28, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/time-1.4.2/Data/Time/Clock/POSIX.hs&quot;, srcSpanStartLine ="><span class="mpre">type POSIXTime = NominalDiffTime</span></span><span class="mpre">

</span><a href="#loc_31_1_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_1_31_13&#39;)"><span class="mpre">unixEpochDay</span></a><span class="mpre"> :: </span><a href="Data.Time.Calendar.Days.html#loc_18_9_18_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Time.Calendar.Days.html#loc_18_9_18_12&#39;)"><span class="hl_tyconref"><span class="mpre">Day</span></span></a><span class="mpre">
</span><a name="loc_31_1_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_1_31_13&#39;)"><span class="hl_vardecl"><span class="mpre">unixEpochDay</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">ModifiedJulianDay</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">40587</span></span><span class="mpre">

</span><a href="#loc_34_1_34_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_22&#39;)"><span class="mpre">posixSecondsToUTCTime</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">POSIXTime</span></span><span class="mpre"> -&gt; </span><a href="Data.Time.Clock.UTC.html#loc_31_6_31_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Time.Clock.UTC.html#loc_31_6_31_13&#39;)"><span class="hl_tyconref"><span class="mpre">UTCTime</span></span></a><span class="mpre">
</span><a name="loc_34_1_34_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_22&#39;)"><span class="hl_fundecl"><span class="mpre">posixSecondsToUTCTime</span></span></a><span class="mpre"> </span><a name="loc_34_23_34_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_23_34_24&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> = let
        (</span><a name="loc_35_10_35_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_10_35_11&#39;)"><span class="hl_vardecl"><span class="mpre">d</span></span></a><span class="mpre">,</span><a name="loc_35_12_35_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_12_35_13&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre">) = </span><a href="Data.Fixed.html#loc_55_1_55_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Fixed.html#loc_55_1_55_8&#39;)"><span class="hl_varref"><span class="mpre">divMod&#39;</span></span></a><span class="mpre"> </span><a href="#loc_34_23_34_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_23_34_24&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="#loc_22_1_22_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_1_22_15&#39;)"><span class="hl_varref"><span class="mpre">posixDayLength</span></span></a><span class="mpre">
 in </span><span class="hl_conref"><span class="mpre">UTCTime</span></span><span class="mpre"> (</span><a href="Data.Time.Calendar.Days.html#loc_48_1_48_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Time.Calendar.Days.html#loc_48_1_48_8&#39;)"><span class="hl_varref"><span class="mpre">addDays</span></span></a><span class="mpre"> </span><a href="#loc_35_10_35_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_10_35_11&#39;)"><span class="hl_varref"><span class="mpre">d</span></span></a><span class="mpre"> </span><a href="#loc_31_1_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_1_31_13&#39;)"><span class="hl_varref"><span class="mpre">unixEpochDay</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">realToFrac</span></span><span class="mpre"> </span><a href="#loc_35_12_35_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_12_35_13&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">)

</span><a href="#loc_39_1_39_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_22&#39;)"><span class="mpre">utcTimeToPOSIXSeconds</span></a><span class="mpre"> :: </span><a href="Data.Time.Clock.UTC.html#loc_31_6_31_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Time.Clock.UTC.html#loc_31_6_31_13&#39;)"><span class="hl_tyconref"><span class="mpre">UTCTime</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">POSIXTime</span></span><span class="mpre">
</span><a name="loc_39_1_39_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_22&#39;)"><span class="hl_fundecl"><span class="mpre">utcTimeToPOSIXSeconds</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">UTCTime</span></span><span class="mpre"> </span><a name="loc_39_32_39_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_32_39_33&#39;)"><span class="hl_vardecl"><span class="mpre">d</span></span></a><span class="mpre"> </span><a name="loc_39_34_39_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_34_39_35&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre">) =
 (</span><span class="hl_varref"><span class="mpre">fromInteger</span></span><span class="mpre"> (</span><a href="Data.Time.Calendar.Days.html#loc_51_1_51_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Time.Calendar.Days.html#loc_51_1_51_9&#39;)"><span class="hl_varref"><span class="mpre">diffDays</span></span></a><span class="mpre"> </span><a href="#loc_39_32_39_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_32_39_33&#39;)"><span class="hl_varref"><span class="mpre">d</span></span></a><span class="mpre"> </span><a href="#loc_31_1_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_1_31_13&#39;)"><span class="hl_varref"><span class="mpre">unixEpochDay</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><a href="#loc_22_1_22_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_1_22_15&#39;)"><span class="hl_varref"><span class="mpre">posixDayLength</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">min</span></span><span class="mpre"> </span><a href="#loc_22_1_22_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_1_22_15&#39;)"><span class="hl_varref"><span class="mpre">posixDayLength</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">realToFrac</span></span><span class="mpre"> </span><a href="#loc_39_34_39_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_34_39_35&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Get the current POSIX time from the system clock.</span></span><span class="mpre">
</span><a href="#loc_51_1_51_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_13&#39;)"><span class="mpre">getPOSIXTime</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">POSIXTime</span></span><span class="mpre">

#ifdef mingw32_HOST_OS
</span><span class="hl_comment"><span class="mpre">-- On Windows, the equlvalent of POSIX time is &quot;file time&quot;, defined as</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the number of 100-nanosecond intervals that have elapsed since</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 12:00 A.M. January 1, 1601 (UTC).  We can convert this into a POSIX</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- time by adjusting the offset to be relative to the POSIX epoch.</span></span><span class="mpre">

</span><a name="loc_51_1_51_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_13&#39;)"><span class="hl_vardecl"><span class="mpre">getPOSIXTime</span></span></a><span class="mpre"> = do
  </span><span class="hl_conref"><span class="mpre">FILETIME</span></span><span class="mpre"> </span><a name="loc_52_12_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_12_52_14&#39;)"><span class="hl_vardecl"><span class="mpre">ft</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">System.Win32.Time.getSystemTimeAsFileTime</span></span><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_52_12_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_12_52_14&#39;)"><span class="hl_varref"><span class="mpre">ft</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_56_1_56_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_19&#39;)"><span class="hl_varref"><span class="mpre">win32_epoch_adjust</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">/</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">10000000</span></span><span class="mpre">)

</span><a href="#loc_56_1_56_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_19&#39;)"><span class="mpre">win32_epoch_adjust</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word64</span></span><span class="mpre">
</span><a name="loc_56_1_56_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_19&#39;)"><span class="hl_vardecl"><span class="mpre">win32_epoch_adjust</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">116444736000000000</span></span><span class="mpre">

#else

</span><span class="hl_comment"><span class="mpre">-- Use POSIX time</span></span><span class="mpre">
</span><a href="#loc_62_1_62_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_23&#39;)"><span class="mpre">ctimevalToPosixSeconds</span></a><span class="mpre"> :: </span><a href="Data.Time.Clock.CTimeval.html#loc_10_6_10_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Time.Clock.CTimeval.html#loc_10_6_10_14&#39;)"><span class="hl_tyconref"><span class="mpre">CTimeval</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">POSIXTime</span></span><span class="mpre">
</span><a name="loc_62_1_62_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_23&#39;)"><span class="hl_fundecl"><span class="mpre">ctimevalToPosixSeconds</span></span></a><span class="mpre"> (</span><a href="Data.Time.Clock.CTimeval.html#loc_10_17_10_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Time.Clock.CTimeval.html#loc_10_17_10_27&#39;)"><span class="hl_conref"><span class="mpre">MkCTimeval</span></span></a><span class="mpre"> </span><a name="loc_62_36_62_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_36_62_37&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_62_38_62_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_38_62_41&#39;)"><span class="hl_vardecl"><span class="mpre">mus</span></span></a><span class="mpre">) = (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_62_36_62_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_36_62_37&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_62_38_62_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_38_62_41&#39;)"><span class="hl_varref"><span class="mpre">mus</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">/</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1000000</span></span><span class="mpre">

</span><span class="hl_vardecl"><span class="mpre">getPOSIXTime</span></span><span class="mpre"> = </span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="hl_varref"><span class="mpre">liftM</span></span></a><span class="mpre"> </span><a href="#loc_62_1_62_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_23&#39;)"><span class="hl_varref"><span class="mpre">ctimevalToPosixSeconds</span></span></a><span class="mpre"> </span><a href="Data.Time.Clock.CTimeval.html#loc_27_1_27_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Time.Clock.CTimeval.html#loc_27_1_27_12&#39;)"><span class="hl_varref"><span class="mpre">getCTimeval</span></span></a><span class="mpre">

#endif
</span></div></body></html>