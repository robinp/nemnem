<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Network.TLS.Context</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Network.TLS.Context
    (
    </span><span class="hl_comment"><span class="mpre">-- * Context configuration</span></span><span class="mpre">
      TLSParams

    </span><span class="hl_comment"><span class="mpre">-- * Context object and accessor</span></span><span class="mpre">
    , Context(..)
    , Hooks(..)
    , ctxEOF
    , ctxHasSSLv2ClientHello
    , ctxDisableSSLv2ClientHello
    , ctxEstablished
    , withLog
    , ctxWithHooks
    , contextModifyHooks
    , setEOF
    , setEstablished
    , contextFlush
    , contextClose
    , contextSend
    , contextRecv
    , updateMeasure
    , withMeasure
    , withReadLock
    , withWriteLock
    , withStateLock
    , withRWLock

    </span><span class="hl_comment"><span class="mpre">-- * information</span></span><span class="mpre">
    , Information(..)
    , contextGetInformation

    </span><span class="hl_comment"><span class="mpre">-- * New contexts</span></span><span class="mpre">
    , contextNew
    </span><span class="hl_comment"><span class="mpre">-- * Deprecated new contexts methods</span></span><span class="mpre">
    , contextNewOnHandle
    , contextNewOnSocket

    </span><span class="hl_comment"><span class="mpre">-- * Context hooks</span></span><span class="mpre">
    , contextHookSetHandshakeRecv
    , contextHookSetCertificateRecv
    , contextHookSetLogging

    </span><span class="hl_comment"><span class="mpre">-- * Using context states</span></span><span class="mpre">
    , throwCore
    , usingState
    , usingState_
    , runTxState
    , runRxState
    , usingHState
    , getHState
    , getStateRNG
    ) where

import Network.TLS.Backend
import Network.TLS.Context.Internal
import Network.TLS.Struct
import Network.TLS.Cipher (</span><a href="Network.TLS.Cipher.html#loc_82_6_82_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_82_6_82_12&#39;)"><span class="mpre">Cipher</span></a><span class="mpre">(..), </span><a href="Network.TLS.Cipher.html#loc_40_6_40_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_40_6_40_27&#39;)"><span class="mpre">CipherKeyExchangeType</span></a><span class="mpre">(..))
import Network.TLS.Credentials
import Network.TLS.State
import Network.TLS.Hooks
import Network.TLS.Record.State
import Network.TLS.Parameters
import Network.TLS.Measurement
import Network.TLS.Types (</span><a href="Network.TLS.Types.html#loc_44_6_44_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_6_44_10&#39;)"><span class="mpre">Role</span></a><span class="mpre">(..))
import Network.TLS.Handshake (</span><a href="Network.TLS.Handshake.Client.html#loc_53_1_53_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Client.html#loc_53_1_53_16&#39;)"><span class="mpre">handshakeClient</span></a><span class="mpre">, </span><a href="Network.TLS.Handshake.Client.html#loc_47_1_47_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Client.html#loc_47_1_47_20&#39;)"><span class="mpre">handshakeClientWith</span></a><span class="mpre">, </span><a href="Network.TLS.Handshake.Server.html#loc_50_1_50_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Server.html#loc_50_1_50_16&#39;)"><span class="mpre">handshakeServer</span></a><span class="mpre">, </span><a href="Network.TLS.Handshake.Server.html#loc_82_1_82_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Server.html#loc_82_1_82_20&#39;)"><span class="mpre">handshakeServerWith</span></a><span class="mpre">)
import Network.TLS.X509
import Data.Maybe (</span><a href="Data.Maybe.html#loc_80_1_80_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_80_1_80_7&#39;)"><span class="mpre">isJust</span></a><span class="mpre">)

import Crypto.Random

import Control.Concurrent.MVar
import Control.Monad.State
import Data.IORef

</span><span class="hl_comment"><span class="mpre">-- deprecated imports</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 84, srcSpanStartColumn = 8, srcSpanEndLine = 84, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre"> (Socket)
import System.IO (Handle)

class </span><a name="loc_87_7_87_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_7_87_16&#39;)"><span class="hl_classdecl"><span class="mpre">TLSParams</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> where
    </span><a name="loc_88_5_88_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_5_88_23&#39;)"><span class="mpre">getTLSCommonParams</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">CommonParams</span></span><span class="mpre">
    </span><a name="loc_89_5_89_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_5_89_15&#39;)"><span class="mpre">getTLSRole</span></a><span class="mpre">         :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="Network.TLS.Types.html#loc_44_6_44_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_6_44_10&#39;)"><span class="hl_tyconref"><span class="mpre">Role</span></span></a><span class="mpre">
    </span><a name="loc_90_5_90_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_15&#39;)"><span class="mpre">getCiphers</span></a><span class="mpre">         :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; [</span><a href="Network.TLS.Cipher.html#loc_82_6_82_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_82_6_82_12&#39;)"><span class="hl_tyconref"><span class="mpre">Cipher</span></span></a><span class="mpre">]
    </span><a name="loc_91_5_91_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_5_91_16&#39;)"><span class="mpre">doHandshake</span></a><span class="mpre">        :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
    </span><a name="loc_92_5_92_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_20&#39;)"><span class="mpre">doHandshakeWith</span></a><span class="mpre">    :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Struct.html#loc_252_6_252_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_252_6_252_15&#39;)"><span class="hl_tyconref"><span class="mpre">Handshake</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">

instance </span><a href="#loc_87_7_87_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_7_87_16&#39;)"><span class="hl_classref"><span class="mpre">TLSParams</span></span></a><span class="mpre"> </span><a href="Network.TLS.Parameters.html#loc_43_6_43_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_43_6_43_18&#39;)"><span class="hl_tyconref"><span class="mpre">ClientParams</span></span></a><span class="mpre"> where
    </span><a href="#loc_88_5_88_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_5_88_23&#39;)"><span class="hl_fundecl"><span class="mpre">getTLSCommonParams</span></span></a><span class="mpre"> </span><a name="loc_95_24_95_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_24_95_31&#39;)"><span class="hl_vardecl"><span class="mpre">cparams</span></span></a><span class="mpre"> = ( </span><a href="Network.TLS.Parameters.html#loc_62_7_62_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_62_7_62_22&#39;)"><span class="hl_varref"><span class="mpre">clientSupported</span></span></a><span class="mpre"> </span><a href="#loc_95_24_95_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_24_95_31&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre">
                                 , </span><a href="Network.TLS.Parameters.html#loc_60_7_60_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_60_7_60_19&#39;)"><span class="hl_varref"><span class="mpre">clientShared</span></span></a><span class="mpre"> </span><a href="#loc_95_24_95_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_24_95_31&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre">
                                 )
    </span><a href="#loc_89_5_89_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_5_89_15&#39;)"><span class="hl_fundecl"><span class="mpre">getTLSRole</span></span></a><span class="mpre"> _ = </span><a href="Network.TLS.Types.html#loc_44_13_44_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_13_44_23&#39;)"><span class="hl_conref"><span class="mpre">ClientRole</span></span></a><span class="mpre">
    </span><a href="#loc_90_5_90_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_15&#39;)"><span class="hl_fundecl"><span class="mpre">getCiphers</span></span></a><span class="mpre"> </span><a name="loc_99_16_99_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_16_99_23&#39;)"><span class="hl_vardecl"><span class="mpre">cparams</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Parameters.html#loc_115_7_115_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_115_7_115_23&#39;)"><span class="hl_varref"><span class="mpre">supportedCiphers</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Parameters.html#loc_62_7_62_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_62_7_62_22&#39;)"><span class="hl_varref"><span class="mpre">clientSupported</span></span></a><span class="mpre"> </span><a href="#loc_99_16_99_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_16_99_23&#39;)"><span class="hl_varref"><span class="mpre">cparams</span></span></a><span class="mpre">
    </span><a href="#loc_91_5_91_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_5_91_16&#39;)"><span class="hl_vardecl"><span class="mpre">doHandshake</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Handshake.Client.html#loc_53_1_53_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Client.html#loc_53_1_53_16&#39;)"><span class="hl_varref"><span class="mpre">handshakeClient</span></span></a><span class="mpre">
    </span><a href="#loc_92_5_92_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_20&#39;)"><span class="hl_vardecl"><span class="mpre">doHandshakeWith</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Handshake.Client.html#loc_47_1_47_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Client.html#loc_47_1_47_20&#39;)"><span class="hl_varref"><span class="mpre">handshakeClientWith</span></span></a><span class="mpre">

instance </span><a href="#loc_87_7_87_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_7_87_16&#39;)"><span class="hl_classref"><span class="mpre">TLSParams</span></span></a><span class="mpre"> </span><a href="Network.TLS.Parameters.html#loc_76_6_76_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_76_6_76_18&#39;)"><span class="hl_tyconref"><span class="mpre">ServerParams</span></span></a><span class="mpre"> where
    </span><a href="#loc_88_5_88_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_5_88_23&#39;)"><span class="hl_fundecl"><span class="mpre">getTLSCommonParams</span></span></a><span class="mpre"> </span><a name="loc_104_24_104_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_24_104_31&#39;)"><span class="hl_vardecl"><span class="mpre">sparams</span></span></a><span class="mpre"> = ( </span><a href="Network.TLS.Parameters.html#loc_91_7_91_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_91_7_91_22&#39;)"><span class="hl_varref"><span class="mpre">serverSupported</span></span></a><span class="mpre"> </span><a href="#loc_104_24_104_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_24_104_31&#39;)"><span class="hl_varref"><span class="mpre">sparams</span></span></a><span class="mpre">
                                 , </span><a href="Network.TLS.Parameters.html#loc_89_7_89_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_89_7_89_19&#39;)"><span class="hl_varref"><span class="mpre">serverShared</span></span></a><span class="mpre"> </span><a href="#loc_104_24_104_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_24_104_31&#39;)"><span class="hl_varref"><span class="mpre">sparams</span></span></a><span class="mpre">
                                 )
    </span><a href="#loc_89_5_89_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_5_89_15&#39;)"><span class="hl_fundecl"><span class="mpre">getTLSRole</span></span></a><span class="mpre"> _ = </span><a href="Network.TLS.Types.html#loc_44_26_44_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_26_44_36&#39;)"><span class="hl_conref"><span class="mpre">ServerRole</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- on the server we filter our allowed ciphers here according</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- to the credentials and DHE parameters loaded</span></span><span class="mpre">
    </span><a href="#loc_90_5_90_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_15&#39;)"><span class="hl_fundecl"><span class="mpre">getCiphers</span></span></a><span class="mpre"> </span><a name="loc_110_16_110_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_16_110_23&#39;)"><span class="hl_vardecl"><span class="mpre">sparams</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">filter</span></span><span class="mpre"> </span><a href="#loc_111_17_111_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_17_111_30&#39;)"><span class="hl_varref"><span class="mpre">authorizedCKE</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Parameters.html#loc_115_7_115_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_115_7_115_23&#39;)"><span class="hl_varref"><span class="mpre">supportedCiphers</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Parameters.html#loc_91_7_91_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_91_7_91_22&#39;)"><span class="hl_varref"><span class="mpre">serverSupported</span></span></a><span class="mpre"> </span><a href="#loc_110_16_110_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_16_110_23&#39;)"><span class="hl_varref"><span class="mpre">sparams</span></span></a><span class="mpre">)
          where </span><a name="loc_111_17_111_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_17_111_30&#39;)"><span class="hl_fundecl"><span class="mpre">authorizedCKE</span></span></a><span class="mpre"> </span><a name="loc_111_31_111_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_31_111_37&#39;)"><span class="hl_vardecl"><span class="mpre">cipher</span></span></a><span class="mpre"> =
                    case </span><a href="Network.TLS.Cipher.html#loc_87_7_87_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_87_7_87_24&#39;)"><span class="hl_varref"><span class="mpre">cipherKeyExchange</span></span></a><span class="mpre"> </span><a href="#loc_111_31_111_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_31_111_37&#39;)"><span class="hl_varref"><span class="mpre">cipher</span></span></a><span class="mpre"> of
                        </span><a href="Network.TLS.Cipher.html#loc_41_7_41_28" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_41_7_41_28&#39;)"><span class="hl_conref"><span class="mpre">CipherKeyExchange_RSA</span></span></a><span class="mpre">         -&gt; </span><a href="#loc_129_17_129_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_17_129_30&#39;)"><span class="hl_varref"><span class="mpre">canEncryptRSA</span></span></a><span class="mpre">
                        </span><a href="Network.TLS.Cipher.html#loc_42_7_42_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_42_7_42_32&#39;)"><span class="hl_conref"><span class="mpre">CipherKeyExchange_DH_Anon</span></span></a><span class="mpre">     -&gt; </span><a href="#loc_126_17_126_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_17_126_23&#39;)"><span class="hl_varref"><span class="mpre">canDHE</span></span></a><span class="mpre">
                        </span><a href="Network.TLS.Cipher.html#loc_43_7_43_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_43_7_43_32&#39;)"><span class="hl_conref"><span class="mpre">CipherKeyExchange_DHE_RSA</span></span></a><span class="mpre">     -&gt; </span><a href="#loc_128_17_128_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_17_128_27&#39;)"><span class="hl_varref"><span class="mpre">canSignRSA</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_126_17_126_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_17_126_23&#39;)"><span class="hl_varref"><span class="mpre">canDHE</span></span></a><span class="mpre">
                        </span><a href="Network.TLS.Cipher.html#loc_45_7_45_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_45_7_45_32&#39;)"><span class="hl_conref"><span class="mpre">CipherKeyExchange_DHE_DSS</span></span></a><span class="mpre">     -&gt; </span><a href="#loc_127_17_127_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_17_127_27&#39;)"><span class="hl_varref"><span class="mpre">canSignDSS</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_126_17_126_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_17_126_23&#39;)"><span class="hl_varref"><span class="mpre">canDHE</span></span></a><span class="mpre">
                        </span><span class="hl_comment"><span class="mpre">-- unimplemented: non ephemeral DH</span></span><span class="mpre">
                        </span><a href="Network.TLS.Cipher.html#loc_46_7_46_31" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_46_7_46_31&#39;)"><span class="hl_conref"><span class="mpre">CipherKeyExchange_DH_DSS</span></span></a><span class="mpre">      -&gt; </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
                        </span><a href="Network.TLS.Cipher.html#loc_47_7_47_31" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_47_7_47_31&#39;)"><span class="hl_conref"><span class="mpre">CipherKeyExchange_DH_RSA</span></span></a><span class="mpre">      -&gt; </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
                        </span><span class="hl_comment"><span class="mpre">-- unimplemented: EC</span></span><span class="mpre">
                        </span><a href="Network.TLS.Cipher.html#loc_44_7_44_34" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_44_7_44_34&#39;)"><span class="hl_conref"><span class="mpre">CipherKeyExchange_ECDHE_RSA</span></span></a><span class="mpre">   -&gt; </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
                        </span><a href="Network.TLS.Cipher.html#loc_48_7_48_35" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_48_7_48_35&#39;)"><span class="hl_conref"><span class="mpre">CipherKeyExchange_ECDH_ECDSA</span></span></a><span class="mpre">  -&gt; </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
                        </span><a href="Network.TLS.Cipher.html#loc_49_7_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_49_7_49_33&#39;)"><span class="hl_conref"><span class="mpre">CipherKeyExchange_ECDH_RSA</span></span></a><span class="mpre">    -&gt; </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
                        </span><a href="Network.TLS.Cipher.html#loc_50_7_50_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_50_7_50_36&#39;)"><span class="hl_conref"><span class="mpre">CipherKeyExchange_ECDHE_ECDSA</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

                </span><a name="loc_126_17_126_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_17_126_23&#39;)"><span class="hl_vardecl"><span class="mpre">canDHE</span></span></a><span class="mpre">        = </span><a href="Data.Maybe.html#loc_80_1_80_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_80_1_80_7&#39;)"><span class="hl_varref"><span class="mpre">isJust</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Parameters.html#loc_87_7_87_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_87_7_87_22&#39;)"><span class="hl_varref"><span class="mpre">serverDHEParams</span></span></a><span class="mpre"> </span><a href="#loc_110_16_110_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_16_110_23&#39;)"><span class="hl_varref"><span class="mpre">sparams</span></span></a><span class="mpre">
                </span><a name="loc_127_17_127_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_17_127_27&#39;)"><span class="hl_vardecl"><span class="mpre">canSignDSS</span></span></a><span class="mpre">    = </span><a href="Network.TLS.Struct.html#loc_100_7_100_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_100_7_100_19&#39;)"><span class="hl_conref"><span class="mpre">SignatureDSS</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`elem`</span></span><span class="mpre"> </span><a href="#loc_130_17_130_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_17_130_28&#39;)"><span class="hl_varref"><span class="mpre">signingAlgs</span></span></a><span class="mpre">
                </span><a name="loc_128_17_128_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_17_128_27&#39;)"><span class="hl_vardecl"><span class="mpre">canSignRSA</span></span></a><span class="mpre">    = </span><a href="Network.TLS.Struct.html#loc_99_7_99_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_99_7_99_19&#39;)"><span class="hl_conref"><span class="mpre">SignatureRSA</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`elem`</span></span><span class="mpre"> </span><a href="#loc_130_17_130_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_17_130_28&#39;)"><span class="hl_varref"><span class="mpre">signingAlgs</span></span></a><span class="mpre">
                </span><a name="loc_129_17_129_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_17_129_30&#39;)"><span class="hl_vardecl"><span class="mpre">canEncryptRSA</span></span></a><span class="mpre"> = </span><a href="Data.Maybe.html#loc_80_1_80_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_80_1_80_7&#39;)"><span class="hl_varref"><span class="mpre">isJust</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Credentials.html#loc_69_1_69_29" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Credentials.html#loc_69_1_69_29&#39;)"><span class="hl_varref"><span class="mpre">credentialsFindForDecrypting</span></span></a><span class="mpre"> </span><a href="#loc_131_17_131_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_17_131_22&#39;)"><span class="hl_varref"><span class="mpre">creds</span></span></a><span class="mpre">
                </span><a name="loc_130_17_130_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_17_130_28&#39;)"><span class="hl_vardecl"><span class="mpre">signingAlgs</span></span></a><span class="mpre">   = </span><a href="Network.TLS.Credentials.html#loc_62_1_62_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Credentials.html#loc_62_1_62_33&#39;)"><span class="hl_varref"><span class="mpre">credentialsListSigningAlgorithms</span></span></a><span class="mpre"> </span><a href="#loc_131_17_131_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_17_131_22&#39;)"><span class="hl_varref"><span class="mpre">creds</span></span></a><span class="mpre">
                </span><a name="loc_131_17_131_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_17_131_22&#39;)"><span class="hl_vardecl"><span class="mpre">creds</span></span></a><span class="mpre">         = </span><a href="Network.TLS.Parameters.html#loc_146_7_146_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_146_7_146_24&#39;)"><span class="hl_varref"><span class="mpre">sharedCredentials</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Parameters.html#loc_89_7_89_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_89_7_89_19&#39;)"><span class="hl_varref"><span class="mpre">serverShared</span></span></a><span class="mpre"> </span><a href="#loc_110_16_110_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_16_110_23&#39;)"><span class="hl_varref"><span class="mpre">sparams</span></span></a><span class="mpre">
    </span><a href="#loc_91_5_91_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_5_91_16&#39;)"><span class="hl_vardecl"><span class="mpre">doHandshake</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Handshake.Server.html#loc_50_1_50_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Server.html#loc_50_1_50_16&#39;)"><span class="hl_varref"><span class="mpre">handshakeServer</span></span></a><span class="mpre">
    </span><a href="#loc_92_5_92_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_5_92_20&#39;)"><span class="hl_vardecl"><span class="mpre">doHandshakeWith</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Handshake.Server.html#loc_82_1_82_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.Server.html#loc_82_1_82_20&#39;)"><span class="hl_varref"><span class="mpre">handshakeServerWith</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | create a new context using the backend and parameters specified.</span></span><span class="mpre">
</span><a href="#loc_141_1_141_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_1_141_11&#39;)"><span class="mpre">contextNew</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxTuple (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 136, srcSpanStartColumn = 15, srcSpanEndLine = 137, srcSpanEndColumn = 14}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 136, srcSpanStartColumn = 15, srcSpanEndLine = 136, srcSpanEndColumn = 16},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 13"><span class="mpre">(MonadIO m, CPRG rng, HasBackend backend, TLSParams params)
           =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">backend</span></span><span class="mpre">   </span><span class="hl_comment"><span class="mpre">-- ^ Backend abstraction with specific method to interact with the connection type.</span></span><span class="mpre">
           -&gt; </span><span class="hl_tyvar"><span class="mpre">params</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ Parameters of the context.</span></span><span class="mpre">
           -&gt; </span><span class="hl_tyvar"><span class="mpre">rng</span></span><span class="mpre">       </span><span class="hl_comment"><span class="mpre">-- ^ Random number generator associated with this context.</span></span><span class="mpre">
           -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre">
</span><a name="loc_141_1_141_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_1_141_11&#39;)"><span class="hl_fundecl"><span class="mpre">contextNew</span></span></a><span class="mpre"> </span><a name="loc_141_12_141_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_12_141_19&#39;)"><span class="hl_vardecl"><span class="mpre">backend</span></span></a><span class="mpre"> </span><a name="loc_141_20_141_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_20_141_26&#39;)"><span class="hl_vardecl"><span class="mpre">params</span></span></a><span class="mpre"> </span><a name="loc_141_27_141_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_27_141_30&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> = </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a href="Network.TLS.Backend.html#loc_39_5_39_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Backend.html#loc_39_5_39_22&#39;)"><span class="hl_varref"><span class="mpre">initializeBackend</span></span></a><span class="mpre"> </span><a href="#loc_141_12_141_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_12_141_19&#39;)"><span class="hl_varref"><span class="mpre">backend</span></span></a><span class="mpre">

    let </span><a name="loc_144_9_144_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_9_144_13&#39;)"><span class="hl_vardecl"><span class="mpre">role</span></span></a><span class="mpre"> = </span><a href="#loc_89_5_89_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_5_89_15&#39;)"><span class="hl_varref"><span class="mpre">getTLSRole</span></span></a><span class="mpre"> </span><a href="#loc_141_20_141_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_20_141_26&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre">
        </span><a name="loc_145_9_145_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_9_145_11&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre">   = </span><a href="Network.TLS.State.html#loc_91_1_91_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_91_1_91_12&#39;)"><span class="hl_varref"><span class="mpre">newTLSState</span></span></a><span class="mpre"> </span><a href="#loc_141_27_141_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_27_141_30&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a href="#loc_144_9_144_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_9_144_13&#39;)"><span class="hl_varref"><span class="mpre">role</span></span></a><span class="mpre">
        (</span><span class="hl_vardecl"><span class="mpre">supported</span></span><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">shared</span></span><span class="mpre">) = </span><a href="#loc_88_5_88_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_5_88_23&#39;)"><span class="hl_varref"><span class="mpre">getTLSCommonParams</span></span></a><span class="mpre"> </span><a href="#loc_141_20_141_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_20_141_26&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre">
        </span><a name="loc_147_9_147_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_9_147_16&#39;)"><span class="hl_vardecl"><span class="mpre">ciphers</span></span></a><span class="mpre"> = </span><a href="#loc_90_5_90_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_15&#39;)"><span class="hl_varref"><span class="mpre">getCiphers</span></span></a><span class="mpre"> </span><a href="#loc_141_20_141_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_20_141_26&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre">

    </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_147_9_147_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_9_147_16&#39;)"><span class="hl_varref"><span class="mpre">ciphers</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;no ciphers available with those parameters&quot;</span></span><span class="mpre">

    </span><span class="hl_vardecl"><span class="mpre">stvar</span></span><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="hl_varref"><span class="mpre">newMVar</span></span></a><span class="mpre"> </span><a href="#loc_145_9_145_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_9_145_11&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">eof</span></span><span class="mpre">   &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">established</span></span><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">stats</span></span><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="Network.TLS.Measurement.html#loc_27_1_27_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Measurement.html#loc_27_1_27_15&#39;)"><span class="hl_varref"><span class="mpre">newMeasurement</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- we enable the reception of SSLv2 ClientHello message only in the</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- server context, where we might be dealing with an old/compat client.</span></span><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">sslv2Compat</span></span><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> (</span><a href="#loc_144_9_144_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_9_144_13&#39;)"><span class="hl_varref"><span class="mpre">role</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="Network.TLS.Types.html#loc_44_26_44_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_44_26_44_36&#39;)"><span class="hl_conref"><span class="mpre">ServerRole</span></span></a><span class="mpre">)
    </span><span class="hl_vardecl"><span class="mpre">needEmptyPacket</span></span><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">hooks</span></span><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="Network.TLS.Hooks.html#loc_51_1_51_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Hooks.html#loc_51_1_51_13&#39;)"><span class="hl_varref"><span class="mpre">defaultHooks</span></span></a><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">tx</span></span><span class="mpre">    &lt;- </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="hl_varref"><span class="mpre">newMVar</span></span></a><span class="mpre"> </span><a href="Network.TLS.Record.State.html#loc_96_1_96_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Record.State.html#loc_96_1_96_15&#39;)"><span class="hl_varref"><span class="mpre">newRecordState</span></span></a><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">rx</span></span><span class="mpre">    &lt;- </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="hl_varref"><span class="mpre">newMVar</span></span></a><span class="mpre"> </span><a href="Network.TLS.Record.State.html#loc_96_1_96_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Record.State.html#loc_96_1_96_15&#39;)"><span class="hl_varref"><span class="mpre">newRecordState</span></span></a><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">hs</span></span><span class="mpre">    &lt;- </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="hl_varref"><span class="mpre">newMVar</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">lockWrite</span></span><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="hl_varref"><span class="mpre">newMVar</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">lockRead</span></span><span class="mpre">  &lt;- </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="hl_varref"><span class="mpre">newMVar</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">lockState</span></span><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="hl_varref"><span class="mpre">newMVar</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 167, srcSpanStartColumn = 14, srcSpanEndLine = 187, srcSpanEndColumn = 14}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 168, srcSpanStartColumn = 13, srcSpanEndLine = 168, srcSpanEndColumn = 14},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = "><span class="mpre">Context
            { ctxConnection   = getBackend backend
            , ctxShared       = shared
            , ctxSupported    = supported
            , ctxCiphers      = ciphers
            , ctxState        = stvar
            , ctxTxState      = tx
            , ctxRxState      = rx
            , ctxHandshake    = hs
            , ctxDoHandshake  = doHandshake params
            , ctxDoHandshakeWith  = doHandshakeWith params
            , ctxMeasurement  = stats
            , ctxEOF_         = eof
            , ctxEstablished_ = established
            , ctxSSLv2ClientHello = sslv2Compat
            , ctxNeedEmptyPacket  = needEmptyPacket
            , ctxHooks            = hooks
            , ctxLockWrite        = lockWrite
            , ctxLockRead         = lockRead
            , ctxLockState        = lockState
            }</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | create a new context on an handle.</span></span><span class="mpre">
</span><a href="#loc_195_1_195_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_1_195_19&#39;)"><span class="mpre">contextNewOnHandle</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxTuple (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 190, srcSpanStartColumn = 23, srcSpanEndLine = 191, srcSpanEndColumn = 22}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 190, srcSpanStartColumn = 23, srcSpanEndLine = 190, srcSpanEndColumn = 24},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 19"><span class="mpre">(MonadIO m, CPRG rng, TLSParams params)
                   =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ Handle of the connection.</span></span><span class="mpre">
                   -&gt; </span><span class="hl_tyvar"><span class="mpre">params</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ Parameters of the context.</span></span><span class="mpre">
                   -&gt; </span><span class="hl_tyvar"><span class="mpre">rng</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ Random number generator associated with this context.</span></span><span class="mpre">
                   -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre">
</span><a name="loc_195_1_195_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_1_195_19&#39;)"><span class="hl_fundecl"><span class="mpre">contextNewOnHandle</span></span></a><span class="mpre"> </span><a name="loc_195_20_195_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_20_195_26&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_195_27_195_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_27_195_33&#39;)"><span class="hl_vardecl"><span class="mpre">params</span></span></a><span class="mpre"> </span><a name="loc_195_34_195_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_34_195_36&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> = </span><a href="#loc_141_1_141_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_1_141_11&#39;)"><span class="hl_varref"><span class="mpre">contextNew</span></span></a><span class="mpre"> </span><a href="#loc_195_20_195_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_20_195_26&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_195_27_195_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_27_195_33&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre"> </span><a href="#loc_195_34_195_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_34_195_36&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">
</span><span class="warning" data-warning="DeclDeprPragmaDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 196, srcSpanStartColumn = 1, srcSpanEndLine = 196, srcSpanEndColumn = 55}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 196, srcSpanStartColumn = 1, srcSpanEndLine = 196, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine"><span class="mpre">{-# DEPRECATED contextNewOnHandle &quot;use contextNew&quot; #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | create a new context on a socket.</span></span><span class="mpre">
</span><a href="#loc_204_1_204_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_1_204_19&#39;)"><span class="mpre">contextNewOnSocket</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxTuple (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 199, srcSpanStartColumn = 23, srcSpanEndLine = 200, srcSpanEndColumn = 22}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 199, srcSpanStartColumn = 23, srcSpanEndLine = 199, srcSpanEndColumn = 24},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 19"><span class="mpre">(MonadIO m, CPRG rng, TLSParams params)
                   =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ Socket of the connection.</span></span><span class="mpre">
                   -&gt; </span><span class="hl_tyvar"><span class="mpre">params</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ Parameters of the context.</span></span><span class="mpre">
                   -&gt; </span><span class="hl_tyvar"><span class="mpre">rng</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ Random number generator associated with this context.</span></span><span class="mpre">
                   -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre">
</span><a name="loc_204_1_204_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_1_204_19&#39;)"><span class="hl_fundecl"><span class="mpre">contextNewOnSocket</span></span></a><span class="mpre"> </span><a name="loc_204_20_204_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_20_204_24&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a name="loc_204_25_204_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_25_204_31&#39;)"><span class="hl_vardecl"><span class="mpre">params</span></span></a><span class="mpre"> </span><a name="loc_204_32_204_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_32_204_34&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> = </span><a href="#loc_141_1_141_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_1_141_11&#39;)"><span class="hl_varref"><span class="mpre">contextNew</span></span></a><span class="mpre"> </span><a href="#loc_204_20_204_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_20_204_24&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a href="#loc_204_25_204_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_25_204_31&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre"> </span><a href="#loc_204_32_204_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_32_204_34&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">
</span><span class="warning" data-warning="DeclDeprPragmaDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 205, srcSpanStartColumn = 1, srcSpanEndLine = 205, srcSpanEndColumn = 55}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 205, srcSpanStartColumn = 1, srcSpanEndLine = 205, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine"><span class="mpre">{-# DEPRECATED contextNewOnSocket &quot;use contextNew&quot; #-}</span></span><span class="mpre">

</span><a href="#loc_208_1_208_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_1_208_28&#39;)"><span class="mpre">contextHookSetHandshakeRecv</span></a><span class="mpre"> :: </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; (</span><a href="Network.TLS.Struct.html#loc_252_6_252_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_252_6_252_15&#39;)"><span class="hl_tyconref"><span class="mpre">Handshake</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_252_6_252_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_252_6_252_15&#39;)"><span class="hl_tyconref"><span class="mpre">Handshake</span></span></a><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_208_1_208_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_1_208_28&#39;)"><span class="hl_fundecl"><span class="mpre">contextHookSetHandshakeRecv</span></span></a><span class="mpre"> </span><a name="loc_208_29_208_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_29_208_36&#39;)"><span class="hl_vardecl"><span class="mpre">context</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">f</span></span><span class="mpre"> =
    </span><a href="Network.TLS.Context.Internal.html#loc_158_1_158_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_158_1_158_19&#39;)"><span class="hl_varref"><span class="mpre">contextModifyHooks</span></span></a><span class="mpre"> </span><a href="#loc_208_29_208_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_29_208_36&#39;)"><span class="hl_varref"><span class="mpre">context</span></span></a><span class="mpre"> (\</span><span class="hl_vardecl"><span class="mpre">hooks</span></span><span class="mpre"> -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 209, srcSpanStartColumn = 43, srcSpanEndLine = 209, srcSpanEndColumn = 74}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 209, srcSpanStartColumn = 49, srcSpanEndLine = 209, srcSpanEndColumn = 50},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = "><span class="mpre">hooks { hookRecvHandshake = f }</span></span><span class="mpre">)

</span><a href="#loc_212_1_212_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_1_212_30&#39;)"><span class="mpre">contextHookSetCertificateRecv</span></a><span class="mpre"> :: </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; (</span><a href="Data.X509.CertificateChain.html#loc_21_9_21_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.CertificateChain.html#loc_21_9_21_25&#39;)"><span class="hl_tyconref"><span class="mpre">CertificateChain</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_212_1_212_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_1_212_30&#39;)"><span class="hl_fundecl"><span class="mpre">contextHookSetCertificateRecv</span></span></a><span class="mpre"> </span><a name="loc_212_31_212_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_31_212_38&#39;)"><span class="hl_vardecl"><span class="mpre">context</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">f</span></span><span class="mpre"> =
    </span><a href="Network.TLS.Context.Internal.html#loc_158_1_158_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_158_1_158_19&#39;)"><span class="hl_varref"><span class="mpre">contextModifyHooks</span></span></a><span class="mpre"> </span><a href="#loc_212_31_212_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_31_212_38&#39;)"><span class="hl_varref"><span class="mpre">context</span></span></a><span class="mpre"> (\</span><span class="hl_vardecl"><span class="mpre">hooks</span></span><span class="mpre"> -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 213, srcSpanStartColumn = 43, srcSpanEndLine = 213, srcSpanEndColumn = 77}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 213, srcSpanStartColumn = 49, srcSpanEndLine = 213, srcSpanEndColumn = 50},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = "><span class="mpre">hooks { hookRecvCertificates = f }</span></span><span class="mpre">)

</span><a href="#loc_216_1_216_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_1_216_22&#39;)"><span class="mpre">contextHookSetLogging</span></a><span class="mpre"> :: </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Hooks.html#loc_22_6_22_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Hooks.html#loc_22_6_22_13&#39;)"><span class="hl_tyconref"><span class="mpre">Logging</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_216_1_216_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_1_216_22&#39;)"><span class="hl_fundecl"><span class="mpre">contextHookSetLogging</span></span></a><span class="mpre"> </span><a name="loc_216_23_216_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_23_216_30&#39;)"><span class="hl_vardecl"><span class="mpre">context</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">loggingCallbacks</span></span><span class="mpre"> =
    </span><a href="Network.TLS.Context.Internal.html#loc_158_1_158_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_158_1_158_19&#39;)"><span class="hl_varref"><span class="mpre">contextModifyHooks</span></span></a><span class="mpre"> </span><a href="#loc_216_23_216_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_23_216_30&#39;)"><span class="hl_varref"><span class="mpre">context</span></span></a><span class="mpre"> (\</span><span class="hl_vardecl"><span class="mpre">hooks</span></span><span class="mpre"> -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 217, srcSpanStartColumn = 43, srcSpanEndLine = 217, srcSpanEndColumn = 83}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = 217, srcSpanStartColumn = 49, srcSpanEndLine = 217, srcSpanEndColumn = 50},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context.hs&quot;, srcSpanStartLine = "><span class="mpre">hooks { hookLogging = loggingCallbacks }</span></span><span class="mpre">)
</span></div></body></html>