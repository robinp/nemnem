<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE DeriveDataTypeable #-}
{-# LANGUAGE ViewPatterns #-}
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Network.Socks5</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This is an implementation of SOCKS5 as defined in RFC 1928</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- In Wikipedia&#39;s words:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   SOCKet Secure (SOCKS) is an Internet protocol that routes network packets</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   between a client and server through a proxy server. SOCKS5 additionally</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   provides authentication so only authorized users may access a server.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   Practically, a SOCKS server will proxy TCP connections to an arbitrary IP</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   address as well as providing a means for UDP packets to be forwarded.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- BIND and UDP ASSOCIATE messages are not implemented.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- However main usage of SOCKS is covered in this implementation.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Network.Socks5
    (
    </span><span class="hl_comment"><span class="mpre">-- * Types</span></span><span class="mpre">
      SocksAddress(..)
    , SocksHostAddress(..)
    , SocksReply(..)
    , SocksError(..)
    </span><span class="hl_comment"><span class="mpre">-- * Configuration</span></span><span class="mpre">
    , module Network.Socks5.Conf
    </span><span class="hl_comment"><span class="mpre">-- * Methods</span></span><span class="mpre">
    , socksConnectWithSocket
    , socksConnect
    </span><span class="hl_comment"><span class="mpre">-- * Variants</span></span><span class="mpre">
    , socksConnectAddr
    , socksConnectName
    , socksConnectTo
    , socksConnectWith
    ) where

import Control.Monad
import Control.Exception
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5.hs&quot;, srcSpanStartLine = 44, srcSpanStartColumn = 18, srcSpanEndLine = 44, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as BC
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5.hs&quot;, srcSpanStartLine = 45, srcSpanStartColumn = 8, srcSpanEndLine = 45, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre"> ( sClose, Socket, SocketType(..), SockAddr(..), Family(..)
                      , socket, socketToHandle, connect)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5.hs&quot;, srcSpanStartLine = 47, srcSpanStartColumn = 8, srcSpanEndLine = 47, srcSpanEndColumn = 19}, srcInfoPoints = []}) &quot;Network.BSD&quot;"><span class="mpre">Network.BSD</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5.hs&quot;, srcSpanStartLine = 48, srcSpanStartColumn = 8, srcSpanEndLine = 48, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;Network&quot;"><span class="mpre">Network</span></span><span class="mpre"> (PortID(..))

import qualified Network.Socks5.Command as Cmd
import Network.Socks5.Conf
import Network.Socks5.Types
import Network.Socks5.Lowlevel

import System.IO

</span><span class="hl_comment"><span class="mpre">-- | connect a user specified new socket to the socks server,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- and connect the stream on the server side to the &#39;SockAddress&#39; specified.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |socket|-----sockServer-----&gt;|server|----destAddr-----&gt;|destination|</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_66_1_66_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_23&#39;)"><span class="mpre">socksConnectWithSocket</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre">       </span><span class="hl_comment"><span class="mpre">-- ^ Socket to use.</span></span><span class="mpre">
                       -&gt; </span><a href="Network.Socks5.Conf.html#loc_24_6_24_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Conf.html#loc_24_6_24_15&#39;)"><span class="hl_tyconref"><span class="mpre">SocksConf</span></span></a><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ SOCKS configuration for the server.</span></span><span class="mpre">
                       -&gt; </span><a href="Network.Socks5.Types.html#loc_87_6_87_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_87_6_87_18&#39;)"><span class="hl_tyconref"><span class="mpre">SocksAddress</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ SOCKS Address to connect to.</span></span><span class="mpre">
                       -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.Socks5.Types.html#loc_53_6_53_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_53_6_53_22&#39;)"><span class="hl_tyconref"><span class="mpre">SocksHostAddress</span></span></a><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">PortNumber</span></span><span class="mpre">)
</span><a name="loc_66_1_66_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_23&#39;)"><span class="hl_fundecl"><span class="mpre">socksConnectWithSocket</span></span></a><span class="mpre"> </span><a name="loc_66_24_66_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_24_66_28&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a name="loc_66_29_66_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_29_66_39&#39;)"><span class="hl_vardecl"><span class="mpre">serverConf</span></span></a><span class="mpre"> </span><a name="loc_66_40_66_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_40_66_48&#39;)"><span class="hl_vardecl"><span class="mpre">destAddr</span></span></a><span class="mpre"> = do
    </span><a name="loc_67_5_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_5_67_15&#39;)"><span class="hl_vardecl"><span class="mpre">serverAddr</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Socks5.Lowlevel.html#loc_17_1_17_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Lowlevel.html#loc_17_1_17_18&#39;)"><span class="hl_varref"><span class="mpre">resolveToSockAddr</span></span></a><span class="mpre"> (</span><a href="Network.Socks5.Conf.html#loc_25_7_25_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Conf.html#loc_25_7_25_18&#39;)"><span class="hl_varref"><span class="mpre">socksServer</span></span></a><span class="mpre"> </span><a href="#loc_66_29_66_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_29_66_39&#39;)"><span class="hl_varref"><span class="mpre">serverConf</span></span></a><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">connect</span></span><span class="mpre"> </span><a href="#loc_66_24_66_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_24_66_28&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a href="#loc_67_5_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_5_67_15&#39;)"><span class="hl_varref"><span class="mpre">serverAddr</span></span></a><span class="mpre">
    </span><a name="loc_69_5_69_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_5_69_6&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Socks5.Command.html#loc_39_1_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Command.html#loc_39_1_39_10&#39;)"><span class="hl_varref"><span class="mpre">Cmd.establish</span></span></a><span class="mpre"> </span><a href="#loc_66_24_66_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_24_66_28&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> [</span><a href="Network.Socks5.Types.html#loc_45_7_45_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_45_7_45_22&#39;)"><span class="hl_conref"><span class="mpre">SocksMethodNone</span></span></a><span class="mpre">]
    </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_69_5_69_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_5_69_6&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="Network.Socks5.Types.html#loc_49_7_49_31" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_49_7_49_31&#39;)"><span class="hl_conref"><span class="mpre">SocksMethodNotAcceptable</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;cannot connect with no socks method of authentication&quot;</span></span><span class="mpre">
    </span><a href="Network.Socks5.Command.html#loc_94_1_94_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Command.html#loc_94_1_94_5&#39;)"><span class="hl_varref"><span class="mpre">Cmd.rpc_</span></span></a><span class="mpre"> </span><a href="#loc_66_24_66_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_24_66_28&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> (</span><a href="Network.Socks5.Command.html#loc_43_19_43_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Command.html#loc_43_19_43_26&#39;)"><span class="hl_conref"><span class="mpre">Connect</span></span></a><span class="mpre"> </span><a href="#loc_66_40_66_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_40_66_48&#39;)"><span class="hl_varref"><span class="mpre">destAddr</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | connect a new socket to a socks server and connect the stream on the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- server side to the &#39;SocksAddress&#39; specified.</span></span><span class="mpre">
</span><a href="#loc_78_1_78_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_13&#39;)"><span class="mpre">socksConnect</span></a><span class="mpre"> :: </span><a href="Network.Socks5.Conf.html#loc_24_6_24_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Conf.html#loc_24_6_24_15&#39;)"><span class="hl_tyconref"><span class="mpre">SocksConf</span></span></a><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ SOCKS configuration for the server.</span></span><span class="mpre">
             -&gt; </span><a href="Network.Socks5.Types.html#loc_87_6_87_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_87_6_87_18&#39;)"><span class="hl_tyconref"><span class="mpre">SocksAddress</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ SOCKS Address to connect to.</span></span><span class="mpre">
             -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre">, (</span><a href="Network.Socks5.Types.html#loc_53_6_53_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_53_6_53_22&#39;)"><span class="hl_tyconref"><span class="mpre">SocksHostAddress</span></span></a><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">PortNumber</span></span><span class="mpre">))
</span><a name="loc_78_1_78_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_13&#39;)"><span class="hl_fundecl"><span class="mpre">socksConnect</span></span></a><span class="mpre"> </span><a name="loc_78_14_78_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_14_78_24&#39;)"><span class="hl_vardecl"><span class="mpre">serverConf</span></span></a><span class="mpre"> </span><a name="loc_78_25_78_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_25_78_33&#39;)"><span class="hl_vardecl"><span class="mpre">destAddr</span></span></a><span class="mpre"> =
    </span><span class="hl_varref"><span class="mpre">getProtocolNumber</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;tcp&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> \</span><a name="loc_79_34_79_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_34_79_39&#39;)"><span class="hl_vardecl"><span class="mpre">proto</span></span></a><span class="mpre"> -&gt;
    </span><a href="Control.Exception.Base.html#loc_291_1_291_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_291_1_291_15&#39;)"><span class="hl_varref"><span class="mpre">bracketOnError</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">socket</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">AF_INET</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Stream</span></span><span class="mpre"> </span><a href="#loc_79_34_79_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_34_79_39&#39;)"><span class="hl_varref"><span class="mpre">proto</span></span></a><span class="mpre">) </span><span class="hl_varref"><span class="mpre">sClose</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_80_60_80_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_60_80_64&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> -&gt; do
        </span><a name="loc_81_9_81_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_9_81_12&#39;)"><span class="hl_vardecl"><span class="mpre">ret</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_66_1_66_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_23&#39;)"><span class="hl_varref"><span class="mpre">socksConnectWithSocket</span></span></a><span class="mpre"> </span><a href="#loc_80_60_80_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_60_80_64&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a href="#loc_78_14_78_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_14_78_24&#39;)"><span class="hl_varref"><span class="mpre">serverConf</span></span></a><span class="mpre"> </span><a href="#loc_78_25_78_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_25_78_33&#39;)"><span class="hl_varref"><span class="mpre">destAddr</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_80_60_80_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_60_80_64&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre">, </span><a href="#loc_81_9_81_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_9_81_12&#39;)"><span class="hl_varref"><span class="mpre">ret</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | connect a new socket to the socks server, and connect the stream on the server side</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to the sockaddr specified. the sockaddr need to be SockAddrInet or SockAddrInet6.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a unix sockaddr will raises an exception.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |socket|-----sockServer-----&gt;|server|----destAddr-----&gt;|destination|</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclDeprPragmaDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5.hs&quot;, srcSpanStartLine = 90, srcSpanStartColumn = 1, srcSpanEndLine = 90, srcSpanEndColumn = 65}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5.hs&quot;, srcSpanStartLine = 90, srcSpanStartColumn = 1, srcSpanEndLine = 90, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5.hs&quot;, srcSpanStartLine = 90, srcSpa"><span class="mpre">{-# DEPRECATED socksConnectAddr &quot;use socksConnectWithSocket&quot; #-}</span></span><span class="mpre">
</span><a href="#loc_92_1_92_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_17&#39;)"><span class="mpre">socksConnectAddr</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">SockAddr</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">SockAddr</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_92_1_92_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_1_92_17&#39;)"><span class="hl_fundecl"><span class="mpre">socksConnectAddr</span></span></a><span class="mpre"> </span><a name="loc_92_18_92_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_18_92_22&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a name="loc_92_23_92_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_23_92_33&#39;)"><span class="hl_vardecl"><span class="mpre">sockserver</span></span></a><span class="mpre"> </span><a name="loc_92_34_92_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_34_92_42&#39;)"><span class="hl_vardecl"><span class="mpre">destaddr</span></span></a><span class="mpre"> =
    </span><a href="#loc_66_1_66_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_23&#39;)"><span class="hl_varref"><span class="mpre">socksConnectWithSocket</span></span></a><span class="mpre"> </span><a href="#loc_92_18_92_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_18_92_22&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre">
                           (</span><a href="Network.Socks5.Conf.html#loc_46_1_46_29" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Conf.html#loc_46_1_46_29&#39;)"><span class="hl_varref"><span class="mpre">defaultSocksConfFromSockAddr</span></span></a><span class="mpre"> </span><a href="#loc_92_23_92_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_23_92_33&#39;)"><span class="hl_varref"><span class="mpre">sockserver</span></span></a><span class="mpre">)
                           (</span><a href="Network.Socks5.Conf.html#loc_25_7_25_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Conf.html#loc_25_7_25_18&#39;)"><span class="hl_varref"><span class="mpre">socksServer</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Socks5.Conf.html#loc_46_1_46_29" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Conf.html#loc_46_1_46_29&#39;)"><span class="hl_varref"><span class="mpre">defaultSocksConfFromSockAddr</span></span></a><span class="mpre"> </span><a href="#loc_92_34_92_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_34_92_42&#39;)"><span class="hl_varref"><span class="mpre">destaddr</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | connect a new socket to the socks server, and connect the stream to a FQDN</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- resolved on the server side.</span></span><span class="mpre">
</span><a href="#loc_101_1_101_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_17&#39;)"><span class="mpre">socksConnectName</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">SockAddr</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">PortNumber</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_101_1_101_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_17&#39;)"><span class="hl_fundecl"><span class="mpre">socksConnectName</span></span></a><span class="mpre"> </span><a name="loc_101_18_101_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_18_101_22&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a name="loc_101_23_101_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_23_101_33&#39;)"><span class="hl_vardecl"><span class="mpre">sockserver</span></span></a><span class="mpre"> </span><a name="loc_101_34_101_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_34_101_45&#39;)"><span class="hl_vardecl"><span class="mpre">destination</span></span></a><span class="mpre"> </span><a name="loc_101_46_101_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_46_101_50&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> = do
    </span><a href="#loc_66_1_66_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_23&#39;)"><span class="hl_varref"><span class="mpre">socksConnectWithSocket</span></span></a><span class="mpre"> </span><a href="#loc_101_18_101_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_18_101_22&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre">
                           (</span><a href="Network.Socks5.Conf.html#loc_46_1_46_29" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Conf.html#loc_46_1_46_29&#39;)"><span class="hl_varref"><span class="mpre">defaultSocksConfFromSockAddr</span></span></a><span class="mpre"> </span><a href="#loc_101_23_101_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_23_101_33&#39;)"><span class="hl_varref"><span class="mpre">sockserver</span></span></a><span class="mpre">)
                           (</span><a href="Network.Socks5.Types.html#loc_87_21_87_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_87_21_87_33&#39;)"><span class="hl_conref"><span class="mpre">SocksAddress</span></span></a><span class="mpre"> (</span><a href="Network.Socks5.Types.html#loc_55_7_55_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_55_7_55_26&#39;)"><span class="hl_conref"><span class="mpre">SocksAddrDomainName</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">BC.pack</span></span><span class="mpre"> </span><a href="#loc_101_34_101_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_34_101_45&#39;)"><span class="hl_varref"><span class="mpre">destination</span></span></a><span class="mpre">) </span><a href="#loc_101_46_101_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_46_101_50&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre">)
    </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | create a new socket and connect in to a destination through the specified</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- SOCKS configuration.</span></span><span class="mpre">
</span><a href="#loc_113_1_113_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_1_113_17&#39;)"><span class="mpre">socksConnectWith</span></a><span class="mpre"> :: </span><a href="Network.Socks5.Conf.html#loc_24_6_24_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Conf.html#loc_24_6_24_15&#39;)"><span class="hl_tyconref"><span class="mpre">SocksConf</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ SOCKS configuration</span></span><span class="mpre">
                 -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ destination hostname</span></span><span class="mpre">
                 -&gt; </span><span class="hl_tyconref"><span class="mpre">PortID</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ destination port</span></span><span class="mpre">
                 -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre">
</span><a name="loc_113_1_113_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_1_113_17&#39;)"><span class="hl_fundecl"><span class="mpre">socksConnectWith</span></span></a><span class="mpre"> </span><a name="loc_113_18_113_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_18_113_27&#39;)"><span class="hl_vardecl"><span class="mpre">socksConf</span></span></a><span class="mpre"> </span><a name="loc_113_28_113_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_28_113_36&#39;)"><span class="hl_vardecl"><span class="mpre">desthost</span></span></a><span class="mpre"> </span><a name="loc_113_37_113_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_37_113_45&#39;)"><span class="hl_vardecl"><span class="mpre">destport</span></span></a><span class="mpre"> = do
    </span><a name="loc_114_5_114_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_5_114_10&#39;)"><span class="hl_vardecl"><span class="mpre">dport</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_129_1_129_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_14&#39;)"><span class="hl_varref"><span class="mpre">resolvePortID</span></span></a><span class="mpre"> </span><a href="#loc_113_37_113_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_37_113_45&#39;)"><span class="hl_varref"><span class="mpre">destport</span></span></a><span class="mpre">
    </span><a name="loc_115_5_115_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_5_115_10&#39;)"><span class="hl_vardecl"><span class="mpre">proto</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getProtocolNumber</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;tcp&quot;</span></span><span class="mpre">
    </span><a href="Control.Exception.Base.html#loc_291_1_291_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_291_1_291_15&#39;)"><span class="hl_varref"><span class="mpre">bracketOnError</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">socket</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">AF_INET</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Stream</span></span><span class="mpre"> </span><a href="#loc_115_5_115_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_5_115_10&#39;)"><span class="hl_varref"><span class="mpre">proto</span></span></a><span class="mpre">) </span><span class="hl_varref"><span class="mpre">sClose</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_116_60_116_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_60_116_64&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> -&gt; do
        </span><a name="loc_117_9_117_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_9_117_17&#39;)"><span class="hl_vardecl"><span class="mpre">sockaddr</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Socks5.Lowlevel.html#loc_17_1_17_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Lowlevel.html#loc_17_1_17_18&#39;)"><span class="hl_varref"><span class="mpre">resolveToSockAddr</span></span></a><span class="mpre"> (</span><a href="Network.Socks5.Conf.html#loc_25_7_25_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Conf.html#loc_25_7_25_18&#39;)"><span class="hl_varref"><span class="mpre">socksServer</span></span></a><span class="mpre"> </span><a href="#loc_113_18_113_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_18_113_27&#39;)"><span class="hl_varref"><span class="mpre">socksConf</span></span></a><span class="mpre">)
        </span><a href="#loc_101_1_101_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_17&#39;)"><span class="hl_varref"><span class="mpre">socksConnectName</span></span></a><span class="mpre"> </span><a href="#loc_116_60_116_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_60_116_64&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a href="#loc_117_9_117_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_9_117_17&#39;)"><span class="hl_varref"><span class="mpre">sockaddr</span></span></a><span class="mpre"> </span><a href="#loc_113_28_113_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_28_113_36&#39;)"><span class="hl_varref"><span class="mpre">desthost</span></span></a><span class="mpre"> </span><a href="#loc_114_5_114_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_5_114_10&#39;)"><span class="hl_varref"><span class="mpre">dport</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_116_60_116_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_60_116_64&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | similar to Network connectTo but use a socks proxy with default socks configuration.</span></span><span class="mpre">
</span><a href="#loc_123_1_123_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_15&#39;)"><span class="mpre">socksConnectTo</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">PortID</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">PortID</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre">
</span><a name="loc_123_1_123_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_15&#39;)"><span class="hl_fundecl"><span class="mpre">socksConnectTo</span></span></a><span class="mpre"> </span><a name="loc_123_16_123_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_16_123_25&#39;)"><span class="hl_vardecl"><span class="mpre">sockshost</span></span></a><span class="mpre"> </span><a name="loc_123_26_123_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_26_123_35&#39;)"><span class="hl_vardecl"><span class="mpre">socksport</span></span></a><span class="mpre"> </span><a name="loc_123_36_123_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_36_123_44&#39;)"><span class="hl_vardecl"><span class="mpre">desthost</span></span></a><span class="mpre"> </span><a name="loc_123_45_123_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_45_123_53&#39;)"><span class="hl_vardecl"><span class="mpre">destport</span></span></a><span class="mpre"> = do
    </span><a name="loc_124_5_124_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_5_124_10&#39;)"><span class="hl_vardecl"><span class="mpre">sport</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_129_1_129_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_14&#39;)"><span class="hl_varref"><span class="mpre">resolvePortID</span></span></a><span class="mpre"> </span><a href="#loc_123_26_123_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_26_123_35&#39;)"><span class="hl_varref"><span class="mpre">socksport</span></span></a><span class="mpre">
    let </span><a name="loc_125_9_125_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_9_125_18&#39;)"><span class="hl_vardecl"><span class="mpre">socksConf</span></span></a><span class="mpre"> = </span><a href="Network.Socks5.Conf.html#loc_39_1_39_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Conf.html#loc_39_1_39_17&#39;)"><span class="hl_varref"><span class="mpre">defaultSocksConf</span></span></a><span class="mpre"> </span><a href="#loc_123_16_123_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_16_123_25&#39;)"><span class="hl_varref"><span class="mpre">sockshost</span></span></a><span class="mpre"> </span><a href="#loc_124_5_124_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_5_124_10&#39;)"><span class="hl_varref"><span class="mpre">sport</span></span></a><span class="mpre">
    </span><a name="loc_126_5_126_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_5_126_9&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_113_1_113_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_1_113_17&#39;)"><span class="hl_varref"><span class="mpre">socksConnectWith</span></span></a><span class="mpre"> </span><a href="#loc_125_9_125_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_9_125_18&#39;)"><span class="hl_varref"><span class="mpre">socksConf</span></span></a><span class="mpre"> </span><a href="#loc_123_36_123_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_36_123_44&#39;)"><span class="hl_varref"><span class="mpre">desthost</span></span></a><span class="mpre"> </span><a href="#loc_123_45_123_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_45_123_53&#39;)"><span class="hl_varref"><span class="mpre">destport</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">socketToHandle</span></span><span class="mpre"> </span><a href="#loc_126_5_126_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_5_126_9&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a href="GHC.IO.IOMode.html#loc_28_57_28_70" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.IOMode.html#loc_28_57_28_70&#39;)"><span class="hl_conref"><span class="mpre">ReadWriteMode</span></span></a><span class="mpre">

</span><a name="loc_129_1_129_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_14&#39;)"><span class="hl_fundecl"><span class="mpre">resolvePortID</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Service</span></span><span class="mpre"> </span><a name="loc_129_24_129_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_24_129_28&#39;)"><span class="hl_vardecl"><span class="mpre">serv</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">getServicePortNumber</span></span><span class="mpre"> </span><a href="#loc_129_24_129_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_24_129_28&#39;)"><span class="hl_varref"><span class="mpre">serv</span></span></a><span class="mpre">
</span><a href="#loc_129_1_129_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_14&#39;)"><span class="hl_fundecl"><span class="mpre">resolvePortID</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">PortNumber</span></span><span class="mpre"> </span><a name="loc_130_27_130_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_27_130_28&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_130_27_130_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_27_130_28&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
</span><a href="#loc_129_1_129_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_14&#39;)"><span class="hl_fundecl"><span class="mpre">resolvePortID</span></span></a><span class="mpre"> _              = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;unsupported unix PortID&quot;</span></span><span class="mpre">
</span></div></body></html>