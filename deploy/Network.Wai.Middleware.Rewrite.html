<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE OverloadedStrings #-}
module Network.Wai.Middleware.Rewrite
    ( rewrite, rewritePure
    ) where

import Network.Wai
import Control.Monad.IO.Class (</span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="mpre">liftIO</span></a><span class="mpre">)
import Data.Text (</span><a href="Data.Text.Internal.html#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_6_50_10&#39;)"><span class="mpre">Text</span></a><span class="mpre">)
import qualified Data.Text.Encoding as TE
import qualified Data.Text as T
import Network.HTTP.Types as H


</span><span class="hl_comment"><span class="mpre">-- | rewrite based on your own conversion rules</span></span><span class="mpre">
</span><a href="#loc_16_1_16_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_8&#39;)"><span class="mpre">rewrite</span></a><span class="mpre"> :: ([</span><a href="Data.Text.Internal.html#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">H.RequestHeaders</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> [</span><a href="Data.Text.Internal.html#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre">]) -&gt; </span><span class="hl_tyconref"><span class="mpre">Middleware</span></span><span class="mpre">
</span><a name="loc_16_1_16_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_8&#39;)"><span class="hl_fundecl"><span class="mpre">rewrite</span></span></a><span class="mpre"> </span><a name="loc_16_9_16_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_9_16_16&#39;)"><span class="hl_vardecl"><span class="mpre">convert</span></span></a><span class="mpre"> </span><a name="loc_16_17_16_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_17_16_20&#39;)"><span class="hl_vardecl"><span class="mpre">app</span></span></a><span class="mpre"> </span><a name="loc_16_21_16_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_21_16_24&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> </span><a name="loc_16_25_16_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_25_16_37&#39;)"><span class="hl_vardecl"><span class="mpre">sendResponse</span></span></a><span class="mpre"> = do
  </span><a name="loc_17_3_17_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_3_17_14&#39;)"><span class="hl_vardecl"><span class="mpre">newPathInfo</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_16_9_16_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_9_16_16&#39;)"><span class="hl_varref"><span class="mpre">convert</span></span></a><span class="mpre"> (</span><a href="Network.Wai.Internal.html#loc_50_6_50_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_50_6_50_14&#39;)"><span class="hl_varref"><span class="mpre">pathInfo</span></span></a><span class="mpre"> </span><a href="#loc_16_21_16_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_21_16_24&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">) (</span><a href="Network.Wai.Internal.html#loc_36_6_36_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_36_6_36_20&#39;)"><span class="hl_varref"><span class="mpre">requestHeaders</span></span></a><span class="mpre"> </span><a href="#loc_16_21_16_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_21_16_24&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">)
  let </span><span class="hl_vardecl"><span class="mpre">rawPInfo</span></span><span class="mpre"> = </span><a href="Data.Text.Encoding.html#loc_386_1_386_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Encoding.html#loc_386_1_386_11&#39;)"><span class="hl_varref"><span class="mpre">TE.encodeUtf8</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Text.html#loc_615_1_615_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.html#loc_615_1_615_12&#39;)"><span class="hl_varref"><span class="mpre">T.intercalate</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;/&quot;</span></span><span class="mpre"> </span><a href="#loc_17_3_17_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_3_17_14&#39;)"><span class="hl_varref"><span class="mpre">newPathInfo</span></span></a><span class="mpre">
  </span><a href="#loc_16_17_16_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_17_16_20&#39;)"><span class="hl_varref"><span class="mpre">app</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/Rewrite.hs&quot;, srcSpanStartLine = 19, srcSpanStartColumn = 7, srcSpanEndLine = 19, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/Rewrite.hs&quot;, srcSpanStartLine = 19, srcSpanStartColumn = 11, srcSpanEndLine = 19, srcSpanEndColumn = 12},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Net"><span class="mpre">req { pathInfo = newPathInfo, rawPathInfo =  rawPInfo }</span></span><span class="mpre"> </span><a href="#loc_16_25_16_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_25_16_37&#39;)"><span class="hl_varref"><span class="mpre">sendResponse</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | rewrite based on your own conversion rules</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Example convert function:</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- staticConvert :: [Text] -&gt; H.RequestHeaders -&gt; [Text]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- staticConvert pieces _ = piecesConvert pieces</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   where</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    piecesConvert [] = [&quot;static&quot;, &quot;html&quot;, &quot;pages.html&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    piecesConvert route@(&quot;pages&quot;:_) = &quot;static&quot;:&quot;html&quot;:route</span></span><span class="mpre">
</span><a href="#loc_30_1_30_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_1_30_12&#39;)"><span class="mpre">rewritePure</span></a><span class="mpre"> :: ([</span><a href="Data.Text.Internal.html#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">H.RequestHeaders</span></span><span class="mpre"> -&gt; [</span><a href="Data.Text.Internal.html#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre">]) -&gt; </span><span class="hl_tyconref"><span class="mpre">Middleware</span></span><span class="mpre">
</span><a name="loc_30_1_30_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_1_30_12&#39;)"><span class="hl_fundecl"><span class="mpre">rewritePure</span></span></a><span class="mpre"> </span><a name="loc_30_13_30_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_13_30_20&#39;)"><span class="hl_vardecl"><span class="mpre">convert</span></span></a><span class="mpre"> </span><a name="loc_30_21_30_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_21_30_24&#39;)"><span class="hl_vardecl"><span class="mpre">app</span></span></a><span class="mpre"> </span><a name="loc_30_25_30_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_25_30_28&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> =
  let </span><a name="loc_31_7_31_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_7_31_12&#39;)"><span class="hl_vardecl"><span class="mpre">pInfo</span></span></a><span class="mpre"> = </span><a href="#loc_30_13_30_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_13_30_20&#39;)"><span class="hl_varref"><span class="mpre">convert</span></span></a><span class="mpre"> (</span><a href="Network.Wai.Internal.html#loc_50_6_50_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_50_6_50_14&#39;)"><span class="hl_varref"><span class="mpre">pathInfo</span></span></a><span class="mpre"> </span><a href="#loc_30_25_30_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_25_30_28&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">) (</span><a href="Network.Wai.Internal.html#loc_36_6_36_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_36_6_36_20&#39;)"><span class="hl_varref"><span class="mpre">requestHeaders</span></span></a><span class="mpre"> </span><a href="#loc_30_25_30_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_25_30_28&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">)
      </span><span class="hl_vardecl"><span class="mpre">rawPInfo</span></span><span class="mpre"> = </span><a href="Data.Text.Encoding.html#loc_386_1_386_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Encoding.html#loc_386_1_386_11&#39;)"><span class="hl_varref"><span class="mpre">TE.encodeUtf8</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Text.html#loc_615_1_615_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.html#loc_615_1_615_12&#39;)"><span class="hl_varref"><span class="mpre">T.intercalate</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;/&quot;</span></span><span class="mpre"> </span><a href="#loc_31_7_31_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_7_31_12&#39;)"><span class="hl_varref"><span class="mpre">pInfo</span></span></a><span class="mpre">
  in  </span><a href="#loc_30_21_30_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_21_30_24&#39;)"><span class="hl_varref"><span class="mpre">app</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/Rewrite.hs&quot;, srcSpanStartLine = 33, srcSpanStartColumn = 11, srcSpanEndLine = 33, srcSpanEndColumn = 60}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/Rewrite.hs&quot;, srcSpanStartLine = 33, srcSpanStartColumn = 15, srcSpanEndLine = 33, srcSpanEndColumn = 16},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Ne"><span class="mpre">req { pathInfo = pInfo, rawPathInfo =  rawPInfo }</span></span><span class="mpre">
</span></div></body></html>