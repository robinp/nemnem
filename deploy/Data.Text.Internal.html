<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE CPP, DeriveDataTypeable #-}
{-# OPTIONS_HADDOCK not-home #-}

</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Data.Text.Internal</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   : (c) 2008, 2009 Tom Harper,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--               (c) 2009, 2010 Bryan O&#39;Sullivan,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--               (c) 2009 Duncan Coutts</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : bos@serpentine.com</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : GHC</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A module containing private &#39;Text&#39; internals. This exposes the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Text&#39; representation and low level construction functions.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Modules which extend the &#39;Text&#39; system may need to use this module.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- You should not use this module unless you are determined to monkey</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- with the internals, as the functions here do just about nothing to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- preserve data invariants.  You have been warned!</span></span><span class="mpre">

module Data.Text.Internal
    (
    </span><span class="hl_comment"><span class="mpre">-- * Types</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- $internals</span></span><span class="mpre">
      Text(..)
    </span><span class="hl_comment"><span class="mpre">-- * Construction</span></span><span class="mpre">
    , text
    , textP
    </span><span class="hl_comment"><span class="mpre">-- * Safety</span></span><span class="mpre">
    , safe
    </span><span class="hl_comment"><span class="mpre">-- * Code that must be here for accessibility</span></span><span class="mpre">
    , empty
    </span><span class="hl_comment"><span class="mpre">-- * Utilities</span></span><span class="mpre">
    , firstf
    </span><span class="hl_comment"><span class="mpre">-- * Debugging</span></span><span class="mpre">
    , showText
    ) where

#if defined(ASSERTS)
import Control.Exception (assert)
#endif
import Data.Bits ((.&amp;.))
import qualified Data.Text.Array as A
import Data.Text.Internal.Unsafe.Char (</span><a href="Data.Text.Internal.Unsafe.Char.html#loc_40_1_40_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Unsafe.Char.html#loc_40_1_40_4&#39;)"><span class="mpre">ord</span></a><span class="mpre">)
import Data.Typeable (</span><a href="Data.Typeable.Internal.html#loc_196_7_196_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Typeable.Internal.html#loc_196_7_196_15&#39;)"><span class="mpre">Typeable</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | A space efficient, packed, unboxed Unicode text type.</span></span><span class="mpre">
data </span><a name="loc_50_6_50_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_10&#39;)"><span class="hl_tycondecl"><span class="mpre">Text</span></span></a><span class="mpre"> = </span><a name="loc_50_13_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_13_50_17&#39;)"><span class="hl_condecl"><span class="mpre">Text</span></span></a><span class="mpre">
    {-# UNPACK #-} !</span><a href="Data.Text.Array.html#loc_83_6_83_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Array.html#loc_83_6_83_11&#39;)"><span class="hl_tyconref"><span class="mpre">A.Array</span></span></a><span class="mpre">          </span><span class="hl_comment"><span class="mpre">-- payload (Word16 elements)</span></span><span class="mpre">
    {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">              </span><span class="hl_comment"><span class="mpre">-- offset (units of Word16, not Char)</span></span><span class="mpre">
    {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">              </span><span class="hl_comment"><span class="mpre">-- length (units of Word16, not Char)</span></span><span class="mpre">
    </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 5, srcSpanEndLine = 54, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 5, srcSpanEndLine = 54, srcSpanEndColumn = 13},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal.hs&quot;, srcSpanStartLine = 5"><span class="mpre">deriving (Typeable)</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Smart constructor.</span></span><span class="mpre">
</span><a href="#loc_58_1_58_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_6&#39;)"><span class="mpre">text_</span></a><span class="mpre"> :: </span><a href="Data.Text.Array.html#loc_83_6_83_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Array.html#loc_83_6_83_11&#39;)"><span class="hl_tyconref"><span class="mpre">A.Array</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre">
</span><a name="loc_58_1_58_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_6&#39;)"><span class="hl_fundecl"><span class="mpre">text_</span></span></a><span class="mpre"> </span><a name="loc_58_7_58_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_7_58_10&#39;)"><span class="hl_vardecl"><span class="mpre">arr</span></span></a><span class="mpre"> </span><a name="loc_58_11_58_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_11_58_14&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_58_15_58_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_15_58_18&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> =
#if defined(ASSERTS)
  let </span><a name="loc_60_7_60_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_7_60_8&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre">    = </span><a href="Data.Text.Array.html#loc_150_1_150_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Array.html#loc_150_1_150_12&#39;)"><span class="hl_varref"><span class="mpre">A.unsafeIndex</span></span></a><span class="mpre"> </span><a href="#loc_58_7_58_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_7_58_10&#39;)"><span class="hl_varref"><span class="mpre">arr</span></span></a><span class="mpre"> </span><a href="#loc_58_11_58_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_11_58_14&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre">
      </span><a name="loc_61_7_61_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_7_61_11&#39;)"><span class="hl_vardecl"><span class="mpre">alen</span></span></a><span class="mpre"> = </span><a href="Data.Text.Array.html#loc_102_5_102_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Array.html#loc_102_5_102_11&#39;)"><span class="hl_varref"><span class="mpre">A.length</span></span></a><span class="mpre"> </span><a href="#loc_58_7_58_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_7_58_10&#39;)"><span class="hl_varref"><span class="mpre">arr</span></span></a><span class="mpre">
  in </span><span class="hl_varref"><span class="mpre">assert</span></span><span class="mpre"> (</span><a href="#loc_58_15_58_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_15_58_18&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre">
     </span><span class="hl_varref"><span class="mpre">assert</span></span><span class="mpre"> (</span><a href="#loc_58_11_58_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_11_58_14&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre">
     </span><span class="hl_varref"><span class="mpre">assert</span></span><span class="mpre"> (</span><a href="#loc_61_7_61_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_7_61_11&#39;)"><span class="hl_varref"><span class="mpre">alen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><a href="#loc_58_15_58_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_15_58_18&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><a href="#loc_58_11_58_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_11_58_14&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_61_7_61_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_7_61_11&#39;)"><span class="hl_varref"><span class="mpre">alen</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre">
     </span><span class="hl_varref"><span class="mpre">assert</span></span><span class="mpre"> (</span><a href="#loc_58_15_58_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_15_58_18&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><a href="#loc_60_7_60_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_7_60_8&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xDC00</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><a href="#loc_60_7_60_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_7_60_8&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xDFFF</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
#endif
     </span><a href="#loc_50_13_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_13_50_17&#39;)"><span class="hl_conref"><span class="mpre">Text</span></span></a><span class="mpre"> </span><a href="#loc_58_7_58_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_7_58_10&#39;)"><span class="hl_varref"><span class="mpre">arr</span></span></a><span class="mpre"> </span><a href="#loc_58_11_58_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_11_58_14&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre"> </span><a href="#loc_58_15_58_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_15_58_18&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_58_1_58_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_6&#39;)"><span class="mpre">text_</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(1)/ The empty &#39;Text&#39;.</span></span><span class="mpre">
</span><a href="#loc_72_1_72_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_1_72_6&#39;)"><span class="mpre">empty</span></a><span class="mpre"> :: </span><a href="#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre">
</span><a name="loc_72_1_72_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_1_72_6&#39;)"><span class="hl_vardecl"><span class="mpre">empty</span></span></a><span class="mpre"> = </span><a href="#loc_50_13_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_13_50_17&#39;)"><span class="hl_conref"><span class="mpre">Text</span></span></a><span class="mpre"> </span><a href="Data.Text.Array.html#loc_172_1_172_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Array.html#loc_172_1_172_6&#39;)"><span class="hl_varref"><span class="mpre">A.empty</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE [1] </span><a href="#loc_72_1_72_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_1_72_6&#39;)"><span class="mpre">empty</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Construct a &#39;Text&#39; without invisibly pinning its byte array in</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- memory if its length has dwindled to zero.</span></span><span class="mpre">
</span><a href="#loc_78_1_78_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_5&#39;)"><span class="mpre">text</span></a><span class="mpre"> :: </span><a href="Data.Text.Array.html#loc_83_6_83_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Array.html#loc_83_6_83_11&#39;)"><span class="hl_tyconref"><span class="mpre">A.Array</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre">
</span><a name="loc_78_1_78_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_5&#39;)"><span class="hl_fundecl"><span class="mpre">text</span></span></a><span class="mpre"> </span><a name="loc_78_6_78_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_6_78_9&#39;)"><span class="hl_vardecl"><span class="mpre">arr</span></span></a><span class="mpre"> </span><a name="loc_78_10_78_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_10_78_13&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_78_14_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_14_78_17&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> | </span><a href="#loc_78_14_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_14_78_17&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">  = </span><a href="#loc_72_1_72_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_1_72_6&#39;)"><span class="hl_varref"><span class="mpre">empty</span></span></a><span class="mpre">
                 | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="#loc_58_1_58_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_6&#39;)"><span class="hl_varref"><span class="mpre">text_</span></span></a><span class="mpre"> </span><a href="#loc_78_6_78_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_6_78_9&#39;)"><span class="hl_varref"><span class="mpre">arr</span></span></a><span class="mpre"> </span><a href="#loc_78_10_78_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_10_78_13&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre"> </span><a href="#loc_78_14_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_14_78_17&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_78_1_78_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_5&#39;)"><span class="mpre">text</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_84_1_84_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_6&#39;)"><span class="mpre">textP</span></a><span class="mpre"> :: </span><a href="Data.Text.Array.html#loc_83_6_83_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Array.html#loc_83_6_83_11&#39;)"><span class="hl_tyconref"><span class="mpre">A.Array</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre">
</span><span class="warning" data-warning="DeclDeprPragmaDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal.hs&quot;, srcSpanStartLine = 83, srcSpanStartColumn = 1, srcSpanEndLine = 83, srcSpanEndColumn = 44}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal.hs&quot;, srcSpanStartLine = 83, srcSpanStartColumn = 1, srcSpanEndLine = 83, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/Data/Text/Internal.hs&quot;, srcSpanStartLi"><span class="mpre">{-# DEPRECATED textP &quot;Use text instead&quot; #-}</span></span><span class="mpre">
</span><a name="loc_84_1_84_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_6&#39;)"><span class="hl_vardecl"><span class="mpre">textP</span></span></a><span class="mpre"> = </span><a href="#loc_78_1_78_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_5&#39;)"><span class="hl_varref"><span class="mpre">text</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A useful &#39;show&#39;-like function for debugging purposes.</span></span><span class="mpre">
</span><a href="#loc_88_1_88_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_9&#39;)"><span class="mpre">showText</span></a><span class="mpre"> :: </span><a href="#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_88_1_88_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_9&#39;)"><span class="hl_fundecl"><span class="mpre">showText</span></span></a><span class="mpre"> (</span><a href="#loc_50_13_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_13_50_17&#39;)"><span class="hl_conref"><span class="mpre">Text</span></span></a><span class="mpre"> </span><a name="loc_88_16_88_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_16_88_19&#39;)"><span class="hl_vardecl"><span class="mpre">arr</span></span></a><span class="mpre"> </span><a name="loc_88_20_88_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_20_88_23&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_88_24_88_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_24_88_27&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">) =
    </span><span class="hl_string"><span class="mpre">&quot;Text &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><a href="Data.Text.Array.html#loc_166_1_166_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Array.html#loc_166_1_166_7&#39;)"><span class="hl_varref"><span class="mpre">A.toList</span></span></a><span class="mpre"> </span><a href="#loc_88_16_88_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_16_88_19&#39;)"><span class="hl_varref"><span class="mpre">arr</span></span></a><span class="mpre"> </span><a href="#loc_88_20_88_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_20_88_23&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre"> </span><a href="#loc_88_24_88_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_24_88_27&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39; &#39;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_88_20_88_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_20_88_23&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39; &#39;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_88_24_88_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_24_88_27&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Map a &#39;Char&#39; to a &#39;Text&#39;-safe value.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- UTF-16 surrogate code points are not included in the set of Unicode</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- scalar values, but are unfortunately admitted as valid &#39;Char&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- values by Haskell.  They cannot be represented in a &#39;Text&#39;.  This</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- function remaps those code points to the Unicode replacement</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- character (U+FFFD, \&#39;&amp;#xfffd;\&#39;), and leaves other code points</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- unchanged.</span></span><span class="mpre">
</span><a href="#loc_101_1_101_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_5&#39;)"><span class="mpre">safe</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">
</span><a name="loc_101_1_101_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_5&#39;)"><span class="hl_fundecl"><span class="mpre">safe</span></span></a><span class="mpre"> </span><a name="loc_101_6_101_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_6_101_7&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre">
    | </span><a href="Data.Text.Internal.Unsafe.Char.html#loc_40_1_40_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Unsafe.Char.html#loc_40_1_40_4&#39;)"><span class="hl_varref"><span class="mpre">ord</span></span></a><span class="mpre"> </span><a href="#loc_101_6_101_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_6_101_7&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x1ff800</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xd800</span></span><span class="mpre"> = </span><a href="#loc_101_6_101_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_6_101_7&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">                    = </span><span class="hl_char"><span class="mpre">&#39;\xfffd&#39;</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_101_1_101_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_5&#39;)"><span class="mpre">safe</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Apply a function to the first element of an optional pair.</span></span><span class="mpre">
</span><a href="#loc_108_1_108_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_7&#39;)"><span class="mpre">firstf</span></a><span class="mpre"> :: (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">,</span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">,</span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)
</span><a name="loc_108_1_108_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_7&#39;)"><span class="hl_fundecl"><span class="mpre">firstf</span></span></a><span class="mpre"> </span><a name="loc_108_8_108_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_8_108_9&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a name="loc_108_17_108_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_17_108_18&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">, </span><a name="loc_108_20_108_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_20_108_21&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">)) = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a href="#loc_108_8_108_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_8_108_9&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_108_17_108_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_17_108_18&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">, </span><a href="#loc_108_20_108_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_20_108_21&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">)
</span><a href="#loc_108_1_108_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_7&#39;)"><span class="hl_fundecl"><span class="mpre">firstf</span></span></a><span class="mpre"> _  </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">      = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- $internals</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Internally, the &#39;Text&#39; type is represented as an array of &#39;Word16&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- UTF-16 code units. The offset and length fields in the constructor</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- are in these units, /not/ units of &#39;Char&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Invariants that all functions must maintain:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Since the &#39;Text&#39; type uses UTF-16 internally, it cannot represent</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   characters in the reserved surrogate code point range U+D800 to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   U+DFFF. To maintain this invariant, the &#39;safe&#39; function maps</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   &#39;Char&#39; values in this range to the replacement character (U+FFFD,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   \&#39;&amp;#xfffd;\&#39;).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * A leading (or \&quot;high\&quot;) surrogate code unit (0xD800–0xDBFF) must</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   always be followed by a trailing (or \&quot;low\&quot;) surrogate code unit</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   (0xDC00-0xDFFF). A trailing surrogate code unit must always be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   preceded by a leading surrogate code unit.</span></span><span class="mpre">
</span></div></body></html>