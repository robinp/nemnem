<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE RankNTypes #-}
</span><span class="hl_comment"><span class="mpre">---------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module        : Network.Wai.Middleware.Jsonp</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright     : Michael Snoyman</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License       : BSD3</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer    : Michael Snoyman &lt;michael@snoyman.com&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability     : Unstable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability   : portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Automatic wrapping of JSON responses to convert into JSONP.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">---------------------------------------------------------</span></span><span class="mpre">
module Network.Wai.Middleware.Jsonp (jsonp) where

import Network.Wai
import Network.Wai.Internal
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/Jsonp.hs&quot;, srcSpanStartLine = 20, srcSpanStartColumn = 8, srcSpanEndLine = 20, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/Jsonp.hs&quot;, srcSpanStartLine = 21, srcSpanStartColumn = 18, srcSpanEndLine = 21, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as B8
import Blaze.ByteString.Builder (</span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="mpre">Builder</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.ByteString.html#loc_127_1_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_127_1_127_15&#39;)"><span class="mpre">copyByteString</span></a><span class="mpre">)
import Blaze.ByteString.Builder.Char8 (</span><a href="Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9&#39;)"><span class="mpre">fromChar</span></a><span class="mpre">)
import Data.Monoid (</span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="mpre">mappend</span></a><span class="mpre">)
import Control.Monad (</span><a href="Control.Monad.html#loc_204_1_204_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_204_1_204_5&#39;)"><span class="mpre">join</span></a><span class="mpre">)
import Data.Maybe (</span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="mpre">fromMaybe</span></a><span class="mpre">)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/Jsonp.hs&quot;, srcSpanStartLine = 27, srcSpanStartColumn = 18, srcSpanEndLine = 27, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as S
import Data.CaseInsensitive (</span><a href="Data.CaseInsensitive.Internal.html#loc_86_6_86_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.CaseInsensitive.Internal.html#loc_86_6_86_8&#39;)"><span class="mpre">CI</span></a><span class="mpre">)
import Network.HTTP.Types (</span><a href="Network.HTTP.Types.Status.html#loc_114_6_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_114_6_114_12&#39;)"><span class="mpre">Status</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Wrap json responses in a jsonp callback.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Basically, if the user requested a \&quot;text\/javascript\&quot; and supplied a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- \&quot;callback\&quot; GET parameter, ask the application for an</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- \&quot;application/json\&quot; response, then convert that into a JSONP response,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- having a content type of \&quot;text\/javascript\&quot; and calling the specified</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- callback function.</span></span><span class="mpre">
</span><a href="#loc_39_1_39_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_6&#39;)"><span class="mpre">jsonp</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Middleware</span></span><span class="mpre">
</span><a name="loc_39_1_39_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_6&#39;)"><span class="hl_fundecl"><span class="mpre">jsonp</span></span></a><span class="mpre"> </span><a name="loc_39_7_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_7_39_10&#39;)"><span class="hl_vardecl"><span class="mpre">app</span></span></a><span class="mpre"> </span><a name="loc_39_11_39_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_11_39_14&#39;)"><span class="hl_vardecl"><span class="mpre">env</span></span></a><span class="mpre"> </span><a name="loc_39_15_39_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_27&#39;)"><span class="hl_vardecl"><span class="mpre">sendResponse</span></span></a><span class="mpre"> = do
    let </span><a name="loc_40_9_40_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_9_40_15&#39;)"><span class="hl_vardecl"><span class="mpre">accept</span></span></a><span class="mpre"> = </span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="hl_varref"><span class="mpre">fromMaybe</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B8.empty</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Accept&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Wai.Internal.html#loc_36_6_36_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_36_6_36_20&#39;)"><span class="hl_varref"><span class="mpre">requestHeaders</span></span></a><span class="mpre"> </span><a href="#loc_39_11_39_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_11_39_14&#39;)"><span class="hl_varref"><span class="mpre">env</span></span></a><span class="mpre">
    let </span><a href="#loc_42_9_42_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_9_42_17&#39;)"><span class="mpre">callback</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B8.ByteString</span></span><span class="mpre">
        </span><a name="loc_42_9_42_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_9_42_17&#39;)"><span class="hl_vardecl"><span class="mpre">callback</span></span></a><span class="mpre"> =
            if </span><span class="hl_varref"><span class="mpre">B8.pack</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;text/javascript&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`B8.isInfixOf`</span></span><span class="mpre"> </span><a href="#loc_40_9_40_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_9_40_15&#39;)"><span class="hl_varref"><span class="mpre">accept</span></span></a><span class="mpre">
                then </span><a href="Control.Monad.html#loc_204_1_204_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_204_1_204_5&#39;)"><span class="hl_varref"><span class="mpre">join</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;callback&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Wai.Internal.html#loc_52_6_52_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_52_6_52_17&#39;)"><span class="hl_varref"><span class="mpre">queryString</span></span></a><span class="mpre"> </span><a href="#loc_39_11_39_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_11_39_14&#39;)"><span class="hl_varref"><span class="mpre">env</span></span></a><span class="mpre">
                else </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
    let </span><a name="loc_46_9_46_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_13&#39;)"><span class="hl_vardecl"><span class="mpre">env&#39;</span></span></a><span class="mpre"> =
            case </span><a href="#loc_42_9_42_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_9_42_17&#39;)"><span class="hl_varref"><span class="mpre">callback</span></span></a><span class="mpre"> of
                </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><a href="#loc_39_11_39_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_11_39_14&#39;)"><span class="hl_varref"><span class="mpre">env</span></span></a><span class="mpre">
                </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> _ -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/Jsonp.hs&quot;, srcSpanStartLine = 49, srcSpanStartColumn = 27, srcSpanEndLine = 53, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/Jsonp.hs&quot;, srcSpanStartLine = 50, srcSpanStartColumn = 25, srcSpanEndLine = 50, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Networ"><span class="mpre">env
                        { requestHeaders = changeVal &quot;Accept&quot;
                                           &quot;application/json&quot;
                                           $ requestHeaders env
                        }</span></span><span class="mpre">
    </span><a href="#loc_39_7_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_7_39_10&#39;)"><span class="hl_varref"><span class="mpre">app</span></span></a><span class="mpre"> </span><a href="#loc_46_9_46_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_9_46_13&#39;)"><span class="hl_varref"><span class="mpre">env&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_54_17_54_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_17_54_20&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> -&gt;
        case </span><a href="#loc_42_9_42_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_9_42_17&#39;)"><span class="hl_varref"><span class="mpre">callback</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><a href="#loc_39_15_39_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_27&#39;)"><span class="hl_varref"><span class="mpre">sendResponse</span></span></a><span class="mpre"> </span><a href="#loc_54_17_54_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_17_54_20&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">
            </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_57_18_57_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_18_57_19&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_59_5_59_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_5_59_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_57_18_57_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_18_57_19&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><a href="#loc_54_17_54_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_17_54_20&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">
  where
    </span><a name="loc_59_5_59_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_5_59_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_59_8_59_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_8_59_9&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> </span><a name="loc_59_10_59_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_10_59_11&#39;)"><span class="hl_specname"><span class="mpre">r</span></span></a><span class="mpre">@(</span><a href="Network.Wai.Internal.html#loc_76_7_76_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_76_7_76_22&#39;)"><span class="hl_conref"><span class="mpre">ResponseBuilder</span></span></a><span class="mpre"> </span><a name="loc_59_29_59_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_29_59_30&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_59_31_59_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_31_59_33&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> </span><a name="loc_59_34_59_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_34_59_35&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">) =
        </span><a href="#loc_39_15_39_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_27&#39;)"><span class="hl_varref"><span class="mpre">sendResponse</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> case </span><a href="#loc_74_5_74_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_5_74_14&#39;)"><span class="hl_varref"><span class="mpre">checkJSON</span></span></a><span class="mpre"> </span><a href="#loc_59_31_59_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_31_59_33&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><a href="#loc_59_10_59_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_10_59_11&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
            </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_62_18_62_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_18_62_21&#39;)"><span class="hl_vardecl"><span class="mpre">hs&#39;</span></span></a><span class="mpre"> -&gt; </span><a href="Network.Wai.html#loc_125_1_125_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_125_1_125_16&#39;)"><span class="hl_varref"><span class="mpre">responseBuilder</span></span></a><span class="mpre"> </span><a href="#loc_59_29_59_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_29_59_30&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_62_18_62_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_18_62_21&#39;)"><span class="hl_varref"><span class="mpre">hs&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
                </span><a href="Blaze.ByteString.Builder.ByteString.html#loc_127_1_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_127_1_127_15&#39;)"><span class="hl_varref"><span class="mpre">copyByteString</span></span></a><span class="mpre"> </span><a href="#loc_59_8_59_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_8_59_9&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">
                </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_infix"><span class="mpre">`mappend`</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9&#39;)"><span class="hl_varref"><span class="mpre">fromChar</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;(&#39;</span></span><span class="mpre">
                </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_infix"><span class="mpre">`mappend`</span></span></a><span class="mpre"> </span><a href="#loc_59_34_59_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_34_59_35&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
                </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_infix"><span class="mpre">`mappend`</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9&#39;)"><span class="hl_varref"><span class="mpre">fromChar</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;)&#39;</span></span><span class="mpre">
    </span><a href="#loc_59_5_59_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_5_59_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_67_8_67_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_8_67_9&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> </span><a name="loc_67_10_67_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_10_67_11&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> =
        case </span><a href="#loc_74_5_74_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_5_74_14&#39;)"><span class="hl_varref"><span class="mpre">checkJSON</span></span></a><span class="mpre"> </span><a href="#loc_72_13_72_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_13_72_15&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_69_18_69_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_18_69_21&#39;)"><span class="hl_vardecl"><span class="mpre">hs&#39;</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_82_5_82_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_5_82_16&#39;)"><span class="hl_varref"><span class="mpre">addCallback</span></span></a><span class="mpre"> </span><a href="#loc_67_8_67_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_8_67_9&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><a href="#loc_72_10_72_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_10_72_11&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_69_18_69_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_18_69_21&#39;)"><span class="hl_varref"><span class="mpre">hs&#39;</span></span></a><span class="mpre"> </span><a href="#loc_72_17_72_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_17_72_19&#39;)"><span class="hl_varref"><span class="mpre">wb</span></span></a><span class="mpre">
            </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><a href="#loc_39_15_39_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_27&#39;)"><span class="hl_varref"><span class="mpre">sendResponse</span></span></a><span class="mpre"> </span><a href="#loc_67_10_67_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_10_67_11&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
      where
        (</span><a name="loc_72_10_72_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_10_72_11&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">, </span><a name="loc_72_13_72_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_13_72_15&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre">, </span><a name="loc_72_17_72_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_17_72_19&#39;)"><span class="hl_vardecl"><span class="mpre">wb</span></span></a><span class="mpre">) = </span><a href="Network.Wai.html#loc_198_1_198_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_198_1_198_17&#39;)"><span class="hl_varref"><span class="mpre">responseToStream</span></span></a><span class="mpre"> </span><a href="#loc_67_10_67_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_10_67_11&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

    </span><a name="loc_74_5_74_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_5_74_14&#39;)"><span class="hl_fundecl"><span class="mpre">checkJSON</span></span></a><span class="mpre"> </span><a name="loc_74_15_74_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_15_74_17&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> =
        case </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Content-Type&quot;</span></span><span class="mpre"> </span><a href="#loc_74_15_74_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_15_74_17&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_76_18_76_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_18_76_19&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">
                | </span><span class="hl_varref"><span class="mpre">B8.pack</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;application/json&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`S.isPrefixOf`</span></span><span class="mpre"> </span><a href="#loc_76_18_76_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_18_76_19&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> -&gt;
                    </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_80_5_80_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_5_80_15&#39;)"><span class="hl_varref"><span class="mpre">fixHeaders</span></span></a><span class="mpre"> </span><a href="#loc_74_15_74_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_15_74_17&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">
            _ -&gt; </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
    </span><a name="loc_80_5_80_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_5_80_15&#39;)"><span class="hl_vardecl"><span class="mpre">fixHeaders</span></span></a><span class="mpre"> = </span><a href="#loc_93_1_93_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_10&#39;)"><span class="hl_varref"><span class="mpre">changeVal</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Content-Type&quot;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;text/javascript&quot;</span></span><span class="mpre">

    </span><a name="loc_82_5_82_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_5_82_16&#39;)"><span class="hl_fundecl"><span class="mpre">addCallback</span></span></a><span class="mpre"> </span><a name="loc_82_17_82_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_17_82_19&#39;)"><span class="hl_vardecl"><span class="mpre">cb</span></span></a><span class="mpre"> </span><a name="loc_82_20_82_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_20_82_21&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_82_22_82_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_22_82_24&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> </span><a name="loc_82_25_82_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_25_82_27&#39;)"><span class="hl_vardecl"><span class="mpre">wb</span></span></a><span class="mpre"> =
        </span><a href="#loc_82_25_82_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_25_82_27&#39;)"><span class="hl_varref"><span class="mpre">wb</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_83_15_83_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_15_83_19&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_39_15_39_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_27&#39;)"><span class="hl_varref"><span class="mpre">sendResponse</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Wai.html#loc_158_1_158_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_158_1_158_15&#39;)"><span class="hl_varref"><span class="mpre">responseStream</span></span></a><span class="mpre"> </span><a href="#loc_82_20_82_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_20_82_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_82_22_82_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_22_82_24&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_83_61_83_70" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_61_83_70&#39;)"><span class="hl_vardecl"><span class="mpre">sendChunk</span></span></a><span class="mpre"> </span><a name="loc_83_71_83_76" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_71_83_76&#39;)"><span class="hl_vardecl"><span class="mpre">flush</span></span></a><span class="mpre"> -&gt; do
            </span><a href="#loc_83_61_83_70" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_61_83_70&#39;)"><span class="hl_varref"><span class="mpre">sendChunk</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.ByteString.html#loc_127_1_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_127_1_127_15&#39;)"><span class="hl_varref"><span class="mpre">copyByteString</span></span></a><span class="mpre"> </span><a href="#loc_82_17_82_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_17_82_19&#39;)"><span class="hl_varref"><span class="mpre">cb</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_infix"><span class="mpre">`mappend`</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9&#39;)"><span class="hl_varref"><span class="mpre">fromChar</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;(&#39;</span></span><span class="mpre">
            </span><a href="#loc_83_15_83_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_15_83_19&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre"> </span><a href="#loc_83_61_83_70" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_61_83_70&#39;)"><span class="hl_varref"><span class="mpre">sendChunk</span></span></a><span class="mpre"> </span><a href="#loc_83_71_83_76" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_71_83_76&#39;)"><span class="hl_varref"><span class="mpre">flush</span></span></a><span class="mpre">
            </span><a href="#loc_83_61_83_70" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_61_83_70&#39;)"><span class="hl_varref"><span class="mpre">sendChunk</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9&#39;)"><span class="hl_varref"><span class="mpre">fromChar</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;)&#39;</span></span><span class="mpre">

</span><a href="#loc_93_1_93_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_10&#39;)"><span class="mpre">changeVal</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/Jsonp.hs&quot;, srcSpanStartLine = 88, srcSpanStartColumn = 14, srcSpanEndLine = 89, srcSpanEndColumn = 13}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/Jsonp.hs&quot;, srcSpanStartLine = 89, srcSpanStartColumn = 11, srcSpanEndLine = 89, srcSpanEndColumn = 13}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagran"><span class="mpre">Eq a
          =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
          -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
          -&gt; [(</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)]
          -&gt; [(</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)]
</span><a name="loc_93_1_93_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_10&#39;)"><span class="hl_fundecl"><span class="mpre">changeVal</span></span></a><span class="mpre"> </span><a name="loc_93_11_93_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_11_93_14&#39;)"><span class="hl_vardecl"><span class="mpre">key</span></span></a><span class="mpre"> </span><a name="loc_93_15_93_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_15_93_18&#39;)"><span class="hl_vardecl"><span class="mpre">val</span></span></a><span class="mpre"> </span><a name="loc_93_19_93_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_19_93_22&#39;)"><span class="hl_vardecl"><span class="mpre">old</span></span></a><span class="mpre"> = (</span><a href="#loc_93_11_93_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_11_93_14&#39;)"><span class="hl_varref"><span class="mpre">key</span></span></a><span class="mpre">, </span><a href="#loc_93_15_93_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_15_93_18&#39;)"><span class="hl_varref"><span class="mpre">val</span></span></a><span class="mpre">)
                      </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">filter</span></span><span class="mpre"> (\(</span><a name="loc_94_35_94_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_35_94_36&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre">, _) -&gt; </span><a href="#loc_94_35_94_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_35_94_36&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="#loc_93_11_93_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_11_93_14&#39;)"><span class="hl_varref"><span class="mpre">key</span></span></a><span class="mpre">) </span><a href="#loc_93_19_93_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_19_93_22&#39;)"><span class="hl_varref"><span class="mpre">old</span></span></a><span class="mpre">
</span></div></body></html>