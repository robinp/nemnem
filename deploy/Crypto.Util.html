<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |A small selection of utilities that might be of use to others working with bytestring/number combinations.</span></span><span class="mpre">
module Crypto.Util where

import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Util.hs&quot;, srcSpanStartLine = 4, srcSpanStartColumn = 18, srcSpanEndLine = 4, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Util.hs&quot;, srcSpanStartLine = 5, srcSpanStartColumn = 18, srcSpanEndLine = 5, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L
import Data.ByteString.Unsafe (</span><a href="Data.ByteString.Unsafe.html#loc_135_1_135_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Unsafe.html#loc_135_1_135_12&#39;)"><span class="mpre">unsafeIndex</span></a><span class="mpre">, </span><a href="Data.ByteString.Unsafe.html#loc_311_1_311_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Unsafe.html#loc_311_1_311_22&#39;)"><span class="mpre">unsafeUseAsCStringLen</span></a><span class="mpre">)
import Data.Bits (</span><a href="Data.Bits.html#loc_200_5_200_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_200_5_200_11&#39;)"><span class="mpre">shiftL</span></a><span class="mpre">, </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="mpre">shiftR</span></a><span class="mpre">)
import Data.Bits (</span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="mpre">xor</span></a><span class="mpre">, </span><a href="Data.Bits.html#loc_158_5_158_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_158_5_158_11&#39;)"><span class="mpre">setBit</span></a><span class="mpre">, </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="mpre">shiftR</span></a><span class="mpre">, </span><a href="Data.Bits.html#loc_200_5_200_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_200_5_200_11&#39;)"><span class="mpre">shiftL</span></a><span class="mpre">)
import Control.Exception (Exception, throw)
import Data.Tagged
import System.IO.Unsafe
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Util.hs&quot;, srcSpanStartLine = 12, srcSpanStartColumn = 8, srcSpanEndLine = 12, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Foreign.C.Types&quot;"><span class="mpre">Foreign.C.Types</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Util.hs&quot;, srcSpanStartLine = 13, srcSpanStartColumn = 8, srcSpanEndLine = 13, srcSpanEndColumn = 19}, srcInfoPoints = []}) &quot;Foreign.Ptr&quot;"><span class="mpre">Foreign.Ptr</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |@incBS bs@ inefficiently computes the value @i2bs (8 * B.length bs) (bs2i bs + 1)@</span></span><span class="mpre">
</span><a href="#loc_17_1_17_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_1_17_6&#39;)"><span class="mpre">incBS</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_17_1_17_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_1_17_6&#39;)"><span class="hl_fundecl"><span class="mpre">incBS</span></span></a><span class="mpre"> </span><a name="loc_17_7_17_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_7_17_9&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> (</span><a href="#loc_19_3_19_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_3_19_5&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_17_7_17_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_7_17_9&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_17_7_17_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_7_17_9&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">))
  where
  </span><a name="loc_19_3_19_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_3_19_5&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_19_6_19_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_6_19_8&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a name="loc_19_9_19_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_9_19_10&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">
        | </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_19_6_19_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_6_19_8&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">     = []
        | </span><a href="Data.ByteString.Unsafe.html#loc_135_1_135_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Unsafe.html#loc_135_1_135_12&#39;)"><span class="hl_varref"><span class="mpre">unsafeIndex</span></span></a><span class="mpre"> </span><a href="#loc_19_6_19_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_6_19_8&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a href="#loc_19_9_19_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_9_19_10&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xFF</span></span><span class="mpre"> = (</span><a href="#loc_19_3_19_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_3_19_5&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.init</span></span><span class="mpre"> </span><a href="#loc_19_6_19_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_6_19_8&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">) (</span><a href="#loc_19_9_19_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_9_19_10&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> [</span><span class="hl_varref"><span class="mpre">B.singleton</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">]
        | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">            = [</span><span class="hl_varref"><span class="mpre">B.init</span></span><span class="mpre"> </span><a href="#loc_19_6_19_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_6_19_8&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">] </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> [</span><span class="hl_varref"><span class="mpre">B.singleton</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> (</span><a href="Data.ByteString.Unsafe.html#loc_135_1_135_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Unsafe.html#loc_135_1_135_12&#39;)"><span class="hl_varref"><span class="mpre">unsafeIndex</span></span></a><span class="mpre"> </span><a href="#loc_19_6_19_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_6_19_8&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a href="#loc_19_9_19_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_9_19_10&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">]
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_17_1_17_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_1_17_6&#39;)"><span class="mpre">incBS</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- |@i2bs bitLen i@ converts @i@ to a &#39;ByteString&#39; of @bitLen@ bits (must be a multiple of 8).</span></span><span class="mpre">
</span><a href="#loc_28_1_28_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_1_28_5&#39;)"><span class="mpre">i2bs</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_28_1_28_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_1_28_5&#39;)"><span class="hl_fundecl"><span class="mpre">i2bs</span></span></a><span class="mpre"> </span><a name="loc_28_6_28_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_6_28_7&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> </span><a name="loc_28_8_28_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_8_28_9&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.unfoldr</span></span><span class="mpre"> (\</span><a name="loc_28_24_28_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_24_28_26&#39;)"><span class="hl_vardecl"><span class="mpre">l&#39;</span></span></a><span class="mpre"> -&gt; if </span><a href="#loc_28_24_28_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_24_28_26&#39;)"><span class="hl_varref"><span class="mpre">l&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> then </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> else </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_28_8_28_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_8_28_9&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><a href="#loc_28_24_28_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_24_28_26&#39;)"><span class="hl_varref"><span class="mpre">l&#39;</span></span></a><span class="mpre">), </span><a href="#loc_28_24_28_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_24_28_26&#39;)"><span class="hl_varref"><span class="mpre">l&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">)) (</span><a href="#loc_28_6_28_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_6_28_7&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_28_1_28_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_1_28_5&#39;)"><span class="mpre">i2bs</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |@i2bs_unsized i@ converts @i@ to a &#39;ByteString&#39; of sufficient bytes to express the integer.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The integer must be non-negative and a zero will be encoded in one byte.</span></span><span class="mpre">
</span><a href="#loc_34_1_34_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_13&#39;)"><span class="mpre">i2bs_unsized</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_34_1_34_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_13&#39;)"><span class="hl_fundecl"><span class="mpre">i2bs_unsized</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.singleton</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
</span><a href="#loc_34_1_34_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_13&#39;)"><span class="hl_fundecl"><span class="mpre">i2bs_unsized</span></span></a><span class="mpre"> </span><a name="loc_35_14_35_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_14_35_15&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.reverse</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.unfoldr</span></span><span class="mpre"> (\</span><a name="loc_35_42_35_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_42_35_44&#39;)"><span class="hl_vardecl"><span class="mpre">i&#39;</span></span></a><span class="mpre"> -&gt; if </span><a href="#loc_35_42_35_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_42_35_44&#39;)"><span class="hl_varref"><span class="mpre">i&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> then </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> else </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_35_42_35_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_42_35_44&#39;)"><span class="hl_varref"><span class="mpre">i&#39;</span></span></a><span class="mpre">, (</span><a href="#loc_35_42_35_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_42_35_44&#39;)"><span class="hl_varref"><span class="mpre">i&#39;</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">))) </span><a href="#loc_35_14_35_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_14_35_15&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_34_1_34_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_13&#39;)"><span class="mpre">i2bs_unsized</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Useful utility to extract the result of a generator operation</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- and translate error results to exceptions.</span></span><span class="mpre">
</span><a href="#loc_41_1_41_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_10&#39;)"><span class="mpre">throwLeft</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Util.hs&quot;, srcSpanStartLine = 40, srcSpanStartColumn = 14, srcSpanEndLine = 40, srcSpanEndColumn = 28}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Util.hs&quot;, srcSpanStartLine = 40, srcSpanStartColumn = 26, srcSpanEndLine = 40, srcSpanEndColumn = 28}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/U"><span class="mpre">Exception e =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_41_1_41_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_10&#39;)"><span class="hl_fundecl"><span class="mpre">throwLeft</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_41_17_41_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_17_41_18&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre">)  = </span><span class="hl_varref"><span class="mpre">throw</span></span><span class="mpre"> </span><a href="#loc_41_17_41_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_17_41_18&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
</span><a href="#loc_41_1_41_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_10&#39;)"><span class="hl_fundecl"><span class="mpre">throwLeft</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a name="loc_42_18_42_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_18_42_19&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">) = </span><a href="#loc_42_18_42_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_18_42_19&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Obtain a tagged value for a particular instantiated type.</span></span><span class="mpre">
</span><a href="#loc_46_1_46_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_1_46_4&#39;)"><span class="mpre">for</span></a><span class="mpre"> :: </span><a href="Data.Tagged.html#loc_59_9_59_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Tagged.html#loc_59_9_59_15&#39;)"><span class="hl_tyconref"><span class="mpre">Tagged</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
</span><a name="loc_46_1_46_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_1_46_4&#39;)"><span class="hl_fundecl"><span class="mpre">for</span></span></a><span class="mpre"> </span><a name="loc_46_5_46_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_5_46_6&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> _ = </span><a href="Data.Tagged.html#loc_59_31_59_39" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Tagged.html#loc_59_31_59_39&#39;)"><span class="hl_varref"><span class="mpre">unTagged</span></span></a><span class="mpre"> </span><a href="#loc_46_5_46_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_5_46_6&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Infix `for` operator</span></span><span class="mpre">
</span><a href="#loc_50_1_50_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_7&#39;)"><span class="mpre">(.::.)</span></a><span class="mpre"> :: </span><a href="Data.Tagged.html#loc_59_9_59_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Tagged.html#loc_59_9_59_15&#39;)"><span class="hl_tyconref"><span class="mpre">Tagged</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
</span><a name="loc_50_1_50_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_7&#39;)"><span class="hl_vardecl"><span class="mpre">(.::.)</span></span></a><span class="mpre"> = </span><a href="#loc_46_1_46_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_1_46_4&#39;)"><span class="hl_varref"><span class="mpre">for</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Checks two bytestrings for equality without breaches for</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- timing attacks.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Semantically, @constTimeEq = (==)@.  However, @x == y@ takes less</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- time when the first byte is different than when the first byte</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is equal.  This side channel allows an attacker to mount a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- timing attack.  On the other hand, @constTimeEq@ always takes the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- same time regardless of the bytestrings&#39; contents, unless they are</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- of difference size.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- You should always use @constTimeEq@ when comparing secrets,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- otherwise you may leave a significant security hole</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (cf. &lt;http://codahale.com/a-lesson-in-timing-attacks/&gt;).</span></span><span class="mpre">
</span><a href="#loc_66_1_66_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_12&#39;)"><span class="mpre">constTimeEq</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_66_1_66_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_12&#39;)"><span class="hl_fundecl"><span class="mpre">constTimeEq</span></span></a><span class="mpre"> </span><a name="loc_66_13_66_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_13_66_15&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre"> </span><a name="loc_66_16_66_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_16_66_18&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre"> =
    </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
    </span><a href="Data.ByteString.Unsafe.html#loc_311_1_311_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Unsafe.html#loc_311_1_311_22&#39;)"><span class="hl_varref"><span class="mpre">unsafeUseAsCStringLen</span></span></a><span class="mpre"> </span><a href="#loc_66_13_66_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_13_66_15&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_68_34_68_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_34_68_40&#39;)"><span class="hl_vardecl"><span class="mpre">s1_ptr</span></span></a><span class="mpre">, </span><a name="loc_68_42_68_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_42_68_48&#39;)"><span class="hl_vardecl"><span class="mpre">s1_len</span></span></a><span class="mpre">) -&gt;
    </span><a href="Data.ByteString.Unsafe.html#loc_311_1_311_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Unsafe.html#loc_311_1_311_22&#39;)"><span class="hl_varref"><span class="mpre">unsafeUseAsCStringLen</span></span></a><span class="mpre"> </span><a href="#loc_66_16_66_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_16_66_18&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_69_34_69_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_34_69_40&#39;)"><span class="hl_vardecl"><span class="mpre">s2_ptr</span></span></a><span class="mpre">, </span><a name="loc_69_42_69_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_42_69_48&#39;)"><span class="hl_vardecl"><span class="mpre">s2_len</span></span></a><span class="mpre">) -&gt;
    if </span><a href="#loc_68_42_68_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_42_68_48&#39;)"><span class="hl_varref"><span class="mpre">s1_len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="#loc_69_42_69_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_42_69_48&#39;)"><span class="hl_varref"><span class="mpre">s2_len</span></span></a><span class="mpre">
      then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
      else (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">c_constTimeEq</span></span><span class="mpre"> </span><a href="#loc_68_34_68_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_34_68_40&#39;)"><span class="hl_varref"><span class="mpre">s1_ptr</span></span></a><span class="mpre"> </span><a href="#loc_69_34_69_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_34_69_40&#39;)"><span class="hl_varref"><span class="mpre">s2_ptr</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_68_42_68_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_42_68_48&#39;)"><span class="hl_varref"><span class="mpre">s1_len</span></span></a><span class="mpre">)

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Util.hs&quot;, srcSpanStartLine = 74, srcSpanStartColumn = 1, srcSpanEndLine = 75, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Util.hs&quot;, srcSpanStartLine = 74, srcSpanStartColumn = 1, srcSpanEndLine = 74, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-api-0.13/Crypto/Util.hs&quot;, srcSpanStartLine = 74, srcSpanStart"><span class="mpre">foreign import ccall unsafe
   c_constTimeEq :: Ptr CChar -&gt; Ptr CChar -&gt; CInt -&gt; IO CInt</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Helper function to convert bytestrings to integers</span></span><span class="mpre">
</span><a href="#loc_79_1_79_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_5&#39;)"><span class="mpre">bs2i</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">
</span><a name="loc_79_1_79_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_5&#39;)"><span class="hl_fundecl"><span class="mpre">bs2i</span></span></a><span class="mpre"> </span><a name="loc_79_6_79_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_6_79_8&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.foldl&#39;</span></span><span class="mpre"> (\</span><a name="loc_79_22_79_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_22_79_23&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> </span><a name="loc_79_24_79_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_24_79_25&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_79_22_79_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_22_79_23&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_200_5_200_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_200_5_200_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftL`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_79_24_79_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_24_79_25&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_79_6_79_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_6_79_8&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_79_1_79_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_5&#39;)"><span class="mpre">bs2i</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |zipWith xor + Pack</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- As a result of rewrite rules, this should automatically be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- optimized (at compile time). to use the bytestring libraries</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;zipWith&#39;&#39; function.</span></span><span class="mpre">
</span><a href="#loc_87_1_87_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_1_87_5&#39;)"><span class="mpre">zwp&#39;</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_87_1_87_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_1_87_5&#39;)"><span class="hl_fundecl"><span class="mpre">zwp&#39;</span></span></a><span class="mpre"> </span><a name="loc_87_6_87_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_6_87_7&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.pack</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.zipWith</span></span><span class="mpre"> </span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="hl_varref"><span class="mpre">xor</span></span></a><span class="mpre"> </span><a href="#loc_87_6_87_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_6_87_7&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_87_1_87_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_1_87_5&#39;)"><span class="mpre">zwp&#39;</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |zipWith xor + Pack</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This is written intentionally to take advantage</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- of the bytestring libraries &#39;zipWith&#39;&#39; rewrite rule but at the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- extra cost of the resulting lazy bytestring being more fragmented</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- than either of the two inputs.</span></span><span class="mpre">
</span><a href="#loc_97_1_97_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_1_97_4&#39;)"><span class="mpre">zwp</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre">
</span><a name="loc_97_1_97_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_1_97_4&#39;)"><span class="hl_fundecl"><span class="mpre">zwp</span></span></a><span class="mpre">  </span><a name="loc_97_6_97_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_6_97_7&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> </span><a name="loc_97_8_97_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_8_97_9&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = 
        let </span><a name="loc_98_13_98_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_13_98_15&#39;)"><span class="hl_vardecl"><span class="mpre">as</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">L.toChunks</span></span><span class="mpre"> </span><a href="#loc_97_6_97_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_6_97_7&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
            </span><a name="loc_99_13_99_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_13_99_15&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">L.toChunks</span></span><span class="mpre"> </span><a href="#loc_97_8_97_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_8_97_9&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
        in </span><span class="hl_varref"><span class="mpre">L.fromChunks</span></span><span class="mpre"> (</span><a href="#loc_102_3_102_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_3_102_5&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_98_13_98_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_13_98_15&#39;)"><span class="hl_varref"><span class="mpre">as</span></span></a><span class="mpre"> </span><a href="#loc_99_13_99_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_13_99_15&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">)
  where
  </span><a name="loc_102_3_102_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_3_102_5&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> [] _ = []
  </span><a href="#loc_102_3_102_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_3_102_5&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> _ [] = []
  </span><a href="#loc_102_3_102_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_3_102_5&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> (</span><a name="loc_104_7_104_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_7_104_8&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_104_9_104_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_9_104_11&#39;)"><span class="hl_vardecl"><span class="mpre">as</span></span></a><span class="mpre">) (</span><a name="loc_104_14_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_14_104_15&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_104_16_104_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_16_104_18&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">) =
        let </span><a name="loc_105_13_105_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_13_105_14&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">min</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_104_7_104_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_7_104_8&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_104_14_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_14_104_15&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">)
            (</span><a name="loc_106_14_106_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_14_106_16&#39;)"><span class="hl_vardecl"><span class="mpre">a&#39;</span></span></a><span class="mpre">,</span><a name="loc_106_17_106_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_17_106_19&#39;)"><span class="hl_vardecl"><span class="mpre">ar</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">B.splitAt</span></span><span class="mpre"> </span><a href="#loc_105_13_105_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_13_105_14&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><a href="#loc_104_7_104_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_7_104_8&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
            (</span><a name="loc_107_14_107_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_14_107_16&#39;)"><span class="hl_vardecl"><span class="mpre">b&#39;</span></span></a><span class="mpre">,</span><a name="loc_107_17_107_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_17_107_19&#39;)"><span class="hl_vardecl"><span class="mpre">br</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">B.splitAt</span></span><span class="mpre"> </span><a href="#loc_105_13_105_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_13_105_14&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><a href="#loc_104_14_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_14_104_15&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
            </span><a name="loc_108_13_108_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_13_108_16&#39;)"><span class="hl_vardecl"><span class="mpre">as&#39;</span></span></a><span class="mpre"> = if </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_106_17_106_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_17_106_19&#39;)"><span class="hl_varref"><span class="mpre">ar</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> then </span><a href="#loc_104_9_104_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_9_104_11&#39;)"><span class="hl_varref"><span class="mpre">as</span></span></a><span class="mpre"> else </span><a href="#loc_106_17_106_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_17_106_19&#39;)"><span class="hl_varref"><span class="mpre">ar</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_104_9_104_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_9_104_11&#39;)"><span class="hl_varref"><span class="mpre">as</span></span></a><span class="mpre">
            </span><a name="loc_109_13_109_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_13_109_16&#39;)"><span class="hl_vardecl"><span class="mpre">bs&#39;</span></span></a><span class="mpre"> = if </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_107_17_107_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_17_107_19&#39;)"><span class="hl_varref"><span class="mpre">br</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> then </span><a href="#loc_104_16_104_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_16_104_18&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> else </span><a href="#loc_107_17_107_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_17_107_19&#39;)"><span class="hl_varref"><span class="mpre">br</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_104_16_104_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_16_104_18&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
        in (</span><a href="#loc_87_1_87_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_1_87_5&#39;)"><span class="hl_varref"><span class="mpre">zwp&#39;</span></span></a><span class="mpre"> </span><a href="#loc_106_14_106_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_14_106_16&#39;)"><span class="hl_varref"><span class="mpre">a&#39;</span></span></a><span class="mpre"> </span><a href="#loc_107_14_107_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_14_107_16&#39;)"><span class="hl_varref"><span class="mpre">b&#39;</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_102_3_102_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_3_102_5&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_108_13_108_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_13_108_16&#39;)"><span class="hl_varref"><span class="mpre">as&#39;</span></span></a><span class="mpre"> </span><a href="#loc_109_13_109_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_13_109_16&#39;)"><span class="hl_varref"><span class="mpre">bs&#39;</span></span></a><span class="mpre">
</span><span class="hl_comment"><span class="mpre">{-# INLINEABLE zwp #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- gather a specified number of bytes from the list of bytestrings</span></span><span class="mpre">
</span><a href="#loc_115_1_115_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_1_115_8&#39;)"><span class="mpre">collect</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">] -&gt; [</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">]
</span><a name="loc_115_1_115_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_1_115_8&#39;)"><span class="hl_fundecl"><span class="mpre">collect</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> _ = []
</span><a href="#loc_115_1_115_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_1_115_8&#39;)"><span class="hl_fundecl"><span class="mpre">collect</span></span></a><span class="mpre"> _ [] = []
</span><a href="#loc_115_1_115_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_1_115_8&#39;)"><span class="hl_fundecl"><span class="mpre">collect</span></span></a><span class="mpre"> </span><a name="loc_117_9_117_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_9_117_10&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> (</span><a name="loc_117_12_117_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_12_117_13&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_117_14_117_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_14_117_16&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">)
        | </span><a href="#loc_121_3_121_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_3_121_6&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_117_9_117_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_9_117_10&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">  = </span><a href="#loc_117_12_117_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_12_117_13&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_115_1_115_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_1_115_8&#39;)"><span class="hl_varref"><span class="mpre">collect</span></span></a><span class="mpre"> (</span><a href="#loc_117_9_117_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_9_117_10&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_121_3_121_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_3_121_6&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">) </span><a href="#loc_117_14_117_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_14_117_16&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
        | </span><a href="#loc_121_3_121_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_3_121_6&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="#loc_117_9_117_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_9_117_10&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> = [</span><span class="hl_varref"><span class="mpre">B.take</span></span><span class="mpre"> </span><a href="#loc_117_9_117_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_9_117_10&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="#loc_117_12_117_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_12_117_13&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">]
  where
  </span><a name="loc_121_3_121_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_3_121_6&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_117_12_117_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_12_117_13&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_115_1_115_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_1_115_8&#39;)"><span class="mpre">collect</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span></div></body></html>