<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE TupleSections #-}
{-# LANGUAGE RankNTypes #-}
{-# LANGUAGE CPP #-}

module Network.Wai.Handler.Warp.Response (
    sendResponse
  , fileRange </span><span class="hl_comment"><span class="mpre">-- for testing</span></span><span class="mpre">
  , warpVersion
  , defaultServerValue
  ) where

import Blaze.ByteString.Builder (</span><a href="Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15&#39;)"><span class="mpre">fromByteString</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="mpre">Builder</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Internal.html#loc_139_1_139_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_139_1_139_6&#39;)"><span class="mpre">flush</span></a><span class="mpre">)
import Blaze.ByteString.Builder.HTTP (</span><a href="Blaze.ByteString.Builder.HTTP.html#loc_132_1_132_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.HTTP.html#loc_132_1_132_24&#39;)"><span class="mpre">chunkedTransferEncoding</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.HTTP.html#loc_222_1_222_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.HTTP.html#loc_222_1_222_26&#39;)"><span class="mpre">chunkedTransferTerminator</span></a><span class="mpre">)
import Control.Applicative
import Control.Exception
import Data.Array ((!))
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 19, srcSpanStartColumn = 8, srcSpanEndLine = 19, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import Data.Streaming.Blaze (</span><a href="Data.Streaming.Blaze.html#loc_64_1_64_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Streaming.Blaze.html#loc_64_1_64_13&#39;)"><span class="mpre">newBlazeRecv</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_175_1_175_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_175_1_175_20&#39;)"><span class="mpre">reuseBufferStrategy</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_92_1_92_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_92_1_92_12&#39;)"><span class="mpre">allocBuffer</span></a><span class="mpre">)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 21, srcSpanStartColumn = 18, srcSpanEndLine = 21, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as S
import Control.Monad (</span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="mpre">unless</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 23, srcSpanStartColumn = 18, srcSpanEndLine = 23, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as B (pack)
import qualified Data.CaseInsensitive as CI
import Data.Function (</span><a href="Data.Function.html#loc_87_7_87_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Function.html#loc_87_7_87_11&#39;)"><span class="mpre">on</span></a><span class="mpre">)
import Data.List (</span><a href="Data.List.html#loc_365_1_365_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_365_1_365_9&#39;)"><span class="mpre">deleteBy</span></a><span class="mpre">)
import Data.Maybe (</span><a href="Data.Maybe.html#loc_80_1_80_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_80_1_80_7&#39;)"><span class="mpre">isJust</span></a><span class="mpre">, </span><a href="Data.Maybe.html#loc_109_1_109_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_109_1_109_12&#39;)"><span class="mpre">listToMaybe</span></a><span class="mpre">)
#if MIN_VERSION_base(4,5,0)
import Data.Monoid (</span><a href="Data.Monoid.html#loc_99_1_99_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_99_1_99_5&#39;)"><span class="mpre">(&lt;&gt;)</span></a><span class="mpre">)
#else
import Data.Monoid (</span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="mpre">mappend</span></a><span class="mpre">)
#endif
import Data.Version (</span><a href="Data.Version.html#loc_106_1_106_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Version.html#loc_106_1_106_12&#39;)"><span class="mpre">showVersion</span></a><span class="mpre">)
import qualified Network.HTTP.Types as H
import Network.Wai
import qualified Network.Wai.Handler.Warp.Date as D
import Network.Wai.Handler.Warp.Buffer (</span><a href="Network.Wai.Handler.Warp.Buffer.html#loc_23_1_23_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Buffer.html#loc_23_1_23_14&#39;)"><span class="mpre">toBlazeBuffer</span></a><span class="mpre">)
import Network.Wai.Handler.Warp.Header
import Network.Wai.Handler.Warp.IO (</span><a href="Network.Wai.Handler.Warp.IO.html#loc_12_1_12_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.IO.html#loc_12_1_12_12&#39;)"><span class="mpre">toBufIOWith</span></a><span class="mpre">)
import Network.Wai.Handler.Warp.ResponseHeader
import Network.Wai.Handler.Warp.RequestHeader (</span><a href="Network.Wai.Handler.Warp.RequestHeader.html#loc_136_1_136_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.RequestHeader.html#loc_136_1_136_16&#39;)"><span class="mpre">parseByteRanges</span></a><span class="mpre">)
import qualified Network.Wai.Handler.Warp.Timeout as T
import Network.Wai.Handler.Warp.Types
import Network.Wai.Internal
import Numeric (</span><a href="Numeric.html#loc_130_1_130_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Numeric.html#loc_130_1_130_8&#39;)"><span class="mpre">showInt</span></a><span class="mpre">)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 46, srcSpanStartColumn = 18, srcSpanEndLine = 46, srcSpanEndColumn = 28}, srcInfoPoints = []}) &quot;Paths_warp&quot;"><span class="mpre">Paths_warp</span></span><span class="mpre">
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 47, srcSpanStartColumn = 18, srcSpanEndLine = 47, srcSpanEndColumn = 42}, srcInfoPoints = []}) &quot;System.PosixCompat.Files&quot;"><span class="mpre">System.PosixCompat.Files</span></span><span class="mpre"> as P

#if !MIN_VERSION_base(4,5,0)
</span><a href="#loc_51_1_51_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_5&#39;)"><span class="mpre">(&lt;&gt;)</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 50, srcSpanStartColumn = 9, srcSpanEndLine = 50, srcSpanEndColumn = 20}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 50, srcSpanStartColumn = 18, srcSpanEndLine = 50, srcSpanEndColumn = 20}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant"><span class="mpre">Monoid m =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre">
</span><a name="loc_51_1_51_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_5&#39;)"><span class="hl_vardecl"><span class="mpre">(&lt;&gt;)</span></span></a><span class="mpre"> = </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_varref"><span class="mpre">mappend</span></span></a><span class="mpre">
#endif

</span><span class="hl_comment"><span class="mpre">-- $setup</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; :set -XOverloadedStrings</span></span><span class="mpre">

</span><a href="#loc_58_1_58_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_9&#39;)"><span class="mpre">mapRight</span></a><span class="mpre"> :: (</span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">
</span><a name="loc_58_1_58_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_9&#39;)"><span class="hl_fundecl"><span class="mpre">mapRight</span></span></a><span class="mpre"> </span><a name="loc_58_10_58_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_10_58_11&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_58_12_58_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_12_58_16&#39;)"><span class="hl_vardecl"><span class="mpre">eith</span></span></a><span class="mpre"> = case </span><a href="#loc_58_12_58_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_12_58_16&#39;)"><span class="hl_varref"><span class="mpre">eith</span></span></a><span class="mpre"> of
    </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a name="loc_59_11_59_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_11_59_12&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="#loc_58_10_58_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_10_58_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_59_11_59_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_11_59_12&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)
    </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_60_10_60_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_10_60_11&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_60_10_60_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_10_60_11&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_68_1_68_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_1_68_10&#39;)"><span class="mpre">fileRange</span></a><span class="mpre"> :: </span><a href="Network.HTTP.Types.Status.html#loc_114_6_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_114_6_114_12&#39;)"><span class="hl_tyconref"><span class="mpre">H.Status</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre">
           -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.Wai.Internal.html#loc_98_6_98_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_98_6_98_14&#39;)"><span class="hl_tyconref"><span class="mpre">FilePart</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HeaderValue</span></span><span class="mpre">
          -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_238_6_238_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_238_6_238_17&#39;)"><span class="hl_tyconref"><span class="mpre">IOException</span></span></a><span class="mpre">
                        (</span><a href="Network.HTTP.Types.Status.html#loc_114_6_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_114_6_114_12&#39;)"><span class="hl_tyconref"><span class="mpre">H.Status</span></span></a><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">))
</span><a name="loc_68_1_68_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_1_68_10&#39;)"><span class="hl_fundecl"><span class="mpre">fileRange</span></span></a><span class="mpre"> </span><a name="loc_68_11_68_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_11_68_13&#39;)"><span class="hl_vardecl"><span class="mpre">s0</span></span></a><span class="mpre"> </span><a name="loc_68_14_68_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_14_68_17&#39;)"><span class="hl_vardecl"><span class="mpre">hs0</span></span></a><span class="mpre"> </span><a name="loc_68_18_68_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_18_68_22&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> </span><a name="loc_68_23_68_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_23_68_28&#39;)"><span class="hl_vardecl"><span class="mpre">mPart</span></span></a><span class="mpre"> </span><a name="loc_68_29_68_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_29_68_35&#39;)"><span class="hl_vardecl"><span class="mpre">mRange</span></span></a><span class="mpre"> =
    </span><a href="#loc_58_1_58_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_9&#39;)"><span class="hl_varref"><span class="mpre">mapRight</span></span></a><span class="mpre"> (</span><a href="#loc_73_5_73_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_5_73_19&#39;)"><span class="hl_varref"><span class="mpre">fileRangeSized</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">P.fileSize</span></span><span class="mpre">) </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre">
        </span><a href="Control.Exception.Base.html#loc_212_1_212_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_212_1_212_4&#39;)"><span class="hl_varref"><span class="mpre">try</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">P.getFileStatus</span></span><span class="mpre"> </span><a href="#loc_68_18_68_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_18_68_22&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre">)
 where
    </span><a href="#loc_73_5_73_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_5_73_19&#39;)"><span class="mpre">fileRangeSized</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; (</span><a href="Network.HTTP.Types.Status.html#loc_114_6_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_114_6_114_12&#39;)"><span class="hl_tyconref"><span class="mpre">H.Status</span></span></a><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">)
    </span><a name="loc_73_5_73_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_5_73_19&#39;)"><span class="hl_fundecl"><span class="mpre">fileRangeSized</span></span></a><span class="mpre"> </span><a name="loc_73_20_73_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_20_73_28&#39;)"><span class="hl_vardecl"><span class="mpre">fileSize</span></span></a><span class="mpre"> =
        let (</span><a name="loc_74_14_74_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_14_74_17&#39;)"><span class="hl_vardecl"><span class="mpre">beg</span></span></a><span class="mpre">, </span><a name="loc_74_19_74_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_19_74_22&#39;)"><span class="hl_vardecl"><span class="mpre">end</span></span></a><span class="mpre">, </span><a name="loc_74_24_74_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_24_74_27&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">, </span><a name="loc_74_29_74_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_29_74_37&#39;)"><span class="hl_vardecl"><span class="mpre">isEntire</span></span></a><span class="mpre">) = </span><a href="#loc_85_1_85_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_15&#39;)"><span class="hl_varref"><span class="mpre">checkPartRange</span></span></a><span class="mpre"> </span><a href="#loc_73_20_73_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_20_73_28&#39;)"><span class="hl_varref"><span class="mpre">fileSize</span></span></a><span class="mpre"> </span><a href="#loc_68_23_68_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_23_68_28&#39;)"><span class="hl_varref"><span class="mpre">mPart</span></span></a><span class="mpre"> </span><a href="#loc_68_29_68_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_29_68_35&#39;)"><span class="hl_varref"><span class="mpre">mRange</span></span></a><span class="mpre">
            </span><a name="loc_75_13_75_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_13_75_16&#39;)"><span class="hl_vardecl"><span class="mpre">hs1</span></span></a><span class="mpre"> = </span><a href="#loc_355_1_355_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_355_1_355_17&#39;)"><span class="hl_varref"><span class="mpre">addContentLength</span></span></a><span class="mpre"> </span><a href="#loc_74_24_74_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_24_74_27&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><a href="#loc_68_14_68_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_14_68_17&#39;)"><span class="hl_varref"><span class="mpre">hs0</span></span></a><span class="mpre">
            </span><a name="loc_76_13_76_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_13_76_15&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> | </span><a href="#loc_74_29_74_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_29_74_37&#39;)"><span class="hl_varref"><span class="mpre">isEntire</span></span></a><span class="mpre">  = </span><a href="#loc_75_13_75_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_13_75_16&#39;)"><span class="hl_varref"><span class="mpre">hs1</span></span></a><span class="mpre">
               | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="#loc_361_1_361_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_1_361_16&#39;)"><span class="hl_varref"><span class="mpre">addContentRange</span></span></a><span class="mpre"> </span><a href="#loc_74_14_74_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_14_74_17&#39;)"><span class="hl_varref"><span class="mpre">beg</span></span></a><span class="mpre"> </span><a href="#loc_74_19_74_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_19_74_22&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre"> </span><a href="#loc_73_20_73_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_20_73_28&#39;)"><span class="hl_varref"><span class="mpre">fileSize</span></span></a><span class="mpre"> </span><a href="#loc_75_13_75_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_13_75_16&#39;)"><span class="hl_varref"><span class="mpre">hs1</span></span></a><span class="mpre">
            </span><a name="loc_78_13_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_13_78_14&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">  | </span><a href="#loc_74_29_74_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_29_74_37&#39;)"><span class="hl_varref"><span class="mpre">isEntire</span></span></a><span class="mpre">  = </span><a href="#loc_68_11_68_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_11_68_13&#39;)"><span class="hl_varref"><span class="mpre">s0</span></span></a><span class="mpre">
               | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="Network.HTTP.Types.Status.html#loc_241_1_241_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_241_1_241_10&#39;)"><span class="hl_varref"><span class="mpre">H.status206</span></span></a><span class="mpre">
        in  (</span><a href="#loc_78_13_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_13_78_14&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">, </span><a href="#loc_76_13_76_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_13_76_15&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">, </span><a href="#loc_74_14_74_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_14_74_17&#39;)"><span class="hl_varref"><span class="mpre">beg</span></span></a><span class="mpre">, </span><a href="#loc_74_24_74_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_24_74_27&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">)


</span><a href="#loc_85_1_85_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_15&#39;)"><span class="mpre">checkPartRange</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.Wai.Internal.html#loc_98_6_98_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_98_6_98_14&#39;)"><span class="hl_tyconref"><span class="mpre">FilePart</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HeaderValue</span></span><span class="mpre">
               -&gt; (</span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">)
</span><a name="loc_85_1_85_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_15&#39;)"><span class="hl_fundecl"><span class="mpre">checkPartRange</span></span></a><span class="mpre"> </span><a name="loc_85_16_85_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_16_85_24&#39;)"><span class="hl_vardecl"><span class="mpre">fileSize</span></span></a><span class="mpre"> = </span><a href="#loc_87_5_87_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_14&#39;)"><span class="hl_varref"><span class="mpre">checkPart</span></span></a><span class="mpre">
  where
    </span><a name="loc_87_5_87_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_14&#39;)"><span class="hl_fundecl"><span class="mpre">checkPart</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> = (</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">, </span><a href="#loc_85_16_85_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_16_85_24&#39;)"><span class="hl_varref"><span class="mpre">fileSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">, </span><a href="#loc_85_16_85_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_16_85_24&#39;)"><span class="hl_varref"><span class="mpre">fileSize</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">)
    </span><a href="#loc_87_5_87_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_14&#39;)"><span class="hl_fundecl"><span class="mpre">checkPart</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_88_29_88_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_29_88_34&#39;)"><span class="hl_vardecl"><span class="mpre">range</span></span></a><span class="mpre">) = case </span><a href="Network.Wai.Handler.Warp.RequestHeader.html#loc_136_1_136_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.RequestHeader.html#loc_136_1_136_16&#39;)"><span class="hl_varref"><span class="mpre">parseByteRanges</span></span></a><span class="mpre"> </span><a href="#loc_88_29_88_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_29_88_34&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_109_1_109_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_109_1_109_12&#39;)"><span class="hl_varref"><span class="mpre">listToMaybe</span></span></a><span class="mpre"> of
        </span><span class="hl_comment"><span class="mpre">-- Range is broken</span></span><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">              -&gt; (</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">, </span><a href="#loc_85_16_85_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_16_85_24&#39;)"><span class="hl_varref"><span class="mpre">fileSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">, </span><a href="#loc_85_16_85_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_16_85_24&#39;)"><span class="hl_varref"><span class="mpre">fileSize</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">)
        </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_91_14_91_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_14_91_20&#39;)"><span class="hl_vardecl"><span class="mpre">hrange</span></span></a><span class="mpre">          -&gt; </span><a href="#loc_102_5_102_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_5_102_15&#39;)"><span class="hl_varref"><span class="mpre">checkRange</span></span></a><span class="mpre"> </span><a href="#loc_91_14_91_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_14_91_20&#39;)"><span class="hl_varref"><span class="mpre">hrange</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- Ignore Range if FilePart is specified.</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- We assume that an application handled Range and specified</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- FilePart.</span></span><span class="mpre">
    </span><a href="#loc_87_5_87_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_14&#39;)"><span class="hl_fundecl"><span class="mpre">checkPart</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_95_21_95_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_21_95_25&#39;)"><span class="hl_vardecl"><span class="mpre">part</span></span></a><span class="mpre">) _   = (</span><a href="#loc_97_9_97_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_9_97_12&#39;)"><span class="hl_varref"><span class="mpre">beg</span></span></a><span class="mpre">, </span><a href="#loc_99_9_99_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_9_99_12&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre">, </span><a href="#loc_98_9_98_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_9_98_12&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">, </span><a href="#loc_100_9_100_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_9_100_17&#39;)"><span class="hl_varref"><span class="mpre">isEntire</span></span></a><span class="mpre">)
      where
        </span><a name="loc_97_9_97_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_9_97_12&#39;)"><span class="hl_vardecl"><span class="mpre">beg</span></span></a><span class="mpre"> = </span><a href="Network.Wai.Internal.html#loc_99_7_99_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_99_7_99_21&#39;)"><span class="hl_varref"><span class="mpre">filePartOffset</span></span></a><span class="mpre"> </span><a href="#loc_95_21_95_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_21_95_25&#39;)"><span class="hl_varref"><span class="mpre">part</span></span></a><span class="mpre">
        </span><a name="loc_98_9_98_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_9_98_12&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = </span><a href="Network.Wai.Internal.html#loc_100_7_100_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_100_7_100_24&#39;)"><span class="hl_varref"><span class="mpre">filePartByteCount</span></span></a><span class="mpre"> </span><a href="#loc_95_21_95_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_21_95_25&#39;)"><span class="hl_varref"><span class="mpre">part</span></span></a><span class="mpre">
        </span><a name="loc_99_9_99_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_9_99_12&#39;)"><span class="hl_vardecl"><span class="mpre">end</span></span></a><span class="mpre"> = </span><a href="#loc_97_9_97_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_9_97_12&#39;)"><span class="hl_varref"><span class="mpre">beg</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_98_9_98_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_9_98_12&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
        </span><a name="loc_100_9_100_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_9_100_17&#39;)"><span class="hl_vardecl"><span class="mpre">isEntire</span></span></a><span class="mpre"> = </span><a href="#loc_97_9_97_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_9_97_12&#39;)"><span class="hl_varref"><span class="mpre">beg</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_98_9_98_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_9_98_12&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_85_16_85_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_16_85_24&#39;)"><span class="hl_varref"><span class="mpre">fileSize</span></span></a><span class="mpre">

    </span><a name="loc_102_5_102_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_5_102_15&#39;)"><span class="hl_fundecl"><span class="mpre">checkRange</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">H.ByteRangeFrom</span></span><span class="mpre">   </span><a name="loc_102_35_102_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_35_102_38&#39;)"><span class="hl_vardecl"><span class="mpre">beg</span></span></a><span class="mpre">)     = </span><a href="#loc_106_5_106_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_5_106_14&#39;)"><span class="hl_varref"><span class="mpre">fromRange</span></span></a><span class="mpre"> </span><a href="#loc_102_35_102_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_35_102_38&#39;)"><span class="hl_varref"><span class="mpre">beg</span></span></a><span class="mpre"> (</span><a href="#loc_85_16_85_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_16_85_24&#39;)"><span class="hl_varref"><span class="mpre">fileSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
    </span><a href="#loc_102_5_102_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_5_102_15&#39;)"><span class="hl_fundecl"><span class="mpre">checkRange</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">H.ByteRangeFromTo</span></span><span class="mpre"> </span><a name="loc_103_35_103_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_35_103_38&#39;)"><span class="hl_vardecl"><span class="mpre">beg</span></span></a><span class="mpre"> </span><a name="loc_103_39_103_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_39_103_42&#39;)"><span class="hl_vardecl"><span class="mpre">end</span></span></a><span class="mpre">) = </span><a href="#loc_106_5_106_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_5_106_14&#39;)"><span class="hl_varref"><span class="mpre">fromRange</span></span></a><span class="mpre"> </span><a href="#loc_103_35_103_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_35_103_38&#39;)"><span class="hl_varref"><span class="mpre">beg</span></span></a><span class="mpre"> </span><a href="#loc_103_39_103_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_39_103_42&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre">
    </span><a href="#loc_102_5_102_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_5_102_15&#39;)"><span class="hl_fundecl"><span class="mpre">checkRange</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">H.ByteRangeSuffix</span></span><span class="mpre"> </span><a name="loc_104_35_104_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_35_104_40&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre">)   = </span><a href="#loc_106_5_106_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_5_106_14&#39;)"><span class="hl_varref"><span class="mpre">fromRange</span></span></a><span class="mpre"> (</span><a href="#loc_85_16_85_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_16_85_24&#39;)"><span class="hl_varref"><span class="mpre">fileSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_104_35_104_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_35_104_40&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">) (</span><a href="#loc_85_16_85_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_16_85_24&#39;)"><span class="hl_varref"><span class="mpre">fileSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)

    </span><a name="loc_106_5_106_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_5_106_14&#39;)"><span class="hl_fundecl"><span class="mpre">fromRange</span></span></a><span class="mpre"> </span><a name="loc_106_15_106_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_15_106_18&#39;)"><span class="hl_vardecl"><span class="mpre">beg</span></span></a><span class="mpre"> </span><a name="loc_106_19_106_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_19_106_22&#39;)"><span class="hl_vardecl"><span class="mpre">end</span></span></a><span class="mpre"> = (</span><a href="#loc_106_15_106_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_15_106_18&#39;)"><span class="hl_varref"><span class="mpre">beg</span></span></a><span class="mpre">, </span><a href="#loc_106_19_106_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_19_106_22&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre">, </span><a href="#loc_108_9_108_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_9_108_12&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">, </span><a href="#loc_109_9_109_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_9_109_17&#39;)"><span class="hl_varref"><span class="mpre">isEntire</span></span></a><span class="mpre">)
      where
        </span><a name="loc_108_9_108_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_9_108_12&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = </span><a href="#loc_106_19_106_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_19_106_22&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_106_15_106_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_15_106_18&#39;)"><span class="hl_varref"><span class="mpre">beg</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
        </span><a name="loc_109_9_109_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_9_109_17&#39;)"><span class="hl_vardecl"><span class="mpre">isEntire</span></span></a><span class="mpre"> = </span><a href="#loc_106_15_106_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_15_106_18&#39;)"><span class="hl_varref"><span class="mpre">beg</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_108_9_108_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_9_108_12&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_85_16_85_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_16_85_24&#39;)"><span class="hl_varref"><span class="mpre">fileSize</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Sending a HTTP response to &#39;Connection&#39; according to &#39;Response&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   Applications/middlewares MUST specify a proper &#39;H.ResponseHeaders&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   so that inconsistency does not happen.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   No header is deleted by this function.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   Especially, Applications/middlewares MUST take care of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   Content-Length, Content-Range, and Transfer-Encoding</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   because they are inserted, when necessary,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   regardless they already exist.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   This function does not insert Content-Encoding. It&#39;s middleware&#39;s</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   responsibility.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   The Date and Server header is added if not exist</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   in HTTP response header.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   There are three basic APIs to create &#39;Response&#39;:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   [&#39;responseFile&#39; :: &#39;H.Status&#39; -&gt; &#39;H.ResponseHeaders&#39; -&gt; &#39;FilePath&#39; -&gt; &#39;Maybe&#39; &#39;FilePart&#39; -&gt; &#39;Response&#39;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     HTTP response body is sent by sendfile().</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     Applications are categorized into simple and sophisticated.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     Simple applications should specify &#39;Nothing&#39; to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     &#39;Maybe&#39; &#39;FilePart&#39;. The size of the specified file is obtained</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     by disk access. Then Range is handled.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     Sophisticated applications should specify &#39;Just&#39; to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     &#39;Maybe&#39; &#39;FilePart&#39;. They should treat Range (and If-Range) by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     thierselves. In both cases,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     Content-Length and Content-Range (if necessary) are automatically</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     added into the HTTP response header.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     If Content-Length and Content-Range exist in the HTTP response header,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     they would cause inconsistency.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     Status is also changed to 206 if necessary.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   [&#39;responseBuilder&#39; :: &#39;H.Status&#39; -&gt; &#39;H.ResponseHeaders&#39; -&gt; &#39;Builder&#39; -&gt; &#39;Response&#39;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     HTTP response body is created from &#39;Source&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     Typically, Transfer-Encoding: chunked is used.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     If Content-Length is specified, Transfer-Encoding: chunked is not used.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   [&#39;responseSource&#39; :: &#39;H.Status&#39; -&gt; &#39;H.ResponseHeaders&#39; -&gt; &#39;Source&#39; &#39;IO&#39; (&#39;Flush&#39; &#39;Builder&#39;) -&gt; &#39;Response&#39;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     HTTP response body is created from &#39;Builder&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     Typically, Transfer-Encoding: chunked is used.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     If Content-Length is specified, Transfer-Encoding: chunked is not used.</span></span><span class="mpre">

</span><a href="#loc_163_1_163_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_1_163_13&#39;)"><span class="mpre">sendResponse</span></a><span class="mpre"> :: </span><a href="Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre">
             -&gt; </span><a href="Network.Wai.Handler.Warp.Types.html#loc_88_6_88_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_88_6_88_18&#39;)"><span class="hl_tyconref"><span class="mpre">InternalInfo</span></span></a><span class="mpre">
             -&gt; </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ HTTP request.</span></span><span class="mpre">
             -&gt; </span><span class="hl_tyconref"><span class="mpre">IndexedHeader</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ Indexed header of HTTP request.</span></span><span class="mpre">
             -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ source from client, for raw response</span></span><span class="mpre">
             -&gt; </span><a href="Network.Wai.Internal.html#loc_74_6_74_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_74_6_74_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ HTTP response including status code and response header.</span></span><span class="mpre">
             -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ Returing True if the connection is persistent.</span></span><span class="mpre">
</span><a name="loc_163_1_163_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_1_163_13&#39;)"><span class="hl_fundecl"><span class="mpre">sendResponse</span></span></a><span class="mpre"> </span><a name="loc_163_14_163_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_14_163_18&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_163_19_163_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_19_163_21&#39;)"><span class="hl_vardecl"><span class="mpre">ii</span></span></a><span class="mpre"> </span><a name="loc_163_22_163_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_22_163_25&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> </span><a name="loc_163_26_163_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_26_163_35&#39;)"><span class="hl_vardecl"><span class="mpre">reqidxhdr</span></span></a><span class="mpre"> </span><a name="loc_163_36_163_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_36_163_39&#39;)"><span class="hl_vardecl"><span class="mpre">src</span></span></a><span class="mpre"> </span><a name="loc_163_40_163_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_40_163_48&#39;)"><span class="hl_vardecl"><span class="mpre">response</span></span></a><span class="mpre"> = do
    </span><a name="loc_164_5_164_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_5_164_7&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_180_5_180_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_5_180_21&#39;)"><span class="hl_varref"><span class="mpre">addServerAndDate</span></span></a><span class="mpre"> </span><a href="#loc_176_5_176_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_5_176_8&#39;)"><span class="hl_varref"><span class="mpre">hs0</span></span></a><span class="mpre">
    if </span><a href="#loc_338_1_338_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_1_338_8&#39;)"><span class="hl_varref"><span class="mpre">hasBody</span></span></a><span class="mpre"> </span><a href="#loc_175_5_175_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_5_175_6&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_163_22_163_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_22_163_25&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> then do
        </span><a href="#loc_210_1_210_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_1_210_8&#39;)"><span class="hl_varref"><span class="mpre">sendRsp</span></span></a><span class="mpre"> </span><a href="#loc_163_14_163_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_14_163_18&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_174_5_174_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_5_174_8&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_175_5_175_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_5_175_6&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_164_5_164_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_5_164_7&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> </span><a href="#loc_184_5_184_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_5_184_8&#39;)"><span class="hl_varref"><span class="mpre">rsp</span></span></a><span class="mpre">
        </span><a href="Network.Wai.Handler.Warp.Timeout.html#loc_157_1_157_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Timeout.html#loc_157_1_157_7&#39;)"><span class="hl_varref"><span class="mpre">T.tickle</span></span></a><span class="mpre"> </span><a href="#loc_178_5_178_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_5_178_7&#39;)"><span class="hl_varref"><span class="mpre">th</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_189_5_189_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_5_189_8&#39;)"><span class="hl_varref"><span class="mpre">ret</span></span></a><span class="mpre">
      else do
        </span><a href="#loc_280_1_280_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_1_280_19&#39;)"><span class="hl_varref"><span class="mpre">sendResponseNoBody</span></span></a><span class="mpre"> </span><a href="#loc_163_14_163_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_14_163_18&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_174_5_174_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_5_174_8&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_175_5_175_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_5_175_6&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_164_5_164_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_5_164_7&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">
        </span><a href="Network.Wai.Handler.Warp.Timeout.html#loc_157_1_157_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Timeout.html#loc_157_1_157_7&#39;)"><span class="hl_varref"><span class="mpre">T.tickle</span></span></a><span class="mpre"> </span><a href="#loc_178_5_178_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_5_178_7&#39;)"><span class="hl_varref"><span class="mpre">th</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_182_14_182_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_14_182_23&#39;)"><span class="hl_varref"><span class="mpre">isPersist</span></span></a><span class="mpre">
  where
    </span><a name="loc_174_5_174_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_5_174_8&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> = </span><a href="Network.Wai.Internal.html#loc_24_6_24_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_24_6_24_17&#39;)"><span class="hl_varref"><span class="mpre">httpVersion</span></span></a><span class="mpre"> </span><a href="#loc_163_22_163_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_22_163_25&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">
    </span><a name="loc_175_5_175_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_5_175_6&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = </span><a href="Network.Wai.html#loc_180_1_180_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_180_1_180_15&#39;)"><span class="hl_varref"><span class="mpre">responseStatus</span></span></a><span class="mpre"> </span><a href="#loc_163_40_163_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_40_163_48&#39;)"><span class="hl_varref"><span class="mpre">response</span></span></a><span class="mpre">
    </span><a name="loc_176_5_176_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_5_176_8&#39;)"><span class="hl_vardecl"><span class="mpre">hs0</span></span></a><span class="mpre"> = </span><a href="Network.Wai.html#loc_187_1_187_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_187_1_187_16&#39;)"><span class="hl_varref"><span class="mpre">responseHeaders</span></span></a><span class="mpre"> </span><a href="#loc_163_40_163_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_40_163_48&#39;)"><span class="hl_varref"><span class="mpre">response</span></span></a><span class="mpre">
    </span><a name="loc_177_5_177_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_5_177_14&#39;)"><span class="hl_vardecl"><span class="mpre">rspidxhdr</span></span></a><span class="mpre"> = </span><a href="Network.Wai.Handler.Warp.Header.html#loc_50_1_50_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Header.html#loc_50_1_50_20&#39;)"><span class="hl_varref"><span class="mpre">indexResponseHeader</span></span></a><span class="mpre"> </span><a href="#loc_176_5_176_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_5_176_8&#39;)"><span class="hl_varref"><span class="mpre">hs0</span></span></a><span class="mpre">
    </span><a name="loc_178_5_178_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_5_178_7&#39;)"><span class="hl_vardecl"><span class="mpre">th</span></span></a><span class="mpre"> = </span><a href="Network.Wai.Handler.Warp.Types.html#loc_89_5_89_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_89_5_89_17&#39;)"><span class="hl_varref"><span class="mpre">threadHandle</span></span></a><span class="mpre"> </span><a href="#loc_163_19_163_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_19_163_21&#39;)"><span class="hl_varref"><span class="mpre">ii</span></span></a><span class="mpre">
    </span><a name="loc_179_5_179_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_5_179_7&#39;)"><span class="hl_vardecl"><span class="mpre">dc</span></span></a><span class="mpre"> = </span><a href="Network.Wai.Handler.Warp.Types.html#loc_91_5_91_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_91_5_91_15&#39;)"><span class="hl_varref"><span class="mpre">dateCacher</span></span></a><span class="mpre"> </span><a href="#loc_163_19_163_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_19_163_21&#39;)"><span class="hl_varref"><span class="mpre">ii</span></span></a><span class="mpre">
    </span><a name="loc_180_5_180_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_5_180_21&#39;)"><span class="hl_vardecl"><span class="mpre">addServerAndDate</span></span></a><span class="mpre"> = </span><a href="#loc_373_1_373_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_373_1_373_8&#39;)"><span class="hl_varref"><span class="mpre">addDate</span></span></a><span class="mpre"> </span><a href="#loc_179_5_179_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_5_179_7&#39;)"><span class="hl_varref"><span class="mpre">dc</span></span></a><span class="mpre"> </span><a href="#loc_177_5_177_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_5_177_14&#39;)"><span class="hl_varref"><span class="mpre">rspidxhdr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_389_1_389_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_1_389_10&#39;)"><span class="hl_varref"><span class="mpre">addServer</span></span></a><span class="mpre"> </span><a href="#loc_177_5_177_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_5_177_14&#39;)"><span class="hl_varref"><span class="mpre">rspidxhdr</span></span></a><span class="mpre">
    </span><a name="loc_181_5_181_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_5_181_11&#39;)"><span class="hl_vardecl"><span class="mpre">mRange</span></span></a><span class="mpre"> = </span><a href="#loc_163_26_163_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_26_163_35&#39;)"><span class="hl_varref"><span class="mpre">reqidxhdr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Header.html#loc_26_1_26_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Header.html#loc_26_1_26_9&#39;)"><span class="hl_varref"><span class="mpre">idxRange</span></span></a><span class="mpre">
    </span><a name="loc_182_5_182_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_5_182_12&#39;)"><span class="hl_specname"><span class="mpre">reqinfo</span></span></a><span class="mpre">@(</span><a name="loc_182_14_182_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_14_182_23&#39;)"><span class="hl_vardecl"><span class="mpre">isPersist</span></span></a><span class="mpre">,_) = </span><a href="#loc_300_1_300_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_300_1_300_16&#39;)"><span class="hl_varref"><span class="mpre">infoFromRequest</span></span></a><span class="mpre"> </span><a href="#loc_163_22_163_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_22_163_25&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><a href="#loc_163_26_163_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_26_163_35&#39;)"><span class="hl_varref"><span class="mpre">reqidxhdr</span></span></a><span class="mpre">
    (</span><a name="loc_183_6_183_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_6_183_17&#39;)"><span class="hl_vardecl"><span class="mpre">isKeepAlive</span></span></a><span class="mpre">, </span><a name="loc_183_19_183_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_19_183_31&#39;)"><span class="hl_vardecl"><span class="mpre">needsChunked</span></span></a><span class="mpre">) = </span><a href="#loc_329_1_329_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_1_329_17&#39;)"><span class="hl_varref"><span class="mpre">infoFromResponse</span></span></a><span class="mpre"> </span><a href="#loc_177_5_177_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_5_177_14&#39;)"><span class="hl_varref"><span class="mpre">rspidxhdr</span></span></a><span class="mpre"> </span><a href="#loc_182_5_182_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_5_182_12&#39;)"><span class="hl_varref"><span class="mpre">reqinfo</span></span></a><span class="mpre">
    </span><a name="loc_184_5_184_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_5_184_8&#39;)"><span class="hl_vardecl"><span class="mpre">rsp</span></span></a><span class="mpre"> = case </span><a href="#loc_163_40_163_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_40_163_48&#39;)"><span class="hl_varref"><span class="mpre">response</span></span></a><span class="mpre"> of
        </span><a href="Network.Wai.Internal.html#loc_75_7_75_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_75_7_75_19&#39;)"><span class="hl_conref"><span class="mpre">ResponseFile</span></span></a><span class="mpre"> _ _ </span><a name="loc_185_26_185_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_26_185_30&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> </span><a name="loc_185_31_185_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_31_185_36&#39;)"><span class="hl_vardecl"><span class="mpre">mPart</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_197_12_197_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_12_197_19&#39;)"><span class="hl_conref"><span class="mpre">RspFile</span></span></a><span class="mpre"> </span><a href="#loc_185_26_185_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_26_185_30&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre"> </span><a href="#loc_185_31_185_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_31_185_36&#39;)"><span class="hl_varref"><span class="mpre">mPart</span></span></a><span class="mpre"> </span><a href="#loc_181_5_181_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_5_181_11&#39;)"><span class="hl_varref"><span class="mpre">mRange</span></span></a><span class="mpre"> (</span><a href="Network.Wai.Handler.Warp.Timeout.html#loc_157_1_157_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Timeout.html#loc_157_1_157_7&#39;)"><span class="hl_varref"><span class="mpre">T.tickle</span></span></a><span class="mpre"> </span><a href="#loc_178_5_178_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_5_178_7&#39;)"><span class="hl_varref"><span class="mpre">th</span></span></a><span class="mpre">)
        </span><a href="Network.Wai.Internal.html#loc_76_7_76_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_76_7_76_22&#39;)"><span class="hl_conref"><span class="mpre">ResponseBuilder</span></span></a><span class="mpre"> _ _ </span><a name="loc_186_29_186_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_29_186_30&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">       -&gt; </span><a href="#loc_198_12_198_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_12_198_22&#39;)"><span class="hl_conref"><span class="mpre">RspBuilder</span></span></a><span class="mpre"> </span><a href="#loc_186_29_186_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_29_186_30&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><a href="#loc_183_19_183_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_19_183_31&#39;)"><span class="hl_varref"><span class="mpre">needsChunked</span></span></a><span class="mpre">
        </span><a href="Network.Wai.Internal.html#loc_77_7_77_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_77_7_77_21&#39;)"><span class="hl_conref"><span class="mpre">ResponseStream</span></span></a><span class="mpre"> _ _ </span><a name="loc_187_28_187_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_28_187_30&#39;)"><span class="hl_vardecl"><span class="mpre">fb</span></span></a><span class="mpre">       -&gt; </span><a href="#loc_199_12_199_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_12_199_21&#39;)"><span class="hl_conref"><span class="mpre">RspStream</span></span></a><span class="mpre"> </span><a href="#loc_187_28_187_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_28_187_30&#39;)"><span class="hl_varref"><span class="mpre">fb</span></span></a><span class="mpre"> </span><a href="#loc_183_19_183_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_19_183_31&#39;)"><span class="hl_varref"><span class="mpre">needsChunked</span></span></a><span class="mpre"> </span><a href="#loc_178_5_178_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_5_178_7&#39;)"><span class="hl_varref"><span class="mpre">th</span></span></a><span class="mpre">
        </span><a href="Network.Wai.Internal.html#loc_78_7_78_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_78_7_78_18&#39;)"><span class="hl_conref"><span class="mpre">ResponseRaw</span></span></a><span class="mpre"> </span><a name="loc_188_21_188_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_21_188_24&#39;)"><span class="hl_vardecl"><span class="mpre">raw</span></span></a><span class="mpre"> _           -&gt; </span><a href="#loc_200_12_200_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_12_200_18&#39;)"><span class="hl_conref"><span class="mpre">RspRaw</span></span></a><span class="mpre"> </span><a href="#loc_188_21_188_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_21_188_24&#39;)"><span class="hl_varref"><span class="mpre">raw</span></span></a><span class="mpre"> </span><a href="#loc_163_36_163_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_36_163_39&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre"> (</span><a href="Network.Wai.Handler.Warp.Timeout.html#loc_157_1_157_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Timeout.html#loc_157_1_157_7&#39;)"><span class="hl_varref"><span class="mpre">T.tickle</span></span></a><span class="mpre"> </span><a href="#loc_178_5_178_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_5_178_7&#39;)"><span class="hl_varref"><span class="mpre">th</span></span></a><span class="mpre">)
    </span><a name="loc_189_5_189_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_5_189_8&#39;)"><span class="hl_vardecl"><span class="mpre">ret</span></span></a><span class="mpre"> = case </span><a href="#loc_163_40_163_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_40_163_48&#39;)"><span class="hl_varref"><span class="mpre">response</span></span></a><span class="mpre"> of
        </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 190, srcSpanStartColumn = 9, srcSpanEndLine = 190, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 190, srcSpanStartColumn = 25, srcSpanEndLine = 190, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/H"><span class="mpre">ResponseFile    {}</span></span><span class="mpre"> -&gt; </span><a href="#loc_182_14_182_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_14_182_23&#39;)"><span class="hl_varref"><span class="mpre">isPersist</span></span></a><span class="mpre">
        </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 191, srcSpanStartColumn = 9, srcSpanEndLine = 191, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 191, srcSpanStartColumn = 25, srcSpanEndLine = 191, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/H"><span class="mpre">ResponseBuilder {}</span></span><span class="mpre"> -&gt; </span><a href="#loc_183_6_183_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_6_183_17&#39;)"><span class="hl_varref"><span class="mpre">isKeepAlive</span></span></a><span class="mpre">
        </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 192, srcSpanStartColumn = 9, srcSpanEndLine = 192, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 192, srcSpanStartColumn = 25, srcSpanEndLine = 192, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/H"><span class="mpre">ResponseStream  {}</span></span><span class="mpre"> -&gt; </span><a href="#loc_183_6_183_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_6_183_17&#39;)"><span class="hl_varref"><span class="mpre">isKeepAlive</span></span></a><span class="mpre">
        </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 193, srcSpanStartColumn = 9, srcSpanEndLine = 193, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 193, srcSpanStartColumn = 25, srcSpanEndLine = 193, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/H"><span class="mpre">ResponseRaw     {}</span></span><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

data </span><a name="loc_197_6_197_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_6_197_9&#39;)"><span class="hl_tycondecl"><span class="mpre">Rsp</span></span></a><span class="mpre"> = </span><a name="loc_197_12_197_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_12_197_19&#39;)"><span class="hl_condecl"><span class="mpre">RspFile</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.Wai.Internal.html#loc_98_6_98_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_98_6_98_14&#39;)"><span class="hl_tyconref"><span class="mpre">FilePart</span></span></a><span class="mpre">) (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HeaderValue</span></span><span class="mpre">) (</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)
         | </span><a name="loc_198_12_198_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_12_198_22&#39;)"><span class="hl_condecl"><span class="mpre">RspBuilder</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
         | </span><a name="loc_199_12_199_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_12_199_21&#39;)"><span class="hl_condecl"><span class="mpre">RspStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">StreamingBody</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Timeout.html#loc_70_6_70_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Timeout.html#loc_70_6_70_12&#39;)"><span class="hl_tyconref"><span class="mpre">T.Handle</span></span></a><span class="mpre">
         | </span><a name="loc_200_12_200_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_12_200_18&#39;)"><span class="hl_condecl"><span class="mpre">RspRaw</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">) (</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">) (</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_210_1_210_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_1_210_8&#39;)"><span class="mpre">sendRsp</span></a><span class="mpre"> :: </span><a href="Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre">
        -&gt; </span><a href="Network.HTTP.Types.Version.html#loc_13_6_13_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Version.html#loc_13_6_13_17&#39;)"><span class="hl_tyconref"><span class="mpre">H.HttpVersion</span></span></a><span class="mpre">
        -&gt; </span><a href="Network.HTTP.Types.Status.html#loc_114_6_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_114_6_114_12&#39;)"><span class="hl_tyconref"><span class="mpre">H.Status</span></span></a><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre">
        -&gt; </span><a href="#loc_197_6_197_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_6_197_9&#39;)"><span class="hl_tyconref"><span class="mpre">Rsp</span></span></a><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_210_1_210_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_1_210_8&#39;)"><span class="hl_fundecl"><span class="mpre">sendRsp</span></span></a><span class="mpre"> </span><a name="loc_210_9_210_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_9_210_13&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_210_14_210_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_14_210_17&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a name="loc_210_18_210_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_18_210_20&#39;)"><span class="hl_vardecl"><span class="mpre">s0</span></span></a><span class="mpre"> </span><a name="loc_210_21_210_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_21_210_24&#39;)"><span class="hl_vardecl"><span class="mpre">hs0</span></span></a><span class="mpre"> (</span><a href="#loc_197_12_197_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_12_197_19&#39;)"><span class="hl_conref"><span class="mpre">RspFile</span></span></a><span class="mpre"> </span><a name="loc_210_34_210_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_34_210_38&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> </span><a name="loc_210_39_210_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_39_210_44&#39;)"><span class="hl_vardecl"><span class="mpre">mPart</span></span></a><span class="mpre"> </span><a name="loc_210_45_210_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_45_210_51&#39;)"><span class="hl_vardecl"><span class="mpre">mRange</span></span></a><span class="mpre"> </span><a name="loc_210_52_210_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_52_210_56&#39;)"><span class="hl_vardecl"><span class="mpre">hook</span></span></a><span class="mpre">) = do
    </span><a name="loc_211_5_211_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_5_211_7&#39;)"><span class="hl_vardecl"><span class="mpre">ex</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_68_1_68_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_1_68_10&#39;)"><span class="hl_varref"><span class="mpre">fileRange</span></span></a><span class="mpre"> </span><a href="#loc_210_18_210_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_18_210_20&#39;)"><span class="hl_varref"><span class="mpre">s0</span></span></a><span class="mpre"> </span><a href="#loc_222_5_222_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_5_222_7&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> </span><a href="#loc_210_34_210_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_34_210_38&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre"> </span><a href="#loc_210_39_210_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_39_210_44&#39;)"><span class="hl_varref"><span class="mpre">mPart</span></span></a><span class="mpre"> </span><a href="#loc_210_45_210_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_45_210_51&#39;)"><span class="hl_varref"><span class="mpre">mRange</span></span></a><span class="mpre">
    case </span><a href="#loc_211_5_211_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_5_211_7&#39;)"><span class="hl_varref"><span class="mpre">ex</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_213_14_213_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_14_213_17&#39;)"><span class="hl_vardecl"><span class="mpre">_ex</span></span></a><span class="mpre"> -&gt;
#ifdef WARP_DEBUG
          </span><span class="hl_varref"><span class="mpre">print</span></span><span class="mpre"> </span><a href="#loc_213_14_213_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_14_213_17&#39;)"><span class="hl_varref"><span class="mpre">_ex</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre">
#endif
          </span><a href="#loc_210_1_210_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_1_210_8&#39;)"><span class="hl_varref"><span class="mpre">sendRsp</span></span></a><span class="mpre"> </span><a href="#loc_210_9_210_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_9_210_13&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_210_14_210_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_14_210_17&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_223_5_223_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_5_223_7&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre"> </span><a href="#loc_224_5_224_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_5_224_8&#39;)"><span class="hl_varref"><span class="mpre">hs2</span></span></a><span class="mpre"> (</span><a href="#loc_198_12_198_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_12_198_22&#39;)"><span class="hl_conref"><span class="mpre">RspBuilder</span></span></a><span class="mpre"> </span><a href="#loc_225_5_225_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_5_225_9&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">)
        </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a name="loc_218_16_218_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_16_218_17&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">, </span><a name="loc_218_19_218_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_19_218_22&#39;)"><span class="hl_vardecl"><span class="mpre">hs1</span></span></a><span class="mpre">, </span><a name="loc_218_24_218_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_24_218_27&#39;)"><span class="hl_vardecl"><span class="mpre">beg</span></span></a><span class="mpre">, </span><a name="loc_218_29_218_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_29_218_32&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">) -&gt; do
            </span><a name="loc_219_13_219_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_13_219_20&#39;)"><span class="hl_vardecl"><span class="mpre">lheader</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Wai.Handler.Warp.ResponseHeader.html#loc_21_1_21_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.ResponseHeader.html#loc_21_1_21_14&#39;)"><span class="hl_varref"><span class="mpre">composeHeader</span></span></a><span class="mpre"> </span><a href="#loc_210_14_210_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_14_210_17&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_218_16_218_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_16_218_17&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_218_19_218_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_19_218_22&#39;)"><span class="hl_varref"><span class="mpre">hs1</span></span></a><span class="mpre">
            </span><a href="Network.Wai.Handler.Warp.Types.html#loc_76_7_76_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_76_7_76_19&#39;)"><span class="hl_varref"><span class="mpre">connSendFile</span></span></a><span class="mpre"> </span><a href="#loc_210_9_210_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_9_210_13&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_210_34_210_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_34_210_38&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre"> </span><a href="#loc_218_24_218_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_24_218_27&#39;)"><span class="hl_varref"><span class="mpre">beg</span></span></a><span class="mpre"> </span><a href="#loc_218_29_218_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_29_218_32&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><a href="#loc_210_52_210_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_52_210_56&#39;)"><span class="hl_varref"><span class="mpre">hook</span></span></a><span class="mpre"> [</span><a href="#loc_219_13_219_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_13_219_20&#39;)"><span class="hl_varref"><span class="mpre">lheader</span></span></a><span class="mpre">]
  where
    </span><a name="loc_222_5_222_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_5_222_7&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> = </span><a href="#loc_349_1_349_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_1_349_16&#39;)"><span class="hl_varref"><span class="mpre">addAcceptRanges</span></span></a><span class="mpre"> </span><a href="#loc_210_21_210_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_21_210_24&#39;)"><span class="hl_varref"><span class="mpre">hs0</span></span></a><span class="mpre">
    </span><a name="loc_223_5_223_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_5_223_7&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre"> = </span><a href="Network.HTTP.Types.Status.html#loc_337_1_337_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_337_1_337_10&#39;)"><span class="hl_varref"><span class="mpre">H.status404</span></span></a><span class="mpre">
    </span><a name="loc_224_5_224_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_5_224_8&#39;)"><span class="hl_vardecl"><span class="mpre">hs2</span></span></a><span class="mpre"> =  </span><a href="#loc_400_1_400_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_1_400_14&#39;)"><span class="hl_varref"><span class="mpre">replaceHeader</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Types.Header.html#loc_71_1_71_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Header.html#loc_71_1_71_13&#39;)"><span class="hl_varref"><span class="mpre">H.hContentType</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;text/plain; charset=utf-8&quot;</span></span><span class="mpre"> </span><a href="#loc_210_21_210_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_21_210_24&#39;)"><span class="hl_varref"><span class="mpre">hs0</span></span></a><span class="mpre">
    </span><a name="loc_225_5_225_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_5_225_9&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre"> = </span><a href="Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15&#39;)"><span class="hl_varref"><span class="mpre">fromByteString</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;File not found&quot;</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_210_1_210_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_1_210_8&#39;)"><span class="hl_fundecl"><span class="mpre">sendRsp</span></span></a><span class="mpre"> </span><a name="loc_229_9_229_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_9_229_13&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_229_14_229_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_14_229_17&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a name="loc_229_18_229_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_18_229_19&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_229_20_229_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_20_229_22&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> (</span><a href="#loc_198_12_198_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_12_198_22&#39;)"><span class="hl_conref"><span class="mpre">RspBuilder</span></span></a><span class="mpre"> </span><a name="loc_229_35_229_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_35_229_39&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre"> </span><a name="loc_229_40_229_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_40_229_52&#39;)"><span class="hl_vardecl"><span class="mpre">needsChunked</span></span></a><span class="mpre">) = do
    </span><a name="loc_230_5_230_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_5_230_11&#39;)"><span class="hl_vardecl"><span class="mpre">header</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_405_1_405_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_21&#39;)"><span class="hl_varref"><span class="mpre">composeHeaderBuilder</span></span></a><span class="mpre"> </span><a href="#loc_229_14_229_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_14_229_17&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_229_18_229_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_18_229_19&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_229_20_229_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_20_229_22&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> </span><a href="#loc_229_40_229_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_40_229_52&#39;)"><span class="hl_varref"><span class="mpre">needsChunked</span></span></a><span class="mpre">
    let </span><a name="loc_231_9_231_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_9_231_15&#39;)"><span class="hl_vardecl"><span class="mpre">hdrBdy</span></span></a><span class="mpre">
         | </span><a href="#loc_229_40_229_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_40_229_52&#39;)"><span class="hl_varref"><span class="mpre">needsChunked</span></span></a><span class="mpre"> = </span><a href="#loc_230_5_230_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_5_230_11&#39;)"><span class="hl_varref"><span class="mpre">header</span></span></a><span class="mpre"> </span><a href="#loc_51_1_51_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_5&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.HTTP.html#loc_132_1_132_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.HTTP.html#loc_132_1_132_24&#39;)"><span class="hl_varref"><span class="mpre">chunkedTransferEncoding</span></span></a><span class="mpre"> </span><a href="#loc_229_35_229_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_35_229_39&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre">
                                 </span><a href="#loc_51_1_51_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_5&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.HTTP.html#loc_222_1_222_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.HTTP.html#loc_222_1_222_26&#39;)"><span class="hl_varref"><span class="mpre">chunkedTransferTerminator</span></span></a><span class="mpre">
         | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">    = </span><a href="#loc_230_5_230_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_5_230_11&#39;)"><span class="hl_varref"><span class="mpre">header</span></span></a><span class="mpre"> </span><a href="#loc_51_1_51_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_5&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><a href="#loc_229_35_229_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_35_229_39&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre">
        </span><a name="loc_235_9_235_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_9_235_15&#39;)"><span class="hl_vardecl"><span class="mpre">buffer</span></span></a><span class="mpre"> = </span><a href="Network.Wai.Handler.Warp.Types.html#loc_80_7_80_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_80_7_80_22&#39;)"><span class="hl_varref"><span class="mpre">connWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_229_9_229_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_9_229_13&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
        </span><a name="loc_236_9_236_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_236_9_236_13&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> = </span><a href="Network.Wai.Handler.Warp.Types.html#loc_81_7_81_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_81_7_81_21&#39;)"><span class="hl_varref"><span class="mpre">connBufferSize</span></span></a><span class="mpre"> </span><a href="#loc_229_9_229_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_9_229_13&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
    </span><a href="Network.Wai.Handler.Warp.IO.html#loc_12_1_12_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.IO.html#loc_12_1_12_12&#39;)"><span class="hl_varref"><span class="mpre">toBufIOWith</span></span></a><span class="mpre"> </span><a href="#loc_235_9_235_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_9_235_15&#39;)"><span class="hl_varref"><span class="mpre">buffer</span></span></a><span class="mpre"> </span><a href="#loc_236_9_236_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_236_9_236_13&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> (</span><a href="Network.Wai.Handler.Warp.Types.html#loc_75_7_75_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_75_7_75_18&#39;)"><span class="hl_varref"><span class="mpre">connSendAll</span></span></a><span class="mpre"> </span><a href="#loc_229_9_229_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_9_229_13&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">) </span><a href="#loc_231_9_231_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_9_231_15&#39;)"><span class="hl_varref"><span class="mpre">hdrBdy</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_210_1_210_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_1_210_8&#39;)"><span class="hl_fundecl"><span class="mpre">sendRsp</span></span></a><span class="mpre"> </span><a name="loc_241_9_241_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_9_241_13&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_241_14_241_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_14_241_17&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a name="loc_241_18_241_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_18_241_19&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_241_20_241_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_20_241_22&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> (</span><a href="#loc_199_12_199_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_12_199_21&#39;)"><span class="hl_conref"><span class="mpre">RspStream</span></span></a><span class="mpre"> </span><a name="loc_241_34_241_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_34_241_47&#39;)"><span class="hl_vardecl"><span class="mpre">withBodyFlush</span></span></a><span class="mpre"> </span><a name="loc_241_48_241_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_48_241_60&#39;)"><span class="hl_vardecl"><span class="mpre">needsChunked</span></span></a><span class="mpre"> </span><a name="loc_241_61_241_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_61_241_63&#39;)"><span class="hl_vardecl"><span class="mpre">th</span></span></a><span class="mpre">) = do
    </span><a name="loc_242_5_242_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_242_5_242_11&#39;)"><span class="hl_vardecl"><span class="mpre">header</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_405_1_405_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_21&#39;)"><span class="hl_varref"><span class="mpre">composeHeaderBuilder</span></span></a><span class="mpre"> </span><a href="#loc_241_14_241_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_14_241_17&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_241_18_241_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_18_241_19&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_241_20_241_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_20_241_22&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> </span><a href="#loc_241_48_241_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_48_241_60&#39;)"><span class="hl_varref"><span class="mpre">needsChunked</span></span></a><span class="mpre">
    (</span><a name="loc_243_6_243_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_6_243_10&#39;)"><span class="hl_vardecl"><span class="mpre">recv</span></span></a><span class="mpre">, </span><a name="loc_243_12_243_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_12_243_18&#39;)"><span class="hl_vardecl"><span class="mpre">finish</span></span></a><span class="mpre">) &lt;- </span><a href="Data.Streaming.Blaze.html#loc_64_1_64_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Streaming.Blaze.html#loc_64_1_64_13&#39;)"><span class="hl_varref"><span class="mpre">newBlazeRecv</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_175_1_175_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_175_1_175_20&#39;)"><span class="hl_varref"><span class="mpre">reuseBufferStrategy</span></span></a><span class="mpre">
                    </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Buffer.html#loc_23_1_23_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Buffer.html#loc_23_1_23_14&#39;)"><span class="hl_varref"><span class="mpre">toBlazeBuffer</span></span></a><span class="mpre"> (</span><a href="Network.Wai.Handler.Warp.Types.html#loc_80_7_80_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_80_7_80_22&#39;)"><span class="hl_varref"><span class="mpre">connWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_241_9_241_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_9_241_13&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">) (</span><a href="Network.Wai.Handler.Warp.Types.html#loc_81_7_81_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_81_7_81_21&#39;)"><span class="hl_varref"><span class="mpre">connBufferSize</span></span></a><span class="mpre"> </span><a href="#loc_241_9_241_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_9_241_13&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">)
    let </span><a name="loc_245_9_245_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_9_245_17&#39;)"><span class="hl_fundecl"><span class="mpre">addChunk</span></span></a><span class="mpre"> </span><a name="loc_245_18_245_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_18_245_25&#39;)"><span class="hl_vardecl"><span class="mpre">builder</span></span></a><span class="mpre"> = do
            </span><a name="loc_246_13_246_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_246_13_246_19&#39;)"><span class="hl_vardecl"><span class="mpre">popper</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_243_6_243_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_6_243_10&#39;)"><span class="hl_varref"><span class="mpre">recv</span></span></a><span class="mpre"> </span><a href="#loc_245_18_245_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_18_245_25&#39;)"><span class="hl_varref"><span class="mpre">builder</span></span></a><span class="mpre">
            let </span><a name="loc_247_17_247_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_17_247_21&#39;)"><span class="hl_vardecl"><span class="mpre">loop</span></span></a><span class="mpre"> = do
                    </span><a name="loc_248_21_248_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_21_248_23&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_246_13_246_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_246_13_246_19&#39;)"><span class="hl_varref"><span class="mpre">popper</span></span></a><span class="mpre">
                    </span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="hl_varref"><span class="mpre">unless</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_248_21_248_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_21_248_23&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
                        </span><a href="#loc_287_1_287_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_1_287_9&#39;)"><span class="hl_varref"><span class="mpre">connSink</span></span></a><span class="mpre"> </span><a href="#loc_241_9_241_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_9_241_13&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_241_61_241_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_61_241_63&#39;)"><span class="hl_varref"><span class="mpre">th</span></span></a><span class="mpre"> </span><a href="#loc_248_21_248_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_248_21_248_23&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
                        </span><a href="#loc_247_17_247_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_17_247_21&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre">
            </span><a href="#loc_247_17_247_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_17_247_21&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre">
        </span><a name="loc_253_9_253_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_9_253_18&#39;)"><span class="hl_vardecl"><span class="mpre">addChunk&#39;</span></span></a><span class="mpre">
            | </span><a href="#loc_241_48_241_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_48_241_60&#39;)"><span class="hl_varref"><span class="mpre">needsChunked</span></span></a><span class="mpre"> = </span><a href="#loc_245_9_245_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_9_245_17&#39;)"><span class="hl_varref"><span class="mpre">addChunk</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.HTTP.html#loc_132_1_132_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.HTTP.html#loc_132_1_132_24&#39;)"><span class="hl_varref"><span class="mpre">chunkedTransferEncoding</span></span></a><span class="mpre">
            | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="#loc_245_9_245_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_9_245_17&#39;)"><span class="hl_varref"><span class="mpre">addChunk</span></span></a><span class="mpre">
    </span><a href="#loc_245_9_245_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_9_245_17&#39;)"><span class="hl_varref"><span class="mpre">addChunk</span></span></a><span class="mpre"> </span><a href="#loc_242_5_242_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_242_5_242_11&#39;)"><span class="hl_varref"><span class="mpre">header</span></span></a><span class="mpre">
    </span><a href="#loc_241_34_241_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_34_241_47&#39;)"><span class="hl_varref"><span class="mpre">withBodyFlush</span></span></a><span class="mpre"> </span><a href="#loc_253_9_253_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_9_253_18&#39;)"><span class="hl_varref"><span class="mpre">addChunk&#39;</span></span></a><span class="mpre"> (</span><a href="#loc_253_9_253_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_9_253_18&#39;)"><span class="hl_varref"><span class="mpre">addChunk&#39;</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.html#loc_139_1_139_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_139_1_139_6&#39;)"><span class="hl_varref"><span class="mpre">flush</span></span></a><span class="mpre">)
    </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_241_48_241_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_48_241_60&#39;)"><span class="hl_varref"><span class="mpre">needsChunked</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_245_9_245_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_9_245_17&#39;)"><span class="hl_varref"><span class="mpre">addChunk</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.HTTP.html#loc_222_1_222_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.HTTP.html#loc_222_1_222_26&#39;)"><span class="hl_varref"><span class="mpre">chunkedTransferTerminator</span></span></a><span class="mpre">
    </span><a name="loc_259_5_259_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_5_259_8&#39;)"><span class="hl_vardecl"><span class="mpre">mbs</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_243_12_243_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_12_243_18&#39;)"><span class="hl_varref"><span class="mpre">finish</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">) (</span><a href="#loc_287_1_287_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_1_287_9&#39;)"><span class="hl_varref"><span class="mpre">connSink</span></span></a><span class="mpre"> </span><a href="#loc_241_9_241_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_9_241_13&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_241_61_241_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_61_241_63&#39;)"><span class="hl_varref"><span class="mpre">th</span></span></a><span class="mpre">) </span><a href="#loc_259_5_259_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_5_259_8&#39;)"><span class="hl_varref"><span class="mpre">mbs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_210_1_210_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_1_210_8&#39;)"><span class="hl_fundecl"><span class="mpre">sendRsp</span></span></a><span class="mpre"> </span><a name="loc_264_9_264_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_9_264_13&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> _ _ _ (</span><a href="#loc_200_12_200_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_12_200_18&#39;)"><span class="hl_conref"><span class="mpre">RspRaw</span></span></a><span class="mpre"> </span><a name="loc_264_28_264_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_28_264_35&#39;)"><span class="hl_vardecl"><span class="mpre">withApp</span></span></a><span class="mpre"> </span><a name="loc_264_36_264_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_36_264_39&#39;)"><span class="hl_vardecl"><span class="mpre">src</span></span></a><span class="mpre"> </span><a name="loc_264_40_264_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_40_264_46&#39;)"><span class="hl_vardecl"><span class="mpre">tickle</span></span></a><span class="mpre">) =
    </span><a href="#loc_264_28_264_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_28_264_35&#39;)"><span class="hl_varref"><span class="mpre">withApp</span></span></a><span class="mpre"> </span><a href="#loc_267_5_267_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_5_267_9&#39;)"><span class="hl_varref"><span class="mpre">recv</span></span></a><span class="mpre"> </span><a href="#loc_271_5_271_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_271_5_271_9&#39;)"><span class="hl_varref"><span class="mpre">send</span></span></a><span class="mpre">
  where
    </span><a name="loc_267_5_267_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_5_267_9&#39;)"><span class="hl_vardecl"><span class="mpre">recv</span></span></a><span class="mpre"> = do
        </span><a name="loc_268_9_268_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_268_9_268_11&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_264_36_264_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_36_264_39&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre">
        </span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="hl_varref"><span class="mpre">unless</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_268_9_268_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_268_9_268_11&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">) </span><a href="#loc_264_40_264_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_40_264_46&#39;)"><span class="hl_varref"><span class="mpre">tickle</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_268_9_268_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_268_9_268_11&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
    </span><a name="loc_271_5_271_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_271_5_271_9&#39;)"><span class="hl_fundecl"><span class="mpre">send</span></span></a><span class="mpre"> </span><a name="loc_271_10_271_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_271_10_271_12&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="Network.Wai.Handler.Warp.Types.html#loc_75_7_75_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_75_7_75_18&#39;)"><span class="hl_varref"><span class="mpre">connSendAll</span></span></a><span class="mpre"> </span><a href="#loc_264_9_264_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_9_264_13&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_271_10_271_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_271_10_271_12&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_264_40_264_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_40_264_46&#39;)"><span class="hl_varref"><span class="mpre">tickle</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_280_1_280_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_1_280_19&#39;)"><span class="mpre">sendResponseNoBody</span></a><span class="mpre"> :: </span><a href="Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre">
                   -&gt; </span><a href="Network.HTTP.Types.Version.html#loc_13_6_13_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Version.html#loc_13_6_13_17&#39;)"><span class="hl_tyconref"><span class="mpre">H.HttpVersion</span></span></a><span class="mpre">
                   -&gt; </span><a href="Network.HTTP.Types.Status.html#loc_114_6_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_114_6_114_12&#39;)"><span class="hl_tyconref"><span class="mpre">H.Status</span></span></a><span class="mpre">
                   -&gt; </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre">
                   -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_280_1_280_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_1_280_19&#39;)"><span class="hl_fundecl"><span class="mpre">sendResponseNoBody</span></span></a><span class="mpre"> </span><a name="loc_280_20_280_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_20_280_24&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_280_25_280_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_25_280_28&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a name="loc_280_29_280_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_29_280_30&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_280_31_280_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_31_280_33&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> = </span><a href="Network.Wai.Handler.Warp.ResponseHeader.html#loc_21_1_21_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.ResponseHeader.html#loc_21_1_21_14&#39;)"><span class="hl_varref"><span class="mpre">composeHeader</span></span></a><span class="mpre"> </span><a href="#loc_280_25_280_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_25_280_28&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_280_29_280_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_29_280_30&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_280_31_280_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_31_280_33&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Types.html#loc_75_7_75_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_75_7_75_18&#39;)"><span class="hl_varref"><span class="mpre">connSendAll</span></span></a><span class="mpre"> </span><a href="#loc_280_20_280_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_20_280_24&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Use &#39;connSendAll&#39; to send this data while respecting timeout rules.</span></span><span class="mpre">
</span><a href="#loc_287_1_287_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_1_287_9&#39;)"><span class="mpre">connSink</span></a><span class="mpre"> :: </span><a href="Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre"> -&gt; </span><a href="Network.Wai.Handler.Warp.Timeout.html#loc_70_6_70_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Timeout.html#loc_70_6_70_12&#39;)"><span class="hl_tyconref"><span class="mpre">T.Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_287_1_287_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_1_287_9&#39;)"><span class="hl_fundecl"><span class="mpre">connSink</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 287, srcSpanStartColumn = 10, srcSpanEndLine = 287, srcSpanEndColumn = 43}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Response.hs&quot;, srcSpanStartLine = 287, srcSpanStartColumn = 21, srcSpanEndLine = 287, srcSpanEndColumn = 22},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/"><span class="mpre">Connection { connSendAll = send }</span></span><span class="mpre"> </span><a name="loc_287_44_287_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_44_287_46&#39;)"><span class="hl_vardecl"><span class="mpre">th</span></span></a><span class="mpre"> </span><a name="loc_287_47_287_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_47_287_49&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = do
    </span><a href="Network.Wai.Handler.Warp.Timeout.html#loc_172_1_172_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Timeout.html#loc_172_1_172_7&#39;)"><span class="hl_varref"><span class="mpre">T.resume</span></span></a><span class="mpre"> </span><a href="#loc_287_44_287_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_44_287_46&#39;)"><span class="hl_varref"><span class="mpre">th</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">send</span></span><span class="mpre"> </span><a href="#loc_287_47_287_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_47_287_49&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
    </span><a href="Network.Wai.Handler.Warp.Timeout.html#loc_167_1_167_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Timeout.html#loc_167_1_167_6&#39;)"><span class="hl_varref"><span class="mpre">T.pause</span></span></a><span class="mpre"> </span><a href="#loc_287_44_287_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_44_287_46&#39;)"><span class="hl_varref"><span class="mpre">th</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- We pause timeouts before passing control back to user code. This ensures</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- that a timeout will only ever be executed when Warp is in control. We</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- also make sure to resume the timeout after the completion of user code</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- so that we can kill idle connections.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_300_1_300_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_300_1_300_16&#39;)"><span class="mpre">infoFromRequest</span></a><span class="mpre"> :: </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IndexedHeader</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- isPersist</span></span><span class="mpre">
                                               ,</span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">) </span><span class="hl_comment"><span class="mpre">-- isChunked</span></span><span class="mpre">
</span><a name="loc_300_1_300_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_300_1_300_16&#39;)"><span class="hl_fundecl"><span class="mpre">infoFromRequest</span></span></a><span class="mpre"> </span><a name="loc_300_17_300_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_300_17_300_20&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> </span><a name="loc_300_21_300_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_300_21_300_30&#39;)"><span class="hl_vardecl"><span class="mpre">reqidxhdr</span></span></a><span class="mpre"> = (</span><a href="#loc_303_1_303_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_303_1_303_13&#39;)"><span class="hl_varref"><span class="mpre">checkPersist</span></span></a><span class="mpre"> </span><a href="#loc_300_17_300_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_300_17_300_20&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><a href="#loc_300_21_300_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_300_21_300_30&#39;)"><span class="hl_varref"><span class="mpre">reqidxhdr</span></span></a><span class="mpre">, </span><a href="#loc_317_1_317_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_1_317_11&#39;)"><span class="hl_varref"><span class="mpre">checkChunk</span></span></a><span class="mpre"> </span><a href="#loc_300_17_300_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_300_17_300_20&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">)

</span><a href="#loc_303_1_303_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_303_1_303_13&#39;)"><span class="mpre">checkPersist</span></a><span class="mpre"> :: </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IndexedHeader</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_303_1_303_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_303_1_303_13&#39;)"><span class="hl_fundecl"><span class="mpre">checkPersist</span></span></a><span class="mpre"> </span><a name="loc_303_14_303_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_303_14_303_17&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> </span><a name="loc_303_18_303_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_303_18_303_27&#39;)"><span class="hl_vardecl"><span class="mpre">reqidxhdr</span></span></a><span class="mpre">
    | </span><a href="#loc_307_5_307_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_5_307_8&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="Network.HTTP.Types.Version.html#loc_33_1_33_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Version.html#loc_33_1_33_7&#39;)"><span class="hl_varref"><span class="mpre">H.http11</span></span></a><span class="mpre"> = </span><a href="#loc_309_5_309_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_5_309_19&#39;)"><span class="hl_varref"><span class="mpre">checkPersist11</span></span></a><span class="mpre"> </span><a href="#loc_308_5_308_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_308_5_308_9&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">       = </span><a href="#loc_312_5_312_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_5_312_19&#39;)"><span class="hl_varref"><span class="mpre">checkPersist10</span></span></a><span class="mpre"> </span><a href="#loc_308_5_308_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_308_5_308_9&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
  where
    </span><a name="loc_307_5_307_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_5_307_8&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> = </span><a href="Network.Wai.Internal.html#loc_24_6_24_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_24_6_24_17&#39;)"><span class="hl_varref"><span class="mpre">httpVersion</span></span></a><span class="mpre"> </span><a href="#loc_303_14_303_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_303_14_303_17&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">
    </span><a name="loc_308_5_308_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_308_5_308_9&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> = </span><a href="#loc_303_18_303_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_303_18_303_27&#39;)"><span class="hl_varref"><span class="mpre">reqidxhdr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Header.html#loc_25_1_25_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Header.html#loc_25_1_25_14&#39;)"><span class="hl_varref"><span class="mpre">idxConnection</span></span></a><span class="mpre">
    </span><a name="loc_309_5_309_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_5_309_19&#39;)"><span class="hl_fundecl"><span class="mpre">checkPersist11</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_309_26_309_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_26_309_27&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">)
        | </span><a href="Data.CaseInsensitive.Internal.html#loc_146_5_146_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.CaseInsensitive.Internal.html#loc_146_5_146_13&#39;)"><span class="hl_varref"><span class="mpre">CI.foldCase</span></span></a><span class="mpre"> </span><a href="#loc_309_26_309_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_26_309_27&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;close&quot;</span></span><span class="mpre">      = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
    </span><a href="#loc_309_5_309_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_5_309_19&#39;)"><span class="hl_fundecl"><span class="mpre">checkPersist11</span></span></a><span class="mpre"> _                    = </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
    </span><a name="loc_312_5_312_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_5_312_19&#39;)"><span class="hl_fundecl"><span class="mpre">checkPersist10</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_312_26_312_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_26_312_27&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">)
        | </span><a href="Data.CaseInsensitive.Internal.html#loc_146_5_146_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.CaseInsensitive.Internal.html#loc_146_5_146_13&#39;)"><span class="hl_varref"><span class="mpre">CI.foldCase</span></span></a><span class="mpre"> </span><a href="#loc_312_26_312_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_26_312_27&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;keep-alive&quot;</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
    </span><a href="#loc_312_5_312_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_5_312_19&#39;)"><span class="hl_fundecl"><span class="mpre">checkPersist10</span></span></a><span class="mpre"> _                    = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

</span><a href="#loc_317_1_317_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_1_317_11&#39;)"><span class="mpre">checkChunk</span></a><span class="mpre"> :: </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_317_1_317_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_1_317_11&#39;)"><span class="hl_fundecl"><span class="mpre">checkChunk</span></span></a><span class="mpre"> </span><a name="loc_317_12_317_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_12_317_15&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> = </span><a href="Network.Wai.Internal.html#loc_24_6_24_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_24_6_24_17&#39;)"><span class="hl_varref"><span class="mpre">httpVersion</span></span></a><span class="mpre"> </span><a href="#loc_317_12_317_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_12_317_15&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="Network.HTTP.Types.Version.html#loc_33_1_33_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Version.html#loc_33_1_33_7&#39;)"><span class="hl_varref"><span class="mpre">H.http11</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Used for ResponseBuilder and ResponseSource.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Don&#39;t use this for ResponseFile since this logic does not fit</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- for ResponseFile. For instance, isKeepAlive should be True in some cases</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- even if the response header does not have Content-Length.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Content-Length is specified by a reverse proxy.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that CGI does not specify Content-Length.</span></span><span class="mpre">
</span><a href="#loc_329_1_329_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_1_329_17&#39;)"><span class="mpre">infoFromResponse</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IndexedHeader</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">) -&gt; (</span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">)
</span><a name="loc_329_1_329_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_1_329_17&#39;)"><span class="hl_fundecl"><span class="mpre">infoFromResponse</span></span></a><span class="mpre"> </span><a name="loc_329_18_329_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_18_329_27&#39;)"><span class="hl_vardecl"><span class="mpre">rspidxhdr</span></span></a><span class="mpre"> (</span><a name="loc_329_29_329_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_29_329_38&#39;)"><span class="hl_vardecl"><span class="mpre">isPersist</span></span></a><span class="mpre">,</span><a name="loc_329_39_329_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_39_329_48&#39;)"><span class="hl_vardecl"><span class="mpre">isChunked</span></span></a><span class="mpre">) = (</span><a href="#loc_332_5_332_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_5_332_16&#39;)"><span class="hl_varref"><span class="mpre">isKeepAlive</span></span></a><span class="mpre">, </span><a href="#loc_331_5_331_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_331_5_331_17&#39;)"><span class="hl_varref"><span class="mpre">needsChunked</span></span></a><span class="mpre">)
  where
    </span><a name="loc_331_5_331_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_331_5_331_17&#39;)"><span class="hl_vardecl"><span class="mpre">needsChunked</span></span></a><span class="mpre"> = </span><a href="#loc_329_39_329_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_39_329_48&#39;)"><span class="hl_varref"><span class="mpre">isChunked</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><a href="#loc_333_5_333_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_333_5_333_14&#39;)"><span class="hl_varref"><span class="mpre">hasLength</span></span></a><span class="mpre">
    </span><a name="loc_332_5_332_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_5_332_16&#39;)"><span class="hl_vardecl"><span class="mpre">isKeepAlive</span></span></a><span class="mpre"> = </span><a href="#loc_329_29_329_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_29_329_38&#39;)"><span class="hl_varref"><span class="mpre">isPersist</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> (</span><a href="#loc_329_39_329_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_39_329_48&#39;)"><span class="hl_varref"><span class="mpre">isChunked</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><a href="#loc_333_5_333_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_333_5_333_14&#39;)"><span class="hl_varref"><span class="mpre">hasLength</span></span></a><span class="mpre">)
    </span><a name="loc_333_5_333_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_333_5_333_14&#39;)"><span class="hl_vardecl"><span class="mpre">hasLength</span></span></a><span class="mpre"> = </span><a href="Data.Maybe.html#loc_80_1_80_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_80_1_80_7&#39;)"><span class="hl_varref"><span class="mpre">isJust</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_329_18_329_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_18_329_27&#39;)"><span class="hl_varref"><span class="mpre">rspidxhdr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Header.html#loc_22_1_22_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Header.html#loc_22_1_22_17&#39;)"><span class="hl_varref"><span class="mpre">idxContentLength</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_338_1_338_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_1_338_8&#39;)"><span class="mpre">hasBody</span></a><span class="mpre"> :: </span><a href="Network.HTTP.Types.Status.html#loc_114_6_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_114_6_114_12&#39;)"><span class="hl_tyconref"><span class="mpre">H.Status</span></span></a><span class="mpre"> -&gt; </span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_338_1_338_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_1_338_8&#39;)"><span class="hl_fundecl"><span class="mpre">hasBody</span></span></a><span class="mpre"> </span><a name="loc_338_9_338_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_9_338_10&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_338_11_338_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_11_338_14&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> = </span><a href="#loc_343_5_343_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_5_343_7&#39;)"><span class="hl_varref"><span class="mpre">sc</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">204</span></span><span class="mpre">
             </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_343_5_343_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_5_343_7&#39;)"><span class="hl_varref"><span class="mpre">sc</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">304</span></span><span class="mpre">
             </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_343_5_343_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_5_343_7&#39;)"><span class="hl_varref"><span class="mpre">sc</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">200</span></span><span class="mpre">
             </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_344_5_344_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_5_344_11&#39;)"><span class="hl_varref"><span class="mpre">method</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="Network.HTTP.Types.Method.html#loc_32_1_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Method.html#loc_32_1_32_11&#39;)"><span class="hl_varref"><span class="mpre">H.methodHead</span></span></a><span class="mpre">
  where
    </span><a name="loc_343_5_343_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_5_343_7&#39;)"><span class="hl_vardecl"><span class="mpre">sc</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">H.statusCode</span></span><span class="mpre"> </span><a href="#loc_338_9_338_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_9_338_10&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
    </span><a name="loc_344_5_344_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_5_344_11&#39;)"><span class="hl_vardecl"><span class="mpre">method</span></span></a><span class="mpre"> = </span><a href="Network.Wai.Internal.html#loc_22_6_22_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_22_6_22_19&#39;)"><span class="hl_varref"><span class="mpre">requestMethod</span></span></a><span class="mpre"> </span><a href="#loc_338_11_338_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_11_338_14&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_349_1_349_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_1_349_16&#39;)"><span class="mpre">addAcceptRanges</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre">
</span><a name="loc_349_1_349_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_1_349_16&#39;)"><span class="hl_fundecl"><span class="mpre">addAcceptRanges</span></span></a><span class="mpre"> </span><a name="loc_349_17_349_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_17_349_21&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre"> = (</span><a href="Network.Wai.Handler.Warp.Types.html#loc_36_1_36_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_36_1_36_14&#39;)"><span class="hl_varref"><span class="mpre">hAcceptRanges</span></span></a><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;bytes&quot;</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_349_17_349_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_349_17_349_21&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">

</span><a href="#loc_352_1_352_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_1_352_20&#39;)"><span class="mpre">addTransferEncoding</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre">
</span><a name="loc_352_1_352_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_1_352_20&#39;)"><span class="hl_fundecl"><span class="mpre">addTransferEncoding</span></span></a><span class="mpre"> </span><a name="loc_352_21_352_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_21_352_25&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre"> = (</span><a href="Network.Wai.Handler.Warp.Types.html#loc_30_1_30_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_30_1_30_18&#39;)"><span class="hl_varref"><span class="mpre">hTransferEncoding</span></span></a><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;chunked&quot;</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_352_21_352_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_21_352_25&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">

</span><a href="#loc_355_1_355_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_355_1_355_17&#39;)"><span class="mpre">addContentLength</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre">
</span><a name="loc_355_1_355_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_355_1_355_17&#39;)"><span class="hl_fundecl"><span class="mpre">addContentLength</span></span></a><span class="mpre"> </span><a name="loc_355_18_355_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_355_18_355_20&#39;)"><span class="hl_vardecl"><span class="mpre">cl</span></span></a><span class="mpre"> </span><a name="loc_355_21_355_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_355_21_355_25&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre"> = (</span><a href="Network.HTTP.Types.Header.html#loc_69_1_69_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Header.html#loc_69_1_69_15&#39;)"><span class="hl_varref"><span class="mpre">H.hContentLength</span></span></a><span class="mpre">, </span><a href="#loc_357_5_357_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_5_357_8&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_355_21_355_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_355_21_355_25&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">
  where
    </span><a name="loc_357_5_357_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_5_357_8&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.pack</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_355_18_355_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_355_18_355_20&#39;)"><span class="hl_varref"><span class="mpre">cl</span></span></a><span class="mpre">

</span><a href="#loc_361_1_361_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_1_361_16&#39;)"><span class="mpre">addContentRange</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">
                -&gt; </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre">
</span><a name="loc_361_1_361_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_1_361_16&#39;)"><span class="hl_fundecl"><span class="mpre">addContentRange</span></span></a><span class="mpre"> </span><a name="loc_361_17_361_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_17_361_20&#39;)"><span class="hl_vardecl"><span class="mpre">beg</span></span></a><span class="mpre"> </span><a name="loc_361_21_361_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_21_361_24&#39;)"><span class="hl_vardecl"><span class="mpre">end</span></span></a><span class="mpre"> </span><a name="loc_361_25_361_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_25_361_30&#39;)"><span class="hl_vardecl"><span class="mpre">total</span></span></a><span class="mpre"> </span><a name="loc_361_31_361_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_31_361_35&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre"> = (</span><a href="Network.Wai.Handler.Warp.Types.html#loc_33_1_33_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_33_1_33_14&#39;)"><span class="hl_varref"><span class="mpre">hContentRange</span></span></a><span class="mpre">, </span><a href="#loc_363_5_363_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_363_5_363_10&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_361_31_361_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_31_361_35&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">
  where
    </span><a name="loc_363_5_363_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_363_5_363_10&#39;)"><span class="hl_vardecl"><span class="mpre">range</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.pack</span></span><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">-- building with ShowS</span></span><span class="mpre">
      </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;b&#39;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;y&#39;</span></span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;t&#39;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;e&#39;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;s&#39;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39; &#39;</span></span><span class="mpre">
      </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="Numeric.html#loc_130_1_130_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Numeric.html#loc_130_1_130_8&#39;)"><span class="hl_varref"><span class="mpre">showInt</span></span></a><span class="mpre"> </span><a href="#loc_361_17_361_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_17_361_20&#39;)"><span class="hl_varref"><span class="mpre">beg</span></span></a><span class="mpre">
      ( </span><span class="hl_char"><span class="mpre">&#39;-&#39;</span></span><span class="mpre">
      </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="Numeric.html#loc_130_1_130_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Numeric.html#loc_130_1_130_8&#39;)"><span class="hl_varref"><span class="mpre">showInt</span></span></a><span class="mpre"> </span><a href="#loc_361_21_361_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_21_361_24&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre">
      ( </span><span class="hl_char"><span class="mpre">&#39;/&#39;</span></span><span class="mpre">
      </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="Numeric.html#loc_130_1_130_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Numeric.html#loc_130_1_130_8&#39;)"><span class="hl_varref"><span class="mpre">showInt</span></span></a><span class="mpre"> </span><a href="#loc_361_25_361_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_25_361_30&#39;)"><span class="hl_varref"><span class="mpre">total</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">))

</span><a href="#loc_373_1_373_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_373_1_373_8&#39;)"><span class="mpre">addDate</span></a><span class="mpre"> :: </span><a href="Network.Wai.Handler.Warp.Date.html#loc_29_6_29_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Date.html#loc_29_6_29_15&#39;)"><span class="hl_tyconref"><span class="mpre">D.DateCache</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IndexedHeader</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre">
</span><a name="loc_373_1_373_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_373_1_373_8&#39;)"><span class="hl_fundecl"><span class="mpre">addDate</span></span></a><span class="mpre"> </span><a name="loc_373_9_373_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_373_9_373_11&#39;)"><span class="hl_vardecl"><span class="mpre">dc</span></span></a><span class="mpre"> </span><a name="loc_373_12_373_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_373_12_373_21&#39;)"><span class="hl_vardecl"><span class="mpre">rspidxhdr</span></span></a><span class="mpre"> </span><a name="loc_373_22_373_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_373_22_373_26&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre"> = case </span><a href="#loc_373_12_373_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_373_12_373_21&#39;)"><span class="hl_varref"><span class="mpre">rspidxhdr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Header.html#loc_55_1_55_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Header.html#loc_55_1_55_8&#39;)"><span class="hl_varref"><span class="mpre">idxDate</span></span></a><span class="mpre"> of
    </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; do
        </span><a name="loc_375_9_375_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_375_9_375_16&#39;)"><span class="hl_vardecl"><span class="mpre">gmtdate</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Wai.Handler.Warp.Date.html#loc_47_1_47_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Date.html#loc_47_1_47_8&#39;)"><span class="hl_varref"><span class="mpre">D.getDate</span></span></a><span class="mpre"> </span><a href="#loc_373_9_373_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_373_9_373_11&#39;)"><span class="hl_varref"><span class="mpre">dc</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> (</span><a href="Network.HTTP.Types.Header.html#loc_73_1_73_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Header.html#loc_73_1_73_6&#39;)"><span class="hl_varref"><span class="mpre">H.hDate</span></span></a><span class="mpre">, </span><a href="#loc_375_9_375_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_375_9_375_16&#39;)"><span class="hl_varref"><span class="mpre">gmtdate</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_373_22_373_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_373_22_373_26&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">
    </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> _ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_373_22_373_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_373_22_373_26&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | The version of Warp.</span></span><span class="mpre">
</span><a href="#loc_383_1_383_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_383_1_383_12&#39;)"><span class="mpre">warpVersion</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_383_1_383_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_383_1_383_12&#39;)"><span class="hl_vardecl"><span class="mpre">warpVersion</span></span></a><span class="mpre"> = </span><a href="Data.Version.html#loc_106_1_106_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Version.html#loc_106_1_106_12&#39;)"><span class="hl_varref"><span class="mpre">showVersion</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">Paths_warp.version</span></span><span class="mpre">

</span><a href="#loc_386_1_386_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_1_386_19&#39;)"><span class="mpre">defaultServerValue</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">HeaderValue</span></span><span class="mpre">
</span><a name="loc_386_1_386_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_1_386_19&#39;)"><span class="hl_vardecl"><span class="mpre">defaultServerValue</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.pack</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Warp/&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_383_1_383_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_383_1_383_12&#39;)"><span class="hl_varref"><span class="mpre">warpVersion</span></span></a><span class="mpre">

</span><a href="#loc_389_1_389_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_1_389_10&#39;)"><span class="mpre">addServer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IndexedHeader</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre">
</span><a name="loc_389_1_389_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_1_389_10&#39;)"><span class="hl_fundecl"><span class="mpre">addServer</span></span></a><span class="mpre"> </span><a name="loc_389_11_389_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_11_389_20&#39;)"><span class="hl_vardecl"><span class="mpre">rspidxhdr</span></span></a><span class="mpre"> </span><a name="loc_389_21_389_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_21_389_25&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre"> = case </span><a href="#loc_389_11_389_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_11_389_20&#39;)"><span class="hl_varref"><span class="mpre">rspidxhdr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Header.html#loc_54_1_54_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Header.html#loc_54_1_54_10&#39;)"><span class="hl_varref"><span class="mpre">idxServer</span></span></a><span class="mpre"> of
    </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; (</span><a href="Network.Wai.Handler.Warp.Types.html#loc_39_1_39_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_39_1_39_8&#39;)"><span class="hl_varref"><span class="mpre">hServer</span></span></a><span class="mpre">, </span><a href="#loc_386_1_386_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_1_386_19&#39;)"><span class="hl_varref"><span class="mpre">defaultServerValue</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_389_21_389_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_21_389_25&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">
    _       -&gt; </span><a href="#loc_389_21_389_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_21_389_25&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;&gt;&gt; replaceHeader &quot;Content-Type&quot; &quot;new&quot; [(&quot;content-type&quot;,&quot;old&quot;)]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [(&quot;Content-Type&quot;,&quot;new&quot;)]</span></span><span class="mpre">
</span><a href="#loc_400_1_400_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_1_400_14&#39;)"><span class="mpre">replaceHeader</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">H.HeaderName</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">HeaderValue</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre">
</span><a name="loc_400_1_400_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_1_400_14&#39;)"><span class="hl_fundecl"><span class="mpre">replaceHeader</span></span></a><span class="mpre"> </span><a name="loc_400_15_400_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_15_400_16&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> </span><a name="loc_400_17_400_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_17_400_18&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> </span><a name="loc_400_19_400_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_19_400_23&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre"> = (</span><a href="#loc_400_15_400_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_15_400_16&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">,</span><a href="#loc_400_17_400_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_17_400_18&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="Data.List.html#loc_365_1_365_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_365_1_365_9&#39;)"><span class="hl_varref"><span class="mpre">deleteBy</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">(==)</span></span><span class="mpre"> </span><a href="Data.Function.html#loc_87_7_87_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Function.html#loc_87_7_87_11&#39;)"><span class="hl_infix"><span class="mpre">`on`</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fst</span></span><span class="mpre">) (</span><a href="#loc_400_15_400_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_15_400_16&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">,</span><a href="#loc_400_17_400_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_17_400_18&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">) </span><a href="#loc_400_19_400_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_19_400_23&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_405_1_405_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_21&#39;)"><span class="mpre">composeHeaderBuilder</span></a><span class="mpre"> :: </span><a href="Network.HTTP.Types.Version.html#loc_13_6_13_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Version.html#loc_13_6_13_17&#39;)"><span class="hl_tyconref"><span class="mpre">H.HttpVersion</span></span></a><span class="mpre"> -&gt; </span><a href="Network.HTTP.Types.Status.html#loc_114_6_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_114_6_114_12&#39;)"><span class="hl_tyconref"><span class="mpre">H.Status</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">H.ResponseHeaders</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_405_1_405_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_21&#39;)"><span class="hl_fundecl"><span class="mpre">composeHeaderBuilder</span></span></a><span class="mpre"> </span><a name="loc_405_22_405_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_22_405_25&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a name="loc_405_26_405_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_26_405_27&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_405_28_405_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_28_405_30&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> =
    </span><a href="Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15&#39;)"><span class="hl_varref"><span class="mpre">fromByteString</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.ResponseHeader.html#loc_21_1_21_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.ResponseHeader.html#loc_21_1_21_14&#39;)"><span class="hl_varref"><span class="mpre">composeHeader</span></span></a><span class="mpre"> </span><a href="#loc_405_22_405_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_22_405_25&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_405_26_405_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_26_405_27&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> (</span><a href="#loc_352_1_352_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_1_352_20&#39;)"><span class="hl_varref"><span class="mpre">addTransferEncoding</span></span></a><span class="mpre"> </span><a href="#loc_405_28_405_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_28_405_30&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">)
</span><a href="#loc_405_1_405_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_1_405_21&#39;)"><span class="hl_fundecl"><span class="mpre">composeHeaderBuilder</span></span></a><span class="mpre"> </span><a name="loc_407_22_407_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_407_22_407_25&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a name="loc_407_26_407_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_407_26_407_27&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_407_28_407_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_407_28_407_30&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> =
    </span><a href="Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15&#39;)"><span class="hl_varref"><span class="mpre">fromByteString</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.ResponseHeader.html#loc_21_1_21_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.ResponseHeader.html#loc_21_1_21_14&#39;)"><span class="hl_varref"><span class="mpre">composeHeader</span></span></a><span class="mpre"> </span><a href="#loc_407_22_407_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_407_22_407_25&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_407_26_407_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_407_26_407_27&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_407_28_407_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_407_28_407_30&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">
</span></div></body></html>