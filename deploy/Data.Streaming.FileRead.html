<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE CPP #-}
</span><span class="hl_comment"><span class="mpre">-- | The standard @openFile@ call on Windows causing problematic file locking</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in some cases. This module provides a cross-platform file reading API</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- without the file locking problems on Windows.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This module /always/ opens files in binary mode.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @readChunk@ will return an empty @ByteString@ on EOF.</span></span><span class="mpre">
module Data.Streaming.FileRead
    ( ReadHandle
    , openFile
    , closeFile
    , readChunk
    ) where

#if WINDOWS

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/streaming-commons-0.1.3/Data/Streaming/FileRead.hs&quot;, srcSpanStartLine = 18, srcSpanStartColumn = 8, srcSpanEndLine = 18, srcSpanEndColumn = 24}, srcInfoPoints = []}) &quot;System.Win32File&quot;"><span class="mpre">System.Win32File</span></span><span class="mpre">

#else

import qualified System.IO as IO
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/streaming-commons-0.1.3/Data/Streaming/FileRead.hs&quot;, srcSpanStartLine = 23, srcSpanStartColumn = 18, srcSpanEndLine = 23, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as S
import Data.ByteString.Lazy.Internal (</span><a href="Data.ByteString.Lazy.Internal.html#loc_208_1_208_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_208_1_208_17&#39;)"><span class="mpre">defaultChunkSize</span></a><span class="mpre">)

newtype </span><a name="loc_26_9_26_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_9_26_19&#39;)"><span class="hl_tycondecl"><span class="mpre">ReadHandle</span></span></a><span class="mpre"> = </span><a name="loc_26_22_26_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_22_26_32&#39;)"><span class="hl_condecl"><span class="mpre">ReadHandle</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">IO.Handle</span></span></a><span class="mpre">

</span><a href="#loc_29_1_29_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_1_29_9&#39;)"><span class="mpre">openFile</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_26_9_26_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_9_26_19&#39;)"><span class="hl_tyconref"><span class="mpre">ReadHandle</span></span></a><span class="mpre">
</span><a name="loc_29_1_29_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_1_29_9&#39;)"><span class="hl_fundecl"><span class="mpre">openFile</span></span></a><span class="mpre"> </span><a name="loc_29_10_29_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_10_29_12&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> = </span><a href="#loc_26_22_26_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_22_26_32&#39;)"><span class="hl_conref"><span class="mpre">ReadHandle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.FD.html#loc_177_1_177_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.FD.html#loc_177_1_177_15&#39;)"><span class="hl_varref"><span class="mpre">IO.openBinaryFile</span></span></a><span class="mpre"> </span><a href="#loc_29_10_29_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_10_29_12&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a href="GHC.IO.IOMode.html#loc_28_21_28_29" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.IOMode.html#loc_28_21_28_29&#39;)"><span class="hl_conref"><span class="mpre">IO.ReadMode</span></span></a><span class="mpre">

</span><a href="#loc_32_1_32_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_1_32_10&#39;)"><span class="mpre">closeFile</span></a><span class="mpre"> :: </span><a href="#loc_26_9_26_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_9_26_19&#39;)"><span class="hl_tyconref"><span class="mpre">ReadHandle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_32_1_32_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_1_32_10&#39;)"><span class="hl_fundecl"><span class="mpre">closeFile</span></span></a><span class="mpre"> (</span><a href="#loc_26_22_26_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_22_26_32&#39;)"><span class="hl_conref"><span class="mpre">ReadHandle</span></span></a><span class="mpre"> </span><a name="loc_32_23_32_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_23_32_24&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre">) = </span><a href="GHC.IO.Handle.html#loc_86_1_86_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_86_1_86_7&#39;)"><span class="hl_varref"><span class="mpre">IO.hClose</span></span></a><span class="mpre"> </span><a href="#loc_32_23_32_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_23_32_24&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">

</span><a href="#loc_35_1_35_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_1_35_10&#39;)"><span class="mpre">readChunk</span></a><span class="mpre"> :: </span><a href="#loc_26_9_26_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_9_26_19&#39;)"><span class="hl_tyconref"><span class="mpre">ReadHandle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">S.ByteString</span></span><span class="mpre">
</span><a name="loc_35_1_35_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_1_35_10&#39;)"><span class="hl_fundecl"><span class="mpre">readChunk</span></span></a><span class="mpre"> (</span><a href="#loc_26_22_26_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_22_26_32&#39;)"><span class="hl_conref"><span class="mpre">ReadHandle</span></span></a><span class="mpre"> </span><a name="loc_35_23_35_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_23_35_24&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">S.hGetSome</span></span><span class="mpre"> </span><a href="#loc_35_23_35_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_23_35_24&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="Data.ByteString.Lazy.Internal.html#loc_208_1_208_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_208_1_208_17&#39;)"><span class="hl_varref"><span class="mpre">defaultChunkSize</span></span></a><span class="mpre">

#endif
</span></div></body></html>