<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE MagicHash, UnboxedTuples, DeriveDataTypeable #-}

</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Data.Primitive.MutVar</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   : (c) Justin Bonnar 2011, Roman Leshchinskiy 2011-2012</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Roman Leshchinskiy &lt;rl@cse.unsw.edu.au&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : non-portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Primitive boxed mutable variables</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">

module Data.Primitive.MutVar (
  MutVar(..),

  newMutVar,
  readMutVar,
  writeMutVar,

  atomicModifyMutVar,
  atomicModifyMutVar&#39;,
  modifyMutVar,
  modifyMutVar&#39;
) where

import Control.Monad.Primitive ( </span><a href="Control.Monad.Primitive.html#loc_32_18_32_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Primitive.html#loc_32_18_32_27&#39;)"><span class="mpre">PrimMonad</span></a><span class="mpre">(..), </span><a href="Control.Monad.Primitive.html#loc_47_1_47_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Primitive.html#loc_47_1_47_11&#39;)"><span class="mpre">primitive_</span></a><span class="mpre"> )
import GHC.Prim ( </span><a href="GHC.Prim.html#loc_2483_6_2483_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2483_6_2483_13&#39;)"><span class="mpre">MutVar#</span></a><span class="mpre">, </span><a href="GHC.Prim.html#loc_2501_1_2501_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2501_1_2501_12&#39;)"><span class="mpre">sameMutVar#</span></a><span class="mpre">, </span><a href="GHC.Prim.html#loc_2488_1_2488_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2488_1_2488_11&#39;)"><span class="mpre">newMutVar#</span></a><span class="mpre">,
                  </span><a href="GHC.Prim.html#loc_2493_1_2493_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2493_1_2493_12&#39;)"><span class="mpre">readMutVar#</span></a><span class="mpre">, </span><a href="GHC.Prim.html#loc_2498_1_2498_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2498_1_2498_13&#39;)"><span class="mpre">writeMutVar#</span></a><span class="mpre">, </span><a href="GHC.Prim.html#loc_2504_1_2504_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2504_1_2504_20&#39;)"><span class="mpre">atomicModifyMutVar#</span></a><span class="mpre"> )
import Data.Primitive.Internal.Compat ( </span><a href="Data.Primitive.Internal.Compat.html#loc_37_1_37_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Primitive.Internal.Compat.html#loc_37_1_37_8&#39;)"><span class="mpre">isTrue#</span></a><span class="mpre"> )
import Data.Typeable ( </span><a href="Data.Typeable.Internal.html#loc_196_7_196_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Typeable.Internal.html#loc_196_7_196_15&#39;)"><span class="mpre">Typeable</span></a><span class="mpre"> )

</span><span class="hl_comment"><span class="mpre">-- | A &#39;MutVar&#39; behaves like a single-element mutable array associated</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- with a primitive state token.</span></span><span class="mpre">
data </span><a name="loc_35_6_35_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_6_35_12&#39;)"><span class="hl_tycondecl"><span class="mpre">MutVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_35_19_35_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_19_35_25&#39;)"><span class="hl_condecl"><span class="mpre">MutVar</span></span></a><span class="mpre"> (</span><a href="GHC.Prim.html#loc_2483_6_2483_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2483_6_2483_13&#39;)"><span class="hl_tyconref"><span class="mpre">MutVar#</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
  </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.hs&quot;, srcSpanStartLine = 36, srcSpanStartColumn = 3, srcSpanEndLine = 36, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.hs&quot;, srcSpanStartLine = 36, srcSpanStartColumn = 3, srcSpanEndLine = 36, srcSpanEndColumn = 11},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.h"><span class="mpre">deriving ( Typeable )</span></span><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Eq</span></span><span class="mpre"> (</span><a href="#loc_35_6_35_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_6_35_12&#39;)"><span class="hl_tyconref"><span class="mpre">MutVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) where
  </span><a href="#loc_35_19_35_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_19_35_25&#39;)"><span class="hl_conref"><span class="mpre">MutVar</span></span></a><span class="mpre"> </span><a name="loc_39_10_39_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_10_39_14&#39;)"><span class="hl_vardecl"><span class="mpre">mva#</span></span></a><span class="mpre"> </span><span class="hl_fundecl"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_35_19_35_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_19_35_25&#39;)"><span class="hl_conref"><span class="mpre">MutVar</span></span></a><span class="mpre"> </span><a name="loc_39_25_39_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_25_39_29&#39;)"><span class="hl_vardecl"><span class="mpre">mvb#</span></span></a><span class="mpre"> = </span><a href="Data.Primitive.Internal.Compat.html#loc_37_1_37_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Primitive.Internal.Compat.html#loc_37_1_37_8&#39;)"><span class="hl_varref"><span class="mpre">isTrue#</span></span></a><span class="mpre"> (</span><a href="GHC.Prim.html#loc_2501_1_2501_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2501_1_2501_12&#39;)"><span class="hl_varref"><span class="mpre">sameMutVar#</span></span></a><span class="mpre"> </span><a href="#loc_39_10_39_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_10_39_14&#39;)"><span class="hl_varref"><span class="mpre">mva#</span></span></a><span class="mpre"> </span><a href="#loc_39_25_39_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_25_39_29&#39;)"><span class="hl_varref"><span class="mpre">mvb#</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Create a new &#39;MutVar&#39; with the specified initial value</span></span><span class="mpre">
</span><a href="#loc_44_1_44_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_10&#39;)"><span class="mpre">newMutVar</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.hs&quot;, srcSpanStartLine = 42, srcSpanStartColumn = 14, srcSpanEndLine = 42, srcSpanEndColumn = 28}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.hs&quot;, srcSpanStartLine = 42, srcSpanStartColumn = 26, srcSpanEndLine = 42, srcSpanEndColumn = 28}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/"><span class="mpre">PrimMonad m =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> (</span><a href="#loc_35_6_35_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_6_35_12&#39;)"><span class="hl_tyconref"><span class="mpre">MutVar</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">PrimState</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_44_1_44_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_10&#39;)"><span class="mpre">newMutVar</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a name="loc_44_1_44_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_10&#39;)"><span class="hl_fundecl"><span class="mpre">newMutVar</span></span></a><span class="mpre"> </span><a name="loc_44_11_44_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_11_44_23&#39;)"><span class="hl_vardecl"><span class="mpre">initialValue</span></span></a><span class="mpre"> = </span><a href="Control.Monad.Primitive.html#loc_37_3_37_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Primitive.html#loc_37_3_37_12&#39;)"><span class="hl_varref"><span class="mpre">primitive</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_44_39_44_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_39_44_41&#39;)"><span class="hl_vardecl"><span class="mpre">s#</span></span></a><span class="mpre"> -&gt;
  case </span><a href="GHC.Prim.html#loc_2488_1_2488_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2488_1_2488_11&#39;)"><span class="hl_varref"><span class="mpre">newMutVar#</span></span></a><span class="mpre"> </span><a href="#loc_44_11_44_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_11_44_23&#39;)"><span class="hl_varref"><span class="mpre">initialValue</span></span></a><span class="mpre"> </span><a href="#loc_44_39_44_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_39_44_41&#39;)"><span class="hl_varref"><span class="mpre">s#</span></span></a><span class="mpre"> of
    (# </span><a name="loc_46_8_46_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_8_46_11&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;#</span></span></a><span class="mpre">, </span><a name="loc_46_13_46_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_13_46_16&#39;)"><span class="hl_vardecl"><span class="mpre">mv#</span></span></a><span class="mpre"> #) -&gt; (# </span><a href="#loc_46_8_46_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_8_46_11&#39;)"><span class="hl_varref"><span class="mpre">s&#39;#</span></span></a><span class="mpre">, </span><a href="#loc_35_19_35_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_19_35_25&#39;)"><span class="hl_conref"><span class="mpre">MutVar</span></span></a><span class="mpre"> </span><a href="#loc_46_13_46_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_13_46_16&#39;)"><span class="hl_varref"><span class="mpre">mv#</span></span></a><span class="mpre"> #)

</span><span class="hl_comment"><span class="mpre">-- | Read the value of a &#39;MutVar&#39;</span></span><span class="mpre">
</span><a href="#loc_51_1_51_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_11&#39;)"><span class="mpre">readMutVar</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.hs&quot;, srcSpanStartLine = 49, srcSpanStartColumn = 15, srcSpanEndLine = 49, srcSpanEndColumn = 29}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.hs&quot;, srcSpanStartLine = 49, srcSpanStartColumn = 27, srcSpanEndLine = 49, srcSpanEndColumn = 29}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/"><span class="mpre">PrimMonad m =&gt;</span></span><span class="mpre"> </span><a href="#loc_35_6_35_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_6_35_12&#39;)"><span class="hl_tyconref"><span class="mpre">MutVar</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">PrimState</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_51_1_51_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_11&#39;)"><span class="mpre">readMutVar</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a name="loc_51_1_51_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_11&#39;)"><span class="hl_fundecl"><span class="mpre">readMutVar</span></span></a><span class="mpre"> (</span><a href="#loc_35_19_35_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_19_35_25&#39;)"><span class="hl_conref"><span class="mpre">MutVar</span></span></a><span class="mpre"> </span><a name="loc_51_20_51_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_20_51_23&#39;)"><span class="hl_vardecl"><span class="mpre">mv#</span></span></a><span class="mpre">) = </span><a href="Control.Monad.Primitive.html#loc_37_3_37_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Primitive.html#loc_37_3_37_12&#39;)"><span class="hl_varref"><span class="mpre">primitive</span></span></a><span class="mpre"> (</span><a href="GHC.Prim.html#loc_2493_1_2493_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2493_1_2493_12&#39;)"><span class="hl_varref"><span class="mpre">readMutVar#</span></span></a><span class="mpre"> </span><a href="#loc_51_20_51_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_20_51_23&#39;)"><span class="hl_varref"><span class="mpre">mv#</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Write a new value into a &#39;MutVar&#39;</span></span><span class="mpre">
</span><a href="#loc_56_1_56_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_12&#39;)"><span class="mpre">writeMutVar</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 16, srcSpanEndLine = 54, srcSpanEndColumn = 30}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 28, srcSpanEndLine = 54, srcSpanEndColumn = 30}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/"><span class="mpre">PrimMonad m =&gt;</span></span><span class="mpre"> </span><a href="#loc_35_6_35_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_6_35_12&#39;)"><span class="hl_tyconref"><span class="mpre">MutVar</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">PrimState</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_56_1_56_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_12&#39;)"><span class="mpre">writeMutVar</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a name="loc_56_1_56_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_12&#39;)"><span class="hl_fundecl"><span class="mpre">writeMutVar</span></span></a><span class="mpre"> (</span><a href="#loc_35_19_35_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_19_35_25&#39;)"><span class="hl_conref"><span class="mpre">MutVar</span></span></a><span class="mpre"> </span><a name="loc_56_21_56_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_21_56_24&#39;)"><span class="hl_vardecl"><span class="mpre">mv#</span></span></a><span class="mpre">) </span><a name="loc_56_26_56_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_26_56_34&#39;)"><span class="hl_vardecl"><span class="mpre">newValue</span></span></a><span class="mpre"> = </span><a href="Control.Monad.Primitive.html#loc_47_1_47_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Primitive.html#loc_47_1_47_11&#39;)"><span class="hl_varref"><span class="mpre">primitive_</span></span></a><span class="mpre"> (</span><a href="GHC.Prim.html#loc_2498_1_2498_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2498_1_2498_13&#39;)"><span class="hl_varref"><span class="mpre">writeMutVar#</span></span></a><span class="mpre"> </span><a href="#loc_56_21_56_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_21_56_24&#39;)"><span class="hl_varref"><span class="mpre">mv#</span></span></a><span class="mpre"> </span><a href="#loc_56_26_56_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_26_56_34&#39;)"><span class="hl_varref"><span class="mpre">newValue</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Atomically mutate the contents of a &#39;MutVar&#39;</span></span><span class="mpre">
</span><a href="#loc_61_1_61_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_19&#39;)"><span class="mpre">atomicModifyMutVar</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.hs&quot;, srcSpanStartLine = 59, srcSpanStartColumn = 23, srcSpanEndLine = 59, srcSpanEndColumn = 37}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.hs&quot;, srcSpanStartLine = 59, srcSpanStartColumn = 35, srcSpanEndLine = 59, srcSpanEndColumn = 37}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/"><span class="mpre">PrimMonad m =&gt;</span></span><span class="mpre"> </span><a href="#loc_35_6_35_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_6_35_12&#39;)"><span class="hl_tyconref"><span class="mpre">MutVar</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">PrimState</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">,</span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_61_1_61_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_19&#39;)"><span class="mpre">atomicModifyMutVar</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a name="loc_61_1_61_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_19&#39;)"><span class="hl_fundecl"><span class="mpre">atomicModifyMutVar</span></span></a><span class="mpre"> (</span><a href="#loc_35_19_35_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_19_35_25&#39;)"><span class="hl_conref"><span class="mpre">MutVar</span></span></a><span class="mpre"> </span><a name="loc_61_28_61_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_28_61_31&#39;)"><span class="hl_vardecl"><span class="mpre">mv#</span></span></a><span class="mpre">) </span><a name="loc_61_33_61_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_33_61_34&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="Control.Monad.Primitive.html#loc_37_3_37_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Primitive.html#loc_37_3_37_12&#39;)"><span class="hl_varref"><span class="mpre">primitive</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.Prim.html#loc_2504_1_2504_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2504_1_2504_20&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyMutVar#</span></span></a><span class="mpre"> </span><a href="#loc_61_28_61_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_28_61_31&#39;)"><span class="hl_varref"><span class="mpre">mv#</span></span></a><span class="mpre"> </span><a href="#loc_61_33_61_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_33_61_34&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Strict version of &#39;atomicModifyMutVar&#39;. This forces both the value stored</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in the &#39;MutVar&#39; as well as the value returned.</span></span><span class="mpre">
</span><a href="#loc_67_1_67_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_20&#39;)"><span class="mpre">atomicModifyMutVar&#39;</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 24, srcSpanEndLine = 65, srcSpanEndColumn = 38}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 36, srcSpanEndLine = 65, srcSpanEndColumn = 38}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/"><span class="mpre">PrimMonad m =&gt;</span></span><span class="mpre"> </span><a href="#loc_35_6_35_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_6_35_12&#39;)"><span class="hl_tyconref"><span class="mpre">MutVar</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">PrimState</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_67_1_67_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_20&#39;)"><span class="mpre">atomicModifyMutVar&#39;</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a name="loc_67_1_67_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_20&#39;)"><span class="hl_fundecl"><span class="mpre">atomicModifyMutVar&#39;</span></span></a><span class="mpre"> </span><a name="loc_67_21_67_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_21_67_23&#39;)"><span class="hl_vardecl"><span class="mpre">mv</span></span></a><span class="mpre"> </span><a name="loc_67_24_67_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_24_67_25&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = do
  </span><a name="loc_68_3_68_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_3_68_4&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_61_1_61_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_19&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyMutVar</span></span></a><span class="mpre"> </span><a href="#loc_67_21_67_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_21_67_23&#39;)"><span class="hl_varref"><span class="mpre">mv</span></span></a><span class="mpre"> </span><a href="#loc_71_5_71_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_5_71_10&#39;)"><span class="hl_varref"><span class="mpre">force</span></span></a><span class="mpre">
  </span><a href="#loc_68_3_68_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_3_68_4&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`seq`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_68_3_68_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_3_68_4&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
  where
    </span><a name="loc_71_5_71_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_5_71_10&#39;)"><span class="hl_fundecl"><span class="mpre">force</span></span></a><span class="mpre"> </span><a name="loc_71_11_71_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_12&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = let (</span><a name="loc_71_20_71_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_20_71_21&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">, </span><a name="loc_71_23_71_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_23_71_24&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">) = </span><a href="#loc_67_24_67_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_24_67_25&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_71_11_71_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_12&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> in (</span><a href="#loc_71_20_71_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_20_71_21&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">, </span><a href="#loc_71_20_71_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_20_71_21&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`seq`</span></span><span class="mpre"> </span><a href="#loc_71_23_71_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_23_71_24&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Mutate the contents of a &#39;MutVar&#39;</span></span><span class="mpre">
</span><a href="#loc_76_1_76_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_13&#39;)"><span class="mpre">modifyMutVar</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.hs&quot;, srcSpanStartLine = 74, srcSpanStartColumn = 17, srcSpanEndLine = 74, srcSpanEndColumn = 31}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.hs&quot;, srcSpanStartLine = 74, srcSpanStartColumn = 29, srcSpanEndLine = 74, srcSpanEndColumn = 31}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/"><span class="mpre">PrimMonad m =&gt;</span></span><span class="mpre"> </span><a href="#loc_35_6_35_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_6_35_12&#39;)"><span class="hl_tyconref"><span class="mpre">MutVar</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">PrimState</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_76_1_76_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_13&#39;)"><span class="mpre">modifyMutVar</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a name="loc_76_1_76_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_13&#39;)"><span class="hl_fundecl"><span class="mpre">modifyMutVar</span></span></a><span class="mpre"> (</span><a href="#loc_35_19_35_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_19_35_25&#39;)"><span class="hl_conref"><span class="mpre">MutVar</span></span></a><span class="mpre"> </span><a name="loc_76_22_76_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_22_76_25&#39;)"><span class="hl_vardecl"><span class="mpre">mv#</span></span></a><span class="mpre">) </span><a name="loc_76_27_76_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_27_76_28&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre"> = </span><a href="Control.Monad.Primitive.html#loc_47_1_47_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Primitive.html#loc_47_1_47_11&#39;)"><span class="hl_varref"><span class="mpre">primitive_</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_76_45_76_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_45_76_47&#39;)"><span class="hl_vardecl"><span class="mpre">s#</span></span></a><span class="mpre"> -&gt;
  case </span><a href="GHC.Prim.html#loc_2493_1_2493_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2493_1_2493_12&#39;)"><span class="hl_varref"><span class="mpre">readMutVar#</span></span></a><span class="mpre"> </span><a href="#loc_76_22_76_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_22_76_25&#39;)"><span class="hl_varref"><span class="mpre">mv#</span></span></a><span class="mpre"> </span><a href="#loc_76_45_76_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_45_76_47&#39;)"><span class="hl_varref"><span class="mpre">s#</span></span></a><span class="mpre"> of
    (# </span><a name="loc_78_8_78_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_8_78_11&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;#</span></span></a><span class="mpre">, </span><a name="loc_78_13_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_13_78_14&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> #) -&gt; </span><a href="GHC.Prim.html#loc_2498_1_2498_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2498_1_2498_13&#39;)"><span class="hl_varref"><span class="mpre">writeMutVar#</span></span></a><span class="mpre"> </span><a href="#loc_76_22_76_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_22_76_25&#39;)"><span class="hl_varref"><span class="mpre">mv#</span></span></a><span class="mpre"> (</span><a href="#loc_76_27_76_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_27_76_28&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre"> </span><a href="#loc_78_13_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_13_78_14&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">) </span><a href="#loc_78_8_78_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_8_78_11&#39;)"><span class="hl_varref"><span class="mpre">s&#39;#</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Strict version of &#39;modifyMutVar&#39;</span></span><span class="mpre">
</span><a href="#loc_83_1_83_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_14&#39;)"><span class="mpre">modifyMutVar&#39;</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.hs&quot;, srcSpanStartLine = 81, srcSpanStartColumn = 18, srcSpanEndLine = 81, srcSpanEndColumn = 32}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/primitive-0.5.3.0/Data/Primitive/MutVar.hs&quot;, srcSpanStartLine = 81, srcSpanStartColumn = 30, srcSpanEndLine = 81, srcSpanEndColumn = 32}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/"><span class="mpre">PrimMonad m =&gt;</span></span><span class="mpre"> </span><a href="#loc_35_6_35_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_6_35_12&#39;)"><span class="hl_tyconref"><span class="mpre">MutVar</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">PrimState</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_83_1_83_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_14&#39;)"><span class="mpre">modifyMutVar&#39;</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a name="loc_83_1_83_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_14&#39;)"><span class="hl_fundecl"><span class="mpre">modifyMutVar&#39;</span></span></a><span class="mpre"> (</span><a href="#loc_35_19_35_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_19_35_25&#39;)"><span class="hl_conref"><span class="mpre">MutVar</span></span></a><span class="mpre"> </span><a name="loc_83_23_83_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_23_83_26&#39;)"><span class="hl_vardecl"><span class="mpre">mv#</span></span></a><span class="mpre">) </span><a name="loc_83_28_83_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_28_83_29&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre"> = </span><a href="Control.Monad.Primitive.html#loc_47_1_47_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Primitive.html#loc_47_1_47_11&#39;)"><span class="hl_varref"><span class="mpre">primitive_</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_83_46_83_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_46_83_48&#39;)"><span class="hl_vardecl"><span class="mpre">s#</span></span></a><span class="mpre"> -&gt;
  case </span><a href="GHC.Prim.html#loc_2493_1_2493_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2493_1_2493_12&#39;)"><span class="hl_varref"><span class="mpre">readMutVar#</span></span></a><span class="mpre"> </span><a href="#loc_83_23_83_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_23_83_26&#39;)"><span class="hl_varref"><span class="mpre">mv#</span></span></a><span class="mpre"> </span><a href="#loc_83_46_83_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_46_83_48&#39;)"><span class="hl_varref"><span class="mpre">s#</span></span></a><span class="mpre"> of
    (# </span><a name="loc_85_8_85_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_8_85_11&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;#</span></span></a><span class="mpre">, </span><a name="loc_85_13_85_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_13_85_14&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> #) -&gt; let </span><a name="loc_85_25_85_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_25_85_27&#39;)"><span class="hl_vardecl"><span class="mpre">a&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_83_28_83_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_28_83_29&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre"> </span><a href="#loc_85_13_85_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_13_85_14&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> in </span><a href="#loc_85_25_85_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_25_85_27&#39;)"><span class="hl_varref"><span class="mpre">a&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`seq`</span></span><span class="mpre"> </span><a href="GHC.Prim.html#loc_2498_1_2498_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2498_1_2498_13&#39;)"><span class="hl_varref"><span class="mpre">writeMutVar#</span></span></a><span class="mpre"> </span><a href="#loc_83_23_83_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_23_83_26&#39;)"><span class="hl_varref"><span class="mpre">mv#</span></span></a><span class="mpre"> </span><a href="#loc_85_25_85_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_25_85_27&#39;)"><span class="hl_varref"><span class="mpre">a&#39;</span></span></a><span class="mpre"> </span><a href="#loc_85_8_85_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_8_85_11&#39;)"><span class="hl_varref"><span class="mpre">s&#39;#</span></span></a><span class="mpre">

</span></div></body></html>