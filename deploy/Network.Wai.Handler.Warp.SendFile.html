<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE CPP #-}

module Network.Wai.Handler.Warp.SendFile where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/SendFile.hs&quot;, srcSpanStartLine = 5, srcSpanStartColumn = 8, srcSpanEndLine = 5, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import Network.Sendfile
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/SendFile.hs&quot;, srcSpanStartLine = 7, srcSpanStartColumn = 8, srcSpanEndLine = 7, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre"> (Socket)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/SendFile.hs&quot;, srcSpanStartLine = 8, srcSpanStartColumn = 18, srcSpanEndLine = 8, srcSpanEndColumn = 50}, srcInfoPoints = []}) &quot;Network.Wai.Handler.Warp.FdCache&quot;"><span class="mpre">Network.Wai.Handler.Warp.FdCache</span></span><span class="mpre"> as F
import Network.Wai.Handler.Warp.Types

</span><a href="#loc_12_1_12_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_1_12_16&#39;)"><span class="mpre">defaultSendFile</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_12_1_12_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_1_12_16&#39;)"><span class="hl_fundecl"><span class="mpre">defaultSendFile</span></span></a><span class="mpre"> </span><a name="loc_12_17_12_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_17_12_18&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_12_19_12_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_19_12_23&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> </span><a name="loc_12_24_12_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_24_12_27&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_12_28_12_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_28_12_31&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_12_32_12_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_32_12_35&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> </span><a name="loc_12_36_12_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_36_12_39&#39;)"><span class="hl_vardecl"><span class="mpre">hdr</span></span></a><span class="mpre"> = </span><a href="Network.Sendfile.Fallback.html#loc_50_1_50_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Sendfile.Fallback.html#loc_50_1_50_19&#39;)"><span class="hl_varref"><span class="mpre">sendfileWithHeader</span></span></a><span class="mpre"> </span><a href="#loc_12_17_12_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_17_12_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_12_19_12_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_19_12_23&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">PartOfFile</span></span><span class="mpre"> </span><a href="#loc_12_24_12_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_24_12_27&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre"> </span><a href="#loc_12_28_12_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_28_12_31&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">) </span><a href="#loc_12_32_12_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_32_12_35&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="mpre"> </span><a href="#loc_12_36_12_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_36_12_39&#39;)"><span class="hl_varref"><span class="mpre">hdr</span></span></a><span class="mpre">


#if SENDFILEFD
</span><a href="#loc_17_1_17_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_1_17_12&#39;)"><span class="mpre">setSendFile</span></a><span class="mpre"> :: </span><a href="Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">F.MutableFdCache</span></span><span class="mpre"> -&gt; </span><a href="Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre">
</span><a name="loc_17_1_17_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_1_17_12&#39;)"><span class="hl_fundecl"><span class="mpre">setSendFile</span></span></a><span class="mpre"> </span><a name="loc_17_13_17_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_13_17_17&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">    = </span><a href="#loc_17_13_17_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_13_17_17&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
</span><a href="#loc_17_1_17_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_1_17_12&#39;)"><span class="hl_fundecl"><span class="mpre">setSendFile</span></span></a><span class="mpre"> </span><a name="loc_18_13_18_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_13_18_17&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">fdcs</span></span><span class="mpre">) = case </span><a href="Network.Wai.Handler.Warp.Types.html#loc_82_7_82_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_82_7_82_27&#39;)"><span class="hl_varref"><span class="mpre">connSendFileOverride</span></span></a><span class="mpre"> </span><a href="#loc_18_13_18_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_13_18_17&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> of
    </span><a href="Network.Wai.Handler.Warp.Types.html#loc_67_29_67_40" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_67_29_67_40&#39;)"><span class="hl_conref"><span class="mpre">NotOverride</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_18_13_18_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_13_18_17&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
    </span><a href="Network.Wai.Handler.Warp.Types.html#loc_68_29_68_37" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_68_29_68_37&#39;)"><span class="hl_conref"><span class="mpre">Override</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">s</span></span><span class="mpre">  -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/SendFile.hs&quot;, srcSpanStartLine = 20, srcSpanStartColumn = 20, srcSpanEndLine = 20, srcSpanEndColumn = 59}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/SendFile.hs&quot;, srcSpanStartLine = 20, srcSpanStartColumn = 25, srcSpanEndLine = 20, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai"><span class="mpre">conn { connSendFile = sendFile fdcs s }</span></span><span class="mpre">

</span><a href="#loc_23_1_23_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_9&#39;)"><span class="mpre">sendFile</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">F.MutableFdCache</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_23_1_23_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_9&#39;)"><span class="hl_fundecl"><span class="mpre">sendFile</span></span></a><span class="mpre"> </span><a name="loc_23_10_23_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_10_23_14&#39;)"><span class="hl_vardecl"><span class="mpre">fdcs</span></span></a><span class="mpre"> </span><a name="loc_23_15_23_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_15_23_16&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_23_17_23_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_17_23_21&#39;)"><span class="hl_vardecl"><span class="mpre">path</span></span></a><span class="mpre"> </span><a name="loc_23_22_23_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_22_23_25&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_23_26_23_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_26_23_29&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_23_30_23_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_30_23_33&#39;)"><span class="hl_vardecl"><span class="mpre">act</span></span></a><span class="mpre"> </span><a name="loc_23_34_23_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_34_23_37&#39;)"><span class="hl_vardecl"><span class="mpre">hdr</span></span></a><span class="mpre"> = do
    (</span><a name="loc_24_6_24_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_6_24_8&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre">, </span><a name="loc_24_10_24_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_10_24_17&#39;)"><span class="hl_vardecl"><span class="mpre">fresher</span></span></a><span class="mpre">) &lt;- </span><span class="hl_varref"><span class="mpre">F.getFd</span></span><span class="mpre"> </span><a href="#loc_23_10_23_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_10_23_14&#39;)"><span class="hl_varref"><span class="mpre">fdcs</span></span></a><span class="mpre"> </span><a href="#loc_23_17_23_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_17_23_21&#39;)"><span class="hl_varref"><span class="mpre">path</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">sendfileFdWithHeader</span></span><span class="mpre"> </span><a href="#loc_23_15_23_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_15_23_16&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_24_6_24_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_6_24_8&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">PartOfFile</span></span><span class="mpre"> </span><a href="#loc_23_22_23_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_22_23_25&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre"> </span><a href="#loc_23_26_23_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_26_23_29&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">) (</span><a href="#loc_23_30_23_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_30_23_33&#39;)"><span class="hl_varref"><span class="mpre">act</span></span></a><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><a href="#loc_24_10_24_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_10_24_17&#39;)"><span class="hl_varref"><span class="mpre">fresher</span></span></a><span class="mpre">) </span><a href="#loc_23_34_23_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_34_23_37&#39;)"><span class="hl_varref"><span class="mpre">hdr</span></span></a><span class="mpre">
#else
</span><a href="#loc_17_1_17_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_1_17_12&#39;)"><span class="mpre">setSendFile</span></a><span class="mpre"> :: </span><a href="Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">F.MutableFdCache</span></span><span class="mpre"> -&gt; </span><a href="Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre">
</span><span class="hl_fundecl"><span class="mpre">setSendFile</span></span><span class="mpre"> </span><a name="loc_28_13_28_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_13_28_17&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> _ = </span><a href="#loc_28_13_28_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_13_28_17&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
#endif
</span></div></body></html>