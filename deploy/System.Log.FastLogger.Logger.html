<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE BangPatterns, CPP #-}

module System.Log.FastLogger.Logger (
    Logger(..)
  , newLogger
  , pushLog
  , flushLog
  ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fast-logger-2.1.5/System/Log/FastLogger/Logger.hs&quot;, srcSpanStartLine = 10, srcSpanStartColumn = 8, srcSpanEndLine = 10, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;Control.Concurrent&quot;"><span class="mpre">Control.Concurrent</span></span><span class="mpre"> (MVar, newMVar, withMVar)
import Control.Monad (</span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">)
import Foreign.Ptr (plusPtr)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fast-logger-2.1.5/System/Log/FastLogger/Logger.hs&quot;, srcSpanStartLine = 13, srcSpanStartColumn = 8, srcSpanEndLine = 13, srcSpanEndColumn = 17}, srcInfoPoints = []}) &quot;GHC.IO.FD&quot;"><span class="mpre">GHC.IO.FD</span></span><span class="mpre"> (FD, writeRawBufferPtr)
import System.Log.FastLogger.IO
import System.Log.FastLogger.LogStr
import System.Log.FastLogger.IORef

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

data </span><a name="loc_20_6_20_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_6_20_12&#39;)"><span class="hl_tycondecl"><span class="mpre">Logger</span></span></a><span class="mpre"> = </span><a name="loc_20_15_20_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_15_20_21&#39;)"><span class="hl_condecl"><span class="mpre">Logger</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">MVar</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Buffer</span></span><span class="mpre">) !</span><span class="hl_tyconref"><span class="mpre">BufSize</span></span><span class="mpre"> (</span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><a href="System.Log.FastLogger.LogStr.html#loc_59_6_59_12" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Log.FastLogger.LogStr.html#loc_59_6_59_12&#39;)"><span class="hl_tyconref"><span class="mpre">LogStr</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_25_1_25_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_1_25_10&#39;)"><span class="mpre">newLogger</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">BufSize</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_20_6_20_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_6_20_12&#39;)"><span class="hl_tyconref"><span class="mpre">Logger</span></span></a><span class="mpre">
</span><a name="loc_25_1_25_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_1_25_10&#39;)"><span class="hl_fundecl"><span class="mpre">newLogger</span></span></a><span class="mpre"> </span><a name="loc_25_11_25_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_11_25_15&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> = do
    </span><a name="loc_26_5_26_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_5_26_8&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> &lt;- </span><a href="System.Log.FastLogger.IO.html#loc_29_1_29_10" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Log.FastLogger.IO.html#loc_29_1_29_10&#39;)"><span class="hl_varref"><span class="mpre">getBuffer</span></span></a><span class="mpre"> </span><a href="#loc_25_11_25_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_11_25_15&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">
    </span><a name="loc_27_5_27_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_5_27_9&#39;)"><span class="hl_vardecl"><span class="mpre">mbuf</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newMVar</span></span><span class="mpre"> </span><a href="#loc_26_5_26_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_5_26_8&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
    </span><a name="loc_28_5_28_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_5_28_9&#39;)"><span class="hl_vardecl"><span class="mpre">lref</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_20_15_20_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_15_20_21&#39;)"><span class="hl_conref"><span class="mpre">Logger</span></span></a><span class="mpre"> </span><a href="#loc_27_5_27_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_5_27_9&#39;)"><span class="hl_varref"><span class="mpre">mbuf</span></span></a><span class="mpre"> </span><a href="#loc_25_11_25_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_11_25_15&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_28_5_28_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_5_28_9&#39;)"><span class="hl_varref"><span class="mpre">lref</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_34_1_34_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_8&#39;)"><span class="mpre">pushLog</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FD</span></span><span class="mpre"> -&gt; </span><a href="#loc_20_6_20_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_6_20_12&#39;)"><span class="hl_tyconref"><span class="mpre">Logger</span></span></a><span class="mpre"> -&gt; </span><a href="System.Log.FastLogger.LogStr.html#loc_59_6_59_12" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Log.FastLogger.LogStr.html#loc_59_6_59_12&#39;)"><span class="hl_tyconref"><span class="mpre">LogStr</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_34_1_34_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_8&#39;)"><span class="hl_fundecl"><span class="mpre">pushLog</span></span></a><span class="mpre"> </span><a name="loc_34_9_34_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_9_34_11&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a name="loc_34_12_34_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_12_34_18&#39;)"><span class="hl_specname"><span class="mpre">logger</span></span></a><span class="mpre">@(</span><a href="#loc_20_15_20_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_15_20_21&#39;)"><span class="hl_conref"><span class="mpre">Logger</span></span></a><span class="mpre"> </span><a name="loc_34_27_34_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_27_34_31&#39;)"><span class="hl_vardecl"><span class="mpre">mbuf</span></span></a><span class="mpre"> </span><a name="loc_34_32_34_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_32_34_36&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> </span><a name="loc_34_37_34_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_37_34_40&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre">) </span><a name="loc_34_42_34_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_42_34_49&#39;)"><span class="hl_specname"><span class="mpre">nlogmsg</span></span></a><span class="mpre">@(</span><a href="System.Log.FastLogger.LogStr.html#loc_59_15_59_21" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Log.FastLogger.LogStr.html#loc_59_15_59_21&#39;)"><span class="hl_conref"><span class="mpre">LogStr</span></span></a><span class="mpre"> </span><a name="loc_34_58_34_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_58_34_62&#39;)"><span class="hl_vardecl"><span class="mpre">nlen</span></span></a><span class="mpre"> </span><a name="loc_34_63_34_71" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_63_34_71&#39;)"><span class="hl_vardecl"><span class="mpre">nbuilder</span></span></a><span class="mpre">)
  | </span><a href="#loc_34_58_34_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_58_34_62&#39;)"><span class="hl_varref"><span class="mpre">nlen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><a href="#loc_34_32_34_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_32_34_36&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> = do
      </span><a href="#loc_51_1_51_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_9&#39;)"><span class="hl_varref"><span class="mpre">flushLog</span></span></a><span class="mpre"> </span><a href="#loc_34_9_34_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_9_34_11&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="#loc_34_12_34_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_12_34_18&#39;)"><span class="hl_varref"><span class="mpre">logger</span></span></a><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">withMVar</span></span><span class="mpre"> </span><a href="#loc_34_27_34_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_27_34_31&#39;)"><span class="hl_varref"><span class="mpre">mbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_37_24_37_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_24_37_27&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> -&gt; </span><a href="System.Log.FastLogger.IO.html#loc_36_1_36_12" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Log.FastLogger.IO.html#loc_36_1_36_12&#39;)"><span class="hl_varref"><span class="mpre">toBufIOWith</span></span></a><span class="mpre"> </span><a href="#loc_37_24_37_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_24_37_27&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a href="#loc_34_32_34_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_32_34_36&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> (</span><a href="#loc_76_1_76_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_34_9_34_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_9_34_11&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">) </span><a href="#loc_34_63_34_71" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_63_34_71&#39;)"><span class="hl_varref"><span class="mpre">nbuilder</span></span></a><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do
    </span><a name="loc_39_5_39_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_5_39_9&#39;)"><span class="hl_vardecl"><span class="mpre">mmsg</span></span></a><span class="mpre"> &lt;- </span><a href="System.Log.FastLogger.IORef.html#loc_14_1_14_19" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Log.FastLogger.IORef.html#loc_14_1_14_19&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef&#39;</span></span></a><span class="mpre"> </span><a href="#loc_34_37_34_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_37_34_40&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><a href="#loc_44_5_44_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_5_44_13&#39;)"><span class="hl_varref"><span class="mpre">checkBuf</span></span></a><span class="mpre">
    case </span><a href="#loc_39_5_39_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_5_39_9&#39;)"><span class="hl_varref"><span class="mpre">mmsg</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_42_14_42_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_14_42_17&#39;)"><span class="hl_vardecl"><span class="mpre">msg</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">withMVar</span></span><span class="mpre"> </span><a href="#loc_34_27_34_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_27_34_31&#39;)"><span class="hl_varref"><span class="mpre">mbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_42_38_42_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_38_42_41&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_71_1_71_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_12&#39;)"><span class="hl_varref"><span class="mpre">writeLogStr</span></span></a><span class="mpre"> </span><a href="#loc_34_9_34_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_9_34_11&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="#loc_42_38_42_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_38_42_41&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a href="#loc_34_32_34_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_32_34_36&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_42_14_42_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_14_42_17&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre">
  where
    </span><a name="loc_44_5_44_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_5_44_13&#39;)"><span class="hl_fundecl"><span class="mpre">checkBuf</span></span></a><span class="mpre"> </span><a name="loc_44_14_44_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_14_44_21&#39;)"><span class="hl_specname"><span class="mpre">ologmsg</span></span></a><span class="mpre">@(</span><a href="System.Log.FastLogger.LogStr.html#loc_59_15_59_21" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Log.FastLogger.LogStr.html#loc_59_15_59_21&#39;)"><span class="hl_conref"><span class="mpre">LogStr</span></span></a><span class="mpre"> </span><a name="loc_44_30_44_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_30_44_34&#39;)"><span class="hl_vardecl"><span class="mpre">olen</span></span></a><span class="mpre"> _)
      | </span><a href="#loc_34_32_34_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_32_34_36&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_44_30_44_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_30_44_34&#39;)"><span class="hl_varref"><span class="mpre">olen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_34_58_34_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_58_34_62&#39;)"><span class="hl_varref"><span class="mpre">nlen</span></span></a><span class="mpre"> = (</span><a href="#loc_34_42_34_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_42_34_49&#39;)"><span class="hl_varref"><span class="mpre">nlogmsg</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_44_14_44_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_14_44_21&#39;)"><span class="hl_varref"><span class="mpre">ologmsg</span></span></a><span class="mpre">)
      | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">          = (</span><a href="#loc_44_14_44_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_14_44_21&#39;)"><span class="hl_varref"><span class="mpre">ologmsg</span></span></a><span class="mpre"> </span><a href="System.Log.FastLogger.LogStr.html#loc_39_1_39_5" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Log.FastLogger.LogStr.html#loc_39_1_39_5&#39;)"><span class="hl_infix"><span class="mpre">&lt;&gt;</span></span></a><span class="mpre"> </span><a href="#loc_34_42_34_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_42_34_49&#39;)"><span class="hl_varref"><span class="mpre">nlogmsg</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_51_1_51_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_9&#39;)"><span class="mpre">flushLog</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FD</span></span><span class="mpre"> -&gt; </span><a href="#loc_20_6_20_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_6_20_12&#39;)"><span class="hl_tyconref"><span class="mpre">Logger</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_51_1_51_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_9&#39;)"><span class="hl_fundecl"><span class="mpre">flushLog</span></span></a><span class="mpre"> </span><a name="loc_51_10_51_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_10_51_12&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> (</span><a href="#loc_20_15_20_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_15_20_21&#39;)"><span class="hl_conref"><span class="mpre">Logger</span></span></a><span class="mpre"> </span><a name="loc_51_21_51_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_21_51_25&#39;)"><span class="hl_vardecl"><span class="mpre">mbuf</span></span></a><span class="mpre"> </span><a name="loc_51_26_51_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_26_51_30&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> </span><a name="loc_51_31_51_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_31_51_35&#39;)"><span class="hl_vardecl"><span class="mpre">lref</span></span></a><span class="mpre">) = do
    </span><a name="loc_52_5_52_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_11&#39;)"><span class="hl_vardecl"><span class="mpre">logmsg</span></span></a><span class="mpre"> &lt;- </span><a href="System.Log.FastLogger.IORef.html#loc_14_1_14_19" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Log.FastLogger.IORef.html#loc_14_1_14_19&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef&#39;</span></span></a><span class="mpre"> </span><a href="#loc_51_31_51_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_31_51_35&#39;)"><span class="hl_varref"><span class="mpre">lref</span></span></a><span class="mpre"> (\</span><a name="loc_52_41_52_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_41_52_44&#39;)"><span class="hl_vardecl"><span class="mpre">old</span></span></a><span class="mpre"> -&gt; (</span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">, </span><a href="#loc_52_41_52_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_41_52_44&#39;)"><span class="hl_varref"><span class="mpre">old</span></span></a><span class="mpre">))
    </span><span class="hl_comment"><span class="mpre">-- If a special buffer is prepared for flusher, this MVar could</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- be removed. But such a code does not contribute logging speed</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- according to experiment. And even with the special buffer,</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- there is no grantee that this function is exclusively called</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- for a buffer. So, we use MVar here.</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- This is safe and speed penalty can be ignored.</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">withMVar</span></span><span class="mpre"> </span><a href="#loc_51_21_51_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_21_51_25&#39;)"><span class="hl_varref"><span class="mpre">mbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_59_22_59_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_22_59_25&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_71_1_71_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_12&#39;)"><span class="hl_varref"><span class="mpre">writeLogStr</span></span></a><span class="mpre"> </span><a href="#loc_51_10_51_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_10_51_12&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="#loc_59_22_59_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_22_59_25&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a href="#loc_51_26_51_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_26_51_30&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_52_5_52_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_11&#39;)"><span class="hl_varref"><span class="mpre">logmsg</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Writting &#39;LogStr&#39; using a buffer in blocking mode.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   The size of &#39;LogStr&#39; must be smaller or equal to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   the size of buffer.</span></span><span class="mpre">
</span><a href="#loc_71_1_71_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_12&#39;)"><span class="mpre">writeLogStr</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FD</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">Buffer</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">BufSize</span></span><span class="mpre">
            -&gt; </span><a href="System.Log.FastLogger.LogStr.html#loc_59_6_59_12" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Log.FastLogger.LogStr.html#loc_59_6_59_12&#39;)"><span class="hl_tyconref"><span class="mpre">LogStr</span></span></a><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_71_1_71_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_12&#39;)"><span class="hl_fundecl"><span class="mpre">writeLogStr</span></span></a><span class="mpre"> </span><a name="loc_71_13_71_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_13_71_15&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a name="loc_71_16_71_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_16_71_19&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a name="loc_71_20_71_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_20_71_24&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> (</span><a href="System.Log.FastLogger.LogStr.html#loc_59_15_59_21" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Log.FastLogger.LogStr.html#loc_59_15_59_21&#39;)"><span class="hl_conref"><span class="mpre">LogStr</span></span></a><span class="mpre"> </span><a name="loc_71_33_71_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_33_71_36&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_71_37_71_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_37_71_44&#39;)"><span class="hl_vardecl"><span class="mpre">builder</span></span></a><span class="mpre">)
  | </span><a href="#loc_71_20_71_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_20_71_24&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_71_33_71_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_33_71_36&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;writeLogStr&quot;</span></span><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">  = </span><a href="System.Log.FastLogger.IO.html#loc_36_1_36_12" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Log.FastLogger.IO.html#loc_36_1_36_12&#39;)"><span class="hl_varref"><span class="mpre">toBufIOWith</span></span></a><span class="mpre"> </span><a href="#loc_71_16_71_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_16_71_19&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a href="#loc_71_20_71_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_20_71_24&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> (</span><a href="#loc_76_1_76_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_71_13_71_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_13_71_15&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">) </span><a href="#loc_71_37_71_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_37_71_44&#39;)"><span class="hl_varref"><span class="mpre">builder</span></span></a><span class="mpre">

</span><a href="#loc_76_1_76_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_6&#39;)"><span class="mpre">write</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FD</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Buffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_76_1_76_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_6&#39;)"><span class="hl_fundecl"><span class="mpre">write</span></span></a><span class="mpre"> </span><a name="loc_76_7_76_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_7_76_9&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a name="loc_76_10_76_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_10_76_13&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a name="loc_76_14_76_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_14_76_18&#39;)"><span class="hl_vardecl"><span class="mpre">len&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_78_5_78_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_5_78_9&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_76_10_76_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_10_76_13&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_76_14_76_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_14_76_18&#39;)"><span class="hl_varref"><span class="mpre">len&#39;</span></span></a><span class="mpre">)
  where
    </span><a name="loc_78_5_78_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_5_78_9&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_78_10_78_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_10_78_12&#39;)"><span class="hl_vardecl"><span class="mpre">bf</span></span></a><span class="mpre"> !</span><a name="loc_78_14_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_14_78_17&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = do
        </span><a name="loc_79_9_79_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_9_79_16&#39;)"><span class="hl_vardecl"><span class="mpre">written</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">writeRawBufferPtr</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;write&quot;</span></span><span class="mpre"> </span><a href="#loc_76_7_76_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_7_76_9&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="#loc_78_10_78_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_10_78_12&#39;)"><span class="hl_varref"><span class="mpre">bf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_78_14_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_14_78_17&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">)
        </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_79_9_79_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_9_79_16&#39;)"><span class="hl_varref"><span class="mpre">written</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_78_14_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_14_78_17&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
            </span><a href="#loc_78_5_78_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_5_78_9&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> (</span><a href="#loc_78_10_78_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_10_78_12&#39;)"><span class="hl_varref"><span class="mpre">bf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_79_9_79_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_9_79_16&#39;)"><span class="hl_varref"><span class="mpre">written</span></span></a><span class="mpre">) (</span><a href="#loc_78_14_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_14_78_17&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_79_9_79_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_9_79_16&#39;)"><span class="hl_varref"><span class="mpre">written</span></span></a><span class="mpre">)
</span></div></body></html>