<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Data.Byteable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : good</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Data.Byteable
    ( Byteable(..)
    , constEqBytes
    ) where

import Foreign.Ptr (Ptr, plusPtr)
import Foreign.ForeignPtr (</span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="mpre">withForeignPtr</span></a><span class="mpre">)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/byteable-0.1.1/Data/Byteable.hs&quot;, srcSpanStartLine = 15, srcSpanStartColumn = 8, srcSpanEndLine = 15, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import Data.List (</span><a href="Data.List.html#loc_993_1_993_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_993_1_993_7&#39;)"><span class="mpre">foldl&#39;</span></a><span class="mpre">)
import Data.Word (Word8)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/byteable-0.1.1/Data/Byteable.hs&quot;, srcSpanStartLine = 18, srcSpanStartColumn = 18, srcSpanEndLine = 18, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B (length, zipWith)
import qualified Data.ByteString.Internal as B (</span><a href="Data.ByteString.Internal.html#loc_405_1_405_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_405_1_405_13&#39;)"><span class="mpre">toForeignPtr</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Class of things that can generate sequence of bytes</span></span><span class="mpre">
class </span><a name="loc_22_7_22_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_7_22_15&#39;)"><span class="hl_classdecl"><span class="mpre">Byteable</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> where
    </span><span class="hl_comment"><span class="mpre">-- | Convert a byteable type to a bytestring</span></span><span class="mpre">
    </span><a name="loc_24_5_24_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_5_24_12&#39;)"><span class="mpre">toBytes</span></a><span class="mpre">        :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">

    </span><span class="hl_comment"><span class="mpre">-- | Return the size of the byteable .</span></span><span class="mpre">
    </span><a name="loc_27_5_27_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_5_27_19&#39;)"><span class="mpre">byteableLength</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
    </span><a href="#loc_27_5_27_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_5_27_19&#39;)"><span class="hl_vardecl"><span class="mpre">byteableLength</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_24_5_24_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_5_24_12&#39;)"><span class="hl_varref"><span class="mpre">toBytes</span></span></a><span class="mpre">

    </span><span class="hl_comment"><span class="mpre">-- | Provide a way to look at the data of a byteable type with a ptr.</span></span><span class="mpre">
    </span><a name="loc_31_5_31_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_5_31_16&#39;)"><span class="mpre">withBytePtr</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
    </span><a href="#loc_31_5_31_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_5_31_16&#39;)"><span class="hl_fundecl"><span class="mpre">withBytePtr</span></span></a><span class="mpre"> </span><a name="loc_32_17_32_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_17_32_18&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> </span><a name="loc_32_19_32_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_19_32_20&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="Foreign.ForeignPtr.Imp.html#loc_88_1_88_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.ForeignPtr.Imp.html#loc_88_1_88_15&#39;)"><span class="hl_varref"><span class="mpre">withForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_33_14_33_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_14_33_18&#39;)"><span class="hl_varref"><span class="mpre">fptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_32_46_32_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_46_32_49&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_32_19_32_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_19_32_20&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> (</span><a href="#loc_32_46_32_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_46_32_49&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_33_20_33_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_20_33_23&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre">)
      where (</span><a name="loc_33_14_33_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_14_33_18&#39;)"><span class="hl_vardecl"><span class="mpre">fptr</span></span></a><span class="mpre">, </span><a name="loc_33_20_33_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_20_33_23&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre">, _) = </span><a href="Data.ByteString.Internal.html#loc_405_1_405_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_405_1_405_13&#39;)"><span class="hl_varref"><span class="mpre">B.toForeignPtr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_24_5_24_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_5_24_12&#39;)"><span class="hl_varref"><span class="mpre">toBytes</span></span></a><span class="mpre"> </span><a href="#loc_32_17_32_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_17_32_18&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">

instance </span><a href="#loc_22_7_22_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_7_22_15&#39;)"><span class="hl_classref"><span class="mpre">Byteable</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> where
    </span><a href="#loc_24_5_24_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_5_24_12&#39;)"><span class="hl_fundecl"><span class="mpre">toBytes</span></span></a><span class="mpre"> </span><a name="loc_36_13_36_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_13_36_15&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="#loc_36_13_36_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_13_36_15&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A constant time equality test for 2 byteable objects.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If objects are of 2 different sizes, the function will abort early</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- without comparing any bytes.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- compared to == , this function will go over all the bytes</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- present before yielding a result even when knowing the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- overall result early in the processing.</span></span><span class="mpre">
</span><a href="#loc_47_1_47_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_1_47_13&#39;)"><span class="mpre">constEqBytes</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/byteable-0.1.1/Data/Byteable.hs&quot;, srcSpanStartLine = 46, srcSpanStartColumn = 17, srcSpanEndLine = 46, srcSpanEndColumn = 30}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/byteable-0.1.1/Data/Byteable.hs&quot;, srcSpanStartLine = 46, srcSpanStartColumn = 28, srcSpanEndLine = 46, srcSpanEndColumn = 30}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/byteable-0.1.1/Data/By"><span class="mpre">Byteable a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_47_1_47_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_1_47_13&#39;)"><span class="hl_fundecl"><span class="mpre">constEqBytes</span></span></a><span class="mpre"> </span><a name="loc_47_14_47_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_14_47_15&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> </span><a name="loc_47_16_47_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_16_47_17&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = </span><a href="#loc_52_1_52_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_18&#39;)"><span class="hl_varref"><span class="mpre">constEqByteString</span></span></a><span class="mpre"> (</span><a href="#loc_24_5_24_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_5_24_12&#39;)"><span class="hl_varref"><span class="mpre">toBytes</span></span></a><span class="mpre"> </span><a href="#loc_47_14_47_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_14_47_15&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">) (</span><a href="#loc_24_5_24_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_5_24_12&#39;)"><span class="hl_varref"><span class="mpre">toBytes</span></span></a><span class="mpre"> </span><a href="#loc_47_16_47_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_16_47_17&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# RULES &quot;constEqBytes/ByteString&quot; constEqBytes = constEqByteString #-}</span></span><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_52_1_52_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_18&#39;)"><span class="mpre">constEqByteString</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_52_1_52_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_18&#39;)"><span class="mpre">constEqByteString</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_52_1_52_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_18&#39;)"><span class="hl_fundecl"><span class="mpre">constEqByteString</span></span></a><span class="mpre"> </span><a name="loc_52_19_52_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_19_52_20&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> </span><a name="loc_52_21_52_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_21_52_22&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">
    | </span><a href="#loc_55_9_55_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_9_55_12&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_52_21_52_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_21_52_22&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">         = </span><a href="Data.List.html#loc_993_1_993_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_993_1_993_7&#39;)"><span class="hl_varref"><span class="mpre">foldl&#39;</span></span></a><span class="mpre"> </span><a href="#loc_58_15_58_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_15_58_18&#39;)"><span class="hl_varref"><span class="mpre">(&amp;&amp;!)</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.zipWith</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">(==)</span></span><span class="mpre"> </span><a href="#loc_52_19_52_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_19_52_20&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><a href="#loc_52_21_52_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_21_52_22&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
  where </span><a name="loc_55_9_55_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_9_55_12&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_52_19_52_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_19_52_20&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">

        </span><a href="#loc_58_15_58_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_15_58_18&#39;)"><span class="mpre">(&amp;&amp;!)</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">  </span><a name="loc_58_15_58_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_15_58_18&#39;)"><span class="hl_fundecl"><span class="mpre">&amp;&amp;!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">  = </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">  </span><a href="#loc_58_15_58_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_15_58_18&#39;)"><span class="hl_fundecl"><span class="mpre">&amp;&amp;!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> </span><a href="#loc_58_15_58_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_15_58_18&#39;)"><span class="hl_fundecl"><span class="mpre">&amp;&amp;!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">  = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> </span><a href="#loc_58_15_58_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_15_58_18&#39;)"><span class="hl_fundecl"><span class="mpre">&amp;&amp;!</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
</span></div></body></html>