<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE GeneralizedNewtypeDeriving #-}

</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Crypto.PubKey.DH</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : Good</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Crypto.PubKey.DH
    ( Params(..)
    , PublicNumber
    , PrivateNumber
    , SharedKey
    , generateParams
    , generatePrivate
    , calculatePublic
    , generatePublic
    , getShared
    ) where

import Crypto.Number.ModArithmetic (</span><a href="Crypto.Number.ModArithmetic.html#loc_59_1_59_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.ModArithmetic.html#loc_59_1_59_8&#39;)"><span class="mpre">expSafe</span></a><span class="mpre">)
import Crypto.Number.Prime (</span><a href="Crypto.Number.Prime.html#loc_62_1_62_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.Prime.html#loc_62_1_62_18&#39;)"><span class="mpre">generateSafePrime</span></a><span class="mpre">)
import Crypto.Number.Generate (</span><a href="Crypto.Number.Generate.html#loc_24_1_24_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.Generate.html#loc_24_1_24_12&#39;)"><span class="mpre">generateMax</span></a><span class="mpre">)
import Crypto.Types.PubKey.DH
import Crypto.Random
import Control.Arrow (</span><a href="Control.Arrow.html#loc_90_5_90_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Arrow.html#loc_90_5_90_10&#39;)"><span class="mpre">first</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | generate params from a specific generator (2 or 5 are common values)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- we generate a safe prime (a prime number of the form 2p+1 where p is also prime)</span></span><span class="mpre">
</span><a href="#loc_32_1_32_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_1_32_15&#39;)"><span class="mpre">generateParams</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/DH.hs&quot;, srcSpanStartLine = 31, srcSpanStartColumn = 19, srcSpanEndLine = 31, srcSpanEndColumn = 28}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/DH.hs&quot;, srcSpanStartLine = 31, srcSpanStartColumn = 26, srcSpanEndLine = 31, srcSpanEndColumn = 28}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto"><span class="mpre">CPRG g =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; (</span><a href="Crypto.Types.PubKey.DH.html#loc_21_6_21_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_21_6_21_12&#39;)"><span class="hl_tyconref"><span class="mpre">Params</span></span></a><span class="mpre">, </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">)
</span><a name="loc_32_1_32_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_1_32_15&#39;)"><span class="hl_fundecl"><span class="mpre">generateParams</span></span></a><span class="mpre"> </span><a name="loc_32_16_32_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_16_32_19&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a name="loc_32_20_32_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_20_32_24&#39;)"><span class="hl_vardecl"><span class="mpre">bits</span></span></a><span class="mpre"> </span><a name="loc_32_25_32_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_25_32_34&#39;)"><span class="hl_vardecl"><span class="mpre">generator</span></span></a><span class="mpre"> =
    </span><a href="Control.Arrow.html#loc_90_5_90_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Arrow.html#loc_90_5_90_10&#39;)"><span class="hl_varref"><span class="mpre">first</span></span></a><span class="mpre"> (\</span><a name="loc_33_13_33_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_13_33_14&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">Params</span></span><span class="mpre"> </span><a href="#loc_33_13_33_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_13_33_14&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_32_25_32_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_25_32_34&#39;)"><span class="hl_varref"><span class="mpre">generator</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Crypto.Number.Prime.html#loc_62_1_62_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.Prime.html#loc_62_1_62_18&#39;)"><span class="hl_varref"><span class="mpre">generateSafePrime</span></span></a><span class="mpre"> </span><a href="#loc_32_16_32_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_16_32_19&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a href="#loc_32_20_32_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_20_32_24&#39;)"><span class="hl_varref"><span class="mpre">bits</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | generate a private number with no specific property</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- this number is usually called X in DH text.</span></span><span class="mpre">
</span><a href="#loc_38_1_38_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_1_38_16&#39;)"><span class="mpre">generatePrivate</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/DH.hs&quot;, srcSpanStartLine = 37, srcSpanStartColumn = 20, srcSpanEndLine = 37, srcSpanEndColumn = 29}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-pubkey-0.2.4/Crypto/PubKey/DH.hs&quot;, srcSpanStartLine = 37, srcSpanStartColumn = 27, srcSpanEndLine = 37, srcSpanEndColumn = 29}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto"><span class="mpre">CPRG g =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre"> -&gt; </span><a href="Crypto.Types.PubKey.DH.html#loc_21_6_21_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_21_6_21_12&#39;)"><span class="hl_tyconref"><span class="mpre">Params</span></span></a><span class="mpre"> -&gt; (</span><a href="Crypto.Types.PubKey.DH.html#loc_42_9_42_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_42_9_42_22&#39;)"><span class="hl_tyconref"><span class="mpre">PrivateNumber</span></span></a><span class="mpre">, </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">)
</span><a name="loc_38_1_38_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_1_38_16&#39;)"><span class="hl_fundecl"><span class="mpre">generatePrivate</span></span></a><span class="mpre"> </span><a name="loc_38_17_38_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_17_38_20&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Params</span></span><span class="mpre"> </span><a name="loc_38_29_38_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_29_38_30&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> _) = </span><a href="Control.Arrow.html#loc_90_5_90_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Arrow.html#loc_90_5_90_10&#39;)"><span class="hl_varref"><span class="mpre">first</span></span></a><span class="mpre"> </span><a href="Crypto.Types.PubKey.DH.html#loc_42_25_42_38" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_42_25_42_38&#39;)"><span class="hl_conref"><span class="mpre">PrivateNumber</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Crypto.Number.Generate.html#loc_24_1_24_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.Generate.html#loc_24_1_24_12&#39;)"><span class="hl_varref"><span class="mpre">generateMax</span></span></a><span class="mpre"> </span><a href="#loc_38_17_38_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_17_38_20&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a href="#loc_38_29_38_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_29_38_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | calculate the public number from the parameters and the private key</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- this number is usually called Y in DH text.</span></span><span class="mpre">
</span><a href="#loc_43_1_43_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_16&#39;)"><span class="mpre">calculatePublic</span></a><span class="mpre"> :: </span><a href="Crypto.Types.PubKey.DH.html#loc_21_6_21_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_21_6_21_12&#39;)"><span class="hl_tyconref"><span class="mpre">Params</span></span></a><span class="mpre"> -&gt; </span><a href="Crypto.Types.PubKey.DH.html#loc_42_9_42_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_42_9_42_22&#39;)"><span class="hl_tyconref"><span class="mpre">PrivateNumber</span></span></a><span class="mpre"> -&gt; </span><a href="Crypto.Types.PubKey.DH.html#loc_38_9_38_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_38_9_38_21&#39;)"><span class="hl_tyconref"><span class="mpre">PublicNumber</span></span></a><span class="mpre">
</span><a name="loc_43_1_43_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_16&#39;)"><span class="hl_fundecl"><span class="mpre">calculatePublic</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Params</span></span><span class="mpre"> </span><a name="loc_43_25_43_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_25_43_26&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_43_27_43_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_27_43_28&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre">) (</span><a href="Crypto.Types.PubKey.DH.html#loc_42_25_42_38" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_42_25_42_38&#39;)"><span class="hl_conref"><span class="mpre">PrivateNumber</span></span></a><span class="mpre"> </span><a name="loc_43_45_43_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_45_43_46&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">) = </span><a href="Crypto.Types.PubKey.DH.html#loc_38_24_38_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_38_24_38_36&#39;)"><span class="hl_conref"><span class="mpre">PublicNumber</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Crypto.Number.ModArithmetic.html#loc_59_1_59_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.ModArithmetic.html#loc_59_1_59_8&#39;)"><span class="hl_varref"><span class="mpre">expSafe</span></span></a><span class="mpre"> </span><a href="#loc_43_27_43_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_27_43_28&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre"> </span><a href="#loc_43_45_43_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_45_43_46&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="#loc_43_25_43_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_25_43_26&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | calculate the public number from the parameters and the private key</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- this number is usually called Y in DH text.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- DEPRECATED use calculatePublic</span></span><span class="mpre">
</span><a href="#loc_50_1_50_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_15&#39;)"><span class="mpre">generatePublic</span></a><span class="mpre"> :: </span><a href="Crypto.Types.PubKey.DH.html#loc_21_6_21_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_21_6_21_12&#39;)"><span class="hl_tyconref"><span class="mpre">Params</span></span></a><span class="mpre"> -&gt; </span><a href="Crypto.Types.PubKey.DH.html#loc_42_9_42_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_42_9_42_22&#39;)"><span class="hl_tyconref"><span class="mpre">PrivateNumber</span></span></a><span class="mpre"> -&gt; </span><a href="Crypto.Types.PubKey.DH.html#loc_38_9_38_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_38_9_38_21&#39;)"><span class="hl_tyconref"><span class="mpre">PublicNumber</span></span></a><span class="mpre">
</span><a name="loc_50_1_50_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_1_50_15&#39;)"><span class="hl_vardecl"><span class="mpre">generatePublic</span></span></a><span class="mpre"> = </span><a href="#loc_43_1_43_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_16&#39;)"><span class="hl_varref"><span class="mpre">calculatePublic</span></span></a><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- commented until 0.3 {-# DEPRECATED generatePublic &quot;use calculatePublic&quot; #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | generate a shared key using our private number and the other party public number</span></span><span class="mpre">
</span><a href="#loc_55_1_55_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_10&#39;)"><span class="mpre">getShared</span></a><span class="mpre"> :: </span><a href="Crypto.Types.PubKey.DH.html#loc_21_6_21_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_21_6_21_12&#39;)"><span class="hl_tyconref"><span class="mpre">Params</span></span></a><span class="mpre"> -&gt; </span><a href="Crypto.Types.PubKey.DH.html#loc_42_9_42_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_42_9_42_22&#39;)"><span class="hl_tyconref"><span class="mpre">PrivateNumber</span></span></a><span class="mpre"> -&gt; </span><a href="Crypto.Types.PubKey.DH.html#loc_38_9_38_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_38_9_38_21&#39;)"><span class="hl_tyconref"><span class="mpre">PublicNumber</span></span></a><span class="mpre"> -&gt; </span><a href="Crypto.Types.PubKey.DH.html#loc_46_9_46_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_46_9_46_18&#39;)"><span class="hl_tyconref"><span class="mpre">SharedKey</span></span></a><span class="mpre">
</span><a name="loc_55_1_55_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_10&#39;)"><span class="hl_fundecl"><span class="mpre">getShared</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Params</span></span><span class="mpre"> </span><a name="loc_55_19_55_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_19_55_20&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> _) (</span><a href="Crypto.Types.PubKey.DH.html#loc_42_25_42_38" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_42_25_42_38&#39;)"><span class="hl_conref"><span class="mpre">PrivateNumber</span></span></a><span class="mpre"> </span><a name="loc_55_39_55_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_39_55_40&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">) (</span><a href="Crypto.Types.PubKey.DH.html#loc_38_24_38_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_38_24_38_36&#39;)"><span class="hl_conref"><span class="mpre">PublicNumber</span></span></a><span class="mpre"> </span><a name="loc_55_56_55_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_56_55_57&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre">) = </span><a href="Crypto.Types.PubKey.DH.html#loc_46_21_46_30" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Types.PubKey.DH.html#loc_46_21_46_30&#39;)"><span class="hl_conref"><span class="mpre">SharedKey</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Crypto.Number.ModArithmetic.html#loc_59_1_59_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Number.ModArithmetic.html#loc_59_1_59_8&#39;)"><span class="hl_varref"><span class="mpre">expSafe</span></span></a><span class="mpre"> </span><a href="#loc_55_56_55_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_56_55_57&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre"> </span><a href="#loc_55_39_55_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_39_55_40&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="#loc_55_19_55_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_19_55_20&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">
</span></div></body></html>