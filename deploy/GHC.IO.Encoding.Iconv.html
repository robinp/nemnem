<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Trustworthy #-}
{-# LANGUAGE CPP
           , NoImplicitPrelude
           , NondecreasingIndentation
  #-}
{-# OPTIONS_HADDOCK hide #-}

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  GHC.IO.Encoding.Iconv</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow, 2008-2009</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  see libraries/base/LICENSE</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  libraries@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  internal</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This module provides text encoding/decoding using iconv</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module GHC.IO.Encoding.Iconv (
#if !defined(mingw32_HOST_OS)
   iconvEncoding, mkIconvEncoding,
   localeEncodingName
#endif
 ) where

#include &quot;MachDeps.h&quot;
#include &quot;HsBaseConfig.h&quot;

#if defined(mingw32_HOST_OS)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 33, srcSpanStartColumn = 8, srcSpanEndLine = 33, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre"> () </span><span class="hl_comment"><span class="mpre">-- For build ordering</span></span><span class="mpre">
#else

import Foreign.Safe
import Foreign.C
import Data.Maybe
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 39, srcSpanStartColumn = 8, srcSpanEndLine = 39, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">
import GHC.IO.Buffer
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 41, srcSpanStartColumn = 8, srcSpanEndLine = 41, srcSpanEndColumn = 31}, srcInfoPoints = []}) &quot;GHC.IO.Encoding.Failure&quot;"><span class="mpre">GHC.IO.Encoding.Failure</span></span><span class="mpre">
import GHC.IO.Encoding.Types
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 43, srcSpanStartColumn = 8, srcSpanEndLine = 43, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.List&quot;"><span class="mpre">GHC.List</span></span><span class="mpre"> (span)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 44, srcSpanStartColumn = 8, srcSpanEndLine = 44, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;GHC.Num&quot;"><span class="mpre">GHC.Num</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 45, srcSpanStartColumn = 8, srcSpanEndLine = 45, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Show&quot;"><span class="mpre">GHC.Show</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 46, srcSpanStartColumn = 8, srcSpanEndLine = 46, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Real&quot;"><span class="mpre">GHC.Real</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 47, srcSpanStartColumn = 8, srcSpanEndLine = 47, srcSpanEndColumn = 24}, srcInfoPoints = []}) &quot;System.IO.Unsafe&quot;"><span class="mpre">System.IO.Unsafe</span></span><span class="mpre"> (unsafePerformIO)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 48, srcSpanStartColumn = 8, srcSpanEndLine = 48, srcSpanEndColumn = 30}, srcInfoPoints = []}) &quot;System.Posix.Internals&quot;"><span class="mpre">System.Posix.Internals</span></span><span class="mpre">

</span><a href="#loc_51_1_51_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_13&#39;)"><span class="mpre">c_DEBUG_DUMP</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_51_1_51_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_13&#39;)"><span class="hl_vardecl"><span class="mpre">c_DEBUG_DUMP</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

</span><a href="#loc_54_1_54_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_12&#39;)"><span class="mpre">iconv_trace</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_54_1_54_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_12&#39;)"><span class="hl_fundecl"><span class="mpre">iconv_trace</span></span></a><span class="mpre"> </span><a name="loc_54_13_54_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_13_54_14&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">
 | </span><a href="#loc_51_1_51_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_13&#39;)"><span class="hl_varref"><span class="mpre">c_DEBUG_DUMP</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">puts</span></span><span class="mpre"> </span><a href="#loc_54_13_54_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_13_54_14&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
 | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">    = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- iconv encoders/decoders</span></span><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_63_1_63_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_1_63_19&#39;)"><span class="mpre">localeEncodingName</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_63_1_63_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_1_63_19&#39;)"><span class="mpre">localeEncodingName</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_63_1_63_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_1_63_19&#39;)"><span class="hl_vardecl"><span class="mpre">localeEncodingName</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
   </span><span class="hl_comment"><span class="mpre">-- Use locale_charset() or nl_langinfo(CODESET) to get the encoding</span></span><span class="mpre">
   </span><span class="hl_comment"><span class="mpre">-- if we have either of them.</span></span><span class="mpre">
   </span><a name="loc_66_4_66_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_4_66_8&#39;)"><span class="hl_vardecl"><span class="mpre">cstr</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">c_localeEncoding</span></span><span class="mpre">
   </span><span class="hl_varref"><span class="mpre">peekCAString</span></span><span class="mpre"> </span><a href="#loc_66_4_66_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_4_66_8&#39;)"><span class="hl_varref"><span class="mpre">cstr</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- Assume charset names are ASCII</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- We hope iconv_t is a storable type.  It should be, since it has at least the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- value -1, which is a possible return value from iconv_open.</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 71, srcSpanStartColumn = 1, srcSpanEndLine = 71, srcSpanEndColumn = 19}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 71, srcSpanStartColumn = 1, srcSpanEndLine = 71, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStart"><span class="mpre">type IConv = CLong</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ToDo: (#type iconv_t)</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 73, srcSpanStartColumn = 1, srcSpanEndLine = 74, srcSpanEndColumn = 52}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 73, srcSpanStartColumn = 1, srcSpanEndLine = 73, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLi"><span class="mpre">foreign import ccall unsafe &quot;hs_iconv_open&quot;
    hs_iconv_open :: CString -&gt; CString -&gt; IO IConv</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 76, srcSpanStartColumn = 1, srcSpanEndLine = 77, srcSpanEndColumn = 39}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 76, srcSpanStartColumn = 1, srcSpanEndLine = 76, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLi"><span class="mpre">foreign import ccall unsafe &quot;hs_iconv_close&quot;
    hs_iconv_close :: IConv -&gt; IO CInt</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 79, srcSpanStartColumn = 1, srcSpanEndLine = 81, srcSpanEndColumn = 22}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 79, srcSpanStartColumn = 1, srcSpanEndLine = 79, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLi"><span class="mpre">foreign import ccall unsafe &quot;hs_iconv&quot;
    hs_iconv :: IConv -&gt; Ptr CString -&gt; Ptr CSize -&gt; Ptr CString -&gt; Ptr CSize
          -&gt; IO CSize</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 83, srcSpanStartColumn = 1, srcSpanEndLine = 84, srcSpanEndColumn = 35}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 83, srcSpanStartColumn = 1, srcSpanEndLine = 83, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLi"><span class="mpre">foreign import ccall unsafe &quot;localeEncoding&quot;
    c_localeEncoding :: IO CString</span></span><span class="mpre">

</span><a href="#loc_88_1_88_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_12&#39;)"><span class="mpre">haskellChar</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
#ifdef WORDS_BIGENDIAN
</span><a name="loc_88_1_88_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_12&#39;)"><span class="hl_vardecl"><span class="mpre">haskellChar</span></span></a><span class="mpre"> | </span><a href="GHC.IO.Buffer.html#loc_157_1_157_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_157_1_157_9&#39;)"><span class="hl_varref"><span class="mpre">charSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;UTF-16BE&quot;</span></span><span class="mpre">
            | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">     = </span><span class="hl_string"><span class="mpre">&quot;UTF-32BE&quot;</span></span><span class="mpre">
#else
</span><span class="hl_vardecl"><span class="mpre">haskellChar</span></span><span class="mpre"> | </span><a href="GHC.IO.Buffer.html#loc_157_1_157_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_157_1_157_9&#39;)"><span class="hl_varref"><span class="mpre">charSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;UTF-16LE&quot;</span></span><span class="mpre">
            | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">     = </span><span class="hl_string"><span class="mpre">&quot;UTF-32LE&quot;</span></span><span class="mpre">
#endif

</span><a href="#loc_96_1_96_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_11&#39;)"><span class="mpre">char_shift</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_96_1_96_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_11&#39;)"><span class="hl_vardecl"><span class="mpre">char_shift</span></span></a><span class="mpre"> | </span><a href="GHC.IO.Buffer.html#loc_157_1_157_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_157_1_157_9&#39;)"><span class="hl_varref"><span class="mpre">charSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> = </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
           | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">     = </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">

</span><a href="#loc_100_1_100_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_14&#39;)"><span class="mpre">iconvEncoding</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.IO.Encoding.Types.html#loc_107_6_107_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.Types.html#loc_107_6_107_18&#39;)"><span class="hl_tyconref"><span class="mpre">TextEncoding</span></span></a><span class="mpre">
</span><a name="loc_100_1_100_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_14&#39;)"><span class="hl_vardecl"><span class="mpre">iconvEncoding</span></span></a><span class="mpre"> = </span><a href="#loc_103_1_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_1_103_16&#39;)"><span class="hl_varref"><span class="mpre">mkIconvEncoding</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">ErrorOnCodingFailure</span></span><span class="mpre">

</span><a href="#loc_103_1_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_1_103_16&#39;)"><span class="mpre">mkIconvEncoding</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">CodingFailureMode</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.IO.Encoding.Types.html#loc_107_6_107_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.Types.html#loc_107_6_107_18&#39;)"><span class="hl_tyconref"><span class="mpre">TextEncoding</span></span></a><span class="mpre">
</span><a name="loc_103_1_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_1_103_16&#39;)"><span class="hl_fundecl"><span class="mpre">mkIconvEncoding</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">cfm</span></span><span class="mpre"> </span><a name="loc_103_21_103_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_21_103_28&#39;)"><span class="hl_vardecl"><span class="mpre">charset</span></span></a><span class="mpre"> = do
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 104, srcSpanStartColumn = 11, srcSpanEndLine = 107, srcSpanEndColumn = 110}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 104, srcSpanStartColumn = 24, srcSpanEndLine = 104, srcSpanEndColumn = 25},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, src"><span class="mpre">TextEncoding { 
                textEncodingName = charset,
                mkTextDecoder = newIConv raw_charset (haskellChar ++ suffix) (recoverDecode cfm) iconvDecode,
                mkTextEncoder = newIConv haskellChar charset                 (recoverEncode cfm) iconvEncode}</span></span><span class="mpre">)
  where
    </span><span class="hl_comment"><span class="mpre">-- An annoying feature of GNU iconv is that the //PREFIXES only take</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- effect when they appear on the tocode parameter to iconv_open:</span></span><span class="mpre">
    (</span><span class="hl_vardecl"><span class="mpre">raw_charset</span></span><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">suffix</span></span><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">span</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;/&#39;</span></span><span class="mpre">) </span><a href="#loc_103_21_103_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_21_103_28&#39;)"><span class="hl_varref"><span class="mpre">charset</span></span></a><span class="mpre">

</span><a href="#loc_117_1_117_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_9&#39;)"><span class="mpre">newIConv</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
   -&gt; (</span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">))
   -&gt; (</span><span class="hl_tyconref"><span class="mpre">IConv</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="GHC.IO.Encoding.Types.html#loc_125_6_125_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.Types.html#loc_125_6_125_20&#39;)"><span class="hl_tyconref"><span class="mpre">CodingProgress</span></span></a><span class="mpre">, </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">))
   -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="GHC.IO.Encoding.Types.html#loc_36_6_36_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.Types.html#loc_36_6_36_17&#39;)"><span class="hl_tyconref"><span class="mpre">BufferCodec</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)
</span><a name="loc_117_1_117_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_9&#39;)"><span class="hl_fundecl"><span class="mpre">newIConv</span></span></a><span class="mpre"> </span><a name="loc_117_10_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_10_117_14&#39;)"><span class="hl_vardecl"><span class="mpre">from</span></span></a><span class="mpre"> </span><a name="loc_117_15_117_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_15_117_17&#39;)"><span class="hl_vardecl"><span class="mpre">to</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">rec</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">fn</span></span><span class="mpre"> =
  </span><span class="hl_comment"><span class="mpre">-- Assume charset names are ASCII</span></span><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">withCAString</span></span><span class="mpre"> </span><a href="#loc_117_10_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_10_117_14&#39;)"><span class="hl_varref"><span class="mpre">from</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_119_25_119_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_25_119_33&#39;)"><span class="hl_vardecl"><span class="mpre">from_str</span></span></a><span class="mpre"> -&gt;
  </span><span class="hl_varref"><span class="mpre">withCAString</span></span><span class="mpre"> </span><a href="#loc_117_15_117_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_15_117_17&#39;)"><span class="hl_varref"><span class="mpre">to</span></span></a><span class="mpre">   </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_120_25_120_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_25_120_31&#39;)"><span class="hl_vardecl"><span class="mpre">to_str</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_121_5_121_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_5_121_11&#39;)"><span class="hl_vardecl"><span class="mpre">iconvt</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">throwErrnoIfMinus1</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;mkTextEncoding&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">hs_iconv_open</span></span><span class="mpre"> </span><a href="#loc_120_25_120_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_25_120_31&#39;)"><span class="hl_varref"><span class="mpre">to_str</span></span></a><span class="mpre"> </span><a href="#loc_119_25_119_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_25_119_33&#39;)"><span class="hl_varref"><span class="mpre">from_str</span></span></a><span class="mpre">
    let </span><span class="hl_vardecl"><span class="mpre">iclose</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">throwErrnoIfMinus1_</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Iconv.close&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">hs_iconv_close</span></span><span class="mpre"> </span><a href="#loc_121_5_121_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_5_121_11&#39;)"><span class="hl_varref"><span class="mpre">iconvt</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 123, srcSpanStartColumn = 12, srcSpanEndLine = 130, srcSpanEndColumn = 18}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 123, srcSpanStartColumn = 23, srcSpanEndLine = 123, srcSpanEndColumn = 24},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcS"><span class="mpre">BufferCodec{
                encode = fn iconvt,
                recover = rec,
                close  = iclose,
                </span><span class="hl_comment"><span class="mpre">-- iconv doesn&#39;t supply a way to save/restore the state</span></span><span class="mpre">
                getState = return (),
                setState = const $ return ()
                }</span></span><span class="mpre">

</span><a href="#loc_133_1_133_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_12&#39;)"><span class="mpre">iconvDecode</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IConv</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">DecodeBuffer</span></span><span class="mpre">
</span><a name="loc_133_1_133_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_12&#39;)"><span class="hl_fundecl"><span class="mpre">iconvDecode</span></span></a><span class="mpre"> </span><a name="loc_133_13_133_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_13_133_20&#39;)"><span class="hl_vardecl"><span class="mpre">iconv_t</span></span></a><span class="mpre"> </span><a name="loc_133_21_133_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_21_133_25&#39;)"><span class="hl_vardecl"><span class="mpre">ibuf</span></span></a><span class="mpre"> </span><a name="loc_133_26_133_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_26_133_30&#39;)"><span class="hl_vardecl"><span class="mpre">obuf</span></span></a><span class="mpre"> = </span><a href="#loc_140_1_140_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_1_140_12&#39;)"><span class="hl_varref"><span class="mpre">iconvRecode</span></span></a><span class="mpre"> </span><a href="#loc_133_13_133_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_13_133_20&#39;)"><span class="hl_varref"><span class="mpre">iconv_t</span></span></a><span class="mpre"> </span><a href="#loc_133_21_133_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_21_133_25&#39;)"><span class="hl_varref"><span class="mpre">ibuf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_133_26_133_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_26_133_30&#39;)"><span class="hl_varref"><span class="mpre">obuf</span></span></a><span class="mpre"> </span><a href="#loc_96_1_96_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_11&#39;)"><span class="hl_varref"><span class="mpre">char_shift</span></span></a><span class="mpre">

</span><a href="#loc_136_1_136_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_1_136_12&#39;)"><span class="mpre">iconvEncode</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IConv</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">EncodeBuffer</span></span><span class="mpre">
</span><a name="loc_136_1_136_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_1_136_12&#39;)"><span class="hl_fundecl"><span class="mpre">iconvEncode</span></span></a><span class="mpre"> </span><a name="loc_136_13_136_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_13_136_20&#39;)"><span class="hl_vardecl"><span class="mpre">iconv_t</span></span></a><span class="mpre"> </span><a name="loc_136_21_136_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_21_136_25&#39;)"><span class="hl_vardecl"><span class="mpre">ibuf</span></span></a><span class="mpre"> </span><a name="loc_136_26_136_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_26_136_30&#39;)"><span class="hl_vardecl"><span class="mpre">obuf</span></span></a><span class="mpre"> = </span><a href="#loc_140_1_140_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_1_140_12&#39;)"><span class="hl_varref"><span class="mpre">iconvRecode</span></span></a><span class="mpre"> </span><a href="#loc_136_13_136_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_13_136_20&#39;)"><span class="hl_varref"><span class="mpre">iconv_t</span></span></a><span class="mpre"> </span><a href="#loc_136_21_136_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_21_136_25&#39;)"><span class="hl_varref"><span class="mpre">ibuf</span></span></a><span class="mpre"> </span><a href="#loc_96_1_96_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_11&#39;)"><span class="hl_varref"><span class="mpre">char_shift</span></span></a><span class="mpre"> </span><a href="#loc_136_26_136_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_26_136_30&#39;)"><span class="hl_varref"><span class="mpre">obuf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">

</span><a href="#loc_140_1_140_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_1_140_12&#39;)"><span class="mpre">iconvRecode</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IConv</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> 
            -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="GHC.IO.Encoding.Types.html#loc_125_6_125_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.Types.html#loc_125_6_125_20&#39;)"><span class="hl_tyconref"><span class="mpre">CodingProgress</span></span></a><span class="mpre">, </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)
</span><a name="loc_140_1_140_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_1_140_12&#39;)"><span class="hl_fundecl"><span class="mpre">iconvRecode</span></span></a><span class="mpre"> </span><a name="loc_140_13_140_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_13_140_20&#39;)"><span class="hl_vardecl"><span class="mpre">iconv_t</span></span></a><span class="mpre">
  </span><a name="loc_141_3_141_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_3_141_8&#39;)"><span class="hl_specname"><span class="mpre">input</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 141, srcSpanStartColumn = 9, srcSpanEndLine = 141, srcSpanEndColumn = 61}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 141, srcSpanStartColumn = 15, srcSpanEndLine = 141, srcSpanEndColumn = 16},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanSta"><span class="mpre">Buffer{  bufRaw=iraw, bufL=ir, bufR=iw, bufSize=_  }</span></span><span class="mpre">  </span><a name="loc_141_63_141_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_63_141_69&#39;)"><span class="hl_vardecl"><span class="mpre">iscale</span></span></a><span class="mpre">
  </span><a name="loc_142_3_142_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_3_142_9&#39;)"><span class="hl_specname"><span class="mpre">output</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 142, srcSpanStartColumn = 10, srcSpanEndLine = 142, srcSpanEndColumn = 61}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 142, srcSpanStartColumn = 16, srcSpanEndLine = 142, srcSpanEndColumn = 17},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanSt"><span class="mpre">Buffer{ bufRaw=oraw, bufL=_,  bufR=ow, bufSize=os }</span></span><span class="mpre">  </span><a name="loc_142_63_142_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_63_142_69&#39;)"><span class="hl_vardecl"><span class="mpre">oscale</span></span></a><span class="mpre">
  = do
    </span><a href="#loc_54_1_54_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_12&#39;)"><span class="hl_varref"><span class="mpre">iconv_trace</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;haskellChar=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_88_1_88_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_12&#39;)"><span class="hl_varref"><span class="mpre">haskellChar</span></span></a><span class="mpre">)
    </span><a href="#loc_54_1_54_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_12&#39;)"><span class="hl_varref"><span class="mpre">iconv_trace</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;iconvRecode before, input=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_141_3_141_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_3_141_8&#39;)"><span class="hl_varref"><span class="mpre">input</span></span></a><span class="mpre">))
    </span><a href="#loc_54_1_54_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_12&#39;)"><span class="hl_varref"><span class="mpre">iconv_trace</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;iconvRecode before, output=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_142_3_142_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_3_142_9&#39;)"><span class="hl_varref"><span class="mpre">output</span></span></a><span class="mpre">))
    </span><a href="GHC.IO.Buffer.html#loc_201_1_201_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_201_1_201_14&#39;)"><span class="hl_varref"><span class="mpre">withRawBuffer</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">iraw</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_147_28_147_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_28_147_33&#39;)"><span class="hl_vardecl"><span class="mpre">piraw</span></span></a><span class="mpre"> -&gt; do
    </span><a href="GHC.IO.Buffer.html#loc_201_1_201_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_201_1_201_14&#39;)"><span class="hl_varref"><span class="mpre">withRawBuffer</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">oraw</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_148_28_148_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_28_148_33&#39;)"><span class="hl_vardecl"><span class="mpre">poraw</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">with</span></span><span class="mpre"> (</span><a href="#loc_147_28_147_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_28_147_33&#39;)"><span class="hl_varref"><span class="mpre">piraw</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">ir</span></span><span class="mpre"> </span><a href="Data.Bits.html#loc_200_5_200_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_200_5_200_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftL`</span></span></a><span class="mpre"> </span><a href="#loc_141_63_141_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_63_141_69&#39;)"><span class="hl_varref"><span class="mpre">iscale</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_149_53_149_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_53_149_60&#39;)"><span class="hl_vardecl"><span class="mpre">p_inbuf</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">with</span></span><span class="mpre"> (</span><a href="#loc_148_28_148_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_28_148_33&#39;)"><span class="hl_varref"><span class="mpre">poraw</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">ow</span></span><span class="mpre"> </span><a href="Data.Bits.html#loc_200_5_200_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_200_5_200_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftL`</span></span></a><span class="mpre"> </span><a href="#loc_142_63_142_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_63_142_69&#39;)"><span class="hl_varref"><span class="mpre">oscale</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_150_53_150_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_53_150_61&#39;)"><span class="hl_vardecl"><span class="mpre">p_outbuf</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">with</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> ((</span><span class="hl_varref"><span class="mpre">iw</span></span><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_varref"><span class="mpre">ir</span></span><span class="mpre">) </span><a href="Data.Bits.html#loc_200_5_200_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_200_5_200_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftL`</span></span></a><span class="mpre"> </span><a href="#loc_141_63_141_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_63_141_69&#39;)"><span class="hl_varref"><span class="mpre">iscale</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_151_55_151_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_55_151_63&#39;)"><span class="hl_vardecl"><span class="mpre">p_inleft</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">with</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> ((</span><span class="hl_varref"><span class="mpre">os</span></span><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_varref"><span class="mpre">ow</span></span><span class="mpre">) </span><a href="Data.Bits.html#loc_200_5_200_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_200_5_200_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftL`</span></span></a><span class="mpre"> </span><a href="#loc_142_63_142_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_63_142_69&#39;)"><span class="hl_varref"><span class="mpre">oscale</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_152_55_152_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_55_152_64&#39;)"><span class="hl_vardecl"><span class="mpre">p_outleft</span></span></a><span class="mpre"> -&gt; do
      </span><a name="loc_153_7_153_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_7_153_10&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">hs_iconv</span></span><span class="mpre"> </span><a href="#loc_140_13_140_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_13_140_20&#39;)"><span class="hl_varref"><span class="mpre">iconv_t</span></span></a><span class="mpre"> </span><a href="#loc_149_53_149_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_53_149_60&#39;)"><span class="hl_varref"><span class="mpre">p_inbuf</span></span></a><span class="mpre"> </span><a href="#loc_151_55_151_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_55_151_63&#39;)"><span class="hl_varref"><span class="mpre">p_inleft</span></span></a><span class="mpre"> </span><a href="#loc_150_53_150_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_53_150_61&#39;)"><span class="hl_varref"><span class="mpre">p_outbuf</span></span></a><span class="mpre"> </span><a href="#loc_152_55_152_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_55_152_64&#39;)"><span class="hl_varref"><span class="mpre">p_outleft</span></span></a><span class="mpre">
      </span><a name="loc_154_7_154_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_7_154_17&#39;)"><span class="hl_vardecl"><span class="mpre">new_inleft</span></span></a><span class="mpre">  &lt;- </span><span class="hl_varref"><span class="mpre">peek</span></span><span class="mpre"> </span><a href="#loc_151_55_151_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_55_151_63&#39;)"><span class="hl_varref"><span class="mpre">p_inleft</span></span></a><span class="mpre">
      </span><a name="loc_155_7_155_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_7_155_18&#39;)"><span class="hl_vardecl"><span class="mpre">new_outleft</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peek</span></span><span class="mpre"> </span><a href="#loc_152_55_152_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_55_152_64&#39;)"><span class="hl_varref"><span class="mpre">p_outleft</span></span></a><span class="mpre">
      let 
          </span><span class="hl_vardecl"><span class="mpre">new_inleft&#39;</span></span><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_154_7_154_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_7_154_17&#39;)"><span class="hl_varref"><span class="mpre">new_inleft</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><a href="#loc_141_63_141_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_63_141_69&#39;)"><span class="hl_varref"><span class="mpre">iscale</span></span></a><span class="mpre">
          </span><a name="loc_158_11_158_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_11_158_23&#39;)"><span class="hl_vardecl"><span class="mpre">new_outleft&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_155_7_155_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_7_155_18&#39;)"><span class="hl_varref"><span class="mpre">new_outleft</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><a href="#loc_142_63_142_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_63_142_69&#39;)"><span class="hl_varref"><span class="mpre">oscale</span></span></a><span class="mpre">
          </span><a name="loc_159_11_159_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_11_159_20&#39;)"><span class="hl_vardecl"><span class="mpre">new_input</span></span></a><span class="mpre">  
            | </span><a href="#loc_154_7_154_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_7_154_17&#39;)"><span class="hl_varref"><span class="mpre">new_inleft</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">  = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 160, srcSpanStartColumn = 34, srcSpanEndLine = 160, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 160, srcSpanStartColumn = 40, srcSpanEndLine = 160, srcSpanEndColumn = 41},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcS"><span class="mpre">input { bufL = 0, bufR = 0 }</span></span><span class="mpre">
            | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">        = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 161, srcSpanStartColumn = 34, srcSpanEndLine = 161, srcSpanEndColumn = 67}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 161, srcSpanStartColumn = 40, srcSpanEndLine = 161, srcSpanEndColumn = 41},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcS"><span class="mpre">input { bufL = iw - new_inleft&#39; }</span></span><span class="mpre">
          </span><a name="loc_162_11_162_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_11_162_21&#39;)"><span class="hl_vardecl"><span class="mpre">new_output</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 162, srcSpanStartColumn = 24, srcSpanEndLine = 162, srcSpanEndColumn = 58}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcSpanStartLine = 162, srcSpanStartColumn = 30, srcSpanEndLine = 162, srcSpanEndColumn = 31},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Encoding/Iconv.hs&quot;, srcS"><span class="mpre">output{ bufR = os - new_outleft&#39; }</span></span><span class="mpre">
      </span><a href="#loc_54_1_54_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_12&#39;)"><span class="hl_varref"><span class="mpre">iconv_trace</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;iconv res=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_153_7_153_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_7_153_10&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">)
      </span><a href="#loc_54_1_54_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_12&#39;)"><span class="hl_varref"><span class="mpre">iconv_trace</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;iconvRecode after,  input=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_159_11_159_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_11_159_20&#39;)"><span class="hl_varref"><span class="mpre">new_input</span></span></a><span class="mpre">))
      </span><a href="#loc_54_1_54_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_12&#39;)"><span class="hl_varref"><span class="mpre">iconv_trace</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;iconvRecode after,  output=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_162_11_162_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_11_162_21&#39;)"><span class="hl_varref"><span class="mpre">new_output</span></span></a><span class="mpre">))
      if (</span><a href="#loc_153_7_153_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_7_153_10&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> -</span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
        then do </span><span class="hl_comment"><span class="mpre">-- all input translated</span></span><span class="mpre">
           </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="GHC.IO.Encoding.Types.html#loc_125_23_125_37" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.Types.html#loc_125_23_125_37&#39;)"><span class="hl_conref"><span class="mpre">InputUnderflow</span></span></a><span class="mpre">, </span><a href="#loc_159_11_159_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_11_159_20&#39;)"><span class="hl_varref"><span class="mpre">new_input</span></span></a><span class="mpre">, </span><a href="#loc_162_11_162_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_11_162_21&#39;)"><span class="hl_varref"><span class="mpre">new_output</span></span></a><span class="mpre">)
        else do
      </span><a name="loc_170_7_170_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_7_170_12&#39;)"><span class="hl_vardecl"><span class="mpre">errno</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getErrno</span></span><span class="mpre">
      case </span><a href="#loc_170_7_170_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_7_170_12&#39;)"><span class="hl_varref"><span class="mpre">errno</span></span></a><span class="mpre"> of
        </span><a name="loc_172_9_172_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_9_172_10&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> | </span><a href="#loc_172_9_172_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_9_172_10&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">e2BIG</span></span><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="GHC.IO.Encoding.Types.html#loc_127_23_127_38" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.Types.html#loc_127_23_127_38&#39;)"><span class="hl_conref"><span class="mpre">OutputUnderflow</span></span></a><span class="mpre">, </span><a href="#loc_159_11_159_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_11_159_20&#39;)"><span class="hl_varref"><span class="mpre">new_input</span></span></a><span class="mpre">, </span><a href="#loc_162_11_162_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_11_162_21&#39;)"><span class="hl_varref"><span class="mpre">new_output</span></span></a><span class="mpre">)
          | </span><a href="#loc_172_9_172_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_9_172_10&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">eINVAL</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="GHC.IO.Encoding.Types.html#loc_125_23_125_37" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.Types.html#loc_125_23_125_37&#39;)"><span class="hl_conref"><span class="mpre">InputUnderflow</span></span></a><span class="mpre">, </span><a href="#loc_159_11_159_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_11_159_20&#39;)"><span class="hl_varref"><span class="mpre">new_input</span></span></a><span class="mpre">, </span><a href="#loc_162_11_162_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_11_162_21&#39;)"><span class="hl_varref"><span class="mpre">new_output</span></span></a><span class="mpre">)
           </span><span class="hl_comment"><span class="mpre">-- Sometimes iconv reports EILSEQ for a</span></span><span class="mpre">
           </span><span class="hl_comment"><span class="mpre">-- character in the input even when there is no room</span></span><span class="mpre">
           </span><span class="hl_comment"><span class="mpre">-- in the output; in this case we might be about to</span></span><span class="mpre">
           </span><span class="hl_comment"><span class="mpre">-- change the encoding anyway, so the following bytes</span></span><span class="mpre">
           </span><span class="hl_comment"><span class="mpre">-- could very well be in a different encoding.</span></span><span class="mpre">
           </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
           </span><span class="hl_comment"><span class="mpre">-- Because we can only say InvalidSequence if there is at least</span></span><span class="mpre">
           </span><span class="hl_comment"><span class="mpre">-- one element left in the output, we have to special case this.</span></span><span class="mpre">
          | </span><a href="#loc_172_9_172_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_9_172_10&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">eILSEQ</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (if </span><a href="#loc_158_11_158_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_11_158_23&#39;)"><span class="hl_varref"><span class="mpre">new_outleft&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> then </span><a href="GHC.IO.Encoding.Types.html#loc_127_23_127_38" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.Types.html#loc_127_23_127_38&#39;)"><span class="hl_conref"><span class="mpre">OutputUnderflow</span></span></a><span class="mpre"> else </span><a href="GHC.IO.Encoding.Types.html#loc_128_23_128_38" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Encoding.Types.html#loc_128_23_128_38&#39;)"><span class="hl_conref"><span class="mpre">InvalidSequence</span></span></a><span class="mpre">, </span><a href="#loc_159_11_159_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_11_159_20&#39;)"><span class="hl_varref"><span class="mpre">new_input</span></span></a><span class="mpre">, </span><a href="#loc_162_11_162_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_11_162_21&#39;)"><span class="hl_varref"><span class="mpre">new_output</span></span></a><span class="mpre">)
          | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> -&gt; do
              </span><a href="#loc_54_1_54_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_12&#39;)"><span class="hl_varref"><span class="mpre">iconv_trace</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;iconv returned error: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">errnoToIOError</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;iconv&quot;</span></span><span class="mpre"> </span><a href="#loc_172_9_172_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_9_172_10&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">))
              </span><span class="hl_varref"><span class="mpre">throwErrno</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;iconvRecoder&quot;</span></span><span class="mpre">

#endif /* !mingw32_HOST_OS */

</span></div></body></html>