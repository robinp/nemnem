<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE RankNTypes #-}
{-# LANGUAGE CPP #-}
</span><span class="hl_comment"><span class="mpre">-- | Backend for Common Gateway Interface. Almost all users should use the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;run&#39; function.</span></span><span class="mpre">
module Network.Wai.Handler.CGI
    ( run
    , runSendfile
    , runGeneric
    , requestBodyFunc
    ) where

import Network.Wai
import Network.Wai.Internal
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Handler/CGI.hs&quot;, srcSpanStartLine = 15, srcSpanStartColumn = 8, srcSpanEndLine = 15, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre"> (getAddrInfo, addrAddress)
import Data.IORef
import Data.Maybe (</span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="mpre">fromMaybe</span></a><span class="mpre">)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Handler/CGI.hs&quot;, srcSpanStartLine = 18, srcSpanStartColumn = 18, srcSpanEndLine = 18, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as B
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Handler/CGI.hs&quot;, srcSpanStartLine = 19, srcSpanStartColumn = 18, srcSpanEndLine = 19, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L
import Control.Arrow (</span><a href="Control.Arrow.html#loc_107_5_107_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Arrow.html#loc_107_5_107_10&#39;)"><span class="mpre">(***)</span></a><span class="mpre">)
import Data.Char (</span><a href="GHC.Unicode.html#loc_143_1_143_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_143_1_143_8&#39;)"><span class="mpre">toLower</span></a><span class="mpre">)
import qualified System.IO
import qualified Data.String as String
import Data.Monoid (</span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="mpre">mconcat</span></a><span class="mpre">, </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="mpre">mempty</span></a><span class="mpre">)
import Blaze.ByteString.Builder (</span><a href="Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15&#39;)"><span class="mpre">fromByteString</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17&#39;)"><span class="mpre">toLazyByteString</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Internal.html#loc_139_1_139_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_139_1_139_6&#39;)"><span class="mpre">flush</span></a><span class="mpre">)
import Blaze.ByteString.Builder.Char8 (</span><a href="Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9&#39;)"><span class="mpre">fromChar</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Char8.html#loc_66_1_66_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char8.html#loc_66_1_66_11&#39;)"><span class="mpre">fromString</span></a><span class="mpre">)
import Data.ByteString.Lazy.Internal (</span><a href="Data.ByteString.Lazy.Internal.html#loc_208_1_208_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_208_1_208_17&#39;)"><span class="mpre">defaultChunkSize</span></a><span class="mpre">)
import System.IO (</span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="mpre">Handle</span></a><span class="mpre">)
import Network.HTTP.Types (</span><a href="Network.HTTP.Types.Status.html#loc_114_6_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_114_6_114_12&#39;)"><span class="mpre">Status</span></a><span class="mpre"> (..))
import qualified Network.HTTP.Types as H
import qualified Data.CaseInsensitive as CI
import Data.Monoid (</span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="mpre">mappend</span></a><span class="mpre">)
import qualified Data.Streaming.Blaze as Blaze
import Data.Function (</span><a href="Data.Function.html#loc_32_1_32_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Function.html#loc_32_1_32_4&#39;)"><span class="mpre">fix</span></a><span class="mpre">)
import Control.Monad (</span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="mpre">unless</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_195_1_195_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_195_1_195_5&#39;)"><span class="mpre">void</span></a><span class="mpre">)

#if WINDOWS
import System.Environment (getEnvironment)
#else
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Handler/CGI.hs&quot;, srcSpanStartLine = 40, srcSpanStartColumn = 18, srcSpanEndLine = 40, srcSpanEndColumn = 45}, srcInfoPoints = []}) &quot;System.Posix.Env.ByteString&quot;"><span class="mpre">System.Posix.Env.ByteString</span></span><span class="mpre"> as Env

</span><a href="#loc_43_1_43_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_15&#39;)"><span class="mpre">getEnvironment</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> [(</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">)]
</span><a name="loc_43_1_43_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_15&#39;)"><span class="hl_vardecl"><span class="mpre">getEnvironment</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.unpack</span></span><span class="mpre"> </span><a href="Control.Arrow.html#loc_107_5_107_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Arrow.html#loc_107_5_107_10&#39;)"><span class="hl_infix"><span class="mpre">***</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.unpack</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">Env.getEnvironment</span></span><span class="mpre">
#endif

</span><a href="#loc_47_1_47_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_1_47_9&#39;)"><span class="mpre">safeRead</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Handler/CGI.hs&quot;, srcSpanStartLine = 46, srcSpanStartColumn = 13, srcSpanEndLine = 46, srcSpanEndColumn = 22}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Handler/CGI.hs&quot;, srcSpanStartLine = 46, srcSpanStartColumn = 20, srcSpanEndLine = 46, srcSpanEndColumn = 22}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/p"><span class="mpre">Read a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_47_1_47_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_1_47_9&#39;)"><span class="hl_fundecl"><span class="mpre">safeRead</span></span></a><span class="mpre"> </span><a name="loc_47_10_47_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_10_47_11&#39;)"><span class="hl_vardecl"><span class="mpre">d</span></span></a><span class="mpre"> </span><a name="loc_47_12_47_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_12_47_13&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> =
  case </span><span class="hl_varref"><span class="mpre">reads</span></span><span class="mpre"> </span><a href="#loc_47_12_47_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_12_47_13&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
    ((</span><a name="loc_49_7_49_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_7_49_8&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">, _)</span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_) -&gt; </span><a href="#loc_49_7_49_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_7_49_8&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
    [] -&gt; </span><a href="#loc_47_10_47_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_10_47_11&#39;)"><span class="hl_varref"><span class="mpre">d</span></span></a><span class="mpre">

</span><a href="#loc_53_1_53_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_8&#39;)"><span class="mpre">lookup&#39;</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; [(</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">)] -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_53_1_53_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_8&#39;)"><span class="hl_fundecl"><span class="mpre">lookup&#39;</span></span></a><span class="mpre"> </span><a name="loc_53_9_53_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_12&#39;)"><span class="hl_vardecl"><span class="mpre">key</span></span></a><span class="mpre"> </span><a name="loc_53_13_53_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_13_53_18&#39;)"><span class="hl_vardecl"><span class="mpre">pairs</span></span></a><span class="mpre"> = </span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="hl_varref"><span class="mpre">fromMaybe</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><a href="#loc_53_9_53_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_12&#39;)"><span class="hl_varref"><span class="mpre">key</span></span></a><span class="mpre"> </span><a href="#loc_53_13_53_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_13_53_18&#39;)"><span class="hl_varref"><span class="mpre">pairs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Run an application using CGI.</span></span><span class="mpre">
</span><a href="#loc_57_1_57_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_4&#39;)"><span class="mpre">run</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Application</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_57_1_57_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_1_57_4&#39;)"><span class="hl_fundecl"><span class="mpre">run</span></span></a><span class="mpre"> </span><a name="loc_57_5_57_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_5_57_8&#39;)"><span class="hl_vardecl"><span class="mpre">app</span></span></a><span class="mpre"> = do
    </span><a name="loc_58_5_58_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_5_58_9&#39;)"><span class="hl_vardecl"><span class="mpre">vars</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_43_1_43_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_15&#39;)"><span class="hl_varref"><span class="mpre">getEnvironment</span></span></a><span class="mpre">
    let </span><a name="loc_59_9_59_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_9_59_14&#39;)"><span class="hl_vardecl"><span class="mpre">input</span></span></a><span class="mpre"> = </span><a href="#loc_183_1_183_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_18&#39;)"><span class="hl_varref"><span class="mpre">requestBodyHandle</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.FD.html#loc_52_1_52_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.FD.html#loc_52_1_52_6&#39;)"><span class="hl_varref"><span class="mpre">System.IO.stdin</span></span></a><span class="mpre">
        </span><a name="loc_60_9_60_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_9_60_15&#39;)"><span class="hl_vardecl"><span class="mpre">output</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.hPut</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.FD.html#loc_63_1_63_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.FD.html#loc_63_1_63_7&#39;)"><span class="hl_varref"><span class="mpre">System.IO.stdout</span></span></a><span class="mpre">
    </span><a href="#loc_84_1_84_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_11&#39;)"><span class="hl_varref"><span class="mpre">runGeneric</span></span></a><span class="mpre"> </span><a href="#loc_58_5_58_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_5_58_9&#39;)"><span class="hl_varref"><span class="mpre">vars</span></span></a><span class="mpre"> </span><a href="#loc_59_9_59_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_9_59_14&#39;)"><span class="hl_varref"><span class="mpre">input</span></span></a><span class="mpre"> </span><a href="#loc_60_9_60_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_9_60_15&#39;)"><span class="hl_varref"><span class="mpre">output</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> </span><a href="#loc_57_5_57_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_5_57_8&#39;)"><span class="hl_varref"><span class="mpre">app</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Some web servers provide an optimization for sending files via a sendfile</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- system call via a special header. To use this feature, provide that header</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- name here.</span></span><span class="mpre">
</span><a href="#loc_68_1_68_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_1_68_12&#39;)"><span class="mpre">runSendfile</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ sendfile header</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">Application</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_68_1_68_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_1_68_12&#39;)"><span class="hl_fundecl"><span class="mpre">runSendfile</span></span></a><span class="mpre"> </span><a name="loc_68_13_68_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_13_68_15&#39;)"><span class="hl_vardecl"><span class="mpre">sf</span></span></a><span class="mpre"> </span><a name="loc_68_16_68_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_16_68_19&#39;)"><span class="hl_vardecl"><span class="mpre">app</span></span></a><span class="mpre"> = do
    </span><a name="loc_69_5_69_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_5_69_9&#39;)"><span class="hl_vardecl"><span class="mpre">vars</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_43_1_43_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_15&#39;)"><span class="hl_varref"><span class="mpre">getEnvironment</span></span></a><span class="mpre">
    let </span><a name="loc_70_9_70_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_9_70_14&#39;)"><span class="hl_vardecl"><span class="mpre">input</span></span></a><span class="mpre"> = </span><a href="#loc_183_1_183_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_18&#39;)"><span class="hl_varref"><span class="mpre">requestBodyHandle</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.FD.html#loc_52_1_52_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.FD.html#loc_52_1_52_6&#39;)"><span class="hl_varref"><span class="mpre">System.IO.stdin</span></span></a><span class="mpre">
        </span><a name="loc_71_9_71_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_9_71_15&#39;)"><span class="hl_vardecl"><span class="mpre">output</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.hPut</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.FD.html#loc_63_1_63_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.FD.html#loc_63_1_63_7&#39;)"><span class="hl_varref"><span class="mpre">System.IO.stdout</span></span></a><span class="mpre">
    </span><a href="#loc_84_1_84_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_11&#39;)"><span class="hl_varref"><span class="mpre">runGeneric</span></span></a><span class="mpre"> </span><a href="#loc_69_5_69_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_5_69_9&#39;)"><span class="hl_varref"><span class="mpre">vars</span></span></a><span class="mpre"> </span><a href="#loc_70_9_70_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_9_70_14&#39;)"><span class="hl_varref"><span class="mpre">input</span></span></a><span class="mpre"> </span><a href="#loc_71_9_71_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_9_71_15&#39;)"><span class="hl_varref"><span class="mpre">output</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_68_13_68_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_13_68_15&#39;)"><span class="hl_varref"><span class="mpre">sf</span></span></a><span class="mpre">) </span><a href="#loc_68_16_68_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_16_68_19&#39;)"><span class="hl_varref"><span class="mpre">app</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A generic CGI helper, which allows other backends (FastCGI and SCGI) to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- use the same code as CGI. Most users will not need this function, and can</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- stick with &#39;run&#39; or &#39;runSendfile&#39;.</span></span><span class="mpre">
</span><a href="#loc_84_1_84_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_11&#39;)"><span class="mpre">runGeneric</span></a><span class="mpre">
     :: [(</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">)] </span><span class="hl_comment"><span class="mpre">-- ^ all variables</span></span><span class="mpre">
     -&gt; (</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">)) </span><span class="hl_comment"><span class="mpre">-- ^ responseBody of input</span></span><span class="mpre">
     -&gt; (</span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">) </span><span class="hl_comment"><span class="mpre">-- ^ destination for output</span></span><span class="mpre">
     -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ does the server support the X-Sendfile header?</span></span><span class="mpre">
     -&gt; </span><span class="hl_tyconref"><span class="mpre">Application</span></span><span class="mpre">
     -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_84_1_84_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_11&#39;)"><span class="hl_fundecl"><span class="mpre">runGeneric</span></span></a><span class="mpre"> </span><a name="loc_84_12_84_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_12_84_16&#39;)"><span class="hl_vardecl"><span class="mpre">vars</span></span></a><span class="mpre"> </span><a name="loc_84_17_84_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_17_84_23&#39;)"><span class="hl_vardecl"><span class="mpre">inputH</span></span></a><span class="mpre"> </span><a name="loc_84_24_84_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_24_84_31&#39;)"><span class="hl_vardecl"><span class="mpre">outputH</span></span></a><span class="mpre"> </span><a name="loc_84_32_84_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_32_84_41&#39;)"><span class="hl_vardecl"><span class="mpre">xsendfile</span></span></a><span class="mpre"> </span><a name="loc_84_42_84_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_42_84_45&#39;)"><span class="hl_vardecl"><span class="mpre">app</span></span></a><span class="mpre"> = do
    let </span><span class="hl_vardecl"><span class="mpre">rmethod</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.pack</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_53_1_53_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_8&#39;)"><span class="hl_varref"><span class="mpre">lookup&#39;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;REQUEST_METHOD&quot;</span></span><span class="mpre"> </span><a href="#loc_84_12_84_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_12_84_16&#39;)"><span class="hl_varref"><span class="mpre">vars</span></span></a><span class="mpre">
        </span><span class="hl_vardecl"><span class="mpre">pinfo</span></span><span class="mpre"> = </span><a href="#loc_53_1_53_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_8&#39;)"><span class="hl_varref"><span class="mpre">lookup&#39;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;PATH_INFO&quot;</span></span><span class="mpre"> </span><a href="#loc_84_12_84_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_12_84_16&#39;)"><span class="hl_varref"><span class="mpre">vars</span></span></a><span class="mpre">
        </span><span class="hl_vardecl"><span class="mpre">qstring</span></span><span class="mpre"> = </span><a href="#loc_53_1_53_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_8&#39;)"><span class="hl_varref"><span class="mpre">lookup&#39;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;QUERY_STRING&quot;</span></span><span class="mpre"> </span><a href="#loc_84_12_84_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_12_84_16&#39;)"><span class="hl_varref"><span class="mpre">vars</span></span></a><span class="mpre">
        </span><a name="loc_88_9_88_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_9_88_22&#39;)"><span class="hl_vardecl"><span class="mpre">contentLength</span></span></a><span class="mpre"> = </span><a href="#loc_47_1_47_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_1_47_9&#39;)"><span class="hl_varref"><span class="mpre">safeRead</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_53_1_53_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_8&#39;)"><span class="hl_varref"><span class="mpre">lookup&#39;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;CONTENT_LENGTH&quot;</span></span><span class="mpre"> </span><a href="#loc_84_12_84_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_12_84_16&#39;)"><span class="hl_varref"><span class="mpre">vars</span></span></a><span class="mpre">
        </span><a name="loc_89_9_89_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_9_89_20&#39;)"><span class="hl_vardecl"><span class="mpre">remoteHost&#39;</span></span></a><span class="mpre"> =
            case </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;REMOTE_ADDR&quot;</span></span><span class="mpre"> </span><a href="#loc_84_12_84_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_12_84_16&#39;)"><span class="hl_varref"><span class="mpre">vars</span></span></a><span class="mpre"> of
                </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_91_22_91_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_22_91_23&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_91_22_91_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_22_91_23&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
                </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt;
                    case </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;REMOTE_HOST&quot;</span></span><span class="mpre"> </span><a href="#loc_84_12_84_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_12_84_16&#39;)"><span class="hl_varref"><span class="mpre">vars</span></span></a><span class="mpre"> of
                        </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_94_30_94_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_30_94_31&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_94_30_94_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_30_94_31&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
                        </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
        </span><span class="hl_vardecl"><span class="mpre">isSecure&#39;</span></span><span class="mpre"> =
            case </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="GHC.Unicode.html#loc_143_1_143_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_143_1_143_8&#39;)"><span class="hl_varref"><span class="mpre">toLower</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_53_1_53_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_8&#39;)"><span class="hl_varref"><span class="mpre">lookup&#39;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;SERVER_PROTOCOL&quot;</span></span><span class="mpre"> </span><a href="#loc_84_12_84_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_12_84_16&#39;)"><span class="hl_varref"><span class="mpre">vars</span></span></a><span class="mpre"> of
                </span><span class="hl_string"><span class="mpre">&quot;https&quot;</span></span><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
                _ -&gt; </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
    </span><a name="loc_100_5_100_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_5_100_10&#39;)"><span class="hl_vardecl"><span class="mpre">addrs</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getAddrInfo</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_89_9_89_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_9_89_20&#39;)"><span class="hl_varref"><span class="mpre">remoteHost&#39;</span></span></a><span class="mpre">) </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">requestBody&#39;</span></span><span class="mpre"> &lt;- </span><a href="#loc_84_17_84_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_17_84_23&#39;)"><span class="hl_varref"><span class="mpre">inputH</span></span></a><span class="mpre"> </span><a href="#loc_88_9_88_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_9_88_22&#39;)"><span class="hl_varref"><span class="mpre">contentLength</span></span></a><span class="mpre">
    let </span><span class="hl_vardecl"><span class="mpre">addr</span></span><span class="mpre"> =
            case </span><a href="#loc_100_5_100_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_5_100_10&#39;)"><span class="hl_varref"><span class="mpre">addrs</span></span></a><span class="mpre"> of
                </span><a name="loc_104_17_104_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_17_104_18&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_ -&gt; </span><span class="hl_varref"><span class="mpre">addrAddress</span></span><span class="mpre"> </span><a href="#loc_104_17_104_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_17_104_18&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
                [] -&gt; </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Invalid REMOTE_ADDR or REMOTE_HOST: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_89_9_89_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_9_89_20&#39;)"><span class="hl_varref"><span class="mpre">remoteHost&#39;</span></span></a><span class="mpre">
        </span><span class="hl_vardecl"><span class="mpre">reqHeaders</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> (</span><a href="#loc_170_1_170_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_15&#39;)"><span class="hl_varref"><span class="mpre">cleanupVarName</span></span></a><span class="mpre"> </span><a href="Control.Arrow.html#loc_107_5_107_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Arrow.html#loc_107_5_107_10&#39;)"><span class="hl_infix"><span class="mpre">***</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.pack</span></span><span class="mpre">) </span><a href="#loc_84_12_84_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_12_84_16&#39;)"><span class="hl_varref"><span class="mpre">vars</span></span></a><span class="mpre">
        </span><a name="loc_107_9_107_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_12&#39;)"><span class="hl_vardecl"><span class="mpre">env</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Handler/CGI.hs&quot;, srcSpanStartLine = 107, srcSpanStartColumn = 15, srcSpanEndLine = 122, srcSpanEndColumn = 14}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Handler/CGI.hs&quot;, srcSpanStartLine = 108, srcSpanStartColumn = 13, srcSpanEndLine = 108, srcSpanEndColumn = 14},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/"><span class="mpre">Request
            { requestMethod = rmethod
            , rawPathInfo = B.pack pinfo
            , pathInfo = H.decodePathSegments $ B.pack pinfo
            , rawQueryString = B.pack qstring
            , queryString = H.parseQuery $ B.pack qstring
            , requestHeaders = reqHeaders
            , isSecure = isSecure&#39;
            , remoteHost = addr
            , httpVersion = H.http11 </span><span class="hl_comment"><span class="mpre">-- FIXME</span></span><span class="mpre">
            , requestBody = requestBody&#39;
            , vault = mempty
            , requestBodyLength = KnownLength $ fromIntegral contentLength
            , requestHeaderHost = lookup &quot;host&quot; reqHeaders
            , requestHeaderRange = lookup &quot;range&quot; reqHeaders
            }</span></span><span class="mpre">
    </span><a href="Control.Monad.html#loc_195_1_195_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_195_1_195_5&#39;)"><span class="hl_varref"><span class="mpre">void</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_84_42_84_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_42_84_45&#39;)"><span class="hl_varref"><span class="mpre">app</span></span></a><span class="mpre"> </span><a href="#loc_107_9_107_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_12&#39;)"><span class="hl_varref"><span class="mpre">env</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_123_23_123_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_23_123_26&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> -&gt;
        case (</span><a href="#loc_84_32_84_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_32_84_41&#39;)"><span class="hl_varref"><span class="mpre">xsendfile</span></span></a><span class="mpre">, </span><a href="#loc_123_23_123_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_23_123_26&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">) of
            (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_125_19_125_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_19_125_21&#39;)"><span class="hl_vardecl"><span class="mpre">sf</span></span></a><span class="mpre">, </span><a href="Network.Wai.Internal.html#loc_75_7_75_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_75_7_75_19&#39;)"><span class="hl_conref"><span class="mpre">ResponseFile</span></span></a><span class="mpre"> </span><a name="loc_125_36_125_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_36_125_37&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_125_38_125_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_38_125_40&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> </span><a name="loc_125_41_125_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_41_125_43&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">) -&gt; do
                </span><span class="hl_varref"><span class="mpre">mapM_</span></span><span class="mpre"> </span><a href="#loc_84_24_84_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_24_84_31&#39;)"><span class="hl_varref"><span class="mpre">outputH</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.toChunks</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17&#39;)"><span class="hl_varref"><span class="mpre">toLazyByteString</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_157_5_157_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_5_157_14&#39;)"><span class="hl_varref"><span class="mpre">sfBuilder</span></span></a><span class="mpre"> </span><a href="#loc_125_36_125_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_36_125_37&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_125_38_125_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_38_125_40&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> </span><a href="#loc_125_19_125_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_19_125_21&#39;)"><span class="hl_varref"><span class="mpre">sf</span></span></a><span class="mpre"> </span><a href="#loc_125_41_125_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_41_125_43&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Network.Wai.Internal.html#loc_112_25_112_41" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_112_25_112_41&#39;)"><span class="hl_conref"><span class="mpre">ResponseReceived</span></span></a><span class="mpre">
            _ -&gt; do
                let (</span><a name="loc_129_22_129_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_22_129_23&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">, </span><a name="loc_129_25_129_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_25_129_27&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre">, </span><a name="loc_129_29_129_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_29_129_31&#39;)"><span class="hl_vardecl"><span class="mpre">wb</span></span></a><span class="mpre">) = </span><a href="Network.Wai.html#loc_198_1_198_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_198_1_198_17&#39;)"><span class="hl_varref"><span class="mpre">responseToStream</span></span></a><span class="mpre"> </span><a href="#loc_123_23_123_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_23_123_26&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">
                (</span><a name="loc_130_18_130_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_18_130_27&#39;)"><span class="hl_vardecl"><span class="mpre">blazeRecv</span></span></a><span class="mpre">, </span><a name="loc_130_29_130_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_29_130_40&#39;)"><span class="hl_vardecl"><span class="mpre">blazeFinish</span></span></a><span class="mpre">) &lt;- </span><a href="Data.Streaming.Blaze.html#loc_64_1_64_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Streaming.Blaze.html#loc_64_1_64_13&#39;)"><span class="hl_varref"><span class="mpre">Blaze.newBlazeRecv</span></span></a><span class="mpre"> </span><a href="Data.Streaming.Blaze.html#loc_61_1_61_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Streaming.Blaze.html#loc_61_1_61_16&#39;)"><span class="hl_varref"><span class="mpre">Blaze.defaultStrategy</span></span></a><span class="mpre">
                </span><a href="#loc_129_29_129_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_29_129_31&#39;)"><span class="hl_varref"><span class="mpre">wb</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_131_23_131_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_23_131_24&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> -&gt; do
                    let </span><a name="loc_132_25_132_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_25_132_36&#39;)"><span class="hl_fundecl"><span class="mpre">sendBuilder</span></span></a><span class="mpre"> </span><a name="loc_132_37_132_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_37_132_44&#39;)"><span class="hl_vardecl"><span class="mpre">builder</span></span></a><span class="mpre"> = do
                            </span><a name="loc_133_29_133_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_29_133_35&#39;)"><span class="hl_vardecl"><span class="mpre">popper</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_130_18_130_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_18_130_27&#39;)"><span class="hl_varref"><span class="mpre">blazeRecv</span></span></a><span class="mpre"> </span><a href="#loc_132_37_132_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_37_132_44&#39;)"><span class="hl_varref"><span class="mpre">builder</span></span></a><span class="mpre">
                            </span><a href="Data.Function.html#loc_32_1_32_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Function.html#loc_32_1_32_4&#39;)"><span class="hl_varref"><span class="mpre">fix</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_134_36_134_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_36_134_40&#39;)"><span class="hl_vardecl"><span class="mpre">loop</span></span></a><span class="mpre"> -&gt; do
                                </span><a name="loc_135_33_135_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_33_135_35&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_133_29_133_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_29_133_35&#39;)"><span class="hl_varref"><span class="mpre">popper</span></span></a><span class="mpre">
                                </span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="hl_varref"><span class="mpre">unless</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">B.null</span></span><span class="mpre"> </span><a href="#loc_135_33_135_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_33_135_35&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
                                    </span><a href="#loc_84_24_84_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_24_84_31&#39;)"><span class="hl_varref"><span class="mpre">outputH</span></span></a><span class="mpre"> </span><a href="#loc_135_33_135_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_33_135_35&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
                                    </span><a href="#loc_134_36_134_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_36_134_40&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre">
                    </span><a href="#loc_132_25_132_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_25_132_36&#39;)"><span class="hl_varref"><span class="mpre">sendBuilder</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_144_5_144_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_5_144_12&#39;)"><span class="hl_varref"><span class="mpre">headers</span></span></a><span class="mpre"> </span><a href="#loc_129_22_129_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_22_129_23&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_129_25_129_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_25_129_27&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_infix"><span class="mpre">`mappend`</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9&#39;)"><span class="hl_varref"><span class="mpre">fromChar</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre">
                    </span><a href="#loc_131_23_131_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_23_131_24&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><a href="#loc_132_25_132_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_25_132_36&#39;)"><span class="hl_varref"><span class="mpre">sendBuilder</span></span></a><span class="mpre"> (</span><a href="#loc_132_25_132_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_25_132_36&#39;)"><span class="hl_varref"><span class="mpre">sendBuilder</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.html#loc_139_1_139_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_139_1_139_6&#39;)"><span class="hl_varref"><span class="mpre">flush</span></span></a><span class="mpre">)
                </span><a href="#loc_130_29_130_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_29_130_40&#39;)"><span class="hl_varref"><span class="mpre">blazeFinish</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">) </span><a href="#loc_84_24_84_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_24_84_31&#39;)"><span class="hl_varref"><span class="mpre">outputH</span></span></a><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Network.Wai.Internal.html#loc_112_25_112_41" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_112_25_112_41&#39;)"><span class="hl_conref"><span class="mpre">ResponseReceived</span></span></a><span class="mpre">
  where
    </span><a name="loc_144_5_144_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_5_144_12&#39;)"><span class="hl_fundecl"><span class="mpre">headers</span></span></a><span class="mpre"> </span><a name="loc_144_13_144_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_13_144_14&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_144_15_144_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_15_144_17&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> = </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_151_5_151_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_5_151_11&#39;)"><span class="hl_varref"><span class="mpre">header</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_145_5_145_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_5_145_11&#39;)"><span class="hl_varref"><span class="mpre">status</span></span></a><span class="mpre"> </span><a href="#loc_144_13_144_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_13_144_14&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_150_5_150_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_5_150_12&#39;)"><span class="hl_varref"><span class="mpre">header&#39;</span></span></a><span class="mpre"> (</span><a href="#loc_164_5_164_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_5_164_15&#39;)"><span class="hl_varref"><span class="mpre">fixHeaders</span></span></a><span class="mpre"> </span><a href="#loc_144_15_144_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_15_144_17&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">))
    </span><a name="loc_145_5_145_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_5_145_11&#39;)"><span class="hl_fundecl"><span class="mpre">status</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Status</span></span><span class="mpre"> </span><a name="loc_145_20_145_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_20_145_21&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> </span><a name="loc_145_22_145_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_22_145_23&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) = (</span><a href="Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15&#39;)"><span class="hl_varref"><span class="mpre">fromByteString</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Status&quot;</span></span><span class="mpre">, </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre">
        [ </span><a href="Blaze.ByteString.Builder.Char8.html#loc_66_1_66_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char8.html#loc_66_1_66_11&#39;)"><span class="hl_varref"><span class="mpre">fromString</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_145_20_145_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_20_145_21&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
        , </span><a href="Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9&#39;)"><span class="hl_varref"><span class="mpre">fromChar</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39; &#39;</span></span><span class="mpre">
        , </span><a href="Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15&#39;)"><span class="hl_varref"><span class="mpre">fromByteString</span></span></a><span class="mpre"> </span><a href="#loc_145_22_145_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_22_145_23&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
        ])
    </span><a name="loc_150_5_150_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_5_150_12&#39;)"><span class="hl_fundecl"><span class="mpre">header&#39;</span></span></a><span class="mpre"> (</span><a name="loc_150_14_150_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_14_150_15&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">, </span><a name="loc_150_17_150_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_17_150_18&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre">) = (</span><a href="Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15&#39;)"><span class="hl_varref"><span class="mpre">fromByteString</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.CaseInsensitive.Internal.html#loc_86_18_86_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.CaseInsensitive.Internal.html#loc_86_18_86_26&#39;)"><span class="hl_varref"><span class="mpre">CI.original</span></span></a><span class="mpre"> </span><a href="#loc_150_14_150_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_14_150_15&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15&#39;)"><span class="hl_varref"><span class="mpre">fromByteString</span></span></a><span class="mpre"> </span><a href="#loc_150_17_150_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_17_150_18&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">)
    </span><a name="loc_151_5_151_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_5_151_11&#39;)"><span class="hl_fundecl"><span class="mpre">header</span></span></a><span class="mpre"> (</span><a name="loc_151_13_151_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_13_151_14&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">, </span><a name="loc_151_16_151_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_16_151_17&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre">) = </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre">
        [ </span><a href="#loc_151_13_151_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_13_151_14&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
        , </span><a href="Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15&#39;)"><span class="hl_varref"><span class="mpre">fromByteString</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;: &quot;</span></span><span class="mpre">
        , </span><a href="#loc_151_16_151_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_16_151_17&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">
        , </span><a href="Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9&#39;)"><span class="hl_varref"><span class="mpre">fromChar</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre">
        ]
    </span><a name="loc_157_5_157_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_5_157_14&#39;)"><span class="hl_fundecl"><span class="mpre">sfBuilder</span></span></a><span class="mpre"> </span><a name="loc_157_15_157_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_15_157_16&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_157_17_157_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_17_157_19&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> </span><a name="loc_157_20_157_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_20_157_22&#39;)"><span class="hl_vardecl"><span class="mpre">sf</span></span></a><span class="mpre"> </span><a name="loc_157_23_157_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_23_157_25&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> = </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre">
        [ </span><a href="#loc_144_5_144_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_5_144_12&#39;)"><span class="hl_varref"><span class="mpre">headers</span></span></a><span class="mpre"> </span><a href="#loc_157_15_157_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_15_157_16&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_157_17_157_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_17_157_19&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">
        , </span><a href="#loc_151_5_151_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_5_151_11&#39;)"><span class="hl_varref"><span class="mpre">header</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> (</span><a href="Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15&#39;)"><span class="hl_varref"><span class="mpre">fromByteString</span></span></a><span class="mpre"> </span><a href="#loc_157_20_157_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_20_157_22&#39;)"><span class="hl_varref"><span class="mpre">sf</span></span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Char8.html#loc_66_1_66_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char8.html#loc_66_1_66_11&#39;)"><span class="hl_varref"><span class="mpre">fromString</span></span></a><span class="mpre"> </span><a href="#loc_157_23_157_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_23_157_25&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">)
        , </span><a href="Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Char8.html#loc_61_1_61_9&#39;)"><span class="hl_varref"><span class="mpre">fromChar</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre">
        , </span><a href="Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15&#39;)"><span class="hl_varref"><span class="mpre">fromByteString</span></span></a><span class="mpre"> </span><a href="#loc_157_20_157_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_20_157_22&#39;)"><span class="hl_varref"><span class="mpre">sf</span></span></a><span class="mpre">
        , </span><a href="Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.ByteString.html#loc_94_1_94_15&#39;)"><span class="hl_varref"><span class="mpre">fromByteString</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; not supported&quot;</span></span><span class="mpre">
        ]
    </span><a name="loc_164_5_164_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_5_164_15&#39;)"><span class="hl_fundecl"><span class="mpre">fixHeaders</span></span></a><span class="mpre"> </span><a name="loc_164_16_164_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_16_164_17&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> =
        case </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;content-type&quot;</span></span><span class="mpre"> </span><a href="#loc_164_16_164_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_16_164_17&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; (</span><span class="hl_string"><span class="mpre">&quot;Content-Type&quot;</span></span><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;text/html; charset=utf-8&quot;</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_164_16_164_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_16_164_17&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
            </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> _ -&gt; </span><a href="#loc_164_16_164_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_16_164_17&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">

</span><a href="#loc_170_1_170_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_15&#39;)"><span class="mpre">cleanupVarName</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="Data.CaseInsensitive.Internal.html#loc_86_6_86_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.CaseInsensitive.Internal.html#loc_86_6_86_8&#39;)"><span class="hl_tyconref"><span class="mpre">CI.CI</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">
</span><a name="loc_170_1_170_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_15&#39;)"><span class="hl_fundecl"><span class="mpre">cleanupVarName</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;CONTENT_TYPE&quot;</span></span><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;Content-Type&quot;</span></span><span class="mpre">
</span><a href="#loc_170_1_170_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_15&#39;)"><span class="hl_fundecl"><span class="mpre">cleanupVarName</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;CONTENT_LENGTH&quot;</span></span><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;Content-Length&quot;</span></span><span class="mpre">
</span><a href="#loc_170_1_170_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_15&#39;)"><span class="hl_fundecl"><span class="mpre">cleanupVarName</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;SCRIPT_NAME&quot;</span></span><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;CGI-Script-Name&quot;</span></span><span class="mpre">
</span><a href="#loc_170_1_170_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_15&#39;)"><span class="hl_fundecl"><span class="mpre">cleanupVarName</span></span></a><span class="mpre"> </span><a name="loc_173_16_173_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_16_173_17&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> =
    case </span><a href="#loc_173_16_173_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_16_173_17&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
        </span><span class="hl_char"><span class="mpre">&#39;H&#39;</span></span><span class="hl_infix"><span class="mpre">:</span></span><span class="hl_char"><span class="mpre">&#39;T&#39;</span></span><span class="hl_infix"><span class="mpre">:</span></span><span class="hl_char"><span class="mpre">&#39;T&#39;</span></span><span class="hl_infix"><span class="mpre">:</span></span><span class="hl_char"><span class="mpre">&#39;P&#39;</span></span><span class="hl_infix"><span class="mpre">:</span></span><span class="hl_char"><span class="mpre">&#39;_&#39;</span></span><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_175_29_175_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_29_175_30&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_175_31_175_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_31_175_33&#39;)"><span class="hl_vardecl"><span class="mpre">as</span></span></a><span class="mpre"> -&gt; </span><a href="Data.String.html#loc_35_5_35_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.String.html#loc_35_5_35_15&#39;)"><span class="hl_varref"><span class="mpre">String.fromString</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_175_29_175_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_29_175_30&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_178_5_178_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_5_178_12&#39;)"><span class="hl_varref"><span class="mpre">helper&#39;</span></span></a><span class="mpre"> </span><a href="#loc_175_31_175_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_31_175_33&#39;)"><span class="hl_varref"><span class="mpre">as</span></span></a><span class="mpre">
        _ -&gt; </span><a href="Data.String.html#loc_35_5_35_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.String.html#loc_35_5_35_15&#39;)"><span class="hl_varref"><span class="mpre">String.fromString</span></span></a><span class="mpre"> </span><a href="#loc_173_16_173_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_16_173_17&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- FIXME remove?</span></span><span class="mpre">
  where
    </span><a name="loc_178_5_178_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_5_178_12&#39;)"><span class="hl_fundecl"><span class="mpre">helper&#39;</span></span></a><span class="mpre"> (</span><span class="hl_char"><span class="mpre">&#39;_&#39;</span></span><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_178_18_178_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_18_178_19&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_178_20_178_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_20_178_24&#39;)"><span class="hl_vardecl"><span class="mpre">rest</span></span></a><span class="mpre">) = </span><span class="hl_char"><span class="mpre">&#39;-&#39;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_178_18_178_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_18_178_19&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_178_5_178_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_5_178_12&#39;)"><span class="hl_varref"><span class="mpre">helper&#39;</span></span></a><span class="mpre"> </span><a href="#loc_178_20_178_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_20_178_24&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre">
    </span><a href="#loc_178_5_178_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_5_178_12&#39;)"><span class="hl_fundecl"><span class="mpre">helper&#39;</span></span></a><span class="mpre"> (</span><a name="loc_179_14_179_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_14_179_15&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_179_16_179_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_16_179_20&#39;)"><span class="hl_vardecl"><span class="mpre">rest</span></span></a><span class="mpre">) = </span><a href="GHC.Unicode.html#loc_143_1_143_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_143_1_143_8&#39;)"><span class="hl_varref"><span class="mpre">toLower</span></span></a><span class="mpre"> </span><a href="#loc_179_14_179_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_14_179_15&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_178_5_178_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_5_178_12&#39;)"><span class="hl_varref"><span class="mpre">helper&#39;</span></span></a><span class="mpre"> </span><a href="#loc_179_16_179_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_16_179_20&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre">
    </span><a href="#loc_178_5_178_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_5_178_12&#39;)"><span class="hl_fundecl"><span class="mpre">helper&#39;</span></span></a><span class="mpre"> [] = []

</span><a href="#loc_183_1_183_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_18&#39;)"><span class="mpre">requestBodyHandle</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">)
</span><a name="loc_183_1_183_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_18&#39;)"><span class="hl_fundecl"><span class="mpre">requestBodyHandle</span></span></a><span class="mpre"> </span><a name="loc_183_19_183_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_19_183_20&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> = </span><a href="#loc_188_1_188_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_1_188_16&#39;)"><span class="hl_varref"><span class="mpre">requestBodyFunc</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_183_42_183_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_42_183_43&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_184_5_184_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_5_184_7&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">B.hGet</span></span><span class="mpre"> </span><a href="#loc_183_19_183_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_19_183_20&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_183_42_183_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_42_183_43&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> if </span><span class="hl_varref"><span class="mpre">B.null</span></span><span class="mpre"> </span><a href="#loc_184_5_184_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_5_184_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> then </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> else </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_184_5_184_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_5_184_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">

</span><a href="#loc_188_1_188_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_1_188_16&#39;)"><span class="mpre">requestBodyFunc</span></a><span class="mpre"> :: (</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">)) -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre">)
</span><a name="loc_188_1_188_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_1_188_16&#39;)"><span class="hl_fundecl"><span class="mpre">requestBodyFunc</span></span></a><span class="mpre"> </span><a name="loc_188_17_188_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_17_188_20&#39;)"><span class="hl_vardecl"><span class="mpre">get</span></span></a><span class="mpre"> </span><a name="loc_188_21_188_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_21_188_27&#39;)"><span class="hl_vardecl"><span class="mpre">count0</span></span></a><span class="mpre"> = do
    </span><a name="loc_189_5_189_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_5_189_8&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_188_21_188_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_21_188_27&#39;)"><span class="hl_varref"><span class="mpre">count0</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><a name="loc_191_9_191_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_9_191_14&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_189_5_189_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_5_189_8&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">
        if </span><a href="#loc_191_9_191_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_9_191_14&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
            then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre">
            else do
                </span><a name="loc_195_17_195_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_17_195_20&#39;)"><span class="hl_vardecl"><span class="mpre">mbs</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_188_17_188_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_17_188_20&#39;)"><span class="hl_varref"><span class="mpre">get</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">min</span></span><span class="mpre"> </span><a href="#loc_191_9_191_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_9_191_14&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><a href="Data.ByteString.Lazy.Internal.html#loc_208_1_208_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_208_1_208_17&#39;)"><span class="hl_varref"><span class="mpre">defaultChunkSize</span></span></a><span class="mpre">
                </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_189_5_189_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_5_189_8&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_191_9_191_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_9_191_14&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_195_17_195_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_17_195_20&#39;)"><span class="hl_varref"><span class="mpre">mbs</span></span></a><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_98_1_98_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_98_1_98_10&#39;)"><span class="hl_varref"><span class="mpre">fromMaybe</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.empty</span></span><span class="mpre"> </span><a href="#loc_195_17_195_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_17_195_20&#39;)"><span class="hl_varref"><span class="mpre">mbs</span></span></a><span class="mpre">
</span></div></body></html>