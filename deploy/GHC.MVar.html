<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Unsafe, DeriveDataTypeable #-}
{-# LANGUAGE NoImplicitPrelude, MagicHash, UnboxedTuples #-}
{-# OPTIONS_GHC -funbox-strict-fields #-}
{-# OPTIONS_HADDOCK hide #-}

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  GHC.MVar</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow 2008</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  see libraries/base/LICENSE</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  cvs-ghc@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  internal</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (GHC Extensions)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The MVar type</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module GHC.MVar (
        </span><span class="hl_comment"><span class="mpre">-- * MVars</span></span><span class="mpre">
          MVar(..)
        , newMVar
        , newEmptyMVar
        , takeMVar
        , readMVar
        , putMVar
        , tryTakeMVar
        , tryPutMVar
        , tryReadMVar
        , isEmptyMVar
        , addMVarFinalizer
    ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/MVar.hs&quot;, srcSpanStartLine = 35, srcSpanStartColumn = 8, srcSpanEndLine = 35, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">
import Data.Maybe
import Data.Typeable

data </span><a name="loc_39_6_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_6_39_10&#39;)"><span class="hl_tycondecl"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_39_15_39_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_19&#39;)"><span class="hl_condecl"><span class="mpre">MVar</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">MVar#</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">RealWorld</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/MVar.hs&quot;, srcSpanStartLine = 39, srcSpanStartColumn = 40, srcSpanEndLine = 39, srcSpanEndColumn = 60}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/MVar.hs&quot;, srcSpanStartLine = 39, srcSpanStartColumn = 40, srcSpanEndLine = 39, srcSpanEndColumn = 48},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/MVar.hs&quot;, srcSpanStartLine = 39, srcSpanStartColumn = 48, "><span class="mpre">deriving( Typeable )</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">{- ^
An &#39;MVar&#39; (pronounced \&quot;em-var\&quot;) is a synchronising variable, used
for communication between concurrent threads.  It can be thought of
as a a box, which may be empty or full.
-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- pull in Eq (Mvar a) too, to avoid GHC.Conc being an orphan-instance module</span></span><span class="mpre">
instance </span><span class="hl_classref"><span class="mpre">Eq</span></span><span class="mpre"> (</span><a href="#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) where
        (</span><a href="#loc_39_15_39_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_19&#39;)"><span class="hl_conref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a name="loc_48_15_48_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_15_48_21&#39;)"><span class="hl_vardecl"><span class="mpre">mvar1#</span></span></a><span class="mpre">) </span><span class="hl_fundecl"><span class="mpre">==</span></span><span class="mpre"> (</span><a href="#loc_39_15_39_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_19&#39;)"><span class="hl_conref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a name="loc_48_32_48_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_32_48_38&#39;)"><span class="hl_vardecl"><span class="mpre">mvar2#</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">isTrue#</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">sameMVar#</span></span><span class="mpre"> </span><a href="#loc_48_15_48_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_15_48_21&#39;)"><span class="hl_varref"><span class="mpre">mvar1#</span></span></a><span class="mpre"> </span><a href="#loc_48_32_48_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_32_48_38&#39;)"><span class="hl_varref"><span class="mpre">mvar2#</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">{-
M-Vars are rendezvous points for concurrent threads.  They begin
empty, and any attempt to read an empty M-Var blocks.  When an M-Var
is written, a single blocked thread may be freed.  Reading an M-Var
toggles its state from full back to empty.  Therefore, any value
written to an M-Var may only be read once.  Multiple reads and writes
are allowed, but there must be at least one read between any two
writes.
-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--Defined in IOBase to avoid cycle: data MVar a = MVar (SynchVar# RealWorld a)</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Create an &#39;MVar&#39; which is initially empty.</span></span><span class="mpre">
</span><a href="#loc_64_1_64_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_13&#39;)"><span class="mpre">newEmptyMVar</span></a><span class="mpre">  :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_64_1_64_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_13&#39;)"><span class="hl_vardecl"><span class="mpre">newEmptyMVar</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_64_23_64_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_23_64_25&#39;)"><span class="hl_vardecl"><span class="mpre">s#</span></span></a><span class="mpre"> -&gt;
    case </span><span class="hl_varref"><span class="mpre">newMVar#</span></span><span class="mpre"> </span><a href="#loc_64_23_64_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_23_64_25&#39;)"><span class="hl_varref"><span class="mpre">s#</span></span></a><span class="mpre"> of
         (# </span><a name="loc_66_13_66_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_13_66_16&#39;)"><span class="hl_vardecl"><span class="mpre">s2#</span></span></a><span class="mpre">, </span><a name="loc_66_18_66_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_18_66_23&#39;)"><span class="hl_vardecl"><span class="mpre">svar#</span></span></a><span class="mpre"> #) -&gt; (# </span><a href="#loc_66_13_66_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_13_66_16&#39;)"><span class="hl_varref"><span class="mpre">s2#</span></span></a><span class="mpre">, </span><a href="#loc_39_15_39_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_19&#39;)"><span class="hl_conref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a href="#loc_66_18_66_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_18_66_23&#39;)"><span class="hl_varref"><span class="mpre">svar#</span></span></a><span class="mpre"> #)

</span><span class="hl_comment"><span class="mpre">-- |Create an &#39;MVar&#39; which contains the supplied value.</span></span><span class="mpre">
</span><a href="#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_1_70_8&#39;)"><span class="mpre">newMVar</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_70_1_70_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_1_70_8&#39;)"><span class="hl_fundecl"><span class="mpre">newMVar</span></span></a><span class="mpre"> </span><a name="loc_70_9_70_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_9_70_14&#39;)"><span class="hl_vardecl"><span class="mpre">value</span></span></a><span class="mpre"> =
    </span><a href="#loc_64_1_64_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_13&#39;)"><span class="hl_varref"><span class="mpre">newEmptyMVar</span></span></a><span class="mpre">        </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> \ </span><a name="loc_71_31_71_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_31_71_35&#39;)"><span class="hl_vardecl"><span class="mpre">mvar</span></span></a><span class="mpre"> -&gt;
    </span><a href="#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_71_31_71_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_31_71_35&#39;)"><span class="hl_varref"><span class="mpre">mvar</span></span></a><span class="mpre"> </span><a href="#loc_70_9_70_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_9_70_14&#39;)"><span class="hl_varref"><span class="mpre">value</span></span></a><span class="mpre">  </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_71_31_71_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_31_71_35&#39;)"><span class="hl_varref"><span class="mpre">mvar</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Return the contents of the &#39;MVar&#39;.  If the &#39;MVar&#39; is currently</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- empty, &#39;takeMVar&#39; will wait until it is full.  After a &#39;takeMVar&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the &#39;MVar&#39; is left empty.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- There are two further important properties of &#39;takeMVar&#39;:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   * &#39;takeMVar&#39; is single-wakeup.  That is, if there are multiple</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     threads blocked in &#39;takeMVar&#39;, and the &#39;MVar&#39; becomes full,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     only one thread will be woken up.  The runtime guarantees that</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     the woken thread completes its &#39;takeMVar&#39; operation.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   * When multiple threads are blocked on an &#39;MVar&#39;, they are</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     woken up in FIFO order.  This is useful for providing</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     fairness properties of abstractions built using &#39;MVar&#39;s.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_1_91_9&#39;)"><span class="mpre">takeMVar</span></a><span class="mpre"> :: </span><a href="#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_91_1_91_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_1_91_9&#39;)"><span class="hl_fundecl"><span class="mpre">takeMVar</span></span></a><span class="mpre"> (</span><a href="#loc_39_15_39_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_19&#39;)"><span class="hl_conref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a name="loc_91_16_91_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_16_91_21&#39;)"><span class="hl_vardecl"><span class="mpre">mvar#</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_91_32_91_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_32_91_34&#39;)"><span class="hl_vardecl"><span class="mpre">s#</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">takeMVar#</span></span><span class="mpre"> </span><a href="#loc_91_16_91_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_16_91_21&#39;)"><span class="hl_varref"><span class="mpre">mvar#</span></span></a><span class="mpre"> </span><a href="#loc_91_32_91_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_32_91_34&#39;)"><span class="hl_varref"><span class="mpre">s#</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Atomically read the contents of an &#39;MVar&#39;.  If the &#39;MVar&#39; is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- currently empty, &#39;readMVar&#39; will wait until its full.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;readMVar&#39; is guaranteed to receive the next &#39;putMVar&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;readMVar&#39; is multiple-wakeup, so when multiple readers are</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- blocked on an &#39;MVar&#39;, all of them are woken up at the same time.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /Compatibility note:/ Prior to base 4.7, &#39;readMVar&#39; was a combination</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- of &#39;takeMVar&#39; and &#39;putMVar&#39;.  This mean that in the presence of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- other threads attempting to &#39;putMVar&#39;, &#39;readMVar&#39; could block.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Furthermore, &#39;readMVar&#39; would not receive the next &#39;putMVar&#39; if there</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- was already a pending thread blocked on &#39;takeMVar&#39;.  The old behavior</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- can be recovered by implementing &#39;readMVar as follows:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  readMVar :: MVar a -&gt; IO a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  readMVar m =</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    mask_ $ do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      a &lt;- takeMVar m</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      putMVar m a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      return a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><a href="#loc_116_1_116_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_1_116_9&#39;)"><span class="mpre">readMVar</span></a><span class="mpre"> :: </span><a href="#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_116_1_116_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_1_116_9&#39;)"><span class="hl_fundecl"><span class="mpre">readMVar</span></span></a><span class="mpre"> (</span><a href="#loc_39_15_39_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_19&#39;)"><span class="hl_conref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a name="loc_116_16_116_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_16_116_21&#39;)"><span class="hl_vardecl"><span class="mpre">mvar#</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_116_32_116_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_32_116_34&#39;)"><span class="hl_vardecl"><span class="mpre">s#</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">readMVar#</span></span><span class="mpre"> </span><a href="#loc_116_16_116_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_16_116_21&#39;)"><span class="hl_varref"><span class="mpre">mvar#</span></span></a><span class="mpre"> </span><a href="#loc_116_32_116_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_32_116_34&#39;)"><span class="hl_varref"><span class="mpre">s#</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Put a value into an &#39;MVar&#39;.  If the &#39;MVar&#39; is currently full,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;putMVar&#39; will wait until it becomes empty.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- There are two further important properties of &#39;putMVar&#39;:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   * &#39;putMVar&#39; is single-wakeup.  That is, if there are multiple</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     threads blocked in &#39;putMVar&#39;, and the &#39;MVar&#39; becomes empty,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     only one thread will be woken up.  The runtime guarantees that</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     the woken thread completes its &#39;putMVar&#39; operation.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   * When multiple threads are blocked on an &#39;MVar&#39;, they are</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     woken up in FIFO order.  This is useful for providing</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     fairness properties of abstractions built using &#39;MVar&#39;s.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_8&#39;)"><span class="mpre">putMVar</span></a><span class="mpre">  :: </span><a href="#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_133_1_133_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_8&#39;)"><span class="hl_fundecl"><span class="mpre">putMVar</span></span></a><span class="mpre"> (</span><a href="#loc_39_15_39_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_19&#39;)"><span class="hl_conref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a name="loc_133_15_133_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_15_133_20&#39;)"><span class="hl_vardecl"><span class="mpre">mvar#</span></span></a><span class="mpre">) </span><a name="loc_133_22_133_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_22_133_23&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_133_33_133_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_33_133_35&#39;)"><span class="hl_vardecl"><span class="mpre">s#</span></span></a><span class="mpre"> -&gt;
    case </span><span class="hl_varref"><span class="mpre">putMVar#</span></span><span class="mpre"> </span><a href="#loc_133_15_133_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_15_133_20&#39;)"><span class="hl_varref"><span class="mpre">mvar#</span></span></a><span class="mpre"> </span><a href="#loc_133_22_133_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_22_133_23&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="#loc_133_33_133_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_33_133_35&#39;)"><span class="hl_varref"><span class="mpre">s#</span></span></a><span class="mpre"> of
        </span><a name="loc_135_9_135_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_9_135_12&#39;)"><span class="hl_vardecl"><span class="mpre">s2#</span></span></a><span class="mpre"> -&gt; (# </span><a href="#loc_135_9_135_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_9_135_12&#39;)"><span class="hl_varref"><span class="mpre">s2#</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> #)

</span><span class="hl_comment"><span class="mpre">-- |A non-blocking version of &#39;takeMVar&#39;.  The &#39;tryTakeMVar&#39; function</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- returns immediately, with &#39;Nothing&#39; if the &#39;MVar&#39; was empty, or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @&#39;Just&#39; a@ if the &#39;MVar&#39; was full with contents @a@.  After &#39;tryTakeMVar&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the &#39;MVar&#39; is left empty.</span></span><span class="mpre">
</span><a href="#loc_142_1_142_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_12&#39;)"><span class="mpre">tryTakeMVar</span></a><span class="mpre"> :: </span><a href="#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_142_1_142_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_1_142_12&#39;)"><span class="hl_fundecl"><span class="mpre">tryTakeMVar</span></span></a><span class="mpre"> (</span><a href="#loc_39_15_39_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_19&#39;)"><span class="hl_conref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a name="loc_142_19_142_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_19_142_20&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_142_31_142_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_31_142_32&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
    case </span><span class="hl_varref"><span class="mpre">tryTakeMVar#</span></span><span class="mpre"> </span><a href="#loc_142_19_142_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_19_142_20&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_142_31_142_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_31_142_32&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
        (# </span><a name="loc_144_12_144_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_12_144_14&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre">, 0#, _ #) -&gt; (# </span><a href="#loc_144_12_144_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_12_144_14&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> #)      </span><span class="hl_comment"><span class="mpre">-- MVar is empty</span></span><span class="mpre">
        (# </span><a name="loc_145_12_145_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_12_145_14&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre">, _,  </span><a name="loc_145_20_145_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_20_145_21&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> #) -&gt; (# </span><a href="#loc_145_12_145_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_12_145_14&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_145_20_145_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_20_145_21&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">  #)      </span><span class="hl_comment"><span class="mpre">-- MVar is full</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |A non-blocking version of &#39;putMVar&#39;.  The &#39;tryPutMVar&#39; function</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- attempts to put the value @a@ into the &#39;MVar&#39;, returning &#39;True&#39; if</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- it was successful, or &#39;False&#39; otherwise.</span></span><span class="mpre">
</span><a href="#loc_151_1_151_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_1_151_11&#39;)"><span class="mpre">tryPutMVar</span></a><span class="mpre">  :: </span><a href="#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_151_1_151_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_1_151_11&#39;)"><span class="hl_fundecl"><span class="mpre">tryPutMVar</span></span></a><span class="mpre"> (</span><a href="#loc_39_15_39_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_19&#39;)"><span class="hl_conref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a name="loc_151_18_151_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_18_151_23&#39;)"><span class="hl_vardecl"><span class="mpre">mvar#</span></span></a><span class="mpre">) </span><a name="loc_151_25_151_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_25_151_26&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_151_36_151_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_36_151_38&#39;)"><span class="hl_vardecl"><span class="mpre">s#</span></span></a><span class="mpre"> -&gt;
    case </span><span class="hl_varref"><span class="mpre">tryPutMVar#</span></span><span class="mpre"> </span><a href="#loc_151_18_151_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_18_151_23&#39;)"><span class="hl_varref"><span class="mpre">mvar#</span></span></a><span class="mpre"> </span><a href="#loc_151_25_151_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_25_151_26&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="#loc_151_36_151_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_36_151_38&#39;)"><span class="hl_varref"><span class="mpre">s#</span></span></a><span class="mpre"> of
        (# </span><a name="loc_153_12_153_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_12_153_13&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">, 0# #) -&gt; (# </span><a href="#loc_153_12_153_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_12_153_13&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> #)
        (# </span><a name="loc_154_12_154_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_12_154_13&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">, _  #) -&gt; (# </span><a href="#loc_154_12_154_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_12_154_13&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> #)

</span><span class="hl_comment"><span class="mpre">-- |A non-blocking version of &#39;readMVar&#39;.  The &#39;tryReadMVar&#39; function</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- returns immediately, with &#39;Nothing&#39; if the &#39;MVar&#39; was empty, or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @&#39;Just&#39; a@ if the &#39;MVar&#39; was full with contents @a@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /Since: 4.7.0.0/</span></span><span class="mpre">
</span><a href="#loc_162_1_162_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_1_162_12&#39;)"><span class="mpre">tryReadMVar</span></a><span class="mpre"> :: </span><a href="#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_162_1_162_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_1_162_12&#39;)"><span class="hl_fundecl"><span class="mpre">tryReadMVar</span></span></a><span class="mpre"> (</span><a href="#loc_39_15_39_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_19&#39;)"><span class="hl_conref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a name="loc_162_19_162_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_19_162_20&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_162_31_162_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_31_162_32&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
    case </span><span class="hl_varref"><span class="mpre">tryReadMVar#</span></span><span class="mpre"> </span><a href="#loc_162_19_162_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_19_162_20&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_162_31_162_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_31_162_32&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
        (# </span><a name="loc_164_12_164_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_12_164_14&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre">, 0#, _ #) -&gt; (# </span><a href="#loc_164_12_164_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_12_164_14&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> #)      </span><span class="hl_comment"><span class="mpre">-- MVar is empty</span></span><span class="mpre">
        (# </span><a name="loc_165_12_165_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_12_165_14&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre">, _,  </span><a name="loc_165_20_165_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_20_165_21&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> #) -&gt; (# </span><a href="#loc_165_12_165_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_12_165_14&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_165_20_165_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_20_165_21&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">  #)      </span><span class="hl_comment"><span class="mpre">-- MVar is full</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Check whether a given &#39;MVar&#39; is empty.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Notice that the boolean value returned  is just a snapshot of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the state of the MVar. By the time you get to react on its result,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the MVar may have been filled (or emptied) - so be extremely</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- careful when using this operation.   Use &#39;tryTakeMVar&#39; instead if possible.</span></span><span class="mpre">
</span><a href="#loc_174_1_174_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_1_174_12&#39;)"><span class="mpre">isEmptyMVar</span></a><span class="mpre"> :: </span><a href="#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_174_1_174_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_1_174_12&#39;)"><span class="hl_fundecl"><span class="mpre">isEmptyMVar</span></span></a><span class="mpre"> (</span><a href="#loc_39_15_39_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_19&#39;)"><span class="hl_conref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a name="loc_174_19_174_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_19_174_22&#39;)"><span class="hl_vardecl"><span class="mpre">mv#</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_174_33_174_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_33_174_35&#39;)"><span class="hl_vardecl"><span class="mpre">s#</span></span></a><span class="mpre"> -&gt;
    case </span><span class="hl_varref"><span class="mpre">isEmptyMVar#</span></span><span class="mpre"> </span><a href="#loc_174_19_174_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_19_174_22&#39;)"><span class="hl_varref"><span class="mpre">mv#</span></span></a><span class="mpre"> </span><a href="#loc_174_33_174_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_33_174_35&#39;)"><span class="hl_varref"><span class="mpre">s#</span></span></a><span class="mpre"> of
        (# </span><a name="loc_176_12_176_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_12_176_15&#39;)"><span class="hl_vardecl"><span class="mpre">s2#</span></span></a><span class="mpre">, </span><a name="loc_176_17_176_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_17_176_20&#39;)"><span class="hl_vardecl"><span class="mpre">flg</span></span></a><span class="mpre"> #) -&gt; (# </span><a href="#loc_176_12_176_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_12_176_15&#39;)"><span class="hl_varref"><span class="mpre">s2#</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">isTrue#</span></span><span class="mpre"> (</span><a href="#loc_176_17_176_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_17_176_20&#39;)"><span class="hl_varref"><span class="mpre">flg</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=#</span></span><span class="mpre"> 0#) #)

</span><span class="hl_comment"><span class="mpre">-- |Add a finalizer to an &#39;MVar&#39; (GHC only).  See &quot;Foreign.ForeignPtr&quot; and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;System.Mem.Weak&quot; for more about finalizers.</span></span><span class="mpre">
</span><a href="#loc_181_1_181_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_1_181_17&#39;)"><span class="mpre">addMVarFinalizer</span></a><span class="mpre"> :: </span><a href="#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_181_1_181_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_1_181_17&#39;)"><span class="hl_fundecl"><span class="mpre">addMVarFinalizer</span></span></a><span class="mpre"> (</span><a href="#loc_39_15_39_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_19&#39;)"><span class="hl_conref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a name="loc_181_24_181_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_24_181_25&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) </span><a name="loc_181_27_181_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_27_181_36&#39;)"><span class="hl_vardecl"><span class="mpre">finalizer</span></span></a><span class="mpre"> =
  </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_182_9_182_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_9_182_10&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; case </span><span class="hl_varref"><span class="mpre">mkWeak#</span></span><span class="mpre"> </span><a href="#loc_181_24_181_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_24_181_25&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> </span><a href="#loc_181_27_181_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_181_27_181_36&#39;)"><span class="hl_varref"><span class="mpre">finalizer</span></span></a><span class="mpre"> </span><a href="#loc_182_9_182_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_9_182_10&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of { (# </span><a name="loc_182_52_182_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_52_182_54&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">, _ #) -&gt; (# </span><a href="#loc_182_52_182_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_52_182_54&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> #) }

</span></div></body></html>