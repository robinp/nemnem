<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE ViewPatterns #-}
module Network.HTTP.Client.Connection
    ( connectionReadLine
    , connectionReadLineWith
    , connectionDropTillBlankLine
    , dummyConnection
    , openSocketConnection
    , makeConnection
    ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Connection.hs&quot;, srcSpanStartLine = 13, srcSpanStartColumn = 8, srcSpanEndLine = 13, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString, empty)
import Data.IORef
import Control.Monad
import Control.Exception (</span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="mpre">throwIO</span></a><span class="mpre">)
import Network.HTTP.Client.Types
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Connection.hs&quot;, srcSpanStartLine = 18, srcSpanStartColumn = 8, srcSpanEndLine = 18, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre"> (Socket, sClose, HostAddress)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Connection.hs&quot;, srcSpanStartLine = 19, srcSpanStartColumn = 18, srcSpanEndLine = 19, srcSpanEndColumn = 32}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre"> as NS
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Connection.hs&quot;, srcSpanStartLine = 20, srcSpanStartColumn = 8, srcSpanEndLine = 20, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Network.Socket.ByteString&quot;"><span class="mpre">Network.Socket.ByteString</span></span><span class="mpre"> (sendAll, recv)
import qualified Control.Exception as E
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Connection.hs&quot;, srcSpanStartLine = 22, srcSpanStartColumn = 18, srcSpanEndLine = 22, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as S
import Data.Word (Word8)
import Data.Function (</span><a href="Data.Function.html#loc_32_1_32_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Function.html#loc_32_1_32_4&#39;)"><span class="mpre">fix</span></a><span class="mpre">)

</span><a href="#loc_27_1_27_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_1_27_19&#39;)"><span class="mpre">connectionReadLine</span></a><span class="mpre"> :: </span><a href="Network.HTTP.Client.Types.html#loc_63_6_63_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_63_6_63_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_27_1_27_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_1_27_19&#39;)"><span class="hl_fundecl"><span class="mpre">connectionReadLine</span></span></a><span class="mpre"> </span><a name="loc_27_20_27_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_20_27_24&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> = do
    </span><a name="loc_28_5_28_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_5_28_7&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> &lt;- </span><a href="Network.HTTP.Client.Types.html#loc_64_7_64_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_64_7_64_21&#39;)"><span class="hl_varref"><span class="mpre">connectionRead</span></span></a><span class="mpre"> </span><a href="#loc_27_20_27_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_20_27_24&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
    </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_28_5_28_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_5_28_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_104_22_104_39" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_104_22_104_39&#39;)"><span class="hl_conref"><span class="mpre">IncompleteHeaders</span></span></a><span class="mpre">
    </span><a href="#loc_39_1_39_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_23&#39;)"><span class="hl_varref"><span class="mpre">connectionReadLineWith</span></span></a><span class="mpre"> </span><a href="#loc_27_20_27_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_20_27_24&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_28_5_28_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_5_28_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Keep dropping input until a blank line is found.</span></span><span class="mpre">
</span><a href="#loc_34_1_34_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_28&#39;)"><span class="mpre">connectionDropTillBlankLine</span></a><span class="mpre"> :: </span><a href="Network.HTTP.Client.Types.html#loc_63_6_63_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_63_6_63_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_34_1_34_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_28&#39;)"><span class="hl_fundecl"><span class="mpre">connectionDropTillBlankLine</span></span></a><span class="mpre"> </span><a name="loc_34_29_34_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_29_34_33&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> = </span><a href="Data.Function.html#loc_32_1_32_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Function.html#loc_32_1_32_4&#39;)"><span class="hl_varref"><span class="mpre">fix</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_34_43_34_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_43_34_47&#39;)"><span class="hl_vardecl"><span class="mpre">loop</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_35_5_35_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_5_35_7&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_27_1_27_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_1_27_19&#39;)"><span class="hl_varref"><span class="mpre">connectionReadLine</span></span></a><span class="mpre"> </span><a href="#loc_34_29_34_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_29_34_33&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
    </span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="hl_varref"><span class="mpre">unless</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_35_5_35_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_5_35_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">) </span><a href="#loc_34_43_34_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_43_34_47&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre">

</span><a href="#loc_39_1_39_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_23&#39;)"><span class="mpre">connectionReadLineWith</span></a><span class="mpre"> :: </span><a href="Network.HTTP.Client.Types.html#loc_63_6_63_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_63_6_63_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_39_1_39_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_23&#39;)"><span class="hl_fundecl"><span class="mpre">connectionReadLineWith</span></span></a><span class="mpre"> </span><a name="loc_39_24_39_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_24_39_28&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_39_29_39_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_29_39_32&#39;)"><span class="hl_vardecl"><span class="mpre">bs0</span></span></a><span class="mpre"> =
    </span><a href="#loc_42_5_42_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_5_42_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_39_29_39_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_29_39_32&#39;)"><span class="hl_varref"><span class="mpre">bs0</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
  where
    </span><a name="loc_42_5_42_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_5_42_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_42_8_42_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_8_42_10&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a name="loc_42_11_42_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_11_42_16&#39;)"><span class="hl_vardecl"><span class="mpre">front</span></span></a><span class="mpre"> </span><a name="loc_42_17_42_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_17_42_22&#39;)"><span class="hl_vardecl"><span class="mpre">total</span></span></a><span class="mpre"> =
        case </span><span class="hl_varref"><span class="mpre">S.breakByte</span></span><span class="mpre"> </span><a href="#loc_55_1_55_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_7&#39;)"><span class="hl_varref"><span class="mpre">charLF</span></span></a><span class="mpre"> </span><a href="#loc_42_8_42_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_8_42_10&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> of
            (_, </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">) -&gt; do
                let </span><a name="loc_45_21_45_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_21_45_27&#39;)"><span class="hl_vardecl"><span class="mpre">total&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_42_17_42_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_17_42_22&#39;)"><span class="hl_varref"><span class="mpre">total</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_42_8_42_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_8_42_10&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
                </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_45_21_45_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_21_45_27&#39;)"><span class="hl_varref"><span class="mpre">total&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">4096</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_84_22_84_37" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_84_22_84_37&#39;)"><span class="hl_conref"><span class="mpre">OverlongHeaders</span></span></a><span class="mpre">
                </span><a name="loc_47_17_47_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_17_47_20&#39;)"><span class="hl_vardecl"><span class="mpre">bs&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="Network.HTTP.Client.Types.html#loc_64_7_64_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_64_7_64_21&#39;)"><span class="hl_varref"><span class="mpre">connectionRead</span></span></a><span class="mpre"> </span><a href="#loc_39_24_39_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_24_39_28&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
                </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_47_17_47_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_17_47_20&#39;)"><span class="hl_varref"><span class="mpre">bs&#39;</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_104_22_104_39" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_104_22_104_39&#39;)"><span class="hl_conref"><span class="mpre">IncompleteHeaders</span></span></a><span class="mpre">
                </span><a href="#loc_42_5_42_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_5_42_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_47_17_47_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_17_47_20&#39;)"><span class="hl_varref"><span class="mpre">bs&#39;</span></span></a><span class="mpre"> (</span><a href="#loc_42_11_42_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_11_42_16&#39;)"><span class="hl_varref"><span class="mpre">front</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (</span><a href="#loc_42_8_42_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_8_42_10&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">)) </span><a href="#loc_45_21_45_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_21_45_27&#39;)"><span class="hl_varref"><span class="mpre">total&#39;</span></span></a><span class="mpre">
            (</span><a name="loc_50_14_50_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_14_50_15&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">, </span><span class="warning" data-warning="PatPViewPat (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Connection.hs&quot;, srcSpanStartLine = 50, srcSpanStartColumn = 17, srcSpanEndLine = 50, srcSpanEndColumn = 30}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Connection.hs&quot;, srcSpanStartLine = 50, srcSpanStartColumn = 26, srcSpanEndLine = 50, srcSpanEndColumn = 28}]}) (App (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagra"><span class="mpre">S.drop 1 -&gt; y</span></span><span class="mpre">) -&gt; do
                </span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="hl_varref"><span class="mpre">unless</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">y</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_66_7_66_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_66_7_66_23&#39;)"><span class="hl_varref"><span class="mpre">connectionUnread</span></span></a><span class="mpre"> </span><a href="#loc_39_24_39_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_24_39_28&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">y</span></span><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="#loc_59_1_59_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_1_59_7&#39;)"><span class="hl_varref"><span class="mpre">killCR</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.concat</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="#loc_42_11_42_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_11_42_16&#39;)"><span class="hl_varref"><span class="mpre">front</span></span></a><span class="mpre"> [</span><a href="#loc_50_14_50_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_14_50_15&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">]

</span><a href="#loc_55_1_55_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_7&#39;)"><span class="mpre">charLF</span></a><span class="mpre">, </span><a href="#loc_56_1_56_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_7&#39;)"><span class="mpre">charCR</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">
</span><a name="loc_55_1_55_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_7&#39;)"><span class="hl_vardecl"><span class="mpre">charLF</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">10</span></span><span class="mpre">
</span><a name="loc_56_1_56_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_7&#39;)"><span class="hl_vardecl"><span class="mpre">charCR</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">13</span></span><span class="mpre">

</span><a href="#loc_59_1_59_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_1_59_7&#39;)"><span class="mpre">killCR</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_59_1_59_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_1_59_7&#39;)"><span class="hl_fundecl"><span class="mpre">killCR</span></span></a><span class="mpre"> </span><a name="loc_59_8_59_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_8_59_10&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_59_8_59_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_8_59_10&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="#loc_59_8_59_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_8_59_10&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">S.last</span></span><span class="mpre"> </span><a href="#loc_59_8_59_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_8_59_10&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_56_1_56_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_7&#39;)"><span class="hl_varref"><span class="mpre">charCR</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.init</span></span><span class="mpre"> </span><a href="#loc_59_8_59_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_8_59_10&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="#loc_59_8_59_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_8_59_10&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | For testing</span></span><span class="mpre">
</span><a href="#loc_68_1_68_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_1_68_16&#39;)"><span class="mpre">dummyConnection</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">] </span><span class="hl_comment"><span class="mpre">-- ^ input</span></span><span class="mpre">
                -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_63_6_63_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_63_6_63_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">], </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">]) </span><span class="hl_comment"><span class="mpre">-- ^ conn, output, input</span></span><span class="mpre">
</span><a name="loc_68_1_68_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_1_68_16&#39;)"><span class="hl_fundecl"><span class="mpre">dummyConnection</span></span></a><span class="mpre"> </span><a name="loc_68_17_68_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_17_68_23&#39;)"><span class="hl_vardecl"><span class="mpre">input0</span></span></a><span class="mpre"> = do
    </span><a name="loc_69_5_69_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_5_69_11&#39;)"><span class="hl_vardecl"><span class="mpre">iinput</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_68_17_68_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_17_68_23&#39;)"><span class="hl_varref"><span class="mpre">input0</span></span></a><span class="mpre">
    </span><a name="loc_70_5_70_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_5_70_12&#39;)"><span class="hl_vardecl"><span class="mpre">ioutput</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> []
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Connection.hs&quot;, srcSpanStartLine = 71, srcSpanStartColumn = 13, srcSpanEndLine = 79, srcSpanEndColumn = 10}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Connection.hs&quot;, srcSpanStartLine = 72, srcSpanStartColumn = 9, srcSpanEndLine = 72, srcSpanEndColumn = 10},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Net"><span class="mpre">Connection
        { connectionRead = atomicModifyIORef iinput $ \input -&gt;
            case input of
                [] -&gt; ([], empty)
                x:xs -&gt; (xs, x)
        , connectionUnread = \x -&gt; atomicModifyIORef iinput $ \input -&gt; (x:input, ())
        , connectionWrite = \x -&gt; atomicModifyIORef ioutput $ \output -&gt; (output ++ [x], ())
        , connectionClose = return ()
        }</span></span><span class="mpre">, </span><a href="Data.IORef.html#loc_101_1_101_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_101_1_101_18&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef</span></span></a><span class="mpre"> </span><a href="#loc_70_5_70_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_5_70_12&#39;)"><span class="hl_varref"><span class="mpre">ioutput</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_79_41_79_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_41_79_47&#39;)"><span class="hl_vardecl"><span class="mpre">output</span></span></a><span class="mpre"> -&gt; ([], </span><a href="#loc_79_41_79_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_41_79_47&#39;)"><span class="hl_varref"><span class="mpre">output</span></span></a><span class="mpre">), </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_69_5_69_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_5_69_11&#39;)"><span class="hl_varref"><span class="mpre">iinput</span></span></a><span class="mpre">)

</span><a href="#loc_85_1_85_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_15&#39;)"><span class="mpre">makeConnection</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ read</span></span><span class="mpre">
               -&gt; (</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">) </span><span class="hl_comment"><span class="mpre">-- ^ write</span></span><span class="mpre">
               -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ close</span></span><span class="mpre">
               -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_63_6_63_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_63_6_63_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre">
</span><a name="loc_85_1_85_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_15&#39;)"><span class="hl_fundecl"><span class="mpre">makeConnection</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">r</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">w</span></span><span class="mpre"> </span><a name="loc_85_20_85_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_20_85_21&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = do
    </span><a name="loc_86_5_86_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_11&#39;)"><span class="hl_vardecl"><span class="mpre">istack</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> []
    _ &lt;- </span><a href="Data.IORef.html#loc_52_1_52_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_52_1_52_12&#39;)"><span class="hl_varref"><span class="mpre">mkWeakIORef</span></span></a><span class="mpre"> </span><a href="#loc_86_5_86_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_11&#39;)"><span class="hl_varref"><span class="mpre">istack</span></span></a><span class="mpre"> </span><a href="#loc_85_20_85_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_20_85_21&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Connection.hs&quot;, srcSpanStartLine = 88, srcSpanStartColumn = 15, srcSpanEndLine = 96, srcSpanEndColumn = 10}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Connection.hs&quot;, srcSpanStartLine = 89, srcSpanStartColumn = 9, srcSpanEndLine = 89, srcSpanEndColumn = 10},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Net"><span class="mpre">Connection
        { connectionRead = join $ atomicModifyIORef istack $ \stack -&gt;
            case stack of
                x:xs -&gt; (xs, return x)
                [] -&gt; ([], r)
        , connectionUnread = \x -&gt; atomicModifyIORef istack $ \stack -&gt; (x:stack, ())
        , connectionWrite = w
        , connectionClose = c
        }</span></span><span class="mpre">

</span><a href="#loc_99_1_99_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_17&#39;)"><span class="mpre">socketConnection</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_63_6_63_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_63_6_63_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre">
</span><a name="loc_99_1_99_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_17&#39;)"><span class="hl_fundecl"><span class="mpre">socketConnection</span></span></a><span class="mpre"> </span><a name="loc_99_18_99_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_18_99_24&#39;)"><span class="hl_vardecl"><span class="mpre">socket</span></span></a><span class="mpre"> = </span><a href="#loc_85_1_85_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_15&#39;)"><span class="hl_varref"><span class="mpre">makeConnection</span></span></a><span class="mpre">
    (</span><span class="hl_varref"><span class="mpre">recv</span></span><span class="mpre"> </span><a href="#loc_99_18_99_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_18_99_24&#39;)"><span class="hl_varref"><span class="mpre">socket</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">4096</span></span><span class="mpre">)
    (</span><span class="hl_varref"><span class="mpre">sendAll</span></span><span class="mpre"> </span><a href="#loc_99_18_99_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_18_99_24&#39;)"><span class="hl_varref"><span class="mpre">socket</span></span></a><span class="mpre">)
    (</span><span class="hl_varref"><span class="mpre">sClose</span></span><span class="mpre"> </span><a href="#loc_99_18_99_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_18_99_24&#39;)"><span class="hl_varref"><span class="mpre">socket</span></span></a><span class="mpre">)

</span><a href="#loc_108_1_108_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_21&#39;)"><span class="mpre">openSocketConnection</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HostAddress</span></span><span class="mpre">
                     -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ host</span></span><span class="mpre">
                     -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ port</span></span><span class="mpre">
                     -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_63_6_63_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_63_6_63_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre">
</span><a name="loc_108_1_108_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_1_108_21&#39;)"><span class="hl_fundecl"><span class="mpre">openSocketConnection</span></span></a><span class="mpre"> </span><a name="loc_108_22_108_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_22_108_33&#39;)"><span class="hl_vardecl"><span class="mpre">hostAddress</span></span></a><span class="mpre"> </span><a name="loc_108_34_108_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_34_108_38&#39;)"><span class="hl_vardecl"><span class="mpre">host</span></span></a><span class="mpre"> </span><a name="loc_108_39_108_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_39_108_43&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> = do
    let </span><a name="loc_109_9_109_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_9_109_14&#39;)"><span class="hl_vardecl"><span class="mpre">hints</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Connection.hs&quot;, srcSpanStartLine = 109, srcSpanStartColumn = 17, srcSpanEndLine = 112, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Connection.hs&quot;, srcSpanStartLine = 109, srcSpanStartColumn = 33, srcSpanEndLine = 109, srcSpanEndColumn = 34},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3."><span class="mpre">NS.defaultHints {
                          NS.addrFlags = [NS.AI_ADDRCONFIG]
                        , NS.addrSocketType = NS.Stream
                        }</span></span><span class="mpre">
    </span><a name="loc_113_5_113_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_5_113_10&#39;)"><span class="hl_vardecl"><span class="mpre">addrs</span></span></a><span class="mpre"> &lt;- case </span><a href="#loc_108_22_108_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_22_108_33&#39;)"><span class="hl_varref"><span class="mpre">hostAddress</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt;
            </span><span class="hl_varref"><span class="mpre">NS.getAddrInfo</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_109_9_109_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_9_109_14&#39;)"><span class="hl_varref"><span class="mpre">hints</span></span></a><span class="mpre">) (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_108_34_108_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_34_108_38&#39;)"><span class="hl_varref"><span class="mpre">host</span></span></a><span class="mpre">) (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_108_39_108_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_39_108_43&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre">)
        </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">ha</span></span><span class="mpre"> -&gt;
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre">
                [</span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Connection.hs&quot;, srcSpanStartLine = 118, srcSpanStartColumn = 18, srcSpanEndLine = 125, srcSpanEndColumn = 19}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Connection.hs&quot;, srcSpanStartLine = 119, srcSpanStartColumn = 18, srcSpanEndLine = 119, srcSpanEndColumn = 19},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3."><span class="mpre">NS.AddrInfo
                 { NS.addrFlags = []
                 , NS.addrFamily = NS.AF_INET
                 , NS.addrSocketType = NS.Stream
                 , NS.addrProtocol = 6 </span><span class="hl_comment"><span class="mpre">-- tcp</span></span><span class="mpre">
                 , NS.addrAddress = NS.SockAddrInet (toEnum port) ha
                 , NS.addrCanonName = Nothing
                 }</span></span><span class="mpre">]

    </span><a href="#loc_138_1_138_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_16&#39;)"><span class="hl_varref"><span class="mpre">firstSuccessful</span></span></a><span class="mpre"> </span><a href="#loc_113_5_113_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_5_113_10&#39;)"><span class="hl_varref"><span class="mpre">addrs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_127_30_127_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_30_127_34&#39;)"><span class="hl_vardecl"><span class="mpre">addr</span></span></a><span class="mpre"> -&gt;
        </span><a href="Control.Exception.Base.html#loc_291_1_291_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_291_1_291_15&#39;)"><span class="hl_varref"><span class="mpre">E.bracketOnError</span></span></a><span class="mpre">
            (</span><span class="hl_varref"><span class="mpre">NS.socket</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">NS.addrFamily</span></span><span class="mpre"> </span><a href="#loc_127_30_127_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_30_127_34&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">NS.addrSocketType</span></span><span class="mpre"> </span><a href="#loc_127_30_127_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_30_127_34&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre">)
                       (</span><span class="hl_varref"><span class="mpre">NS.addrProtocol</span></span><span class="mpre"> </span><a href="#loc_127_30_127_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_30_127_34&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre">))
            (</span><span class="hl_varref"><span class="mpre">NS.sClose</span></span><span class="mpre">)
            (\</span><a name="loc_132_15_132_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_15_132_19&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> -&gt; do
                </span><span class="hl_varref"><span class="mpre">NS.setSocketOption</span></span><span class="mpre"> </span><a href="#loc_132_15_132_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_15_132_19&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">NS.NoDelay</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">NS.connect</span></span><span class="mpre"> </span><a href="#loc_132_15_132_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_15_132_19&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">NS.addrAddress</span></span><span class="mpre"> </span><a href="#loc_127_30_127_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_30_127_34&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre">)
                </span><a href="#loc_99_1_99_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_17&#39;)"><span class="hl_varref"><span class="mpre">socketConnection</span></span></a><span class="mpre"> </span><a href="#loc_132_15_132_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_15_132_19&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre">)

</span><a href="#loc_138_1_138_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_16&#39;)"><span class="mpre">firstSuccessful</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">NS.AddrInfo</span></span><span class="mpre">] -&gt; (</span><span class="hl_tyconref"><span class="mpre">NS.AddrInfo</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_138_1_138_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_16&#39;)"><span class="hl_fundecl"><span class="mpre">firstSuccessful</span></span></a><span class="mpre"> []     _  = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;getAddrInfo returned empty list&quot;</span></span><span class="mpre">
</span><a href="#loc_138_1_138_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_16&#39;)"><span class="hl_fundecl"><span class="mpre">firstSuccessful</span></span></a><span class="mpre"> (</span><a name="loc_139_18_139_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_18_139_19&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_139_20_139_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_20_139_22&#39;)"><span class="hl_vardecl"><span class="mpre">as</span></span></a><span class="mpre">) </span><a name="loc_139_24_139_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_24_139_26&#39;)"><span class="hl_vardecl"><span class="mpre">cb</span></span></a><span class="mpre"> =
    </span><a href="#loc_139_24_139_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_24_139_26&#39;)"><span class="hl_varref"><span class="mpre">cb</span></span></a><span class="mpre"> </span><a href="#loc_139_18_139_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_18_139_19&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><a href="Control.Exception.Base.html#loc_150_1_150_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_150_1_150_6&#39;)"><span class="hl_infix"><span class="mpre">`E.catch`</span></span></a><span class="mpre"> \(</span><a name="loc_140_22_140_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_22_140_23&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> :: </span><a href="GHC.IO.Exception.html#loc_238_6_238_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_238_6_238_17&#39;)"><span class="hl_tyconref"><span class="mpre">E.IOException</span></span></a><span class="mpre">) -&gt;
        case </span><a href="#loc_139_20_139_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_20_139_22&#39;)"><span class="hl_varref"><span class="mpre">as</span></span></a><span class="mpre"> of
            [] -&gt; </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">E.throwIO</span></span></a><span class="mpre"> </span><a href="#loc_140_22_140_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_22_140_23&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
            _  -&gt; </span><a href="#loc_138_1_138_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_16&#39;)"><span class="hl_varref"><span class="mpre">firstSuccessful</span></span></a><span class="mpre"> </span><a href="#loc_139_20_139_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_20_139_22&#39;)"><span class="hl_varref"><span class="mpre">as</span></span></a><span class="mpre"> </span><a href="#loc_139_24_139_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_24_139_26&#39;)"><span class="hl_varref"><span class="mpre">cb</span></span></a><span class="mpre">
</span></div></body></html>