<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Trustworthy #-}
{-# LANGUAGE BangPatterns
           , CPP
           , ExistentialQuantification
           , NoImplicitPrelude
           , RecordWildCards
           , TypeSynonymInstances
           , FlexibleInstances
  #-}
module GHC.Event.Manager
    ( </span><span class="hl_comment"><span class="mpre">-- * Types</span></span><span class="mpre">
      EventManager

      </span><span class="hl_comment"><span class="mpre">-- * Creation</span></span><span class="mpre">
    , new
    , newWith
    , newDefaultBackend

      </span><span class="hl_comment"><span class="mpre">-- * Running</span></span><span class="mpre">
    , finished
    , loop
    , step
    , shutdown
    , release
    , cleanup
    , wakeManager

      </span><span class="hl_comment"><span class="mpre">-- * State</span></span><span class="mpre">
    , callbackTableVar

      </span><span class="hl_comment"><span class="mpre">-- * Registering interest in I/O events</span></span><span class="mpre">
    , Event
    , evtRead
    , evtWrite
    , IOCallback
    , FdKey(keyFd)
    , FdData
    , registerFd_
    , registerFd
    , unregisterFd_
    , unregisterFd
    , closeFd
    , closeFd_
    ) where

#include &quot;EventConfig.h&quot;

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Imports</span></span><span class="mpre">

import Control.Concurrent.MVar (</span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="mpre">MVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="mpre">newMVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_116_1_116_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_116_1_116_9&#39;)"><span class="mpre">readMVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="mpre">putMVar</span></a><span class="mpre">,
                                </span><a href="GHC.MVar.html#loc_151_1_151_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_151_1_151_11&#39;)"><span class="mpre">tryPutMVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="mpre">takeMVar</span></a><span class="mpre">, </span><a href="Control.Concurrent.MVar.html#loc_185_1_185_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_185_1_185_9&#39;)"><span class="mpre">withMVar</span></a><span class="mpre">)
import Control.Exception (</span><a href="Control.Exception.Base.html#loc_229_1_229_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_229_1_229_12&#39;)"><span class="mpre">onException</span></a><span class="mpre">)
import Control.Monad (</span><a href="Control.Monad.html#loc_92_3_92_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_92_3_92_6&#39;)"><span class="mpre">(=&lt;&lt;)</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_168_1_168_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_168_1_168_6&#39;)"><span class="mpre">forM_</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="mpre">liftM</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_250_1_250_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_250_1_250_11&#39;)"><span class="mpre">replicateM</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_195_1_195_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_195_1_195_5&#39;)"><span class="mpre">void</span></a><span class="mpre">)
import Data.Bits ((.&amp;.))
import Data.IORef (</span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="mpre">IORef</span></a><span class="mpre">, </span><a href="Data.IORef.html#loc_108_1_108_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_108_1_108_19&#39;)"><span class="mpre">atomicModifyIORef&#39;</span></a><span class="mpre">, </span><a href="Data.IORef.html#loc_52_1_52_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_52_1_52_12&#39;)"><span class="mpre">mkWeakIORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="mpre">newIORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="mpre">readIORef</span></a><span class="mpre">,
                   </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="mpre">writeIORef</span></a><span class="mpre">)
import Data.Maybe (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="mpre">Maybe</span></a><span class="mpre">(..), </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="mpre">maybe</span></a><span class="mpre">)
import Data.Monoid (</span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="mpre">mappend</span></a><span class="mpre">, </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="mpre">mconcat</span></a><span class="mpre">, </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="mpre">mempty</span></a><span class="mpre">)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 60, srcSpanStartColumn = 8, srcSpanEndLine = 60, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;GHC.Arr&quot;"><span class="mpre">GHC.Arr</span></span><span class="mpre"> (Array, (!), listArray)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 61, srcSpanStartColumn = 8, srcSpanEndLine = 61, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">
import GHC.Conc.Signal (</span><a href="GHC.Conc.Signal.html#loc_63_1_63_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Conc.Signal.html#loc_63_1_63_12&#39;)"><span class="mpre">runHandlers</span></a><span class="mpre">)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 63, srcSpanStartColumn = 8, srcSpanEndLine = 63, srcSpanEndColumn = 21}, srcInfoPoints = []}) &quot;GHC.Conc.Sync&quot;"><span class="mpre">GHC.Conc.Sync</span></span><span class="mpre"> (yield)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 64, srcSpanStartColumn = 8, srcSpanEndLine = 64, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.List&quot;"><span class="mpre">GHC.List</span></span><span class="mpre"> (filter)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 8, srcSpanEndLine = 65, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;GHC.Num&quot;"><span class="mpre">GHC.Num</span></span><span class="mpre"> (Num(..))
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 66, srcSpanStartColumn = 8, srcSpanEndLine = 66, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Real&quot;"><span class="mpre">GHC.Real</span></span><span class="mpre"> (fromIntegral)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 67, srcSpanStartColumn = 8, srcSpanEndLine = 67, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Show&quot;"><span class="mpre">GHC.Show</span></span><span class="mpre"> (Show(..))
import GHC.Event.Control
import GHC.Event.IntTable (</span><a href="GHC.Event.IntTable.html#loc_33_9_33_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_33_9_33_17&#39;)"><span class="mpre">IntTable</span></a><span class="mpre">)
import GHC.Event.Internal (</span><a href="GHC.Event.Internal.html#loc_89_6_89_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_89_6_89_13&#39;)"><span class="mpre">Backend</span></a><span class="mpre">, </span><a href="GHC.Event.Internal.html#loc_37_9_37_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_37_9_37_14&#39;)"><span class="mpre">Event</span></a><span class="mpre">, </span><a href="GHC.Event.Internal.html#loc_56_1_56_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_56_1_56_9&#39;)"><span class="mpre">evtClose</span></a><span class="mpre">, </span><a href="GHC.Event.Internal.html#loc_46_1_46_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_46_1_46_8&#39;)"><span class="mpre">evtRead</span></a><span class="mpre">, </span><a href="GHC.Event.Internal.html#loc_51_1_51_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_51_1_51_9&#39;)"><span class="mpre">evtWrite</span></a><span class="mpre">,
                           </span><a href="GHC.Event.Internal.html#loc_84_6_84_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_84_6_84_13&#39;)"><span class="mpre">Timeout</span></a><span class="mpre">(..))
import GHC.Event.Unique (</span><a href="GHC.Event.Unique.html#loc_26_9_26_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Unique.html#loc_26_9_26_15&#39;)"><span class="mpre">Unique</span></a><span class="mpre">, </span><a href="GHC.Event.Unique.html#loc_24_9_24_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Unique.html#loc_24_9_24_21&#39;)"><span class="mpre">UniqueSource</span></a><span class="mpre">, </span><a href="GHC.Event.Unique.html#loc_33_1_33_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Unique.html#loc_33_1_33_10&#39;)"><span class="mpre">newSource</span></a><span class="mpre">, </span><a href="GHC.Event.Unique.html#loc_36_1_36_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Unique.html#loc_36_1_36_10&#39;)"><span class="mpre">newUnique</span></a><span class="mpre">)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 73, srcSpanStartColumn = 8, srcSpanEndLine = 73, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;System.Posix.Types&quot;"><span class="mpre">System.Posix.Types</span></span><span class="mpre"> (Fd)

import qualified GHC.Event.IntTable as IT
import qualified GHC.Event.Internal as I

#if defined(HAVE_KQUEUE)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 79, srcSpanStartColumn = 18, srcSpanEndLine = 79, srcSpanEndColumn = 34}, srcInfoPoints = []}) &quot;GHC.Event.KQueue&quot;"><span class="mpre">GHC.Event.KQueue</span></span><span class="mpre"> as KQueue
#elif defined(HAVE_EPOLL)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 81, srcSpanStartColumn = 18, srcSpanEndLine = 81, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;GHC.Event.EPoll&quot;"><span class="mpre">GHC.Event.EPoll</span></span><span class="mpre">  as EPoll
#elif defined(HAVE_POLL)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 83, srcSpanStartColumn = 18, srcSpanEndLine = 83, srcSpanEndColumn = 32}, srcInfoPoints = []}) &quot;GHC.Event.Poll&quot;"><span class="mpre">GHC.Event.Poll</span></span><span class="mpre">   as Poll
#else
# error not implemented for this operating system
#endif

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Types</span></span><span class="mpre">

data </span><a name="loc_91_6_91_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_6_91_12&#39;)"><span class="hl_tycondecl"><span class="mpre">FdData</span></span></a><span class="mpre"> = </span><a name="loc_91_15_91_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_15_91_21&#39;)"><span class="hl_condecl"><span class="mpre">FdData</span></span></a><span class="mpre"> {
      </span><a name="loc_92_7_92_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_7_92_12&#39;)"><span class="hl_fielddecl"><span class="mpre">fdKey</span></span></a><span class="mpre">       :: {-# UNPACK #-} !</span><a href="#loc_98_6_98_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_6_98_11&#39;)"><span class="hl_tyconref"><span class="mpre">FdKey</span></span></a><span class="mpre">
    , </span><a name="loc_93_7_93_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_7_93_15&#39;)"><span class="hl_fielddecl"><span class="mpre">fdEvents</span></span></a><span class="mpre">    :: {-# UNPACK #-} !</span><a href="GHC.Event.Internal.html#loc_37_9_37_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_37_9_37_14&#39;)"><span class="hl_tyconref"><span class="mpre">Event</span></span></a><span class="mpre">
    , </span><span class="hl_fielddecl"><span class="mpre">_fdCallback</span></span><span class="mpre"> :: !</span><span class="hl_tyconref"><span class="mpre">IOCallback</span></span><span class="mpre">
    }

</span><span class="hl_comment"><span class="mpre">-- | A file descriptor registration cookie.</span></span><span class="mpre">
data </span><a name="loc_98_6_98_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_6_98_11&#39;)"><span class="hl_tycondecl"><span class="mpre">FdKey</span></span></a><span class="mpre"> = </span><a name="loc_98_14_98_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_14_98_19&#39;)"><span class="hl_condecl"><span class="mpre">FdKey</span></span></a><span class="mpre"> {
      </span><a name="loc_99_7_99_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_7_99_12&#39;)"><span class="hl_fielddecl"><span class="mpre">keyFd</span></span></a><span class="mpre">     :: {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre">
    , </span><a name="loc_100_7_100_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_7_100_16&#39;)"><span class="hl_fielddecl"><span class="mpre">keyUnique</span></span></a><span class="mpre"> :: {-# UNPACK #-} !</span><a href="GHC.Event.Unique.html#loc_26_9_26_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Unique.html#loc_26_9_26_15&#39;)"><span class="hl_tyconref"><span class="mpre">Unique</span></span></a><span class="mpre">
    } </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 101, srcSpanStartColumn = 7, srcSpanEndLine = 101, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 101, srcSpanStartColumn = 7, srcSpanEndLine = 101, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = "><span class="mpre">deriving (Eq, Show)</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Callback invoked on I/O events.</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 104, srcSpanStartColumn = 1, srcSpanEndLine = 104, srcSpanEndColumn = 42}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 104, srcSpanStartColumn = 1, srcSpanEndLine = 104, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 1"><span class="mpre">type IOCallback = FdKey -&gt; Event -&gt; IO ()</span></span><span class="mpre">

data </span><a name="loc_106_6_106_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_6_106_11&#39;)"><span class="hl_tycondecl"><span class="mpre">State</span></span></a><span class="mpre"> = </span><a name="loc_106_14_106_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_14_106_21&#39;)"><span class="hl_condecl"><span class="mpre">Created</span></span></a><span class="mpre">
           | </span><a name="loc_107_14_107_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_14_107_21&#39;)"><span class="hl_condecl"><span class="mpre">Running</span></span></a><span class="mpre">
           | </span><a name="loc_108_14_108_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_14_108_19&#39;)"><span class="hl_condecl"><span class="mpre">Dying</span></span></a><span class="mpre">
           | </span><a name="loc_109_14_109_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_14_109_23&#39;)"><span class="hl_condecl"><span class="mpre">Releasing</span></span></a><span class="mpre">
           | </span><a name="loc_110_14_110_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_14_110_22&#39;)"><span class="hl_condecl"><span class="mpre">Finished</span></span></a><span class="mpre">
             </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 111, srcSpanStartColumn = 14, srcSpanEndLine = 111, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 111, srcSpanStartColumn = 14, srcSpanEndLine = 111, srcSpanEndColumn = 22},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine "><span class="mpre">deriving (Eq, Show)</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | The event manager state.</span></span><span class="mpre">
data </span><a name="loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tycondecl"><span class="mpre">EventManager</span></span></a><span class="mpre"> = </span><span class="hl_condecl"><span class="mpre">EventManager</span></span><span class="mpre">
    { </span><a name="loc_115_7_115_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_7_115_16&#39;)"><span class="hl_fielddecl"><span class="mpre">emBackend</span></span></a><span class="mpre">      :: !</span><a href="GHC.Event.Internal.html#loc_89_6_89_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_89_6_89_13&#39;)"><span class="hl_tyconref"><span class="mpre">Backend</span></span></a><span class="mpre">
    , </span><a name="loc_116_7_116_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_7_116_12&#39;)"><span class="hl_fielddecl"><span class="mpre">emFds</span></span></a><span class="mpre">          :: {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Array</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> (</span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> (</span><a href="GHC.Event.IntTable.html#loc_33_9_33_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_33_9_33_17&#39;)"><span class="hl_tyconref"><span class="mpre">IntTable</span></span></a><span class="mpre"> [</span><a href="#loc_91_6_91_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_6_91_12&#39;)"><span class="hl_tyconref"><span class="mpre">FdData</span></span></a><span class="mpre">])))
    , </span><a name="loc_117_7_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_7_117_14&#39;)"><span class="hl_fielddecl"><span class="mpre">emState</span></span></a><span class="mpre">        :: {-# UNPACK #-} !(</span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><a href="#loc_106_6_106_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_6_106_11&#39;)"><span class="hl_tyconref"><span class="mpre">State</span></span></a><span class="mpre">)
    , </span><a name="loc_118_7_118_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_7_118_21&#39;)"><span class="hl_fielddecl"><span class="mpre">emUniqueSource</span></span></a><span class="mpre"> :: {-# UNPACK #-} !</span><a href="GHC.Event.Unique.html#loc_24_9_24_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Unique.html#loc_24_9_24_21&#39;)"><span class="hl_tyconref"><span class="mpre">UniqueSource</span></span></a><span class="mpre">
    , </span><a name="loc_119_7_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_7_119_16&#39;)"><span class="hl_fielddecl"><span class="mpre">emControl</span></span></a><span class="mpre">      :: {-# UNPACK #-} !</span><a href="GHC.Event.Control.html#loc_62_6_62_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Control.html#loc_62_6_62_13&#39;)"><span class="hl_tyconref"><span class="mpre">Control</span></span></a><span class="mpre">
    , </span><a name="loc_120_7_120_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_7_120_16&#39;)"><span class="hl_fielddecl"><span class="mpre">emOneShot</span></span></a><span class="mpre">      :: !</span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
    , </span><a name="loc_121_7_121_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_7_121_13&#39;)"><span class="hl_fielddecl"><span class="mpre">emLock</span></span></a><span class="mpre">         :: {-# UNPACK #-} !(</span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)
    }

</span><span class="hl_comment"><span class="mpre">-- must be power of 2</span></span><span class="mpre">
</span><a href="#loc_126_1_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_18&#39;)"><span class="mpre">callbackArraySize</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_126_1_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_18&#39;)"><span class="hl_vardecl"><span class="mpre">callbackArraySize</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">32</span></span><span class="mpre">

</span><a href="#loc_129_1_129_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_7&#39;)"><span class="mpre">hashFd</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_129_1_129_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_7&#39;)"><span class="hl_fundecl"><span class="mpre">hashFd</span></span></a><span class="mpre"> </span><a name="loc_129_8_129_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_8_129_10&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_129_8_129_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_8_129_10&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> (</span><a href="#loc_126_1_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_18&#39;)"><span class="hl_varref"><span class="mpre">callbackArraySize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_129_1_129_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_7&#39;)"><span class="mpre">hashFd</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_133_1_133_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_17&#39;)"><span class="mpre">callbackTableVar</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> (</span><a href="GHC.Event.IntTable.html#loc_33_9_33_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_33_9_33_17&#39;)"><span class="hl_tyconref"><span class="mpre">IntTable</span></span></a><span class="mpre"> [</span><a href="#loc_91_6_91_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_6_91_12&#39;)"><span class="hl_tyconref"><span class="mpre">FdData</span></span></a><span class="mpre">])
</span><a name="loc_133_1_133_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_17&#39;)"><span class="hl_fundecl"><span class="mpre">callbackTableVar</span></span></a><span class="mpre"> </span><a name="loc_133_18_133_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_18_133_21&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a name="loc_133_22_133_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_22_133_24&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> = </span><a href="#loc_116_7_116_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_7_116_12&#39;)"><span class="hl_varref"><span class="mpre">emFds</span></span></a><span class="mpre"> </span><a href="#loc_133_18_133_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_18_133_21&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="#loc_129_1_129_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_7&#39;)"><span class="hl_varref"><span class="mpre">hashFd</span></span></a><span class="mpre"> </span><a href="#loc_133_22_133_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_22_133_24&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_133_1_133_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_17&#39;)"><span class="mpre">callbackTableVar</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_139_1_139_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_12&#39;)"><span class="mpre">haveOneShot</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_139_1_139_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_12&#39;)"><span class="mpre">haveOneShot</span></a><span class="mpre"> #-}</span></span><span class="mpre">
#if defined(darwin_HOST_OS) || defined(ios_HOST_OS)
</span><a name="loc_139_1_139_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_12&#39;)"><span class="hl_vardecl"><span class="mpre">haveOneShot</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
#elif defined(HAVE_EPOLL) || defined(HAVE_KQUEUE)
</span><span class="hl_vardecl"><span class="mpre">haveOneShot</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
#else
</span><span class="hl_vardecl"><span class="mpre">haveOneShot</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
#endif
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Creation</span></span><span class="mpre">

</span><a href="#loc_149_1_149_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_1_149_19&#39;)"><span class="mpre">handleControlEvent</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><a href="GHC.Event.Internal.html#loc_37_9_37_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_37_9_37_14&#39;)"><span class="hl_tyconref"><span class="mpre">Event</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_149_1_149_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_1_149_19&#39;)"><span class="hl_fundecl"><span class="mpre">handleControlEvent</span></span></a><span class="mpre"> </span><a name="loc_149_20_149_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_20_149_23&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a name="loc_149_24_149_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_24_149_26&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_evt</span></span><span class="mpre"> = do
  </span><a name="loc_150_3_150_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_3_150_6&#39;)"><span class="hl_vardecl"><span class="mpre">msg</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.Event.Control.html#loc_135_1_135_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Control.html#loc_135_1_135_19&#39;)"><span class="hl_varref"><span class="mpre">readControlMessage</span></span></a><span class="mpre"> (</span><a href="#loc_119_7_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_7_119_16&#39;)"><span class="hl_varref"><span class="mpre">emControl</span></span></a><span class="mpre"> </span><a href="#loc_149_20_149_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_20_149_23&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">) </span><a href="#loc_149_24_149_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_24_149_26&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">
  case </span><a href="#loc_150_3_150_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_3_150_6&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre"> of
    </span><a href="GHC.Event.Control.html#loc_55_23_55_33" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Control.html#loc_55_23_55_33&#39;)"><span class="hl_conref"><span class="mpre">CMsgWakeup</span></span></a><span class="mpre">      -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    </span><a href="GHC.Event.Control.html#loc_56_23_56_30" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Control.html#loc_56_23_56_30&#39;)"><span class="hl_conref"><span class="mpre">CMsgDie</span></span></a><span class="mpre">         -&gt; </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> (</span><a href="#loc_117_7_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_7_117_14&#39;)"><span class="hl_varref"><span class="mpre">emState</span></span></a><span class="mpre"> </span><a href="#loc_149_20_149_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_20_149_23&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">) </span><a href="#loc_110_14_110_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_14_110_22&#39;)"><span class="hl_conref"><span class="mpre">Finished</span></span></a><span class="mpre">
    </span><a href="GHC.Event.Control.html#loc_57_23_57_33" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Control.html#loc_57_23_57_33&#39;)"><span class="hl_conref"><span class="mpre">CMsgSignal</span></span></a><span class="mpre"> </span><a name="loc_154_16_154_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_16_154_18&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a name="loc_154_19_154_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_19_154_20&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.Conc.Signal.html#loc_63_1_63_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Conc.Signal.html#loc_63_1_63_12&#39;)"><span class="hl_varref"><span class="mpre">runHandlers</span></span></a><span class="mpre"> </span><a href="#loc_154_16_154_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_16_154_18&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a href="#loc_154_19_154_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_19_154_20&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">

</span><a href="#loc_158_1_158_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_1_158_18&#39;)"><span class="mpre">newDefaultBackend</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.Event.Internal.html#loc_89_6_89_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_89_6_89_13&#39;)"><span class="hl_tyconref"><span class="mpre">Backend</span></span></a><span class="mpre">
#if defined(HAVE_KQUEUE)
</span><a name="loc_158_1_158_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_1_158_18&#39;)"><span class="hl_vardecl"><span class="mpre">newDefaultBackend</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">KQueue.new</span></span><span class="mpre">
#elif defined(HAVE_EPOLL)
</span><span class="hl_vardecl"><span class="mpre">newDefaultBackend</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">EPoll.new</span></span><span class="mpre">
#elif defined(HAVE_POLL)
</span><span class="hl_vardecl"><span class="mpre">newDefaultBackend</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">Poll.new</span></span><span class="mpre">
#else
</span><span class="hl_vardecl"><span class="mpre">newDefaultBackend</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;no back end for this platform&quot;</span></span><span class="mpre">
#endif

</span><span class="hl_comment"><span class="mpre">-- | Create a new event manager.</span></span><span class="mpre">
</span><a href="#loc_169_1_169_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_1_169_4&#39;)"><span class="mpre">new</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre">
</span><a name="loc_169_1_169_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_1_169_4&#39;)"><span class="hl_fundecl"><span class="mpre">new</span></span></a><span class="mpre"> </span><a name="loc_169_5_169_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_5_169_12&#39;)"><span class="hl_vardecl"><span class="mpre">oneShot</span></span></a><span class="mpre"> = </span><a href="#loc_172_1_172_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_1_172_8&#39;)"><span class="hl_varref"><span class="mpre">newWith</span></span></a><span class="mpre"> </span><a href="#loc_169_5_169_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_5_169_12&#39;)"><span class="hl_varref"><span class="mpre">oneShot</span></span></a><span class="mpre"> </span><a href="Control.Monad.html#loc_92_3_92_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_92_3_92_6&#39;)"><span class="hl_infix"><span class="mpre">=&lt;&lt;</span></span></a><span class="mpre"> </span><a href="#loc_158_1_158_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_1_158_18&#39;)"><span class="hl_varref"><span class="mpre">newDefaultBackend</span></span></a><span class="mpre">

</span><a href="#loc_172_1_172_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_1_172_8&#39;)"><span class="mpre">newWith</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><a href="GHC.Event.Internal.html#loc_89_6_89_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_89_6_89_13&#39;)"><span class="hl_tyconref"><span class="mpre">Backend</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre">
</span><a name="loc_172_1_172_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_1_172_8&#39;)"><span class="hl_fundecl"><span class="mpre">newWith</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">oneShot</span></span><span class="mpre"> </span><a name="loc_172_17_172_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_17_172_19&#39;)"><span class="hl_vardecl"><span class="mpre">be</span></span></a><span class="mpre"> = do
  </span><span class="hl_vardecl"><span class="mpre">iofds</span></span><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">listArray</span></span><span class="mpre"> (</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">, </span><a href="#loc_126_1_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_18&#39;)"><span class="hl_varref"><span class="mpre">callbackArraySize</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
           </span><a href="Control.Monad.html#loc_250_1_250_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_250_1_250_11&#39;)"><span class="hl_varref"><span class="mpre">replicateM</span></span></a><span class="mpre"> </span><a href="#loc_126_1_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_18&#39;)"><span class="hl_varref"><span class="mpre">callbackArraySize</span></span></a><span class="mpre"> (</span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="hl_varref"><span class="mpre">newMVar</span></span></a><span class="mpre"> </span><a href="Control.Monad.html#loc_92_3_92_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_92_3_92_6&#39;)"><span class="hl_infix"><span class="mpre">=&lt;&lt;</span></span></a><span class="mpre"> </span><a href="GHC.Event.IntTable.html#loc_57_1_57_4" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_57_1_57_4&#39;)"><span class="hl_varref"><span class="mpre">IT.new</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">)
  </span><a name="loc_175_3_175_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_3_175_7&#39;)"><span class="hl_vardecl"><span class="mpre">ctrl</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.Event.Control.html#loc_82_1_82_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Control.html#loc_82_1_82_11&#39;)"><span class="hl_varref"><span class="mpre">newControl</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
  </span><a name="loc_176_3_176_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_3_176_8&#39;)"><span class="hl_vardecl"><span class="mpre">state</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_106_14_106_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_14_106_21&#39;)"><span class="hl_conref"><span class="mpre">Created</span></span></a><span class="mpre">
  </span><span class="hl_vardecl"><span class="mpre">us</span></span><span class="mpre"> &lt;- </span><a href="GHC.Event.Unique.html#loc_33_1_33_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Unique.html#loc_33_1_33_10&#39;)"><span class="hl_varref"><span class="mpre">newSource</span></span></a><span class="mpre">
  _ &lt;- </span><a href="Data.IORef.html#loc_52_1_52_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_52_1_52_12&#39;)"><span class="hl_varref"><span class="mpre">mkWeakIORef</span></span></a><span class="mpre"> </span><a href="#loc_176_3_176_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_3_176_8&#39;)"><span class="hl_varref"><span class="mpre">state</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
               </span><a name="loc_179_16_179_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_16_179_18&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> &lt;- </span><a href="Data.IORef.html#loc_108_1_108_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_108_1_108_19&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef&#39;</span></span></a><span class="mpre"> </span><a href="#loc_176_3_176_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_176_3_176_8&#39;)"><span class="hl_varref"><span class="mpre">state</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_179_50_179_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_50_179_51&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_110_14_110_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_14_110_22&#39;)"><span class="hl_conref"><span class="mpre">Finished</span></span></a><span class="mpre">, </span><a href="#loc_179_50_179_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_50_179_51&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)
               </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_179_16_179_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_16_179_18&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="#loc_110_14_110_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_14_110_22&#39;)"><span class="hl_conref"><span class="mpre">Finished</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
                 </span><a href="GHC.Event.Internal.html#loc_144_1_144_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_144_1_144_7&#39;)"><span class="hl_varref"><span class="mpre">I.delete</span></span></a><span class="mpre"> </span><a href="#loc_172_17_172_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_17_172_19&#39;)"><span class="hl_varref"><span class="mpre">be</span></span></a><span class="mpre">
                 </span><a href="GHC.Event.Control.html#loc_116_1_116_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Control.html#loc_116_1_116_13&#39;)"><span class="hl_varref"><span class="mpre">closeControl</span></span></a><span class="mpre"> </span><a href="#loc_175_3_175_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_3_175_7&#39;)"><span class="hl_varref"><span class="mpre">ctrl</span></span></a><span class="mpre">
  </span><span class="hl_vardecl"><span class="mpre">lockVar</span></span><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="hl_varref"><span class="mpre">newMVar</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
  let </span><a name="loc_184_7_184_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_7_184_10&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 184, srcSpanStartColumn = 13, srcSpanEndLine = 191, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 184, srcSpanStartColumn = 26, srcSpanEndLine = 184, srcSpanEndColumn = 27},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine"><span class="mpre">EventManager { emBackend = be
                         , emFds = iofds
                         , emState = state
                         , emUniqueSource = us
                         , emControl = ctrl
                         , emOneShot = oneShot
                         , emLock = lockVar
                         }</span></span><span class="mpre">
  </span><a href="#loc_205_1_205_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_1_205_18&#39;)"><span class="hl_varref"><span class="mpre">registerControlFd</span></span></a><span class="mpre"> </span><a href="#loc_184_7_184_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_7_184_10&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> (</span><a href="GHC.Event.Control.html#loc_63_7_63_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Control.html#loc_63_7_63_20&#39;)"><span class="hl_varref"><span class="mpre">controlReadFd</span></span></a><span class="mpre"> </span><a href="#loc_175_3_175_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_3_175_7&#39;)"><span class="hl_varref"><span class="mpre">ctrl</span></span></a><span class="mpre">) </span><a href="GHC.Event.Internal.html#loc_46_1_46_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_46_1_46_8&#39;)"><span class="hl_varref"><span class="mpre">evtRead</span></span></a><span class="mpre">
  </span><a href="#loc_205_1_205_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_1_205_18&#39;)"><span class="hl_varref"><span class="mpre">registerControlFd</span></span></a><span class="mpre"> </span><a href="#loc_184_7_184_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_7_184_10&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> (</span><a href="GHC.Event.Control.html#loc_68_7_68_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Control.html#loc_68_7_68_19&#39;)"><span class="hl_varref"><span class="mpre">wakeupReadFd</span></span></a><span class="mpre"> </span><a href="#loc_175_3_175_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_3_175_7&#39;)"><span class="hl_varref"><span class="mpre">ctrl</span></span></a><span class="mpre">) </span><a href="GHC.Event.Internal.html#loc_46_1_46_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_46_1_46_8&#39;)"><span class="hl_varref"><span class="mpre">evtRead</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_184_7_184_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_7_184_10&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">

</span><a href="#loc_197_1_197_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_1_197_18&#39;)"><span class="mpre">failOnInvalidFile</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_197_1_197_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_1_197_18&#39;)"><span class="hl_fundecl"><span class="mpre">failOnInvalidFile</span></span></a><span class="mpre"> </span><a name="loc_197_19_197_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_19_197_22&#39;)"><span class="hl_vardecl"><span class="mpre">loc</span></span></a><span class="mpre"> </span><a name="loc_197_23_197_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_23_197_25&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a name="loc_197_26_197_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_26_197_27&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = do
  </span><a name="loc_198_3_198_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_3_198_5&#39;)"><span class="hl_vardecl"><span class="mpre">ok</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_197_26_197_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_26_197_27&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
  </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><a href="#loc_198_3_198_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_3_198_5&#39;)"><span class="hl_varref"><span class="mpre">ok</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
    let </span><a name="loc_200_9_200_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_9_200_12&#39;)"><span class="hl_vardecl"><span class="mpre">msg</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;Failed while attempting to modify registration of file &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">
              </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_197_23_197_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_23_197_25&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; at location &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_197_19_197_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_19_197_22&#39;)"><span class="hl_varref"><span class="mpre">loc</span></span></a><span class="mpre">
    in </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><a href="#loc_200_9_200_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_9_200_12&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre">

</span><a href="#loc_205_1_205_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_1_205_18&#39;)"><span class="mpre">registerControlFd</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><a href="GHC.Event.Internal.html#loc_37_9_37_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_37_9_37_14&#39;)"><span class="hl_tyconref"><span class="mpre">Event</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_205_1_205_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_1_205_18&#39;)"><span class="hl_fundecl"><span class="mpre">registerControlFd</span></span></a><span class="mpre"> </span><a name="loc_205_19_205_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_19_205_22&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a name="loc_205_23_205_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_23_205_25&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a name="loc_205_26_205_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_26_205_29&#39;)"><span class="hl_vardecl"><span class="mpre">evs</span></span></a><span class="mpre"> =
  </span><a href="#loc_197_1_197_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_1_197_18&#39;)"><span class="hl_varref"><span class="mpre">failOnInvalidFile</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;registerControlFd&quot;</span></span><span class="mpre"> </span><a href="#loc_205_23_205_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_23_205_25&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
  </span><a href="GHC.Event.Internal.html#loc_133_1_133_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_133_1_133_9&#39;)"><span class="hl_varref"><span class="mpre">I.modifyFd</span></span></a><span class="mpre"> (</span><a href="#loc_115_7_115_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_7_115_16&#39;)"><span class="hl_varref"><span class="mpre">emBackend</span></span></a><span class="mpre"> </span><a href="#loc_205_19_205_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_19_205_22&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">) </span><a href="#loc_205_23_205_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_23_205_25&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre"> </span><a href="#loc_205_26_205_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_26_205_29&#39;)"><span class="hl_varref"><span class="mpre">evs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Asynchronously shuts down the event manager, if running.</span></span><span class="mpre">
</span><a href="#loc_211_1_211_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_9&#39;)"><span class="mpre">shutdown</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_211_1_211_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_9&#39;)"><span class="hl_fundecl"><span class="mpre">shutdown</span></span></a><span class="mpre"> </span><a name="loc_211_10_211_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_10_211_13&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> = do
  </span><a name="loc_212_3_212_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_3_212_8&#39;)"><span class="hl_vardecl"><span class="mpre">state</span></span></a><span class="mpre"> &lt;- </span><a href="Data.IORef.html#loc_108_1_108_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_108_1_108_19&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef&#39;</span></span></a><span class="mpre"> (</span><a href="#loc_117_7_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_7_117_14&#39;)"><span class="hl_varref"><span class="mpre">emState</span></span></a><span class="mpre"> </span><a href="#loc_211_10_211_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_10_211_13&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_212_48_212_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_48_212_49&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_108_14_108_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_14_108_19&#39;)"><span class="hl_conref"><span class="mpre">Dying</span></span></a><span class="mpre">, </span><a href="#loc_212_48_212_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_48_212_49&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)
  </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_212_3_212_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_3_212_8&#39;)"><span class="hl_varref"><span class="mpre">state</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_107_14_107_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_14_107_21&#39;)"><span class="hl_conref"><span class="mpre">Running</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.Event.Control.html#loc_184_1_184_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Control.html#loc_184_1_184_8&#39;)"><span class="hl_varref"><span class="mpre">sendDie</span></span></a><span class="mpre"> (</span><a href="#loc_119_7_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_7_119_16&#39;)"><span class="hl_varref"><span class="mpre">emControl</span></span></a><span class="mpre"> </span><a href="#loc_211_10_211_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_10_211_13&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Asynchronously tell the thread executing the event</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- manager loop to exit.</span></span><span class="mpre">
</span><a href="#loc_218_1_218_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_1_218_8&#39;)"><span class="mpre">release</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_218_1_218_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_1_218_8&#39;)"><span class="hl_fundecl"><span class="mpre">release</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 218, srcSpanStartColumn = 9, srcSpanEndLine = 218, srcSpanEndColumn = 25}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 218, srcSpanStartColumn = 21, srcSpanEndLine = 218, srcSpanEndColumn = 22},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 218"><span class="mpre">EventManager{..}</span></span><span class="mpre"> = do
  </span><a name="loc_219_3_219_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_3_219_8&#39;)"><span class="hl_vardecl"><span class="mpre">state</span></span></a><span class="mpre"> &lt;- </span><a href="Data.IORef.html#loc_108_1_108_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_108_1_108_19&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef&#39;</span></span></a><span class="mpre"> </span><a href="#loc_117_7_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_7_117_14&#39;)"><span class="hl_varref"><span class="mpre">emState</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_219_42_219_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_42_219_43&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_109_14_109_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_14_109_23&#39;)"><span class="hl_conref"><span class="mpre">Releasing</span></span></a><span class="mpre">, </span><a href="#loc_219_42_219_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_42_219_43&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)
  </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_219_3_219_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_3_219_8&#39;)"><span class="hl_varref"><span class="mpre">state</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_107_14_107_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_14_107_21&#39;)"><span class="hl_conref"><span class="mpre">Running</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.Event.Control.html#loc_169_1_169_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Control.html#loc_169_1_169_11&#39;)"><span class="hl_varref"><span class="mpre">sendWakeup</span></span></a><span class="mpre"> </span><a href="#loc_119_7_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_7_119_16&#39;)"><span class="hl_varref"><span class="mpre">emControl</span></span></a><span class="mpre">

</span><a href="#loc_223_1_223_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_1_223_9&#39;)"><span class="mpre">finished</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_223_1_223_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_1_223_9&#39;)"><span class="hl_fundecl"><span class="mpre">finished</span></span></a><span class="mpre"> </span><a name="loc_223_10_223_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_10_223_13&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> = (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_110_14_110_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_14_110_22&#39;)"><span class="hl_conref"><span class="mpre">Finished</span></span></a><span class="mpre">) </span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="hl_infix"><span class="mpre">`liftM`</span></span></a><span class="mpre"> </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> (</span><a href="#loc_117_7_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_7_117_14&#39;)"><span class="hl_varref"><span class="mpre">emState</span></span></a><span class="mpre"> </span><a href="#loc_223_10_223_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_10_223_13&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">)

</span><a href="#loc_226_1_226_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_1_226_8&#39;)"><span class="mpre">cleanup</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_226_1_226_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_1_226_8&#39;)"><span class="hl_fundecl"><span class="mpre">cleanup</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 226, srcSpanStartColumn = 9, srcSpanEndLine = 226, srcSpanEndColumn = 25}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 226, srcSpanStartColumn = 21, srcSpanEndLine = 226, srcSpanEndColumn = 22},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 226"><span class="mpre">EventManager{..}</span></span><span class="mpre"> = do
  </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_117_7_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_7_117_14&#39;)"><span class="hl_varref"><span class="mpre">emState</span></span></a><span class="mpre"> </span><a href="#loc_110_14_110_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_14_110_22&#39;)"><span class="hl_conref"><span class="mpre">Finished</span></span></a><span class="mpre">
  </span><a href="Control.Monad.html#loc_195_1_195_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_195_1_195_5&#39;)"><span class="hl_varref"><span class="mpre">void</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.MVar.html#loc_151_1_151_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_151_1_151_11&#39;)"><span class="hl_varref"><span class="mpre">tryPutMVar</span></span></a><span class="mpre"> </span><a href="#loc_121_7_121_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_7_121_13&#39;)"><span class="hl_varref"><span class="mpre">emLock</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
  </span><a href="GHC.Event.Internal.html#loc_144_1_144_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_144_1_144_7&#39;)"><span class="hl_varref"><span class="mpre">I.delete</span></span></a><span class="mpre"> </span><a href="#loc_115_7_115_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_7_115_16&#39;)"><span class="hl_varref"><span class="mpre">emBackend</span></span></a><span class="mpre">
  </span><a href="GHC.Event.Control.html#loc_116_1_116_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Control.html#loc_116_1_116_13&#39;)"><span class="hl_varref"><span class="mpre">closeControl</span></span></a><span class="mpre"> </span><a href="#loc_119_7_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_7_119_16&#39;)"><span class="hl_varref"><span class="mpre">emControl</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Event loop</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Start handling events.  This function loops until told to stop,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- using &#39;shutdown&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /Note/: This loop can only be run once per &#39;EventManager&#39;, as it</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- closes all of its control resources when it finishes.</span></span><span class="mpre">
</span><a href="#loc_241_1_241_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_1_241_5&#39;)"><span class="mpre">loop</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_241_1_241_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_1_241_5&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_241_6_241_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_6_241_9&#39;)"><span class="hl_specname"><span class="mpre">mgr</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 241, srcSpanStartColumn = 10, srcSpanEndLine = 241, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 241, srcSpanStartColumn = 22, srcSpanEndLine = 241, srcSpanEndColumn = 23},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 24"><span class="mpre">EventManager{..}</span></span><span class="mpre"> = do
  </span><a href="Control.Monad.html#loc_195_1_195_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_195_1_195_5&#39;)"><span class="hl_varref"><span class="mpre">void</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="hl_varref"><span class="mpre">takeMVar</span></span></a><span class="mpre"> </span><a href="#loc_121_7_121_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_7_121_13&#39;)"><span class="hl_varref"><span class="mpre">emLock</span></span></a><span class="mpre">
  </span><a name="loc_243_3_243_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_3_243_8&#39;)"><span class="hl_vardecl"><span class="mpre">state</span></span></a><span class="mpre"> &lt;- </span><a href="Data.IORef.html#loc_108_1_108_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_108_1_108_19&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef&#39;</span></span></a><span class="mpre"> </span><a href="#loc_117_7_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_7_117_14&#39;)"><span class="hl_varref"><span class="mpre">emState</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_243_42_243_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_42_243_43&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; case </span><a href="#loc_243_42_243_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_42_243_43&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
    </span><a href="#loc_106_14_106_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_14_106_21&#39;)"><span class="hl_conref"><span class="mpre">Created</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_107_14_107_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_14_107_21&#39;)"><span class="hl_conref"><span class="mpre">Running</span></span></a><span class="mpre">, </span><a href="#loc_243_42_243_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_42_243_43&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)
    </span><a href="#loc_109_14_109_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_14_109_23&#39;)"><span class="hl_conref"><span class="mpre">Releasing</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_107_14_107_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_14_107_21&#39;)"><span class="hl_conref"><span class="mpre">Running</span></span></a><span class="mpre">, </span><a href="#loc_243_42_243_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_42_243_43&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)
    _       -&gt; (</span><a href="#loc_243_42_243_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_42_243_43&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">, </span><a href="#loc_243_42_243_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_42_243_43&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)
  case </span><a href="#loc_243_3_243_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_3_243_8&#39;)"><span class="hl_varref"><span class="mpre">state</span></span></a><span class="mpre"> of
    </span><a href="#loc_106_14_106_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_14_106_21&#39;)"><span class="hl_conref"><span class="mpre">Created</span></span></a><span class="mpre">   -&gt; </span><a href="#loc_260_3_260_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_260_3_260_5&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="Control.Exception.Base.html#loc_229_1_229_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_229_1_229_12&#39;)"><span class="hl_infix"><span class="mpre">`onException`</span></span></a><span class="mpre"> </span><a href="#loc_226_1_226_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_1_226_8&#39;)"><span class="hl_varref"><span class="mpre">cleanup</span></span></a><span class="mpre"> </span><a href="#loc_241_6_241_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_6_241_9&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">
    </span><a href="#loc_109_14_109_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_14_109_23&#39;)"><span class="hl_conref"><span class="mpre">Releasing</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_260_3_260_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_260_3_260_5&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="Control.Exception.Base.html#loc_229_1_229_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_229_1_229_12&#39;)"><span class="hl_infix"><span class="mpre">`onException`</span></span></a><span class="mpre"> </span><a href="#loc_226_1_226_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_1_226_8&#39;)"><span class="hl_varref"><span class="mpre">cleanup</span></span></a><span class="mpre"> </span><a href="#loc_241_6_241_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_6_241_9&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">
    </span><a href="#loc_108_14_108_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_14_108_19&#39;)"><span class="hl_conref"><span class="mpre">Dying</span></span></a><span class="mpre">     -&gt; </span><a href="#loc_226_1_226_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_1_226_8&#39;)"><span class="hl_varref"><span class="mpre">cleanup</span></span></a><span class="mpre"> </span><a href="#loc_241_6_241_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_6_241_9&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- While a poll loop is never forked when the event manager is in the</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- &#39;Finished&#39; state, its state could read &#39;Finished&#39; once the new thread</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- actually runs.  This is not an error, just an unfortunate race condition</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- in Thread.restartPollLoop.  See #8235</span></span><span class="mpre">
    </span><a href="#loc_110_14_110_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_14_110_22&#39;)"><span class="hl_conref"><span class="mpre">Finished</span></span></a><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    _         -&gt; do </span><a href="#loc_226_1_226_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_1_226_8&#39;)"><span class="hl_varref"><span class="mpre">cleanup</span></span></a><span class="mpre"> </span><a href="#loc_241_6_241_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_6_241_9&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">
                    </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;GHC.Event.Manager.loop: state is already &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">
                            </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_243_3_243_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_3_243_8&#39;)"><span class="hl_varref"><span class="mpre">state</span></span></a><span class="mpre">
 where
  </span><a name="loc_260_3_260_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_260_3_260_5&#39;)"><span class="hl_vardecl"><span class="mpre">go</span></span></a><span class="mpre"> = do </span><a name="loc_260_11_260_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_260_11_260_16&#39;)"><span class="hl_vardecl"><span class="mpre">state</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_275_1_275_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_275_1_275_5&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_241_6_241_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_6_241_9&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">
          case </span><a href="#loc_260_11_260_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_260_11_260_16&#39;)"><span class="hl_varref"><span class="mpre">state</span></span></a><span class="mpre"> of
            </span><a href="#loc_107_14_107_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_14_107_21&#39;)"><span class="hl_conref"><span class="mpre">Running</span></span></a><span class="mpre">   -&gt; </span><span class="hl_varref"><span class="mpre">yield</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_260_3_260_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_260_3_260_5&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre">
            </span><a href="#loc_109_14_109_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_14_109_23&#39;)"><span class="hl_conref"><span class="mpre">Releasing</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_121_7_121_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_7_121_13&#39;)"><span class="hl_varref"><span class="mpre">emLock</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
            _         -&gt; </span><a href="#loc_226_1_226_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_226_1_226_8&#39;)"><span class="hl_varref"><span class="mpre">cleanup</span></span></a><span class="mpre"> </span><a href="#loc_241_6_241_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_6_241_9&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | To make a step, we first do a non-blocking poll, in case</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- there are already events ready to handle. This improves performance</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- because we can make an unsafe foreign C call, thereby avoiding</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- forcing the current Task to release the Capability and forcing a context switch.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If the poll fails to find events, we yield, putting the poll loop thread at</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- end of the Haskell run queue. When it comes back around, we do one more</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- non-blocking poll, in case we get lucky and have ready events.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If that also returns no events, then we do a blocking poll.</span></span><span class="mpre">
</span><a href="#loc_275_1_275_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_275_1_275_5&#39;)"><span class="mpre">step</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_106_6_106_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_6_106_11&#39;)"><span class="hl_tyconref"><span class="mpre">State</span></span></a><span class="mpre">
</span><a name="loc_275_1_275_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_275_1_275_5&#39;)"><span class="hl_fundecl"><span class="mpre">step</span></span></a><span class="mpre"> </span><a name="loc_275_6_275_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_275_6_275_9&#39;)"><span class="hl_specname"><span class="mpre">mgr</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 275, srcSpanStartColumn = 10, srcSpanEndLine = 275, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 275, srcSpanStartColumn = 22, srcSpanEndLine = 275, srcSpanEndColumn = 23},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 27"><span class="mpre">EventManager{..}</span></span><span class="mpre"> = do
  </span><a href="#loc_280_5_280_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_5_280_14&#39;)"><span class="hl_varref"><span class="mpre">waitForIO</span></span></a><span class="mpre">
  </span><a name="loc_277_3_277_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_3_277_8&#39;)"><span class="hl_vardecl"><span class="mpre">state</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_117_7_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_7_117_14&#39;)"><span class="hl_varref"><span class="mpre">emState</span></span></a><span class="mpre">
  </span><a href="#loc_277_3_277_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_3_277_8&#39;)"><span class="hl_varref"><span class="mpre">state</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`seq`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_277_3_277_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_3_277_8&#39;)"><span class="hl_varref"><span class="mpre">state</span></span></a><span class="mpre">
  where
    </span><a name="loc_280_5_280_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_5_280_14&#39;)"><span class="hl_vardecl"><span class="mpre">waitForIO</span></span></a><span class="mpre"> = do
      </span><a name="loc_281_7_281_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_7_281_9&#39;)"><span class="hl_vardecl"><span class="mpre">n1</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.Event.Internal.html#loc_126_1_126_5" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_126_1_126_5&#39;)"><span class="hl_varref"><span class="mpre">I.poll</span></span></a><span class="mpre"> </span><a href="#loc_115_7_115_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_7_115_16&#39;)"><span class="hl_varref"><span class="mpre">emBackend</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> (</span><a href="#loc_434_1_434_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_1_434_10&#39;)"><span class="hl_varref"><span class="mpre">onFdEvent</span></span></a><span class="mpre"> </span><a href="#loc_275_6_275_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_275_6_275_9&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">)
      </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_281_7_281_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_7_281_9&#39;)"><span class="hl_varref"><span class="mpre">n1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><span class="hl_varref"><span class="mpre">yield</span></span><span class="mpre">
        </span><a name="loc_284_9_284_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_284_9_284_11&#39;)"><span class="hl_vardecl"><span class="mpre">n2</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.Event.Internal.html#loc_126_1_126_5" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_126_1_126_5&#39;)"><span class="hl_varref"><span class="mpre">I.poll</span></span></a><span class="mpre"> </span><a href="#loc_115_7_115_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_7_115_16&#39;)"><span class="hl_varref"><span class="mpre">emBackend</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> (</span><a href="#loc_434_1_434_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_1_434_10&#39;)"><span class="hl_varref"><span class="mpre">onFdEvent</span></span></a><span class="mpre"> </span><a href="#loc_275_6_275_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_275_6_275_9&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">)
        </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_284_9_284_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_284_9_284_11&#39;)"><span class="hl_varref"><span class="mpre">n2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
          _ &lt;- </span><a href="GHC.Event.Internal.html#loc_126_1_126_5" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_126_1_126_5&#39;)"><span class="hl_varref"><span class="mpre">I.poll</span></span></a><span class="mpre"> </span><a href="#loc_115_7_115_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_7_115_16&#39;)"><span class="hl_varref"><span class="mpre">emBackend</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="GHC.Event.Internal.html#loc_85_16_85_23" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_85_16_85_23&#39;)"><span class="hl_conref"><span class="mpre">Forever</span></span></a><span class="mpre">) (</span><a href="#loc_434_1_434_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_1_434_10&#39;)"><span class="hl_varref"><span class="mpre">onFdEvent</span></span></a><span class="mpre"> </span><a href="#loc_275_6_275_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_275_6_275_9&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">)
          </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Registering interest in I/O events</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Register interest in the given events, without waking the event</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- manager thread.  The &#39;Bool&#39; return value indicates whether the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- event manager ought to be woken.</span></span><span class="mpre">
</span><a href="#loc_297_1_297_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_1_297_12&#39;)"><span class="mpre">registerFd_</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IOCallback</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><a href="GHC.Event.Internal.html#loc_37_9_37_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_37_9_37_14&#39;)"><span class="hl_tyconref"><span class="mpre">Event</span></span></a><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_98_6_98_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_6_98_11&#39;)"><span class="hl_tyconref"><span class="mpre">FdKey</span></span></a><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">)
</span><a name="loc_297_1_297_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_1_297_12&#39;)"><span class="hl_fundecl"><span class="mpre">registerFd_</span></span></a><span class="mpre"> </span><a name="loc_297_13_297_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_13_297_16&#39;)"><span class="hl_specname"><span class="mpre">mgr</span></span></a><span class="mpre">@(</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 297, srcSpanStartColumn = 18, srcSpanEndLine = 297, srcSpanEndColumn = 34}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 297, srcSpanStartColumn = 30, srcSpanEndLine = 297, srcSpanEndColumn = 31},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 29"><span class="mpre">EventManager{..}</span></span><span class="mpre">) </span><a name="loc_297_36_297_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_36_297_38&#39;)"><span class="hl_vardecl"><span class="mpre">cb</span></span></a><span class="mpre"> </span><a name="loc_297_39_297_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_39_297_41&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a name="loc_297_42_297_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_42_297_45&#39;)"><span class="hl_vardecl"><span class="mpre">evs</span></span></a><span class="mpre"> = do
  </span><a name="loc_298_3_298_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_298_3_298_4&#39;)"><span class="hl_vardecl"><span class="mpre">u</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.Event.Unique.html#loc_36_1_36_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Unique.html#loc_36_1_36_10&#39;)"><span class="hl_varref"><span class="mpre">newUnique</span></span></a><span class="mpre"> </span><a href="#loc_118_7_118_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_7_118_21&#39;)"><span class="hl_varref"><span class="mpre">emUniqueSource</span></span></a><span class="mpre">
  let </span><a name="loc_299_7_299_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_7_299_10&#39;)"><span class="hl_vardecl"><span class="mpre">fd&#39;</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_297_39_297_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_39_297_41&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">
      </span><a name="loc_300_7_300_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_300_7_300_10&#39;)"><span class="hl_vardecl"><span class="mpre">reg</span></span></a><span class="mpre">  = </span><a href="#loc_98_14_98_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_14_98_19&#39;)"><span class="hl_conref"><span class="mpre">FdKey</span></span></a><span class="mpre"> </span><a href="#loc_297_39_297_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_39_297_41&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="#loc_298_3_298_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_298_3_298_4&#39;)"><span class="hl_varref"><span class="mpre">u</span></span></a><span class="mpre">
      !</span><a name="loc_301_8_301_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_301_8_301_11&#39;)"><span class="hl_vardecl"><span class="mpre">fdd</span></span></a><span class="mpre"> = </span><a href="#loc_91_15_91_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_15_91_21&#39;)"><span class="hl_conref"><span class="mpre">FdData</span></span></a><span class="mpre"> </span><a href="#loc_300_7_300_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_300_7_300_10&#39;)"><span class="hl_varref"><span class="mpre">reg</span></span></a><span class="mpre"> </span><a href="#loc_297_42_297_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_42_297_45&#39;)"><span class="hl_varref"><span class="mpre">evs</span></span></a><span class="mpre"> </span><a href="#loc_297_36_297_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_36_297_38&#39;)"><span class="hl_varref"><span class="mpre">cb</span></span></a><span class="mpre">
  (</span><a name="loc_302_4_302_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_4_302_10&#39;)"><span class="hl_vardecl"><span class="mpre">modify</span></span></a><span class="mpre">,</span><a name="loc_302_11_302_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_11_302_13&#39;)"><span class="hl_vardecl"><span class="mpre">ok</span></span></a><span class="mpre">) &lt;- </span><a href="Control.Concurrent.MVar.html#loc_185_1_185_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_185_1_185_9&#39;)"><span class="hl_varref"><span class="mpre">withMVar</span></span></a><span class="mpre"> (</span><a href="#loc_133_1_133_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_17&#39;)"><span class="hl_varref"><span class="mpre">callbackTableVar</span></span></a><span class="mpre"> </span><a href="#loc_297_13_297_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_13_297_16&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_297_39_297_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_39_297_41&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_302_56_302_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_56_302_59&#39;)"><span class="hl_vardecl"><span class="mpre">tbl</span></span></a><span class="mpre"> -&gt;
    if </span><a href="#loc_139_1_139_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_12&#39;)"><span class="hl_varref"><span class="mpre">haveOneShot</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_120_7_120_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_7_120_16&#39;)"><span class="hl_varref"><span class="mpre">emOneShot</span></span></a><span class="mpre">
    then do
      </span><a name="loc_305_7_305_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_305_7_305_13&#39;)"><span class="hl_vardecl"><span class="mpre">oldFdd</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.Event.IntTable.html#loc_86_1_86_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_86_1_86_11&#39;)"><span class="hl_varref"><span class="mpre">IT.insertWith</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">(++)</span></span><span class="mpre"> </span><a href="#loc_299_7_299_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_7_299_10&#39;)"><span class="hl_varref"><span class="mpre">fd&#39;</span></span></a><span class="mpre"> [</span><a href="#loc_301_8_301_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_301_8_301_11&#39;)"><span class="hl_varref"><span class="mpre">fdd</span></span></a><span class="mpre">] </span><a href="#loc_302_56_302_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_56_302_59&#39;)"><span class="hl_varref"><span class="mpre">tbl</span></span></a><span class="mpre">
      let </span><a name="loc_306_11_306_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_306_11_306_15&#39;)"><span class="hl_vardecl"><span class="mpre">evs&#39;</span></span></a><span class="mpre"> = </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> </span><a href="#loc_297_42_297_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_42_297_45&#39;)"><span class="hl_varref"><span class="mpre">evs</span></span></a><span class="mpre"> (</span><a href="#loc_331_1_331_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_331_1_331_14&#39;)"><span class="hl_varref"><span class="mpre">combineEvents</span></span></a><span class="mpre"> </span><a href="#loc_297_42_297_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_42_297_45&#39;)"><span class="hl_varref"><span class="mpre">evs</span></span></a><span class="mpre">) </span><a href="#loc_305_7_305_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_305_7_305_13&#39;)"><span class="hl_varref"><span class="mpre">oldFdd</span></span></a><span class="mpre">
      </span><a name="loc_307_7_307_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_7_307_9&#39;)"><span class="hl_vardecl"><span class="mpre">ok</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.Event.Internal.html#loc_140_1_140_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_140_1_140_13&#39;)"><span class="hl_varref"><span class="mpre">I.modifyFdOnce</span></span></a><span class="mpre"> </span><a href="#loc_115_7_115_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_7_115_16&#39;)"><span class="hl_varref"><span class="mpre">emBackend</span></span></a><span class="mpre"> </span><a href="#loc_297_39_297_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_39_297_41&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="#loc_306_11_306_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_306_11_306_15&#39;)"><span class="hl_varref"><span class="mpre">evs&#39;</span></span></a><span class="mpre">
      if </span><a href="#loc_307_7_307_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_307_7_307_9&#39;)"><span class="hl_varref"><span class="mpre">ok</span></span></a><span class="mpre">
        then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">)
        else </span><a href="GHC.Event.IntTable.html#loc_111_1_111_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_111_1_111_6&#39;)"><span class="hl_varref"><span class="mpre">IT.reset</span></span></a><span class="mpre"> </span><a href="#loc_299_7_299_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_7_299_10&#39;)"><span class="hl_varref"><span class="mpre">fd&#39;</span></span></a><span class="mpre"> </span><a href="#loc_305_7_305_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_305_7_305_13&#39;)"><span class="hl_varref"><span class="mpre">oldFdd</span></span></a><span class="mpre"> </span><a href="#loc_302_56_302_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_56_302_59&#39;)"><span class="hl_varref"><span class="mpre">tbl</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">)
    else do
      </span><a name="loc_312_7_312_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_7_312_13&#39;)"><span class="hl_vardecl"><span class="mpre">oldFdd</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.Event.IntTable.html#loc_86_1_86_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_86_1_86_11&#39;)"><span class="hl_varref"><span class="mpre">IT.insertWith</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">(++)</span></span><span class="mpre"> </span><a href="#loc_299_7_299_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_7_299_10&#39;)"><span class="hl_varref"><span class="mpre">fd&#39;</span></span></a><span class="mpre"> [</span><a href="#loc_301_8_301_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_301_8_301_11&#39;)"><span class="hl_varref"><span class="mpre">fdd</span></span></a><span class="mpre">] </span><a href="#loc_302_56_302_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_56_302_59&#39;)"><span class="hl_varref"><span class="mpre">tbl</span></span></a><span class="mpre">
      let (</span><a name="loc_313_12_313_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_12_313_18&#39;)"><span class="hl_vardecl"><span class="mpre">oldEvs</span></span></a><span class="mpre">, </span><a name="loc_313_20_313_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_20_313_26&#39;)"><span class="hl_vardecl"><span class="mpre">newEvs</span></span></a><span class="mpre">) =
            case </span><a href="#loc_312_7_312_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_7_312_13&#39;)"><span class="hl_varref"><span class="mpre">oldFdd</span></span></a><span class="mpre"> of
              </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">   -&gt; (</span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">, </span><a href="#loc_297_42_297_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_42_297_45&#39;)"><span class="hl_varref"><span class="mpre">evs</span></span></a><span class="mpre">)
              </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_316_20_316_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_316_20_316_24&#39;)"><span class="hl_vardecl"><span class="mpre">prev</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_365_1_365_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_365_1_365_9&#39;)"><span class="hl_varref"><span class="mpre">eventsOf</span></span></a><span class="mpre"> </span><a href="#loc_316_20_316_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_316_20_316_24&#39;)"><span class="hl_varref"><span class="mpre">prev</span></span></a><span class="mpre">, </span><a href="#loc_331_1_331_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_331_1_331_14&#39;)"><span class="hl_varref"><span class="mpre">combineEvents</span></span></a><span class="mpre"> </span><a href="#loc_297_42_297_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_42_297_45&#39;)"><span class="hl_varref"><span class="mpre">evs</span></span></a><span class="mpre"> </span><a href="#loc_316_20_316_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_316_20_316_24&#39;)"><span class="hl_varref"><span class="mpre">prev</span></span></a><span class="mpre">)
          </span><a name="loc_317_11_317_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_11_317_17&#39;)"><span class="hl_vardecl"><span class="mpre">modify</span></span></a><span class="mpre"> = </span><a href="#loc_313_12_313_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_12_313_18&#39;)"><span class="hl_varref"><span class="mpre">oldEvs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="#loc_313_20_313_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_20_313_26&#39;)"><span class="hl_varref"><span class="mpre">newEvs</span></span></a><span class="mpre">
      </span><a name="loc_318_7_318_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_7_318_9&#39;)"><span class="hl_vardecl"><span class="mpre">ok</span></span></a><span class="mpre"> &lt;- if </span><a href="#loc_317_11_317_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_11_317_17&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre">
            then </span><a href="GHC.Event.Internal.html#loc_133_1_133_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_133_1_133_9&#39;)"><span class="hl_varref"><span class="mpre">I.modifyFd</span></span></a><span class="mpre"> </span><a href="#loc_115_7_115_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_7_115_16&#39;)"><span class="hl_varref"><span class="mpre">emBackend</span></span></a><span class="mpre"> </span><a href="#loc_297_39_297_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_39_297_41&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="#loc_313_12_313_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_12_313_18&#39;)"><span class="hl_varref"><span class="mpre">oldEvs</span></span></a><span class="mpre"> </span><a href="#loc_313_20_313_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_20_313_26&#39;)"><span class="hl_varref"><span class="mpre">newEvs</span></span></a><span class="mpre">
            else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
      if </span><a href="#loc_318_7_318_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_7_318_9&#39;)"><span class="hl_varref"><span class="mpre">ok</span></span></a><span class="mpre">
        then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_317_11_317_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_11_317_17&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">)
        else </span><a href="GHC.Event.IntTable.html#loc_111_1_111_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_111_1_111_6&#39;)"><span class="hl_varref"><span class="mpre">IT.reset</span></span></a><span class="mpre"> </span><a href="#loc_299_7_299_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_7_299_10&#39;)"><span class="hl_varref"><span class="mpre">fd&#39;</span></span></a><span class="mpre"> </span><a href="#loc_312_7_312_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_7_312_13&#39;)"><span class="hl_varref"><span class="mpre">oldFdd</span></span></a><span class="mpre"> </span><a href="#loc_302_56_302_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_56_302_59&#39;)"><span class="hl_varref"><span class="mpre">tbl</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">, </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">)
  </span><span class="hl_comment"><span class="mpre">-- this simulates behavior of old IO manager:</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- i.e. just call the callback if the registration fails.</span></span><span class="mpre">
  </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><a href="#loc_302_11_302_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_11_302_13&#39;)"><span class="hl_varref"><span class="mpre">ok</span></span></a><span class="mpre">) (</span><a href="#loc_297_36_297_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_36_297_38&#39;)"><span class="hl_varref"><span class="mpre">cb</span></span></a><span class="mpre"> </span><a href="#loc_300_7_300_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_300_7_300_10&#39;)"><span class="hl_varref"><span class="mpre">reg</span></span></a><span class="mpre"> </span><a href="#loc_297_42_297_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_42_297_45&#39;)"><span class="hl_varref"><span class="mpre">evs</span></span></a><span class="mpre">)
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_300_7_300_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_300_7_300_10&#39;)"><span class="hl_varref"><span class="mpre">reg</span></span></a><span class="mpre">,</span><a href="#loc_302_4_302_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_4_302_10&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_297_1_297_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_1_297_12&#39;)"><span class="mpre">registerFd_</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_331_1_331_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_331_1_331_14&#39;)"><span class="mpre">combineEvents</span></a><span class="mpre"> :: </span><a href="GHC.Event.Internal.html#loc_37_9_37_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_37_9_37_14&#39;)"><span class="hl_tyconref"><span class="mpre">Event</span></span></a><span class="mpre"> -&gt; [</span><a href="#loc_91_6_91_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_6_91_12&#39;)"><span class="hl_tyconref"><span class="mpre">FdData</span></span></a><span class="mpre">] -&gt; </span><a href="GHC.Event.Internal.html#loc_37_9_37_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_37_9_37_14&#39;)"><span class="hl_tyconref"><span class="mpre">Event</span></span></a><span class="mpre">
</span><a name="loc_331_1_331_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_331_1_331_14&#39;)"><span class="hl_fundecl"><span class="mpre">combineEvents</span></span></a><span class="mpre"> </span><a name="loc_331_15_331_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_331_15_331_17&#39;)"><span class="hl_vardecl"><span class="mpre">ev</span></span></a><span class="mpre"> [</span><a name="loc_331_19_331_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_331_19_331_22&#39;)"><span class="hl_vardecl"><span class="mpre">fdd</span></span></a><span class="mpre">] = </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_varref"><span class="mpre">mappend</span></span></a><span class="mpre"> </span><a href="#loc_331_15_331_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_331_15_331_17&#39;)"><span class="hl_varref"><span class="mpre">ev</span></span></a><span class="mpre"> (</span><a href="#loc_93_7_93_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_7_93_15&#39;)"><span class="hl_varref"><span class="mpre">fdEvents</span></span></a><span class="mpre"> </span><a href="#loc_331_19_331_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_331_19_331_22&#39;)"><span class="hl_varref"><span class="mpre">fdd</span></span></a><span class="mpre">)
</span><a href="#loc_331_1_331_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_331_1_331_14&#39;)"><span class="hl_fundecl"><span class="mpre">combineEvents</span></span></a><span class="mpre"> </span><a name="loc_332_15_332_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_15_332_17&#39;)"><span class="hl_vardecl"><span class="mpre">ev</span></span></a><span class="mpre"> </span><a name="loc_332_18_332_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_18_332_22&#39;)"><span class="hl_vardecl"><span class="mpre">fdds</span></span></a><span class="mpre">  = </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_varref"><span class="mpre">mappend</span></span></a><span class="mpre"> </span><a href="#loc_332_15_332_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_15_332_17&#39;)"><span class="hl_varref"><span class="mpre">ev</span></span></a><span class="mpre"> (</span><a href="#loc_365_1_365_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_365_1_365_9&#39;)"><span class="hl_varref"><span class="mpre">eventsOf</span></span></a><span class="mpre"> </span><a href="#loc_332_18_332_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_18_332_22&#39;)"><span class="hl_varref"><span class="mpre">fdds</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_331_1_331_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_331_1_331_14&#39;)"><span class="mpre">combineEvents</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | @registerFd mgr cb fd evs@ registers interest in the events @evs@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- on the file descriptor @fd@.  @cb@ is called for each event that</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- occurs.  Returns a cookie that can be handed to &#39;unregisterFd&#39;.</span></span><span class="mpre">
</span><a href="#loc_339_1_339_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_1_339_11&#39;)"><span class="mpre">registerFd</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IOCallback</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><a href="GHC.Event.Internal.html#loc_37_9_37_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_37_9_37_14&#39;)"><span class="hl_tyconref"><span class="mpre">Event</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_98_6_98_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_6_98_11&#39;)"><span class="hl_tyconref"><span class="mpre">FdKey</span></span></a><span class="mpre">
</span><a name="loc_339_1_339_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_1_339_11&#39;)"><span class="hl_fundecl"><span class="mpre">registerFd</span></span></a><span class="mpre"> </span><a name="loc_339_12_339_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_12_339_15&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a name="loc_339_16_339_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_16_339_18&#39;)"><span class="hl_vardecl"><span class="mpre">cb</span></span></a><span class="mpre"> </span><a name="loc_339_19_339_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_19_339_21&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a name="loc_339_22_339_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_22_339_25&#39;)"><span class="hl_vardecl"><span class="mpre">evs</span></span></a><span class="mpre"> = do
  (</span><a name="loc_340_4_340_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_340_4_340_5&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">, </span><a name="loc_340_7_340_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_340_7_340_11&#39;)"><span class="hl_vardecl"><span class="mpre">wake</span></span></a><span class="mpre">) &lt;- </span><a href="#loc_297_1_297_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_1_297_12&#39;)"><span class="hl_varref"><span class="mpre">registerFd_</span></span></a><span class="mpre"> </span><a href="#loc_339_12_339_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_12_339_15&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_339_16_339_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_16_339_18&#39;)"><span class="hl_varref"><span class="mpre">cb</span></span></a><span class="mpre"> </span><a href="#loc_339_19_339_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_19_339_21&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="#loc_339_22_339_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_22_339_25&#39;)"><span class="hl_varref"><span class="mpre">evs</span></span></a><span class="mpre">
  </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_340_7_340_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_340_7_340_11&#39;)"><span class="hl_varref"><span class="mpre">wake</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_357_1_357_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_1_357_12&#39;)"><span class="hl_varref"><span class="mpre">wakeManager</span></span></a><span class="mpre"> </span><a href="#loc_339_12_339_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_12_339_15&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_340_4_340_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_340_4_340_5&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_339_1_339_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_1_339_11&#39;)"><span class="mpre">registerFd</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-
    Building GHC with parallel IO manager on Mac freezes when
    compiling the dph libraries in the phase 2. As workaround, we
    don&#39;t use oneshot and we wake up an IO manager on Mac every time
    when we register an event.

    For more information, please read:
        http://hackage.haskell.org/trac/ghc/ticket/7651
-}</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Wake up the event manager.</span></span><span class="mpre">
</span><a href="#loc_357_1_357_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_1_357_12&#39;)"><span class="mpre">wakeManager</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
#if defined(darwin_HOST_OS) || defined(ios_HOST_OS)
</span><a name="loc_357_1_357_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_1_357_12&#39;)"><span class="hl_fundecl"><span class="mpre">wakeManager</span></span></a><span class="mpre"> </span><a name="loc_357_13_357_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_13_357_16&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> = </span><a href="GHC.Event.Control.html#loc_169_1_169_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Control.html#loc_169_1_169_11&#39;)"><span class="hl_varref"><span class="mpre">sendWakeup</span></span></a><span class="mpre"> (</span><a href="#loc_119_7_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_7_119_16&#39;)"><span class="hl_varref"><span class="mpre">emControl</span></span></a><span class="mpre"> </span><a href="#loc_357_13_357_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_13_357_16&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">)
#elif defined(HAVE_EPOLL) || defined(HAVE_KQUEUE)
</span><a href="#loc_357_1_357_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_1_357_12&#39;)"><span class="hl_fundecl"><span class="mpre">wakeManager</span></span></a><span class="mpre"> _ = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
#else
</span><a href="#loc_357_1_357_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_1_357_12&#39;)"><span class="hl_fundecl"><span class="mpre">wakeManager</span></span></a><span class="mpre"> </span><a name="loc_361_13_361_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_13_361_16&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> = </span><a href="GHC.Event.Control.html#loc_169_1_169_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Control.html#loc_169_1_169_11&#39;)"><span class="hl_varref"><span class="mpre">sendWakeup</span></span></a><span class="mpre"> (</span><a href="#loc_119_7_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_7_119_16&#39;)"><span class="hl_varref"><span class="mpre">emControl</span></span></a><span class="mpre"> </span><a href="#loc_361_13_361_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_13_361_16&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">)
#endif

</span><a href="#loc_365_1_365_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_365_1_365_9&#39;)"><span class="mpre">eventsOf</span></a><span class="mpre"> :: [</span><a href="#loc_91_6_91_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_6_91_12&#39;)"><span class="hl_tyconref"><span class="mpre">FdData</span></span></a><span class="mpre">] -&gt; </span><a href="GHC.Event.Internal.html#loc_37_9_37_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_37_9_37_14&#39;)"><span class="hl_tyconref"><span class="mpre">Event</span></span></a><span class="mpre">
</span><a name="loc_365_1_365_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_365_1_365_9&#39;)"><span class="hl_vardecl"><span class="mpre">eventsOf</span></span></a><span class="mpre"> = </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_93_7_93_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_7_93_15&#39;)"><span class="hl_varref"><span class="mpre">fdEvents</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Drop a previous file descriptor registration, without waking the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- event manager thread.  The return value indicates whether the event</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- manager ought to be woken.</span></span><span class="mpre">
</span><a href="#loc_371_1_371_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_1_371_14&#39;)"><span class="mpre">unregisterFd_</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_98_6_98_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_6_98_11&#39;)"><span class="hl_tyconref"><span class="mpre">FdKey</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_371_1_371_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_1_371_14&#39;)"><span class="hl_fundecl"><span class="mpre">unregisterFd_</span></span></a><span class="mpre"> </span><a name="loc_371_15_371_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_15_371_18&#39;)"><span class="hl_specname"><span class="mpre">mgr</span></span></a><span class="mpre">@(</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 371, srcSpanStartColumn = 20, srcSpanEndLine = 371, srcSpanEndColumn = 36}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 371, srcSpanStartColumn = 32, srcSpanEndLine = 371, srcSpanEndColumn = 33},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Manager.hs&quot;, srcSpanStartLine = 37"><span class="mpre">EventManager{..}</span></span><span class="mpre">) (</span><a href="#loc_98_14_98_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_14_98_19&#39;)"><span class="hl_conref"><span class="mpre">FdKey</span></span></a><span class="mpre"> </span><a name="loc_371_45_371_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_45_371_47&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a name="loc_371_48_371_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_48_371_49&#39;)"><span class="hl_vardecl"><span class="mpre">u</span></span></a><span class="mpre">) =
  </span><a href="Control.Concurrent.MVar.html#loc_185_1_185_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_185_1_185_9&#39;)"><span class="hl_varref"><span class="mpre">withMVar</span></span></a><span class="mpre"> (</span><a href="#loc_133_1_133_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_17&#39;)"><span class="hl_varref"><span class="mpre">callbackTableVar</span></span></a><span class="mpre"> </span><a href="#loc_371_15_371_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_15_371_18&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_371_45_371_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_45_371_47&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_372_41_372_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_41_372_44&#39;)"><span class="hl_vardecl"><span class="mpre">tbl</span></span></a><span class="mpre"> -&gt; do
    let </span><a name="loc_373_9_373_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_373_9_373_16&#39;)"><span class="hl_vardecl"><span class="mpre">dropReg</span></span></a><span class="mpre"> = </span><a href="#loc_480_1_480_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_480_1_480_14&#39;)"><span class="hl_varref"><span class="mpre">nullToNothing</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">filter</span></span><span class="mpre"> ((</span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="#loc_371_48_371_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_48_371_49&#39;)"><span class="hl_varref"><span class="mpre">u</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_100_7_100_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_7_100_16&#39;)"><span class="hl_varref"><span class="mpre">keyUnique</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_92_7_92_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_7_92_12&#39;)"><span class="hl_varref"><span class="mpre">fdKey</span></span></a><span class="mpre">)
        </span><a name="loc_374_9_374_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_374_9_374_12&#39;)"><span class="hl_vardecl"><span class="mpre">fd&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_371_45_371_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_45_371_47&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">
        </span><a name="loc_375_9_375_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_375_9_375_19&#39;)"><span class="hl_fundecl"><span class="mpre">pairEvents</span></span></a><span class="mpre"> </span><a name="loc_375_20_375_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_375_20_375_24&#39;)"><span class="hl_vardecl"><span class="mpre">prev</span></span></a><span class="mpre"> = do
          </span><a name="loc_376_11_376_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_376_11_376_12&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre"> </span><a href="#loc_365_1_365_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_365_1_365_9&#39;)"><span class="hl_varref"><span class="mpre">eventsOf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><a href="GHC.Event.IntTable.html#loc_48_1_48_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_48_1_48_7&#39;)"><span class="hl_varref"><span class="mpre">IT.lookup</span></span></a><span class="mpre"> </span><a href="#loc_374_9_374_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_374_9_374_12&#39;)"><span class="hl_varref"><span class="mpre">fd&#39;</span></span></a><span class="mpre"> </span><a href="#loc_372_41_372_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_41_372_44&#39;)"><span class="hl_varref"><span class="mpre">tbl</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_365_1_365_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_365_1_365_9&#39;)"><span class="hl_varref"><span class="mpre">eventsOf</span></span></a><span class="mpre"> </span><a href="#loc_375_20_375_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_375_20_375_24&#39;)"><span class="hl_varref"><span class="mpre">prev</span></span></a><span class="mpre">, </span><a href="#loc_376_11_376_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_376_11_376_12&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">)
    (</span><a name="loc_378_6_378_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_6_378_12&#39;)"><span class="hl_vardecl"><span class="mpre">oldEvs</span></span></a><span class="mpre">, </span><a name="loc_378_14_378_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_14_378_20&#39;)"><span class="hl_vardecl"><span class="mpre">newEvs</span></span></a><span class="mpre">) &lt;- </span><a href="GHC.Event.IntTable.html#loc_121_1_121_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_121_1_121_11&#39;)"><span class="hl_varref"><span class="mpre">IT.updateWith</span></span></a><span class="mpre"> </span><a href="#loc_373_9_373_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_373_9_373_16&#39;)"><span class="hl_varref"><span class="mpre">dropReg</span></span></a><span class="mpre"> </span><a href="#loc_374_9_374_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_374_9_374_12&#39;)"><span class="hl_varref"><span class="mpre">fd&#39;</span></span></a><span class="mpre"> </span><a href="#loc_372_41_372_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_372_41_372_44&#39;)"><span class="hl_varref"><span class="mpre">tbl</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre">
                        </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">, </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">)) </span><a href="#loc_375_9_375_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_375_9_375_19&#39;)"><span class="hl_varref"><span class="mpre">pairEvents</span></span></a><span class="mpre">
    let </span><a name="loc_380_9_380_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_380_9_380_15&#39;)"><span class="hl_vardecl"><span class="mpre">modify</span></span></a><span class="mpre"> = </span><a href="#loc_378_6_378_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_6_378_12&#39;)"><span class="hl_varref"><span class="mpre">oldEvs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="#loc_378_14_378_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_14_378_20&#39;)"><span class="hl_varref"><span class="mpre">newEvs</span></span></a><span class="mpre">
    </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_380_9_380_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_380_9_380_15&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_197_1_197_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_1_197_18&#39;)"><span class="hl_varref"><span class="mpre">failOnInvalidFile</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;unregisterFd_&quot;</span></span><span class="mpre"> </span><a href="#loc_371_45_371_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_45_371_47&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
      if </span><a href="#loc_139_1_139_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_12&#39;)"><span class="hl_varref"><span class="mpre">haveOneShot</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_120_7_120_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_7_120_16&#39;)"><span class="hl_varref"><span class="mpre">emOneShot</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_378_14_378_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_14_378_20&#39;)"><span class="hl_varref"><span class="mpre">newEvs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">
      then </span><a href="GHC.Event.Internal.html#loc_140_1_140_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_140_1_140_13&#39;)"><span class="hl_varref"><span class="mpre">I.modifyFdOnce</span></span></a><span class="mpre"> </span><a href="#loc_115_7_115_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_7_115_16&#39;)"><span class="hl_varref"><span class="mpre">emBackend</span></span></a><span class="mpre"> </span><a href="#loc_371_45_371_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_45_371_47&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="#loc_378_14_378_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_14_378_20&#39;)"><span class="hl_varref"><span class="mpre">newEvs</span></span></a><span class="mpre">
      else </span><a href="GHC.Event.Internal.html#loc_133_1_133_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_133_1_133_9&#39;)"><span class="hl_varref"><span class="mpre">I.modifyFd</span></span></a><span class="mpre"> </span><a href="#loc_115_7_115_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_7_115_16&#39;)"><span class="hl_varref"><span class="mpre">emBackend</span></span></a><span class="mpre"> </span><a href="#loc_371_45_371_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_45_371_47&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="#loc_378_6_378_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_6_378_12&#39;)"><span class="hl_varref"><span class="mpre">oldEvs</span></span></a><span class="mpre"> </span><a href="#loc_378_14_378_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_14_378_20&#39;)"><span class="hl_varref"><span class="mpre">newEvs</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_380_9_380_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_380_9_380_15&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Drop a previous file descriptor registration.</span></span><span class="mpre">
</span><a href="#loc_389_1_389_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_1_389_13&#39;)"><span class="mpre">unregisterFd</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_98_6_98_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_6_98_11&#39;)"><span class="hl_tyconref"><span class="mpre">FdKey</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_389_1_389_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_1_389_13&#39;)"><span class="hl_fundecl"><span class="mpre">unregisterFd</span></span></a><span class="mpre"> </span><a name="loc_389_14_389_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_14_389_17&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a name="loc_389_18_389_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_18_389_21&#39;)"><span class="hl_vardecl"><span class="mpre">reg</span></span></a><span class="mpre"> = do
  </span><a name="loc_390_3_390_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_390_3_390_7&#39;)"><span class="hl_vardecl"><span class="mpre">wake</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_371_1_371_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_371_1_371_14&#39;)"><span class="hl_varref"><span class="mpre">unregisterFd_</span></span></a><span class="mpre"> </span><a href="#loc_389_14_389_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_14_389_17&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_389_18_389_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_18_389_21&#39;)"><span class="hl_varref"><span class="mpre">reg</span></span></a><span class="mpre">
  </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_390_3_390_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_390_3_390_7&#39;)"><span class="hl_varref"><span class="mpre">wake</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_357_1_357_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_1_357_12&#39;)"><span class="hl_varref"><span class="mpre">wakeManager</span></span></a><span class="mpre"> </span><a href="#loc_389_14_389_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_14_389_17&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Close a file descriptor in a race-safe way.</span></span><span class="mpre">
</span><a href="#loc_395_1_395_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_1_395_8&#39;)"><span class="mpre">closeFd</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_395_1_395_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_1_395_8&#39;)"><span class="hl_fundecl"><span class="mpre">closeFd</span></span></a><span class="mpre"> </span><a name="loc_395_9_395_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_9_395_12&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a name="loc_395_13_395_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_13_395_18&#39;)"><span class="hl_vardecl"><span class="mpre">close</span></span></a><span class="mpre"> </span><a name="loc_395_19_395_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_19_395_21&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> = do
  </span><a name="loc_396_3_396_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_3_396_6&#39;)"><span class="hl_vardecl"><span class="mpre">fds</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Concurrent.MVar.html#loc_185_1_185_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_185_1_185_9&#39;)"><span class="hl_varref"><span class="mpre">withMVar</span></span></a><span class="mpre"> (</span><a href="#loc_133_1_133_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_17&#39;)"><span class="hl_varref"><span class="mpre">callbackTableVar</span></span></a><span class="mpre"> </span><a href="#loc_395_9_395_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_9_395_12&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_395_19_395_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_19_395_21&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_396_48_396_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_48_396_51&#39;)"><span class="hl_vardecl"><span class="mpre">tbl</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_397_5_397_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_397_5_397_9&#39;)"><span class="hl_vardecl"><span class="mpre">prev</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.Event.IntTable.html#loc_118_1_118_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_118_1_118_7&#39;)"><span class="hl_varref"><span class="mpre">IT.delete</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_395_19_395_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_19_395_21&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">) </span><a href="#loc_396_48_396_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_48_396_51&#39;)"><span class="hl_varref"><span class="mpre">tbl</span></span></a><span class="mpre">
    case </span><a href="#loc_397_5_397_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_397_5_397_9&#39;)"><span class="hl_varref"><span class="mpre">prev</span></span></a><span class="mpre"> of
      </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">  -&gt; </span><a href="#loc_395_13_395_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_13_395_18&#39;)"><span class="hl_varref"><span class="mpre">close</span></span></a><span class="mpre"> </span><a href="#loc_395_19_395_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_19_395_21&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> []
      </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_400_12_400_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_12_400_15&#39;)"><span class="hl_vardecl"><span class="mpre">fds</span></span></a><span class="mpre"> -&gt; do
        let </span><a name="loc_401_13_401_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_401_13_401_19&#39;)"><span class="hl_vardecl"><span class="mpre">oldEvs</span></span></a><span class="mpre"> = </span><a href="#loc_365_1_365_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_365_1_365_9&#39;)"><span class="hl_varref"><span class="mpre">eventsOf</span></span></a><span class="mpre"> </span><a href="#loc_400_12_400_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_12_400_15&#39;)"><span class="hl_varref"><span class="mpre">fds</span></span></a><span class="mpre">
        </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_401_13_401_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_401_13_401_19&#39;)"><span class="hl_varref"><span class="mpre">oldEvs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
          _ &lt;- </span><a href="GHC.Event.Internal.html#loc_133_1_133_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_133_1_133_9&#39;)"><span class="hl_varref"><span class="mpre">I.modifyFd</span></span></a><span class="mpre"> (</span><a href="#loc_115_7_115_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_7_115_16&#39;)"><span class="hl_varref"><span class="mpre">emBackend</span></span></a><span class="mpre"> </span><a href="#loc_395_9_395_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_9_395_12&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">) </span><a href="#loc_395_19_395_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_19_395_21&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="#loc_401_13_401_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_401_13_401_19&#39;)"><span class="hl_varref"><span class="mpre">oldEvs</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">
          </span><a href="#loc_357_1_357_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_1_357_12&#39;)"><span class="hl_varref"><span class="mpre">wakeManager</span></span></a><span class="mpre"> </span><a href="#loc_395_9_395_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_9_395_12&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">
        </span><a href="#loc_395_13_395_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_13_395_18&#39;)"><span class="hl_varref"><span class="mpre">close</span></span></a><span class="mpre"> </span><a href="#loc_395_19_395_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_395_19_395_21&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_400_12_400_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_12_400_15&#39;)"><span class="hl_varref"><span class="mpre">fds</span></span></a><span class="mpre">
  </span><a href="Control.Monad.html#loc_168_1_168_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_168_1_168_6&#39;)"><span class="hl_varref"><span class="mpre">forM_</span></span></a><span class="mpre"> </span><a href="#loc_396_3_396_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_396_3_396_6&#39;)"><span class="hl_varref"><span class="mpre">fds</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a href="#loc_91_15_91_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_15_91_21&#39;)"><span class="hl_conref"><span class="mpre">FdData</span></span></a><span class="mpre"> </span><a name="loc_407_24_407_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_407_24_407_27&#39;)"><span class="hl_vardecl"><span class="mpre">reg</span></span></a><span class="mpre"> </span><a name="loc_407_28_407_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_407_28_407_30&#39;)"><span class="hl_vardecl"><span class="mpre">ev</span></span></a><span class="mpre"> </span><a name="loc_407_31_407_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_407_31_407_33&#39;)"><span class="hl_vardecl"><span class="mpre">cb</span></span></a><span class="mpre">) -&gt; </span><a href="#loc_407_31_407_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_407_31_407_33&#39;)"><span class="hl_varref"><span class="mpre">cb</span></span></a><span class="mpre"> </span><a href="#loc_407_24_407_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_407_24_407_27&#39;)"><span class="hl_varref"><span class="mpre">reg</span></span></a><span class="mpre"> (</span><a href="#loc_407_28_407_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_407_28_407_30&#39;)"><span class="hl_varref"><span class="mpre">ev</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_infix"><span class="mpre">`mappend`</span></span></a><span class="mpre"> </span><a href="GHC.Event.Internal.html#loc_56_1_56_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_56_1_56_9&#39;)"><span class="hl_varref"><span class="mpre">evtClose</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Close a file descriptor in a race-safe way.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- It assumes the caller will update the callback tables and that the caller</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- holds the callback table lock for the fd. It must hold this lock because</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- this command executes a backend command on the fd.</span></span><span class="mpre">
</span><a href="#loc_417_1_417_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_1_417_9&#39;)"><span class="mpre">closeFd_</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre">
            -&gt; </span><a href="GHC.Event.IntTable.html#loc_33_9_33_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_33_9_33_17&#39;)"><span class="hl_tyconref"><span class="mpre">IntTable</span></span></a><span class="mpre"> [</span><a href="#loc_91_6_91_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_6_91_12&#39;)"><span class="hl_tyconref"><span class="mpre">FdData</span></span></a><span class="mpre">]
            -&gt; </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)
</span><a name="loc_417_1_417_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_1_417_9&#39;)"><span class="hl_fundecl"><span class="mpre">closeFd_</span></span></a><span class="mpre"> </span><a name="loc_417_10_417_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_10_417_13&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a name="loc_417_14_417_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_14_417_17&#39;)"><span class="hl_vardecl"><span class="mpre">tbl</span></span></a><span class="mpre"> </span><a name="loc_417_18_417_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_18_417_20&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> = do
  </span><a name="loc_418_3_418_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_418_3_418_7&#39;)"><span class="hl_vardecl"><span class="mpre">prev</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.Event.IntTable.html#loc_118_1_118_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_118_1_118_7&#39;)"><span class="hl_varref"><span class="mpre">IT.delete</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_417_18_417_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_18_417_20&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">) </span><a href="#loc_417_14_417_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_14_417_17&#39;)"><span class="hl_varref"><span class="mpre">tbl</span></span></a><span class="mpre">
  case </span><a href="#loc_418_3_418_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_418_3_418_7&#39;)"><span class="hl_varref"><span class="mpre">prev</span></span></a><span class="mpre"> of
    </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)
    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_421_10_421_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_421_10_421_13&#39;)"><span class="hl_vardecl"><span class="mpre">fds</span></span></a><span class="mpre"> -&gt; do
      let </span><a name="loc_422_11_422_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_11_422_17&#39;)"><span class="hl_vardecl"><span class="mpre">oldEvs</span></span></a><span class="mpre"> = </span><a href="#loc_365_1_365_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_365_1_365_9&#39;)"><span class="hl_varref"><span class="mpre">eventsOf</span></span></a><span class="mpre"> </span><a href="#loc_421_10_421_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_421_10_421_13&#39;)"><span class="hl_varref"><span class="mpre">fds</span></span></a><span class="mpre">
      </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_422_11_422_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_11_422_17&#39;)"><span class="hl_varref"><span class="mpre">oldEvs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        _ &lt;- </span><a href="GHC.Event.Internal.html#loc_133_1_133_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_133_1_133_9&#39;)"><span class="hl_varref"><span class="mpre">I.modifyFd</span></span></a><span class="mpre"> (</span><a href="#loc_115_7_115_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_7_115_16&#39;)"><span class="hl_varref"><span class="mpre">emBackend</span></span></a><span class="mpre"> </span><a href="#loc_417_10_417_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_10_417_13&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">) </span><a href="#loc_417_18_417_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_18_417_20&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="#loc_422_11_422_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_422_11_422_17&#39;)"><span class="hl_varref"><span class="mpre">oldEvs</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">
        </span><a href="#loc_357_1_357_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_1_357_12&#39;)"><span class="hl_varref"><span class="mpre">wakeManager</span></span></a><span class="mpre"> </span><a href="#loc_417_10_417_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_10_417_13&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
        </span><a href="Control.Monad.html#loc_168_1_168_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_168_1_168_6&#39;)"><span class="hl_varref"><span class="mpre">forM_</span></span></a><span class="mpre"> </span><a href="#loc_421_10_421_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_421_10_421_13&#39;)"><span class="hl_varref"><span class="mpre">fds</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a href="#loc_91_15_91_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_15_91_21&#39;)"><span class="hl_conref"><span class="mpre">FdData</span></span></a><span class="mpre"> </span><a name="loc_427_30_427_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_427_30_427_33&#39;)"><span class="hl_vardecl"><span class="mpre">reg</span></span></a><span class="mpre"> </span><a name="loc_427_34_427_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_427_34_427_36&#39;)"><span class="hl_vardecl"><span class="mpre">ev</span></span></a><span class="mpre"> </span><a name="loc_427_37_427_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_427_37_427_39&#39;)"><span class="hl_vardecl"><span class="mpre">cb</span></span></a><span class="mpre">) -&gt; </span><a href="#loc_427_37_427_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_427_37_427_39&#39;)"><span class="hl_varref"><span class="mpre">cb</span></span></a><span class="mpre"> </span><a href="#loc_427_30_427_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_427_30_427_33&#39;)"><span class="hl_varref"><span class="mpre">reg</span></span></a><span class="mpre"> (</span><a href="#loc_427_34_427_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_427_34_427_36&#39;)"><span class="hl_varref"><span class="mpre">ev</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_infix"><span class="mpre">`mappend`</span></span></a><span class="mpre"> </span><a href="GHC.Event.Internal.html#loc_56_1_56_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_56_1_56_9&#39;)"><span class="hl_varref"><span class="mpre">evtClose</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Utilities</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Call the callbacks corresponding to the given file descriptor.</span></span><span class="mpre">
</span><a href="#loc_434_1_434_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_1_434_10&#39;)"><span class="mpre">onFdEvent</span></a><span class="mpre"> :: </span><a href="#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><a href="GHC.Event.Internal.html#loc_37_9_37_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_37_9_37_14&#39;)"><span class="hl_tyconref"><span class="mpre">Event</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_434_1_434_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_1_434_10&#39;)"><span class="hl_fundecl"><span class="mpre">onFdEvent</span></span></a><span class="mpre"> </span><a name="loc_434_11_434_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_11_434_14&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a name="loc_434_15_434_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_15_434_17&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a name="loc_434_18_434_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_18_434_21&#39;)"><span class="hl_vardecl"><span class="mpre">evs</span></span></a><span class="mpre"> =
  if </span><a href="#loc_434_15_434_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_15_434_17&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="GHC.Event.Control.html#loc_63_7_63_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Control.html#loc_63_7_63_20&#39;)"><span class="hl_varref"><span class="mpre">controlReadFd</span></span></a><span class="mpre"> (</span><a href="#loc_119_7_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_7_119_16&#39;)"><span class="hl_varref"><span class="mpre">emControl</span></span></a><span class="mpre"> </span><a href="#loc_434_11_434_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_11_434_14&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><a href="#loc_434_15_434_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_15_434_17&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="GHC.Event.Control.html#loc_68_7_68_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Control.html#loc_68_7_68_19&#39;)"><span class="hl_varref"><span class="mpre">wakeupReadFd</span></span></a><span class="mpre"> (</span><a href="#loc_119_7_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_7_119_16&#39;)"><span class="hl_varref"><span class="mpre">emControl</span></span></a><span class="mpre"> </span><a href="#loc_434_11_434_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_11_434_14&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">)
  then </span><a href="#loc_149_1_149_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_1_149_19&#39;)"><span class="hl_varref"><span class="mpre">handleControlEvent</span></span></a><span class="mpre"> </span><a href="#loc_434_11_434_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_11_434_14&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_434_15_434_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_15_434_17&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="#loc_434_18_434_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_18_434_21&#39;)"><span class="hl_varref"><span class="mpre">evs</span></span></a><span class="mpre">
  else
    if </span><a href="#loc_120_7_120_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_7_120_16&#39;)"><span class="hl_varref"><span class="mpre">emOneShot</span></span></a><span class="mpre"> </span><a href="#loc_434_11_434_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_11_434_14&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">
    then
      do </span><a name="loc_440_10_440_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_440_10_440_14&#39;)"><span class="hl_vardecl"><span class="mpre">fdds</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Concurrent.MVar.html#loc_185_1_185_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_185_1_185_9&#39;)"><span class="hl_varref"><span class="mpre">withMVar</span></span></a><span class="mpre"> (</span><a href="#loc_133_1_133_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_17&#39;)"><span class="hl_varref"><span class="mpre">callbackTableVar</span></span></a><span class="mpre"> </span><a href="#loc_434_11_434_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_11_434_14&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_434_15_434_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_15_434_17&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_440_56_440_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_440_56_440_59&#39;)"><span class="hl_vardecl"><span class="mpre">tbl</span></span></a><span class="mpre"> -&gt;
           </span><a href="GHC.Event.IntTable.html#loc_118_1_118_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_118_1_118_7&#39;)"><span class="hl_varref"><span class="mpre">IT.delete</span></span></a><span class="mpre"> </span><a href="#loc_452_5_452_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_452_5_452_8&#39;)"><span class="hl_varref"><span class="mpre">fd&#39;</span></span></a><span class="mpre"> </span><a href="#loc_440_56_440_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_440_56_440_59&#39;)"><span class="hl_varref"><span class="mpre">tbl</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre">
           </span><a href="Data.Maybe.html#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_74_1_74_6&#39;)"><span class="hl_varref"><span class="mpre">maybe</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> []) (</span><a href="#loc_455_5_455_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_5_455_20&#39;)"><span class="hl_varref"><span class="mpre">selectCallbacks</span></span></a><span class="mpre"> </span><a href="#loc_440_56_440_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_440_56_440_59&#39;)"><span class="hl_varref"><span class="mpre">tbl</span></span></a><span class="mpre">)
         </span><a href="Control.Monad.html#loc_168_1_168_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_168_1_168_6&#39;)"><span class="hl_varref"><span class="mpre">forM_</span></span></a><span class="mpre"> </span><a href="#loc_440_10_440_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_440_10_440_14&#39;)"><span class="hl_varref"><span class="mpre">fdds</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a href="#loc_91_15_91_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_15_91_21&#39;)"><span class="hl_conref"><span class="mpre">FdData</span></span></a><span class="mpre"> </span><a name="loc_443_32_443_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_443_32_443_35&#39;)"><span class="hl_vardecl"><span class="mpre">reg</span></span></a><span class="mpre"> _ </span><a name="loc_443_38_443_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_443_38_443_40&#39;)"><span class="hl_vardecl"><span class="mpre">cb</span></span></a><span class="mpre">) -&gt; </span><a href="#loc_443_38_443_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_443_38_443_40&#39;)"><span class="hl_varref"><span class="mpre">cb</span></span></a><span class="mpre"> </span><a href="#loc_443_32_443_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_443_32_443_35&#39;)"><span class="hl_varref"><span class="mpre">reg</span></span></a><span class="mpre"> </span><a href="#loc_434_18_434_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_18_434_21&#39;)"><span class="hl_varref"><span class="mpre">evs</span></span></a><span class="mpre">
    else
      do </span><a name="loc_445_10_445_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_445_10_445_15&#39;)"><span class="hl_vardecl"><span class="mpre">found</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.Event.IntTable.html#loc_48_1_48_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_48_1_48_7&#39;)"><span class="hl_varref"><span class="mpre">IT.lookup</span></span></a><span class="mpre"> </span><a href="#loc_452_5_452_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_452_5_452_8&#39;)"><span class="hl_varref"><span class="mpre">fd&#39;</span></span></a><span class="mpre"> </span><a href="Control.Monad.html#loc_92_3_92_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_92_3_92_6&#39;)"><span class="hl_infix"><span class="mpre">=&lt;&lt;</span></span></a><span class="mpre"> </span><a href="GHC.MVar.html#loc_116_1_116_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_116_1_116_9&#39;)"><span class="hl_varref"><span class="mpre">readMVar</span></span></a><span class="mpre"> (</span><a href="#loc_133_1_133_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_17&#39;)"><span class="hl_varref"><span class="mpre">callbackTableVar</span></span></a><span class="mpre"> </span><a href="#loc_434_11_434_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_11_434_14&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_434_15_434_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_15_434_17&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">)
         case </span><a href="#loc_445_10_445_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_445_10_445_15&#39;)"><span class="hl_varref"><span class="mpre">found</span></span></a><span class="mpre"> of
           </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_447_17_447_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_17_447_20&#39;)"><span class="hl_vardecl"><span class="mpre">cbs</span></span></a><span class="mpre"> -&gt; </span><a href="Control.Monad.html#loc_168_1_168_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_168_1_168_6&#39;)"><span class="hl_varref"><span class="mpre">forM_</span></span></a><span class="mpre"> </span><a href="#loc_447_17_447_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_17_447_20&#39;)"><span class="hl_varref"><span class="mpre">cbs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a href="#loc_91_15_91_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_15_91_21&#39;)"><span class="hl_conref"><span class="mpre">FdData</span></span></a><span class="mpre"> </span><a name="loc_447_45_447_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_45_447_48&#39;)"><span class="hl_vardecl"><span class="mpre">reg</span></span></a><span class="mpre"> </span><a name="loc_447_49_447_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_49_447_51&#39;)"><span class="hl_vardecl"><span class="mpre">ev</span></span></a><span class="mpre"> </span><a name="loc_447_52_447_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_52_447_54&#39;)"><span class="hl_vardecl"><span class="mpre">cb</span></span></a><span class="mpre">) -&gt; do
             </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_434_18_434_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_18_434_21&#39;)"><span class="hl_varref"><span class="mpre">evs</span></span></a><span class="mpre"> </span><a href="GHC.Event.Internal.html#loc_60_1_60_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_60_1_60_8&#39;)"><span class="hl_infix"><span class="mpre">`I.eventIs`</span></span></a><span class="mpre"> </span><a href="#loc_447_49_447_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_49_447_51&#39;)"><span class="hl_varref"><span class="mpre">ev</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_447_52_447_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_52_447_54&#39;)"><span class="hl_varref"><span class="mpre">cb</span></span></a><span class="mpre"> </span><a href="#loc_447_45_447_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_45_447_48&#39;)"><span class="hl_varref"><span class="mpre">reg</span></span></a><span class="mpre"> </span><a href="#loc_434_18_434_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_18_434_21&#39;)"><span class="hl_varref"><span class="mpre">evs</span></span></a><span class="mpre">
           </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
  where
    </span><a href="#loc_452_5_452_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_452_5_452_8&#39;)"><span class="mpre">fd&#39;</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
    </span><a name="loc_452_5_452_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_452_5_452_8&#39;)"><span class="hl_vardecl"><span class="mpre">fd&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_434_15_434_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_15_434_17&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">

    </span><a href="#loc_455_5_455_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_5_455_20&#39;)"><span class="mpre">selectCallbacks</span></a><span class="mpre"> :: </span><a href="GHC.Event.IntTable.html#loc_33_9_33_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_33_9_33_17&#39;)"><span class="hl_tyconref"><span class="mpre">IntTable</span></span></a><span class="mpre"> [</span><a href="#loc_91_6_91_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_6_91_12&#39;)"><span class="hl_tyconref"><span class="mpre">FdData</span></span></a><span class="mpre">] -&gt; [</span><a href="#loc_91_6_91_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_6_91_12&#39;)"><span class="hl_tyconref"><span class="mpre">FdData</span></span></a><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> [</span><a href="#loc_91_6_91_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_6_91_12&#39;)"><span class="hl_tyconref"><span class="mpre">FdData</span></span></a><span class="mpre">]
    </span><a name="loc_455_5_455_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_5_455_20&#39;)"><span class="hl_fundecl"><span class="mpre">selectCallbacks</span></span></a><span class="mpre"> </span><a name="loc_455_21_455_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_21_455_24&#39;)"><span class="hl_vardecl"><span class="mpre">tbl</span></span></a><span class="mpre"> </span><a name="loc_455_25_455_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_25_455_28&#39;)"><span class="hl_vardecl"><span class="mpre">cbs</span></span></a><span class="mpre"> = </span><a href="#loc_458_9_458_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_458_9_458_12&#39;)"><span class="hl_varref"><span class="mpre">aux</span></span></a><span class="mpre"> </span><a href="#loc_455_25_455_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_25_455_28&#39;)"><span class="hl_varref"><span class="mpre">cbs</span></span></a><span class="mpre"> [] []
      where
        </span><span class="hl_comment"><span class="mpre">-- nothing to rearm.</span></span><span class="mpre">
        </span><a name="loc_458_9_458_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_458_9_458_12&#39;)"><span class="hl_fundecl"><span class="mpre">aux</span></span></a><span class="mpre"> [] _    []          =
          if </span><a href="#loc_139_1_139_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_12&#39;)"><span class="hl_varref"><span class="mpre">haveOneShot</span></span></a><span class="mpre">
          then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_455_25_455_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_25_455_28&#39;)"><span class="hl_varref"><span class="mpre">cbs</span></span></a><span class="mpre">
          else do _ &lt;- </span><a href="GHC.Event.Internal.html#loc_133_1_133_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_133_1_133_9&#39;)"><span class="hl_varref"><span class="mpre">I.modifyFd</span></span></a><span class="mpre"> (</span><a href="#loc_115_7_115_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_7_115_16&#39;)"><span class="hl_varref"><span class="mpre">emBackend</span></span></a><span class="mpre"> </span><a href="#loc_434_11_434_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_11_434_14&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">) </span><a href="#loc_434_15_434_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_15_434_17&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> (</span><a href="#loc_365_1_365_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_365_1_365_9&#39;)"><span class="hl_varref"><span class="mpre">eventsOf</span></span></a><span class="mpre"> </span><a href="#loc_455_25_455_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_25_455_28&#39;)"><span class="hl_varref"><span class="mpre">cbs</span></span></a><span class="mpre">) </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">
                  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_455_25_455_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_25_455_28&#39;)"><span class="hl_varref"><span class="mpre">cbs</span></span></a><span class="mpre">

        </span><span class="hl_comment"><span class="mpre">-- reinsert and rearm; note that we already have the lock on the</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- callback table for this fd, and we deleted above, so we know there</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- is no entry in the table for this fd.</span></span><span class="mpre">
        </span><a href="#loc_458_9_458_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_458_9_458_12&#39;)"><span class="hl_fundecl"><span class="mpre">aux</span></span></a><span class="mpre"> [] </span><a name="loc_467_16_467_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_467_16_467_20&#39;)"><span class="hl_vardecl"><span class="mpre">fdds</span></span></a><span class="mpre"> </span><a name="loc_467_21_467_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_467_21_467_26&#39;)"><span class="hl_specname"><span class="mpre">saved</span></span></a><span class="mpre">@(_</span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_) = do
          _ &lt;- if </span><a href="#loc_139_1_139_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_12&#39;)"><span class="hl_varref"><span class="mpre">haveOneShot</span></span></a><span class="mpre">
               then </span><a href="GHC.Event.Internal.html#loc_140_1_140_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_140_1_140_13&#39;)"><span class="hl_varref"><span class="mpre">I.modifyFdOnce</span></span></a><span class="mpre"> (</span><a href="#loc_115_7_115_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_7_115_16&#39;)"><span class="hl_varref"><span class="mpre">emBackend</span></span></a><span class="mpre"> </span><a href="#loc_434_11_434_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_11_434_14&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">) </span><a href="#loc_434_15_434_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_15_434_17&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_365_1_365_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_365_1_365_9&#39;)"><span class="hl_varref"><span class="mpre">eventsOf</span></span></a><span class="mpre"> </span><a href="#loc_467_21_467_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_467_21_467_26&#39;)"><span class="hl_varref"><span class="mpre">saved</span></span></a><span class="mpre">
               else </span><a href="GHC.Event.Internal.html#loc_133_1_133_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_133_1_133_9&#39;)"><span class="hl_varref"><span class="mpre">I.modifyFd</span></span></a><span class="mpre"> (</span><a href="#loc_115_7_115_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_7_115_16&#39;)"><span class="hl_varref"><span class="mpre">emBackend</span></span></a><span class="mpre"> </span><a href="#loc_434_11_434_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_11_434_14&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">) </span><a href="#loc_434_15_434_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_15_434_17&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> (</span><a href="#loc_365_1_365_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_365_1_365_9&#39;)"><span class="hl_varref"><span class="mpre">eventsOf</span></span></a><span class="mpre"> </span><a href="#loc_455_25_455_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_25_455_28&#39;)"><span class="hl_varref"><span class="mpre">cbs</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_365_1_365_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_365_1_365_9&#39;)"><span class="hl_varref"><span class="mpre">eventsOf</span></span></a><span class="mpre"> </span><a href="#loc_467_21_467_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_467_21_467_26&#39;)"><span class="hl_varref"><span class="mpre">saved</span></span></a><span class="mpre">
          _ &lt;- </span><a href="GHC.Event.IntTable.html#loc_86_1_86_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.IntTable.html#loc_86_1_86_11&#39;)"><span class="hl_varref"><span class="mpre">IT.insertWith</span></span></a><span class="mpre"> (\_ _ -&gt; </span><a href="#loc_467_21_467_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_467_21_467_26&#39;)"><span class="hl_varref"><span class="mpre">saved</span></span></a><span class="mpre">) </span><a href="#loc_452_5_452_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_452_5_452_8&#39;)"><span class="hl_varref"><span class="mpre">fd&#39;</span></span></a><span class="mpre"> </span><a href="#loc_467_21_467_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_467_21_467_26&#39;)"><span class="hl_varref"><span class="mpre">saved</span></span></a><span class="mpre"> </span><a href="#loc_455_21_455_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_21_455_24&#39;)"><span class="hl_varref"><span class="mpre">tbl</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_467_16_467_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_467_16_467_20&#39;)"><span class="hl_varref"><span class="mpre">fdds</span></span></a><span class="mpre">

        </span><span class="hl_comment"><span class="mpre">-- continue, saving those callbacks that don&#39;t match the event</span></span><span class="mpre">
        </span><a href="#loc_458_9_458_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_458_9_458_12&#39;)"><span class="hl_fundecl"><span class="mpre">aux</span></span></a><span class="mpre"> (</span><a name="loc_475_14_475_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_14_475_17&#39;)"><span class="hl_specname"><span class="mpre">fdd</span></span></a><span class="mpre">@(</span><a href="#loc_91_15_91_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_15_91_21&#39;)"><span class="hl_conref"><span class="mpre">FdData</span></span></a><span class="mpre"> _ </span><a name="loc_475_28_475_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_28_475_32&#39;)"><span class="hl_vardecl"><span class="mpre">evs&#39;</span></span></a><span class="mpre"> _) </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a name="loc_475_38_475_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_38_475_42&#39;)"><span class="hl_vardecl"><span class="mpre">cbs&#39;</span></span></a><span class="mpre">) </span><a name="loc_475_44_475_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_44_475_48&#39;)"><span class="hl_vardecl"><span class="mpre">fdds</span></span></a><span class="mpre"> </span><a name="loc_475_49_475_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_49_475_54&#39;)"><span class="hl_vardecl"><span class="mpre">saved</span></span></a><span class="mpre">
          | </span><a href="#loc_434_18_434_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_18_434_21&#39;)"><span class="hl_varref"><span class="mpre">evs</span></span></a><span class="mpre"> </span><a href="GHC.Event.Internal.html#loc_60_1_60_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_60_1_60_8&#39;)"><span class="hl_infix"><span class="mpre">`I.eventIs`</span></span></a><span class="mpre"> </span><a href="#loc_475_28_475_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_28_475_32&#39;)"><span class="hl_varref"><span class="mpre">evs&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_458_9_458_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_458_9_458_12&#39;)"><span class="hl_varref"><span class="mpre">aux</span></span></a><span class="mpre"> </span><a href="#loc_475_38_475_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_38_475_42&#39;)"><span class="hl_varref"><span class="mpre">cbs&#39;</span></span></a><span class="mpre"> (</span><a href="#loc_475_14_475_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_14_475_17&#39;)"><span class="hl_varref"><span class="mpre">fdd</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_475_44_475_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_44_475_48&#39;)"><span class="hl_varref"><span class="mpre">fdds</span></span></a><span class="mpre">) </span><a href="#loc_475_49_475_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_49_475_54&#39;)"><span class="hl_varref"><span class="mpre">saved</span></span></a><span class="mpre">
          | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">            = </span><a href="#loc_458_9_458_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_458_9_458_12&#39;)"><span class="hl_varref"><span class="mpre">aux</span></span></a><span class="mpre"> </span><a href="#loc_475_38_475_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_38_475_42&#39;)"><span class="hl_varref"><span class="mpre">cbs&#39;</span></span></a><span class="mpre"> </span><a href="#loc_475_44_475_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_44_475_48&#39;)"><span class="hl_varref"><span class="mpre">fdds</span></span></a><span class="mpre"> (</span><a href="#loc_475_14_475_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_14_475_17&#39;)"><span class="hl_varref"><span class="mpre">fdd</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_475_49_475_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_49_475_54&#39;)"><span class="hl_varref"><span class="mpre">saved</span></span></a><span class="mpre">)

</span><a href="#loc_480_1_480_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_480_1_480_14&#39;)"><span class="mpre">nullToNothing</span></a><span class="mpre"> :: [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">] -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">]
</span><a name="loc_480_1_480_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_480_1_480_14&#39;)"><span class="hl_fundecl"><span class="mpre">nullToNothing</span></span></a><span class="mpre"> []       = </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
</span><a href="#loc_480_1_480_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_480_1_480_14&#39;)"><span class="hl_fundecl"><span class="mpre">nullToNothing</span></span></a><span class="mpre"> </span><a name="loc_481_15_481_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_481_15_481_17&#39;)"><span class="hl_specname"><span class="mpre">xs</span></span></a><span class="mpre">@(_</span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_) = </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_481_15_481_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_481_15_481_17&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">
</span></div></body></html>