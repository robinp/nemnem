<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE RecordWildCards #-}
{-# LANGUAGE FlexibleContexts #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE CPP #-}
module Network.HTTP.Client.Response
    ( getRedirectedRequest
    , getResponse
    , lbsResponse
    ) where

import Control.Monad (</span><a href="Control.Monad.html#loc_180_3_180_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_180_3_180_6&#39;)"><span class="mpre">(&gt;=&gt;)</span></a><span class="mpre">)

import Control.Exception (</span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="mpre">throwIO</span></a><span class="mpre">)

import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Response.hs&quot;, srcSpanStartLine = 15, srcSpanStartColumn = 18, srcSpanEndLine = 15, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as S8
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Response.hs&quot;, srcSpanStartLine = 16, srcSpanStartColumn = 18, srcSpanEndLine = 16, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L

import Data.Default.Class (</span><a href="Data.Default.Class.html#loc_40_5_40_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Default.Class.html#loc_40_5_40_8&#39;)"><span class="mpre">def</span></a><span class="mpre">)

import qualified Network.HTTP.Types as W
import Network.URI (</span><a href="Network.URI.html#loc_232_1_232_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.URI.html#loc_232_1_232_18&#39;)"><span class="mpre">parseURIReference</span></a><span class="mpre">)

import Network.HTTP.Client.Types

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Response.hs&quot;, srcSpanStartLine = 25, srcSpanStartColumn = 8, srcSpanEndLine = 25, srcSpanEndColumn = 35}, srcInfoPoints = []}) &quot;Network.HTTP.Client.Request&quot;"><span class="mpre">Network.HTTP.Client.Request</span></span><span class="mpre">
import Network.HTTP.Client.Util
import Network.HTTP.Client.Body
import Network.HTTP.Client.Headers

import System.Timeout (</span><a href="System.Timeout.html#loc_79_1_79_8" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Timeout.html#loc_79_1_79_8&#39;)"><span class="mpre">timeout</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | If a request is a redirection (status code 3xx) this function will create</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a new request from the old request, the server headers returned with the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- redirection, and the redirection code itself. This function returns &#39;Nothing&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- if the code is not a 3xx, there is no &#39;location&#39; header included, or if the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- redirected response couldn&#39;t be parsed with &#39;parseUrl&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If a user of this library wants to know the url chain that results from a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- specific request, that user has to re-implement the redirect-following logic</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- themselves. An example of that might look like this:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; myHttp req man = do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;    (res, redirectRequests) &lt;- (`runStateT` []) $</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;         &#39;httpRedirect&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;             9000</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;             (\req&#39; -&gt; do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;                res &lt;- http req&#39;{redirectCount=0} man</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;                modify (\rqs -&gt; req&#39; : rqs)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;                return (res, getRedirectedRequest req&#39; (responseHeaders res) (responseCookieJar res) (W.statusCode (responseStatus res))</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;                )</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;             &#39;lift&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;             req</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;    applyCheckStatus (checkStatus req) res</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;    return redirectRequests</span></span><span class="mpre">
</span><a href="#loc_56_1_56_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_21&#39;)"><span class="mpre">getRedirectedRequest</span></a><span class="mpre"> :: </span><a href="Network.HTTP.Client.Types.html#loc_280_6_280_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_280_6_280_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">W.ResponseHeaders</span></span><span class="mpre"> -&gt; </span><a href="Network.HTTP.Client.Types.html#loc_130_9_130_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_130_9_130_18&#39;)"><span class="hl_tyconref"><span class="mpre">CookieJar</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_280_6_280_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_280_6_280_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre">
</span><a name="loc_56_1_56_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_21&#39;)"><span class="hl_fundecl"><span class="mpre">getRedirectedRequest</span></span></a><span class="mpre"> </span><a name="loc_56_22_56_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_22_56_25&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> </span><a name="loc_56_26_56_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_26_56_28&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> </span><a name="loc_56_29_56_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_29_56_39&#39;)"><span class="hl_vardecl"><span class="mpre">cookie_jar</span></span></a><span class="mpre"> </span><a name="loc_56_40_56_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_40_56_44&#39;)"><span class="hl_vardecl"><span class="mpre">code</span></span></a><span class="mpre">
    | </span><span class="hl_num"><span class="mpre">300</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><a href="#loc_56_40_56_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_40_56_44&#39;)"><span class="hl_varref"><span class="mpre">code</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_56_40_56_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_40_56_44&#39;)"><span class="hl_varref"><span class="mpre">code</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">400</span></span><span class="mpre"> = do
        </span><a name="loc_58_9_58_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_11&#39;)"><span class="hl_vardecl"><span class="mpre">l&#39;</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;location&quot;</span></span><span class="mpre"> </span><a href="#loc_56_26_56_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_26_56_28&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">
        </span><span class="hl_vardecl"><span class="mpre">req&#39;</span></span><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">setUriRelative</span></span><span class="mpre"> </span><a href="#loc_56_22_56_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_22_56_25&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">=&lt;&lt;</span></span><span class="mpre"> </span><a href="Network.URI.html#loc_232_1_232_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.URI.html#loc_232_1_232_18&#39;)"><span class="hl_varref"><span class="mpre">parseURIReference</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">S8.unpack</span></span><span class="mpre"> </span><a href="#loc_58_9_58_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_11&#39;)"><span class="hl_varref"><span class="mpre">l&#39;</span></span></a><span class="mpre">)
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
            if </span><a href="#loc_56_40_56_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_40_56_44&#39;)"><span class="hl_varref"><span class="mpre">code</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">302</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><a href="#loc_56_40_56_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_40_56_44&#39;)"><span class="hl_varref"><span class="mpre">code</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">303</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- According to the spec, this should *only* be for status code</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- 303. However, almost all clients mistakenly implement it for</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- 302 as well. So we have to be wrong like everyone else...</span></span><span class="mpre">
                then </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Response.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 22, srcSpanEndLine = 70, srcSpanEndColumn = 22}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Response.hs&quot;, srcSpanStartLine = 66, srcSpanStartColumn = 21, srcSpanEndLine = 66, srcSpanEndColumn = 22},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Networ"><span class="mpre">req&#39;
                    { method = &quot;GET&quot;
                    , requestBody = RequestBodyBS &quot;&quot;
                    , cookieJar = cookie_jar&#39;
                    , requestHeaders = filter ((/= W.hContentType) . fst) $ requestHeaders req&#39;
                    }</span></span><span class="mpre">
                else </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Response.hs&quot;, srcSpanStartLine = 71, srcSpanStartColumn = 22, srcSpanEndLine = 71, srcSpanEndColumn = 52}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Response.hs&quot;, srcSpanStartLine = 71, srcSpanStartColumn = 27, srcSpanEndLine = 71, srcSpanEndColumn = 28},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Networ"><span class="mpre">req&#39; {cookieJar = cookie_jar&#39;}</span></span><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
  where
    </span><span class="hl_vardecl"><span class="mpre">cookie_jar&#39;</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> </span><a href="#loc_56_29_56_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_29_56_39&#39;)"><span class="hl_varref"><span class="mpre">cookie_jar</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_384_7_384_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_384_7_384_16&#39;)"><span class="hl_varref"><span class="mpre">cookieJar</span></span></a><span class="mpre"> </span><a href="#loc_56_22_56_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_22_56_25&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Convert a &#39;Response&#39; that has a &#39;Source&#39; body to one with a lazy</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;L.ByteString&#39; body.</span></span><span class="mpre">
</span><a href="#loc_79_1_79_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_12&#39;)"><span class="mpre">lbsResponse</span></a><span class="mpre"> :: </span><a href="Network.HTTP.Client.Types.html#loc_404_6_404_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_404_6_404_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">BodyReader</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_404_6_404_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_404_6_404_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre">)
</span><a name="loc_79_1_79_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_12&#39;)"><span class="hl_fundecl"><span class="mpre">lbsResponse</span></span></a><span class="mpre"> </span><a name="loc_79_13_79_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_13_79_16&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> = do
    </span><span class="hl_vardecl"><span class="mpre">bss</span></span><span class="mpre"> &lt;- </span><a href="Network.HTTP.Client.Body.html#loc_57_1_57_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Body.html#loc_57_1_57_10&#39;)"><span class="hl_varref"><span class="mpre">brConsume</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_417_7_417_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_417_7_417_19&#39;)"><span class="hl_varref"><span class="mpre">responseBody</span></span></a><span class="mpre"> </span><a href="#loc_79_13_79_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_13_79_16&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Response.hs&quot;, srcSpanStartLine = 81, srcSpanStartColumn = 12, srcSpanEndLine = 83, srcSpanEndColumn = 10}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Response.hs&quot;, srcSpanStartLine = 82, srcSpanStartColumn = 9, srcSpanEndLine = 82, srcSpanEndColumn = 10},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network"><span class="mpre">res
        { responseBody = L.fromChunks bss
        }</span></span><span class="mpre">

</span><a href="#loc_90_1_90_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_12&#39;)"><span class="mpre">getResponse</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ConnRelease</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
            -&gt; </span><a href="Network.HTTP.Client.Types.html#loc_280_6_280_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_280_6_280_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre">
            -&gt; </span><a href="Network.HTTP.Client.Types.html#loc_63_6_63_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_63_6_63_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_404_6_404_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_404_6_404_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">BodyReader</span></span><span class="mpre">)
</span><a name="loc_90_1_90_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_12&#39;)"><span class="hl_fundecl"><span class="mpre">getResponse</span></span></a><span class="mpre"> </span><a name="loc_90_13_90_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_13_90_24&#39;)"><span class="hl_vardecl"><span class="mpre">connRelease</span></span></a><span class="mpre"> </span><a name="loc_90_25_90_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_25_90_34&#39;)"><span class="hl_vardecl"><span class="mpre">timeout&#39;&#39;</span></span></a><span class="mpre"> </span><a name="loc_90_35_90_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_35_90_38&#39;)"><span class="hl_specname"><span class="mpre">req</span></span></a><span class="mpre">@(</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Response.hs&quot;, srcSpanStartLine = 90, srcSpanStartColumn = 40, srcSpanEndLine = 90, srcSpanEndColumn = 52}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Response.hs&quot;, srcSpanStartLine = 90, srcSpanStartColumn = 48, srcSpanEndLine = 90, srcSpanEndColumn = 49},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTT"><span class="mpre">Request {..}</span></span><span class="mpre">) </span><a name="loc_90_54_90_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_54_90_58&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> = do
    let </span><a name="loc_91_9_91_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_9_91_17&#39;)"><span class="hl_vardecl"><span class="mpre">timeout&#39;</span></span></a><span class="mpre"> =
            case </span><a href="#loc_90_25_90_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_25_90_34&#39;)"><span class="hl_varref"><span class="mpre">timeout&#39;&#39;</span></span></a><span class="mpre"> of
                </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">
                </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_94_22_94_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_22_94_23&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> -&gt; </span><a href="System.Timeout.html#loc_79_1_79_8" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Timeout.html#loc_79_1_79_8&#39;)"><span class="hl_varref"><span class="mpre">timeout</span></span></a><span class="mpre"> </span><a href="#loc_94_22_94_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_22_94_23&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><a href="Control.Monad.html#loc_180_3_180_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_180_3_180_6&#39;)"><span class="hl_infix"><span class="mpre">&gt;=&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> (</span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_85_22_85_37" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_85_22_85_37&#39;)"><span class="hl_conref"><span class="mpre">ResponseTimeout</span></span></a><span class="mpre">) </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre">
    </span><a href="Network.HTTP.Client.Types.html#loc_74_22_74_35" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_74_22_74_35&#39;)"><span class="hl_conref"><span class="mpre">StatusHeaders</span></span></a><span class="mpre"> </span><a name="loc_95_19_95_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_19_95_20&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_95_21_95_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_21_95_28&#39;)"><span class="hl_vardecl"><span class="mpre">version</span></span></a><span class="mpre"> </span><a name="loc_95_29_95_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_29_95_31&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_91_9_91_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_9_91_17&#39;)"><span class="hl_varref"><span class="mpre">timeout&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Headers.html#loc_28_1_28_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Headers.html#loc_28_1_28_19&#39;)"><span class="hl_varref"><span class="mpre">parseStatusHeaders</span></span></a><span class="mpre"> </span><a href="#loc_90_54_90_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_54_90_58&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
    let </span><a name="loc_96_9_96_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_9_96_12&#39;)"><span class="hl_vardecl"><span class="mpre">mcl</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;content-length&quot;</span></span><span class="mpre"> </span><a href="#loc_95_29_95_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_29_95_31&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Util.html#loc_66_1_66_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Util.html#loc_66_1_66_8&#39;)"><span class="hl_varref"><span class="mpre">readDec</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S8.unpack</span></span><span class="mpre">

        </span><span class="hl_comment"><span class="mpre">-- should we put this connection back into the connection manager?</span></span><span class="mpre">
        </span><a name="loc_99_9_99_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_9_99_14&#39;)"><span class="hl_vardecl"><span class="mpre">toPut</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;close&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;connection&quot;</span></span><span class="mpre"> </span><a href="#loc_95_29_95_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_29_95_31&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_95_21_95_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_21_95_28&#39;)"><span class="hl_varref"><span class="mpre">version</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">W.HttpVersion</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
        </span><a name="loc_100_9_100_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_9_100_16&#39;)"><span class="hl_fundecl"><span class="mpre">cleanup</span></span></a><span class="mpre"> </span><a name="loc_100_17_100_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_17_100_29&#39;)"><span class="hl_vardecl"><span class="mpre">bodyConsumed</span></span></a><span class="mpre"> = </span><a href="#loc_90_13_90_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_13_90_24&#39;)"><span class="hl_varref"><span class="mpre">connRelease</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> if </span><a href="#loc_99_9_99_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_9_99_14&#39;)"><span class="hl_varref"><span class="mpre">toPut</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_100_17_100_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_17_100_29&#39;)"><span class="hl_varref"><span class="mpre">bodyConsumed</span></span></a><span class="mpre"> then </span><a href="Network.HTTP.Client.Types.html#loc_394_18_394_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_394_18_394_23&#39;)"><span class="hl_conref"><span class="mpre">Reuse</span></span></a><span class="mpre"> else </span><a href="Network.HTTP.Client.Types.html#loc_394_26_394_35" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_394_26_394_35&#39;)"><span class="hl_conref"><span class="mpre">DontReuse</span></span></a><span class="mpre">

    </span><span class="hl_vardecl"><span class="mpre">body</span></span><span class="mpre"> &lt;-
        </span><span class="hl_comment"><span class="mpre">-- RFC 2616 section 4.4_1 defines responses that must not include a body</span></span><span class="mpre">
        if </span><a href="Network.HTTP.Client.Util.html#loc_75_1_75_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Util.html#loc_75_1_75_10&#39;)"><span class="hl_varref"><span class="mpre">hasNoBody</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_281_7_281_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_281_7_281_13&#39;)"><span class="hl_varref"><span class="mpre">method</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">W.statusCode</span></span><span class="mpre"> </span><a href="#loc_95_19_95_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_19_95_20&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><a href="#loc_96_9_96_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_9_96_12&#39;)"><span class="hl_varref"><span class="mpre">mcl</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
            then do
                </span><a href="#loc_100_9_100_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_9_100_16&#39;)"><span class="hl_varref"><span class="mpre">cleanup</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Body.html#loc_45_1_45_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Body.html#loc_45_1_45_8&#39;)"><span class="hl_varref"><span class="mpre">brEmpty</span></span></a><span class="mpre">
            else do
                let </span><a name="loc_109_21_109_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_21_109_30&#39;)"><span class="hl_vardecl"><span class="mpre">isChunked</span></span></a><span class="mpre"> = (</span><span class="hl_string"><span class="mpre">&quot;transfer-encoding&quot;</span></span><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;chunked&quot;</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">`elem`</span></span><span class="mpre"> </span><a href="#loc_95_29_95_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_29_95_31&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">
                </span><a name="loc_110_17_110_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_17_110_22&#39;)"><span class="hl_vardecl"><span class="mpre">body1</span></span></a><span class="mpre"> &lt;-
                    if </span><a href="#loc_109_21_109_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_21_109_30&#39;)"><span class="hl_varref"><span class="mpre">isChunked</span></span></a><span class="mpre">
                        then </span><a href="Network.HTTP.Client.Body.html#loc_131_1_131_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Body.html#loc_131_1_131_18&#39;)"><span class="hl_varref"><span class="mpre">makeChunkedReader</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_343_7_343_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_343_7_343_14&#39;)"><span class="hl_varref"><span class="mpre">rawBody</span></span></a><span class="mpre"> </span><a href="#loc_90_54_90_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_54_90_58&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
                        else
                            case </span><a href="#loc_96_9_96_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_9_96_12&#39;)"><span class="hl_varref"><span class="mpre">mcl</span></span></a><span class="mpre"> of
                                </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_115_38_115_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_38_115_41&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> -&gt; </span><a href="Network.HTTP.Client.Body.html#loc_106_1_106_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Body.html#loc_106_1_106_17&#39;)"><span class="hl_varref"><span class="mpre">makeLengthReader</span></span></a><span class="mpre"> </span><a href="#loc_115_38_115_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_38_115_41&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><a href="#loc_90_54_90_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_54_90_58&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
                                </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><a href="Network.HTTP.Client.Body.html#loc_98_1_98_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Body.html#loc_98_1_98_20&#39;)"><span class="hl_varref"><span class="mpre">makeUnlimitedReader</span></span></a><span class="mpre"> </span><a href="#loc_90_54_90_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_54_90_58&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre">
                </span><a name="loc_117_17_117_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_17_117_22&#39;)"><span class="hl_vardecl"><span class="mpre">body2</span></span></a><span class="mpre"> &lt;- if </span><span class="hl_varref"><span class="mpre">needsGunzip</span></span><span class="mpre"> </span><a href="#loc_90_35_90_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_35_90_38&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><a href="#loc_95_29_95_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_29_95_31&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">
                    then </span><a href="Network.HTTP.Client.Body.html#loc_67_1_67_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Body.html#loc_67_1_67_15&#39;)"><span class="hl_varref"><span class="mpre">makeGzipReader</span></span></a><span class="mpre"> </span><a href="#loc_110_17_110_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_17_110_22&#39;)"><span class="hl_varref"><span class="mpre">body1</span></span></a><span class="mpre">
                    else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_110_17_110_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_17_110_22&#39;)"><span class="hl_varref"><span class="mpre">body1</span></span></a><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Body.html#loc_48_1_48_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Body.html#loc_48_1_48_13&#39;)"><span class="hl_varref"><span class="mpre">brAddCleanup</span></span></a><span class="mpre"> (</span><a href="#loc_100_9_100_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_9_100_16&#39;)"><span class="hl_varref"><span class="mpre">cleanup</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">) </span><a href="#loc_117_17_117_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_17_117_22&#39;)"><span class="hl_varref"><span class="mpre">body2</span></span></a><span class="mpre">

    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Response.hs&quot;, srcSpanStartLine = 122, srcSpanStartColumn = 12, srcSpanEndLine = 129, srcSpanEndColumn = 10}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Response.hs&quot;, srcSpanStartLine = 123, srcSpanStartColumn = 9, srcSpanEndLine = 123, srcSpanEndColumn = 10},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Net"><span class="mpre">Response
        { responseStatus = s
        , responseVersion = version
        , responseHeaders = hs
        , responseBody = body
        , responseCookieJar = def
        , responseClose&#39; = ResponseClose (cleanup False)
        }</span></span><span class="mpre">
</span></div></body></html>