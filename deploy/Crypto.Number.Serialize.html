<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE CPP #-}
#ifndef MIN_VERSION_integer_gmp
#define MIN_VERSION_integer_gmp(a,b,c) 0
#endif
#if MIN_VERSION_integer_gmp(0,5,1)
{-# LANGUAGE MagicHash, UnboxedTuples, BangPatterns #-}
#endif
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Crypto.Number.Serialize</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : Good</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- fast serialization primitives for integer</span></span><span class="mpre">
module Crypto.Number.Serialize
    ( i2osp
    , os2ip
    , i2ospOf
    , i2ospOf_
    , lengthBytes
    ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-numbers-0.2.3/Crypto/Number/Serialize.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 8, srcSpanEndLine = 24, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import qualified Data.ByteString.Internal as B
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-numbers-0.2.3/Crypto/Number/Serialize.hs&quot;, srcSpanStartLine = 26, srcSpanStartColumn = 8, srcSpanEndLine = 26, srcSpanEndColumn = 19}, srcInfoPoints = []}) &quot;Foreign.Ptr&quot;"><span class="mpre">Foreign.Ptr</span></span><span class="mpre">

#if MIN_VERSION_integer_gmp(0,5,1)
import GHC.Integer.GMP.Internals
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-numbers-0.2.3/Crypto/Number/Serialize.hs&quot;, srcSpanStartLine = 30, srcSpanStartColumn = 8, srcSpanEndLine = 30, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-numbers-0.2.3/Crypto/Number/Serialize.hs&quot;, srcSpanStartLine = 31, srcSpanStartColumn = 8, srcSpanEndLine = 31, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;GHC.Ptr&quot;"><span class="mpre">GHC.Ptr</span></span><span class="mpre">
import System.IO.Unsafe
import Foreign.ForeignPtr
#else
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-numbers-0.2.3/Crypto/Number/Serialize.hs&quot;, srcSpanStartLine = 35, srcSpanStartColumn = 18, srcSpanEndLine = 35, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-numbers-0.2.3/Crypto/Number/Serialize.hs&quot;, srcSpanStartLine = 36, srcSpanStartColumn = 8, srcSpanEndLine = 36, srcSpanEndColumn = 24}, srcInfoPoints = []}) &quot;Foreign.Storable&quot;"><span class="mpre">Foreign.Storable</span></span><span class="mpre">
import Data.Bits
#endif

#if !MIN_VERSION_integer_gmp(0,5,1)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_43_1_43_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_10&#39;)"><span class="mpre">divMod256</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_43_1_43_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_10&#39;)"><span class="mpre">divMod256</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">)
</span><a name="loc_43_1_43_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_10&#39;)"><span class="hl_fundecl"><span class="mpre">divMod256</span></span></a><span class="mpre"> </span><a name="loc_43_11_43_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_11_43_12&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = (</span><a href="#loc_43_11_43_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_11_43_12&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">, </span><a href="#loc_43_11_43_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_11_43_12&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xff</span></span><span class="mpre">)
#endif

</span><span class="hl_comment"><span class="mpre">-- | os2ip converts a byte string into a positive integer</span></span><span class="mpre">
</span><a href="#loc_49_1_49_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_1_49_6&#39;)"><span class="mpre">os2ip</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">
#if MIN_VERSION_integer_gmp(0,5,1)
</span><a name="loc_49_1_49_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_1_49_6&#39;)"><span class="hl_fundecl"><span class="mpre">os2ip</span></span></a><span class="mpre"> </span><a name="loc_49_7_49_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_7_49_9&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> </span><a href="#loc_52_11_52_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_11_52_15&#39;)"><span class="hl_varref"><span class="mpre">fptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_49_53_49_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_53_49_56&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> -&gt;
    let !(</span><span class="hl_conref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><a name="loc_50_15_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_15_50_17&#39;)"><span class="hl_vardecl"><span class="mpre">ad</span></span></a><span class="mpre">) = (</span><a href="#loc_49_53_49_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_53_49_56&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_52_17_52_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_20&#39;)"><span class="hl_varref"><span class="mpre">ofs</span></span></a><span class="mpre">)
     in </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_51_15_51_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_15_51_16&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">importIntegerFromAddr</span></span><span class="mpre"> </span><a href="#loc_50_15_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_15_50_17&#39;)"><span class="hl_varref"><span class="mpre">ad</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">int2Word#</span></span><span class="mpre"> </span><a href="#loc_52_27_52_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_27_52_28&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">) 1# </span><a href="#loc_51_15_51_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_15_51_16&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
  where !(</span><a name="loc_52_11_52_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_11_52_15&#39;)"><span class="hl_vardecl"><span class="mpre">fptr</span></span></a><span class="mpre">, </span><a name="loc_52_17_52_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_20&#39;)"><span class="hl_vardecl"><span class="mpre">ofs</span></span></a><span class="mpre">, !(</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_52_27_52_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_27_52_28&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">)) = </span><a href="Data.ByteString.Internal.html#loc_405_1_405_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_405_1_405_13&#39;)"><span class="hl_varref"><span class="mpre">B.toForeignPtr</span></span></a><span class="mpre"> </span><a href="#loc_49_7_49_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_7_49_9&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_49_1_49_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_1_49_6&#39;)"><span class="mpre">os2ip</span></a><span class="mpre"> #-}</span></span><span class="mpre">
#else
</span><span class="hl_vardecl"><span class="mpre">os2ip</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.foldl&#39;</span></span><span class="mpre"> (\</span><a name="loc_55_20_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_20_55_21&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> </span><a name="loc_55_22_55_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_22_55_23&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> -&gt; (</span><span class="hl_num"><span class="mpre">256</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><a href="#loc_55_20_55_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_20_55_21&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_55_22_55_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_22_55_23&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">)) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_49_1_49_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_1_49_6&#39;)"><span class="mpre">os2ip</span></a><span class="mpre"> #-}</span></span><span class="mpre">
#endif

</span><span class="hl_comment"><span class="mpre">-- | i2osp converts a positive integer into a byte string</span></span><span class="mpre">
</span><a href="#loc_62_1_62_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_6&#39;)"><span class="mpre">i2osp</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
#if MIN_VERSION_integer_gmp(0,5,1)
</span><a name="loc_62_1_62_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_6&#39;)"><span class="hl_fundecl"><span class="mpre">i2osp</span></span></a><span class="mpre"> </span><a name="loc_62_7_62_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_7_62_8&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Internal.html#loc_411_1_411_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_411_1_411_13&#39;)"><span class="hl_varref"><span class="mpre">B.unsafeCreate</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">word2Int#</span></span><span class="mpre"> </span><a href="#loc_63_10_63_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_10_63_12&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre">)) </span><a href="#loc_64_9_64_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_16&#39;)"><span class="hl_varref"><span class="mpre">fillPtr</span></span></a><span class="mpre">
  where !</span><a name="loc_63_10_63_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_10_63_12&#39;)"><span class="hl_vardecl"><span class="mpre">sz</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">sizeInBaseInteger</span></span><span class="mpre"> </span><a href="#loc_62_7_62_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_7_62_8&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> 256#
        </span><a name="loc_64_9_64_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_16&#39;)"><span class="hl_fundecl"><span class="mpre">fillPtr</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><a name="loc_64_22_64_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_22_64_29&#39;)"><span class="hl_vardecl"><span class="mpre">srcAddr</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_64_39_64_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_39_64_40&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; case </span><span class="hl_varref"><span class="mpre">exportIntegerToAddr</span></span><span class="mpre"> </span><a href="#loc_62_7_62_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_7_62_8&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_64_22_64_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_22_64_29&#39;)"><span class="hl_varref"><span class="mpre">srcAddr</span></span></a><span class="mpre"> 1# </span><a href="#loc_64_39_64_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_39_64_40&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
                                                (# </span><a name="loc_65_52_65_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_52_65_54&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">, _ #) -&gt; (# </span><a href="#loc_65_52_65_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_52_65_54&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> #)
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_62_1_62_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_6&#39;)"><span class="mpre">i2osp</span></a><span class="mpre"> #-}</span></span><span class="mpre">
#else
</span><span class="hl_fundecl"><span class="mpre">i2osp</span></span><span class="mpre"> </span><a name="loc_68_7_68_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_7_68_8&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">
    | </span><a href="#loc_68_7_68_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_7_68_8&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">     = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;i2osp: cannot convert a negative integer to a bytestring&quot;</span></span><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.reverse</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.unfoldr</span></span><span class="mpre"> </span><a href="#loc_71_11_71_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_21&#39;)"><span class="hl_varref"><span class="mpre">fdivMod256</span></span></a><span class="mpre"> </span><a href="#loc_68_7_68_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_7_68_8&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
    where </span><a name="loc_71_11_71_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_21&#39;)"><span class="hl_fundecl"><span class="mpre">fdivMod256</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
          </span><a href="#loc_71_11_71_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_21&#39;)"><span class="hl_fundecl"><span class="mpre">fdivMod256</span></span></a><span class="mpre"> </span><a name="loc_72_22_72_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_22_72_23&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_72_59_72_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_59_72_60&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">,</span><a href="#loc_72_57_72_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_57_72_58&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">) where (</span><a name="loc_72_57_72_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_57_72_58&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">,</span><a name="loc_72_59_72_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_59_72_60&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">) = </span><a href="#loc_43_1_43_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_10&#39;)"><span class="hl_varref"><span class="mpre">divMod256</span></span></a><span class="mpre"> </span><a href="#loc_72_22_72_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_22_72_23&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
#endif


</span><span class="hl_comment"><span class="mpre">-- | just like i2osp, but take an extra parameter for size.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- if the number is too big to fit in @len bytes, nothing is returned</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- otherwise the number is padded with 0 to fit the @len required.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- FIXME: use unsafeCreate to fill the bytestring</span></span><span class="mpre">
</span><a href="#loc_83_1_83_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_8&#39;)"><span class="mpre">i2ospOf</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
#if MIN_VERSION_integer_gmp(0,5,1)
</span><a name="loc_83_1_83_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_8&#39;)"><span class="hl_fundecl"><span class="mpre">i2ospOf</span></span></a><span class="mpre"> </span><a name="loc_83_9_83_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_9_83_12&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_83_13_83_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_13_83_14&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">
    | </span><a href="#loc_86_10_86_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_10_86_12&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><a href="#loc_83_9_83_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_9_83_12&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_103_1_103_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_1_103_9&#39;)"><span class="hl_varref"><span class="mpre">i2ospOf_</span></span></a><span class="mpre"> </span><a href="#loc_83_9_83_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_9_83_12&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><a href="#loc_83_13_83_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_13_83_14&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
  where !</span><a name="loc_86_10_86_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_10_86_12&#39;)"><span class="hl_vardecl"><span class="mpre">sz</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">word2Int#</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">sizeInBaseInteger</span></span><span class="mpre"> </span><a href="#loc_83_13_83_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_13_83_14&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> 256#))
#else
</span><a href="#loc_83_1_83_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_8&#39;)"><span class="hl_fundecl"><span class="mpre">i2ospOf</span></span></a><span class="mpre"> </span><a name="loc_88_9_88_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_9_88_12&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_88_13_88_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_13_88_14&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">
    | </span><a href="#loc_92_9_92_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_9_92_17&#39;)"><span class="hl_varref"><span class="mpre">lenbytes</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_88_9_88_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_9_88_12&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">  = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.replicate</span></span><span class="mpre"> (</span><a href="#loc_88_9_88_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_9_88_12&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_92_9_92_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_9_92_17&#39;)"><span class="hl_varref"><span class="mpre">lenbytes</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`B.append`</span></span><span class="mpre"> </span><a href="#loc_93_9_93_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_9_93_14&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">
    | </span><a href="#loc_92_9_92_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_9_92_17&#39;)"><span class="hl_varref"><span class="mpre">lenbytes</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_88_9_88_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_9_88_12&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_93_9_93_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_9_93_14&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">       = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
  where </span><a name="loc_92_9_92_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_9_92_17&#39;)"><span class="hl_vardecl"><span class="mpre">lenbytes</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_93_9_93_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_9_93_14&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">
        </span><a name="loc_93_9_93_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_9_93_14&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre">    = </span><a href="#loc_62_1_62_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_6&#39;)"><span class="hl_varref"><span class="mpre">i2osp</span></span></a><span class="mpre"> </span><a href="#loc_88_13_88_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_13_88_14&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
#endif

</span><span class="hl_comment"><span class="mpre">-- | just like i2ospOf except that it doesn&#39;t expect a failure: i.e.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- an integer larger than the number of output bytes requested</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- for example if you just took a modulo of the number that represent</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the size (example the RSA modulo n).</span></span><span class="mpre">
</span><a href="#loc_103_1_103_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_1_103_9&#39;)"><span class="mpre">i2ospOf_</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
#if MIN_VERSION_integer_gmp(0,5,1)
</span><a name="loc_103_1_103_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_1_103_9&#39;)"><span class="hl_fundecl"><span class="mpre">i2ospOf_</span></span></a><span class="mpre"> </span><a name="loc_103_10_103_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_10_103_13&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_103_14_103_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_14_103_15&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.ByteString.Internal.html#loc_434_1_434_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_434_1_434_7&#39;)"><span class="hl_varref"><span class="mpre">B.create</span></span></a><span class="mpre"> </span><a href="#loc_103_10_103_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_10_103_13&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><a href="#loc_106_9_106_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_9_106_16&#39;)"><span class="hl_varref"><span class="mpre">fillPtr</span></span></a><span class="mpre">
  where !</span><a name="loc_104_10_104_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_10_104_12&#39;)"><span class="hl_vardecl"><span class="mpre">sz</span></span></a><span class="mpre"> = (</span><span class="hl_varref"><span class="mpre">sizeInBaseInteger</span></span><span class="mpre"> </span><a href="#loc_103_14_103_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_14_103_15&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> 256#)
        </span><a name="loc_105_9_105_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_9_105_12&#39;)"><span class="hl_vardecl"><span class="mpre">isz</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">word2Int#</span></span><span class="mpre"> </span><a href="#loc_104_10_104_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_10_104_12&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre">)
        </span><a name="loc_106_9_106_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_9_106_16&#39;)"><span class="hl_fundecl"><span class="mpre">fillPtr</span></span></a><span class="mpre"> </span><a name="loc_106_17_106_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_17_106_20&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre">
            | </span><a href="#loc_103_10_103_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_10_103_13&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_105_9_105_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_9_105_12&#39;)"><span class="hl_varref"><span class="mpre">isz</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;cannot compute i2ospOf_ with integer larger than output bytes&quot;</span></span><span class="mpre">
            | </span><a href="#loc_103_10_103_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_10_103_13&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_105_9_105_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_9_105_12&#39;)"><span class="hl_varref"><span class="mpre">isz</span></span></a><span class="mpre"> =
                let !(</span><span class="hl_conref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><a name="loc_109_27_109_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_27_109_34&#39;)"><span class="hl_vardecl"><span class="mpre">srcAddr</span></span></a><span class="mpre">) = </span><a href="#loc_106_17_106_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_17_106_20&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> in
                </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_110_23_110_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_23_110_24&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; case </span><span class="hl_varref"><span class="mpre">exportIntegerToAddr</span></span><span class="mpre"> </span><a href="#loc_103_14_103_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_14_103_15&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_109_27_109_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_27_109_34&#39;)"><span class="hl_varref"><span class="mpre">srcAddr</span></span></a><span class="mpre"> 1# </span><a href="#loc_110_23_110_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_23_110_24&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
                                (# </span><a name="loc_111_36_111_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_36_111_38&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">, _ #) -&gt; (# </span><a href="#loc_111_36_111_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_36_111_38&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> #)
            | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do
                let </span><a name="loc_113_21_113_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_21_113_22&#39;)"><span class="hl_vardecl"><span class="mpre">z</span></span></a><span class="mpre"> = </span><a href="#loc_103_10_103_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_10_103_13&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><a href="#loc_105_9_105_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_9_105_12&#39;)"><span class="hl_varref"><span class="mpre">isz</span></span></a><span class="mpre">
                _ &lt;- </span><a href="Data.ByteString.Internal.html#loc_639_1_639_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_639_1_639_7&#39;)"><span class="hl_varref"><span class="mpre">B.memset</span></span></a><span class="mpre"> </span><a href="#loc_106_17_106_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_17_106_20&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_103_10_103_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_10_103_13&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">)
                let !(</span><span class="hl_conref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><a name="loc_115_27_115_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_27_115_31&#39;)"><span class="hl_vardecl"><span class="mpre">addr</span></span></a><span class="mpre">) = </span><a href="#loc_106_17_106_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_17_106_20&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_113_21_113_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_21_113_22&#39;)"><span class="hl_varref"><span class="mpre">z</span></span></a><span class="mpre">
                </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_116_23_116_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_23_116_24&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; case </span><span class="hl_varref"><span class="mpre">exportIntegerToAddr</span></span><span class="mpre"> </span><a href="#loc_103_14_103_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_14_103_15&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_115_27_115_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_27_115_31&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre"> 1# </span><a href="#loc_116_23_116_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_23_116_24&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
                                (# </span><a name="loc_117_36_117_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_36_117_38&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">, _ #) -&gt; (# </span><a href="#loc_117_36_117_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_36_117_38&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> #)
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_103_1_103_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_1_103_9&#39;)"><span class="mpre">i2ospOf_</span></a><span class="mpre"> #-}</span></span><span class="mpre">
#else
</span><span class="hl_fundecl"><span class="mpre">i2ospOf_</span></span><span class="mpre"> </span><a name="loc_120_10_120_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_10_120_13&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_120_14_120_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_14_120_15&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Internal.html#loc_411_1_411_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_411_1_411_13&#39;)"><span class="hl_varref"><span class="mpre">B.unsafeCreate</span></span></a><span class="mpre"> </span><a href="#loc_120_10_120_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_10_120_13&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><a href="#loc_121_11_121_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_11_121_18&#39;)"><span class="hl_varref"><span class="mpre">fillPtr</span></span></a><span class="mpre">
    where </span><a name="loc_121_11_121_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_11_121_18&#39;)"><span class="hl_fundecl"><span class="mpre">fillPtr</span></span></a><span class="mpre"> </span><a name="loc_121_19_121_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_19_121_25&#39;)"><span class="hl_vardecl"><span class="mpre">srcPtr</span></span></a><span class="mpre"> = </span><a href="#loc_122_19_122_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_19_122_23&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_120_14_120_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_14_120_15&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> (</span><a href="#loc_121_19_121_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_19_121_25&#39;)"><span class="hl_varref"><span class="mpre">srcPtr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (</span><a href="#loc_120_10_120_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_10_120_13&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">))
            where </span><a name="loc_122_19_122_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_19_122_23&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_122_24_122_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_24_122_25&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> </span><a name="loc_122_26_122_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_26_122_29&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> = do
                      let (</span><a name="loc_123_28_123_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_28_123_30&#39;)"><span class="hl_vardecl"><span class="mpre">nn</span></span></a><span class="mpre">,</span><a name="loc_123_31_123_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_31_123_32&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">) = </span><a href="#loc_43_1_43_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_10&#39;)"><span class="hl_varref"><span class="mpre">divMod256</span></span></a><span class="mpre"> </span><a href="#loc_122_24_122_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_24_122_25&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
                      </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_122_26_122_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_26_122_29&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_123_31_123_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_31_123_32&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)
                      if </span><a href="#loc_122_26_122_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_26_122_29&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_121_19_121_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_19_121_25&#39;)"><span class="hl_varref"><span class="mpre">srcPtr</span></span></a><span class="mpre">
                          then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
                          else (if </span><a href="#loc_123_28_123_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_28_123_30&#39;)"><span class="hl_varref"><span class="mpre">nn</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> then </span><a href="#loc_128_19_128_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_19_128_29&#39;)"><span class="hl_varref"><span class="mpre">fillerLoop</span></span></a><span class="mpre"> else </span><a href="#loc_122_19_122_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_19_122_23&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_123_28_123_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_28_123_30&#39;)"><span class="hl_varref"><span class="mpre">nn</span></span></a><span class="mpre">) (</span><a href="#loc_122_26_122_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_26_122_29&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (-</span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">))
                  </span><a name="loc_128_19_128_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_19_128_29&#39;)"><span class="hl_fundecl"><span class="mpre">fillerLoop</span></span></a><span class="mpre"> </span><a name="loc_128_30_128_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_30_128_33&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> = do
                      </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_128_30_128_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_30_128_33&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
                      if </span><a href="#loc_128_30_128_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_30_128_33&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_121_19_121_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_19_121_25&#39;)"><span class="hl_varref"><span class="mpre">srcPtr</span></span></a><span class="mpre">
                          then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
                          else </span><a href="#loc_128_19_128_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_19_128_29&#39;)"><span class="hl_varref"><span class="mpre">fillerLoop</span></span></a><span class="mpre"> (</span><a href="#loc_128_30_128_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_30_128_33&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (-</span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">))
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_103_1_103_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_1_103_9&#39;)"><span class="mpre">i2ospOf_</span></a><span class="mpre"> #-}</span></span><span class="mpre">
#endif

</span><span class="hl_comment"><span class="mpre">-- | returns the number of bytes to store an integer with i2osp</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- with integer-simple, this function is really slow.</span></span><span class="mpre">
</span><a href="#loc_141_1_141_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_1_141_12&#39;)"><span class="mpre">lengthBytes</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
#if MIN_VERSION_integer_gmp(0,5,1)
</span><a name="loc_141_1_141_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_1_141_12&#39;)"><span class="hl_fundecl"><span class="mpre">lengthBytes</span></span></a><span class="mpre"> </span><a name="loc_141_13_141_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_13_141_14&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">word2Int#</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">sizeInBaseInteger</span></span><span class="mpre"> </span><a href="#loc_141_13_141_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_13_141_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> 256#))
#else
</span><a href="#loc_141_1_141_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_1_141_12&#39;)"><span class="hl_fundecl"><span class="mpre">lengthBytes</span></span></a><span class="mpre"> </span><a name="loc_143_13_143_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_13_143_14&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">
    | </span><a href="#loc_143_13_143_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_13_143_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">256</span></span><span class="mpre">   = </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_141_1_141_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_1_141_12&#39;)"><span class="hl_varref"><span class="mpre">lengthBytes</span></span></a><span class="mpre"> (</span><a href="#loc_143_13_143_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_13_143_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">)
#endif
</span></div></body></html>