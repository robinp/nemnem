<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE OverloadedStrings #-}
module Network.Wai.Middleware.Vhost (vhost, redirectWWW, redirectTo, redirectToLogged) where

import Network.Wai

import Network.HTTP.Types as H
import qualified Data.Text.Encoding as TE
import Data.Text (</span><a href="Data.Text.Internal.html#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_6_50_10&#39;)"><span class="mpre">Text</span></a><span class="mpre">)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-extra-3.0.0.1/Network/Wai/Middleware/Vhost.hs&quot;, srcSpanStartLine = 9, srcSpanStartColumn = 18, srcSpanEndLine = 9, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as BS
import Data.Monoid (</span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="mpre">mappend</span></a><span class="mpre">)

</span><a href="#loc_13_1_13_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_13_1_13_6&#39;)"><span class="mpre">vhost</span></a><span class="mpre"> :: [(</span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Application</span></span><span class="mpre">)] -&gt; </span><span class="hl_tyconref"><span class="mpre">Application</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Application</span></span><span class="mpre">
</span><a name="loc_13_1_13_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_13_1_13_6&#39;)"><span class="hl_fundecl"><span class="mpre">vhost</span></span></a><span class="mpre"> </span><a name="loc_13_7_13_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_13_7_13_13&#39;)"><span class="hl_vardecl"><span class="mpre">vhosts</span></span></a><span class="mpre"> </span><a name="loc_13_14_13_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_13_14_13_17&#39;)"><span class="hl_vardecl"><span class="mpre">def</span></span></a><span class="mpre"> </span><a name="loc_13_18_13_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_13_18_13_21&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> =
    case </span><span class="hl_varref"><span class="mpre">filter</span></span><span class="mpre"> (\(</span><a name="loc_14_20_14_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_14_20_14_21&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">, _) -&gt; </span><a href="#loc_14_20_14_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_14_20_14_21&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><a href="#loc_13_18_13_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_13_18_13_21&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">) </span><a href="#loc_13_7_13_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_13_7_13_13&#39;)"><span class="hl_varref"><span class="mpre">vhosts</span></span></a><span class="mpre"> of
        [] -&gt; </span><a href="#loc_13_14_13_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_13_14_13_17&#39;)"><span class="hl_varref"><span class="mpre">def</span></span></a><span class="mpre"> </span><a href="#loc_13_18_13_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_13_18_13_21&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">
        (_, </span><a name="loc_16_13_16_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_13_16_16&#39;)"><span class="hl_vardecl"><span class="mpre">app</span></span></a><span class="mpre">)</span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_ -&gt; </span><a href="#loc_16_13_16_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_13_16_16&#39;)"><span class="hl_varref"><span class="mpre">app</span></span></a><span class="mpre"> </span><a href="#loc_13_18_13_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_13_18_13_21&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">

</span><a href="#loc_19_1_19_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_1_19_12&#39;)"><span class="mpre">redirectWWW</span></a><span class="mpre"> :: </span><a href="Data.Text.Internal.html#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Application</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Application</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- W.MiddleWare</span></span><span class="mpre">
</span><a name="loc_19_1_19_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_1_19_12&#39;)"><span class="hl_fundecl"><span class="mpre">redirectWWW</span></span></a><span class="mpre"> </span><a name="loc_19_13_19_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_13_19_17&#39;)"><span class="hl_vardecl"><span class="mpre">home</span></span></a><span class="mpre"> =
  </span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_varref"><span class="mpre">redirectIf</span></span></a><span class="mpre"> </span><a href="#loc_19_13_19_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_13_19_17&#39;)"><span class="hl_varref"><span class="mpre">home</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">BS.isPrefixOf</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;www&quot;</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;host&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Network.Wai.Internal.html#loc_36_6_36_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_36_6_36_20&#39;)"><span class="hl_varref"><span class="mpre">requestHeaders</span></span></a><span class="mpre">)

</span><a href="#loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="mpre">redirectIf</span></a><span class="mpre"> :: </span><a href="Data.Text.Internal.html#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre"> -&gt; (</span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">Application</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Application</span></span><span class="mpre">
</span><a name="loc_23_1_23_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_11&#39;)"><span class="hl_fundecl"><span class="mpre">redirectIf</span></span></a><span class="mpre"> </span><a name="loc_23_12_23_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_12_23_16&#39;)"><span class="hl_vardecl"><span class="mpre">home</span></span></a><span class="mpre"> </span><a name="loc_23_17_23_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_17_23_21&#39;)"><span class="hl_vardecl"><span class="mpre">cond</span></span></a><span class="mpre"> </span><a name="loc_23_22_23_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_22_23_25&#39;)"><span class="hl_vardecl"><span class="mpre">app</span></span></a><span class="mpre"> </span><a name="loc_23_26_23_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_26_23_29&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> </span><a name="loc_23_30_23_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_30_23_42&#39;)"><span class="hl_vardecl"><span class="mpre">sendResponse</span></span></a><span class="mpre"> =
  if </span><a href="#loc_23_17_23_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_17_23_21&#39;)"><span class="hl_varref"><span class="mpre">cond</span></span></a><span class="mpre"> </span><a href="#loc_23_26_23_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_26_23_29&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">
    then </span><a href="#loc_23_30_23_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_30_23_42&#39;)"><span class="hl_varref"><span class="mpre">sendResponse</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_29_1_29_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_1_29_11&#39;)"><span class="hl_varref"><span class="mpre">redirectTo</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Text.Encoding.html#loc_386_1_386_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Encoding.html#loc_386_1_386_11&#39;)"><span class="hl_varref"><span class="mpre">TE.encodeUtf8</span></span></a><span class="mpre"> </span><a href="#loc_23_12_23_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_12_23_16&#39;)"><span class="hl_varref"><span class="mpre">home</span></span></a><span class="mpre">
    else </span><a href="#loc_23_22_23_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_22_23_25&#39;)"><span class="hl_varref"><span class="mpre">app</span></span></a><span class="mpre"> </span><a href="#loc_23_26_23_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_26_23_29&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><a href="#loc_23_30_23_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_30_23_42&#39;)"><span class="hl_varref"><span class="mpre">sendResponse</span></span></a><span class="mpre">

</span><a href="#loc_29_1_29_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_1_29_11&#39;)"><span class="mpre">redirectTo</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">BS.ByteString</span></span><span class="mpre"> -&gt; </span><a href="Network.Wai.Internal.html#loc_74_6_74_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_74_6_74_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre">
</span><a name="loc_29_1_29_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_1_29_11&#39;)"><span class="hl_fundecl"><span class="mpre">redirectTo</span></span></a><span class="mpre"> </span><a name="loc_29_12_29_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_12_29_20&#39;)"><span class="hl_vardecl"><span class="mpre">location</span></span></a><span class="mpre"> = </span><a href="Network.Wai.html#loc_130_1_130_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_130_1_130_12&#39;)"><span class="hl_varref"><span class="mpre">responseLBS</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Types.Status.html#loc_257_1_257_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_257_1_257_10&#39;)"><span class="hl_varref"><span class="mpre">H.status301</span></span></a><span class="mpre">
    [ (</span><span class="hl_string"><span class="mpre">&quot;Content-Type&quot;</span></span><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;text/plain&quot;</span></span><span class="mpre">) , (</span><span class="hl_string"><span class="mpre">&quot;Location&quot;</span></span><span class="mpre">, </span><a href="#loc_29_12_29_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_12_29_20&#39;)"><span class="hl_varref"><span class="mpre">location</span></span></a><span class="mpre">) ] </span><span class="hl_string"><span class="mpre">&quot;Redirect&quot;</span></span><span class="mpre">

</span><a href="#loc_33_1_33_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_17&#39;)"><span class="mpre">redirectToLogged</span></a><span class="mpre"> :: (</span><a href="Data.Text.Internal.html#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">BS.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="Network.Wai.Internal.html#loc_74_6_74_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_74_6_74_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre">
</span><a name="loc_33_1_33_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_17&#39;)"><span class="hl_fundecl"><span class="mpre">redirectToLogged</span></span></a><span class="mpre"> </span><a name="loc_33_18_33_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_18_33_24&#39;)"><span class="hl_vardecl"><span class="mpre">logger</span></span></a><span class="mpre"> </span><a name="loc_33_25_33_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_25_33_28&#39;)"><span class="hl_vardecl"><span class="mpre">loc</span></span></a><span class="mpre"> = do
  </span><a href="#loc_33_18_33_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_18_33_24&#39;)"><span class="hl_varref"><span class="mpre">logger</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;redirecting to: &quot;</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_infix"><span class="mpre">`mappend`</span></span></a><span class="mpre"> </span><a href="Data.Text.Encoding.html#loc_307_1_307_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Encoding.html#loc_307_1_307_11&#39;)"><span class="hl_varref"><span class="mpre">TE.decodeUtf8</span></span></a><span class="mpre"> </span><a href="#loc_33_25_33_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_25_33_28&#39;)"><span class="hl_varref"><span class="mpre">loc</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_29_1_29_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_1_29_11&#39;)"><span class="hl_varref"><span class="mpre">redirectTo</span></span></a><span class="mpre"> </span><a href="#loc_33_25_33_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_25_33_28&#39;)"><span class="hl_varref"><span class="mpre">loc</span></span></a><span class="mpre">
</span></div></body></html>