<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE OverloadedStrings #-}
module ResponseSpec (main, spec) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/test/ResponseSpec.hs&quot;, srcSpanStartLine = 4, srcSpanStartColumn = 8, srcSpanEndLine = 4, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;Control.Concurrent&quot;"><span class="mpre">Control.Concurrent</span></span><span class="mpre"> (threadDelay)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/test/ResponseSpec.hs&quot;, srcSpanStartLine = 5, srcSpanStartColumn = 18, srcSpanEndLine = 5, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as S
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/test/ResponseSpec.hs&quot;, srcSpanStartLine = 6, srcSpanStartColumn = 18, srcSpanEndLine = 6, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as S8
import Data.Maybe (</span><a href="Data.Maybe.html#loc_123_1_123_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_123_1_123_9&#39;)"><span class="mpre">mapMaybe</span></a><span class="mpre">)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/test/ResponseSpec.hs&quot;, srcSpanStartLine = 8, srcSpanStartColumn = 8, srcSpanEndLine = 8, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;Network&quot;"><span class="mpre">Network</span></span><span class="mpre"> (connectTo, PortID (PortNumber))
import Network.HTTP.Types
import Network.Wai
import Network.Wai.Handler.Warp
import Network.Wai.Handler.Warp.Response
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/test/ResponseSpec.hs&quot;, srcSpanStartLine = 13, srcSpanStartColumn = 8, srcSpanEndLine = 13, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;RunSpec&quot;"><span class="mpre">RunSpec</span></span><span class="mpre"> (withApp)
import System.IO (</span><a href="GHC.IO.Handle.html#loc_86_1_86_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_86_1_86_7&#39;)"><span class="mpre">hClose</span></a><span class="mpre">, </span><a href="GHC.IO.Handle.html#loc_293_1_293_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_293_1_293_7&#39;)"><span class="mpre">hFlush</span></a><span class="mpre">)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/test/ResponseSpec.hs&quot;, srcSpanStartLine = 15, srcSpanStartColumn = 8, srcSpanEndLine = 15, srcSpanEndColumn = 18}, srcInfoPoints = []}) &quot;Test.Hspec&quot;"><span class="mpre">Test.Hspec</span></span><span class="mpre">

</span><a href="#loc_18_1_18_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_1_18_5&#39;)"><span class="mpre">main</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_18_1_18_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_1_18_5&#39;)"><span class="hl_vardecl"><span class="mpre">main</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">hspec</span></span><span class="mpre"> </span><a href="#loc_84_1_84_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_5&#39;)"><span class="hl_varref"><span class="mpre">spec</span></span></a><span class="mpre">

</span><a href="#loc_24_1_24_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_1_24_10&#39;)"><span class="mpre">testRange</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">S.ByteString</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ range value</span></span><span class="mpre">
          -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ expected output</span></span><span class="mpre">
          -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ expected content-range value</span></span><span class="mpre">
          -&gt; </span><span class="hl_tyconref"><span class="mpre">Spec</span></span><span class="mpre">
</span><a name="loc_24_1_24_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_1_24_10&#39;)"><span class="hl_fundecl"><span class="mpre">testRange</span></span></a><span class="mpre"> </span><a name="loc_24_11_24_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_11_24_16&#39;)"><span class="hl_vardecl"><span class="mpre">range</span></span></a><span class="mpre"> </span><a name="loc_24_17_24_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_17_24_20&#39;)"><span class="hl_vardecl"><span class="mpre">out</span></span></a><span class="mpre"> </span><a name="loc_24_21_24_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_21_24_27&#39;)"><span class="hl_vardecl"><span class="mpre">crange</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><a href="#loc_40_5_40_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_5_40_10&#39;)"><span class="hl_varref"><span class="mpre">title</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">withApp</span></span><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Settings.html#loc_65_1_65_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Settings.html#loc_65_1_65_16&#39;)"><span class="hl_varref"><span class="mpre">defaultSettings</span></span></a><span class="mpre"> </span><a href="#loc_39_5_39_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_5_39_8&#39;)"><span class="hl_varref"><span class="mpre">app</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_24_72_24_76" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_72_24_76&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_25_5_25_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_5_25_11&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">connectTo</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;127.0.0.1&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">PortNumber</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_24_72_24_76" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_72_24_76&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">S.hPutStr</span></span><span class="mpre"> </span><a href="#loc_25_5_25_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_5_25_11&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;GET / HTTP/1.0\r\n&quot;</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">S.hPutStr</span></span><span class="mpre"> </span><a href="#loc_25_5_25_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_5_25_11&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Range: bytes=&quot;</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">S.hPutStr</span></span><span class="mpre"> </span><a href="#loc_25_5_25_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_5_25_11&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_24_11_24_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_11_24_16&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">S.hPutStr</span></span><span class="mpre"> </span><a href="#loc_25_5_25_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_5_25_11&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;\r\n\r\n&quot;</span></span><span class="mpre">
    </span><a href="GHC.IO.Handle.html#loc_293_1_293_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_293_1_293_7&#39;)"><span class="hl_varref"><span class="mpre">hFlush</span></span></a><span class="mpre"> </span><a href="#loc_25_5_25_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_5_25_11&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">threadDelay</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">10000</span></span><span class="mpre">
    </span><a name="loc_32_5_32_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_5_32_8&#39;)"><span class="hl_vardecl"><span class="mpre">bss</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">lines</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">filter</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\r&#39;</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S8.unpack</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.hGetSome</span></span><span class="mpre"> </span><a href="#loc_25_5_25_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_5_25_11&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1024</span></span><span class="mpre">
    </span><a href="GHC.IO.Handle.html#loc_86_1_86_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_86_1_86_7&#39;)"><span class="hl_varref"><span class="mpre">hClose</span></span></a><span class="mpre"> </span><a href="#loc_25_5_25_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_5_25_11&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">
    </span><a href="#loc_24_17_24_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_17_24_20&#39;)"><span class="hl_varref"><span class="mpre">out</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">last</span></span><span class="mpre"> </span><a href="#loc_32_5_32_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_5_32_8&#39;)"><span class="hl_varref"><span class="mpre">bss</span></span></a><span class="mpre">
    let </span><a name="loc_35_9_35_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_9_35_11&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> = </span><a href="Data.Maybe.html#loc_123_1_123_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_123_1_123_9&#39;)"><span class="hl_varref"><span class="mpre">mapMaybe</span></span></a><span class="mpre"> </span><a href="#loc_41_5_41_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_5_41_13&#39;)"><span class="hl_varref"><span class="mpre">toHeader</span></span></a><span class="mpre"> </span><a href="#loc_32_5_32_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_5_32_8&#39;)"><span class="hl_varref"><span class="mpre">bss</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Content-Range&quot;</span></span><span class="mpre"> </span><a href="#loc_35_9_35_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_9_35_11&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;bytes &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_24_21_24_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_21_24_27&#39;)"><span class="hl_varref"><span class="mpre">crange</span></span></a><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Content-Length&quot;</span></span><span class="mpre"> </span><a href="#loc_35_9_35_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_9_35_11&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">length</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">last</span></span><span class="mpre"> </span><a href="#loc_32_5_32_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_5_32_8&#39;)"><span class="hl_varref"><span class="mpre">bss</span></span></a><span class="mpre">)
  where
    </span><a name="loc_39_5_39_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_5_39_8&#39;)"><span class="hl_fundecl"><span class="mpre">app</span></span></a><span class="mpre"> _ = (</span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Wai.html#loc_99_1_99_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_99_1_99_13&#39;)"><span class="hl_varref"><span class="mpre">responseFile</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Types.Status.html#loc_193_1_193_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_193_1_193_10&#39;)"><span class="hl_varref"><span class="mpre">status200</span></span></a><span class="mpre"> [] </span><span class="hl_string"><span class="mpre">&quot;attic/hex&quot;</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">)
    </span><a name="loc_40_5_40_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_5_40_10&#39;)"><span class="hl_vardecl"><span class="mpre">title</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><a href="#loc_24_11_24_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_11_24_16&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre">, </span><a href="#loc_24_17_24_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_17_24_20&#39;)"><span class="hl_varref"><span class="mpre">out</span></span></a><span class="mpre">, </span><a href="#loc_24_21_24_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_21_24_27&#39;)"><span class="hl_varref"><span class="mpre">crange</span></span></a><span class="mpre">)
    </span><a name="loc_41_5_41_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_5_41_13&#39;)"><span class="hl_fundecl"><span class="mpre">toHeader</span></span></a><span class="mpre"> </span><a name="loc_41_14_41_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_14_41_15&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> =
        case </span><span class="hl_varref"><span class="mpre">break</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;:&#39;</span></span><span class="mpre">) </span><a href="#loc_41_14_41_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_14_41_15&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
            (</span><a name="loc_43_14_43_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_14_43_15&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">, </span><span class="hl_char"><span class="mpre">&#39;:&#39;</span></span><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_43_21_43_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_21_43_22&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre">) -&gt; </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a href="#loc_43_14_43_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_14_43_15&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">dropWhile</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39; &#39;</span></span><span class="mpre">) </span><a href="#loc_43_21_43_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_21_43_22&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">)
            _ -&gt; </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">

</span><a href="#loc_51_1_51_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_12&#39;)"><span class="mpre">testPartial</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ file size</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ offset</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ byte count</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ expected output</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">Spec</span></span><span class="mpre">
</span><a name="loc_51_1_51_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_12&#39;)"><span class="hl_fundecl"><span class="mpre">testPartial</span></span></a><span class="mpre"> </span><a name="loc_51_13_51_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_13_51_17&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> </span><a name="loc_51_18_51_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_18_51_24&#39;)"><span class="hl_vardecl"><span class="mpre">offset</span></span></a><span class="mpre"> </span><a name="loc_51_25_51_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_25_51_30&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> </span><a name="loc_51_31_51_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_31_51_34&#39;)"><span class="hl_vardecl"><span class="mpre">out</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><a href="#loc_64_5_64_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_10&#39;)"><span class="hl_varref"><span class="mpre">title</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">withApp</span></span><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Settings.html#loc_65_1_65_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Settings.html#loc_65_1_65_16&#39;)"><span class="hl_varref"><span class="mpre">defaultSettings</span></span></a><span class="mpre"> </span><a href="#loc_63_5_63_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_8&#39;)"><span class="hl_varref"><span class="mpre">app</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_51_79_51_83" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_79_51_83&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_52_5_52_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_11&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">connectTo</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;127.0.0.1&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">PortNumber</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_51_79_51_83" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_79_51_83&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">S.hPutStr</span></span><span class="mpre"> </span><a href="#loc_52_5_52_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_11&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;GET / HTTP/1.0\r\n\r\n&quot;</span></span><span class="mpre">
    </span><a href="GHC.IO.Handle.html#loc_293_1_293_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_293_1_293_7&#39;)"><span class="hl_varref"><span class="mpre">hFlush</span></span></a><span class="mpre"> </span><a href="#loc_52_5_52_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_11&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">threadDelay</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">10000</span></span><span class="mpre">
    </span><a name="loc_56_5_56_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_5_56_8&#39;)"><span class="hl_vardecl"><span class="mpre">bss</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">lines</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">filter</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\r&#39;</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S8.unpack</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.hGetSome</span></span><span class="mpre"> </span><a href="#loc_52_5_52_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_11&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1024</span></span><span class="mpre">
    </span><a href="GHC.IO.Handle.html#loc_86_1_86_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_86_1_86_7&#39;)"><span class="hl_varref"><span class="mpre">hClose</span></span></a><span class="mpre"> </span><a href="#loc_52_5_52_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_11&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">
    </span><a href="#loc_51_31_51_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_31_51_34&#39;)"><span class="hl_varref"><span class="mpre">out</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">last</span></span><span class="mpre"> </span><a href="#loc_56_5_56_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_5_56_8&#39;)"><span class="hl_varref"><span class="mpre">bss</span></span></a><span class="mpre">
    let </span><a name="loc_59_9_59_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_9_59_11&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> = </span><a href="Data.Maybe.html#loc_123_1_123_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_123_1_123_9&#39;)"><span class="hl_varref"><span class="mpre">mapMaybe</span></span></a><span class="mpre"> </span><a href="#loc_65_5_65_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_5_65_13&#39;)"><span class="hl_varref"><span class="mpre">toHeader</span></span></a><span class="mpre"> </span><a href="#loc_56_5_56_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_5_56_8&#39;)"><span class="hl_varref"><span class="mpre">bss</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Content-Length&quot;</span></span><span class="mpre"> </span><a href="#loc_59_9_59_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_9_59_11&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">length</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">last</span></span><span class="mpre"> </span><a href="#loc_56_5_56_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_5_56_8&#39;)"><span class="hl_varref"><span class="mpre">bss</span></span></a><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">lookup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Content-Range&quot;</span></span><span class="mpre"> </span><a href="#loc_59_9_59_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_9_59_11&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_69_5_69_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_5_69_10&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre">
  where
    </span><a name="loc_63_5_63_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_8&#39;)"><span class="hl_fundecl"><span class="mpre">app</span></span></a><span class="mpre"> _ = (</span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Wai.html#loc_99_1_99_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_99_1_99_13&#39;)"><span class="hl_varref"><span class="mpre">responseFile</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Types.Status.html#loc_193_1_193_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_193_1_193_10&#39;)"><span class="hl_varref"><span class="mpre">status200</span></span></a><span class="mpre"> [] </span><span class="hl_string"><span class="mpre">&quot;attic/hex&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">FilePart</span></span><span class="mpre"> </span><a href="#loc_51_18_51_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_18_51_24&#39;)"><span class="hl_varref"><span class="mpre">offset</span></span></a><span class="mpre"> </span><a href="#loc_51_25_51_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_25_51_30&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><a href="#loc_51_13_51_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_13_51_17&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">)
    </span><a name="loc_64_5_64_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_10&#39;)"><span class="hl_vardecl"><span class="mpre">title</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><a href="#loc_51_18_51_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_18_51_24&#39;)"><span class="hl_varref"><span class="mpre">offset</span></span></a><span class="mpre">, </span><a href="#loc_51_25_51_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_25_51_30&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">, </span><a href="#loc_51_31_51_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_31_51_34&#39;)"><span class="hl_varref"><span class="mpre">out</span></span></a><span class="mpre">)
    </span><a name="loc_65_5_65_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_5_65_13&#39;)"><span class="hl_fundecl"><span class="mpre">toHeader</span></span></a><span class="mpre"> </span><a name="loc_65_14_65_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_14_65_15&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> =
        case </span><span class="hl_varref"><span class="mpre">break</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;:&#39;</span></span><span class="mpre">) </span><a href="#loc_65_14_65_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_14_65_15&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
            (</span><a name="loc_67_14_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_14_67_15&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">, </span><span class="hl_char"><span class="mpre">&#39;:&#39;</span></span><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_67_21_67_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_21_67_22&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre">) -&gt; </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a href="#loc_67_14_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_14_67_15&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">dropWhile</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39; &#39;</span></span><span class="mpre">) </span><a href="#loc_67_21_67_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_21_67_22&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">)
            _ -&gt; </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
    </span><a name="loc_69_5_69_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_5_69_10&#39;)"><span class="hl_vardecl"><span class="mpre">range</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;bytes &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_51_18_51_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_18_51_24&#39;)"><span class="hl_varref"><span class="mpre">offset</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;-&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><a href="#loc_51_18_51_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_18_51_24&#39;)"><span class="hl_varref"><span class="mpre">offset</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_51_25_51_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_25_51_30&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;/&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_51_13_51_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_13_51_17&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">

</span><a href="#loc_76_1_76_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_14&#39;)"><span class="mpre">testFileRange</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
              -&gt; </span><a href="Network.HTTP.Types.Status.html#loc_114_6_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_114_6_114_12&#39;)"><span class="hl_tyconref"><span class="mpre">Status</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ResponseHeaders</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre">
              -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.Wai.Internal.html#loc_98_6_98_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_98_6_98_14&#39;)"><span class="hl_tyconref"><span class="mpre">FilePart</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HeaderValue</span></span><span class="mpre">
              -&gt; </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> (</span><a href="Network.HTTP.Types.Status.html#loc_114_6_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_114_6_114_12&#39;)"><span class="hl_tyconref"><span class="mpre">Status</span></span></a><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">ResponseHeaders</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">)
              -&gt; </span><span class="hl_tyconref"><span class="mpre">Spec</span></span><span class="mpre">
</span><a name="loc_76_1_76_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_14&#39;)"><span class="hl_fundecl"><span class="mpre">testFileRange</span></span></a><span class="mpre"> </span><a name="loc_76_15_76_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_15_76_19&#39;)"><span class="hl_vardecl"><span class="mpre">desc</span></span></a><span class="mpre"> </span><a name="loc_76_20_76_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_20_76_21&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_76_22_76_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_22_76_28&#39;)"><span class="hl_vardecl"><span class="mpre">rsphdr</span></span></a><span class="mpre"> </span><a name="loc_76_29_76_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_29_76_33&#39;)"><span class="hl_vardecl"><span class="mpre">file</span></span></a><span class="mpre"> </span><a name="loc_76_34_76_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_34_76_39&#39;)"><span class="hl_vardecl"><span class="mpre">mPart</span></span></a><span class="mpre"> </span><a name="loc_76_40_76_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_40_76_46&#39;)"><span class="hl_vardecl"><span class="mpre">mRange</span></span></a><span class="mpre"> </span><a name="loc_76_47_76_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_47_76_50&#39;)"><span class="hl_vardecl"><span class="mpre">ans</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><a href="#loc_76_15_76_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_15_76_19&#39;)"><span class="hl_varref"><span class="mpre">desc</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a name="loc_77_5_77_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_5_77_9&#39;)"><span class="hl_vardecl"><span class="mpre">eres</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Wai.Handler.Warp.Response.html#loc_68_1_68_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Response.html#loc_68_1_68_10&#39;)"><span class="hl_varref"><span class="mpre">fileRange</span></span></a><span class="mpre"> </span><a href="#loc_76_20_76_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_20_76_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><a href="#loc_76_22_76_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_22_76_28&#39;)"><span class="hl_varref"><span class="mpre">rsphdr</span></span></a><span class="mpre"> </span><a href="#loc_76_29_76_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_29_76_33&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre"> </span><a href="#loc_76_34_76_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_34_76_39&#39;)"><span class="hl_varref"><span class="mpre">mPart</span></span></a><span class="mpre"> </span><a href="#loc_76_40_76_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_40_76_46&#39;)"><span class="hl_varref"><span class="mpre">mRange</span></span></a><span class="mpre">
    let </span><a name="loc_78_9_78_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_9_78_12&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> = case </span><a href="#loc_77_5_77_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_5_77_9&#39;)"><span class="hl_varref"><span class="mpre">eres</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre">  </span><a name="loc_79_19_79_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_19_79_20&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre">   -&gt; </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_79_19_79_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_19_79_20&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
            </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a name="loc_80_19_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_19_80_20&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">   -&gt; </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a href="#loc_80_19_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_19_80_20&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
    </span><a href="#loc_78_9_78_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_9_78_12&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><a href="#loc_76_47_76_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_47_76_50&#39;)"><span class="hl_varref"><span class="mpre">ans</span></span></a><span class="mpre">

</span><a href="#loc_84_1_84_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_5&#39;)"><span class="mpre">spec</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Spec</span></span><span class="mpre">
</span><a name="loc_84_1_84_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_5&#39;)"><span class="hl_vardecl"><span class="mpre">spec</span></span></a><span class="mpre"> = do
    </span><span class="hl_varref"><span class="mpre">describe</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;range requests&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><a href="#loc_24_1_24_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_1_24_10&#39;)"><span class="hl_varref"><span class="mpre">testRange</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;2-3&quot;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;23&quot;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;2-3/16&quot;</span></span><span class="mpre">
        </span><a href="#loc_24_1_24_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_1_24_10&#39;)"><span class="hl_varref"><span class="mpre">testRange</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;5-&quot;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;56789abcdef&quot;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;5-15/16&quot;</span></span><span class="mpre">
        </span><a href="#loc_24_1_24_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_1_24_10&#39;)"><span class="hl_varref"><span class="mpre">testRange</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;5-8&quot;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;5678&quot;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;5-8/16&quot;</span></span><span class="mpre">
        </span><a href="#loc_24_1_24_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_1_24_10&#39;)"><span class="hl_varref"><span class="mpre">testRange</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;-3&quot;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;def&quot;</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;13-15/16&quot;</span></span><span class="mpre">

    </span><span class="hl_varref"><span class="mpre">describe</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;partial files&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><a href="#loc_51_1_51_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_12&#39;)"><span class="hl_varref"><span class="mpre">testPartial</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;23&quot;</span></span><span class="mpre">
        </span><a href="#loc_51_1_51_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_12&#39;)"><span class="hl_varref"><span class="mpre">testPartial</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;01&quot;</span></span><span class="mpre">
        </span><a href="#loc_51_1_51_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_12&#39;)"><span class="hl_varref"><span class="mpre">testPartial</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">3</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;3456789a&quot;</span></span><span class="mpre">

    </span><span class="hl_varref"><span class="mpre">describe</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;fileRange&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><a href="#loc_76_1_76_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_14&#39;)"><span class="hl_varref"><span class="mpre">testFileRange</span></span></a><span class="mpre">
            </span><span class="hl_string"><span class="mpre">&quot;gets a file size from file system&quot;</span></span><span class="mpre">
            </span><a href="Network.HTTP.Types.Status.html#loc_193_1_193_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_193_1_193_10&#39;)"><span class="hl_varref"><span class="mpre">status200</span></span></a><span class="mpre"> [] </span><span class="hl_string"><span class="mpre">&quot;attic/hex&quot;</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
            </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="Network.HTTP.Types.Status.html#loc_193_1_193_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_193_1_193_10&#39;)"><span class="hl_varref"><span class="mpre">status200</span></span></a><span class="mpre">,[(</span><span class="hl_string"><span class="mpre">&quot;Content-Length&quot;</span></span><span class="mpre">,</span><span class="hl_string"><span class="mpre">&quot;16&quot;</span></span><span class="mpre">)],</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">,</span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre">)
        </span><a href="#loc_76_1_76_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_14&#39;)"><span class="hl_varref"><span class="mpre">testFileRange</span></span></a><span class="mpre">
            </span><span class="hl_string"><span class="mpre">&quot;gets an error if a file does not exist&quot;</span></span><span class="mpre">
            </span><a href="Network.HTTP.Types.Status.html#loc_193_1_193_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_193_1_193_10&#39;)"><span class="hl_varref"><span class="mpre">status200</span></span></a><span class="mpre"> [] </span><span class="hl_string"><span class="mpre">&quot;attic/nonexist&quot;</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
            </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;attic/nonexist: getFileStatus: does not exist (No such file or directory)&quot;</span></span><span class="mpre">
        </span><a href="#loc_76_1_76_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_14&#39;)"><span class="hl_varref"><span class="mpre">testFileRange</span></span></a><span class="mpre">
            </span><span class="hl_string"><span class="mpre">&quot;changes status if FileParts is specified&quot;</span></span><span class="mpre">
            </span><a href="Network.HTTP.Types.Status.html#loc_193_1_193_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_193_1_193_10&#39;)"><span class="hl_varref"><span class="mpre">status200</span></span></a><span class="mpre"> [] </span><span class="hl_string"><span class="mpre">&quot;attic/hex&quot;</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">FilePart</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">10</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre">)) </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
            </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="Network.HTTP.Types.Status.html#loc_241_1_241_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_241_1_241_10&#39;)"><span class="hl_varref"><span class="mpre">status206</span></span></a><span class="mpre">,[(</span><span class="hl_string"><span class="mpre">&quot;Content-Range&quot;</span></span><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;bytes 2-11/16&quot;</span></span><span class="mpre">),(</span><span class="hl_string"><span class="mpre">&quot;Content-Length&quot;</span></span><span class="mpre">,</span><span class="hl_string"><span class="mpre">&quot;10&quot;</span></span><span class="mpre">)],</span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">,</span><span class="hl_num"><span class="mpre">10</span></span><span class="mpre">)
        </span><a href="#loc_76_1_76_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_14&#39;)"><span class="hl_varref"><span class="mpre">testFileRange</span></span></a><span class="mpre">
            </span><span class="hl_string"><span class="mpre">&quot;does not change status and does not add Content-Range if FileParts means the entire&quot;</span></span><span class="mpre">
            </span><a href="Network.HTTP.Types.Status.html#loc_193_1_193_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_193_1_193_10&#39;)"><span class="hl_varref"><span class="mpre">status200</span></span></a><span class="mpre"> [] </span><span class="hl_string"><span class="mpre">&quot;attic/hex&quot;</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">FilePart</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre">)) </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
            </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="Network.HTTP.Types.Status.html#loc_193_1_193_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_193_1_193_10&#39;)"><span class="hl_varref"><span class="mpre">status200</span></span></a><span class="mpre">,[(</span><span class="hl_string"><span class="mpre">&quot;Content-Length&quot;</span></span><span class="mpre">,</span><span class="hl_string"><span class="mpre">&quot;16&quot;</span></span><span class="mpre">)],</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">,</span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre">)
        </span><a href="#loc_76_1_76_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_14&#39;)"><span class="hl_varref"><span class="mpre">testFileRange</span></span></a><span class="mpre">
            </span><span class="hl_string"><span class="mpre">&quot;gets a file size from file system and handles Range and returns Partical Content&quot;</span></span><span class="mpre">
            </span><a href="Network.HTTP.Types.Status.html#loc_193_1_193_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_193_1_193_10&#39;)"><span class="hl_varref"><span class="mpre">status200</span></span></a><span class="mpre"> [] </span><span class="hl_string"><span class="mpre">&quot;attic/hex&quot;</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;bytes=2-14&quot;</span></span><span class="mpre">)
            </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="Network.HTTP.Types.Status.html#loc_241_1_241_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_241_1_241_10&#39;)"><span class="hl_varref"><span class="mpre">status206</span></span></a><span class="mpre">,[(</span><span class="hl_string"><span class="mpre">&quot;Content-Range&quot;</span></span><span class="mpre">,</span><span class="hl_string"><span class="mpre">&quot;bytes 2-14/16&quot;</span></span><span class="mpre">),(</span><span class="hl_string"><span class="mpre">&quot;Content-Length&quot;</span></span><span class="mpre">,</span><span class="hl_string"><span class="mpre">&quot;13&quot;</span></span><span class="mpre">)],</span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">,</span><span class="hl_num"><span class="mpre">13</span></span><span class="mpre">)
        </span><a href="#loc_76_1_76_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_14&#39;)"><span class="hl_varref"><span class="mpre">testFileRange</span></span></a><span class="mpre">
            </span><span class="hl_string"><span class="mpre">&quot;gets a file size from file system and handles Range and returns OK if Range means the entire&quot;</span></span><span class="mpre">
            </span><a href="Network.HTTP.Types.Status.html#loc_193_1_193_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_193_1_193_10&#39;)"><span class="hl_varref"><span class="mpre">status200</span></span></a><span class="mpre"> [] </span><span class="hl_string"><span class="mpre">&quot;attic/hex&quot;</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;bytes=0-15&quot;</span></span><span class="mpre">)
            </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="Network.HTTP.Types.Status.html#loc_193_1_193_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_193_1_193_10&#39;)"><span class="hl_varref"><span class="mpre">status200</span></span></a><span class="mpre">,[(</span><span class="hl_string"><span class="mpre">&quot;Content-Length&quot;</span></span><span class="mpre">,</span><span class="hl_string"><span class="mpre">&quot;16&quot;</span></span><span class="mpre">)],</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">,</span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre">)
        </span><a href="#loc_76_1_76_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_14&#39;)"><span class="hl_varref"><span class="mpre">testFileRange</span></span></a><span class="mpre">
            </span><span class="hl_string"><span class="mpre">&quot;igores Range if FilePart is specified&quot;</span></span><span class="mpre">
            </span><a href="Network.HTTP.Types.Status.html#loc_193_1_193_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_193_1_193_10&#39;)"><span class="hl_varref"><span class="mpre">status200</span></span></a><span class="mpre"> [] </span><span class="hl_string"><span class="mpre">&quot;attic/hex&quot;</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">FilePart</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">10</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre">)) (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;bytes=8-9&quot;</span></span><span class="mpre">)
            </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="Network.HTTP.Types.Status.html#loc_241_1_241_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_241_1_241_10&#39;)"><span class="hl_varref"><span class="mpre">status206</span></span></a><span class="mpre">,[(</span><span class="hl_string"><span class="mpre">&quot;Content-Range&quot;</span></span><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;bytes 2-11/16&quot;</span></span><span class="mpre">),(</span><span class="hl_string"><span class="mpre">&quot;Content-Length&quot;</span></span><span class="mpre">,</span><span class="hl_string"><span class="mpre">&quot;10&quot;</span></span><span class="mpre">)],</span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">,</span><span class="hl_num"><span class="mpre">10</span></span><span class="mpre">)
</span></div></body></html>