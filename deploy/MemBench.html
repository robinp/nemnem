<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE ForeignFunctionInterface, BangPatterns #-}
module MemBench (memBench) where

import Foreign
import Foreign.C

import Control.Exception
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cereal-0.4.0.1/tests/MemBench.hs&quot;, srcSpanStartLine = 8, srcSpanStartColumn = 8, srcSpanEndLine = 8, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;System.CPUTime&quot;"><span class="mpre">System.CPUTime</span></span><span class="mpre">
import Numeric

</span><a href="#loc_12_1_12_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_1_12_9&#39;)"><span class="mpre">memBench</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_12_1_12_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_1_12_9&#39;)"><span class="hl_fundecl"><span class="mpre">memBench</span></span></a><span class="mpre"> </span><a name="loc_12_10_12_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_10_12_12&#39;)"><span class="hl_vardecl"><span class="mpre">mb</span></span></a><span class="mpre"> = do
  let </span><a name="loc_13_7_13_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_13_7_13_12&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre"> = </span><a href="#loc_12_10_12_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_10_12_12&#39;)"><span class="hl_varref"><span class="mpre">mb</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="hl_infix"><span class="mpre">^</span></span><span class="hl_num"><span class="mpre">20</span></span><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">allocaBytes</span></span><span class="mpre"> </span><a href="#loc_13_7_13_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_13_7_13_12&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_14_24_14_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_14_24_14_27&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> -&gt; do
    let </span><a name="loc_15_9_15_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_9_15_14&#39;)"><span class="hl_fundecl"><span class="mpre">bench</span></span></a><span class="mpre"> </span><a name="loc_15_15_15_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_15_15_20&#39;)"><span class="hl_vardecl"><span class="mpre">label</span></span></a><span class="mpre"> </span><a name="loc_15_21_15_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_21_15_25&#39;)"><span class="hl_vardecl"><span class="mpre">test</span></span></a><span class="mpre"> = do
          </span><a name="loc_16_11_16_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_11_16_18&#39;)"><span class="hl_vardecl"><span class="mpre">seconds</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_81_1_81_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_1_81_5&#39;)"><span class="hl_varref"><span class="mpre">time</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_15_21_15_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_21_15_25&#39;)"><span class="hl_varref"><span class="mpre">test</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_14_24_14_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_14_24_14_27&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_13_7_13_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_13_7_13_12&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">)
          let </span><a name="loc_17_15_17_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_15_17_25&#39;)"><span class="hl_vardecl"><span class="mpre">throughput</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_12_10_12_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_10_12_12&#39;)"><span class="hl_varref"><span class="mpre">mb</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/</span></span><span class="mpre"> </span><a href="#loc_16_11_16_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_11_16_18&#39;)"><span class="hl_varref"><span class="mpre">seconds</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">putStrLn</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_12_10_12_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_12_10_12_12&#39;)"><span class="hl_varref"><span class="mpre">mb</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;MB of &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_15_15_15_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_15_15_20&#39;)"><span class="hl_varref"><span class="mpre">label</span></span></a><span class="mpre">
                  </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; in &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="Numeric.html#loc_182_1_182_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Numeric.html#loc_182_1_182_11&#39;)"><span class="hl_varref"><span class="mpre">showFFloat</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">3</span></span><span class="mpre">) </span><a href="#loc_16_11_16_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_11_16_18&#39;)"><span class="hl_varref"><span class="mpre">seconds</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;s, at: &quot;</span></span><span class="mpre">
                  </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="Numeric.html#loc_182_1_182_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Numeric.html#loc_182_1_182_11&#39;)"><span class="hl_varref"><span class="mpre">showFFloat</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_17_15_17_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_15_17_25&#39;)"><span class="hl_varref"><span class="mpre">throughput</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;MB/s&quot;</span></span><span class="mpre">
    </span><a href="#loc_15_9_15_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_9_15_14&#39;)"><span class="hl_varref"><span class="mpre">bench</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;setup        &quot;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">c_wordwrite</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">putStrLn</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">putStrLn</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;C memory throughput benchmarks:&quot;</span></span><span class="mpre">
    </span><a href="#loc_15_9_15_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_9_15_14&#39;)"><span class="hl_varref"><span class="mpre">bench</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;bytes written&quot;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">c_bytewrite</span></span><span class="mpre">
    </span><a href="#loc_15_9_15_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_9_15_14&#39;)"><span class="hl_varref"><span class="mpre">bench</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;bytes read   &quot;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">c_byteread</span></span><span class="mpre">
    </span><a href="#loc_15_9_15_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_9_15_14&#39;)"><span class="hl_varref"><span class="mpre">bench</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;words written&quot;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">c_wordwrite</span></span><span class="mpre">
    </span><a href="#loc_15_9_15_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_9_15_14&#39;)"><span class="hl_varref"><span class="mpre">bench</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;words read   &quot;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">c_wordread</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">putStrLn</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">putStrLn</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Haskell memory throughput benchmarks:&quot;</span></span><span class="mpre">
    </span><a href="#loc_15_9_15_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_9_15_14&#39;)"><span class="hl_varref"><span class="mpre">bench</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;bytes written&quot;</span></span><span class="mpre"> </span><a href="#loc_36_1_36_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_13&#39;)"><span class="hl_varref"><span class="mpre">hs_bytewrite</span></span></a><span class="mpre">
    </span><a href="#loc_15_9_15_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_9_15_14&#39;)"><span class="hl_varref"><span class="mpre">bench</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;bytes read   &quot;</span></span><span class="mpre"> </span><a href="#loc_44_1_44_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_12&#39;)"><span class="hl_varref"><span class="mpre">hs_byteread</span></span></a><span class="mpre">
    </span><a href="#loc_15_9_15_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_9_15_14&#39;)"><span class="hl_varref"><span class="mpre">bench</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;words written&quot;</span></span><span class="mpre"> </span><a href="#loc_52_1_52_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_13&#39;)"><span class="hl_varref"><span class="mpre">hs_wordwrite</span></span></a><span class="mpre">
    </span><a href="#loc_15_9_15_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_9_15_14&#39;)"><span class="hl_varref"><span class="mpre">bench</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;words read   &quot;</span></span><span class="mpre"> </span><a href="#loc_60_1_60_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_1_60_12&#39;)"><span class="hl_varref"><span class="mpre">hs_wordread</span></span></a><span class="mpre">

</span><a href="#loc_36_1_36_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_13&#39;)"><span class="mpre">hs_bytewrite</span></a><span class="mpre">  :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CUChar</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_36_1_36_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_13&#39;)"><span class="hl_fundecl"><span class="mpre">hs_bytewrite</span></span></a><span class="mpre"> !</span><a name="loc_36_15_36_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_15_36_18&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_36_19_36_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_19_36_24&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre"> = </span><a href="#loc_39_9_39_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_9_39_13&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
  where </span><a name="loc_37_9_37_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_9_37_19&#39;)"><span class="hl_vardecl"><span class="mpre">iterations</span></span></a><span class="mpre"> = </span><a href="#loc_36_19_36_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_19_36_24&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">
        </span><a href="#loc_39_9_39_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_9_39_13&#39;)"><span class="mpre">loop</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">CUChar</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
        </span><a name="loc_39_9_39_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_9_39_13&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> !</span><a name="loc_39_15_39_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_16&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> !</span><a name="loc_39_18_39_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_18_39_19&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> | </span><a href="#loc_39_15_39_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_16&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_37_9_37_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_9_37_19&#39;)"><span class="hl_varref"><span class="mpre">iterations</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
                   | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do </span><span class="hl_varref"><span class="mpre">pokeByteOff</span></span><span class="mpre"> </span><a href="#loc_36_15_36_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_15_36_18&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_39_15_39_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_16&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="#loc_39_18_39_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_18_39_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
                                    </span><a href="#loc_39_9_39_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_9_39_13&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> (</span><a href="#loc_39_15_39_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_15_39_16&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><a href="#loc_39_18_39_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_18_39_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)

</span><a href="#loc_44_1_44_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_12&#39;)"><span class="mpre">hs_byteread</span></a><span class="mpre">  :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CUChar</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CUChar</span></span><span class="mpre">
</span><a name="loc_44_1_44_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_12&#39;)"><span class="hl_fundecl"><span class="mpre">hs_byteread</span></span></a><span class="mpre"> !</span><a name="loc_44_14_44_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_14_44_17&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_44_18_44_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_18_44_23&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre"> = </span><a href="#loc_47_9_47_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_9_47_13&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
  where </span><a name="loc_45_9_45_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_9_45_19&#39;)"><span class="hl_vardecl"><span class="mpre">iterations</span></span></a><span class="mpre"> = </span><a href="#loc_44_18_44_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_18_44_23&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">
        </span><a href="#loc_47_9_47_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_9_47_13&#39;)"><span class="mpre">loop</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">CUChar</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CUChar</span></span><span class="mpre">
        </span><a name="loc_47_9_47_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_9_47_13&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> !</span><a name="loc_47_15_47_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_15_47_16&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> !</span><a name="loc_47_18_47_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_18_47_19&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> | </span><a href="#loc_47_15_47_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_15_47_16&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_45_9_45_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_9_45_19&#39;)"><span class="hl_varref"><span class="mpre">iterations</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_47_18_47_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_18_47_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
                   | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do </span><a name="loc_48_37_48_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_37_48_38&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekByteOff</span></span><span class="mpre"> </span><a href="#loc_44_14_44_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_14_44_17&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_47_15_47_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_15_47_16&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
                                    </span><a href="#loc_47_9_47_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_9_47_13&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> (</span><a href="#loc_47_15_47_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_15_47_16&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><a href="#loc_47_18_47_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_18_47_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_48_37_48_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_37_48_38&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)

</span><a href="#loc_52_1_52_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_13&#39;)"><span class="mpre">hs_wordwrite</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CULong</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_52_1_52_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_13&#39;)"><span class="hl_fundecl"><span class="mpre">hs_wordwrite</span></span></a><span class="mpre"> !</span><a name="loc_52_15_52_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_15_52_18&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_52_19_52_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_19_52_24&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre"> = </span><a href="#loc_55_9_55_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_9_55_13&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
  where </span><a name="loc_53_9_53_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_19&#39;)"><span class="hl_vardecl"><span class="mpre">iterations</span></span></a><span class="mpre"> = </span><a href="#loc_52_19_52_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_19_52_24&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`div`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">CULong</span></span><span class="mpre">)
        </span><a href="#loc_55_9_55_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_9_55_13&#39;)"><span class="mpre">loop</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">CULong</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
        </span><a name="loc_55_9_55_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_9_55_13&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> !</span><a name="loc_55_15_55_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_15_55_16&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> !</span><a name="loc_55_18_55_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_18_55_19&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> | </span><a href="#loc_55_15_55_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_15_55_16&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_53_9_53_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_19&#39;)"><span class="hl_varref"><span class="mpre">iterations</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
                   | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do </span><span class="hl_varref"><span class="mpre">pokeByteOff</span></span><span class="mpre"> </span><a href="#loc_52_15_52_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_15_52_18&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_55_15_55_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_15_55_16&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="#loc_55_18_55_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_18_55_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
                                    </span><a href="#loc_55_9_55_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_9_55_13&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> (</span><a href="#loc_55_15_55_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_15_55_16&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><a href="#loc_55_18_55_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_18_55_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)

</span><a href="#loc_60_1_60_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_1_60_12&#39;)"><span class="mpre">hs_wordread</span></a><span class="mpre">  :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CULong</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CULong</span></span><span class="mpre">
</span><a name="loc_60_1_60_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_1_60_12&#39;)"><span class="hl_fundecl"><span class="mpre">hs_wordread</span></span></a><span class="mpre"> !</span><a name="loc_60_14_60_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_14_60_17&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_60_18_60_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_18_60_23&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre"> = </span><a href="#loc_63_9_63_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_13&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
  where </span><a name="loc_61_9_61_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_9_61_19&#39;)"><span class="hl_vardecl"><span class="mpre">iterations</span></span></a><span class="mpre"> = </span><a href="#loc_60_18_60_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_18_60_23&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`div`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">CULong</span></span><span class="mpre">)
        </span><a href="#loc_63_9_63_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_13&#39;)"><span class="mpre">loop</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">CULong</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CULong</span></span><span class="mpre">
        </span><a name="loc_63_9_63_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_13&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> !</span><a name="loc_63_15_63_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_15_63_16&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> !</span><a name="loc_63_18_63_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_18_63_19&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> | </span><a href="#loc_63_15_63_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_15_63_16&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_61_9_61_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_9_61_19&#39;)"><span class="hl_varref"><span class="mpre">iterations</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_63_18_63_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_18_63_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
                   | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do </span><a name="loc_64_37_64_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_37_64_38&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekByteOff</span></span><span class="mpre"> </span><a href="#loc_60_14_60_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_14_60_17&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_63_15_63_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_15_63_16&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
                                    </span><a href="#loc_63_9_63_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_9_63_13&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> (</span><a href="#loc_63_15_63_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_15_63_16&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><a href="#loc_63_18_63_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_18_63_19&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_64_37_64_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_37_64_38&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">)


</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cereal-0.4.0.1/tests/MemBench.hs&quot;, srcSpanStartLine = 68, srcSpanStartColumn = 1, srcSpanEndLine = 69, srcSpanEndColumn = 44}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cereal-0.4.0.1/tests/MemBench.hs&quot;, srcSpanStartLine = 68, srcSpanStartColumn = 1, srcSpanEndLine = 68, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cereal-0.4.0.1/tests/MemBench.hs&quot;, srcSpanStartLine = 68, srcSpa"><span class="mpre">foreign import ccall unsafe &quot;CBenchmark.h byteread&quot;
  c_byteread :: Ptr CUChar -&gt; CInt -&gt; IO ()</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cereal-0.4.0.1/tests/MemBench.hs&quot;, srcSpanStartLine = 71, srcSpanStartColumn = 1, srcSpanEndLine = 72, srcSpanEndColumn = 45}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cereal-0.4.0.1/tests/MemBench.hs&quot;, srcSpanStartLine = 71, srcSpanStartColumn = 1, srcSpanEndLine = 71, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cereal-0.4.0.1/tests/MemBench.hs&quot;, srcSpanStartLine = 71, srcSpa"><span class="mpre">foreign import ccall unsafe &quot;CBenchmark.h bytewrite&quot;
  c_bytewrite :: Ptr CUChar -&gt; CInt -&gt; IO ()</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cereal-0.4.0.1/tests/MemBench.hs&quot;, srcSpanStartLine = 74, srcSpanStartColumn = 1, srcSpanEndLine = 75, srcSpanEndColumn = 43}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cereal-0.4.0.1/tests/MemBench.hs&quot;, srcSpanStartLine = 74, srcSpanStartColumn = 1, srcSpanEndLine = 74, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cereal-0.4.0.1/tests/MemBench.hs&quot;, srcSpanStartLine = 74, srcSpa"><span class="mpre">foreign import ccall unsafe &quot;CBenchmark.h wordread&quot;
  c_wordread :: Ptr CUInt -&gt; CInt -&gt; IO ()</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cereal-0.4.0.1/tests/MemBench.hs&quot;, srcSpanStartLine = 77, srcSpanStartColumn = 1, srcSpanEndLine = 78, srcSpanEndColumn = 44}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cereal-0.4.0.1/tests/MemBench.hs&quot;, srcSpanStartLine = 77, srcSpanStartColumn = 1, srcSpanEndLine = 77, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cereal-0.4.0.1/tests/MemBench.hs&quot;, srcSpanStartLine = 77, srcSpa"><span class="mpre">foreign import ccall unsafe &quot;CBenchmark.h wordwrite&quot;
  c_wordwrite :: Ptr CUInt -&gt; CInt -&gt; IO ()</span></span><span class="mpre">

</span><a href="#loc_81_1_81_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_1_81_5&#39;)"><span class="mpre">time</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Double</span></span><span class="mpre">
</span><a name="loc_81_1_81_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_1_81_5&#39;)"><span class="hl_fundecl"><span class="mpre">time</span></span></a><span class="mpre"> </span><a name="loc_81_6_81_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_6_81_12&#39;)"><span class="hl_vardecl"><span class="mpre">action</span></span></a><span class="mpre"> = do
    </span><a name="loc_82_5_82_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_5_82_10&#39;)"><span class="hl_vardecl"><span class="mpre">start</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getCPUTime</span></span><span class="mpre">
    </span><a href="#loc_81_6_81_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_6_81_12&#39;)"><span class="hl_varref"><span class="mpre">action</span></span></a><span class="mpre">
    </span><a name="loc_84_5_84_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_5_84_8&#39;)"><span class="hl_vardecl"><span class="mpre">end</span></span></a><span class="mpre">   &lt;- </span><span class="hl_varref"><span class="mpre">getCPUTime</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_84_5_84_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_5_84_8&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_82_5_82_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_5_82_10&#39;)"><span class="hl_varref"><span class="mpre">start</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">/</span></span><span class="mpre"> (</span><span class="hl_num"><span class="mpre">10</span></span><span class="hl_infix"><span class="mpre">^</span></span><span class="hl_num"><span class="mpre">12</span></span><span class="mpre">)
</span></div></body></html>