<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE BangPatterns, ScopedTypeVariables #-}

</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Data.Text.Internal.Search</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   : (c) Bryan O&#39;Sullivan 2009</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : bos@serpentine.com</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : GHC</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Fast substring search for &#39;Text&#39;, based on work by Boyer, Moore,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Horspool, Sunday, and Lundh.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- References:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * R. S. Boyer, J. S. Moore: A Fast String Searching Algorithm.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   Communications of the ACM, 20, 10, 762-772 (1977)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * R. N. Horspool: Practical Fast Searching in Strings.  Software -</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   Practice and Experience 10, 501-506 (1980)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * D. M. Sunday: A Very Fast Substring Search Algorithm.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   Communications of the ACM, 33, 8, 132-142 (1990)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * F. Lundh: The Fast Search Algorithm.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   &lt;http://effbot.org/zone/stringlib.htm&gt; (2006)</span></span><span class="mpre">

module Data.Text.Internal.Search
    (
      indices
    ) where

import qualified Data.Text.Array as A
import Data.Word (Word64)
import Data.Text.Internal (</span><a href="Data.Text.Internal.html#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_6_50_10&#39;)"><span class="mpre">Text</span></a><span class="mpre">(..))
import Data.Bits ((.|.), (.&amp;.))
import Data.Text.Internal.Unsafe.Shift (</span><a href="Data.Text.Internal.Unsafe.Shift.html#loc_34_5_34_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Unsafe.Shift.html#loc_34_5_34_11&#39;)"><span class="mpre">shiftL</span></a><span class="mpre">)

data </span><span class="hl_tycondecl"><span class="mpre">T</span></span><span class="mpre"> = {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">Word64</span></span><span class="mpre"> </span><a name="loc_40_33_40_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_33_40_35&#39;)"><span class="hl_condecl"><span class="mpre">:*</span></span></a><span class="mpre"> {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(n+m)/ Find the offsets of all non-overlapping indices of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @needle@ within @haystack@.  The offsets returned represent</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- uncorrected indices in the low-level \&quot;needle\&quot; array, to which its</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- offset must be added.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- In (unlikely) bad cases, this algorithm&#39;s complexity degrades</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- towards /O(n*m)/.</span></span><span class="mpre">
</span><a href="#loc_52_1_52_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_8&#39;)"><span class="mpre">indices</span></a><span class="mpre"> :: </span><a href="Data.Text.Internal.html#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre">                </span><span class="hl_comment"><span class="mpre">-- ^ Substring to search for (@needle@)</span></span><span class="mpre">
        -&gt; </span><a href="Data.Text.Internal.html#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">Text</span></span></a><span class="mpre">                </span><span class="hl_comment"><span class="mpre">-- ^ Text to search in (@haystack@)</span></span><span class="mpre">
        -&gt; [</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">]
</span><a name="loc_52_1_52_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_8&#39;)"><span class="hl_fundecl"><span class="mpre">indices</span></span></a><span class="mpre"> </span><span class="hl_specname"><span class="mpre">_needle</span></span><span class="mpre">@(</span><a href="Data.Text.Internal.html#loc_50_13_50_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_13_50_17&#39;)"><span class="hl_conref"><span class="mpre">Text</span></span></a><span class="mpre"> </span><a name="loc_52_23_52_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_23_52_27&#39;)"><span class="hl_vardecl"><span class="mpre">narr</span></span></a><span class="mpre"> </span><a name="loc_52_28_52_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_28_52_32&#39;)"><span class="hl_vardecl"><span class="mpre">noff</span></span></a><span class="mpre"> </span><a name="loc_52_33_52_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_33_52_37&#39;)"><span class="hl_vardecl"><span class="mpre">nlen</span></span></a><span class="mpre">) </span><span class="hl_specname"><span class="mpre">_haystack</span></span><span class="mpre">@(</span><a href="Data.Text.Internal.html#loc_50_13_50_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_13_50_17&#39;)"><span class="hl_conref"><span class="mpre">Text</span></span></a><span class="mpre"> </span><a name="loc_52_55_52_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_55_52_59&#39;)"><span class="hl_vardecl"><span class="mpre">harr</span></span></a><span class="mpre"> </span><a name="loc_52_60_52_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_60_52_64&#39;)"><span class="hl_vardecl"><span class="mpre">hoff</span></span></a><span class="mpre"> </span><a name="loc_52_65_52_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_65_52_69&#39;)"><span class="hl_vardecl"><span class="mpre">hlen</span></span></a><span class="mpre">)
    | </span><a href="#loc_52_33_52_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_33_52_37&#39;)"><span class="hl_varref"><span class="mpre">nlen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">              = </span><a href="#loc_85_5_85_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_5_85_12&#39;)"><span class="hl_varref"><span class="mpre">scanOne</span></span></a><span class="mpre"> (</span><a href="#loc_60_5_60_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_5_60_11&#39;)"><span class="hl_varref"><span class="mpre">nindex</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">)
    | </span><a href="#loc_52_33_52_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_33_52_37&#39;)"><span class="hl_varref"><span class="mpre">nlen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><a href="#loc_57_5_57_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_5_57_10&#39;)"><span class="hl_varref"><span class="mpre">ldiff</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = []
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">              = </span><a href="#loc_71_5_71_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_5_71_9&#39;)"><span class="hl_varref"><span class="mpre">scan</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
  where
    </span><a name="loc_57_5_57_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_5_57_10&#39;)"><span class="hl_vardecl"><span class="mpre">ldiff</span></span></a><span class="mpre">    = </span><a href="#loc_52_65_52_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_65_52_69&#39;)"><span class="hl_varref"><span class="mpre">hlen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_52_33_52_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_33_52_37&#39;)"><span class="hl_varref"><span class="mpre">nlen</span></span></a><span class="mpre">
    </span><a name="loc_58_5_58_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_5_58_10&#39;)"><span class="hl_vardecl"><span class="mpre">nlast</span></span></a><span class="mpre">    = </span><a href="#loc_52_33_52_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_33_52_37&#39;)"><span class="hl_varref"><span class="mpre">nlen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
    </span><a name="loc_59_5_59_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_5_59_6&#39;)"><span class="hl_vardecl"><span class="mpre">z</span></span></a><span class="mpre">        = </span><a href="#loc_60_5_60_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_5_60_11&#39;)"><span class="hl_varref"><span class="mpre">nindex</span></span></a><span class="mpre"> </span><a href="#loc_58_5_58_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_5_58_10&#39;)"><span class="hl_varref"><span class="mpre">nlast</span></span></a><span class="mpre">
    </span><a name="loc_60_5_60_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_5_60_11&#39;)"><span class="hl_fundecl"><span class="mpre">nindex</span></span></a><span class="mpre"> </span><a name="loc_60_12_60_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_12_60_13&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = </span><a href="Data.Text.Array.html#loc_150_1_150_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Array.html#loc_150_1_150_12&#39;)"><span class="hl_varref"><span class="mpre">A.unsafeIndex</span></span></a><span class="mpre"> </span><a href="#loc_52_23_52_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_23_52_27&#39;)"><span class="hl_varref"><span class="mpre">narr</span></span></a><span class="mpre"> (</span><a href="#loc_52_28_52_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_28_52_32&#39;)"><span class="hl_varref"><span class="mpre">noff</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_60_12_60_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_12_60_13&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)
    </span><a name="loc_61_5_61_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_5_61_11&#39;)"><span class="hl_fundecl"><span class="mpre">hindex</span></span></a><span class="mpre"> </span><a name="loc_61_12_61_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_12_61_13&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = </span><a href="Data.Text.Array.html#loc_150_1_150_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Array.html#loc_150_1_150_12&#39;)"><span class="hl_varref"><span class="mpre">A.unsafeIndex</span></span></a><span class="mpre"> </span><a href="#loc_52_55_52_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_55_52_59&#39;)"><span class="hl_varref"><span class="mpre">harr</span></span></a><span class="mpre"> (</span><a href="#loc_52_60_52_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_60_52_64&#39;)"><span class="hl_varref"><span class="mpre">hoff</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_61_12_61_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_12_61_13&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)
    </span><a name="loc_62_5_62_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_5_62_12&#39;)"><span class="hl_fundecl"><span class="mpre">hindex&#39;</span></span></a><span class="mpre"> </span><a name="loc_62_13_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_13_62_14&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> | </span><a href="#loc_62_13_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_13_62_14&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_52_65_52_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_65_52_69&#39;)"><span class="hl_varref"><span class="mpre">hlen</span></span></a><span class="mpre">  = </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
              | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="Data.Text.Array.html#loc_150_1_150_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Array.html#loc_150_1_150_12&#39;)"><span class="hl_varref"><span class="mpre">A.unsafeIndex</span></span></a><span class="mpre"> </span><a href="#loc_52_55_52_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_55_52_59&#39;)"><span class="hl_varref"><span class="mpre">harr</span></span></a><span class="mpre"> (</span><a href="#loc_52_60_52_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_60_52_64&#39;)"><span class="hl_varref"><span class="mpre">hoff</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_62_13_62_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_13_62_14&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)
    </span><a name="loc_64_5_64_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_15&#39;)"><span class="hl_fundecl"><span class="mpre">buildTable</span></span></a><span class="mpre"> !</span><a name="loc_64_17_64_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_17_64_18&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> !</span><a name="loc_64_20_64_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_20_64_23&#39;)"><span class="hl_vardecl"><span class="mpre">msk</span></span></a><span class="mpre"> !</span><a name="loc_64_25_64_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_25_64_28&#39;)"><span class="hl_vardecl"><span class="mpre">skp</span></span></a><span class="mpre">
        | </span><a href="#loc_64_17_64_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_17_64_18&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="#loc_58_5_58_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_5_58_10&#39;)"><span class="hl_varref"><span class="mpre">nlast</span></span></a><span class="mpre">           = (</span><a href="#loc_64_20_64_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_20_64_23&#39;)"><span class="hl_varref"><span class="mpre">msk</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_70_5_70_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_5_70_12&#39;)"><span class="hl_varref"><span class="mpre">swizzle</span></span></a><span class="mpre"> </span><a href="#loc_59_5_59_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_5_59_6&#39;)"><span class="hl_varref"><span class="mpre">z</span></span></a><span class="mpre">) </span><a href="#loc_40_33_40_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_33_40_35&#39;)"><span class="hl_infix"><span class="mpre">:*</span></span></a><span class="mpre"> </span><a href="#loc_64_25_64_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_25_64_28&#39;)"><span class="hl_varref"><span class="mpre">skp</span></span></a><span class="mpre">
        | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">            = </span><a href="#loc_64_5_64_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_15&#39;)"><span class="hl_varref"><span class="mpre">buildTable</span></span></a><span class="mpre"> (</span><a href="#loc_64_17_64_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_17_64_18&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><a href="#loc_64_20_64_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_20_64_23&#39;)"><span class="hl_varref"><span class="mpre">msk</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><a href="#loc_70_5_70_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_5_70_12&#39;)"><span class="hl_varref"><span class="mpre">swizzle</span></span></a><span class="mpre"> </span><a href="#loc_67_15_67_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_15_67_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">) </span><a href="#loc_68_15_68_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_15_68_19&#39;)"><span class="hl_varref"><span class="mpre">skp&#39;</span></span></a><span class="mpre">
        where </span><a name="loc_67_15_67_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_15_67_16&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre">                = </span><a href="#loc_60_5_60_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_5_60_11&#39;)"><span class="hl_varref"><span class="mpre">nindex</span></span></a><span class="mpre"> </span><a href="#loc_64_17_64_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_17_64_18&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
              </span><a name="loc_68_15_68_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_15_68_19&#39;)"><span class="hl_vardecl"><span class="mpre">skp&#39;</span></span></a><span class="mpre"> | </span><a href="#loc_67_15_67_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_15_67_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_59_5_59_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_5_59_6&#39;)"><span class="hl_varref"><span class="mpre">z</span></span></a><span class="mpre">    = </span><a href="#loc_52_33_52_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_33_52_37&#39;)"><span class="hl_varref"><span class="mpre">nlen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_64_17_64_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_17_64_18&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">
                   | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="#loc_64_25_64_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_25_64_28&#39;)"><span class="hl_varref"><span class="mpre">skp</span></span></a><span class="mpre">
    </span><a name="loc_70_5_70_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_5_70_12&#39;)"><span class="hl_fundecl"><span class="mpre">swizzle</span></span></a><span class="mpre"> </span><a name="loc_70_13_70_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_13_70_14&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><a href="Data.Text.Internal.Unsafe.Shift.html#loc_34_5_34_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Unsafe.Shift.html#loc_34_5_34_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftL`</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_70_13_70_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_13_70_14&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x3f</span></span><span class="mpre">)
    </span><a name="loc_71_5_71_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_5_71_9&#39;)"><span class="hl_fundecl"><span class="mpre">scan</span></span></a><span class="mpre"> !</span><a name="loc_71_11_71_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_12&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">
        | </span><a href="#loc_71_11_71_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_12&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><a href="#loc_57_5_57_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_5_57_10&#39;)"><span class="hl_varref"><span class="mpre">ldiff</span></span></a><span class="mpre">                  = []
        | </span><a href="#loc_75_15_75_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_15_75_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_59_5_59_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_5_59_6&#39;)"><span class="hl_varref"><span class="mpre">z</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_76_15_76_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_15_76_29&#39;)"><span class="hl_varref"><span class="mpre">candidateMatch</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><a href="#loc_71_11_71_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_12&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_71_5_71_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_5_71_9&#39;)"><span class="hl_varref"><span class="mpre">scan</span></span></a><span class="mpre"> (</span><a href="#loc_71_11_71_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_12&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_52_33_52_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_33_52_37&#39;)"><span class="hl_varref"><span class="mpre">nlen</span></span></a><span class="mpre">)
        | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">                  = </span><a href="#loc_71_5_71_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_5_71_9&#39;)"><span class="hl_varref"><span class="mpre">scan</span></span></a><span class="mpre"> (</span><a href="#loc_71_11_71_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_12&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_80_15_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_15_80_20&#39;)"><span class="hl_varref"><span class="mpre">delta</span></span></a><span class="mpre">)
        where </span><a name="loc_75_15_75_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_15_75_16&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = </span><a href="#loc_61_5_61_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_5_61_11&#39;)"><span class="hl_varref"><span class="mpre">hindex</span></span></a><span class="mpre"> (</span><a href="#loc_71_11_71_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_12&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_58_5_58_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_5_58_10&#39;)"><span class="hl_varref"><span class="mpre">nlast</span></span></a><span class="mpre">)
              </span><a name="loc_76_15_76_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_15_76_29&#39;)"><span class="hl_fundecl"><span class="mpre">candidateMatch</span></span></a><span class="mpre"> !</span><a name="loc_76_31_76_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_31_76_32&#39;)"><span class="hl_vardecl"><span class="mpre">j</span></span></a><span class="mpre">
                    | </span><a href="#loc_76_31_76_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_31_76_32&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="#loc_58_5_58_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_5_58_10&#39;)"><span class="hl_varref"><span class="mpre">nlast</span></span></a><span class="mpre">               = </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
                    | </span><a href="#loc_61_5_61_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_5_61_11&#39;)"><span class="hl_varref"><span class="mpre">hindex</span></span></a><span class="mpre"> (</span><a href="#loc_71_11_71_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_12&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_76_31_76_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_31_76_32&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="#loc_60_5_60_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_5_60_11&#39;)"><span class="hl_varref"><span class="mpre">nindex</span></span></a><span class="mpre"> </span><a href="#loc_76_31_76_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_31_76_32&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
                    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">                = </span><a href="#loc_76_15_76_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_15_76_29&#39;)"><span class="hl_varref"><span class="mpre">candidateMatch</span></span></a><span class="mpre"> (</span><a href="#loc_76_31_76_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_31_76_32&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
              </span><a name="loc_80_15_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_15_80_20&#39;)"><span class="hl_vardecl"><span class="mpre">delta</span></span></a><span class="mpre"> | </span><a href="#loc_83_23_83_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_23_83_36&#39;)"><span class="hl_varref"><span class="mpre">nextInPattern</span></span></a><span class="mpre"> = </span><a href="#loc_52_33_52_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_33_52_37&#39;)"><span class="hl_varref"><span class="mpre">nlen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
                    | </span><a href="#loc_75_15_75_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_15_75_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_59_5_59_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_5_59_6&#39;)"><span class="hl_varref"><span class="mpre">z</span></span></a><span class="mpre">        = </span><a href="#loc_84_25_84_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_25_84_29&#39;)"><span class="hl_varref"><span class="mpre">skip</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
                    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">     = </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
                where </span><a name="loc_83_23_83_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_23_83_36&#39;)"><span class="hl_vardecl"><span class="mpre">nextInPattern</span></span></a><span class="mpre"> = </span><a href="#loc_84_17_84_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_17_84_21&#39;)"><span class="hl_varref"><span class="mpre">mask</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><a href="#loc_70_5_70_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_5_70_12&#39;)"><span class="hl_varref"><span class="mpre">swizzle</span></span></a><span class="mpre"> (</span><a href="#loc_62_5_62_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_5_62_12&#39;)"><span class="hl_varref"><span class="mpre">hindex&#39;</span></span></a><span class="mpre"> (</span><a href="#loc_71_11_71_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_12&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_52_33_52_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_33_52_37&#39;)"><span class="hl_varref"><span class="mpre">nlen</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
              !(</span><a name="loc_84_17_84_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_17_84_21&#39;)"><span class="hl_vardecl"><span class="mpre">mask</span></span></a><span class="mpre"> </span><a href="#loc_40_33_40_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_33_40_35&#39;)"><span class="hl_infix"><span class="mpre">:*</span></span></a><span class="mpre"> </span><a name="loc_84_25_84_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_25_84_29&#39;)"><span class="hl_vardecl"><span class="mpre">skip</span></span></a><span class="mpre">)       = </span><a href="#loc_64_5_64_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_5_64_15&#39;)"><span class="hl_varref"><span class="mpre">buildTable</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> (</span><a href="#loc_52_33_52_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_33_52_37&#39;)"><span class="hl_varref"><span class="mpre">nlen</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">)
    </span><a name="loc_85_5_85_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_5_85_12&#39;)"><span class="hl_fundecl"><span class="mpre">scanOne</span></span></a><span class="mpre"> </span><a name="loc_85_13_85_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_13_85_14&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = </span><a href="#loc_86_15_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_15_86_19&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
        where </span><a name="loc_86_15_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_15_86_19&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> !</span><a name="loc_86_21_86_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_21_86_22&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> | </span><a href="#loc_86_21_86_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_21_86_22&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="#loc_52_65_52_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_65_52_69&#39;)"><span class="hl_varref"><span class="mpre">hlen</span></span></a><span class="mpre">     = []
                      | </span><a href="#loc_61_5_61_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_5_61_11&#39;)"><span class="hl_varref"><span class="mpre">hindex</span></span></a><span class="mpre"> </span><a href="#loc_86_21_86_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_21_86_22&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_85_13_85_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_13_85_14&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> = </span><a href="#loc_86_21_86_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_21_86_22&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_86_15_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_15_86_19&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> (</span><a href="#loc_86_21_86_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_21_86_22&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
                      | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">     = </span><a href="#loc_86_15_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_15_86_19&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> (</span><a href="#loc_86_21_86_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_21_86_22&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_52_1_52_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_8&#39;)"><span class="mpre">indices</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span></div></body></html>