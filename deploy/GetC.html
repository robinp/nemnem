<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# OPTIONS -fglasgow-exts #-}
{-# LANGUAGE OverlappingInstances, UndecidableInstances #-}

module GetC (tests) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 6, srcSpanStartColumn = 8, srcSpanEndLine = 6, srcSpanEndColumn = 18}, srcInfoPoints = []}) &quot;Test.HUnit&quot;"><span class="mpre">Test.HUnit</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-

Ralf Laemmel, 5 November 2004 

Joe Stoy suggested the idiom to test for the outermost constructor.

Given is a term t
and a constructor f (say the empty constructor application).

isC f t returns True if the outermost constructor of t is f.
isC f t returns False otherwise.
Modulo type checking, i.e., the data type of f and t must be the same.
If not, we want to see a type error, of course.

-}</span></span><span class="mpre">

import Data.Typeable  </span><span class="hl_comment"><span class="mpre">-- to cast t&#39;s subterms, which will be reused for f.</span></span><span class="mpre">
import Data.Generics  </span><span class="hl_comment"><span class="mpre">-- to access t&#39;s subterms and constructors.</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- Some silly data types</span></span><span class="mpre">
data </span><span class="hl_tycondecl"><span class="mpre">T1</span></span><span class="mpre"> = </span><a name="loc_29_11_29_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_11_29_14&#39;)"><span class="hl_condecl"><span class="mpre">T1a</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> | </span><a name="loc_29_28_29_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_28_29_31&#39;)"><span class="hl_condecl"><span class="mpre">T1b</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">     </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 29, srcSpanStartColumn = 47, srcSpanEndLine = 29, srcSpanEndColumn = 72}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 29, srcSpanStartColumn = 47, srcSpanEndLine = 29, srcSpanEndColumn = 55},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 29, srcSpanStartColumn = 56, src"><span class="mpre">deriving (Typeable, Data)</span></span><span class="mpre">
data </span><span class="hl_tycondecl"><span class="mpre">T2</span></span><span class="mpre"> = </span><span class="hl_condecl"><span class="mpre">T2a</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">    | </span><span class="hl_condecl"><span class="mpre">T2b</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">  </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 30, srcSpanStartColumn = 47, srcSpanEndLine = 30, srcSpanEndColumn = 72}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 30, srcSpanStartColumn = 47, srcSpanEndLine = 30, srcSpanEndColumn = 55},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 30, srcSpanStartColumn = 56, src"><span class="mpre">deriving (Typeable, Data)</span></span><span class="mpre">
data </span><span class="hl_tycondecl"><span class="mpre">T3</span></span><span class="mpre"> = </span><a name="loc_31_11_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_13&#39;)"><span class="hl_condecl"><span class="mpre">T3</span></span></a><span class="mpre">! </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">                             </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 31, srcSpanStartColumn = 47, srcSpanEndLine = 31, srcSpanEndColumn = 72}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 31, srcSpanStartColumn = 47, srcSpanEndLine = 31, srcSpanEndColumn = 55},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 31, srcSpanStartColumn = 56, src"><span class="mpre">deriving (Typeable, Data)</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- Test cases</span></span><span class="mpre">
</span><a name="loc_35_1_35_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_1_35_6&#39;)"><span class="hl_vardecl"><span class="mpre">tests</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> [ </span><a href="#loc_53_1_53_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_4&#39;)"><span class="hl_varref"><span class="mpre">isC</span></span></a><span class="mpre"> </span><a href="#loc_29_11_29_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_11_29_14&#39;)"><span class="hl_conref"><span class="mpre">T1a</span></span></a><span class="mpre"> (</span><a href="#loc_29_11_29_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_11_29_14&#39;)"><span class="hl_conref"><span class="mpre">T1a</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;foo&quot;</span></span><span class="mpre">)   </span><span class="hl_comment"><span class="mpre">-- typechecks, returns True</span></span><span class="mpre">
             , </span><a href="#loc_53_1_53_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_4&#39;)"><span class="hl_varref"><span class="mpre">isC</span></span></a><span class="mpre"> </span><a href="#loc_29_11_29_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_11_29_14&#39;)"><span class="hl_conref"><span class="mpre">T1a</span></span></a><span class="mpre"> (</span><a href="#loc_29_28_29_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_28_29_31&#39;)"><span class="hl_conref"><span class="mpre">T1b</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;foo&quot;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)   </span><span class="hl_comment"><span class="mpre">-- typechecks, returns False</span></span><span class="mpre">
             , </span><a href="#loc_53_1_53_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_4&#39;)"><span class="hl_varref"><span class="mpre">isC</span></span></a><span class="mpre"> </span><a href="#loc_31_11_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_13&#39;)"><span class="hl_conref"><span class="mpre">T3</span></span></a><span class="mpre">  (</span><a href="#loc_31_11_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_13&#39;)"><span class="hl_conref"><span class="mpre">T3</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">42</span></span><span class="mpre">)]        </span><span class="hl_comment"><span class="mpre">-- works for strict data too</span></span><span class="mpre">
        </span><span class="hl_infix"><span class="mpre">~=?</span></span><span class="mpre"> </span><a href="#loc_41_1_41_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_7&#39;)"><span class="hl_varref"><span class="mpre">output</span></span></a><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- err = show $ isC T2b (T1b &quot;foo&quot; 1)  -- must not typecheck</span></span><span class="mpre">

</span><a name="loc_41_1_41_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_7&#39;)"><span class="hl_vardecl"><span class="mpre">output</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> [</span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">,</span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">,</span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">]

</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- We look at a datum a.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- We look at a constructor function f.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The class GetT checks that f constructs data of type a.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The class GetC computes maybe the constructor ...</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ... if the subterms of the datum at hand fit for f.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Finally we compare the constructors.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">

</span><a href="#loc_53_1_53_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_4&#39;)"><span class="mpre">isC</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxTuple (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 52, srcSpanStartColumn = 8, srcSpanEndLine = 52, srcSpanEndColumn = 37}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 52, srcSpanStartColumn = 8, srcSpanEndLine = 52, srcSpanEndColumn = 9},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 52, srcSpanStartColumn = 15, srcSpan"><span class="mpre">(Data a, GetT f a, GetC f) =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">f</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_53_1_53_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_4&#39;)"><span class="hl_fundecl"><span class="mpre">isC</span></span></a><span class="mpre"> </span><a name="loc_53_5_53_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_5_53_6&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_53_7_53_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_7_53_8&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">(==)</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">toConstr</span></span><span class="mpre"> </span><a href="#loc_53_7_53_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_7_53_8&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">)) </span><a href="#loc_56_3_56_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_3_56_6&#39;)"><span class="hl_varref"><span class="mpre">con</span></span></a><span class="mpre">
 where
  </span><a name="loc_55_3_55_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_3_55_7&#39;)"><span class="hl_vardecl"><span class="mpre">kids</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">gmapQ</span></span><span class="mpre"> </span><a href="#loc_64_43_64_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_43_64_53&#39;)"><span class="hl_conref"><span class="mpre">ExTypeable</span></span></a><span class="mpre"> </span><a href="#loc_53_7_53_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_7_53_8&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- homogenify subterms in list for reuse</span></span><span class="mpre">
  </span><a name="loc_56_3_56_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_3_56_6&#39;)"><span class="hl_vardecl"><span class="mpre">con</span></span></a><span class="mpre">  = </span><a href="#loc_86_3_86_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_3_86_7&#39;)"><span class="hl_varref"><span class="mpre">getC</span></span></a><span class="mpre"> </span><a href="#loc_53_5_53_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_5_53_6&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_55_3_55_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_3_55_7&#39;)"><span class="hl_varref"><span class="mpre">kids</span></span></a><span class="mpre">        </span><span class="hl_comment"><span class="mpre">-- compute constructor from constructor application</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- We prepare for a list of kids using existential envelopes.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- We could also just operate on TypeReps for non-strict datatypes.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">

data </span><a name="loc_64_6_64_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_6_64_16&#39;)"><span class="hl_tycondecl"><span class="mpre">ExTypeable</span></span></a><span class="mpre"> = forall a. Typeable a =&gt; </span><a name="loc_64_43_64_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_43_64_53&#39;)"><span class="hl_condecl"><span class="mpre">ExTypeable</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_65_1_65_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_1_65_13&#39;)"><span class="hl_fundecl"><span class="mpre">unExTypeable</span></span></a><span class="mpre"> (</span><a href="#loc_64_43_64_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_43_64_53&#39;)"><span class="hl_conref"><span class="mpre">ExTypeable</span></span></a><span class="mpre"> </span><a name="loc_65_26_65_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_26_65_27&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">) = </span><a href="Data.Typeable.html#loc_112_1_112_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Typeable.html#loc_112_1_112_5&#39;)"><span class="hl_varref"><span class="mpre">cast</span></span></a><span class="mpre"> </span><a href="#loc_65_26_65_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_26_65_27&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Compute the result type of a function type.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Beware: the TypeUnify constraint causes headache.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- We can&#39;t have GetT t t because the FD will be violated then.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- We can&#39;t omit the FD because unresolvable overlapping will hold then. </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">

class </span><a name="loc_75_7_75_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_7_75_11&#39;)"><span class="hl_classdecl"><span class="mpre">GetT</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">f</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">t</span></span><span class="mpre"> | </span><span class="warning" data-warning="FundepFunDep (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 75, srcSpanStartColumn = 18, srcSpanEndLine = 75, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 75, srcSpanStartColumn = 20, srcSpanEndLine = 75, srcSpanEndColumn = 22}]}) [Ident (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLin"><span class="mpre">f -&gt; t</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- FD is optional</span></span><span class="mpre">
instance </span><span class="warning" data-warning="InstDecl ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 76, srcSpanStartColumn = 10, srcSpanEndLine = 76, srcSpanEndColumn = 21}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 76, srcSpanStartColumn = 19, srcSpanEndLine = 76, srcSpanEndColumn = 21}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStart"><span class="mpre">GetT g t =&gt;</span></span><span class="mpre"> </span><a href="#loc_75_7_75_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_7_75_11&#39;)"><span class="hl_classref"><span class="mpre">GetT</span></span></a><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">x</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">t</span></span><span class="mpre">
instance </span><span class="warning" data-warning="InstDecl ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 77, srcSpanStartColumn = 10, srcSpanEndLine = 77, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 77, srcSpanStartColumn = 25, srcSpanEndLine = 77, srcSpanEndColumn = 27}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStart"><span class="mpre">TypeUnify t t&#39; =&gt;</span></span><span class="mpre"> </span><a href="#loc_75_7_75_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_7_75_11&#39;)"><span class="hl_classref"><span class="mpre">GetT</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">t</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">t&#39;</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Obtain the constructor if term can be completed</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  </span></span><span class="mpre">

class </span><a name="loc_84_7_84_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_7_84_11&#39;)"><span class="hl_classdecl"><span class="mpre">GetC</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">f</span></span><span class="mpre">
 where
  </span><a name="loc_86_3_86_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_3_86_7&#39;)"><span class="mpre">getC</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">f</span></span><span class="mpre"> -&gt; [</span><a href="#loc_64_6_64_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_6_64_16&#39;)"><span class="hl_tyconref"><span class="mpre">ExTypeable</span></span></a><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Constr</span></span><span class="mpre">

instance </span><span class="warning" data-warning="InstDecl ContextCxTuple (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 88, srcSpanStartColumn = 10, srcSpanEndLine = 88, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 88, srcSpanStartColumn = 10, srcSpanEndLine = 88, srcSpanEndColumn = 11},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 88, srcSpanStartColumn = 21, srcS"><span class="mpre">(Typeable x, GetC g) =&gt;</span></span><span class="mpre"> </span><a href="#loc_84_7_84_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_7_84_11&#39;)"><span class="hl_classref"><span class="mpre">GetC</span></span></a><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">x</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">)
 where
  </span><a href="#loc_86_3_86_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_3_86_7&#39;)"><span class="hl_fundecl"><span class="mpre">getC</span></span></a><span class="mpre"> _ [] = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
  </span><a href="#loc_86_3_86_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_3_86_7&#39;)"><span class="hl_fundecl"><span class="mpre">getC</span></span></a><span class="mpre"> (</span><a name="loc_91_9_91_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_9_91_10&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre">::</span><span class="hl_tyvar"><span class="mpre">x</span></span><span class="mpre">-&gt;</span><span class="hl_tyvar"><span class="mpre">g</span></span><span class="mpre">) (</span><a name="loc_91_19_91_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_19_91_20&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_91_21_91_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_21_91_22&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre">)
    =
      do
         (</span><a name="loc_94_11_94_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_11_94_12&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">::</span><span class="hl_tyvar"><span class="mpre">x</span></span><span class="mpre">) &lt;- </span><a href="#loc_65_1_65_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_1_65_13&#39;)"><span class="hl_varref"><span class="mpre">unExTypeable</span></span></a><span class="mpre"> </span><a href="#loc_91_19_91_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_19_91_20&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
         </span><a href="#loc_86_3_86_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_3_86_7&#39;)"><span class="hl_varref"><span class="mpre">getC</span></span></a><span class="mpre"> (</span><a href="#loc_91_9_91_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_9_91_10&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_94_11_94_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_11_94_12&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) </span><a href="#loc_91_21_91_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_21_91_22&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">

instance </span><span class="warning" data-warning="InstDecl ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 97, srcSpanStartColumn = 10, srcSpanEndLine = 97, srcSpanEndColumn = 19}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 97, srcSpanStartColumn = 17, srcSpanEndLine = 97, srcSpanEndColumn = 19}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStart"><span class="mpre">Data t =&gt;</span></span><span class="mpre"> </span><a href="#loc_84_7_84_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_7_84_11&#39;)"><span class="hl_classref"><span class="mpre">GetC</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">t</span></span><span class="mpre">
 where
  </span><a href="#loc_86_3_86_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_3_86_7&#39;)"><span class="hl_fundecl"><span class="mpre">getC</span></span></a><span class="mpre"> </span><a name="loc_99_8_99_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_8_99_9&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre"> []    = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">toConstr</span></span><span class="mpre"> </span><a href="#loc_99_8_99_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_8_99_9&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre">
  </span><a href="#loc_86_3_86_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_3_86_7&#39;)"><span class="hl_fundecl"><span class="mpre">getC</span></span></a><span class="mpre"> _ (_</span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_) = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Type unification; we could try this:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  class TypeUnify a b | a -&gt; b, b -&gt; a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  instance TypeUnify a a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- However, if the instance is placed in the present module,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- then type improvement would inline this instance. Sigh!!!</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- So we need type unification with type improvement blocker</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The following solution works with GHC for ages.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Other solutions; see the HList paper.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">

class    </span><a name="loc_116_10_116_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_10_116_19&#39;)"><span class="hl_classdecl"><span class="mpre">TypeUnify</span></span></a><span class="mpre">   </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">  </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">   |    </span><span class="warning" data-warning="FundepFunDep (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 116, srcSpanStartColumn = 34, srcSpanEndLine = 116, srcSpanEndColumn = 40}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 116, srcSpanStartColumn = 36, srcSpanEndLine = 116, srcSpanEndColumn = 38}]}) [Ident (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStar"><span class="mpre">a -&gt; b</span></span><span class="mpre">,   </span><span class="warning" data-warning="FundepFunDep (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 116, srcSpanStartColumn = 44, srcSpanEndLine = 116, srcSpanEndColumn = 50}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 116, srcSpanStartColumn = 46, srcSpanEndLine = 116, srcSpanEndColumn = 48}]}) [Ident (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStar"><span class="mpre">b -&gt; a</span></span><span class="mpre">
class    </span><a name="loc_117_10_117_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_10_117_20&#39;)"><span class="hl_classdecl"><span class="mpre">TypeUnify&#39;</span></span></a><span class="mpre">  </span><span class="hl_tyvar"><span class="mpre">x</span></span><span class="mpre">  </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> |  </span><span class="warning" data-warning="FundepFunDep (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 117, srcSpanStartColumn = 32, srcSpanEndLine = 117, srcSpanEndColumn = 40}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 117, srcSpanStartColumn = 36, srcSpanEndLine = 117, srcSpanEndColumn = 38}]}) [Ident (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStar"><span class="mpre">x a -&gt; b</span></span><span class="mpre">, </span><span class="warning" data-warning="FundepFunDep (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 117, srcSpanStartColumn = 42, srcSpanEndLine = 117, srcSpanEndColumn = 50}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 117, srcSpanStartColumn = 46, srcSpanEndLine = 117, srcSpanEndColumn = 48}]}) [Ident (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStar"><span class="mpre">x b -&gt; a</span></span><span class="mpre">  
class    </span><a name="loc_118_10_118_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_10_118_21&#39;)"><span class="hl_classdecl"><span class="mpre">TypeUnify&#39;&#39;</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">x</span></span><span class="mpre">  </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> |  </span><span class="warning" data-warning="FundepFunDep (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 118, srcSpanStartColumn = 32, srcSpanEndLine = 118, srcSpanEndColumn = 40}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 118, srcSpanStartColumn = 36, srcSpanEndLine = 118, srcSpanEndColumn = 38}]}) [Ident (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStar"><span class="mpre">x a -&gt; b</span></span><span class="mpre">, </span><span class="warning" data-warning="FundepFunDep (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 118, srcSpanStartColumn = 42, srcSpanEndLine = 118, srcSpanEndColumn = 50}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 118, srcSpanStartColumn = 46, srcSpanEndLine = 118, srcSpanEndColumn = 48}]}) [Ident (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStar"><span class="mpre">x b -&gt; a</span></span><span class="mpre">  
instance </span><span class="warning" data-warning="InstDecl ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 119, srcSpanStartColumn = 10, srcSpanEndLine = 119, srcSpanEndColumn = 31}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 119, srcSpanStartColumn = 29, srcSpanEndLine = 119, srcSpanEndColumn = 31}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanS"><span class="mpre">TypeUnify&#39;  () a b =&gt;</span></span><span class="mpre"> </span><a href="#loc_116_10_116_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_10_116_19&#39;)"><span class="hl_classref"><span class="mpre">TypeUnify</span></span></a><span class="mpre">    </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
instance </span><span class="warning" data-warning="InstDecl ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 120, srcSpanStartColumn = 10, srcSpanEndLine = 120, srcSpanEndColumn = 31}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanStartLine = 120, srcSpanStartColumn = 29, srcSpanEndLine = 120, srcSpanEndColumn = 31}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/syb-0.4.2/tests/GetC.hs&quot;, srcSpanS"><span class="mpre">TypeUnify&#39;&#39; x  a b =&gt;</span></span><span class="mpre"> </span><a href="#loc_117_10_117_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_10_117_20&#39;)"><span class="hl_classref"><span class="mpre">TypeUnify&#39;</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">x</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
instance </span><a href="#loc_118_10_118_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_10_118_21&#39;)"><span class="hl_classref"><span class="mpre">TypeUnify&#39;&#39;</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span></div></body></html>