<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- | This benchmark simply reads and writes a file using the various string</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- libraries. The point of it is that we can make better estimations on how</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- much time the other benchmarks spend doing IO.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that we expect ByteStrings to be a whole lot faster, since they do not</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- do any actual encoding/decoding here, while String and Text do have UTF-8</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- encoding/decoding.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Tested in this benchmark:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Reading the file</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Replacing text between HTML tags (&lt;&gt;) with whitespace</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Writing back to a handle</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Benchmarks.Programs.Throughput
    ( benchmark
    ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/benchmarks/haskell/Benchmarks/Programs/Throughput.hs&quot;, srcSpanStartLine = 21, srcSpanStartColumn = 8, srcSpanEndLine = 21, srcSpanEndColumn = 17}, srcInfoPoints = []}) &quot;Criterion&quot;"><span class="mpre">Criterion</span></span><span class="mpre"> (Benchmark, bgroup, bench)
import System.IO (Handle, hPutStr)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/benchmarks/haskell/Benchmarks/Programs/Throughput.hs&quot;, srcSpanStartLine = 23, srcSpanStartColumn = 18, srcSpanEndLine = 23, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/benchmarks/haskell/Benchmarks/Programs/Throughput.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 18, srcSpanEndLine = 24, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as BL
import qualified Data.Text.Encoding as T
import qualified Data.Text.IO as T
import qualified Data.Text.Lazy.Encoding as TL
import qualified Data.Text.Lazy.IO as TL

</span><a href="#loc_31_1_31_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_1_31_10&#39;)"><span class="mpre">benchmark</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Benchmark</span></span><span class="mpre">
</span><a name="loc_31_1_31_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_1_31_10&#39;)"><span class="hl_fundecl"><span class="mpre">benchmark</span></span></a><span class="mpre"> </span><a name="loc_31_11_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_13&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a name="loc_31_14_31_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_14_31_18&#39;)"><span class="hl_vardecl"><span class="mpre">sink</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">bgroup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Throughput&quot;</span></span><span class="mpre">
    [ </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;String&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">readFile</span></span><span class="mpre"> </span><a href="#loc_31_11_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_13&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">hPutStr</span></span><span class="mpre"> </span><a href="#loc_31_14_31_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_14_31_18&#39;)"><span class="hl_varref"><span class="mpre">sink</span></span></a><span class="mpre">
    , </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;ByteString&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.readFile</span></span><span class="mpre"> </span><a href="#loc_31_11_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_13&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.hPutStr</span></span><span class="mpre"> </span><a href="#loc_31_14_31_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_14_31_18&#39;)"><span class="hl_varref"><span class="mpre">sink</span></span></a><span class="mpre">
    , </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;LazyByteString&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">BL.readFile</span></span><span class="mpre"> </span><a href="#loc_31_11_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_13&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">BL.hPutStr</span></span><span class="mpre"> </span><a href="#loc_31_14_31_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_14_31_18&#39;)"><span class="hl_varref"><span class="mpre">sink</span></span></a><span class="mpre">
    , </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Text&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Text.IO.html#loc_88_1_88_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.IO.html#loc_88_1_88_9&#39;)"><span class="hl_varref"><span class="mpre">T.readFile</span></span></a><span class="mpre"> </span><a href="#loc_31_11_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_13&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Data.Text.IO.html#loc_174_1_174_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.IO.html#loc_174_1_174_8&#39;)"><span class="hl_varref"><span class="mpre">T.hPutStr</span></span></a><span class="mpre"> </span><a href="#loc_31_14_31_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_14_31_18&#39;)"><span class="hl_varref"><span class="mpre">sink</span></span></a><span class="mpre">
    , </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;LazyText&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Text.Lazy.IO.html#loc_82_1_82_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Lazy.IO.html#loc_82_1_82_9&#39;)"><span class="hl_varref"><span class="mpre">TL.readFile</span></span></a><span class="mpre"> </span><a href="#loc_31_11_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_13&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Data.Text.Lazy.IO.html#loc_139_1_139_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Lazy.IO.html#loc_139_1_139_8&#39;)"><span class="hl_varref"><span class="mpre">TL.hPutStr</span></span></a><span class="mpre"> </span><a href="#loc_31_14_31_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_14_31_18&#39;)"><span class="hl_varref"><span class="mpre">sink</span></span></a><span class="mpre">
    , </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;TextByteString&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">B.readFile</span></span><span class="mpre"> </span><a href="#loc_31_11_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_13&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.hPutStr</span></span><span class="mpre"> </span><a href="#loc_31_14_31_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_14_31_18&#39;)"><span class="hl_varref"><span class="mpre">sink</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.Text.Encoding.html#loc_386_1_386_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Encoding.html#loc_386_1_386_11&#39;)"><span class="hl_varref"><span class="mpre">T.encodeUtf8</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre">  </span><a href="Data.Text.Encoding.html#loc_307_1_307_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Encoding.html#loc_307_1_307_11&#39;)"><span class="hl_varref"><span class="mpre">T.decodeUtf8</span></span></a><span class="mpre">
    , </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;LazyTextByteString&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">BL.readFile</span></span><span class="mpre"> </span><a href="#loc_31_11_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_11_31_13&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">BL.hPutStr</span></span><span class="mpre"> </span><a href="#loc_31_14_31_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_14_31_18&#39;)"><span class="hl_varref"><span class="mpre">sink</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.Text.Lazy.Encoding.html#loc_153_1_153_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Lazy.Encoding.html#loc_153_1_153_11&#39;)"><span class="hl_varref"><span class="mpre">TL.encodeUtf8</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.Text.Lazy.Encoding.html#loc_127_1_127_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Lazy.Encoding.html#loc_127_1_127_11&#39;)"><span class="hl_varref"><span class="mpre">TL.decodeUtf8</span></span></a><span class="mpre">
    ]
</span></div></body></html>