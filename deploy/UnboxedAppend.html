<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE CPP, BangPatterns, Rank2Types, MagicHash #-}
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : UnboxedAppend</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   : (c) 2010 Simon Meier</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD3-style (see LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Simon Meier &lt;iridcode@gmail.com&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : tested on GHC only</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Try using unboxed pointers for the continuation calls to make abstract</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- appends go faster.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module UnboxedAppend where

import Foreign
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/UnboxedAppend.hs&quot;, srcSpanStartLine = 17, srcSpanStartColumn = 8, srcSpanEndLine = 17, srcSpanEndColumn = 20}, srcInfoPoints = []}) &quot;Foreign.UPtr&quot;"><span class="mpre">Foreign.UPtr</span></span><span class="mpre">
import Data.Monoid
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/UnboxedAppend.hs&quot;, srcSpanStartLine = 19, srcSpanStartColumn = 18, srcSpanEndLine = 19, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre">      as S
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/UnboxedAppend.hs&quot;, srcSpanStartLine = 20, srcSpanStartColumn = 18, srcSpanEndLine = 20, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L

#ifdef BYTESTRING_IN_BASE
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/UnboxedAppend.hs&quot;, srcSpanStartLine = 23, srcSpanStartColumn = 8, srcSpanEndLine = 23, srcSpanEndColumn = 28}, srcInfoPoints = []}) &quot;Data.ByteString.Base&quot;"><span class="mpre">Data.ByteString.Base</span></span><span class="mpre"> (inlinePerformIO)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/UnboxedAppend.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 18, srcSpanEndLine = 24, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Base&quot;"><span class="mpre">Data.ByteString.Base</span></span><span class="mpre"> as S
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/UnboxedAppend.hs&quot;, srcSpanStartLine = 25, srcSpanStartColumn = 18, srcSpanEndLine = 25, srcSpanEndColumn = 43}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy.Base&quot;"><span class="mpre">Data.ByteString.Lazy.Base</span></span><span class="mpre"> as L </span><span class="hl_comment"><span class="mpre">-- FIXME: is this the right module for access to &#39;Chunks&#39;?</span></span><span class="mpre">
#else
import Data.ByteString.Internal (</span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="mpre">inlinePerformIO</span></a><span class="mpre">)
import qualified Data.ByteString.Internal as S
import qualified Data.ByteString.Lazy.Internal as L
#endif

import qualified Blaze.ByteString.Builder.Internal as B
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/UnboxedAppend.hs&quot;, srcSpanStartLine = 33, srcSpanStartColumn = 8, srcSpanEndLine = 33, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Blaze.ByteString.Builder.Write&quot;"><span class="mpre">Blaze.ByteString.Builder.Write</span></span><span class="mpre"> (Write(..))
import qualified Blaze.ByteString.Builder.Word     as B
import Blaze.ByteString.Builder.Word (</span><a href="Blaze.ByteString.Builder.Word.html#loc_117_1_117_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Word.html#loc_117_1_117_11&#39;)"><span class="mpre">writeWord8</span></a><span class="mpre">)

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/UnboxedAppend.hs&quot;, srcSpanStartLine = 37, srcSpanStartColumn = 8, srcSpanEndLine = 37, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Criterion.Main&quot;"><span class="mpre">Criterion.Main</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Benchmarks</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_44_1_44_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_5&#39;)"><span class="mpre">main</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_44_1_44_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_5&#39;)"><span class="hl_vardecl"><span class="mpre">main</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">defaultMain</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre">
    [ </span><a href="#loc_51_5_51_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_5_51_14&#39;)"><span class="hl_varref"><span class="mpre">benchmark</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;mconcat . map fromWord8&quot;</span></span><span class="mpre">
        </span><a href="#loc_63_1_63_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_1_63_13&#39;)"><span class="hl_varref"><span class="mpre">myfromWord8s</span></span></a><span class="mpre">
        </span><a href="#loc_67_1_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_15&#39;)"><span class="hl_varref"><span class="mpre">yourfromWord8s</span></span></a><span class="mpre">
        </span><a href="#loc_59_1_59_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_1_59_7&#39;)"><span class="hl_varref"><span class="mpre">word8s</span></span></a><span class="mpre">
    ]
  where
    </span><a name="loc_51_5_51_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_5_51_14&#39;)"><span class="hl_fundecl"><span class="mpre">benchmark</span></span></a><span class="mpre"> </span><a name="loc_51_15_51_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_15_51_19&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre"> </span><a name="loc_51_20_51_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_20_51_24&#39;)"><span class="hl_vardecl"><span class="mpre">putF</span></span></a><span class="mpre"> </span><a name="loc_51_25_51_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_25_51_33&#39;)"><span class="hl_vardecl"><span class="mpre">builderF</span></span></a><span class="mpre"> </span><a name="loc_51_34_51_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_34_51_35&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> =
        [ </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> (</span><a href="#loc_51_15_51_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_15_51_19&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; Put&quot;</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">whnf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">L.length</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_237_1_237_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_1_237_18&#39;)"><span class="hl_varref"><span class="mpre">toLazyByteString2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_51_20_51_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_20_51_24&#39;)"><span class="hl_varref"><span class="mpre">putF</span></span></a><span class="mpre">) </span><a href="#loc_51_34_51_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_34_51_35&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
        , </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> (</span><a href="#loc_51_15_51_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_15_51_19&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; Builder&quot;</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">whnf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">L.length</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17&#39;)"><span class="hl_varref"><span class="mpre">B.toLazyByteString</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_51_25_51_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_25_51_33&#39;)"><span class="hl_varref"><span class="mpre">builderF</span></span></a><span class="mpre">) </span><a href="#loc_51_34_51_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_34_51_35&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
        ]

</span><a href="#loc_59_1_59_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_1_59_7&#39;)"><span class="mpre">word8s</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">]
</span><a name="loc_59_1_59_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_1_59_7&#39;)"><span class="hl_vardecl"><span class="mpre">word8s</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">take</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">100000</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">cycle</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpEnumFrom (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/UnboxedAppend.hs&quot;, srcSpanStartLine = 59, srcSpanStartColumn = 30, srcSpanEndLine = 59, srcSpanEndColumn = 35}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/UnboxedAppend.hs&quot;, srcSpanStartLine = 59, srcSpanStartColumn = 30, srcSpanEndLine = 59, srcSpanEndColumn = 31},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/ben"><span class="mpre">[0..]</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_59_1_59_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_1_59_7&#39;)"><span class="mpre">word8s</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_63_1_63_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_1_63_13&#39;)"><span class="mpre">myfromWord8s</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">] -&gt; </span><a href="#loc_77_9_77_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_9_77_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_63_1_63_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_1_63_13&#39;)"><span class="hl_vardecl"><span class="mpre">myfromWord8s</span></span></a><span class="mpre"> = </span><a href="#loc_117_1_117_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_11&#39;)"><span class="hl_varref"><span class="mpre">putBuilder</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_158_1_158_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_1_158_10&#39;)"><span class="hl_varref"><span class="mpre">fromWord8</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_63_1_63_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_1_63_13&#39;)"><span class="mpre">myfromWord8s</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_67_1_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_15&#39;)"><span class="mpre">yourfromWord8s</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">] -&gt; </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="hl_tyconref"><span class="mpre">B.Builder</span></span></a><span class="mpre">
</span><a name="loc_67_1_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_15&#39;)"><span class="hl_vardecl"><span class="mpre">yourfromWord8s</span></span></a><span class="mpre"> = </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Word.html#loc_269_1_269_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Word.html#loc_269_1_269_10&#39;)"><span class="hl_varref"><span class="mpre">B.fromWord8</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_67_1_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_15&#39;)"><span class="mpre">yourfromWord8s</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The Put type</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">

data </span><a name="loc_75_6_75_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_6_75_14&#39;)"><span class="hl_tycondecl"><span class="mpre">BufRange</span></span></a><span class="mpre"> = </span><a name="loc_75_17_75_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_17_75_25&#39;)"><span class="hl_condecl"><span class="mpre">BufRange</span></span></a><span class="mpre"> {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">) {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)

newtype </span><a name="loc_77_9_77_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_9_77_12&#39;)"><span class="hl_tycondecl"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_77_17_77_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_17_77_20&#39;)"><span class="hl_condecl"><span class="mpre">Put</span></span></a><span class="mpre"> {
    </span><a name="loc_78_5_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_5_78_10&#39;)"><span class="hl_fielddecl"><span class="mpre">unPut</span></span></a><span class="mpre"> :: forall </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">. (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">
  }

data </span><a name="loc_81_6_81_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_6_81_15&#39;)"><span class="hl_tycondecl"><span class="mpre">PutSignal</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> =
    </span><a name="loc_82_5_82_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_5_82_9&#39;)"><span class="hl_condecl"><span class="mpre">Done</span></span></a><span class="mpre"> {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
  | </span><a name="loc_83_5_83_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_5_83_15&#39;)"><span class="hl_condecl"><span class="mpre">BufferFull</span></span></a><span class="mpre">
      {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
      {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
                     !(</span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
  | </span><a name="loc_87_5_87_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_21&#39;)"><span class="hl_condecl"><span class="mpre">InsertByteString</span></span></a><span class="mpre">
      {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">) 
                     !</span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">S.ByteString</span></span></a><span class="mpre">
                     !(</span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/UnboxedAppend.hs&quot;, srcSpanStartLine = 92, srcSpanStartColumn = 1, srcSpanEndLine = 92, srcSpanEndColumn = 51}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/UnboxedAppend.hs&quot;, srcSpanStartLine = 92, srcSpanStartColumn = 1, srcSpanEndLine = 92, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchm"><span class="mpre">type PutStep a =  UPtr -&gt; UPtr -&gt; IO (PutSignal a)</span></span><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Monad</span></span><span class="mpre"> </span><a href="#loc_77_9_77_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_9_77_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> where
  </span><span class="hl_fundecl"><span class="mpre">return</span></span><span class="mpre"> </span><a name="loc_95_10_95_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_10_95_11&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="#loc_77_17_77_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_17_77_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_95_21_95_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_21_95_22&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_95_21_95_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_21_95_22&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_95_10_95_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_10_95_11&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
  </span><span class="hl_pragma"><span class="mpre">{-# INLINE return #-}</span></span><span class="mpre">
  </span><a name="loc_97_3_97_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_3_97_4&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_fundecl"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a name="loc_97_9_97_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_9_97_10&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre">  = </span><a href="#loc_77_17_77_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_17_77_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_97_21_97_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_21_97_22&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_78_5_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_5_78_10&#39;)"><span class="hl_varref"><span class="mpre">unPut</span></span></a><span class="mpre"> </span><a href="#loc_97_3_97_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_3_97_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> (\</span><a name="loc_97_36_97_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_36_97_37&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_78_5_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_5_78_10&#39;)"><span class="hl_varref"><span class="mpre">unPut</span></span></a><span class="mpre"> (</span><a href="#loc_97_9_97_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_9_97_10&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_97_36_97_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_36_97_37&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) </span><a href="#loc_97_21_97_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_21_97_22&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)
  </span><span class="hl_pragma"><span class="mpre">{-# INLINE (&gt;&gt;=) #-}</span></span><span class="mpre">
  </span><a name="loc_99_3_99_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_3_99_4&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_fundecl"><span class="mpre">&gt;&gt;</span></span><span class="mpre">  </span><a name="loc_99_9_99_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_9_99_10&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">  = </span><a href="#loc_77_17_77_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_17_77_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_99_21_99_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_21_99_22&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_78_5_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_5_78_10&#39;)"><span class="hl_varref"><span class="mpre">unPut</span></span></a><span class="mpre"> </span><a href="#loc_99_3_99_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_3_99_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> (\_ -&gt; </span><a href="#loc_78_5_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_5_78_10&#39;)"><span class="hl_varref"><span class="mpre">unPut</span></span></a><span class="mpre"> </span><a href="#loc_99_9_99_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_9_99_10&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_99_21_99_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_21_99_22&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)
  </span><span class="hl_pragma"><span class="mpre">{-# INLINE (&gt;&gt;) #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The Builder type with equal signals as the Put type</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">

newtype </span><a name="loc_106_9_106_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_9_106_16&#39;)"><span class="hl_tycondecl"><span class="mpre">Builder</span></span></a><span class="mpre"> = </span><a name="loc_106_19_106_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_19_106_26&#39;)"><span class="hl_condecl"><span class="mpre">Builder</span></span></a><span class="mpre"> (forall </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">. </span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">)

instance </span><a href="Data.Monoid.html#loc_79_7_79_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_79_7_79_13&#39;)"><span class="hl_classref"><span class="mpre">Monoid</span></span></a><span class="mpre"> </span><a href="#loc_106_9_106_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_9_106_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre"> where
  </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_vardecl"><span class="mpre">mempty</span></span></a><span class="mpre"> = </span><a href="#loc_106_19_106_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_19_106_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">
  </span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="mpre">mempty</span></a><span class="mpre"> #-}</span></span><span class="mpre">
  (</span><a href="#loc_106_19_106_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_19_106_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><a name="loc_111_12_111_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_12_111_14&#39;)"><span class="hl_vardecl"><span class="mpre">b1</span></span></a><span class="mpre">) </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_fundecl"><span class="mpre">`mappend`</span></span></a><span class="mpre"> (</span><a href="#loc_106_19_106_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_19_106_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><a name="loc_111_35_111_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_35_111_37&#39;)"><span class="hl_vardecl"><span class="mpre">b2</span></span></a><span class="mpre">) = </span><a href="#loc_106_19_106_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_19_106_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_111_12_111_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_12_111_14&#39;)"><span class="hl_varref"><span class="mpre">b1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_111_35_111_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_35_111_37&#39;)"><span class="hl_varref"><span class="mpre">b2</span></span></a><span class="mpre">
  </span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="mpre">mappend</span></a><span class="mpre"> #-}</span></span><span class="mpre">
  </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_vardecl"><span class="mpre">mconcat</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">foldr</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_varref"><span class="mpre">mappend</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">
  </span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="mpre">mconcat</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_117_1_117_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_11&#39;)"><span class="mpre">putBuilder</span></a><span class="mpre"> :: </span><a href="#loc_106_9_106_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_9_106_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_77_9_77_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_9_77_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_117_1_117_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_11&#39;)"><span class="hl_fundecl"><span class="mpre">putBuilder</span></span></a><span class="mpre"> (</span><a href="#loc_106_19_106_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_19_106_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><a name="loc_117_21_117_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_21_117_26&#39;)"><span class="hl_vardecl"><span class="mpre">build</span></span></a><span class="mpre">) = </span><a href="#loc_77_17_77_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_17_77_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_117_37_117_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_37_117_38&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_117_21_117_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_21_117_26&#39;)"><span class="hl_varref"><span class="mpre">build</span></span></a><span class="mpre"> (</span><a href="#loc_117_37_117_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_37_117_38&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)

</span><a href="#loc_120_1_120_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_1_120_8&#39;)"><span class="mpre">fromPut</span></a><span class="mpre"> :: </span><a href="#loc_77_9_77_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_9_77_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><a href="#loc_106_9_106_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_9_106_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_120_1_120_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_1_120_8&#39;)"><span class="hl_fundecl"><span class="mpre">fromPut</span></span></a><span class="mpre"> (</span><a href="#loc_77_17_77_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_17_77_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><a name="loc_120_14_120_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_14_120_17&#39;)"><span class="hl_vardecl"><span class="mpre">put</span></span></a><span class="mpre">) = </span><a href="#loc_106_19_106_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_19_106_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_120_32_120_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_32_120_33&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_120_14_120_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_14_120_17&#39;)"><span class="hl_varref"><span class="mpre">put</span></span></a><span class="mpre"> (\_ -&gt; </span><a href="#loc_120_32_120_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_32_120_33&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)

</span><a href="#loc_123_1_123_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_14&#39;)"><span class="mpre">fromBuildStep</span></a><span class="mpre"> :: (forall </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">. </span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre"> -&gt; </span><a href="#loc_75_6_75_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_6_75_14&#39;)"><span class="hl_tyconref"><span class="mpre">BufRange</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_81_6_81_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_6_81_15&#39;)"><span class="hl_tyconref"><span class="mpre">PutSignal</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">)) -&gt; </span><a href="#loc_106_9_106_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_9_106_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_123_1_123_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_14&#39;)"><span class="hl_fundecl"><span class="mpre">fromBuildStep</span></span></a><span class="mpre"> </span><a name="loc_123_15_123_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_15_123_19&#39;)"><span class="hl_vardecl"><span class="mpre">step</span></span></a><span class="mpre"> = </span><a href="#loc_106_19_106_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_19_106_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><a href="#loc_125_5_125_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_5_125_10&#39;)"><span class="hl_varref"><span class="mpre">step&#39;</span></span></a><span class="mpre">
  where
    </span><a name="loc_125_5_125_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_5_125_10&#39;)"><span class="hl_fundecl"><span class="mpre">step&#39;</span></span></a><span class="mpre"> </span><a name="loc_125_11_125_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_11_125_12&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> </span><a name="loc_125_13_125_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_13_125_15&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> </span><a name="loc_125_16_125_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_16_125_19&#39;)"><span class="hl_vardecl"><span class="mpre">ope</span></span></a><span class="mpre"> = </span><a href="#loc_123_15_123_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_15_123_19&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_125_11_125_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_11_125_12&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> (</span><a href="#loc_75_17_75_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_17_75_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">uptrToPtr</span></span><span class="mpre"> </span><a href="#loc_125_13_125_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_13_125_15&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">uptrToPtr</span></span><span class="mpre"> </span><a href="#loc_125_16_125_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_16_125_19&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">))
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_123_1_123_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_14&#39;)"><span class="mpre">fromBuildStep</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_129_1_129_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_14&#39;)"><span class="mpre">callBuildStep</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_75_6_75_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_6_75_14&#39;)"><span class="hl_tyconref"><span class="mpre">BufRange</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_81_6_81_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_6_81_15&#39;)"><span class="hl_tyconref"><span class="mpre">PutSignal</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_129_1_129_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_14&#39;)"><span class="hl_fundecl"><span class="mpre">callBuildStep</span></span></a><span class="mpre"> </span><a name="loc_129_15_129_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_15_129_16&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> (</span><a href="#loc_75_17_75_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_17_75_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_129_27_129_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_27_129_29&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> </span><a name="loc_129_30_129_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_30_129_33&#39;)"><span class="hl_vardecl"><span class="mpre">ope</span></span></a><span class="mpre">) = </span><a href="#loc_129_15_129_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_15_129_16&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">ptrToUPtr</span></span><span class="mpre"> </span><a href="#loc_129_27_129_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_27_129_29&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">ptrToUPtr</span></span><span class="mpre"> </span><a href="#loc_129_30_129_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_30_129_33&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_129_1_129_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_14&#39;)"><span class="mpre">callBuildStep</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_133_1_133_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_13&#39;)"><span class="mpre">boxBuildStep</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><a href="#loc_75_6_75_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_6_75_14&#39;)"><span class="hl_tyconref"><span class="mpre">BufRange</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_81_6_81_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_6_81_15&#39;)"><span class="hl_tyconref"><span class="mpre">PutSignal</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">))
</span><a name="loc_133_1_133_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_13&#39;)"><span class="hl_fundecl"><span class="mpre">boxBuildStep</span></span></a><span class="mpre"> </span><a name="loc_133_14_133_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_14_133_18&#39;)"><span class="hl_vardecl"><span class="mpre">step</span></span></a><span class="mpre"> (</span><a href="#loc_75_17_75_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_17_75_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_133_29_133_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_29_133_31&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> </span><a name="loc_133_32_133_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_32_133_35&#39;)"><span class="hl_vardecl"><span class="mpre">ope</span></span></a><span class="mpre">) = </span><a href="#loc_133_14_133_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_14_133_18&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">ptrToUPtr</span></span><span class="mpre"> </span><a href="#loc_133_29_133_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_29_133_31&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">ptrToUPtr</span></span><span class="mpre"> </span><a href="#loc_133_32_133_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_32_133_35&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_133_1_133_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_13&#39;)"><span class="mpre">boxBuildStep</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_137_1_137_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_15&#39;)"><span class="mpre">unboxBuildStep</span></a><span class="mpre"> :: (</span><a href="#loc_75_6_75_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_6_75_14&#39;)"><span class="hl_tyconref"><span class="mpre">BufRange</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_81_6_81_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_6_81_15&#39;)"><span class="hl_tyconref"><span class="mpre">PutSignal</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)) -&gt; </span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_137_1_137_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_15&#39;)"><span class="hl_fundecl"><span class="mpre">unboxBuildStep</span></span></a><span class="mpre"> </span><a name="loc_137_16_137_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_16_137_20&#39;)"><span class="hl_vardecl"><span class="mpre">step</span></span></a><span class="mpre"> </span><a name="loc_137_21_137_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_21_137_23&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> </span><a name="loc_137_24_137_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_24_137_27&#39;)"><span class="hl_vardecl"><span class="mpre">ope</span></span></a><span class="mpre"> = </span><a href="#loc_137_16_137_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_16_137_20&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> (</span><a href="#loc_75_17_75_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_17_75_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">uptrToPtr</span></span><span class="mpre"> </span><a href="#loc_137_21_137_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_21_137_23&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">uptrToPtr</span></span><span class="mpre"> </span><a href="#loc_137_24_137_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_24_137_27&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">))
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_137_1_137_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_15&#39;)"><span class="mpre">unboxBuildStep</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_141_1_141_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_1_141_19&#39;)"><span class="mpre">fromWriteSingleton</span></a><span class="mpre"> :: (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Write</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_106_9_106_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_9_106_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_141_1_141_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_1_141_19&#39;)"><span class="hl_fundecl"><span class="mpre">fromWriteSingleton</span></span></a><span class="mpre"> </span><a name="loc_141_20_141_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_20_141_25&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre"> = 
    </span><a href="#loc_144_5_144_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_5_144_14&#39;)"><span class="hl_varref"><span class="mpre">mkBuilder</span></span></a><span class="mpre">
  where
    </span><a name="loc_144_5_144_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_5_144_14&#39;)"><span class="hl_fundecl"><span class="mpre">mkBuilder</span></span></a><span class="mpre"> </span><a name="loc_144_15_144_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_15_144_16&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="#loc_123_1_123_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_14&#39;)"><span class="hl_varref"><span class="mpre">fromBuildStep</span></span></a><span class="mpre"> </span><a href="#loc_146_9_146_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_9_146_13&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre">
      where
        </span><a name="loc_146_9_146_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_9_146_13&#39;)"><span class="hl_fundecl"><span class="mpre">step</span></span></a><span class="mpre"> </span><a name="loc_146_14_146_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_14_146_15&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> (</span><a href="#loc_75_17_75_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_17_75_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_146_26_146_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_26_146_28&#39;)"><span class="hl_vardecl"><span class="mpre">pf</span></span></a><span class="mpre"> </span><a name="loc_146_29_146_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_29_146_31&#39;)"><span class="hl_vardecl"><span class="mpre">pe</span></span></a><span class="mpre">)
          | </span><a href="#loc_146_26_146_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_26_146_28&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_154_19_154_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_19_154_23&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><a href="#loc_146_29_146_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_29_146_31&#39;)"><span class="hl_varref"><span class="mpre">pe</span></span></a><span class="mpre"> = do
              </span><a href="#loc_154_24_154_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_24_154_26&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_146_26_146_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_26_146_28&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre">
              let !</span><a name="loc_149_20_149_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_20_149_23&#39;)"><span class="hl_vardecl"><span class="mpre">br&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_75_17_75_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_17_75_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> (</span><a href="#loc_146_26_146_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_26_146_28&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_154_19_154_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_19_154_23&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">) </span><a href="#loc_146_29_146_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_29_146_31&#39;)"><span class="hl_varref"><span class="mpre">pe</span></span></a><span class="mpre">
              </span><a href="#loc_129_1_129_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_14&#39;)"><span class="hl_varref"><span class="mpre">callBuildStep</span></span></a><span class="mpre"> </span><a href="#loc_146_14_146_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_14_146_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_149_20_149_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_20_149_23&#39;)"><span class="hl_varref"><span class="mpre">br&#39;</span></span></a><span class="mpre">
          | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">               = 
              </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_83_5_83_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_5_83_15&#39;)"><span class="hl_conref"><span class="mpre">BufferFull</span></span></a><span class="mpre"> </span><a href="#loc_154_19_154_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_19_154_23&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_146_26_146_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_26_146_28&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> (</span><a href="#loc_137_1_137_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_15&#39;)"><span class="hl_varref"><span class="mpre">unboxBuildStep</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_146_9_146_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_9_146_13&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_146_14_146_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_14_146_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)
          where
            </span><span class="hl_conref"><span class="mpre">Write</span></span><span class="mpre"> </span><a name="loc_154_19_154_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_19_154_23&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> </span><a name="loc_154_24_154_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_24_154_26&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> = </span><a href="#loc_141_20_141_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_20_141_25&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_144_15_144_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_15_144_16&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_141_1_141_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_1_141_19&#39;)"><span class="mpre">fromWriteSingleton</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_158_1_158_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_1_158_10&#39;)"><span class="mpre">fromWord8</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><a href="#loc_106_9_106_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_9_106_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_158_1_158_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_1_158_10&#39;)"><span class="hl_vardecl"><span class="mpre">fromWord8</span></span></a><span class="mpre"> = </span><a href="#loc_141_1_141_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_1_141_19&#39;)"><span class="hl_varref"><span class="mpre">fromWriteSingleton</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Word.html#loc_117_1_117_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Word.html#loc_117_1_117_11&#39;)"><span class="hl_varref"><span class="mpre">writeWord8</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_158_1_158_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_1_158_10&#39;)"><span class="mpre">fromWord8</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- More explicit implementation of running builders</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">


data </span><a name="loc_166_6_166_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_6_166_12&#39;)"><span class="hl_tycondecl"><span class="mpre">Buffer</span></span></a><span class="mpre"> = </span><a name="loc_166_15_166_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_15_166_21&#39;)"><span class="hl_condecl"><span class="mpre">Buffer</span></span></a><span class="mpre"> {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">) </span><span class="hl_comment"><span class="mpre">-- underlying pinned array</span></span><span class="mpre">
                     {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)        </span><span class="hl_comment"><span class="mpre">-- beginning of slice</span></span><span class="mpre">
                     {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)        </span><span class="hl_comment"><span class="mpre">-- next free byte</span></span><span class="mpre">
                     {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)        </span><span class="hl_comment"><span class="mpre">-- first byte after buffer</span></span><span class="mpre">

</span><a href="#loc_172_1_172_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_1_172_12&#39;)"><span class="mpre">allocBuffer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_166_6_166_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_6_166_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre">
</span><a name="loc_172_1_172_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_1_172_12&#39;)"><span class="hl_fundecl"><span class="mpre">allocBuffer</span></span></a><span class="mpre"> </span><a name="loc_172_13_172_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_13_172_17&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> = do
    </span><a name="loc_173_5_173_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_5_173_10&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> &lt;- </span><a href="Data.ByteString.Internal.html#loc_489_1_489_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_489_1_489_17&#39;)"><span class="hl_varref"><span class="mpre">S.mallocByteString</span></span></a><span class="mpre"> </span><a href="#loc_172_13_172_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_13_172_17&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">
    let !</span><a name="loc_174_10_174_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_10_174_14&#39;)"><span class="hl_vardecl"><span class="mpre">pbuf</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span><span class="mpre"> </span><a href="#loc_173_5_173_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_5_173_10&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="#loc_166_15_166_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_15_166_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a href="#loc_173_5_173_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_5_173_10&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a href="#loc_174_10_174_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_10_174_14&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> </span><a href="#loc_174_10_174_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_10_174_14&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> (</span><a href="#loc_174_10_174_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_10_174_14&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_172_13_172_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_13_172_17&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">)

</span><a href="#loc_178_1_178_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_1_178_19&#39;)"><span class="mpre">unsafeFreezeBuffer</span></a><span class="mpre"> :: </span><a href="#loc_166_6_166_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_6_166_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> -&gt; </span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">S.ByteString</span></span></a><span class="mpre">
</span><a name="loc_178_1_178_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_1_178_19&#39;)"><span class="hl_fundecl"><span class="mpre">unsafeFreezeBuffer</span></span></a><span class="mpre"> (</span><a href="#loc_166_15_166_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_15_166_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a name="loc_178_28_178_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_28_178_33&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a name="loc_178_34_178_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_34_178_36&#39;)"><span class="hl_vardecl"><span class="mpre">p0</span></span></a><span class="mpre"> </span><a name="loc_178_37_178_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_37_178_39&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> _) = 
    </span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">S.PS</span></span></a><span class="mpre"> </span><a href="#loc_178_28_178_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_28_178_33&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> (</span><a href="#loc_178_37_178_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_37_178_39&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`minusPtr`</span></span><span class="mpre"> </span><a href="#loc_178_34_178_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_34_178_36&#39;)"><span class="hl_varref"><span class="mpre">p0</span></span></a><span class="mpre">)

</span><a href="#loc_182_1_182_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_27&#39;)"><span class="mpre">unsafeFreezeNonEmptyBuffer</span></a><span class="mpre"> :: </span><a href="#loc_166_6_166_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_6_166_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">S.ByteString</span></span></a><span class="mpre">
</span><a name="loc_182_1_182_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_27&#39;)"><span class="hl_fundecl"><span class="mpre">unsafeFreezeNonEmptyBuffer</span></span></a><span class="mpre"> (</span><a href="#loc_166_15_166_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_15_166_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a name="loc_182_36_182_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_36_182_41&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a name="loc_182_42_182_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_42_182_44&#39;)"><span class="hl_vardecl"><span class="mpre">p0</span></span></a><span class="mpre"> </span><a name="loc_182_45_182_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_45_182_47&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> _) 
  | </span><a href="#loc_182_42_182_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_42_182_44&#39;)"><span class="hl_varref"><span class="mpre">p0</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_182_45_182_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_45_182_47&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre">  = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">S.PS</span></span></a><span class="mpre"> </span><a href="#loc_182_36_182_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_36_182_41&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> (</span><a href="#loc_182_45_182_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_45_182_47&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`minusPtr`</span></span><span class="mpre"> </span><a href="#loc_182_42_182_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_42_182_44&#39;)"><span class="hl_varref"><span class="mpre">p0</span></span></a><span class="mpre">)

</span><a href="#loc_187_1_187_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_1_187_10&#39;)"><span class="mpre">nextSlice</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_166_6_166_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_6_166_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="#loc_166_6_166_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_6_166_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre">
</span><a name="loc_187_1_187_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_1_187_10&#39;)"><span class="hl_fundecl"><span class="mpre">nextSlice</span></span></a><span class="mpre"> </span><a name="loc_187_11_187_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_11_187_18&#39;)"><span class="hl_vardecl"><span class="mpre">minSize</span></span></a><span class="mpre"> (</span><a href="#loc_166_15_166_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_15_166_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a name="loc_187_27_187_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_27_187_32&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> _ </span><a name="loc_187_35_187_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_35_187_37&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> </span><a name="loc_187_38_187_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_38_187_41&#39;)"><span class="hl_vardecl"><span class="mpre">ope</span></span></a><span class="mpre">)
  | </span><a href="#loc_187_38_187_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_38_187_41&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`minusPtr`</span></span><span class="mpre"> </span><a href="#loc_187_35_187_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_35_187_37&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><a href="#loc_187_11_187_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_11_187_18&#39;)"><span class="hl_varref"><span class="mpre">minSize</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">                    = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a href="#loc_166_15_166_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_15_166_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a href="#loc_187_27_187_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_27_187_32&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a href="#loc_187_35_187_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_35_187_37&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><a href="#loc_187_35_187_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_35_187_37&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><a href="#loc_187_38_187_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_38_187_41&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">)

</span><a href="#loc_198_1_198_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_1_198_7&#39;)"><span class="mpre">runPut</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/UnboxedAppend.hs&quot;, srcSpanStartLine = 191, srcSpanStartColumn = 11, srcSpanEndLine = 192, srcSpanEndColumn = 10}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/UnboxedAppend.hs&quot;, srcSpanStartLine = 192, srcSpanStartColumn = 8, srcSpanEndLine = 192, srcSpanEndColumn = 10}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vag"><span class="mpre">Monad m 
       =&gt;</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_81_6_81_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_6_81_15&#39;)"><span class="hl_tyconref"><span class="mpre">PutSignal</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> (</span><a href="#loc_81_6_81_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_6_81_15&#39;)"><span class="hl_tyconref"><span class="mpre">PutSignal</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)) </span><span class="hl_comment"><span class="mpre">-- lifting of buildsteps</span></span><span class="mpre">
       -&gt; (</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_166_6_166_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_6_166_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><a href="#loc_166_6_166_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_6_166_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre">) </span><span class="hl_comment"><span class="mpre">-- output function for a guaranteedly non-empty buffer, the returned buffer will be filled next</span></span><span class="mpre">
       -&gt; (</span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">S.ByteString</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)    </span><span class="hl_comment"><span class="mpre">-- output function for guaranteedly non-empty bytestrings, that are inserted directly into the stream</span></span><span class="mpre">
       -&gt; </span><a href="#loc_77_9_77_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_9_77_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">                     </span><span class="hl_comment"><span class="mpre">-- put to execute</span></span><span class="mpre">
       -&gt; </span><a href="#loc_166_6_166_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_6_166_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre">                    </span><span class="hl_comment"><span class="mpre">-- initial buffer to be used</span></span><span class="mpre">
       -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><a href="#loc_166_6_166_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_6_166_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre">)             </span><span class="hl_comment"><span class="mpre">-- result of put and remaining buffer</span></span><span class="mpre">
</span><a name="loc_198_1_198_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_1_198_7&#39;)"><span class="hl_fundecl"><span class="mpre">runPut</span></span></a><span class="mpre"> </span><a name="loc_198_8_198_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_8_198_14&#39;)"><span class="hl_vardecl"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><a name="loc_198_15_198_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_15_198_24&#39;)"><span class="hl_vardecl"><span class="mpre">outputBuf</span></span></a><span class="mpre"> </span><a name="loc_198_25_198_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_25_198_33&#39;)"><span class="hl_vardecl"><span class="mpre">outputBS</span></span></a><span class="mpre"> (</span><a href="#loc_77_17_77_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_17_77_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><a name="loc_198_39_198_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_39_198_42&#39;)"><span class="hl_vardecl"><span class="mpre">put</span></span></a><span class="mpre">) =
    </span><a href="#loc_203_5_203_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_5_203_12&#39;)"><span class="hl_varref"><span class="mpre">runStep</span></span></a><span class="mpre"> (</span><a href="#loc_198_39_198_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_39_198_42&#39;)"><span class="hl_varref"><span class="mpre">put</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> (\</span><a name="loc_199_22_199_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_22_199_23&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_137_1_137_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_15&#39;)"><span class="hl_varref"><span class="mpre">unboxBuildStep</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_201_5_201_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_5_201_14&#39;)"><span class="hl_varref"><span class="mpre">finalStep</span></span></a><span class="mpre"> </span><a href="#loc_199_22_199_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_22_199_23&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">))
  where
    </span><a name="loc_201_5_201_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_5_201_14&#39;)"><span class="hl_fundecl"><span class="mpre">finalStep</span></span></a><span class="mpre"> </span><a name="loc_201_15_201_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_15_201_16&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> !(</span><a href="#loc_75_17_75_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_17_75_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_201_28_201_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_28_201_30&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> _) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_82_5_82_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_5_82_9&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> </span><a href="#loc_201_28_201_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_28_201_30&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><a href="#loc_201_15_201_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_15_201_16&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">

    </span><a name="loc_203_5_203_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_5_203_12&#39;)"><span class="hl_fundecl"><span class="mpre">runStep</span></span></a><span class="mpre"> </span><a name="loc_203_13_203_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_13_203_17&#39;)"><span class="hl_vardecl"><span class="mpre">step</span></span></a><span class="mpre"> </span><a name="loc_203_18_203_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_18_203_21&#39;)"><span class="hl_specname"><span class="mpre">buf</span></span></a><span class="mpre">@(</span><a href="#loc_166_15_166_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_15_166_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a name="loc_203_30_203_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_30_203_35&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a name="loc_203_36_203_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_36_203_38&#39;)"><span class="hl_vardecl"><span class="mpre">p0</span></span></a><span class="mpre"> </span><a name="loc_203_39_203_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_39_203_41&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> </span><a name="loc_203_42_203_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_42_203_45&#39;)"><span class="hl_vardecl"><span class="mpre">ope</span></span></a><span class="mpre">) = do
        let !</span><a name="loc_204_14_204_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_14_204_16&#39;)"><span class="hl_vardecl"><span class="mpre">br</span></span></a><span class="mpre"> = </span><a href="#loc_75_17_75_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_17_75_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a href="#loc_203_39_203_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_39_203_41&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><a href="#loc_203_42_203_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_42_203_45&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">
        </span><a name="loc_205_9_205_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_9_205_15&#39;)"><span class="hl_vardecl"><span class="mpre">signal</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_198_8_198_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_8_198_14&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_129_1_129_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_14&#39;)"><span class="hl_varref"><span class="mpre">callBuildStep</span></span></a><span class="mpre"> </span><a href="#loc_203_13_203_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_13_203_17&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_204_14_204_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_14_204_16&#39;)"><span class="hl_varref"><span class="mpre">br</span></span></a><span class="mpre">
        case </span><a href="#loc_205_9_205_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_9_205_15&#39;)"><span class="hl_varref"><span class="mpre">signal</span></span></a><span class="mpre"> of 
            </span><a href="#loc_82_5_82_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_5_82_9&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> </span><a name="loc_207_18_207_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_18_207_21&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a name="loc_207_22_207_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_22_207_23&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt;         </span><span class="hl_comment"><span class="mpre">-- put completed, buffer partially runSteped</span></span><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_207_22_207_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_22_207_23&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">, </span><a href="#loc_166_15_166_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_15_166_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a href="#loc_203_30_203_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_30_203_35&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a href="#loc_203_36_203_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_36_203_38&#39;)"><span class="hl_varref"><span class="mpre">p0</span></span></a><span class="mpre"> </span><a href="#loc_207_18_207_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_18_207_21&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a href="#loc_203_42_203_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_42_203_45&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">)

            </span><a href="#loc_83_5_83_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_5_83_15&#39;)"><span class="hl_conref"><span class="mpre">BufferFull</span></span></a><span class="mpre"> </span><a name="loc_210_24_210_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_24_210_31&#39;)"><span class="hl_vardecl"><span class="mpre">minSize</span></span></a><span class="mpre"> </span><a name="loc_210_32_210_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_32_210_35&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a name="loc_210_36_210_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_36_210_44&#39;)"><span class="hl_vardecl"><span class="mpre">nextStep</span></span></a><span class="mpre"> -&gt; do
                </span><a name="loc_211_17_211_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_17_211_21&#39;)"><span class="hl_vardecl"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_198_15_198_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_15_198_24&#39;)"><span class="hl_varref"><span class="mpre">outputBuf</span></span></a><span class="mpre"> </span><a href="#loc_210_24_210_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_24_210_31&#39;)"><span class="hl_varref"><span class="mpre">minSize</span></span></a><span class="mpre"> (</span><a href="#loc_166_15_166_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_15_166_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a href="#loc_203_30_203_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_30_203_35&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a href="#loc_203_36_203_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_36_203_38&#39;)"><span class="hl_varref"><span class="mpre">p0</span></span></a><span class="mpre"> </span><a href="#loc_210_32_210_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_32_210_35&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a href="#loc_203_42_203_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_42_203_45&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">)
                </span><a href="#loc_203_5_203_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_5_203_12&#39;)"><span class="hl_varref"><span class="mpre">runStep</span></span></a><span class="mpre"> </span><a href="#loc_210_36_210_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_36_210_44&#39;)"><span class="hl_varref"><span class="mpre">nextStep</span></span></a><span class="mpre"> </span><a href="#loc_211_17_211_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_17_211_21&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">

            </span><a href="#loc_87_5_87_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_21&#39;)"><span class="hl_conref"><span class="mpre">InsertByteString</span></span></a><span class="mpre"> </span><a name="loc_214_30_214_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_30_214_33&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a name="loc_214_34_214_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_34_214_36&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a name="loc_214_37_214_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_37_214_45&#39;)"><span class="hl_vardecl"><span class="mpre">nextStep</span></span></a><span class="mpre">
              | </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_214_34_214_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_34_214_36&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> -&gt;   </span><span class="hl_comment"><span class="mpre">-- flushing of buffer required</span></span><span class="mpre">
                  </span><a href="#loc_198_15_198_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_15_198_24&#39;)"><span class="hl_varref"><span class="mpre">outputBuf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> (</span><a href="#loc_166_15_166_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_15_166_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a href="#loc_203_30_203_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_30_203_35&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a href="#loc_203_36_203_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_36_203_38&#39;)"><span class="hl_varref"><span class="mpre">p0</span></span></a><span class="mpre"> </span><a href="#loc_214_30_214_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_30_214_33&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a href="#loc_203_42_203_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_42_203_45&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="#loc_203_5_203_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_5_203_12&#39;)"><span class="hl_varref"><span class="mpre">runStep</span></span></a><span class="mpre"> </span><a href="#loc_214_37_214_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_37_214_45&#39;)"><span class="hl_varref"><span class="mpre">nextStep</span></span></a><span class="mpre">
              | </span><a href="#loc_203_36_203_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_36_203_38&#39;)"><span class="hl_varref"><span class="mpre">p0</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_214_30_214_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_30_214_33&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> -&gt; do </span><span class="hl_comment"><span class="mpre">-- no bytes written: just insert bytestring</span></span><span class="mpre">
                  </span><a href="#loc_198_25_198_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_25_198_33&#39;)"><span class="hl_varref"><span class="mpre">outputBS</span></span></a><span class="mpre"> </span><a href="#loc_214_34_214_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_34_214_36&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
                  </span><a href="#loc_203_5_203_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_5_203_12&#39;)"><span class="hl_varref"><span class="mpre">runStep</span></span></a><span class="mpre"> </span><a href="#loc_214_37_214_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_37_214_45&#39;)"><span class="hl_varref"><span class="mpre">nextStep</span></span></a><span class="mpre"> </span><a href="#loc_203_18_203_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_18_203_21&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
              | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> -&gt; do   </span><span class="hl_comment"><span class="mpre">-- bytes written, insert buffer and bytestring</span></span><span class="mpre">
                  </span><a name="loc_221_19_221_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_19_221_23&#39;)"><span class="hl_vardecl"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_198_15_198_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_15_198_24&#39;)"><span class="hl_varref"><span class="mpre">outputBuf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> (</span><a href="#loc_166_15_166_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_15_166_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a href="#loc_203_30_203_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_30_203_35&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a href="#loc_203_36_203_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_36_203_38&#39;)"><span class="hl_varref"><span class="mpre">p0</span></span></a><span class="mpre"> </span><a href="#loc_214_30_214_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_30_214_33&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a href="#loc_203_42_203_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_42_203_45&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">)
                  </span><a href="#loc_198_25_198_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_25_198_33&#39;)"><span class="hl_varref"><span class="mpre">outputBS</span></span></a><span class="mpre"> </span><a href="#loc_214_34_214_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_34_214_36&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
                  </span><a href="#loc_203_5_203_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_5_203_12&#39;)"><span class="hl_varref"><span class="mpre">runStep</span></span></a><span class="mpre"> </span><a href="#loc_214_37_214_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_37_214_45&#39;)"><span class="hl_varref"><span class="mpre">nextStep</span></span></a><span class="mpre"> </span><a href="#loc_221_19_221_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_19_221_23&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_198_1_198_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_1_198_7&#39;)"><span class="mpre">runPut</span></a><span class="mpre"> #-}</span></span><span class="mpre">
              
</span><span class="hl_comment"><span class="mpre">-- | A monad for lazily composing lazy bytestrings using continuations.</span></span><span class="mpre">
newtype </span><a name="loc_227_9_227_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_9_227_13&#39;)"><span class="hl_tycondecl"><span class="mpre">LBSM</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_227_18_227_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_18_227_22&#39;)"><span class="hl_condecl"><span class="mpre">LBSM</span></span></a><span class="mpre"> { </span><a name="loc_227_25_227_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_25_227_31&#39;)"><span class="hl_fielddecl"><span class="mpre">unLBSM</span></span></a><span class="mpre"> :: (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre"> -&gt; </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre">) }

instance </span><span class="hl_classref"><span class="mpre">Monad</span></span><span class="mpre"> </span><a href="#loc_227_9_227_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_9_227_13&#39;)"><span class="hl_tyconref"><span class="mpre">LBSM</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">return</span></span><span class="mpre"> </span><a name="loc_230_12_230_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_12_230_13&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">                       = </span><a href="#loc_227_18_227_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_18_227_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><a href="#loc_230_12_230_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_12_230_13&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">)
    (</span><a href="#loc_227_18_227_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_18_227_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><a name="loc_231_12_231_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_12_231_13&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">,</span><a name="loc_231_14_231_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_14_231_15&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre">)) </span><span class="hl_fundecl"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a name="loc_231_22_231_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_22_231_23&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre">             = let </span><a href="#loc_227_18_227_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_18_227_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><a name="loc_231_48_231_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_48_231_50&#39;)"><span class="hl_vardecl"><span class="mpre">x&#39;</span></span></a><span class="mpre">,</span><a name="loc_231_51_231_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_51_231_53&#39;)"><span class="hl_vardecl"><span class="mpre">k&#39;</span></span></a><span class="mpre">) = </span><a href="#loc_231_22_231_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_22_231_23&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_231_12_231_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_12_231_13&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> in </span><a href="#loc_227_18_227_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_18_227_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><a href="#loc_231_48_231_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_48_231_50&#39;)"><span class="hl_varref"><span class="mpre">x&#39;</span></span></a><span class="mpre">, </span><a href="#loc_231_14_231_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_14_231_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_231_51_231_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_51_231_53&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre">)
    (</span><a href="#loc_227_18_227_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_18_227_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (_,</span><a name="loc_232_14_232_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_14_232_15&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre">)) </span><span class="hl_fundecl"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> (</span><a href="#loc_227_18_227_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_18_227_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><a name="loc_232_28_232_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_28_232_30&#39;)"><span class="hl_vardecl"><span class="mpre">x&#39;</span></span></a><span class="mpre">,</span><a name="loc_232_31_232_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_31_232_33&#39;)"><span class="hl_vardecl"><span class="mpre">k&#39;</span></span></a><span class="mpre">)) = </span><a href="#loc_227_18_227_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_18_227_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><a href="#loc_232_28_232_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_28_232_30&#39;)"><span class="hl_varref"><span class="mpre">x&#39;</span></span></a><span class="mpre">, </span><a href="#loc_232_14_232_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_14_232_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_232_31_232_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_31_232_33&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Execute a put and return the written buffers as the chunks of a lazy</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- bytestring.</span></span><span class="mpre">
</span><a href="#loc_237_1_237_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_1_237_18&#39;)"><span class="mpre">toLazyByteString2</span></a><span class="mpre"> :: </span><a href="#loc_77_9_77_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_9_77_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre">
</span><a name="loc_237_1_237_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_1_237_18&#39;)"><span class="hl_fundecl"><span class="mpre">toLazyByteString2</span></span></a><span class="mpre"> </span><a name="loc_237_19_237_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_19_237_22&#39;)"><span class="hl_vardecl"><span class="mpre">put</span></span></a><span class="mpre"> = 
    </span><a href="#loc_243_19_243_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_19_243_20&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> (</span><a href="#loc_245_5_245_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_5_245_17&#39;)"><span class="hl_varref"><span class="mpre">bufToLBSCont</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">snd</span></span><span class="mpre"> </span><a href="#loc_243_11_243_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_11_243_17&#39;)"><span class="hl_varref"><span class="mpre">result</span></span></a><span class="mpre">) </span><span class="hl_varref"><span class="mpre">L.empty</span></span><span class="mpre">)
  where
    </span><span class="hl_comment"><span class="mpre">-- initial buffer</span></span><span class="mpre">
    </span><a name="loc_241_5_241_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_5_241_9&#39;)"><span class="hl_vardecl"><span class="mpre">buf0</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">inlinePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_172_1_172_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_1_172_12&#39;)"><span class="hl_varref"><span class="mpre">allocBuffer</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.html#loc_84_1_84_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_84_1_84_18&#39;)"><span class="hl_varref"><span class="mpre">B.defaultBufferSize</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- run put, but don&#39;t force result =&gt; we&#39;re lazy enough</span></span><span class="mpre">
    </span><a href="#loc_227_18_227_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_18_227_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><a name="loc_243_11_243_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_11_243_17&#39;)"><span class="hl_vardecl"><span class="mpre">result</span></span></a><span class="mpre">, </span><a name="loc_243_19_243_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_19_243_20&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre">) = </span><a href="#loc_198_1_198_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_1_198_7&#39;)"><span class="hl_varref"><span class="mpre">runPut</span></span></a><span class="mpre"> </span><a href="#loc_247_5_247_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_5_247_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><a href="#loc_249_5_249_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_5_249_14&#39;)"><span class="hl_varref"><span class="mpre">outputBuf</span></span></a><span class="mpre"> </span><a href="#loc_254_5_254_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_5_254_13&#39;)"><span class="hl_varref"><span class="mpre">outputBS</span></span></a><span class="mpre"> </span><a href="#loc_237_19_237_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_19_237_22&#39;)"><span class="hl_varref"><span class="mpre">put</span></span></a><span class="mpre"> </span><a href="#loc_241_5_241_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_5_241_9&#39;)"><span class="hl_varref"><span class="mpre">buf0</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- convert a buffer to a lazy bytestring continuation</span></span><span class="mpre">
    </span><a name="loc_245_5_245_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_5_245_17&#39;)"><span class="hl_vardecl"><span class="mpre">bufToLBSCont</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre"> </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_27_82_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_27_82_32&#39;)"><span class="hl_conref"><span class="mpre">L.Chunk</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_182_1_182_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_27&#39;)"><span class="hl_varref"><span class="mpre">unsafeFreezeNonEmptyBuffer</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- lifting an io putsignal to a lazy bytestring monad</span></span><span class="mpre">
    </span><a name="loc_247_5_247_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_5_247_11&#39;)"><span class="hl_fundecl"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><a name="loc_247_12_247_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_12_247_14&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> = </span><a href="#loc_227_18_227_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_18_227_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">inlinePerformIO</span></span></a><span class="mpre"> </span><a href="#loc_247_12_247_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_12_247_14&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">)
    </span><span class="hl_comment"><span class="mpre">-- add buffer as a chunk prepare allocation of new one</span></span><span class="mpre">
    </span><a name="loc_249_5_249_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_5_249_14&#39;)"><span class="hl_fundecl"><span class="mpre">outputBuf</span></span></a><span class="mpre"> </span><a name="loc_249_15_249_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_15_249_22&#39;)"><span class="hl_vardecl"><span class="mpre">minSize</span></span></a><span class="mpre"> </span><a name="loc_249_23_249_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_23_249_26&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> = </span><a href="#loc_227_18_227_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_18_227_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre">
        ( </span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">inlinePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_172_1_172_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_1_172_12&#39;)"><span class="hl_varref"><span class="mpre">allocBuffer</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">max</span></span><span class="mpre"> </span><a href="#loc_249_15_249_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_15_249_22&#39;)"><span class="hl_varref"><span class="mpre">minSize</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.html#loc_84_1_84_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_84_1_84_18&#39;)"><span class="hl_varref"><span class="mpre">B.defaultBufferSize</span></span></a><span class="mpre">)
        , </span><a href="#loc_245_5_245_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_5_245_17&#39;)"><span class="hl_varref"><span class="mpre">bufToLBSCont</span></span></a><span class="mpre"> </span><a href="#loc_249_23_249_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_23_249_26&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> )
    </span><span class="hl_comment"><span class="mpre">-- add bytestring directly as a chunk; exploits postcondition of runPut</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- that bytestrings are non-empty</span></span><span class="mpre">
    </span><a name="loc_254_5_254_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_5_254_13&#39;)"><span class="hl_fundecl"><span class="mpre">outputBS</span></span></a><span class="mpre"> </span><a name="loc_254_14_254_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_14_254_16&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="#loc_227_18_227_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_18_227_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">, </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_27_82_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_27_82_32&#39;)"><span class="hl_conref"><span class="mpre">L.Chunk</span></span></a><span class="mpre"> </span><a href="#loc_254_14_254_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_14_254_16&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">)
</span></div></body></html>