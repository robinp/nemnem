<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Unsafe #-}
{-# LANGUAGE NoImplicitPrelude
           , BangPatterns
           , RankNTypes
           , MagicHash
           , UnboxedTuples
  #-}
{-# OPTIONS_GHC -funbox-strict-fields #-}
{-# OPTIONS_HADDOCK hide #-}

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  GHC.IO</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow 1994-2002</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  see libraries/base/LICENSE</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  cvs-ghc@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  internal</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (GHC Extensions)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Definitions for the &#39;IO&#39; monad and its friends.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module GHC.IO (
        IO(..), unIO, failIO, liftIO,
        unsafePerformIO, unsafeInterleaveIO,
        unsafeDupablePerformIO, unsafeDupableInterleaveIO,
        noDuplicate,

        </span><span class="hl_comment"><span class="mpre">-- To and from from ST</span></span><span class="mpre">
        stToIO, ioToST, unsafeIOToST, unsafeSTToIO,

        FilePath,

        catchException, catchAny, throwIO,
        mask, mask_, uninterruptibleMask, uninterruptibleMask_, 
        MaskingState(..), getMaskingState,
        unsafeUnmask,
        onException, bracket, finally, evaluate
    ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 43, srcSpanStartColumn = 8, srcSpanEndLine = 43, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 44, srcSpanStartColumn = 8, srcSpanEndLine = 44, srcSpanEndColumn = 14}, srcInfoPoints = []}) &quot;GHC.ST&quot;"><span class="mpre">GHC.ST</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 45, srcSpanStartColumn = 8, srcSpanEndLine = 45, srcSpanEndColumn = 21}, srcInfoPoints = []}) &quot;GHC.Exception&quot;"><span class="mpre">GHC.Exception</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 46, srcSpanStartColumn = 8, srcSpanEndLine = 46, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Show&quot;"><span class="mpre">GHC.Show</span></span><span class="mpre">
import Data.Maybe

import {-# SOURCE #-} </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 49, srcSpanStartColumn = 23, srcSpanEndLine = 49, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;GHC.IO.Exception&quot;"><span class="mpre">GHC.IO.Exception</span></span><span class="mpre"> ( userError )

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The IO Monad</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-
The IO Monad is just an instance of the ST monad, where the state is
the real world.  We use the exception mechanism (in GHC.Exception) to
implement IO exceptions.

NOTE: The IO representation is deeply wired in to various parts of the
system.  The following list may or may not be exhaustive:

Compiler  - types of various primitives in PrimOp.lhs

RTS       - forceIO (StgMiscClosures.hc)
          - catchzh_fast, (un)?blockAsyncExceptionszh_fast, raisezh_fast 
            (Exceptions.hc)
          - raiseAsync (Schedule.c)

Prelude   - GHC.IO.lhs, and several other places including
            GHC.Exception.lhs.

Libraries - parts of hslibs/lang.

--SDM
-}</span></span><span class="mpre">

</span><a href="#loc_78_1_78_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_7&#39;)"><span class="mpre">liftIO</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">State#</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">RealWorld</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STret</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">RealWorld</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_78_1_78_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_7&#39;)"><span class="hl_fundecl"><span class="mpre">liftIO</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><a name="loc_78_12_78_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_12_78_13&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) = \</span><a name="loc_78_18_78_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_18_78_19&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; case </span><a href="#loc_78_12_78_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_12_78_13&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_78_18_78_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_18_78_19&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of (# </span><a name="loc_78_38_78_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_38_78_40&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a name="loc_78_42_78_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_42_78_43&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> #) -&gt; </span><span class="hl_conref"><span class="mpre">STret</span></span><span class="mpre"> </span><a href="#loc_78_38_78_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_38_78_40&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre"> </span><a href="#loc_78_42_78_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_42_78_43&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

</span><a href="#loc_81_1_81_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_1_81_7&#39;)"><span class="mpre">failIO</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_81_1_81_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_1_81_7&#39;)"><span class="hl_fundecl"><span class="mpre">failIO</span></span></a><span class="mpre"> </span><a name="loc_81_8_81_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_8_81_9&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">raiseIO#</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">toException</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">userError</span></span><span class="mpre"> </span><a href="#loc_81_8_81_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_8_81_9&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)))

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Coercions between IO and ST</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A monad transformer embedding strict state transformers in the &#39;IO&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- monad.  The &#39;RealWorld&#39; parameter indicates that the internal state</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- used by the &#39;ST&#39; computation is a special one supplied by the &#39;IO&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- monad, and thus distinct from those used by invocations of &#39;runST&#39;.</span></span><span class="mpre">
</span><a href="#loc_91_1_91_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_1_91_7&#39;)"><span class="mpre">stToIO</span></a><span class="mpre">        :: </span><span class="hl_tyconref"><span class="mpre">ST</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">RealWorld</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_91_1_91_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_1_91_7&#39;)"><span class="hl_fundecl"><span class="mpre">stToIO</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">ST</span></span><span class="mpre"> </span><a name="loc_91_12_91_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_12_91_13&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_91_12_91_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_12_91_13&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">

</span><a href="#loc_94_1_94_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_7&#39;)"><span class="mpre">ioToST</span></a><span class="mpre">        :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ST</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">RealWorld</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_94_1_94_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_7&#39;)"><span class="hl_fundecl"><span class="mpre">ioToST</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><a name="loc_94_12_94_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_12_94_13&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) = (</span><span class="hl_conref"><span class="mpre">ST</span></span><span class="mpre"> </span><a href="#loc_94_12_94_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_12_94_13&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- This relies on IO and ST having the same representation modulo the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- constraint on the type of the state</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_100_1_100_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_13&#39;)"><span class="mpre">unsafeIOToST</span></a><span class="mpre">        :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ST</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_100_1_100_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_13&#39;)"><span class="hl_fundecl"><span class="mpre">unsafeIOToST</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><a name="loc_100_18_100_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_18_100_20&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">ST</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_100_31_100_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_31_100_32&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; (</span><span class="hl_varref"><span class="mpre">unsafeCoerce#</span></span><span class="mpre"> </span><a href="#loc_100_18_100_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_18_100_20&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre">) </span><a href="#loc_100_31_100_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_31_100_32&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">

</span><a href="#loc_103_1_103_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_1_103_13&#39;)"><span class="mpre">unsafeSTToIO</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ST</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_103_1_103_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_1_103_13&#39;)"><span class="hl_fundecl"><span class="mpre">unsafeSTToIO</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">ST</span></span><span class="mpre"> </span><a name="loc_103_18_103_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_18_103_19&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">unsafeCoerce#</span></span><span class="mpre"> </span><a href="#loc_103_18_103_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_18_103_19&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Unsafe IO operations</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-|
This is the \&quot;back door\&quot; into the &#39;IO&#39; monad, allowing
&#39;IO&#39; computation to be performed at any time.  For
this to be safe, the &#39;IO&#39; computation should be
free of side effects and independent of its environment.

If the I\/O computation wrapped in &#39;unsafePerformIO&#39; performs side
effects, then the relative order in which those side effects take
place (relative to the main I\/O trunk, or other calls to
&#39;unsafePerformIO&#39;) is indeterminate.  Furthermore, when using
&#39;unsafePerformIO&#39; to cause side-effects, you should take the following
precautions to ensure the side effects are performed as many times as
you expect them to be.  Note that these precautions are necessary for
GHC, but may not be sufficient, and other compilers may require
different precautions:

  * Use @{\-\# NOINLINE foo \#-\}@ as a pragma on any function @foo@
        that calls &#39;unsafePerformIO&#39;.  If the call is inlined,
        the I\/O may be performed more than once.

  * Use the compiler flag @-fno-cse@ to prevent common sub-expression
        elimination being performed on the module, which might combine
        two side effects that were meant to be separate.  A good example
        is using multiple global variables (like @test@ in the example below).

  * Make sure that the either you switch off let-floating (@-fno-full-laziness@), or that the 
        call to &#39;unsafePerformIO&#39; cannot float outside a lambda.  For example, 
        if you say:
        @
           f x = unsafePerformIO (newIORef [])
        @
        you may get only one reference cell shared between all calls to @f@.
        Better would be
        @
           f x = unsafePerformIO (newIORef [x])
        @
        because now it can&#39;t float outside the lambda.

It is less well known that
&#39;unsafePerformIO&#39; is not type safe.  For example:

&gt;     test :: IORef [a]
&gt;     test = unsafePerformIO $ newIORef []
&gt;     
&gt;     main = do
&gt;             writeIORef test [42]
&gt;             bang &lt;- readIORef test
&gt;             print (bang :: [Char])

This program will core dump.  This problem with polymorphic references
is well known in the ML community, and does not arise with normal
monadic use of references.  There is no easy way to make it impossible
once you use &#39;unsafePerformIO&#39;.  Indeed, it is
possible to write @coerce :: a -&gt; b@ with the
help of &#39;unsafePerformIO&#39;.  So be careful!
-}</span></span><span class="mpre">
</span><a href="#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_16&#39;)"><span class="mpre">unsafePerformIO</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_165_1_165_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_16&#39;)"><span class="hl_fundecl"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><a name="loc_165_17_165_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_17_165_18&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><a href="#loc_182_1_182_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_23&#39;)"><span class="hl_varref"><span class="mpre">unsafeDupablePerformIO</span></span></a><span class="mpre"> (</span><a href="#loc_252_1_252_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_1_252_12&#39;)"><span class="hl_varref"><span class="mpre">noDuplicate</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_165_17_165_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_17_165_18&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">{-| 
This version of &#39;unsafePerformIO&#39; is more efficient
because it omits the check that the IO is only being performed by a
single thread.  Hence, when you use &#39;unsafeDupablePerformIO&#39;,
there is a possibility that the IO action may be performed multiple
times (on a multiprocessor), and you should therefore ensure that
it gives the same results each time. It may even happen that one
of the duplicated IO actions is only run partially, and then interrupted
in the middle without an exception being raised. Therefore, functions
like &#39;bracket&#39; cannot be used safely within &#39;unsafeDupablePerformIO&#39;.

/Since: 4.4.0.0/
-}</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_182_1_182_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_23&#39;)"><span class="mpre">unsafeDupablePerformIO</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_182_1_182_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_23&#39;)"><span class="mpre">unsafeDupablePerformIO</span></a><span class="mpre">  :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_182_1_182_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_23&#39;)"><span class="hl_fundecl"><span class="mpre">unsafeDupablePerformIO</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><a name="loc_182_28_182_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_28_182_29&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">lazy</span></span><span class="mpre"> (case </span><a href="#loc_182_28_182_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_28_182_29&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">realWorld#</span></span><span class="mpre"> of (# _, </span><a name="loc_182_66_182_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_66_182_67&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> #) -&gt; </span><a href="#loc_182_66_182_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_66_182_67&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- Why do we NOINLINE unsafeDupablePerformIO?  See the comment with</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- GHC.ST.runST.  Essentially the issue is that the IO computation</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- inside unsafePerformIO must be atomic: it must either all run, or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- not at all.  If we let the compiler see the application of the IO</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to realWorld#, it might float out part of the IO.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Why is there a call to &#39;lazy&#39; in unsafeDupablePerformIO?</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If we don&#39;t have it, the demand analyser discovers the following strictness</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- for unsafeDupablePerformIO:  C(U(AV))</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- But then consider</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      unsafeDupablePerformIO (\s -&gt; let r = f x in </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--                             case writeIORef v r s of (# s1, _ #) -&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--                             (# s1, r #)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The strictness analyser will find that the binding for r is strict,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (because of uPIO&#39;s strictness sig), and so it&#39;ll evaluate it before </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- doing the writeIORef.  This actually makes tests/lib/should_run/memo002</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- get a deadlock!  </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Solution: don&#39;t expose the strictness of unsafeDupablePerformIO,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--           by hiding it with &#39;lazy&#39;</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-|
&#39;unsafeInterleaveIO&#39; allows &#39;IO&#39; computation to be deferred lazily.
When passed a value of type @IO a@, the &#39;IO&#39; will only be performed
when the value of the @a@ is demanded.  This is used to implement lazy
file reading, see &#39;System.IO.hGetContents&#39;.
-}</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_213_1_213_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_1_213_19&#39;)"><span class="mpre">unsafeInterleaveIO</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_213_1_213_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_1_213_19&#39;)"><span class="mpre">unsafeInterleaveIO</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_213_1_213_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_1_213_19&#39;)"><span class="hl_fundecl"><span class="mpre">unsafeInterleaveIO</span></span></a><span class="mpre"> </span><a name="loc_213_20_213_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_20_213_21&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><a href="#loc_235_1_235_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_1_235_26&#39;)"><span class="hl_varref"><span class="mpre">unsafeDupableInterleaveIO</span></span></a><span class="mpre"> (</span><a href="#loc_252_1_252_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_1_252_12&#39;)"><span class="hl_varref"><span class="mpre">noDuplicate</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_213_20_213_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_20_213_21&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- We used to believe that INLINE on unsafeInterleaveIO was safe,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- because the state from this IO thread is passed explicitly to the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- interleaved IO, so it cannot be floated out and shared.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- HOWEVER, if the compiler figures out that r is used strictly here,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- then it will eliminate the thunk and the side effects in m will no</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- longer be shared in the way the programmer was probably expecting,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- but can be performed many times.  In #5943, this broke our</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- definition of fixIO, which contains</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    ans &lt;- unsafeInterleaveIO (takeMVar m)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- after inlining, we lose the sharing of the takeMVar, so the second</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- time &#39;ans&#39; was demanded we got a deadlock.  We could fix this with</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a readMVar, but it seems wrong for unsafeInterleaveIO to sometimes</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- share and sometimes not (plus it probably breaks the noDuplicate).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- So now, we do not inline unsafeDupableInterleaveIO.</span></span><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_235_1_235_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_1_235_26&#39;)"><span class="mpre">unsafeDupableInterleaveIO</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_235_1_235_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_1_235_26&#39;)"><span class="mpre">unsafeDupableInterleaveIO</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_235_1_235_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_1_235_26&#39;)"><span class="hl_fundecl"><span class="mpre">unsafeDupableInterleaveIO</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><a name="loc_235_31_235_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_31_235_32&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">)
  = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> ( \ </span><a name="loc_236_12_236_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_236_12_236_13&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; let
                   </span><a name="loc_237_20_237_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_20_237_21&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = case </span><a href="#loc_235_31_235_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_235_31_235_32&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_236_12_236_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_236_12_236_13&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of (# _, </span><a name="loc_237_42_237_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_42_237_45&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> #) -&gt; </span><a href="#loc_237_42_237_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_42_237_45&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">
                in
                (# </span><a href="#loc_236_12_236_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_236_12_236_13&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">, </span><a href="#loc_237_20_237_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_237_20_237_21&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> #))

</span><span class="hl_comment"><span class="mpre">{-| 
Ensures that the suspensions under evaluation by the current thread
are unique; that is, the current thread is not evaluating anything
that is also under evaluation by another thread that has also executed
&#39;noDuplicate&#39;.

This operation is used in the definition of &#39;unsafePerformIO&#39; to
prevent the IO action from being executed multiple times, which is usually
undesirable.
-}</span></span><span class="mpre">
</span><a href="#loc_252_1_252_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_1_252_12&#39;)"><span class="mpre">noDuplicate</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_252_1_252_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_1_252_12&#39;)"><span class="hl_vardecl"><span class="mpre">noDuplicate</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_252_21_252_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_21_252_22&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; case </span><span class="hl_varref"><span class="mpre">noDuplicate#</span></span><span class="mpre"> </span><a href="#loc_252_21_252_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_21_252_22&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of </span><a name="loc_252_49_252_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_49_252_51&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre"> -&gt; (# </span><a href="#loc_252_49_252_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_252_49_252_51&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> #)

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | File and directory names are values of type &#39;String&#39;, whose precise</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- meaning is operating system dependent. Files can be opened, yielding a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- handle which can then be used to operate on the contents of that file.</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 259, srcSpanStartColumn = 1, srcSpanEndLine = 259, srcSpanEndColumn = 23}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 259, srcSpanStartColumn = 1, srcSpanEndLine = 259, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 259, srcSpanStartColumn = 15, srcS"><span class="mpre">type FilePath = String</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Primitive catch and throwIO</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-
catchException used to handle the passing around of the state to the
action and the handler.  This turned out to be a bad idea - it meant
that we had to wrap both arguments in thunks so they could be entered
as normal (remember IO returns an unboxed pair...).

Now catch# has type

    catch# :: IO a -&gt; (b -&gt; IO a) -&gt; IO a

(well almost; the compiler doesn&#39;t know about the IO newtype so we
have to work around that in the definition of catchException below).
-}</span></span><span class="mpre">

</span><a href="#loc_279_1_279_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_1_279_15&#39;)"><span class="mpre">catchException</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 278, srcSpanStartColumn = 19, srcSpanEndLine = 278, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 278, srcSpanStartColumn = 31, srcSpanEndLine = 278, srcSpanEndColumn = 33}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStar"><span class="mpre">Exception e =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_279_1_279_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_1_279_15&#39;)"><span class="hl_fundecl"><span class="mpre">catchException</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><a name="loc_279_20_279_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_20_279_22&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre">) </span><a name="loc_279_24_279_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_24_279_31&#39;)"><span class="hl_vardecl"><span class="mpre">handler</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">catch#</span></span><span class="mpre"> </span><a href="#loc_279_20_279_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_20_279_22&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_280_11_280_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_11_280_19&#39;)"><span class="hl_varref"><span class="mpre">handler&#39;</span></span></a><span class="mpre">
    where </span><a name="loc_280_11_280_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_11_280_19&#39;)"><span class="hl_fundecl"><span class="mpre">handler&#39;</span></span></a><span class="mpre"> </span><a name="loc_280_20_280_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_20_280_21&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> = case </span><span class="hl_varref"><span class="mpre">fromException</span></span><span class="mpre"> </span><a href="#loc_280_20_280_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_20_280_21&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> of
                       </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_281_29_281_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_29_281_31&#39;)"><span class="hl_vardecl"><span class="mpre">e&#39;</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">unIO</span></span><span class="mpre"> (</span><a href="#loc_279_24_279_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_24_279_31&#39;)"><span class="hl_varref"><span class="mpre">handler</span></span></a><span class="mpre"> </span><a href="#loc_281_29_281_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_29_281_31&#39;)"><span class="hl_varref"><span class="mpre">e&#39;</span></span></a><span class="mpre">)
                       </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">raiseIO#</span></span><span class="mpre"> </span><a href="#loc_280_20_280_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_20_280_21&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">

</span><a href="#loc_285_1_285_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_285_1_285_9&#39;)"><span class="mpre">catchAny</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (forall </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> . </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 284, srcSpanStartColumn = 33, srcSpanEndLine = 284, srcSpanEndColumn = 47}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 284, srcSpanStartColumn = 45, srcSpanEndLine = 284, srcSpanEndColumn = 47}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStar"><span class="mpre">Exception e =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_285_1_285_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_285_1_285_9&#39;)"><span class="hl_fundecl"><span class="mpre">catchAny</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><a name="loc_285_14_285_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_285_14_285_16&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre">) </span><a name="loc_285_18_285_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_285_18_285_25&#39;)"><span class="hl_vardecl"><span class="mpre">handler</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">catch#</span></span><span class="mpre"> </span><a href="#loc_285_14_285_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_285_14_285_16&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_286_11_286_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_11_286_19&#39;)"><span class="hl_varref"><span class="mpre">handler&#39;</span></span></a><span class="mpre">
    where </span><a name="loc_286_11_286_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_11_286_19&#39;)"><span class="hl_fundecl"><span class="mpre">handler&#39;</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">SomeException</span></span><span class="mpre"> </span><a name="loc_286_35_286_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_35_286_36&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">unIO</span></span><span class="mpre"> (</span><a href="#loc_285_18_285_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_285_18_285_25&#39;)"><span class="hl_varref"><span class="mpre">handler</span></span></a><span class="mpre"> </span><a href="#loc_286_35_286_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_35_286_36&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | A variant of &#39;throw&#39; that can only be used within the &#39;IO&#39; monad.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Although &#39;throwIO&#39; has a type that is an instance of the type of &#39;throw&#39;, the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- two functions are subtly different:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; throw e   `seq` x  ===&gt; throw e</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; throwIO e `seq` x  ===&gt; x</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The first example will cause the exception @e@ to be raised,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- whereas the second one won\&#39;t.  In fact, &#39;throwIO&#39; will only cause</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- an exception to be raised when it is used within the &#39;IO&#39; monad.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The &#39;throwIO&#39; variant should be used in preference to &#39;throw&#39; to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- raise an exception within the &#39;IO&#39; monad because it guarantees</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ordering with respect to other &#39;IO&#39; operations, whereas &#39;throw&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- does not.</span></span><span class="mpre">
</span><a href="#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_1_304_8&#39;)"><span class="mpre">throwIO</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 303, srcSpanStartColumn = 12, srcSpanEndLine = 303, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 303, srcSpanStartColumn = 24, srcSpanEndLine = 303, srcSpanEndColumn = 26}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStar"><span class="mpre">Exception e =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_304_1_304_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_1_304_8&#39;)"><span class="hl_fundecl"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a name="loc_304_9_304_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_9_304_10&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">raiseIO#</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">toException</span></span><span class="mpre"> </span><a href="#loc_304_9_304_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_9_304_10&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">))

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Controlling asynchronous exception delivery</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Applying &#39;block&#39; to a computation will</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- execute that computation with asynchronous exceptions</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /blocked/.  That is, any thread which</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- attempts to raise an exception in the current thread with &#39;Control.Exception.throwTo&#39; will be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- blocked until asynchronous exceptions are unblocked again.  There\&#39;s</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- no need to worry about re-enabling asynchronous exceptions; that is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- done automatically on exiting the scope of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;block&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Threads created by &#39;Control.Concurrent.forkIO&#39; inherit the blocked</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- state from the parent; that is, to start a thread in blocked mode,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- use @block $ forkIO ...@.  This is particularly useful if you need to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- establish an exception handler in the forked thread before any</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- asynchronous exceptions are received.</span></span><span class="mpre">
</span><a href="#loc_324_1_324_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_6&#39;)"><span class="mpre">block</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_324_1_324_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_6&#39;)"><span class="hl_fundecl"><span class="mpre">block</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><a name="loc_324_11_324_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_11_324_13&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">maskAsyncExceptions#</span></span><span class="mpre"> </span><a href="#loc_324_11_324_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_11_324_13&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- To re-enable asynchronous exceptions inside the scope of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;block&#39;, &#39;unblock&#39; can be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- used.  It scopes in exactly the same way, so on exit from</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;unblock&#39; asynchronous exception delivery will</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- be disabled again.</span></span><span class="mpre">
</span><a href="#loc_332_1_332_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_1_332_8&#39;)"><span class="mpre">unblock</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_332_1_332_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_1_332_8&#39;)"><span class="hl_vardecl"><span class="mpre">unblock</span></span></a><span class="mpre"> = </span><a href="#loc_335_1_335_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_1_335_13&#39;)"><span class="hl_varref"><span class="mpre">unsafeUnmask</span></span></a><span class="mpre">

</span><a href="#loc_335_1_335_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_1_335_13&#39;)"><span class="mpre">unsafeUnmask</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_335_1_335_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_1_335_13&#39;)"><span class="hl_fundecl"><span class="mpre">unsafeUnmask</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><a name="loc_335_18_335_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_18_335_20&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">unmaskAsyncExceptions#</span></span><span class="mpre"> </span><a href="#loc_335_18_335_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_335_18_335_20&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre">

</span><a href="#loc_338_1_338_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_1_338_21&#39;)"><span class="mpre">blockUninterruptible</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_338_1_338_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_1_338_21&#39;)"><span class="hl_fundecl"><span class="mpre">blockUninterruptible</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><a name="loc_338_26_338_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_26_338_28&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">maskUninterruptible#</span></span><span class="mpre"> </span><a href="#loc_338_26_338_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_26_338_28&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Describes the behaviour of a thread when an asynchronous</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exception is received.</span></span><span class="mpre">
data </span><a name="loc_342_6_342_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_6_342_18&#39;)"><span class="hl_tycondecl"><span class="mpre">MaskingState</span></span></a><span class="mpre">
  = </span><a name="loc_343_5_343_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_5_343_13&#39;)"><span class="hl_condecl"><span class="mpre">Unmasked</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ asynchronous exceptions are unmasked (the normal state)</span></span><span class="mpre">
  | </span><a name="loc_344_5_344_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_5_344_24&#39;)"><span class="hl_condecl"><span class="mpre">MaskedInterruptible</span></span></a><span class="mpre"> 
      </span><span class="hl_comment"><span class="mpre">-- ^ the state during &#39;mask&#39;: asynchronous exceptions are masked, but blocking operations may still be interrupted</span></span><span class="mpre">
  | </span><a name="loc_346_5_346_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_346_5_346_26&#39;)"><span class="hl_condecl"><span class="mpre">MaskedUninterruptible</span></span></a><span class="mpre">
      </span><span class="hl_comment"><span class="mpre">-- ^ the state during &#39;uninterruptibleMask&#39;: asynchronous exceptions are masked, and blocking operations may not be interrupted</span></span><span class="mpre">
 </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 348, srcSpanStartColumn = 2, srcSpanEndLine = 348, srcSpanEndColumn = 20}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 348, srcSpanStartColumn = 2, srcSpanEndLine = 348, srcSpanEndColumn = 10},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO.hs&quot;, srcSpanStartLine = 348, srcSpanStartColumn = 11, src"><span class="mpre">deriving (Eq,Show)</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Returns the &#39;MaskingState&#39; for the current thread.</span></span><span class="mpre">
</span><a href="#loc_352_1_352_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_1_352_16&#39;)"><span class="mpre">getMaskingState</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_342_6_342_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_6_342_18&#39;)"><span class="hl_tyconref"><span class="mpre">MaskingState</span></span></a><span class="mpre">
</span><a name="loc_352_1_352_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_1_352_16&#39;)"><span class="hl_vardecl"><span class="mpre">getMaskingState</span></span></a><span class="mpre">  = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_352_26_352_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_26_352_27&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; 
  case </span><span class="hl_varref"><span class="mpre">getMaskingState#</span></span><span class="mpre"> </span><a href="#loc_352_26_352_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_26_352_27&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
     (# </span><a name="loc_354_9_354_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_9_354_11&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a name="loc_354_13_354_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_13_354_14&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> #) -&gt; (# </span><a href="#loc_354_9_354_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_9_354_11&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">, case </span><a href="#loc_354_13_354_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_354_13_354_14&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> of
                             0# -&gt; </span><a href="#loc_343_5_343_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_5_343_13&#39;)"><span class="hl_conref"><span class="mpre">Unmasked</span></span></a><span class="mpre">
                             1# -&gt; </span><a href="#loc_346_5_346_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_346_5_346_26&#39;)"><span class="hl_conref"><span class="mpre">MaskedUninterruptible</span></span></a><span class="mpre">
                             _  -&gt; </span><a href="#loc_344_5_344_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_5_344_24&#39;)"><span class="hl_conref"><span class="mpre">MaskedInterruptible</span></span></a><span class="mpre"> #)

</span><a href="#loc_360_1_360_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_1_360_12&#39;)"><span class="mpre">onException</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_360_1_360_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_1_360_12&#39;)"><span class="hl_fundecl"><span class="mpre">onException</span></span></a><span class="mpre"> </span><a name="loc_360_13_360_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_13_360_15&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> </span><a name="loc_360_16_360_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_16_360_20&#39;)"><span class="hl_vardecl"><span class="mpre">what</span></span></a><span class="mpre"> = </span><a href="#loc_360_13_360_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_13_360_15&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_279_1_279_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_1_279_15&#39;)"><span class="hl_infix"><span class="mpre">`catchException`</span></span></a><span class="mpre"> \</span><a name="loc_360_44_360_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_44_360_45&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; do _ &lt;- </span><a href="#loc_360_16_360_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_16_360_20&#39;)"><span class="hl_varref"><span class="mpre">what</span></span></a><span class="mpre">
                                                   </span><a href="#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> (</span><a href="#loc_360_44_360_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_44_360_45&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">SomeException</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Executes an IO computation with asynchronous</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exceptions /masked/.  That is, any thread which attempts to raise</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- an exception in the current thread with &#39;Control.Exception.throwTo&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- will be blocked until asynchronous exceptions are unmasked again.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The argument passed to &#39;mask&#39; is a function that takes as its</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- argument another function, which can be used to restore the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- prevailing masking state within the context of the masked</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- computation.  For example, a common way to use &#39;mask&#39; is to protect</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the acquisition of a resource:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; mask $ \restore -&gt; do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;     x &lt;- acquire</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;     restore (do_something_with x) `onException` release</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;     release</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This code guarantees that @acquire@ is paired with @release@, by masking</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- asynchronous exceptions for the critical parts. (Rather than write</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- this code yourself, it would be better to use</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Control.Exception.bracket&#39; which abstracts the general pattern).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that the @restore@ action passed to the argument to &#39;mask&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- does not necessarily unmask asynchronous exceptions, it just</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- restores the masking state to that of the enclosing context.  Thus</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- if asynchronous exceptions are already masked, &#39;mask&#39; cannot be used</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to unmask exceptions again.  This is so that if you call a library function</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- with exceptions masked, you can be sure that the library call will not be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- able to unmask exceptions again.  If you are writing library code and need</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to use asynchronous exceptions, the only way is to create a new thread;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- see &#39;Control.Concurrent.forkIOWithUnmask&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Asynchronous exceptions may still be received while in the masked</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- state if the masked thread /blocks/ in certain ways; see</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;Control.Exception#interruptible&quot;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Threads created by &#39;Control.Concurrent.forkIO&#39; inherit the masked</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- state from the parent; that is, to start a thread in blocked mode,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- use @mask_ $ forkIO ...@.  This is particularly useful if you need</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to establish an exception handler in the forked thread before any</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- asynchronous exceptions are received.  To create a a new thread in</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- an unmasked state use &#39;Control.Concurrent.forkIOUnmasked&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><a href="#loc_428_1_428_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_1_428_5&#39;)"><span class="mpre">mask</span></a><span class="mpre">  :: ((forall </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">. </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Like &#39;mask&#39;, but does not pass a @restore@ action to the argument.</span></span><span class="mpre">
</span><a href="#loc_426_1_426_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_426_1_426_6&#39;)"><span class="mpre">mask_</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Like &#39;mask&#39;, but the masked computation is not interruptible (see</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;Control.Exception#interruptible&quot;).  THIS SHOULD BE USED WITH</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- GREAT CARE, because if a thread executing in &#39;uninterruptibleMask&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- blocks for any reason, then the thread (and possibly the program,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- if this is the main thread) will be unresponsive and unkillable.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This function should only be necessary if you need to mask</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exceptions around an interruptible operation, and you can guarantee</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- that the interruptible operation will only block for a short period</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- of time.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_436_1_436_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_436_1_436_20&#39;)"><span class="mpre">uninterruptibleMask</span></a><span class="mpre"> :: ((forall </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">. </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Like &#39;uninterruptibleMask&#39;, but does not pass a @restore@ action</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to the argument.</span></span><span class="mpre">
</span><a href="#loc_434_1_434_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_1_434_21&#39;)"><span class="mpre">uninterruptibleMask_</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">

</span><a name="loc_426_1_426_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_426_1_426_6&#39;)"><span class="hl_fundecl"><span class="mpre">mask_</span></span></a><span class="mpre"> </span><a name="loc_426_7_426_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_426_7_426_9&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> = </span><a href="#loc_428_1_428_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_1_428_5&#39;)"><span class="hl_varref"><span class="mpre">mask</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \_ -&gt; </span><a href="#loc_426_7_426_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_426_7_426_9&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre">

</span><a name="loc_428_1_428_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_1_428_5&#39;)"><span class="hl_fundecl"><span class="mpre">mask</span></span></a><span class="mpre"> </span><a name="loc_428_6_428_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_6_428_8&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> = do
  </span><a name="loc_429_3_429_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_429_3_429_4&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_352_1_352_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_1_352_16&#39;)"><span class="hl_varref"><span class="mpre">getMaskingState</span></span></a><span class="mpre">
  case </span><a href="#loc_429_3_429_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_429_3_429_4&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> of
    </span><a href="#loc_343_5_343_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_5_343_13&#39;)"><span class="hl_conref"><span class="mpre">Unmasked</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_324_1_324_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_6&#39;)"><span class="hl_varref"><span class="mpre">block</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_428_6_428_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_6_428_8&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_332_1_332_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_1_332_8&#39;)"><span class="hl_varref"><span class="mpre">unblock</span></span></a><span class="mpre">
    _        -&gt; </span><a href="#loc_428_6_428_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_6_428_8&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">

</span><a name="loc_434_1_434_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_1_434_21&#39;)"><span class="hl_fundecl"><span class="mpre">uninterruptibleMask_</span></span></a><span class="mpre"> </span><a name="loc_434_22_434_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_22_434_24&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> = </span><a href="#loc_436_1_436_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_436_1_436_20&#39;)"><span class="hl_varref"><span class="mpre">uninterruptibleMask</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \_ -&gt; </span><a href="#loc_434_22_434_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_434_22_434_24&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre">

</span><a name="loc_436_1_436_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_436_1_436_20&#39;)"><span class="hl_fundecl"><span class="mpre">uninterruptibleMask</span></span></a><span class="mpre"> </span><a name="loc_436_21_436_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_436_21_436_23&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> = do
  </span><a name="loc_437_3_437_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_437_3_437_4&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_352_1_352_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_1_352_16&#39;)"><span class="hl_varref"><span class="mpre">getMaskingState</span></span></a><span class="mpre">
  case </span><a href="#loc_437_3_437_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_437_3_437_4&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> of
    </span><a href="#loc_343_5_343_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_5_343_13&#39;)"><span class="hl_conref"><span class="mpre">Unmasked</span></span></a><span class="mpre">              -&gt; </span><a href="#loc_338_1_338_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_1_338_21&#39;)"><span class="hl_varref"><span class="mpre">blockUninterruptible</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_436_21_436_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_436_21_436_23&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_332_1_332_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_332_1_332_8&#39;)"><span class="hl_varref"><span class="mpre">unblock</span></span></a><span class="mpre">
    </span><a href="#loc_344_5_344_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_5_344_24&#39;)"><span class="hl_conref"><span class="mpre">MaskedInterruptible</span></span></a><span class="mpre">   -&gt; </span><a href="#loc_338_1_338_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_338_1_338_21&#39;)"><span class="hl_varref"><span class="mpre">blockUninterruptible</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_436_21_436_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_436_21_436_23&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_324_1_324_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_1_324_6&#39;)"><span class="hl_varref"><span class="mpre">block</span></span></a><span class="mpre">
    </span><a href="#loc_346_5_346_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_346_5_346_26&#39;)"><span class="hl_conref"><span class="mpre">MaskedUninterruptible</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_436_21_436_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_436_21_436_23&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">

</span><a href="#loc_448_1_448_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_1_448_8&#39;)"><span class="mpre">bracket</span></a><span class="mpre">
        :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">         </span><span class="hl_comment"><span class="mpre">-- ^ computation to run first (\&quot;acquire resource\&quot;)</span></span><span class="mpre">
        -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)  </span><span class="hl_comment"><span class="mpre">-- ^ computation to run last (\&quot;release resource\&quot;)</span></span><span class="mpre">
        -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">)  </span><span class="hl_comment"><span class="mpre">-- ^ computation to run in-between</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">c</span></span><span class="mpre">         </span><span class="hl_comment"><span class="mpre">-- returns the value from the in-between computation</span></span><span class="mpre">
</span><a name="loc_448_1_448_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_1_448_8&#39;)"><span class="hl_fundecl"><span class="mpre">bracket</span></span></a><span class="mpre"> </span><a name="loc_448_9_448_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_9_448_15&#39;)"><span class="hl_vardecl"><span class="mpre">before</span></span></a><span class="mpre"> </span><a name="loc_448_16_448_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_16_448_21&#39;)"><span class="hl_vardecl"><span class="mpre">after</span></span></a><span class="mpre"> </span><a name="loc_448_22_448_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_22_448_27&#39;)"><span class="hl_vardecl"><span class="mpre">thing</span></span></a><span class="mpre"> =
  </span><a href="#loc_428_1_428_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_1_428_5&#39;)"><span class="hl_varref"><span class="mpre">mask</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_449_11_449_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_449_11_449_18&#39;)"><span class="hl_vardecl"><span class="mpre">restore</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_450_5_450_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_450_5_450_6&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_448_9_448_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_9_448_15&#39;)"><span class="hl_varref"><span class="mpre">before</span></span></a><span class="mpre">
    </span><a name="loc_451_5_451_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_451_5_451_6&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_449_11_449_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_449_11_449_18&#39;)"><span class="hl_varref"><span class="mpre">restore</span></span></a><span class="mpre"> (</span><a href="#loc_448_22_448_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_22_448_27&#39;)"><span class="hl_varref"><span class="mpre">thing</span></span></a><span class="mpre"> </span><a href="#loc_450_5_450_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_450_5_450_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">) </span><a href="#loc_360_1_360_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_1_360_12&#39;)"><span class="hl_infix"><span class="mpre">`onException`</span></span></a><span class="mpre"> </span><a href="#loc_448_16_448_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_16_448_21&#39;)"><span class="hl_varref"><span class="mpre">after</span></span></a><span class="mpre"> </span><a href="#loc_450_5_450_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_450_5_450_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
    _ &lt;- </span><a href="#loc_448_16_448_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_448_16_448_21&#39;)"><span class="hl_varref"><span class="mpre">after</span></span></a><span class="mpre"> </span><a href="#loc_450_5_450_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_450_5_450_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_451_5_451_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_451_5_451_6&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

</span><a href="#loc_459_3_459_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_459_3_459_12&#39;)"><span class="mpre">finally</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">         </span><span class="hl_comment"><span class="mpre">-- ^ computation to run first</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">         </span><span class="hl_comment"><span class="mpre">-- ^ computation to run afterward (even if an exception</span></span><span class="mpre">
                        </span><span class="hl_comment"><span class="mpre">-- was raised)</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">         </span><span class="hl_comment"><span class="mpre">-- returns the value from the first computation</span></span><span class="mpre">
</span><a name="loc_459_1_459_2" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_459_1_459_2&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> </span><a name="loc_459_3_459_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_459_3_459_12&#39;)"><span class="hl_fundecl"><span class="mpre">`finally`</span></span></a><span class="mpre"> </span><a name="loc_459_13_459_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_459_13_459_19&#39;)"><span class="hl_vardecl"><span class="mpre">sequel</span></span></a><span class="mpre"> =
  </span><a href="#loc_428_1_428_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_1_428_5&#39;)"><span class="hl_varref"><span class="mpre">mask</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_460_11_460_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_460_11_460_18&#39;)"><span class="hl_vardecl"><span class="mpre">restore</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_461_5_461_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_461_5_461_6&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_460_11_460_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_460_11_460_18&#39;)"><span class="hl_varref"><span class="mpre">restore</span></span></a><span class="mpre"> </span><a href="#loc_459_1_459_2" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_459_1_459_2&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><a href="#loc_360_1_360_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_360_1_360_12&#39;)"><span class="hl_infix"><span class="mpre">`onException`</span></span></a><span class="mpre"> </span><a href="#loc_459_13_459_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_459_13_459_19&#39;)"><span class="hl_varref"><span class="mpre">sequel</span></span></a><span class="mpre">
    _ &lt;- </span><a href="#loc_459_13_459_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_459_13_459_19&#39;)"><span class="hl_varref"><span class="mpre">sequel</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_461_5_461_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_461_5_461_6&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Forces its argument to be evaluated to weak head normal form when</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the resultant &#39;IO&#39; action is executed. It can be used to order</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- evaluation with respect to other &#39;IO&#39; operations; its semantics are</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- given by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;   evaluate x `seq` y    ==&gt;  y</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;   evaluate x `catch` f  ==&gt;  (return $! x) `catch` f</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;   evaluate x &gt;&gt;= f      ==&gt;  (return $! x) &gt;&gt;= f</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /Note:/ the first equation implies that @(evaluate x)@ is /not/ the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- same as @(return $! x)@.  A correct definition is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt;   evaluate x = (return $! x) &gt;&gt;= return</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_480_1_480_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_480_1_480_9&#39;)"><span class="mpre">evaluate</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_480_1_480_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_480_1_480_9&#39;)"><span class="hl_fundecl"><span class="mpre">evaluate</span></span></a><span class="mpre"> </span><a name="loc_480_10_480_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_480_10_480_11&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_480_20_480_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_480_20_480_21&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">seq#</span></span><span class="mpre"> </span><a href="#loc_480_10_480_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_480_10_480_11&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><a href="#loc_480_20_480_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_480_20_480_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- NB. see #2273, #5129</span></span><span class="mpre">

</span></div></body></html>