<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Network.TLS.Receiving</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the Receiving module contains calls related to unmarshalling packets according</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to the TLS state</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Network.TLS.Receiving
    ( processPacket
    ) where

import Control.Monad.State
import Control.Monad.Error
import Control.Concurrent.MVar

import Network.TLS.Context.Internal
import Network.TLS.Struct
import Network.TLS.Record
import Network.TLS.Packet
import Network.TLS.Wire
import Network.TLS.State
import Network.TLS.Handshake.State
import Network.TLS.Cipher
import Network.TLS.Util

import Data.Byteable

</span><a href="#loc_33_1_33_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_14&#39;)"><span class="mpre">processPacket</span></a><span class="mpre"> :: </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Record.Types.html#loc_47_6_47_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Record.Types.html#loc_47_6_47_12&#39;)"><span class="hl_tyconref"><span class="mpre">Record</span></span></a><span class="mpre"> </span><a href="Network.TLS.Record.Types.html#loc_51_6_51_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Record.Types.html#loc_51_6_51_15&#39;)"><span class="hl_tyconref"><span class="mpre">Plaintext</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_121_6_121_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_121_6_121_14&#39;)"><span class="hl_tyconref"><span class="mpre">TLSError</span></span></a><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_150_6_150_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_150_6_150_12&#39;)"><span class="hl_tyconref"><span class="mpre">Packet</span></span></a><span class="mpre">)

</span><a name="loc_33_1_33_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_14&#39;)"><span class="hl_fundecl"><span class="mpre">processPacket</span></span></a><span class="mpre"> _ (</span><span class="hl_conref"><span class="mpre">Record</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_116_7_116_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_116_7_116_27&#39;)"><span class="hl_conref"><span class="mpre">ProtocolType_AppData</span></span></a><span class="mpre"> _ </span><a name="loc_33_48_33_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_48_33_56&#39;)"><span class="hl_vardecl"><span class="mpre">fragment</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_154_7_154_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_154_7_154_14&#39;)"><span class="hl_conref"><span class="mpre">AppData</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Byteable.html#loc_24_5_24_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Byteable.html#loc_24_5_24_12&#39;)"><span class="hl_varref"><span class="mpre">toBytes</span></span></a><span class="mpre"> </span><a href="#loc_33_48_33_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_48_33_56&#39;)"><span class="hl_varref"><span class="mpre">fragment</span></span></a><span class="mpre">

</span><a href="#loc_33_1_33_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_14&#39;)"><span class="hl_fundecl"><span class="mpre">processPacket</span></span></a><span class="mpre"> _ (</span><span class="hl_conref"><span class="mpre">Record</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_114_7_114_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_114_7_114_25&#39;)"><span class="hl_conref"><span class="mpre">ProtocolType_Alert</span></span></a><span class="mpre"> _ </span><a name="loc_35_46_35_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_46_35_54&#39;)"><span class="hl_vardecl"><span class="mpre">fragment</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Network.TLS.Struct.html#loc_152_7_152_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_152_7_152_12&#39;)"><span class="hl_conref"><span class="mpre">Alert</span></span></a><span class="mpre"> </span><a href="Network.TLS.Util.html#loc_76_1_76_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_76_1_76_11&#39;)"><span class="hl_infix"><span class="mpre">`fmapEither`</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Packet.html#loc_150_1_150_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Packet.html#loc_150_1_150_13&#39;)"><span class="hl_varref"><span class="mpre">decodeAlerts</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Byteable.html#loc_24_5_24_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Byteable.html#loc_24_5_24_12&#39;)"><span class="hl_varref"><span class="mpre">toBytes</span></span></a><span class="mpre"> </span><a href="#loc_35_46_35_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_46_35_54&#39;)"><span class="hl_varref"><span class="mpre">fragment</span></span></a><span class="mpre">))

</span><a href="#loc_33_1_33_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_14&#39;)"><span class="hl_fundecl"><span class="mpre">processPacket</span></span></a><span class="mpre"> </span><a name="loc_37_15_37_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_15_37_18&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Record</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_113_7_113_36" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_113_7_113_36&#39;)"><span class="hl_conref"><span class="mpre">ProtocolType_ChangeCipherSpec</span></span></a><span class="mpre"> _ </span><a name="loc_37_59_37_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_59_37_67&#39;)"><span class="hl_vardecl"><span class="mpre">fragment</span></span></a><span class="mpre">) =
    case </span><a href="Network.TLS.Packet.html#loc_484_1_484_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Packet.html#loc_484_1_484_23&#39;)"><span class="hl_varref"><span class="mpre">decodeChangeCipherSpec</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Byteable.html#loc_24_5_24_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Byteable.html#loc_24_5_24_12&#39;)"><span class="hl_varref"><span class="mpre">toBytes</span></span></a><span class="mpre"> </span><a href="#loc_37_59_37_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_59_37_67&#39;)"><span class="hl_varref"><span class="mpre">fragment</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_39_14_39_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_14_39_17&#39;)"><span class="hl_vardecl"><span class="mpre">err</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_39_14_39_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_14_39_17&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> _  -&gt; do </span><a href="#loc_74_1_74_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_19&#39;)"><span class="hl_varref"><span class="mpre">switchRxEncryption</span></span></a><span class="mpre"> </span><a href="#loc_37_15_37_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_15_37_18&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
                       </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_153_7_153_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_153_7_153_23&#39;)"><span class="hl_conref"><span class="mpre">ChangeCipherSpec</span></span></a><span class="mpre">

</span><a href="#loc_33_1_33_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_14&#39;)"><span class="hl_fundecl"><span class="mpre">processPacket</span></span></a><span class="mpre"> </span><a name="loc_43_15_43_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_15_43_18&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Record</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_115_7_115_29" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_115_7_115_29&#39;)"><span class="hl_conref"><span class="mpre">ProtocolType_Handshake</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">ver</span></span><span class="mpre"> </span><a name="loc_43_54_43_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_54_43_62&#39;)"><span class="hl_vardecl"><span class="mpre">fragment</span></span></a><span class="mpre">) = do
    </span><span class="hl_vardecl"><span class="mpre">keyxchg</span></span><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.Internal.html#loc_192_1_192_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_192_1_192_10&#39;)"><span class="hl_varref"><span class="mpre">getHState</span></span></a><span class="mpre"> </span><a href="#loc_43_15_43_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_15_43_18&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> \</span><a name="loc_44_35_44_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_35_44_37&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> (</span><a href="#loc_44_35_44_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_35_44_37&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_78_7_78_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_78_7_78_23&#39;)"><span class="hl_varref"><span class="mpre">hstPendingCipher</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Network.TLS.Cipher.html#loc_87_7_87_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_87_7_87_24&#39;)"><span class="hl_varref"><span class="mpre">cipherKeyExchange</span></span></a><span class="mpre">)
    </span><a href="Network.TLS.Context.Internal.html#loc_177_1_177_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_177_1_177_11&#39;)"><span class="hl_varref"><span class="mpre">usingState</span></span></a><span class="mpre"> </span><a href="#loc_43_15_43_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_15_43_18&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><span class="hl_vardecl"><span class="mpre">npn</span></span><span class="mpre">     &lt;- </span><a href="Network.TLS.State.html#loc_180_1_180_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_180_1_180_16&#39;)"><span class="hl_varref"><span class="mpre">getExtensionNPN</span></span></a><span class="mpre">
        let </span><a name="loc_47_13_47_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_13_47_26&#39;)"><span class="hl_vardecl"><span class="mpre">currentParams</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Receiving.hs&quot;, srcSpanStartLine = 47, srcSpanStartColumn = 29, srcSpanEndLine = 51, srcSpanEndColumn = 30}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Receiving.hs&quot;, srcSpanStartLine = 48, srcSpanStartColumn = 29, srcSpanEndLine = 48, srcSpanEndColumn = 30},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Receiving.hs&quot;, srcSpanStartLine "><span class="mpre">CurrentParams
                            { cParamsVersion     = ver
                            , cParamsKeyXchgType = keyxchg
                            , cParamsSupportNPN  = npn
                            }</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- get back the optional continuation, and parse as many handshake record as possible.</span></span><span class="mpre">
        </span><a name="loc_53_9_53_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_14&#39;)"><span class="hl_vardecl"><span class="mpre">mCont</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_68_7_68_28" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_68_7_68_28&#39;)"><span class="hl_varref"><span class="mpre">stHandshakeRecordCont</span></span></a><span class="mpre">
        </span><a href="Control.Monad.State.Class.html#loc_85_1_85_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_85_1_85_7&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre"> (\</span><span class="hl_vardecl"><span class="mpre">st</span></span><span class="mpre"> -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Receiving.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 24, srcSpanEndLine = 54, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Receiving.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 27, srcSpanEndLine = 54, srcSpanEndColumn = 28},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Receiving.hs&quot;, srcSpanStartLine "><span class="mpre">st { stHandshakeRecordCont = Nothing }</span></span><span class="mpre">)
        </span><a name="loc_55_9_55_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_9_55_12&#39;)"><span class="hl_vardecl"><span class="mpre">hss</span></span></a><span class="mpre">   &lt;- </span><a href="#loc_57_9_57_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_18&#39;)"><span class="hl_varref"><span class="mpre">parseMany</span></span></a><span class="mpre"> </span><a href="#loc_47_13_47_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_13_47_26&#39;)"><span class="hl_varref"><span class="mpre">currentParams</span></span></a><span class="mpre"> </span><a href="#loc_53_9_53_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_9_53_14&#39;)"><span class="hl_varref"><span class="mpre">mCont</span></span></a><span class="mpre"> (</span><a href="Data.Byteable.html#loc_24_5_24_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Byteable.html#loc_24_5_24_12&#39;)"><span class="hl_varref"><span class="mpre">toBytes</span></span></a><span class="mpre"> </span><a href="#loc_43_54_43_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_54_43_62&#39;)"><span class="hl_varref"><span class="mpre">fragment</span></span></a><span class="mpre">)
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_151_7_151_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_151_7_151_16&#39;)"><span class="hl_conref"><span class="mpre">Handshake</span></span></a><span class="mpre"> </span><a href="#loc_55_9_55_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_9_55_12&#39;)"><span class="hl_varref"><span class="mpre">hss</span></span></a><span class="mpre">
  where </span><a name="loc_57_9_57_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_18&#39;)"><span class="hl_fundecl"><span class="mpre">parseMany</span></span></a><span class="mpre"> </span><a name="loc_57_19_57_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_19_57_32&#39;)"><span class="hl_vardecl"><span class="mpre">currentParams</span></span></a><span class="mpre"> </span><a name="loc_57_33_57_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_33_57_38&#39;)"><span class="hl_vardecl"><span class="mpre">mCont</span></span></a><span class="mpre"> </span><a name="loc_57_39_57_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_39_57_41&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> =
            case </span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> </span><a href="Network.TLS.Packet.html#loc_163_1_163_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Packet.html#loc_163_1_163_22&#39;)"><span class="hl_varref"><span class="mpre">decodeHandshakeRecord</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre"> </span><a href="#loc_57_33_57_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_33_57_38&#39;)"><span class="hl_varref"><span class="mpre">mCont</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_57_39_57_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_39_57_41&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> of
                </span><a href="Network.TLS.Wire.html#loc_62_7_62_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Wire.html#loc_62_7_62_15&#39;)"><span class="hl_conref"><span class="mpre">GotError</span></span></a><span class="mpre"> </span><a name="loc_59_26_59_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_26_59_29&#39;)"><span class="hl_vardecl"><span class="mpre">err</span></span></a><span class="mpre">                -&gt; </span><span class="hl_varref"><span class="mpre">throwError</span></span><span class="mpre"> </span><a href="#loc_59_26_59_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_26_59_29&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre">
                </span><a href="Network.TLS.Wire.html#loc_63_7_63_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Wire.html#loc_63_7_63_17&#39;)"><span class="hl_conref"><span class="mpre">GotPartial</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">cont</span></span><span class="mpre">             -&gt; </span><a href="Control.Monad.State.Class.html#loc_85_1_85_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_85_1_85_7&#39;)"><span class="hl_varref"><span class="mpre">modify</span></span></a><span class="mpre"> (\</span><span class="hl_vardecl"><span class="mpre">st</span></span><span class="mpre"> -&gt; </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Receiving.hs&quot;, srcSpanStartLine = 60, srcSpanStartColumn = 63, srcSpanEndLine = 60, srcSpanEndColumn = 103}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Receiving.hs&quot;, srcSpanStartLine = 60, srcSpanStartColumn = 66, srcSpanEndLine = 60, srcSpanEndColumn = 67},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Receiving.hs&quot;, srcSpanStartLine"><span class="mpre">st { stHandshakeRecordCont = Just cont }</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> []
                </span><a href="Network.TLS.Wire.html#loc_64_7_64_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Wire.html#loc_64_7_64_17&#39;)"><span class="hl_conref"><span class="mpre">GotSuccess</span></span></a><span class="mpre"> (</span><a name="loc_61_29_61_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_29_61_31&#39;)"><span class="hl_vardecl"><span class="mpre">ty</span></span></a><span class="mpre">,</span><a name="loc_61_32_61_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_32_61_39&#39;)"><span class="hl_vardecl"><span class="mpre">content</span></span></a><span class="mpre">)     -&gt;
                    </span><span class="hl_varref"><span class="mpre">either</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">throwError</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">[])) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Packet.html#loc_169_1_169_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Packet.html#loc_169_1_169_16&#39;)"><span class="hl_varref"><span class="mpre">decodeHandshake</span></span></a><span class="mpre"> </span><a href="#loc_57_19_57_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_19_57_32&#39;)"><span class="hl_varref"><span class="mpre">currentParams</span></span></a><span class="mpre"> </span><a href="#loc_61_29_61_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_29_61_31&#39;)"><span class="hl_varref"><span class="mpre">ty</span></span></a><span class="mpre"> </span><a href="#loc_61_32_61_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_32_61_39&#39;)"><span class="hl_varref"><span class="mpre">content</span></span></a><span class="mpre">
                </span><a href="Network.TLS.Wire.html#loc_65_7_65_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Wire.html#loc_65_7_65_26&#39;)"><span class="hl_conref"><span class="mpre">GotSuccessRemaining</span></span></a><span class="mpre"> (</span><a name="loc_63_38_63_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_38_63_40&#39;)"><span class="hl_vardecl"><span class="mpre">ty</span></span></a><span class="mpre">,</span><a name="loc_63_41_63_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_41_63_48&#39;)"><span class="hl_vardecl"><span class="mpre">content</span></span></a><span class="mpre">) </span><a name="loc_63_50_63_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_50_63_54&#39;)"><span class="hl_vardecl"><span class="mpre">left</span></span></a><span class="mpre"> -&gt;
                    case </span><a href="Network.TLS.Packet.html#loc_169_1_169_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Packet.html#loc_169_1_169_16&#39;)"><span class="hl_varref"><span class="mpre">decodeHandshake</span></span></a><span class="mpre"> </span><a href="#loc_57_19_57_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_19_57_32&#39;)"><span class="hl_varref"><span class="mpre">currentParams</span></span></a><span class="mpre"> </span><a href="#loc_63_38_63_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_38_63_40&#39;)"><span class="hl_varref"><span class="mpre">ty</span></span></a><span class="mpre"> </span><a href="#loc_63_41_63_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_41_63_48&#39;)"><span class="hl_varref"><span class="mpre">content</span></span></a><span class="mpre"> of
                        </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_65_30_65_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_30_65_33&#39;)"><span class="hl_vardecl"><span class="mpre">err</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">throwError</span></span><span class="mpre"> </span><a href="#loc_65_30_65_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_30_65_33&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre">
                        </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a name="loc_66_31_66_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_31_66_33&#39;)"><span class="hl_vardecl"><span class="mpre">hh</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_66_31_66_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_31_66_33&#39;)"><span class="hl_varref"><span class="mpre">hh</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><a href="#loc_57_9_57_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_9_57_18&#39;)"><span class="hl_varref"><span class="mpre">parseMany</span></span></a><span class="mpre"> </span><a href="#loc_57_19_57_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_19_57_32&#39;)"><span class="hl_varref"><span class="mpre">currentParams</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> </span><a href="#loc_63_50_63_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_50_63_54&#39;)"><span class="hl_varref"><span class="mpre">left</span></span></a><span class="mpre">

</span><a href="#loc_33_1_33_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_14&#39;)"><span class="hl_fundecl"><span class="mpre">processPacket</span></span></a><span class="mpre"> _ (</span><span class="hl_conref"><span class="mpre">Record</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_117_7_117_39" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_117_7_117_39&#39;)"><span class="hl_conref"><span class="mpre">ProtocolType_DeprecatedHandshake</span></span></a><span class="mpre"> _ </span><a name="loc_68_60_68_68" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_60_68_68&#39;)"><span class="hl_vardecl"><span class="mpre">fragment</span></span></a><span class="mpre">) =
    case </span><a href="Network.TLS.Packet.html#loc_185_1_185_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Packet.html#loc_185_1_185_26&#39;)"><span class="hl_varref"><span class="mpre">decodeDeprecatedHandshake</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Byteable.html#loc_24_5_24_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Byteable.html#loc_24_5_24_12&#39;)"><span class="hl_varref"><span class="mpre">toBytes</span></span></a><span class="mpre"> </span><a href="#loc_68_60_68_68" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_60_68_68&#39;)"><span class="hl_varref"><span class="mpre">fragment</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_70_14_70_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_14_70_17&#39;)"><span class="hl_vardecl"><span class="mpre">err</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_70_14_70_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_14_70_17&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a name="loc_71_15_71_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_15_71_17&#39;)"><span class="hl_vardecl"><span class="mpre">hs</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_151_7_151_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_151_7_151_16&#39;)"><span class="hl_conref"><span class="mpre">Handshake</span></span></a><span class="mpre"> [</span><a href="#loc_71_15_71_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_15_71_17&#39;)"><span class="hl_varref"><span class="mpre">hs</span></span></a><span class="mpre">]

</span><a href="#loc_74_1_74_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_19&#39;)"><span class="mpre">switchRxEncryption</span></a><span class="mpre"> :: </span><a href="Network.TLS.Context.Internal.html#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_74_1_74_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_19&#39;)"><span class="hl_fundecl"><span class="mpre">switchRxEncryption</span></span></a><span class="mpre"> </span><a name="loc_74_20_74_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_20_74_23&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> =
    </span><a href="Network.TLS.Context.Internal.html#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_186_1_186_12&#39;)"><span class="hl_varref"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a href="#loc_74_20_74_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_20_74_23&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_77_7_77_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_77_7_77_24&#39;)"><span class="hl_varref"><span class="mpre">hstPendingRxState</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> \</span><a name="loc_75_51_75_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_51_75_53&#39;)"><span class="hl_vardecl"><span class="mpre">rx</span></span></a><span class="mpre"> -&gt;
    </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Concurrent.MVar.html#loc_216_1_216_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_216_1_216_12&#39;)"><span class="hl_varref"><span class="mpre">modifyMVar_</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Context.Internal.html#loc_99_7_99_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.Internal.html#loc_99_7_99_17&#39;)"><span class="hl_varref"><span class="mpre">ctxRxState</span></span></a><span class="mpre"> </span><a href="#loc_74_20_74_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_20_74_23&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) (\_ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Util.html#loc_53_1_53_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Util.html#loc_53_1_53_9&#39;)"><span class="hl_varref"><span class="mpre">fromJust</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;rx-state&quot;</span></span><span class="mpre"> </span><a href="#loc_75_51_75_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_51_75_53&#39;)"><span class="hl_varref"><span class="mpre">rx</span></span></a><span class="mpre">)
</span></div></body></html>