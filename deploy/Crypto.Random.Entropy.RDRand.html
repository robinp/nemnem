<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Crypto.Random.Entropy.RDRand</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : Good</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
{-# LANGUAGE ForeignFunctionInterface #-}
module Crypto.Random.Entropy.RDRand
    ( RDRand
    ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy/RDRand.hs&quot;, srcSpanStartLine = 13, srcSpanStartColumn = 8, srcSpanEndLine = 13, srcSpanEndColumn = 19}, srcInfoPoints = []}) &quot;Foreign.Ptr&quot;"><span class="mpre">Foreign.Ptr</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy/RDRand.hs&quot;, srcSpanStartLine = 14, srcSpanStartColumn = 8, srcSpanEndLine = 14, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Foreign.C.Types&quot;"><span class="mpre">Foreign.C.Types</span></span><span class="mpre">
import Data.Word (Word8)
import Crypto.Random.Entropy.Source

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy/RDRand.hs&quot;, srcSpanStartLine = 18, srcSpanStartColumn = 1, srcSpanEndLine = 19, srcSpanEndColumn = 31}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy/RDRand.hs&quot;, srcSpanStartLine = 18, srcSpanStartColumn = 1, srcSpanEndLine = 18, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto"><span class="mpre">foreign import ccall unsafe &quot;crypto_random_cpu_has_rdrand&quot;
   c_cpu_has_rdrand :: IO CInt</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy/RDRand.hs&quot;, srcSpanStartLine = 21, srcSpanStartColumn = 1, srcSpanEndLine = 22, srcSpanEndColumn = 51}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy/RDRand.hs&quot;, srcSpanStartLine = 21, srcSpanStartColumn = 1, srcSpanEndLine = 21, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto"><span class="mpre">foreign import ccall unsafe &quot;crypto_random_get_rand_bytes&quot;
  c_get_rand_bytes :: Ptr Word8 -&gt; CInt -&gt; IO CInt</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | fake handle to Intel RDRand entropy cpu instruction</span></span><span class="mpre">
data </span><a name="loc_25_6_25_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_6_25_12&#39;)"><span class="hl_tycondecl"><span class="mpre">RDRand</span></span></a><span class="mpre"> = </span><a name="loc_25_15_25_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_15_25_21&#39;)"><span class="hl_condecl"><span class="mpre">RDRand</span></span></a><span class="mpre">

instance </span><a href="Crypto.Random.Entropy.Source.html#loc_15_7_15_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Source.html#loc_15_7_15_20&#39;)"><span class="hl_classref"><span class="mpre">EntropySource</span></span></a><span class="mpre"> </span><a href="#loc_25_6_25_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_6_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">RDRand</span></span></a><span class="mpre"> where
    </span><a href="Crypto.Random.Entropy.Source.html#loc_17_5_17_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Source.html#loc_17_5_17_16&#39;)"><span class="hl_vardecl"><span class="mpre">entropyOpen</span></span></a><span class="mpre">     = </span><a href="#loc_33_1_33_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_11&#39;)"><span class="hl_varref"><span class="mpre">rdrandGrab</span></span></a><span class="mpre">
    </span><a href="Crypto.Random.Entropy.Source.html#loc_20_5_20_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Source.html#loc_20_5_20_18&#39;)"><span class="hl_fundecl"><span class="mpre">entropyGather</span></span></a><span class="mpre"> _ = </span><a href="#loc_38_1_38_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_1_38_15&#39;)"><span class="hl_varref"><span class="mpre">rdrandGetBytes</span></span></a><span class="mpre">
    </span><a href="Crypto.Random.Entropy.Source.html#loc_22_5_22_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Source.html#loc_22_5_22_17&#39;)"><span class="hl_fundecl"><span class="mpre">entropyClose</span></span></a><span class="mpre">  _ = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><a href="#loc_33_1_33_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_11&#39;)"><span class="mpre">rdrandGrab</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="#loc_25_6_25_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_6_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">RDRand</span></span></a><span class="mpre">)
</span><a name="loc_33_1_33_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_1_33_11&#39;)"><span class="hl_vardecl"><span class="mpre">rdrandGrab</span></span></a><span class="mpre"> = </span><a href="#loc_34_9_34_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_9_34_18&#39;)"><span class="hl_varref"><span class="mpre">supported</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">c_cpu_has_rdrand</span></span><span class="mpre">
  where </span><a name="loc_34_9_34_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_9_34_18&#39;)"><span class="hl_fundecl"><span class="mpre">supported</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
        </span><a href="#loc_34_9_34_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_9_34_18&#39;)"><span class="hl_fundecl"><span class="mpre">supported</span></span></a><span class="mpre"> _ = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_25_15_25_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_15_25_21&#39;)"><span class="hl_conref"><span class="mpre">RDRand</span></span></a><span class="mpre">

</span><a href="#loc_38_1_38_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_1_38_15&#39;)"><span class="mpre">rdrandGetBytes</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_38_1_38_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_1_38_15&#39;)"><span class="hl_fundecl"><span class="mpre">rdrandGetBytes</span></span></a><span class="mpre"> </span><a name="loc_38_16_38_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_16_38_19&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_38_20_38_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_20_38_22&#39;)"><span class="hl_vardecl"><span class="mpre">sz</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">c_get_rand_bytes</span></span><span class="mpre"> </span><a href="#loc_38_16_38_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_16_38_19&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_38_20_38_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_20_38_22&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre">)
</span></div></body></html>