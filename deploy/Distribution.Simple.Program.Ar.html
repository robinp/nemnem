<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Distribution.Simple.Program.Ar</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  Duncan Coutts 2009</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  cabal-devel@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This module provides an library interface to the @ar@ program.</span></span><span class="mpre">

module Distribution.Simple.Program.Ar (
    createArLibArchive,
    multiStageProgramInvocation,
  ) where

import Distribution.Simple.Program.Types
         ( </span><a href="Distribution.Simple.Program.Types.html#loc_77_6_77_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Program.Types.html#loc_77_6_77_23&#39;)"><span class="mpre">ConfiguredProgram</span></a><span class="mpre">(..) )
import Distribution.Simple.Program.Run
         ( </span><a href="Distribution.Simple.Program.Run.html#loc_84_1_84_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Program.Run.html#loc_84_1_84_18&#39;)"><span class="mpre">programInvocation</span></a><span class="mpre">, </span><a href="Distribution.Simple.Program.Run.html#loc_212_1_212_28" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Program.Run.html#loc_212_1_212_28&#39;)"><span class="mpre">multiStageProgramInvocation</span></a><span class="mpre">
         , </span><a href="Distribution.Simple.Program.Run.html#loc_95_1_95_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Program.Run.html#loc_95_1_95_21&#39;)"><span class="mpre">runProgramInvocation</span></a><span class="mpre"> )
import Distribution.System
         ( </span><a href="Distribution.System.html#loc_66_6_66_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.System.html#loc_66_6_66_8&#39;)"><span class="mpre">OS</span></a><span class="mpre">(..), </span><a href="Distribution.System.html#loc_112_1_112_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.System.html#loc_112_1_112_8&#39;)"><span class="mpre">buildOS</span></a><span class="mpre"> )
import Distribution.Verbosity
         ( </span><a href="Distribution.Verbosity.html#loc_58_6_58_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Verbosity.html#loc_58_6_58_15&#39;)"><span class="mpre">Verbosity</span></a><span class="mpre">, </span><a href="Distribution.Verbosity.html#loc_76_1_76_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Verbosity.html#loc_76_1_76_10&#39;)"><span class="mpre">deafening</span></a><span class="mpre">, </span><a href="Distribution.Verbosity.html#loc_71_1_71_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Verbosity.html#loc_71_1_71_8&#39;)"><span class="mpre">verbose</span></a><span class="mpre"> )

</span><span class="hl_comment"><span class="mpre">-- | Call @ar@ to create a library archive from a bunch of object files.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_30_1_30_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_1_30_19&#39;)"><span class="mpre">createArLibArchive</span></a><span class="mpre"> :: </span><a href="Distribution.Verbosity.html#loc_58_6_58_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Verbosity.html#loc_58_6_58_15&#39;)"><span class="hl_tyconref"><span class="mpre">Verbosity</span></span></a><span class="mpre"> -&gt; </span><a href="Distribution.Simple.Program.Types.html#loc_77_6_77_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Program.Types.html#loc_77_6_77_23&#39;)"><span class="hl_tyconref"><span class="mpre">ConfiguredProgram</span></span></a><span class="mpre">
                   -&gt; </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_30_1_30_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_1_30_19&#39;)"><span class="hl_fundecl"><span class="mpre">createArLibArchive</span></span></a><span class="mpre"> </span><a name="loc_30_20_30_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_20_30_29&#39;)"><span class="hl_vardecl"><span class="mpre">verbosity</span></span></a><span class="mpre"> </span><a name="loc_30_30_30_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_30_30_32&#39;)"><span class="hl_vardecl"><span class="mpre">ar</span></span></a><span class="mpre"> </span><a name="loc_30_33_30_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_33_30_39&#39;)"><span class="hl_vardecl"><span class="mpre">target</span></span></a><span class="mpre"> </span><a name="loc_30_40_30_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_40_30_45&#39;)"><span class="hl_vardecl"><span class="mpre">files</span></span></a><span class="mpre"> =

  </span><span class="hl_comment"><span class="mpre">-- The args to use with &quot;ar&quot; are actually rather subtle and system-dependent.</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- In particular we have the following issues:</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--  -- On OS X, &quot;ar q&quot; does not make an archive index. Archives with no</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--     index cannot be used.</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--  -- GNU &quot;ar r&quot; will not let us add duplicate objects, only &quot;ar q&quot; lets us</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--     do that. We have duplicates because of modules like &quot;A.M&quot; and &quot;B.M&quot;</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--     both make an object file &quot;M.o&quot; and ar does not consider the directory.</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- Our solution is to use &quot;ar r&quot; in the simple case when one call is enough.</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- When we need to call ar multiple times we use &quot;ar q&quot; and for the last</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- call on OSX we use &quot;ar qs&quot; so that it&#39;ll make the index.</span></span><span class="mpre">

  let </span><a name="loc_46_7_46_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_7_46_17&#39;)"><span class="hl_vardecl"><span class="mpre">simpleArgs</span></span></a><span class="mpre">  = case </span><a href="Distribution.System.html#loc_112_1_112_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.System.html#loc_112_1_112_8&#39;)"><span class="hl_varref"><span class="mpre">buildOS</span></span></a><span class="mpre"> of
             </span><a href="Distribution.System.html#loc_66_29_66_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.System.html#loc_66_29_66_32&#39;)"><span class="hl_conref"><span class="mpre">OSX</span></span></a><span class="mpre"> -&gt; [</span><span class="hl_string"><span class="mpre">&quot;-r&quot;</span></span><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;-s&quot;</span></span><span class="mpre">]
             _   -&gt; [</span><span class="hl_string"><span class="mpre">&quot;-r&quot;</span></span><span class="mpre">]

      </span><a name="loc_50_7_50_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_7_50_18&#39;)"><span class="hl_vardecl"><span class="mpre">initialArgs</span></span></a><span class="mpre"> = [</span><span class="hl_string"><span class="mpre">&quot;-q&quot;</span></span><span class="mpre">]
      </span><a name="loc_51_7_51_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_7_51_16&#39;)"><span class="hl_vardecl"><span class="mpre">finalArgs</span></span></a><span class="mpre">   = case </span><a href="Distribution.System.html#loc_112_1_112_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.System.html#loc_112_1_112_8&#39;)"><span class="hl_varref"><span class="mpre">buildOS</span></span></a><span class="mpre"> of
             </span><a href="Distribution.System.html#loc_66_29_66_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.System.html#loc_66_29_66_32&#39;)"><span class="hl_conref"><span class="mpre">OSX</span></span></a><span class="mpre"> -&gt; [</span><span class="hl_string"><span class="mpre">&quot;-q&quot;</span></span><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;-s&quot;</span></span><span class="mpre">]
             _   -&gt; [</span><span class="hl_string"><span class="mpre">&quot;-q&quot;</span></span><span class="mpre">]

      </span><a name="loc_55_7_55_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_7_55_16&#39;)"><span class="hl_vardecl"><span class="mpre">extraArgs</span></span></a><span class="mpre">   = </span><a href="#loc_68_5_68_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_5_68_18&#39;)"><span class="hl_varref"><span class="mpre">verbosityOpts</span></span></a><span class="mpre"> </span><a href="#loc_30_20_30_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_20_30_29&#39;)"><span class="hl_varref"><span class="mpre">verbosity</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> [</span><a href="#loc_30_33_30_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_33_30_39&#39;)"><span class="hl_varref"><span class="mpre">target</span></span></a><span class="mpre">]

      </span><a name="loc_57_7_57_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_7_57_13&#39;)"><span class="hl_vardecl"><span class="mpre">simple</span></span></a><span class="mpre">  = </span><a href="Distribution.Simple.Program.Run.html#loc_84_1_84_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Program.Run.html#loc_84_1_84_18&#39;)"><span class="hl_varref"><span class="mpre">programInvocation</span></span></a><span class="mpre"> </span><a href="#loc_30_30_30_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_30_30_32&#39;)"><span class="hl_varref"><span class="mpre">ar</span></span></a><span class="mpre"> (</span><a href="#loc_46_7_46_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_7_46_17&#39;)"><span class="hl_varref"><span class="mpre">simpleArgs</span></span></a><span class="mpre">  </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_55_7_55_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_7_55_16&#39;)"><span class="hl_varref"><span class="mpre">extraArgs</span></span></a><span class="mpre">)
      </span><a name="loc_58_7_58_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_7_58_14&#39;)"><span class="hl_vardecl"><span class="mpre">initial</span></span></a><span class="mpre"> = </span><a href="Distribution.Simple.Program.Run.html#loc_84_1_84_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Program.Run.html#loc_84_1_84_18&#39;)"><span class="hl_varref"><span class="mpre">programInvocation</span></span></a><span class="mpre"> </span><a href="#loc_30_30_30_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_30_30_32&#39;)"><span class="hl_varref"><span class="mpre">ar</span></span></a><span class="mpre"> (</span><a href="#loc_50_7_50_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_7_50_18&#39;)"><span class="hl_varref"><span class="mpre">initialArgs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_55_7_55_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_7_55_16&#39;)"><span class="hl_varref"><span class="mpre">extraArgs</span></span></a><span class="mpre">)
      </span><a name="loc_59_7_59_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_7_59_13&#39;)"><span class="hl_vardecl"><span class="mpre">middle</span></span></a><span class="mpre">  = </span><a href="#loc_58_7_58_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_7_58_14&#39;)"><span class="hl_varref"><span class="mpre">initial</span></span></a><span class="mpre">
      </span><a name="loc_60_7_60_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_7_60_12&#39;)"><span class="hl_vardecl"><span class="mpre">final</span></span></a><span class="mpre">   = </span><a href="Distribution.Simple.Program.Run.html#loc_84_1_84_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Program.Run.html#loc_84_1_84_18&#39;)"><span class="hl_varref"><span class="mpre">programInvocation</span></span></a><span class="mpre"> </span><a href="#loc_30_30_30_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_30_30_32&#39;)"><span class="hl_varref"><span class="mpre">ar</span></span></a><span class="mpre"> (</span><a href="#loc_51_7_51_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_7_51_16&#39;)"><span class="hl_varref"><span class="mpre">finalArgs</span></span></a><span class="mpre">   </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_55_7_55_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_7_55_16&#39;)"><span class="hl_varref"><span class="mpre">extraArgs</span></span></a><span class="mpre">)

   in </span><span class="hl_varref"><span class="mpre">sequence_</span></span><span class="mpre">
        [ </span><a href="Distribution.Simple.Program.Run.html#loc_95_1_95_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Program.Run.html#loc_95_1_95_21&#39;)"><span class="hl_varref"><span class="mpre">runProgramInvocation</span></span></a><span class="mpre"> </span><a href="#loc_30_20_30_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_20_30_29&#39;)"><span class="hl_varref"><span class="mpre">verbosity</span></span></a><span class="mpre"> </span><a href="#loc_64_11_64_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_11_64_14&#39;)"><span class="hl_varref"><span class="mpre">inv</span></span></a><span class="mpre">
        | </span><a name="loc_64_11_64_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_11_64_14&#39;)"><span class="hl_vardecl"><span class="mpre">inv</span></span></a><span class="mpre"> &lt;- </span><a href="Distribution.Simple.Program.Run.html#loc_212_1_212_28" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Simple.Program.Run.html#loc_212_1_212_28&#39;)"><span class="hl_varref"><span class="mpre">multiStageProgramInvocation</span></span></a><span class="mpre">
                   </span><a href="#loc_57_7_57_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_7_57_13&#39;)"><span class="hl_varref"><span class="mpre">simple</span></span></a><span class="mpre"> (</span><a href="#loc_58_7_58_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_7_58_14&#39;)"><span class="hl_varref"><span class="mpre">initial</span></span></a><span class="mpre">, </span><a href="#loc_59_7_59_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_7_59_13&#39;)"><span class="hl_varref"><span class="mpre">middle</span></span></a><span class="mpre">, </span><a href="#loc_60_7_60_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_7_60_12&#39;)"><span class="hl_varref"><span class="mpre">final</span></span></a><span class="mpre">) </span><a href="#loc_30_40_30_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_40_30_45&#39;)"><span class="hl_varref"><span class="mpre">files</span></span></a><span class="mpre"> ]

  where
    </span><a name="loc_68_5_68_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_5_68_18&#39;)"><span class="hl_fundecl"><span class="mpre">verbosityOpts</span></span></a><span class="mpre"> </span><a name="loc_68_19_68_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_19_68_20&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> | </span><a href="#loc_68_19_68_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_19_68_20&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="Distribution.Verbosity.html#loc_76_1_76_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Verbosity.html#loc_76_1_76_10&#39;)"><span class="hl_varref"><span class="mpre">deafening</span></span></a><span class="mpre"> = [</span><span class="hl_string"><span class="mpre">&quot;-v&quot;</span></span><span class="mpre">]
                    | </span><a href="#loc_68_19_68_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_19_68_20&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="Distribution.Verbosity.html#loc_71_1_71_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Verbosity.html#loc_71_1_71_8&#39;)"><span class="hl_varref"><span class="mpre">verbose</span></span></a><span class="mpre">   = []
                    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">      = [</span><span class="hl_string"><span class="mpre">&quot;-c&quot;</span></span><span class="mpre">]
</span></div></body></html>