<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Trustworthy #-}
{-# LANGUAGE NoImplicitPrelude, UnboxedTuples, MagicHash #-}

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Control.Concurrent.MVar</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow 2001</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD-style (see the file libraries/base/LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  libraries@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (concurrency)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- An @&#39;MVar&#39; t@ is mutable location that is either empty or contains a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- value of type @t@.  It has two fundamental operations: &#39;putMVar&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- which fills an &#39;MVar&#39; if it is empty and blocks otherwise, and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;takeMVar&#39; which empties an &#39;MVar&#39; if it is full and blocks</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- otherwise.  They can be used in multiple different ways:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   1. As synchronized mutable variables,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   2. As channels, with &#39;takeMVar&#39; and &#39;putMVar&#39; as receive and send, and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   3. As a binary semaphore @&#39;MVar&#39; ()@, with &#39;takeMVar&#39; and &#39;putMVar&#39; as</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      wait and signal.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- They were introduced in the paper</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &lt;http://research.microsoft.com/~simonpj/papers/concurrent-haskell.ps.gz &quot;Concurrent Haskell&quot;&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- by Simon Peyton Jones, Andrew Gordon and Sigbjorn Finne, though</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- some details of their implementation have since then changed (in</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- particular, a put on a full &#39;MVar&#39; used to error, but now merely</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- blocks.)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- === Applicability</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;MVar&#39;s offer more flexibility than &#39;IORef&#39;s, but less flexibility</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- than &#39;STM&#39;.  They are appropriate for building synchronization</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- primitives and performing simple interthread communication; however</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- they are very simple and susceptible to race conditions, deadlocks or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- uncaught exceptions.  Do not use them if you need perform larger</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- atomic operations such as reading from multiple variables: use &#39;STM&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- instead.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- In particular, the &quot;bigger&quot; functions in this module (&#39;readMVar&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;swapMVar&#39;, &#39;withMVar&#39;, &#39;modifyMVar_&#39; and &#39;modifyMVar&#39;) are simply</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the composition of a &#39;takeMVar&#39; followed by a &#39;putMVar&#39; with</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exception safety.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- These only have atomicity guarantees if all other threads</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- perform a &#39;takeMVar&#39; before a &#39;putMVar&#39; as well;  otherwise, they may</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- block.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- === Fairness</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- No thread can be blocked indefinitely on an &#39;MVar&#39; unless another</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- thread holds that &#39;MVar&#39; indefinitely.  One usual implementation of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- this fairness guarantee is that threads blocked on an &#39;MVar&#39; are</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- served in a first-in-first-out fashion, but this is not guaranteed</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in the semantics.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- === Gotchas</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Like many other Haskell data structures, &#39;MVar&#39;s are lazy.  This</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- means that if you place an expensive unevaluated thunk inside an</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;MVar&#39;, it will be evaluated by the thread that consumes it, not the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- thread that produced it.  Be sure to &#39;evaluate&#39; values to be placed</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in an &#39;MVar&#39; to the appropriate normal form, or utilize a strict</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- MVar provided by the strict-concurrency package.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- === Ordering</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;MVar&#39; operations are always observed to take place in the order</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- they are written in the program, regardless of the memory model of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the underlying machine.  This is in contrast to &#39;IORef&#39; operations</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- which may appear out-of-order to another thread in some cases.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- === Example</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Consider the following concurrent data structure, a skip channel.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This is a channel for an intermittent source of high bandwidth</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- information (for example, mouse movement events.)  Writing to the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- channel never blocks, and reading from the channel only returns the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- most recent value, or blocks if there are no new values.  Multiple</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- readers are supported with a @dupSkipChan@ operation.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A skip channel is a pair of &#39;MVar&#39;s. The first &#39;MVar&#39; contains the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- current value, and a list of semaphores that need to be notified</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- when it changes. The second &#39;MVar&#39; is a semaphore for this particular</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- reader: it is full if there is a value in the channel that this</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- reader has not read yet, and empty otherwise.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     data SkipChan a = SkipChan (MVar (a, [MVar ()])) (MVar ())</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     newSkipChan :: IO (SkipChan a)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     newSkipChan = do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--         sem &lt;- newEmptyMVar</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--         main &lt;- newMVar (undefined, [sem])</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--         return (SkipChan main sem)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     putSkipChan :: SkipChan a -&gt; a -&gt; IO ()</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     putSkipChan (SkipChan main _) v = do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--         (_, sems) &lt;- takeMVar main</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--         putMVar main (v, [])</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--         mapM_ (\sem -&gt; putMVar sem ()) sems</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     getSkipChan :: SkipChan a -&gt; IO a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     getSkipChan (SkipChan main sem) = do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--         takeMVar sem</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--         (v, sems) &lt;- takeMVar main</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--         putMVar main (v, sem:sems)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--         return v</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     dupSkipChan :: SkipChan a -&gt; IO (SkipChan a)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     dupSkipChan (SkipChan main _) = do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--         sem &lt;- newEmptyMVar</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--         (v, sems) &lt;- takeMVar main</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--         putMVar main (v, sem:sems)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--         return (SkipChan main sem)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This example was adapted from the original Concurrent Haskell paper.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- For more examples of &#39;MVar&#39;s being used to build higher-level</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- synchronization primitives, see &#39;Control.Concurrent.Chan&#39; and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Control.Concurrent.QSem&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module Control.Concurrent.MVar
        (
          </span><span class="hl_comment"><span class="mpre">-- * @MVar@s</span></span><span class="mpre">
          MVar
        , newEmptyMVar
        , newMVar
        , takeMVar
        , putMVar
        , readMVar
        , swapMVar
        , tryTakeMVar
        , tryPutMVar
        , isEmptyMVar
        , withMVar
        , withMVarMasked
        , modifyMVar_
        , modifyMVar
        , modifyMVarMasked_
        , modifyMVarMasked
        , tryReadMVar
        , mkWeakMVar
        , addMVarFinalizer
    ) where

import GHC.MVar ( </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="mpre">MVar</span></a><span class="mpre">(..), </span><a href="GHC.MVar.html#loc_64_1_64_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_64_1_64_13&#39;)"><span class="mpre">newEmptyMVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="mpre">newMVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="mpre">takeMVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="mpre">putMVar</span></a><span class="mpre">,
                  </span><a href="GHC.MVar.html#loc_142_1_142_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_142_1_142_12&#39;)"><span class="mpre">tryTakeMVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_151_1_151_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_151_1_151_11&#39;)"><span class="mpre">tryPutMVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_174_1_174_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_174_1_174_12&#39;)"><span class="mpre">isEmptyMVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_116_1_116_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_116_1_116_9&#39;)"><span class="mpre">readMVar</span></a><span class="mpre">,
                  </span><a href="GHC.MVar.html#loc_162_1_162_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_162_1_162_12&#39;)"><span class="mpre">tryReadMVar</span></a><span class="mpre">
                )
import qualified GHC.MVar
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Control/Concurrent/MVar.hs&quot;, srcSpanStartLine = 157, srcSpanStartColumn = 8, srcSpanEndLine = 157, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Weak&quot;"><span class="mpre">GHC.Weak</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Control/Concurrent/MVar.hs&quot;, srcSpanStartLine = 158, srcSpanStartColumn = 8, srcSpanEndLine = 158, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">

import Control.Exception.Base

</span><span class="hl_comment"><span class="mpre">{-|
  Take a value from an &#39;MVar&#39;, put a new value into the &#39;MVar&#39; and
  return the value taken. This function is atomic only if there are
  no other producers for this &#39;MVar&#39;.
-}</span></span><span class="mpre">
</span><a href="#loc_168_1_168_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_1_168_9&#39;)"><span class="mpre">swapMVar</span></a><span class="mpre"> :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_168_1_168_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_1_168_9&#39;)"><span class="hl_fundecl"><span class="mpre">swapMVar</span></span></a><span class="mpre"> </span><a name="loc_168_10_168_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_10_168_14&#39;)"><span class="hl_vardecl"><span class="mpre">mvar</span></span></a><span class="mpre"> </span><a name="loc_168_15_168_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_15_168_18&#39;)"><span class="hl_vardecl"><span class="mpre">new</span></span></a><span class="mpre"> =
  </span><a href="GHC.IO.html#loc_426_1_426_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_426_1_426_6&#39;)"><span class="hl_varref"><span class="mpre">mask_</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a name="loc_170_5_170_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_5_170_8&#39;)"><span class="hl_vardecl"><span class="mpre">old</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="hl_varref"><span class="mpre">takeMVar</span></span></a><span class="mpre"> </span><a href="#loc_168_10_168_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_10_168_14&#39;)"><span class="hl_varref"><span class="mpre">mvar</span></span></a><span class="mpre">
    </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_168_10_168_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_10_168_14&#39;)"><span class="hl_varref"><span class="mpre">mvar</span></span></a><span class="mpre"> </span><a href="#loc_168_15_168_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_15_168_18&#39;)"><span class="hl_varref"><span class="mpre">new</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_170_5_170_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_5_170_8&#39;)"><span class="hl_varref"><span class="mpre">old</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-|
  &#39;withMVar&#39; is an exception-safe wrapper for operating on the contents
  of an &#39;MVar&#39;.  This operation is exception-safe: it will replace the
  original contents of the &#39;MVar&#39; if an exception is raised (see
  &quot;Control.Exception&quot;).  However, it is only atomic if there are no
  other producers for this &#39;MVar&#39;.
-}</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_185_1_185_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_1_185_9&#39;)"><span class="mpre">withMVar</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- inlining has been reported to have dramatic effects; see</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- http://www.haskell.org//pipermail/haskell/2006-May/017907.html</span></span><span class="mpre">
</span><a href="#loc_185_1_185_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_1_185_9&#39;)"><span class="mpre">withMVar</span></a><span class="mpre"> :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
</span><a name="loc_185_1_185_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_1_185_9&#39;)"><span class="hl_fundecl"><span class="mpre">withMVar</span></span></a><span class="mpre"> </span><a name="loc_185_10_185_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_10_185_11&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><a name="loc_185_12_185_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_12_185_14&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> =
  </span><a href="GHC.IO.html#loc_428_1_428_5" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_428_1_428_5&#39;)"><span class="hl_varref"><span class="mpre">mask</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_186_11_186_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_11_186_18&#39;)"><span class="hl_vardecl"><span class="mpre">restore</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_187_5_187_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_5_187_6&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="hl_varref"><span class="mpre">takeMVar</span></span></a><span class="mpre"> </span><a href="#loc_185_10_185_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_10_185_11&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
    </span><a name="loc_188_5_188_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_5_188_6&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_186_11_186_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_11_186_18&#39;)"><span class="hl_varref"><span class="mpre">restore</span></span></a><span class="mpre"> (</span><a href="#loc_185_12_185_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_12_185_14&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_187_5_187_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_5_187_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">) </span><a href="Control.Exception.Base.html#loc_229_1_229_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_229_1_229_12&#39;)"><span class="hl_infix"><span class="mpre">`onException`</span></span></a><span class="mpre"> </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_185_10_185_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_10_185_11&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_187_5_187_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_5_187_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
    </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_185_10_185_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_10_185_11&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_187_5_187_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_5_187_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_188_5_188_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_5_188_6&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-|
  Like &#39;withMVar&#39;, but the @IO@ action in the second argument is executed
  with asynchronous exceptions masked.

  /Since: 4.7.0.0/
-}</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_200_1_200_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_1_200_15&#39;)"><span class="mpre">withMVarMasked</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_200_1_200_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_1_200_15&#39;)"><span class="mpre">withMVarMasked</span></a><span class="mpre"> :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
</span><a name="loc_200_1_200_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_1_200_15&#39;)"><span class="hl_fundecl"><span class="mpre">withMVarMasked</span></span></a><span class="mpre"> </span><a name="loc_200_16_200_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_16_200_17&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><a name="loc_200_18_200_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_18_200_20&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> =
  </span><a href="GHC.IO.html#loc_426_1_426_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_426_1_426_6&#39;)"><span class="hl_varref"><span class="mpre">mask_</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a name="loc_202_5_202_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_5_202_6&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="hl_varref"><span class="mpre">takeMVar</span></span></a><span class="mpre"> </span><a href="#loc_200_16_200_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_16_200_17&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
    </span><a name="loc_203_5_203_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_5_203_6&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_200_18_200_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_18_200_20&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_202_5_202_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_5_202_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><a href="Control.Exception.Base.html#loc_229_1_229_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_229_1_229_12&#39;)"><span class="hl_infix"><span class="mpre">`onException`</span></span></a><span class="mpre"> </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_200_16_200_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_16_200_17&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_202_5_202_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_5_202_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
    </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_200_16_200_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_16_200_17&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_202_5_202_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_5_202_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_203_5_203_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_5_203_6&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-|
  An exception-safe wrapper for modifying the contents of an &#39;MVar&#39;.
  Like &#39;withMVar&#39;, &#39;modifyMVar&#39; will replace the original contents of
  the &#39;MVar&#39; if an exception is raised during the operation.  This
  function is only atomic if there are no other producers for this
  &#39;MVar&#39;.
-}</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_216_1_216_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_1_216_12&#39;)"><span class="mpre">modifyMVar_</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_216_1_216_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_1_216_12&#39;)"><span class="mpre">modifyMVar_</span></a><span class="mpre"> :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_216_1_216_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_1_216_12&#39;)"><span class="hl_fundecl"><span class="mpre">modifyMVar_</span></span></a><span class="mpre"> </span><a name="loc_216_13_216_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_13_216_14&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><a name="loc_216_15_216_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_15_216_17&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> =
  </span><a href="GHC.IO.html#loc_428_1_428_5" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_428_1_428_5&#39;)"><span class="hl_varref"><span class="mpre">mask</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_217_11_217_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_11_217_18&#39;)"><span class="hl_vardecl"><span class="mpre">restore</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_218_5_218_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_5_218_6&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">  &lt;- </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="hl_varref"><span class="mpre">takeMVar</span></span></a><span class="mpre"> </span><a href="#loc_216_13_216_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_13_216_14&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
    </span><a name="loc_219_5_219_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_5_219_7&#39;)"><span class="hl_vardecl"><span class="mpre">a&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_217_11_217_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_11_217_18&#39;)"><span class="hl_varref"><span class="mpre">restore</span></span></a><span class="mpre"> (</span><a href="#loc_216_15_216_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_15_216_17&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_218_5_218_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_5_218_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">) </span><a href="Control.Exception.Base.html#loc_229_1_229_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_229_1_229_12&#39;)"><span class="hl_infix"><span class="mpre">`onException`</span></span></a><span class="mpre"> </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_216_13_216_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_13_216_14&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_218_5_218_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_5_218_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
    </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_216_13_216_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_13_216_14&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_219_5_219_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_5_219_7&#39;)"><span class="hl_varref"><span class="mpre">a&#39;</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-|
  A slight variation on &#39;modifyMVar_&#39; that allows a value to be
  returned (@b@) in addition to the modified value of the &#39;MVar&#39;.
-}</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_228_1_228_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_1_228_11&#39;)"><span class="mpre">modifyMVar</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_228_1_228_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_1_228_11&#39;)"><span class="mpre">modifyMVar</span></a><span class="mpre"> :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">,</span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
</span><a name="loc_228_1_228_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_1_228_11&#39;)"><span class="hl_fundecl"><span class="mpre">modifyMVar</span></span></a><span class="mpre"> </span><a name="loc_228_12_228_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_12_228_13&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><a name="loc_228_14_228_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_14_228_16&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> =
  </span><a href="GHC.IO.html#loc_428_1_428_5" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_428_1_428_5&#39;)"><span class="hl_varref"><span class="mpre">mask</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_229_11_229_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_11_229_18&#39;)"><span class="hl_vardecl"><span class="mpre">restore</span></span></a><span class="mpre"> -&gt; do
    </span><a name="loc_230_5_230_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_5_230_6&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">      &lt;- </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="hl_varref"><span class="mpre">takeMVar</span></span></a><span class="mpre"> </span><a href="#loc_228_12_228_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_12_228_13&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
    (</span><a name="loc_231_6_231_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_6_231_8&#39;)"><span class="hl_vardecl"><span class="mpre">a&#39;</span></span></a><span class="mpre">,</span><a name="loc_231_9_231_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_9_231_10&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">) &lt;- </span><a href="#loc_229_11_229_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_11_229_18&#39;)"><span class="hl_varref"><span class="mpre">restore</span></span></a><span class="mpre"> (</span><a href="#loc_228_14_228_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_14_228_16&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_230_5_230_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_5_230_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="GHC.IO.html#loc_480_1_480_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_480_1_480_9&#39;)"><span class="hl_varref"><span class="mpre">evaluate</span></span></a><span class="mpre">) </span><a href="Control.Exception.Base.html#loc_229_1_229_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_229_1_229_12&#39;)"><span class="hl_infix"><span class="mpre">`onException`</span></span></a><span class="mpre"> </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_228_12_228_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_12_228_13&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_230_5_230_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_5_230_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
    </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_228_12_228_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_12_228_13&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_231_6_231_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_6_231_8&#39;)"><span class="hl_varref"><span class="mpre">a&#39;</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_231_9_231_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_231_9_231_10&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-|
  Like &#39;modifyMVar_&#39;, but the @IO@ action in the second argument is executed with
  asynchronous exceptions masked.

  /Since: 4.6.0.0/
-}</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_243_1_243_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_1_243_18&#39;)"><span class="mpre">modifyMVarMasked_</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_243_1_243_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_1_243_18&#39;)"><span class="mpre">modifyMVarMasked_</span></a><span class="mpre"> :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_243_1_243_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_1_243_18&#39;)"><span class="hl_fundecl"><span class="mpre">modifyMVarMasked_</span></span></a><span class="mpre"> </span><a name="loc_243_19_243_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_19_243_20&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><a name="loc_243_21_243_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_21_243_23&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> =
  </span><a href="GHC.IO.html#loc_426_1_426_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_426_1_426_6&#39;)"><span class="hl_varref"><span class="mpre">mask_</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a name="loc_245_5_245_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_5_245_6&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">  &lt;- </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="hl_varref"><span class="mpre">takeMVar</span></span></a><span class="mpre"> </span><a href="#loc_243_19_243_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_19_243_20&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
    </span><a name="loc_246_5_246_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_246_5_246_7&#39;)"><span class="hl_vardecl"><span class="mpre">a&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_243_21_243_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_21_243_23&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_245_5_245_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_5_245_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><a href="Control.Exception.Base.html#loc_229_1_229_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_229_1_229_12&#39;)"><span class="hl_infix"><span class="mpre">`onException`</span></span></a><span class="mpre"> </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_243_19_243_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_19_243_20&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_245_5_245_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_5_245_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
    </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_243_19_243_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_19_243_20&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_246_5_246_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_246_5_246_7&#39;)"><span class="hl_varref"><span class="mpre">a&#39;</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-|
  Like &#39;modifyMVar&#39;, but the @IO@ action in the second argument is executed with
  asynchronous exceptions masked.

  /Since: 4.6.0.0/
-}</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_257_1_257_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_1_257_17&#39;)"><span class="mpre">modifyMVarMasked</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_257_1_257_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_1_257_17&#39;)"><span class="mpre">modifyMVarMasked</span></a><span class="mpre"> :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">,</span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
</span><a name="loc_257_1_257_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_1_257_17&#39;)"><span class="hl_fundecl"><span class="mpre">modifyMVarMasked</span></span></a><span class="mpre"> </span><a name="loc_257_18_257_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_18_257_19&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><a name="loc_257_20_257_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_20_257_22&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> =
  </span><a href="GHC.IO.html#loc_426_1_426_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_426_1_426_6&#39;)"><span class="hl_varref"><span class="mpre">mask_</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a name="loc_259_5_259_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_5_259_6&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">      &lt;- </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="hl_varref"><span class="mpre">takeMVar</span></span></a><span class="mpre"> </span><a href="#loc_257_18_257_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_18_257_19&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
    (</span><a name="loc_260_6_260_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_260_6_260_8&#39;)"><span class="hl_vardecl"><span class="mpre">a&#39;</span></span></a><span class="mpre">,</span><a name="loc_260_9_260_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_260_9_260_10&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">) &lt;- (</span><a href="#loc_257_20_257_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_20_257_22&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_259_5_259_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_5_259_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="GHC.IO.html#loc_480_1_480_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_480_1_480_9&#39;)"><span class="hl_varref"><span class="mpre">evaluate</span></span></a><span class="mpre">) </span><a href="Control.Exception.Base.html#loc_229_1_229_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_229_1_229_12&#39;)"><span class="hl_infix"><span class="mpre">`onException`</span></span></a><span class="mpre"> </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_257_18_257_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_18_257_19&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_259_5_259_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_5_259_6&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
    </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_257_18_257_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_257_18_257_19&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_260_6_260_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_260_6_260_8&#39;)"><span class="hl_varref"><span class="mpre">a&#39;</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_260_9_260_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_260_9_260_10&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

</span><span class="warning" data-warning="DeclDeprPragmaDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Control/Concurrent/MVar.hs&quot;, srcSpanStartLine = 264, srcSpanStartColumn = 1, srcSpanEndLine = 264, srcSpanEndColumn = 63}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Control/Concurrent/MVar.hs&quot;, srcSpanStartLine = 264, srcSpanStartColumn = 1, srcSpanEndLine = 264, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Control/Concurrent/MVar."><span class="mpre">{-# DEPRECATED addMVarFinalizer &quot;use &#39;mkWeakMVar&#39; instead&quot; #-}</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- deprecated in 7.6</span></span><span class="mpre">
</span><a href="#loc_266_1_266_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_1_266_17&#39;)"><span class="mpre">addMVarFinalizer</span></a><span class="mpre"> :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_266_1_266_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_266_1_266_17&#39;)"><span class="hl_vardecl"><span class="mpre">addMVarFinalizer</span></span></a><span class="mpre"> = </span><a href="GHC.MVar.html#loc_181_1_181_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_181_1_181_17&#39;)"><span class="hl_varref"><span class="mpre">GHC.MVar.addMVarFinalizer</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Make a &#39;Weak&#39; pointer to an &#39;MVar&#39;, using the second argument as</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a finalizer to run when &#39;MVar&#39; is garbage-collected</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /Since: 4.6.0.0/</span></span><span class="mpre">
</span><a href="#loc_273_1_273_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_1_273_11&#39;)"><span class="mpre">mkWeakMVar</span></a><span class="mpre"> :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Weak</span></span><span class="mpre"> (</span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">))
</span><a name="loc_273_1_273_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_1_273_11&#39;)"><span class="hl_fundecl"><span class="mpre">mkWeakMVar</span></span></a><span class="mpre"> </span><a name="loc_273_12_273_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_12_273_13&#39;)"><span class="hl_specname"><span class="mpre">m</span></span></a><span class="mpre">@(</span><a href="GHC.MVar.html#loc_39_15_39_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_15_39_19&#39;)"><span class="hl_conref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a name="loc_273_20_273_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_20_273_22&#39;)"><span class="hl_vardecl"><span class="mpre">m#</span></span></a><span class="mpre">) </span><a name="loc_273_24_273_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_24_273_25&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_273_34_273_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_34_273_35&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
  case </span><span class="hl_varref"><span class="mpre">mkWeak#</span></span><span class="mpre"> </span><a href="#loc_273_20_273_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_20_273_22&#39;)"><span class="hl_varref"><span class="mpre">m#</span></span></a><span class="mpre"> </span><a href="#loc_273_12_273_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_12_273_13&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_273_24_273_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_24_273_25&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_273_34_273_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_273_34_273_35&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of (# </span><a name="loc_274_31_274_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_31_274_33&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">, </span><a name="loc_274_35_274_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_35_274_36&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> #) -&gt; (# </span><a href="#loc_274_31_274_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_31_274_33&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">Weak</span></span><span class="mpre"> </span><a href="#loc_274_35_274_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_274_35_274_36&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> #)
</span></div></body></html>