<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE ScopedTypeVariables #-}
{-# LANGUAGE CPP #-}
{-# LANGUAGE OverloadedStrings #-}
module Network.HTTP.Client.Core
    ( withResponse
    , httpLbs
    , httpNoBody
    , httpRaw
    , responseOpen
    , responseClose
    , applyCheckStatus
    , httpRedirect
    ) where

import Network.HTTP.Types
import Network.HTTP.Client.Manager
import Network.HTTP.Client.Types
import Network.HTTP.Client.Body
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Core.hs&quot;, srcSpanStartLine = 19, srcSpanStartColumn = 8, srcSpanEndLine = 19, srcSpanEndColumn = 35}, srcInfoPoints = []}) &quot;Network.HTTP.Client.Request&quot;"><span class="mpre">Network.HTTP.Client.Request</span></span><span class="mpre">
import Network.HTTP.Client.Response
import Network.HTTP.Client.Cookies
import Data.Time
import Control.Exception
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Core.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 18, srcSpanEndLine = 24, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as S
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Core.hs&quot;, srcSpanStartLine = 25, srcSpanStartColumn = 18, srcSpanEndLine = 25, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as S8
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Core.hs&quot;, srcSpanStartLine = 26, srcSpanStartColumn = 18, srcSpanEndLine = 26, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L
import Data.Monoid
import Control.Monad (</span><a href="Control.Monad.html#loc_195_1_195_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_195_1_195_5&#39;)"><span class="mpre">void</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Perform a @Request@ using a connection acquired from the given @Manager@,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- and then provide the @Response@ to the given function. This function is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- fully exception safe, guaranteeing that the response will be closed when the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- inner function exits. It is defined as:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; withResponse req man f = bracket (responseOpen req man) responseClose f</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- It is recommended that you use this function in place of explicit calls to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;responseOpen&#39; and &#39;responseClose&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- You will need to use functions such as &#39;brRead&#39; to consume the response</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- body.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Since 0.1.0</span></span><span class="mpre">
</span><a href="#loc_48_1_48_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_1_48_13&#39;)"><span class="mpre">withResponse</span></a><span class="mpre"> :: </span><a href="Network.HTTP.Client.Types.html#loc_280_6_280_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_280_6_280_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre">
             -&gt; </span><a href="Network.HTTP.Client.Types.html#loc_494_6_494_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_494_6_494_13&#39;)"><span class="hl_tyconref"><span class="mpre">Manager</span></span></a><span class="mpre">
             -&gt; (</span><a href="Network.HTTP.Client.Types.html#loc_404_6_404_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_404_6_404_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">BodyReader</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
             -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_48_1_48_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_1_48_13&#39;)"><span class="hl_fundecl"><span class="mpre">withResponse</span></span></a><span class="mpre"> </span><a name="loc_48_14_48_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_14_48_17&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> </span><a name="loc_48_18_48_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_18_48_21&#39;)"><span class="hl_vardecl"><span class="mpre">man</span></span></a><span class="mpre"> </span><a name="loc_48_22_48_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_22_48_23&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="Control.Exception.Base.html#loc_259_1_259_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_259_1_259_8&#39;)"><span class="hl_varref"><span class="mpre">bracket</span></span></a><span class="mpre"> (</span><a href="#loc_148_1_148_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_1_148_13&#39;)"><span class="hl_varref"><span class="mpre">responseOpen</span></span></a><span class="mpre"> </span><a href="#loc_48_14_48_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_14_48_17&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><a href="#loc_48_18_48_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_18_48_21&#39;)"><span class="hl_varref"><span class="mpre">man</span></span></a><span class="mpre">) </span><a href="#loc_219_1_219_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_1_219_14&#39;)"><span class="hl_varref"><span class="mpre">responseClose</span></span></a><span class="mpre"> </span><a href="#loc_48_22_48_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_22_48_23&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A convenience wrapper around &#39;withResponse&#39; which reads in the entire</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- response body and immediately closes the connection. Note that this function</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- performs fully strict I\/O, and only uses a lazy ByteString in its response</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- for memory efficiency. If you are anticipating a large response body, you</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- are encouraged to use &#39;withResponse&#39; and &#39;brRead&#39; instead.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Since 0.1.0</span></span><span class="mpre">
</span><a href="#loc_58_1_58_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_8&#39;)"><span class="mpre">httpLbs</span></a><span class="mpre"> :: </span><a href="Network.HTTP.Client.Types.html#loc_280_6_280_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_280_6_280_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><a href="Network.HTTP.Client.Types.html#loc_494_6_494_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_494_6_494_13&#39;)"><span class="hl_tyconref"><span class="mpre">Manager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_404_6_404_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_404_6_404_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span><span class="mpre">)
</span><a name="loc_58_1_58_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_1_58_8&#39;)"><span class="hl_fundecl"><span class="mpre">httpLbs</span></span></a><span class="mpre"> </span><a name="loc_58_9_58_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_12&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> </span><a name="loc_58_13_58_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_13_58_16&#39;)"><span class="hl_vardecl"><span class="mpre">man</span></span></a><span class="mpre"> = </span><a href="#loc_48_1_48_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_1_48_13&#39;)"><span class="hl_varref"><span class="mpre">withResponse</span></span></a><span class="mpre"> </span><a href="#loc_58_9_58_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_12&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><a href="#loc_58_13_58_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_13_58_16&#39;)"><span class="hl_varref"><span class="mpre">man</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_58_43_58_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_43_58_46&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_vardecl"><span class="mpre">bss</span></span><span class="mpre"> &lt;- </span><a href="Network.HTTP.Client.Body.html#loc_57_1_57_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Body.html#loc_57_1_57_10&#39;)"><span class="hl_varref"><span class="mpre">brConsume</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_417_7_417_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_417_7_417_19&#39;)"><span class="hl_varref"><span class="mpre">responseBody</span></span></a><span class="mpre"> </span><a href="#loc_58_43_58_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_43_58_46&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Core.hs&quot;, srcSpanStartLine = 60, srcSpanStartColumn = 12, srcSpanEndLine = 60, srcSpanEndColumn = 51}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Core.hs&quot;, srcSpanStartLine = 60, srcSpanStartColumn = 16, srcSpanEndLine = 60, srcSpanEndColumn = 17},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/C"><span class="mpre">res { responseBody = L.fromChunks bss }</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A convenient wrapper around &#39;withResponse&#39; which ignores the response</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- body. This is useful, for example, when performing a HEAD request.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Since 0.3.2</span></span><span class="mpre">
</span><a href="#loc_67_1_67_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_11&#39;)"><span class="mpre">httpNoBody</span></a><span class="mpre"> :: </span><a href="Network.HTTP.Client.Types.html#loc_280_6_280_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_280_6_280_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><a href="Network.HTTP.Client.Types.html#loc_494_6_494_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_494_6_494_13&#39;)"><span class="hl_tyconref"><span class="mpre">Manager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_404_6_404_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_404_6_404_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)
</span><a name="loc_67_1_67_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_1_67_11&#39;)"><span class="hl_fundecl"><span class="mpre">httpNoBody</span></span></a><span class="mpre"> </span><a name="loc_67_12_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_12_67_15&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> </span><a name="loc_67_16_67_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_16_67_19&#39;)"><span class="hl_vardecl"><span class="mpre">man</span></span></a><span class="mpre"> = </span><a href="#loc_48_1_48_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_1_48_13&#39;)"><span class="hl_varref"><span class="mpre">withResponse</span></span></a><span class="mpre"> </span><a href="#loc_67_12_67_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_12_67_15&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><a href="#loc_67_16_67_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_16_67_19&#39;)"><span class="hl_varref"><span class="mpre">man</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Control.Monad.html#loc_195_1_195_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_195_1_195_5&#39;)"><span class="hl_varref"><span class="mpre">void</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Get a &#39;Response&#39; without any redirect following.</span></span><span class="mpre">
</span><a href="#loc_74_1_74_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_8&#39;)"><span class="mpre">httpRaw</span></a><span class="mpre">
     :: </span><a href="Network.HTTP.Client.Types.html#loc_280_6_280_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_280_6_280_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre">
     -&gt; </span><a href="Network.HTTP.Client.Types.html#loc_494_6_494_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_494_6_494_13&#39;)"><span class="hl_tyconref"><span class="mpre">Manager</span></span></a><span class="mpre">
     -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_404_6_404_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_404_6_404_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">BodyReader</span></span><span class="mpre">)
</span><a name="loc_74_1_74_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_8&#39;)"><span class="hl_fundecl"><span class="mpre">httpRaw</span></span></a><span class="mpre"> </span><a name="loc_74_9_74_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_9_74_13&#39;)"><span class="hl_vardecl"><span class="mpre">req&#39;</span></span></a><span class="mpre"> </span><a name="loc_74_14_74_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_14_74_15&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = do
    (</span><a name="loc_75_6_75_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_6_75_9&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre">, </span><a name="loc_75_11_75_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_11_75_22&#39;)"><span class="hl_vardecl"><span class="mpre">cookie_jar&#39;</span></span></a><span class="mpre">) &lt;- case </span><a href="Network.HTTP.Client.Types.html#loc_384_7_384_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_384_7_384_16&#39;)"><span class="hl_varref"><span class="mpre">cookieJar</span></span></a><span class="mpre"> </span><a href="#loc_74_9_74_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_9_74_13&#39;)"><span class="hl_varref"><span class="mpre">req&#39;</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_76_14_76_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_14_76_16&#39;)"><span class="hl_vardecl"><span class="mpre">cj</span></span></a><span class="mpre"> -&gt; do
            </span><a name="loc_77_13_77_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_13_77_16&#39;)"><span class="hl_vardecl"><span class="mpre">now</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getCurrentTime</span></span><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Cookies.html#loc_123_1_123_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Cookies.html#loc_123_1_123_25&#39;)"><span class="hl_varref"><span class="mpre">insertCookiesIntoRequest</span></span></a><span class="mpre"> </span><a href="#loc_74_9_74_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_9_74_13&#39;)"><span class="hl_varref"><span class="mpre">req&#39;</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Client.Cookies.html#loc_116_1_116_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Cookies.html#loc_116_1_116_20&#39;)"><span class="hl_varref"><span class="mpre">evictExpiredCookies</span></span></a><span class="mpre"> </span><a href="#loc_76_14_76_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_14_76_16&#39;)"><span class="hl_varref"><span class="mpre">cj</span></span></a><span class="mpre"> </span><a href="#loc_77_13_77_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_13_77_16&#39;)"><span class="hl_varref"><span class="mpre">now</span></span></a><span class="mpre">) </span><a href="#loc_77_13_77_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_13_77_16&#39;)"><span class="hl_varref"><span class="mpre">now</span></span></a><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_74_9_74_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_9_74_13&#39;)"><span class="hl_varref"><span class="mpre">req&#39;</span></span></a><span class="mpre">, </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">)
    (</span><a name="loc_80_6_80_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_6_80_14&#39;)"><span class="hl_vardecl"><span class="mpre">timeout&#39;</span></span></a><span class="mpre">, (</span><a name="loc_80_17_80_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_17_80_28&#39;)"><span class="hl_vardecl"><span class="mpre">connRelease</span></span></a><span class="mpre">, </span><a name="loc_80_30_80_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_30_80_32&#39;)"><span class="hl_vardecl"><span class="mpre">ci</span></span></a><span class="mpre">, </span><a name="loc_80_34_80_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_34_80_43&#39;)"><span class="hl_vardecl"><span class="mpre">isManaged</span></span></a><span class="mpre">)) &lt;- </span><a href="Network.HTTP.Client.Types.html#loc_371_7_371_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_371_7_371_27&#39;)"><span class="hl_varref"><span class="mpre">getConnectionWrapper</span></span></a><span class="mpre">
        </span><a href="#loc_75_6_75_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_6_75_9&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">
        (</span><a href="#loc_112_5_112_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_5_112_21&#39;)"><span class="hl_varref"><span class="mpre">responseTimeout&#39;</span></span></a><span class="mpre"> </span><a href="#loc_75_6_75_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_6_75_9&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">)
        (</span><a href="Network.HTTP.Client.Manager.html#loc_314_1_314_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Manager.html#loc_314_1_314_26&#39;)"><span class="hl_varref"><span class="mpre">failedConnectionException</span></span></a><span class="mpre"> </span><a href="#loc_75_6_75_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_6_75_9&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">)
        (</span><a href="Network.HTTP.Client.Manager.html#loc_328_1_328_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Manager.html#loc_328_1_328_8&#39;)"><span class="hl_varref"><span class="mpre">getConn</span></span></a><span class="mpre"> </span><a href="#loc_75_6_75_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_6_75_9&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><a href="#loc_74_14_74_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_14_74_15&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">)

    </span><span class="hl_comment"><span class="mpre">-- Originally, we would only test for exceptions when sending the request,</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- not on calling @getResponse@. However, some servers seem to close</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- connections after accepting the request headers, so we need to check for</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- exceptions in both.</span></span><span class="mpre">
    </span><a name="loc_90_5_90_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_7&#39;)"><span class="hl_vardecl"><span class="mpre">ex</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Exception.Base.html#loc_212_1_212_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_212_1_212_4&#39;)"><span class="hl_varref"><span class="mpre">try</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><span class="hl_varref"><span class="mpre">requestBuilder</span></span><span class="mpre"> </span><a href="#loc_75_6_75_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_6_75_9&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><a href="#loc_80_30_80_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_30_80_32&#39;)"><span class="hl_varref"><span class="mpre">ci</span></span></a><span class="mpre">

        </span><a href="Network.HTTP.Client.Response.html#loc_90_1_90_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Response.html#loc_90_1_90_12&#39;)"><span class="hl_varref"><span class="mpre">getResponse</span></span></a><span class="mpre"> </span><a href="#loc_80_17_80_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_17_80_28&#39;)"><span class="hl_varref"><span class="mpre">connRelease</span></span></a><span class="mpre"> </span><a href="#loc_80_6_80_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_6_80_14&#39;)"><span class="hl_varref"><span class="mpre">timeout&#39;</span></span></a><span class="mpre"> </span><a href="#loc_75_6_75_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_6_75_9&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><a href="#loc_80_30_80_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_30_80_32&#39;)"><span class="hl_varref"><span class="mpre">ci</span></span></a><span class="mpre">

    case (</span><a href="#loc_90_5_90_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_7&#39;)"><span class="hl_varref"><span class="mpre">ex</span></span></a><span class="mpre">, </span><a href="#loc_80_34_80_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_34_80_43&#39;)"><span class="hl_varref"><span class="mpre">isManaged</span></span></a><span class="mpre">) of
        </span><span class="hl_comment"><span class="mpre">-- Connection was reused, and might have been closed. Try again</span></span><span class="mpre">
        (</span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_97_15_97_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_15_97_16&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre">, </span><a href="Network.HTTP.Client.Types.html#loc_399_28_399_34" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_399_28_399_34&#39;)"><span class="hl_conref"><span class="mpre">Reused</span></span></a><span class="mpre">) | </span><a href="Network.HTTP.Client.Types.html#loc_504_7_504_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_504_7_504_26&#39;)"><span class="hl_varref"><span class="mpre">mRetryableException</span></span></a><span class="mpre"> </span><a href="#loc_74_14_74_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_14_74_15&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_97_15_97_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_15_97_16&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; do
            </span><a href="#loc_80_17_80_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_17_80_28&#39;)"><span class="hl_varref"><span class="mpre">connRelease</span></span></a><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_394_26_394_35" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_394_26_394_35&#39;)"><span class="hl_conref"><span class="mpre">DontReuse</span></span></a><span class="mpre">
            </span><a href="#loc_148_1_148_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_1_148_13&#39;)"><span class="hl_varref"><span class="mpre">responseOpen</span></span></a><span class="mpre"> </span><a href="#loc_75_6_75_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_6_75_9&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><a href="#loc_74_14_74_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_14_74_15&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- Not reused, or a non-retry, so this is a real exception</span></span><span class="mpre">
        (</span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_101_15_101_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_15_101_16&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre">, _) -&gt; </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="#loc_101_15_101_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_15_101_16&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- Everything went ok, so the connection is good. If any exceptions get</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- thrown in the response body, just throw them as normal.</span></span><span class="mpre">
        (</span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a name="loc_104_16_104_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_16_104_19&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre">, _) -&gt; case </span><a href="Network.HTTP.Client.Types.html#loc_384_7_384_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_384_7_384_16&#39;)"><span class="hl_varref"><span class="mpre">cookieJar</span></span></a><span class="mpre"> </span><a href="#loc_74_9_74_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_9_74_13&#39;)"><span class="hl_varref"><span class="mpre">req&#39;</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> _ -&gt; do
                </span><a name="loc_106_17_106_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_17_106_21&#39;)"><span class="hl_vardecl"><span class="mpre">now&#39;</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getCurrentTime</span></span><span class="mpre">
                let (</span><span class="hl_vardecl"><span class="mpre">cookie_jar</span></span><span class="mpre">, _) = </span><a href="Network.HTTP.Client.Cookies.html#loc_162_1_162_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Cookies.html#loc_162_1_162_16&#39;)"><span class="hl_varref"><span class="mpre">updateCookieJar</span></span></a><span class="mpre"> </span><a href="#loc_104_16_104_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_16_104_19&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre"> </span><a href="#loc_75_6_75_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_6_75_9&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><a href="#loc_106_17_106_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_17_106_21&#39;)"><span class="hl_varref"><span class="mpre">now&#39;</span></span></a><span class="mpre"> </span><a href="#loc_75_11_75_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_11_75_22&#39;)"><span class="hl_varref"><span class="mpre">cookie_jar&#39;</span></span></a><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Core.hs&quot;, srcSpanStartLine = 108, srcSpanStartColumn = 26, srcSpanEndLine = 108, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Core.hs&quot;, srcSpanStartLine = 108, srcSpanStartColumn = 30, srcSpanEndLine = 108, srcSpanEndColumn = 31},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HT"><span class="mpre">res {responseCookieJar = cookie_jar}</span></span><span class="mpre">
            </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_104_16_104_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_16_104_19&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">
  where

    </span><a name="loc_112_5_112_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_5_112_21&#39;)"><span class="hl_fundecl"><span class="mpre">responseTimeout&#39;</span></span></a><span class="mpre"> </span><a name="loc_112_22_112_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_22_112_25&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre">
        | </span><a href="#loc_116_9_116_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_9_116_11&#39;)"><span class="hl_varref"><span class="mpre">rt</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">useDefaultTimeout</span></span><span class="mpre"> = </span><a href="Network.HTTP.Client.Types.html#loc_499_7_499_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_499_7_499_23&#39;)"><span class="hl_varref"><span class="mpre">mResponseTimeout</span></span></a><span class="mpre"> </span><a href="#loc_74_14_74_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_14_74_15&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
        | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="#loc_116_9_116_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_9_116_11&#39;)"><span class="hl_varref"><span class="mpre">rt</span></span></a><span class="mpre">
      where
        </span><a name="loc_116_9_116_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_9_116_11&#39;)"><span class="hl_vardecl"><span class="mpre">rt</span></span></a><span class="mpre"> = </span><a href="Network.HTTP.Client.Types.html#loc_365_7_365_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_365_7_365_22&#39;)"><span class="hl_varref"><span class="mpre">responseTimeout</span></span></a><span class="mpre"> </span><a href="#loc_112_22_112_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_22_112_25&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | The most low-level function for initiating an HTTP request.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The first argument to this function gives a full specification</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- on the request: the host to connect to, whether to use SSL,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- headers, etc. Please see &#39;Request&#39; for full details.  The</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- second argument specifies which &#39;Manager&#39; should be used.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This function then returns a &#39;Response&#39; with a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;BodyReader&#39;.  The &#39;Response&#39; contains the status code</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- and headers that were sent back to us, and the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;BodyReader&#39; contains the body of the request.  Note</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- that this &#39;BodyReader&#39; allows you to have fully</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- interleaved IO actions during your HTTP download, making it</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- possible to download very large responses in constant memory.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- An important note: the response body returned by this function represents a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- live HTTP connection. As such, if you do not use the response body, an open</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- socket will be retained indefinitely. You must be certain to call</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;responseClose&#39; on this response to free up resources.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This function automatically performs any necessary redirects, as specified</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- by the &#39;redirectCount&#39; setting.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- When implementing a (reverse) proxy using this function or relating</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- functions, it&#39;s wise to remove Transfer-Encoding:, Content-Length:,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Content-Encoding: and Accept-Encoding: from request and response</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- headers to be relayed.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Since 0.1.0</span></span><span class="mpre">
</span><a href="#loc_148_1_148_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_1_148_13&#39;)"><span class="mpre">responseOpen</span></a><span class="mpre"> :: </span><a href="Network.HTTP.Client.Types.html#loc_280_6_280_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_280_6_280_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><a href="Network.HTTP.Client.Types.html#loc_494_6_494_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_494_6_494_13&#39;)"><span class="hl_tyconref"><span class="mpre">Manager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_404_6_404_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_404_6_404_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">BodyReader</span></span><span class="mpre">)
</span><a name="loc_148_1_148_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_1_148_13&#39;)"><span class="hl_fundecl"><span class="mpre">responseOpen</span></span></a><span class="mpre"> </span><a name="loc_148_14_148_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_14_148_18&#39;)"><span class="hl_vardecl"><span class="mpre">req0</span></span></a><span class="mpre"> </span><a name="loc_148_19_148_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_19_148_26&#39;)"><span class="hl_vardecl"><span class="mpre">manager</span></span></a><span class="mpre"> = </span><a href="Network.HTTP.Client.Types.html#loc_505_7_505_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_505_7_505_23&#39;)"><span class="hl_varref"><span class="mpre">mWrapIOException</span></span></a><span class="mpre"> </span><a href="#loc_148_19_148_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_19_148_26&#39;)"><span class="hl_varref"><span class="mpre">manager</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a name="loc_149_5_149_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_5_149_8&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> &lt;-
        if </span><a href="Network.HTTP.Client.Types.html#loc_355_7_355_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_355_7_355_20&#39;)"><span class="hl_varref"><span class="mpre">redirectCount</span></span></a><span class="mpre"> </span><a href="#loc_148_14_148_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_14_148_18&#39;)"><span class="hl_varref"><span class="mpre">req0</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
            then </span><a href="#loc_74_1_74_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_8&#39;)"><span class="hl_varref"><span class="mpre">httpRaw</span></span></a><span class="mpre"> </span><a href="#loc_148_14_148_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_14_148_18&#39;)"><span class="hl_varref"><span class="mpre">req0</span></span></a><span class="mpre"> </span><a href="#loc_148_19_148_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_19_148_26&#39;)"><span class="hl_varref"><span class="mpre">manager</span></span></a><span class="mpre">
            else </span><a href="#loc_155_5_155_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_5_155_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_355_7_355_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_355_7_355_20&#39;)"><span class="hl_varref"><span class="mpre">redirectCount</span></span></a><span class="mpre"> </span><a href="#loc_148_14_148_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_14_148_18&#39;)"><span class="hl_varref"><span class="mpre">req0</span></span></a><span class="mpre">) </span><a href="#loc_148_14_148_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_14_148_18&#39;)"><span class="hl_varref"><span class="mpre">req0</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_149_5_149_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_5_149_8&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">) </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">=&lt;&lt;</span></span><span class="mpre"> </span><a href="#loc_168_1_168_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_1_168_17&#39;)"><span class="hl_varref"><span class="mpre">applyCheckStatus</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_360_7_360_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_360_7_360_18&#39;)"><span class="hl_varref"><span class="mpre">checkStatus</span></span></a><span class="mpre"> </span><a href="#loc_148_14_148_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_14_148_18&#39;)"><span class="hl_varref"><span class="mpre">req0</span></span></a><span class="mpre">) </span><a href="#loc_149_5_149_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_5_149_8&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">
  where
    </span><a name="loc_155_5_155_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_5_155_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_155_8_155_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_8_155_13&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> </span><a name="loc_155_14_155_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_14_155_18&#39;)"><span class="hl_vardecl"><span class="mpre">req&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_194_1_194_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_1_194_13&#39;)"><span class="hl_varref"><span class="mpre">httpRedirect</span></span></a><span class="mpre">
      </span><a href="#loc_155_8_155_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_8_155_13&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
      (\</span><a name="loc_157_9_157_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_12&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> -&gt; do
        </span><a name="loc_158_9_158_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_9_158_12&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_74_1_74_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_8&#39;)"><span class="hl_varref"><span class="mpre">httpRaw</span></span></a><span class="mpre"> </span><a href="#loc_157_9_157_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_12&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><a href="#loc_148_19_148_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_19_148_26&#39;)"><span class="hl_varref"><span class="mpre">manager</span></span></a><span class="mpre">
        let </span><a name="loc_159_13_159_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_13_159_17&#39;)"><span class="hl_vardecl"><span class="mpre">mreq</span></span></a><span class="mpre"> = </span><a href="Network.HTTP.Client.Response.html#loc_56_1_56_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Response.html#loc_56_1_56_21&#39;)"><span class="hl_varref"><span class="mpre">getRedirectedRequest</span></span></a><span class="mpre"> </span><a href="#loc_157_9_157_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_9_157_12&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_413_7_413_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_413_7_413_22&#39;)"><span class="hl_varref"><span class="mpre">responseHeaders</span></span></a><span class="mpre"> </span><a href="#loc_158_9_158_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_9_158_12&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">) (</span><a href="Network.HTTP.Client.Types.html#loc_421_7_421_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_421_7_421_24&#39;)"><span class="hl_varref"><span class="mpre">responseCookieJar</span></span></a><span class="mpre"> </span><a href="#loc_158_9_158_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_9_158_12&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">statusCode</span></span><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_405_7_405_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_405_7_405_21&#39;)"><span class="hl_varref"><span class="mpre">responseStatus</span></span></a><span class="mpre"> </span><a href="#loc_158_9_158_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_9_158_12&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">))
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_158_9_158_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_9_158_12&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">, </span><a href="#loc_159_13_159_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_13_159_17&#39;)"><span class="hl_varref"><span class="mpre">mreq</span></span></a><span class="mpre">))
      </span><a href="#loc_155_14_155_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_14_155_18&#39;)"><span class="hl_varref"><span class="mpre">req&#39;</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Apply &#39;Request&#39;\&#39;s &#39;checkStatus&#39; and return resulting exception if any.</span></span><span class="mpre">
</span><a href="#loc_168_1_168_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_1_168_17&#39;)"><span class="mpre">applyCheckStatus</span></a><span class="mpre">
    :: (</span><a href="Network.HTTP.Types.Status.html#loc_114_6_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Status.html#loc_114_6_114_12&#39;)"><span class="hl_tyconref"><span class="mpre">Status</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ResponseHeaders</span></span><span class="mpre"> -&gt; </span><a href="Network.HTTP.Client.Types.html#loc_130_9_130_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_130_9_130_18&#39;)"><span class="hl_tyconref"><span class="mpre">CookieJar</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">SomeException</span></span><span class="mpre">)
    -&gt; </span><a href="Network.HTTP.Client.Types.html#loc_404_6_404_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_404_6_404_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">BodyReader</span></span><span class="mpre">
    -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">SomeException</span></span><span class="mpre">)
</span><a name="loc_168_1_168_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_1_168_17&#39;)"><span class="hl_fundecl"><span class="mpre">applyCheckStatus</span></span></a><span class="mpre"> </span><a name="loc_168_18_168_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_18_168_30&#39;)"><span class="hl_vardecl"><span class="mpre">checkStatus&#39;</span></span></a><span class="mpre"> </span><a name="loc_168_31_168_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_31_168_34&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> =
    case </span><a href="#loc_168_18_168_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_18_168_30&#39;)"><span class="hl_varref"><span class="mpre">checkStatus&#39;</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_405_7_405_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_405_7_405_21&#39;)"><span class="hl_varref"><span class="mpre">responseStatus</span></span></a><span class="mpre"> </span><a href="#loc_168_31_168_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_31_168_34&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">) (</span><a href="Network.HTTP.Client.Types.html#loc_413_7_413_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_413_7_413_22&#39;)"><span class="hl_varref"><span class="mpre">responseHeaders</span></span></a><span class="mpre"> </span><a href="#loc_168_31_168_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_31_168_34&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">) (</span><a href="Network.HTTP.Client.Types.html#loc_421_7_421_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_421_7_421_24&#39;)"><span class="hl_varref"><span class="mpre">responseCookieJar</span></span></a><span class="mpre"> </span><a href="#loc_168_31_168_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_31_168_34&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">) of
        </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_171_14_171_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_14_171_17&#39;)"><span class="hl_vardecl"><span class="mpre">exc</span></span></a><span class="mpre"> -&gt; do
            </span><a name="loc_172_13_172_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_13_172_17&#39;)"><span class="hl_vardecl"><span class="mpre">exc&#39;</span></span></a><span class="mpre"> &lt;-
                case </span><span class="hl_varref"><span class="mpre">fromException</span></span><span class="mpre"> </span><a href="#loc_171_14_171_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_14_171_17&#39;)"><span class="hl_varref"><span class="mpre">exc</span></span></a><span class="mpre"> of
                    </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_77_22_77_41" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_77_22_77_41&#39;)"><span class="hl_conref"><span class="mpre">StatusCodeException</span></span></a><span class="mpre"> </span><a name="loc_174_47_174_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_47_174_48&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_174_49_174_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_49_174_53&#39;)"><span class="hl_vardecl"><span class="mpre">hdrs</span></span></a><span class="mpre"> </span><a name="loc_174_54_174_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_54_174_64&#39;)"><span class="hl_vardecl"><span class="mpre">cookie_jar</span></span></a><span class="mpre">) -&gt; do
                        </span><a name="loc_175_25_175_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_25_175_28&#39;)"><span class="hl_vardecl"><span class="mpre">lbs</span></span></a><span class="mpre"> &lt;- </span><a href="Network.HTTP.Client.Body.html#loc_33_1_33_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Body.html#loc_33_1_33_11&#39;)"><span class="hl_varref"><span class="mpre">brReadSome</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_417_7_417_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_417_7_417_19&#39;)"><span class="hl_varref"><span class="mpre">responseBody</span></span></a><span class="mpre"> </span><a href="#loc_168_31_168_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_31_168_34&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">1024</span></span><span class="mpre">
                        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">toException</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_77_22_77_41" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_77_22_77_41&#39;)"><span class="hl_conref"><span class="mpre">StatusCodeException</span></span></a><span class="mpre"> </span><a href="#loc_174_47_174_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_47_174_48&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> (</span><a href="#loc_174_49_174_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_49_174_53&#39;)"><span class="hl_varref"><span class="mpre">hdrs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">
                            [(</span><span class="hl_string"><span class="mpre">&quot;X-Response-Body-Start&quot;</span></span><span class="mpre">, </span><a href="#loc_183_5_183_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_5_183_14&#39;)"><span class="hl_varref"><span class="mpre">toStrict&#39;</span></span></a><span class="mpre"> </span><a href="#loc_175_25_175_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_25_175_28&#39;)"><span class="hl_varref"><span class="mpre">lbs</span></span></a><span class="mpre">)]) </span><a href="#loc_174_54_174_64" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_54_174_64&#39;)"><span class="hl_varref"><span class="mpre">cookie_jar</span></span></a><span class="mpre">
                    _ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_171_14_171_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_14_171_17&#39;)"><span class="hl_varref"><span class="mpre">exc</span></span></a><span class="mpre">
            </span><a href="#loc_219_1_219_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_1_219_14&#39;)"><span class="hl_varref"><span class="mpre">responseClose</span></span></a><span class="mpre"> </span><a href="#loc_168_31_168_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_31_168_34&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_172_13_172_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_172_13_172_17&#39;)"><span class="hl_varref"><span class="mpre">exc&#39;</span></span></a><span class="mpre">)
  where
#if MIN_VERSION_bytestring(0,10,0)
    </span><a name="loc_183_5_183_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_5_183_14&#39;)"><span class="hl_vardecl"><span class="mpre">toStrict&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">L.toStrict</span></span><span class="mpre">
#else
    </span><span class="hl_vardecl"><span class="mpre">toStrict&#39;</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.concat</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.toChunks</span></span><span class="mpre">
#endif

</span><span class="hl_comment"><span class="mpre">-- | Redirect loop</span></span><span class="mpre">
</span><a href="#loc_194_1_194_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_1_194_13&#39;)"><span class="mpre">httpRedirect</span></a><span class="mpre">
     :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ &#39;redirectCount&#39;</span></span><span class="mpre">
     -&gt; (</span><a href="Network.HTTP.Client.Types.html#loc_280_6_280_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_280_6_280_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_404_6_404_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_404_6_404_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">BodyReader</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_280_6_280_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_280_6_280_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre">)) </span><span class="hl_comment"><span class="mpre">-- ^ function which performs a request and returns a response, and possibly another request if there&#39;s a redirect.</span></span><span class="mpre">
     -&gt; </span><a href="Network.HTTP.Client.Types.html#loc_280_6_280_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_280_6_280_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre">
     -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_404_6_404_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_404_6_404_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">BodyReader</span></span><span class="mpre">)
</span><a name="loc_194_1_194_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_1_194_13&#39;)"><span class="hl_fundecl"><span class="mpre">httpRedirect</span></span></a><span class="mpre"> </span><a name="loc_194_14_194_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_14_194_20&#39;)"><span class="hl_vardecl"><span class="mpre">count0</span></span></a><span class="mpre"> </span><a name="loc_194_21_194_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_21_194_26&#39;)"><span class="hl_vardecl"><span class="mpre">http&#39;</span></span></a><span class="mpre"> </span><a name="loc_194_27_194_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_27_194_31&#39;)"><span class="hl_vardecl"><span class="mpre">req0</span></span></a><span class="mpre"> = </span><a href="#loc_196_5_196_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_5_196_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_194_14_194_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_14_194_20&#39;)"><span class="hl_varref"><span class="mpre">count0</span></span></a><span class="mpre"> </span><a href="#loc_194_27_194_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_27_194_31&#39;)"><span class="hl_varref"><span class="mpre">req0</span></span></a><span class="mpre"> []
  where
    </span><a name="loc_196_5_196_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_5_196_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_196_8_196_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_8_196_13&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> _ </span><a name="loc_196_16_196_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_16_196_20&#39;)"><span class="hl_vardecl"><span class="mpre">ress</span></span></a><span class="mpre"> | </span><a href="#loc_196_8_196_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_8_196_13&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_79_22_79_38" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_79_22_79_38&#39;)"><span class="hl_conref"><span class="mpre">TooManyRedirects</span></span></a><span class="mpre"> </span><a href="#loc_196_16_196_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_16_196_20&#39;)"><span class="hl_varref"><span class="mpre">ress</span></span></a><span class="mpre">
    </span><a href="#loc_196_5_196_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_5_196_7&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_197_8_197_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_8_197_13&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> </span><a name="loc_197_14_197_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_14_197_18&#39;)"><span class="hl_vardecl"><span class="mpre">req&#39;</span></span></a><span class="mpre"> </span><a name="loc_197_19_197_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_19_197_23&#39;)"><span class="hl_vardecl"><span class="mpre">ress</span></span></a><span class="mpre"> = do
        (</span><a name="loc_198_10_198_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_10_198_13&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre">, </span><a name="loc_198_15_198_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_15_198_19&#39;)"><span class="hl_vardecl"><span class="mpre">mreq</span></span></a><span class="mpre">) &lt;- </span><a href="#loc_194_21_194_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_21_194_26&#39;)"><span class="hl_varref"><span class="mpre">http&#39;</span></span></a><span class="mpre"> </span><a href="#loc_197_14_197_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_14_197_18&#39;)"><span class="hl_varref"><span class="mpre">req&#39;</span></span></a><span class="mpre">
        case </span><a href="#loc_198_15_198_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_15_198_19&#39;)"><span class="hl_varref"><span class="mpre">mreq</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_200_18_200_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_18_200_21&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> -&gt; do
                </span><span class="hl_comment"><span class="mpre">-- Allow the original connection to return to the</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- connection pool immediately by flushing the body.</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- If the response body is too large, don&#39;t flush, but</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- instead just close the connection.</span></span><span class="mpre">
                let </span><a name="loc_205_21_205_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_21_205_29&#39;)"><span class="hl_vardecl"><span class="mpre">maxFlush</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">1024</span></span><span class="mpre">
                </span><span class="hl_vardecl"><span class="mpre">lbs</span></span><span class="mpre"> &lt;- </span><a href="Network.HTTP.Client.Body.html#loc_33_1_33_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Body.html#loc_33_1_33_11&#39;)"><span class="hl_varref"><span class="mpre">brReadSome</span></span></a><span class="mpre"> (</span><a href="Network.HTTP.Client.Types.html#loc_417_7_417_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_417_7_417_19&#39;)"><span class="hl_varref"><span class="mpre">responseBody</span></span></a><span class="mpre"> </span><a href="#loc_198_10_198_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_10_198_13&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">) </span><a href="#loc_205_21_205_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_21_205_29&#39;)"><span class="hl_varref"><span class="mpre">maxFlush</span></span></a><span class="mpre">
                </span><a href="#loc_219_1_219_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_1_219_14&#39;)"><span class="hl_varref"><span class="mpre">responseClose</span></span></a><span class="mpre"> </span><a href="#loc_198_10_198_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_10_198_13&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">

                </span><span class="hl_comment"><span class="mpre">-- And now perform the actual redirect</span></span><span class="mpre">
                </span><a href="#loc_196_5_196_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_5_196_7&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><a href="#loc_197_8_197_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_8_197_13&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_200_18_200_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_18_200_21&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> (</span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Core.hs&quot;, srcSpanStartLine = 210, srcSpanStartColumn = 37, srcSpanEndLine = 210, srcSpanEndColumn = 63}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HTTP/Client/Core.hs&quot;, srcSpanStartLine = 210, srcSpanStartColumn = 41, srcSpanEndLine = 210, srcSpanEndColumn = 42},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/http-client-0.3.5/Network/HT"><span class="mpre">res { responseBody = lbs }</span></span><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_197_19_197_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_19_197_23&#39;)"><span class="hl_varref"><span class="mpre">ress</span></span></a><span class="mpre">)
            </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_198_10_198_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_10_198_13&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Close any open resources associated with the given @Response@. In general,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- this will either close an active @Connection@ or return it to the @Manager@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to be reused.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Since 0.1.0</span></span><span class="mpre">
</span><a href="#loc_219_1_219_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_1_219_14&#39;)"><span class="mpre">responseClose</span></a><span class="mpre"> :: </span><a href="Network.HTTP.Client.Types.html#loc_404_6_404_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_404_6_404_14&#39;)"><span class="hl_tyconref"><span class="mpre">Response</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_219_1_219_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_1_219_14&#39;)"><span class="hl_vardecl"><span class="mpre">responseClose</span></span></a><span class="mpre"> = </span><a href="Network.HTTP.Client.Types.html#loc_436_41_436_57" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_436_41_436_57&#39;)"><span class="hl_varref"><span class="mpre">runResponseClose</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Network.HTTP.Client.Types.html#loc_427_7_427_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Client.Types.html#loc_427_7_427_21&#39;)"><span class="hl_varref"><span class="mpre">responseClose&#39;</span></span></a><span class="mpre">
</span></div></body></html>