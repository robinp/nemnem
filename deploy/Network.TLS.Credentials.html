<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Network.TLS.Credentials</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Network.TLS.Credentials
    ( Credential
    , Credentials(..)
    , credentialLoadX509
    , credentialLoadX509FromMemory
    , credentialsFindForSigning
    , credentialsFindForDecrypting
    , credentialsListSigningAlgorithms
    ) where

import Data.Monoid
import Data.Maybe (</span><a href="Data.Maybe.html#loc_115_1_115_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_115_1_115_10&#39;)"><span class="mpre">catMaybes</span></a><span class="mpre">)
import Data.List (</span><a href="Data.List.html#loc_261_1_261_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_261_1_261_5&#39;)"><span class="mpre">find</span></a><span class="mpre">)
import Network.TLS.Struct
import Network.TLS.X509
import Data.X509.File
import Data.X509.Memory
import Data.X509

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Credentials.hs&quot;, srcSpanStartLine = 27, srcSpanStartColumn = 1, srcSpanEndLine = 27, srcSpanEndColumn = 46}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Credentials.hs&quot;, srcSpanStartLine = 27, srcSpanStartColumn = 1, srcSpanEndLine = 27, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Credentials.hs&quot;, srcSpanStartLin"><span class="mpre">type Credential = (CertificateChain, PrivKey)</span></span><span class="mpre">

newtype </span><a name="loc_29_9_29_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_9_29_20&#39;)"><span class="hl_tycondecl"><span class="mpre">Credentials</span></span></a><span class="mpre"> = </span><a name="loc_29_23_29_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_23_29_34&#39;)"><span class="hl_condecl"><span class="mpre">Credentials</span></span></a><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">Credential</span></span><span class="mpre">]

instance </span><a href="Data.Monoid.html#loc_79_7_79_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_79_7_79_13&#39;)"><span class="hl_classref"><span class="mpre">Monoid</span></span></a><span class="mpre"> </span><a href="#loc_29_9_29_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_9_29_20&#39;)"><span class="hl_tyconref"><span class="mpre">Credentials</span></span></a><span class="mpre"> where
    </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_vardecl"><span class="mpre">mempty</span></span></a><span class="mpre"> = </span><a href="#loc_29_23_29_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_23_29_34&#39;)"><span class="hl_conref"><span class="mpre">Credentials</span></span></a><span class="mpre"> []
    </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_fundecl"><span class="mpre">mappend</span></span></a><span class="mpre"> (</span><a href="#loc_29_23_29_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_23_29_34&#39;)"><span class="hl_conref"><span class="mpre">Credentials</span></span></a><span class="mpre"> </span><a name="loc_33_26_33_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_26_33_28&#39;)"><span class="hl_vardecl"><span class="mpre">l1</span></span></a><span class="mpre">) (</span><a href="#loc_29_23_29_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_23_29_34&#39;)"><span class="hl_conref"><span class="mpre">Credentials</span></span></a><span class="mpre"> </span><a name="loc_33_43_33_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_43_33_45&#39;)"><span class="hl_vardecl"><span class="mpre">l2</span></span></a><span class="mpre">) = </span><a href="#loc_29_23_29_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_23_29_34&#39;)"><span class="hl_conref"><span class="mpre">Credentials</span></span></a><span class="mpre"> (</span><a href="#loc_33_26_33_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_26_33_28&#39;)"><span class="hl_varref"><span class="mpre">l1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_33_43_33_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_43_33_45&#39;)"><span class="hl_varref"><span class="mpre">l2</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | try to create a new credential object from a public certificate</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- and the associated private key that are stored on the filesystem</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in PEM format.</span></span><span class="mpre">
</span><a href="#loc_41_1_41_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_19&#39;)"><span class="mpre">credentialLoadX509</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ public certificate (X.509 format)</span></span><span class="mpre">
                   -&gt; </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ private key associated</span></span><span class="mpre">
                   -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Credential</span></span><span class="mpre">)
</span><a name="loc_41_1_41_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_1_41_19&#39;)"><span class="hl_fundecl"><span class="mpre">credentialLoadX509</span></span></a><span class="mpre"> </span><a name="loc_41_20_41_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_20_41_28&#39;)"><span class="hl_vardecl"><span class="mpre">certFile</span></span></a><span class="mpre"> </span><a name="loc_41_29_41_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_29_41_40&#39;)"><span class="hl_vardecl"><span class="mpre">privateFile</span></span></a><span class="mpre"> = do
    </span><a name="loc_42_5_42_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_5_42_9&#39;)"><span class="hl_vardecl"><span class="mpre">x509</span></span></a><span class="mpre"> &lt;- </span><a href="Data.X509.File.html#loc_27_1_27_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.File.html#loc_27_1_27_17&#39;)"><span class="hl_varref"><span class="mpre">readSignedObject</span></span></a><span class="mpre"> </span><a href="#loc_41_20_41_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_20_41_28&#39;)"><span class="hl_varref"><span class="mpre">certFile</span></span></a><span class="mpre">
    </span><a name="loc_43_5_43_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_5_43_9&#39;)"><span class="hl_vardecl"><span class="mpre">keys</span></span></a><span class="mpre"> &lt;- </span><a href="Data.X509.File.html#loc_35_1_35_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.File.html#loc_35_1_35_12&#39;)"><span class="hl_varref"><span class="mpre">readKeyFile</span></span></a><span class="mpre"> </span><a href="#loc_41_29_41_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_29_41_40&#39;)"><span class="hl_varref"><span class="mpre">privateFile</span></span></a><span class="mpre">
    case </span><a href="#loc_43_5_43_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_5_43_9&#39;)"><span class="hl_varref"><span class="mpre">keys</span></span></a><span class="mpre"> of
        []    -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;no keys found&quot;</span></span><span class="mpre">
        (</span><a name="loc_46_10_46_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_10_46_11&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_) -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="Data.X509.CertificateChain.html#loc_21_28_21_44" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.CertificateChain.html#loc_21_28_21_44&#39;)"><span class="hl_conref"><span class="mpre">CertificateChain</span></span></a><span class="mpre"> </span><a href="#loc_42_5_42_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_5_42_9&#39;)"><span class="hl_varref"><span class="mpre">x509</span></span></a><span class="mpre">, </span><a href="#loc_46_10_46_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_10_46_11&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | similar to &#39;credentialLoadX509&#39; but take the certificate</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- and private key from memory instead of from the filesystem.</span></span><span class="mpre">
</span><a href="#loc_53_1_53_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_29&#39;)"><span class="mpre">credentialLoadX509FromMemory</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre">
                  -&gt; </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre">
                  -&gt; </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Credential</span></span><span class="mpre">
</span><a name="loc_53_1_53_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_1_53_29&#39;)"><span class="hl_fundecl"><span class="mpre">credentialLoadX509FromMemory</span></span></a><span class="mpre"> </span><a name="loc_53_30_53_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_30_53_38&#39;)"><span class="hl_vardecl"><span class="mpre">certData</span></span></a><span class="mpre"> </span><a name="loc_53_39_53_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_39_53_50&#39;)"><span class="hl_vardecl"><span class="mpre">privateData</span></span></a><span class="mpre"> = do
    let </span><a name="loc_54_9_54_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_9_54_13&#39;)"><span class="hl_vardecl"><span class="mpre">x509</span></span></a><span class="mpre"> = </span><a href="Data.X509.Memory.html#loc_46_1_46_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.Memory.html#loc_46_1_46_27&#39;)"><span class="hl_varref"><span class="mpre">readSignedObjectFromMemory</span></span></a><span class="mpre"> </span><a href="#loc_53_30_53_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_30_53_38&#39;)"><span class="hl_varref"><span class="mpre">certData</span></span></a><span class="mpre">
        </span><a name="loc_55_9_55_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_9_55_13&#39;)"><span class="hl_vardecl"><span class="mpre">keys</span></span></a><span class="mpre"> = </span><a href="Data.X509.Memory.html#loc_24_1_24_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.Memory.html#loc_24_1_24_22&#39;)"><span class="hl_varref"><span class="mpre">readKeyFileFromMemory</span></span></a><span class="mpre"> </span><a href="#loc_53_39_53_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_39_53_50&#39;)"><span class="hl_varref"><span class="mpre">privateData</span></span></a><span class="mpre">
     in case </span><a href="#loc_55_9_55_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_9_55_13&#39;)"><span class="hl_varref"><span class="mpre">keys</span></span></a><span class="mpre"> of
            []    -&gt; </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;no keys found&quot;</span></span><span class="mpre">
            (</span><a name="loc_58_14_58_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_14_58_15&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_) -&gt; </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="Data.X509.CertificateChain.html#loc_21_28_21_44" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.CertificateChain.html#loc_21_28_21_44&#39;)"><span class="hl_conref"><span class="mpre">CertificateChain</span></span></a><span class="mpre"> </span><a href="#loc_54_9_54_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_9_54_13&#39;)"><span class="hl_varref"><span class="mpre">x509</span></span></a><span class="mpre">, </span><a href="#loc_58_14_58_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_14_58_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)
  where

</span><a href="#loc_62_1_62_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_33&#39;)"><span class="mpre">credentialsListSigningAlgorithms</span></a><span class="mpre"> :: </span><a href="#loc_29_9_29_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_9_29_20&#39;)"><span class="hl_tyconref"><span class="mpre">Credentials</span></span></a><span class="mpre"> -&gt; [</span><a href="Network.TLS.Struct.html#loc_97_6_97_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_97_6_97_24&#39;)"><span class="hl_tyconref"><span class="mpre">SignatureAlgorithm</span></span></a><span class="mpre">]
</span><a name="loc_62_1_62_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_33&#39;)"><span class="hl_fundecl"><span class="mpre">credentialsListSigningAlgorithms</span></span></a><span class="mpre"> (</span><a href="#loc_29_23_29_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_23_29_34&#39;)"><span class="hl_conref"><span class="mpre">Credentials</span></span></a><span class="mpre"> </span><a name="loc_62_47_62_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_47_62_48&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) = </span><a href="Data.Maybe.html#loc_115_1_115_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_115_1_115_10&#39;)"><span class="hl_varref"><span class="mpre">catMaybes</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_90_1_90_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_18&#39;)"><span class="hl_varref"><span class="mpre">credentialCanSign</span></span></a><span class="mpre"> </span><a href="#loc_62_47_62_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_47_62_48&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">

</span><a href="#loc_65_1_65_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_1_65_26&#39;)"><span class="mpre">credentialsFindForSigning</span></a><span class="mpre"> :: </span><a href="Network.TLS.Struct.html#loc_97_6_97_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_97_6_97_24&#39;)"><span class="hl_tyconref"><span class="mpre">SignatureAlgorithm</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_29_9_29_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_9_29_20&#39;)"><span class="hl_tyconref"><span class="mpre">Credentials</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> (</span><a href="Data.X509.CertificateChain.html#loc_21_9_21_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.CertificateChain.html#loc_21_9_21_25&#39;)"><span class="hl_tyconref"><span class="mpre">CertificateChain</span></span></a><span class="mpre">, </span><a href="Data.X509.PrivateKey.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.PrivateKey.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">PrivKey</span></span></a><span class="mpre">)
</span><a name="loc_65_1_65_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_1_65_26&#39;)"><span class="hl_fundecl"><span class="mpre">credentialsFindForSigning</span></span></a><span class="mpre"> </span><a name="loc_65_27_65_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_27_65_33&#39;)"><span class="hl_vardecl"><span class="mpre">sigAlg</span></span></a><span class="mpre"> (</span><a href="#loc_29_23_29_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_23_29_34&#39;)"><span class="hl_conref"><span class="mpre">Credentials</span></span></a><span class="mpre"> </span><a name="loc_65_47_65_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_47_65_48&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) = </span><a href="Data.List.html#loc_261_1_261_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_261_1_261_5&#39;)"><span class="hl_varref"><span class="mpre">find</span></span></a><span class="mpre"> </span><a href="#loc_66_9_66_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_9_66_19&#39;)"><span class="hl_varref"><span class="mpre">forSigning</span></span></a><span class="mpre"> </span><a href="#loc_65_47_65_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_47_65_48&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
  where </span><a name="loc_66_9_66_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_9_66_19&#39;)"><span class="hl_fundecl"><span class="mpre">forSigning</span></span></a><span class="mpre"> </span><a name="loc_66_20_66_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_20_66_24&#39;)"><span class="hl_vardecl"><span class="mpre">cred</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_65_27_65_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_27_65_33&#39;)"><span class="hl_varref"><span class="mpre">sigAlg</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_90_1_90_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_18&#39;)"><span class="hl_varref"><span class="mpre">credentialCanSign</span></span></a><span class="mpre"> </span><a href="#loc_66_20_66_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_20_66_24&#39;)"><span class="hl_varref"><span class="mpre">cred</span></span></a><span class="mpre">

</span><a href="#loc_69_1_69_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_1_69_29&#39;)"><span class="mpre">credentialsFindForDecrypting</span></a><span class="mpre"> :: </span><a href="#loc_29_9_29_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_9_29_20&#39;)"><span class="hl_tyconref"><span class="mpre">Credentials</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> (</span><a href="Data.X509.CertificateChain.html#loc_21_9_21_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.CertificateChain.html#loc_21_9_21_25&#39;)"><span class="hl_tyconref"><span class="mpre">CertificateChain</span></span></a><span class="mpre">, </span><a href="Data.X509.PrivateKey.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.PrivateKey.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">PrivKey</span></span></a><span class="mpre">)
</span><a name="loc_69_1_69_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_1_69_29&#39;)"><span class="hl_fundecl"><span class="mpre">credentialsFindForDecrypting</span></span></a><span class="mpre"> (</span><a href="#loc_29_23_29_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_23_29_34&#39;)"><span class="hl_conref"><span class="mpre">Credentials</span></span></a><span class="mpre"> </span><a name="loc_69_43_69_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_43_69_44&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) = </span><a href="Data.List.html#loc_261_1_261_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_261_1_261_5&#39;)"><span class="hl_varref"><span class="mpre">find</span></span></a><span class="mpre"> </span><a href="#loc_70_9_70_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_9_70_22&#39;)"><span class="hl_varref"><span class="mpre">forEncrypting</span></span></a><span class="mpre"> </span><a href="#loc_69_43_69_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_43_69_44&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
  where </span><a name="loc_70_9_70_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_9_70_22&#39;)"><span class="hl_fundecl"><span class="mpre">forEncrypting</span></span></a><span class="mpre"> </span><a name="loc_70_23_70_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_23_70_27&#39;)"><span class="hl_vardecl"><span class="mpre">cred</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_76_1_76_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_21&#39;)"><span class="hl_varref"><span class="mpre">credentialCanDecrypt</span></span></a><span class="mpre"> </span><a href="#loc_70_23_70_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_23_70_27&#39;)"><span class="hl_varref"><span class="mpre">cred</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- here we assume that only RSA is supported for key encipherment (encryption/decryption)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- we keep the same construction as &#39;credentialCanSign&#39;, returning a Maybe of () in case</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- this change in future.</span></span><span class="mpre">
</span><a href="#loc_76_1_76_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_21&#39;)"><span class="mpre">credentialCanDecrypt</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Credential</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_76_1_76_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_21&#39;)"><span class="hl_fundecl"><span class="mpre">credentialCanDecrypt</span></span></a><span class="mpre"> (</span><a name="loc_76_23_76_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_23_76_28&#39;)"><span class="hl_vardecl"><span class="mpre">chain</span></span></a><span class="mpre">, </span><a name="loc_76_30_76_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_30_76_34&#39;)"><span class="hl_vardecl"><span class="mpre">priv</span></span></a><span class="mpre">) =
    case </span><a href="Data.X509.Ext.html#loc_73_1_73_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.Ext.html#loc_73_1_73_13&#39;)"><span class="hl_varref"><span class="mpre">extensionGet</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">certExtensions</span></span><span class="mpre"> </span><a href="#loc_85_11_85_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_11_85_15&#39;)"><span class="hl_varref"><span class="mpre">cert</span></span></a><span class="mpre">) of
        </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">    -&gt; </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a href="Data.X509.Ext.html#loc_114_20_114_31" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.Ext.html#loc_114_20_114_31&#39;)"><span class="hl_conref"><span class="mpre">ExtKeyUsage</span></span></a><span class="mpre"> </span><a name="loc_79_27_79_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_27_79_32&#39;)"><span class="hl_vardecl"><span class="mpre">flags</span></span></a><span class="mpre">)
            | </span><a href="Data.X509.Ext.html#loc_46_7_46_31" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.Ext.html#loc_46_7_46_31&#39;)"><span class="hl_conref"><span class="mpre">KeyUsage_keyEncipherment</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`elem`</span></span><span class="mpre"> </span><a href="#loc_79_27_79_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_27_79_32&#39;)"><span class="hl_varref"><span class="mpre">flags</span></span></a><span class="mpre"> -&gt;
                case (</span><a href="#loc_86_11_86_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_11_86_14&#39;)"><span class="hl_varref"><span class="mpre">pub</span></span></a><span class="mpre">, </span><a href="#loc_76_30_76_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_30_76_34&#39;)"><span class="hl_varref"><span class="mpre">priv</span></span></a><span class="mpre">) of
                    (</span><span class="hl_conref"><span class="mpre">PubKeyRSA</span></span><span class="mpre"> _, </span><span class="hl_conref"><span class="mpre">PrivKeyRSA</span></span><span class="mpre"> _) -&gt; </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
                    _                           -&gt; </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
            | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">                         -&gt; </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
    where </span><a name="loc_85_11_85_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_11_85_15&#39;)"><span class="hl_vardecl"><span class="mpre">cert</span></span></a><span class="mpre">   = </span><span class="hl_varref"><span class="mpre">signedObject</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.X509.Signed.html#loc_66_7_66_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.Signed.html#loc_66_7_66_16&#39;)"><span class="hl_varref"><span class="mpre">getSigned</span></span></a><span class="mpre"> </span><a href="#loc_87_11_87_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_11_87_17&#39;)"><span class="hl_varref"><span class="mpre">signed</span></span></a><span class="mpre">
          </span><a name="loc_86_11_86_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_11_86_14&#39;)"><span class="hl_vardecl"><span class="mpre">pub</span></span></a><span class="mpre">    = </span><span class="hl_varref"><span class="mpre">certPubKey</span></span><span class="mpre"> </span><a href="#loc_85_11_85_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_11_85_15&#39;)"><span class="hl_varref"><span class="mpre">cert</span></span></a><span class="mpre">
          </span><a name="loc_87_11_87_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_11_87_17&#39;)"><span class="hl_vardecl"><span class="mpre">signed</span></span></a><span class="mpre"> = </span><a href="Network.TLS.X509.html#loc_36_1_36_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.X509.html#loc_36_1_36_24&#39;)"><span class="hl_varref"><span class="mpre">getCertificateChainLeaf</span></span></a><span class="mpre"> </span><a href="#loc_76_23_76_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_23_76_28&#39;)"><span class="hl_varref"><span class="mpre">chain</span></span></a><span class="mpre">

</span><a href="#loc_90_1_90_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_18&#39;)"><span class="mpre">credentialCanSign</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Credential</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_97_6_97_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_97_6_97_24&#39;)"><span class="hl_tyconref"><span class="mpre">SignatureAlgorithm</span></span></a><span class="mpre">
</span><a name="loc_90_1_90_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_1_90_18&#39;)"><span class="hl_fundecl"><span class="mpre">credentialCanSign</span></span></a><span class="mpre"> (</span><a name="loc_90_20_90_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_20_90_25&#39;)"><span class="hl_vardecl"><span class="mpre">chain</span></span></a><span class="mpre">, </span><a name="loc_90_27_90_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_27_90_31&#39;)"><span class="hl_vardecl"><span class="mpre">priv</span></span></a><span class="mpre">) =
    case </span><a href="Data.X509.Ext.html#loc_73_1_73_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.Ext.html#loc_73_1_73_13&#39;)"><span class="hl_varref"><span class="mpre">extensionGet</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">certExtensions</span></span><span class="mpre"> </span><a href="#loc_96_11_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_11_96_15&#39;)"><span class="hl_varref"><span class="mpre">cert</span></span></a><span class="mpre">) of
        </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">    -&gt; </span><a href="#loc_101_1_101_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_16&#39;)"><span class="hl_varref"><span class="mpre">getSignatureAlg</span></span></a><span class="mpre"> </span><a href="#loc_97_11_97_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_11_97_14&#39;)"><span class="hl_varref"><span class="mpre">pub</span></span></a><span class="mpre"> </span><a href="#loc_90_27_90_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_27_90_31&#39;)"><span class="hl_varref"><span class="mpre">priv</span></span></a><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a href="Data.X509.Ext.html#loc_114_20_114_31" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.Ext.html#loc_114_20_114_31&#39;)"><span class="hl_conref"><span class="mpre">ExtKeyUsage</span></span></a><span class="mpre"> </span><a name="loc_93_27_93_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_27_93_32&#39;)"><span class="hl_vardecl"><span class="mpre">flags</span></span></a><span class="mpre">)
            | </span><a href="Data.X509.Ext.html#loc_44_7_44_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.Ext.html#loc_44_7_44_32&#39;)"><span class="hl_conref"><span class="mpre">KeyUsage_digitalSignature</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`elem`</span></span><span class="mpre"> </span><a href="#loc_93_27_93_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_27_93_32&#39;)"><span class="hl_varref"><span class="mpre">flags</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_101_1_101_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_16&#39;)"><span class="hl_varref"><span class="mpre">getSignatureAlg</span></span></a><span class="mpre"> </span><a href="#loc_97_11_97_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_11_97_14&#39;)"><span class="hl_varref"><span class="mpre">pub</span></span></a><span class="mpre"> </span><a href="#loc_90_27_90_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_27_90_31&#39;)"><span class="hl_varref"><span class="mpre">priv</span></span></a><span class="mpre">
            | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">                              -&gt; </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
    where </span><a name="loc_96_11_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_11_96_15&#39;)"><span class="hl_vardecl"><span class="mpre">cert</span></span></a><span class="mpre">   = </span><span class="hl_varref"><span class="mpre">signedObject</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.X509.Signed.html#loc_66_7_66_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.Signed.html#loc_66_7_66_16&#39;)"><span class="hl_varref"><span class="mpre">getSigned</span></span></a><span class="mpre"> </span><a href="#loc_98_11_98_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_11_98_17&#39;)"><span class="hl_varref"><span class="mpre">signed</span></span></a><span class="mpre">
          </span><a name="loc_97_11_97_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_97_11_97_14&#39;)"><span class="hl_vardecl"><span class="mpre">pub</span></span></a><span class="mpre">    = </span><span class="hl_varref"><span class="mpre">certPubKey</span></span><span class="mpre"> </span><a href="#loc_96_11_96_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_11_96_15&#39;)"><span class="hl_varref"><span class="mpre">cert</span></span></a><span class="mpre">
          </span><a name="loc_98_11_98_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_11_98_17&#39;)"><span class="hl_vardecl"><span class="mpre">signed</span></span></a><span class="mpre"> = </span><a href="Network.TLS.X509.html#loc_36_1_36_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.X509.html#loc_36_1_36_24&#39;)"><span class="hl_varref"><span class="mpre">getCertificateChainLeaf</span></span></a><span class="mpre"> </span><a href="#loc_90_20_90_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_20_90_25&#39;)"><span class="hl_varref"><span class="mpre">chain</span></span></a><span class="mpre">

</span><a href="#loc_101_1_101_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_16&#39;)"><span class="mpre">getSignatureAlg</span></a><span class="mpre"> :: </span><a href="Data.X509.PublicKey.html#loc_31_6_31_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.PublicKey.html#loc_31_6_31_12&#39;)"><span class="hl_tyconref"><span class="mpre">PubKey</span></span></a><span class="mpre"> -&gt; </span><a href="Data.X509.PrivateKey.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.PrivateKey.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">PrivKey</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_97_6_97_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_97_6_97_24&#39;)"><span class="hl_tyconref"><span class="mpre">SignatureAlgorithm</span></span></a><span class="mpre">
</span><a name="loc_101_1_101_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_16&#39;)"><span class="hl_fundecl"><span class="mpre">getSignatureAlg</span></span></a><span class="mpre"> </span><a name="loc_101_17_101_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_17_101_20&#39;)"><span class="hl_vardecl"><span class="mpre">pub</span></span></a><span class="mpre"> </span><a name="loc_101_21_101_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_21_101_25&#39;)"><span class="hl_vardecl"><span class="mpre">priv</span></span></a><span class="mpre"> =
    case (</span><a href="#loc_101_17_101_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_17_101_20&#39;)"><span class="hl_varref"><span class="mpre">pub</span></span></a><span class="mpre">, </span><a href="#loc_101_21_101_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_21_101_25&#39;)"><span class="hl_varref"><span class="mpre">priv</span></span></a><span class="mpre">) of
        (</span><span class="hl_conref"><span class="mpre">PubKeyRSA</span></span><span class="mpre"> _, </span><span class="hl_conref"><span class="mpre">PrivKeyRSA</span></span><span class="mpre"> _)     -&gt; </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_99_7_99_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_99_7_99_19&#39;)"><span class="hl_conref"><span class="mpre">SignatureRSA</span></span></a><span class="mpre">
        (</span><span class="hl_conref"><span class="mpre">PubKeyDSA</span></span><span class="mpre"> _, </span><span class="hl_conref"><span class="mpre">PrivKeyDSA</span></span><span class="mpre"> _)     -&gt; </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_100_7_100_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_100_7_100_19&#39;)"><span class="hl_conref"><span class="mpre">SignatureDSS</span></span></a><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">--(PubKeyECDSA _, PrivKeyECDSA _) -&gt; Just SignatureECDSA</span></span><span class="mpre">
        _                               -&gt; </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
</span></div></body></html>