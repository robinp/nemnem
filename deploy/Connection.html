<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">module Connection
    ( newPairContext
    , arbitraryPairParams
    , setPairParamsSessionManager
    , setPairParamsSessionResuming
    , establishDataPipe
    , blockCipher
    , streamCipher
    ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 11, srcSpanStartColumn = 8, srcSpanEndLine = 11, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Test.QuickCheck&quot;"><span class="mpre">Test.QuickCheck</span></span><span class="mpre">
import Certificate
import PubKey
import PipeChan
import Network.TLS
import Data.X509
import Data.Default.Class
import Control.Applicative
import Control.Concurrent.Chan
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 20, srcSpanStartColumn = 8, srcSpanEndLine = 20, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;Control.Concurrent&quot;"><span class="mpre">Control.Concurrent</span></span><span class="mpre">
import qualified Control.Exception as E

import qualified Crypto.Random.AESCtr as RNG
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 18, srcSpanEndLine = 24, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B

</span><a name="loc_26_1_26_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_1_26_6&#39;)"><span class="hl_vardecl"><span class="mpre">debug</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

</span><a href="#loc_29_1_29_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_1_29_12&#39;)"><span class="mpre">blockCipher</span></a><span class="mpre"> :: </span><a href="Network.TLS.Cipher.html#loc_82_6_82_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_82_6_82_12&#39;)"><span class="hl_tyconref"><span class="mpre">Cipher</span></span></a><span class="mpre">
</span><a name="loc_29_1_29_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_1_29_12&#39;)"><span class="hl_vardecl"><span class="mpre">blockCipher</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 29, srcSpanStartColumn = 15, srcSpanEndLine = 46, srcSpanEndColumn = 6}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 30, srcSpanStartColumn = 5, srcSpanEndLine = 30, srcSpanEndColumn = 6},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 31, srcSpanStart"><span class="mpre">Cipher
    { cipherID   = 0xff12
    , cipherName = &quot;rsa-id-const&quot;
    , cipherBulk = Bulk
        { bulkName      = &quot;id&quot;
        , bulkKeySize   = 16
        , bulkIVSize    = 16
        , bulkBlockSize = 16
        , bulkF         = BulkBlockF (\_ _ m -&gt; m) (\_ _ m -&gt; m)
        }
    , cipherHash = Hash
        { hashName = &quot;const-hash&quot;
        , hashSize = 16
        , hashF    = (\_ -&gt; B.replicate 16 1)
        }
    , cipherKeyExchange = CipherKeyExchange_RSA
    , cipherMinVer      = Nothing
    }</span></span><span class="mpre">

</span><a href="#loc_49_1_49_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_1_49_19&#39;)"><span class="mpre">blockCipherDHE_RSA</span></a><span class="mpre"> :: </span><a href="Network.TLS.Cipher.html#loc_82_6_82_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_82_6_82_12&#39;)"><span class="hl_tyconref"><span class="mpre">Cipher</span></span></a><span class="mpre">
</span><a name="loc_49_1_49_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_1_49_19&#39;)"><span class="hl_vardecl"><span class="mpre">blockCipherDHE_RSA</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 49, srcSpanStartColumn = 22, srcSpanEndLine = 53, srcSpanEndColumn = 6}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 50, srcSpanStartColumn = 5, srcSpanEndLine = 50, srcSpanEndColumn = 6},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 51, srcSpanStart"><span class="mpre">blockCipher
    { cipherID   = 0xff14
    , cipherName = &quot;dhe-rsa-id-const&quot;
    , cipherKeyExchange = CipherKeyExchange_DHE_RSA
    }</span></span><span class="mpre">

</span><a href="#loc_56_1_56_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_19&#39;)"><span class="mpre">blockCipherDHE_DSS</span></a><span class="mpre"> :: </span><a href="Network.TLS.Cipher.html#loc_82_6_82_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_82_6_82_12&#39;)"><span class="hl_tyconref"><span class="mpre">Cipher</span></span></a><span class="mpre">
</span><a name="loc_56_1_56_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_19&#39;)"><span class="hl_vardecl"><span class="mpre">blockCipherDHE_DSS</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 56, srcSpanStartColumn = 22, srcSpanEndLine = 60, srcSpanEndColumn = 6}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 57, srcSpanStartColumn = 5, srcSpanEndLine = 57, srcSpanEndColumn = 6},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 58, srcSpanStart"><span class="mpre">blockCipher
    { cipherID   = 0xff15
    , cipherName = &quot;dhe-dss-id-const&quot;
    , cipherKeyExchange = CipherKeyExchange_DHE_DSS
    }</span></span><span class="mpre">

</span><a href="#loc_63_1_63_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_1_63_13&#39;)"><span class="mpre">streamCipher</span></a><span class="mpre"> :: </span><a href="Network.TLS.Cipher.html#loc_82_6_82_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_82_6_82_12&#39;)"><span class="hl_tyconref"><span class="mpre">Cipher</span></span></a><span class="mpre">
</span><a name="loc_63_1_63_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_1_63_13&#39;)"><span class="hl_vardecl"><span class="mpre">streamCipher</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 63, srcSpanStartColumn = 16, srcSpanEndLine = 72, srcSpanEndColumn = 6}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 64, srcSpanStartColumn = 5, srcSpanEndLine = 64, srcSpanEndColumn = 6},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 65, srcSpanStart"><span class="mpre">blockCipher
    { cipherID   = 0xff13
    , cipherBulk = Bulk
        { bulkName      = &quot;stream&quot;
        , bulkKeySize   = 16
        , bulkIVSize    = 0
        , bulkBlockSize = 0
        , bulkF         = BulkStreamF (\k -&gt; k) (\i m -&gt; (m,i)) (\i m -&gt; (m,i))
        }
    }</span></span><span class="mpre">

</span><a href="#loc_75_1_75_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_13&#39;)"><span class="mpre">knownCiphers</span></a><span class="mpre"> :: [</span><a href="Network.TLS.Cipher.html#loc_82_6_82_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_82_6_82_12&#39;)"><span class="hl_tyconref"><span class="mpre">Cipher</span></span></a><span class="mpre">]
</span><a name="loc_75_1_75_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_13&#39;)"><span class="hl_vardecl"><span class="mpre">knownCiphers</span></span></a><span class="mpre"> = [</span><a href="#loc_29_1_29_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_1_29_12&#39;)"><span class="hl_varref"><span class="mpre">blockCipher</span></span></a><span class="mpre">,</span><a href="#loc_49_1_49_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_1_49_19&#39;)"><span class="hl_varref"><span class="mpre">blockCipherDHE_RSA</span></span></a><span class="mpre">,</span><a href="#loc_56_1_56_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_1_56_19&#39;)"><span class="hl_varref"><span class="mpre">blockCipherDHE_DSS</span></span></a><span class="mpre">,</span><a href="#loc_63_1_63_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_1_63_13&#39;)"><span class="hl_varref"><span class="mpre">streamCipher</span></span></a><span class="mpre">]

</span><a href="#loc_78_1_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_14&#39;)"><span class="mpre">knownVersions</span></a><span class="mpre"> :: [</span><a href="Network.TLS.Types.html#loc_25_6_25_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_6_25_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre">]
</span><a name="loc_78_1_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_14&#39;)"><span class="hl_vardecl"><span class="mpre">knownVersions</span></span></a><span class="mpre"> = [</span><span class="hl_conref"><span class="mpre">SSL3</span></span><span class="mpre">,</span><span class="hl_conref"><span class="mpre">TLS10</span></span><span class="mpre">,</span><span class="hl_conref"><span class="mpre">TLS11</span></span><span class="mpre">,</span><span class="hl_conref"><span class="mpre">TLS12</span></span><span class="mpre">]

</span><a name="loc_80_1_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_1_80_20&#39;)"><span class="hl_vardecl"><span class="mpre">arbitraryPairParams</span></span></a><span class="mpre"> = do
    (</span><a name="loc_81_6_81_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_6_81_12&#39;)"><span class="hl_vardecl"><span class="mpre">dsaPub</span></span></a><span class="mpre">, </span><a name="loc_81_14_81_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_14_81_21&#39;)"><span class="hl_vardecl"><span class="mpre">dsaPriv</span></span></a><span class="mpre">) &lt;- (\(</span><a name="loc_81_29_81_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_29_81_30&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre">,</span><a name="loc_81_31_81_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_31_81_32&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">) -&gt; (</span><span class="hl_conref"><span class="mpre">PubKeyDSA</span></span><span class="mpre"> </span><a href="#loc_81_29_81_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_29_81_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">PrivKeyDSA</span></span><span class="mpre"> </span><a href="#loc_81_31_81_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_31_81_32&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">)) </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="PubKey.html#loc_68_1_68_17" onmouseover="nemnem.highlightLocalToRemote(&#39;PubKey.html#loc_68_1_68_17&#39;)"><span class="hl_varref"><span class="mpre">arbitraryDSAPair</span></span></a><span class="mpre">
    let (</span><a name="loc_82_10_82_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_10_82_16&#39;)"><span class="hl_vardecl"><span class="mpre">pubKey</span></span></a><span class="mpre">, </span><a name="loc_82_18_82_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_18_82_25&#39;)"><span class="hl_vardecl"><span class="mpre">privKey</span></span></a><span class="mpre">) = (\(</span><a name="loc_82_32_82_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_32_82_33&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre">, </span><a name="loc_82_35_82_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_35_82_36&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">) -&gt; (</span><span class="hl_conref"><span class="mpre">PubKeyRSA</span></span><span class="mpre"> </span><a href="#loc_82_32_82_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_32_82_33&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">PrivKeyRSA</span></span><span class="mpre"> </span><a href="#loc_82_35_82_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_35_82_36&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="PubKey.html#loc_37_1_37_17" onmouseover="nemnem.highlightLocalToRemote(&#39;PubKey.html#loc_37_1_37_17&#39;)"><span class="hl_varref"><span class="mpre">getGlobalRSAPair</span></span></a><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">creds</span></span><span class="mpre">              &lt;- </span><span class="hl_varref"><span class="mpre">mapM</span></span><span class="mpre"> (\(</span><a name="loc_83_35_83_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_35_83_38&#39;)"><span class="hl_vardecl"><span class="mpre">pub</span></span></a><span class="mpre">, </span><a name="loc_83_40_83_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_40_83_44&#39;)"><span class="hl_vardecl"><span class="mpre">priv</span></span></a><span class="mpre">) -&gt; do
                                    </span><a name="loc_84_37_84_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_37_84_41&#39;)"><span class="hl_vardecl"><span class="mpre">cert</span></span></a><span class="mpre"> &lt;- </span><a href="Certificate.html#loc_77_1_77_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Certificate.html#loc_77_1_77_21&#39;)"><span class="hl_varref"><span class="mpre">arbitraryX509WithKey</span></span></a><span class="mpre"> (</span><a href="#loc_83_35_83_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_35_83_38&#39;)"><span class="hl_varref"><span class="mpre">pub</span></span></a><span class="mpre">, </span><a href="#loc_83_40_83_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_40_83_44&#39;)"><span class="hl_varref"><span class="mpre">priv</span></span></a><span class="mpre">)
                                    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Data.X509.CertificateChain.html#loc_21_28_21_44" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.X509.CertificateChain.html#loc_21_28_21_44&#39;)"><span class="hl_conref"><span class="mpre">CertificateChain</span></span></a><span class="mpre"> [</span><a href="#loc_84_37_84_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_37_84_41&#39;)"><span class="hl_varref"><span class="mpre">cert</span></span></a><span class="mpre">], </span><a href="#loc_83_40_83_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_40_83_44&#39;)"><span class="hl_varref"><span class="mpre">priv</span></span></a><span class="mpre">)
                               ) [ (</span><a href="#loc_82_10_82_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_10_82_16&#39;)"><span class="hl_varref"><span class="mpre">pubKey</span></span></a><span class="mpre">, </span><a href="#loc_82_18_82_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_18_82_25&#39;)"><span class="hl_varref"><span class="mpre">privKey</span></span></a><span class="mpre">), (</span><a href="#loc_81_6_81_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_6_81_12&#39;)"><span class="hl_varref"><span class="mpre">dsaPub</span></span></a><span class="mpre">, </span><a href="#loc_81_14_81_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_14_81_21&#39;)"><span class="hl_varref"><span class="mpre">dsaPriv</span></span></a><span class="mpre">) ]
    </span><a name="loc_87_5_87_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_19&#39;)"><span class="hl_vardecl"><span class="mpre">connectVersion</span></span></a><span class="mpre">     &lt;- </span><span class="hl_varref"><span class="mpre">elements</span></span><span class="mpre"> </span><a href="#loc_78_1_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_14&#39;)"><span class="hl_varref"><span class="mpre">knownVersions</span></span></a><span class="mpre">
    let </span><a name="loc_88_9_88_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_9_88_24&#39;)"><span class="hl_vardecl"><span class="mpre">allowedVersions</span></span></a><span class="mpre"> = [ </span><a href="#loc_88_33_88_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_33_88_34&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre"> | </span><a name="loc_88_33_88_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_33_88_34&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_78_1_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_14&#39;)"><span class="hl_varref"><span class="mpre">knownVersions</span></span></a><span class="mpre">, </span><a href="#loc_88_33_88_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_33_88_34&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><a href="#loc_87_5_87_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_19&#39;)"><span class="hl_varref"><span class="mpre">connectVersion</span></span></a><span class="mpre"> ]
    </span><span class="hl_vardecl"><span class="mpre">serAllowedVersions</span></span><span class="mpre"> &lt;- (</span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">[]) </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">elements</span></span><span class="mpre"> </span><a href="#loc_88_9_88_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_9_88_24&#39;)"><span class="hl_varref"><span class="mpre">allowedVersions</span></span></a><span class="mpre">
    </span><a name="loc_90_5_90_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_18&#39;)"><span class="hl_vardecl"><span class="mpre">serverCiphers</span></span></a><span class="mpre">      &lt;- </span><a href="#loc_116_9_116_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_9_116_25&#39;)"><span class="hl_varref"><span class="mpre">arbitraryCiphers</span></span></a><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">clientCiphers</span></span><span class="mpre">      &lt;- </span><span class="hl_varref"><span class="mpre">oneof</span></span><span class="mpre"> [</span><a href="#loc_116_9_116_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_9_116_25&#39;)"><span class="hl_varref"><span class="mpre">arbitraryCiphers</span></span></a><span class="mpre">] </span><span class="hl_infix"><span class="mpre">`suchThat`</span></span><span class="mpre"> (\</span><a name="loc_91_65_91_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_65_91_67&#39;)"><span class="hl_vardecl"><span class="mpre">cs</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">or</span></span><span class="mpre"> [</span><a href="#loc_91_100_91_101" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_100_91_101&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`elem`</span></span><span class="mpre"> </span><a href="#loc_90_5_90_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_18&#39;)"><span class="hl_varref"><span class="mpre">serverCiphers</span></span></a><span class="mpre"> | </span><a name="loc_91_100_91_101" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_100_91_101&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_91_65_91_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_65_91_67&#39;)"><span class="hl_varref"><span class="mpre">cs</span></span></a><span class="mpre">])
    </span><span class="hl_vardecl"><span class="mpre">secNeg</span></span><span class="mpre">             &lt;- </span><span class="hl_varref"><span class="mpre">arbitrary</span></span><span class="mpre">


    let </span><a name="loc_95_9_95_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_9_95_20&#39;)"><span class="hl_vardecl"><span class="mpre">serverState</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 95, srcSpanStartColumn = 23, srcSpanEndLine = 102, srcSpanEndColumn = 14}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 96, srcSpanStartColumn = 13, srcSpanEndLine = 96, srcSpanEndColumn = 14},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 100, srcSpan"><span class="mpre">def
            { serverSupported = def { supportedCiphers  = serverCiphers
                                    , supportedVersions = serAllowedVersions
                                    , supportedSecureRenegotiation = secNeg
                                    }
            , serverDHEParams = Just dhParams
            , serverShared = def { sharedCredentials = Credentials creds }
            }</span></span><span class="mpre">
    let </span><a name="loc_103_9_103_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_20&#39;)"><span class="hl_vardecl"><span class="mpre">clientState</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 103, srcSpanStartColumn = 23, srcSpanEndLine = 113, srcSpanEndColumn = 14}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 104, srcSpanStartColumn = 13, srcSpanEndLine = 104, srcSpanEndColumn = 14},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 108, srcS"><span class="mpre">(defaultParamsClient &quot;&quot; B.empty)
            { clientSupported = def { supportedCiphers  = clientCiphers
                                    , supportedVersions = allowedVersions
                                    , supportedSecureRenegotiation = secNeg
                                    }
            , clientShared = def { sharedValidationCache = ValidationCache
                                        { cacheAdd = \_ _ _ -&gt; return ()
                                        , cacheQuery = \_ _ _ -&gt; return ValidationCachePass
                                        }
                                }
            }</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_103_9_103_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_20&#39;)"><span class="hl_varref"><span class="mpre">clientState</span></span></a><span class="mpre">, </span><a href="#loc_95_9_95_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_9_95_20&#39;)"><span class="hl_varref"><span class="mpre">serverState</span></span></a><span class="mpre">)
  where
        </span><a name="loc_116_9_116_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_9_116_25&#39;)"><span class="hl_vardecl"><span class="mpre">arbitraryCiphers</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">resize</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">length</span></span><span class="mpre"> </span><a href="#loc_75_1_75_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_13&#39;)"><span class="hl_varref"><span class="mpre">knownCiphers</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">listOf1</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">elements</span></span><span class="mpre"> </span><a href="#loc_75_1_75_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_75_1_75_13&#39;)"><span class="hl_varref"><span class="mpre">knownCiphers</span></span></a><span class="mpre">)

</span><a href="#loc_119_1_119_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_28&#39;)"><span class="mpre">setPairParamsSessionManager</span></a><span class="mpre"> :: </span><a href="Network.TLS.Session.html#loc_16_6_16_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Session.html#loc_16_6_16_20&#39;)"><span class="hl_tyconref"><span class="mpre">SessionManager</span></span></a><span class="mpre"> -&gt; (</span><a href="Network.TLS.Parameters.html#loc_43_6_43_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_43_6_43_18&#39;)"><span class="hl_tyconref"><span class="mpre">ClientParams</span></span></a><span class="mpre">, </span><a href="Network.TLS.Parameters.html#loc_76_6_76_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_76_6_76_18&#39;)"><span class="hl_tyconref"><span class="mpre">ServerParams</span></span></a><span class="mpre">) -&gt; (</span><a href="Network.TLS.Parameters.html#loc_43_6_43_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_43_6_43_18&#39;)"><span class="hl_tyconref"><span class="mpre">ClientParams</span></span></a><span class="mpre">, </span><a href="Network.TLS.Parameters.html#loc_76_6_76_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_76_6_76_18&#39;)"><span class="hl_tyconref"><span class="mpre">ServerParams</span></span></a><span class="mpre">)
</span><a name="loc_119_1_119_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_28&#39;)"><span class="hl_fundecl"><span class="mpre">setPairParamsSessionManager</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">manager</span></span><span class="mpre"> (</span><span class="hl_vardecl"><span class="mpre">clientState</span></span><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">serverState</span></span><span class="mpre">) = (</span><a href="#loc_120_9_120_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_9_120_11&#39;)"><span class="hl_varref"><span class="mpre">nc</span></span></a><span class="mpre">,</span><a href="#loc_121_9_121_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_9_121_11&#39;)"><span class="hl_varref"><span class="mpre">ns</span></span></a><span class="mpre">)
  where </span><a name="loc_120_9_120_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_9_120_11&#39;)"><span class="hl_vardecl"><span class="mpre">nc</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 120, srcSpanStartColumn = 14, srcSpanEndLine = 120, srcSpanEndColumn = 92}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 120, srcSpanStartColumn = 26, srcSpanEndLine = 120, srcSpanEndColumn = 27},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 120, srcS"><span class="mpre">clientState { clientShared = updateSessionManager $ clientShared clientState }</span></span><span class="mpre">
        </span><a name="loc_121_9_121_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_9_121_11&#39;)"><span class="hl_vardecl"><span class="mpre">ns</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 121, srcSpanStartColumn = 14, srcSpanEndLine = 121, srcSpanEndColumn = 92}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 121, srcSpanStartColumn = 26, srcSpanEndLine = 121, srcSpanEndColumn = 27},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 121, srcS"><span class="mpre">serverState { serverShared = updateSessionManager $ serverShared serverState }</span></span><span class="mpre">
        </span><span class="hl_fundecl"><span class="mpre">updateSessionManager</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">shared</span></span><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 122, srcSpanStartColumn = 39, srcSpanEndLine = 122, srcSpanEndColumn = 80}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 122, srcSpanStartColumn = 46, srcSpanEndLine = 122, srcSpanEndColumn = 47},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 122, srcS"><span class="mpre">shared { sharedSessionManager = manager }</span></span><span class="mpre">

</span><a name="loc_124_1_124_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_1_124_29&#39;)"><span class="hl_fundecl"><span class="mpre">setPairParamsSessionResuming</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">sessionStuff</span></span><span class="mpre"> (</span><span class="hl_vardecl"><span class="mpre">clientState</span></span><span class="mpre">, </span><a name="loc_124_57_124_68" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_57_124_68&#39;)"><span class="hl_vardecl"><span class="mpre">serverState</span></span></a><span class="mpre">) =
    ( </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 125, srcSpanStartColumn = 7, srcSpanEndLine = 125, srcSpanEndColumn = 66}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 125, srcSpanStartColumn = 19, srcSpanEndLine = 125, srcSpanEndColumn = 20},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 125, srcSp"><span class="mpre">clientState { clientWantSessionResume = Just sessionStuff }</span></span><span class="mpre">
    , </span><a href="#loc_124_57_124_68" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_57_124_68&#39;)"><span class="hl_varref"><span class="mpre">serverState</span></span></a><span class="mpre">)

</span><a name="loc_128_1_128_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_1_128_15&#39;)"><span class="hl_fundecl"><span class="mpre">newPairContext</span></span></a><span class="mpre"> </span><a name="loc_128_16_128_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_16_128_20&#39;)"><span class="hl_vardecl"><span class="mpre">pipe</span></span></a><span class="mpre"> (</span><a name="loc_128_22_128_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_22_128_29&#39;)"><span class="hl_vardecl"><span class="mpre">cParams</span></span></a><span class="mpre">, </span><a name="loc_128_31_128_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_31_128_38&#39;)"><span class="hl_vardecl"><span class="mpre">sParams</span></span></a><span class="mpre">) = do
    let </span><a name="loc_129_9_129_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_9_129_16&#39;)"><span class="hl_vardecl"><span class="mpre">noFlush</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    let </span><a name="loc_130_9_130_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_9_130_16&#39;)"><span class="hl_vardecl"><span class="mpre">noClose</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

    </span><a name="loc_132_5_132_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_5_132_9&#39;)"><span class="hl_vardecl"><span class="mpre">cRNG</span></span></a><span class="mpre"> &lt;- </span><a href="Crypto.Random.AESCtr.html#loc_72_1_72_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.html#loc_72_1_72_11&#39;)"><span class="hl_varref"><span class="mpre">RNG.makeSystem</span></span></a><span class="mpre">
    </span><a name="loc_133_5_133_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_5_133_9&#39;)"><span class="hl_vardecl"><span class="mpre">sRNG</span></span></a><span class="mpre"> &lt;- </span><a href="Crypto.Random.AESCtr.html#loc_72_1_72_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.html#loc_72_1_72_11&#39;)"><span class="hl_varref"><span class="mpre">RNG.makeSystem</span></span></a><span class="mpre">

    let </span><a name="loc_135_9_135_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_9_135_17&#39;)"><span class="hl_vardecl"><span class="mpre">cBackend</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Backend</span></span><span class="mpre"> </span><a href="#loc_129_9_129_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_9_129_16&#39;)"><span class="hl_varref"><span class="mpre">noFlush</span></span></a><span class="mpre"> </span><a href="#loc_130_9_130_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_9_130_16&#39;)"><span class="hl_varref"><span class="mpre">noClose</span></span></a><span class="mpre"> (</span><a href="PipeChan.html#loc_38_1_38_11" onmouseover="nemnem.highlightLocalToRemote(&#39;PipeChan.html#loc_38_1_38_11&#39;)"><span class="hl_varref"><span class="mpre">writePipeA</span></span></a><span class="mpre"> </span><a href="#loc_128_16_128_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_16_128_20&#39;)"><span class="hl_varref"><span class="mpre">pipe</span></span></a><span class="mpre">) (</span><a href="PipeChan.html#loc_37_1_37_10" onmouseover="nemnem.highlightLocalToRemote(&#39;PipeChan.html#loc_37_1_37_10&#39;)"><span class="hl_varref"><span class="mpre">readPipeA</span></span></a><span class="mpre"> </span><a href="#loc_128_16_128_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_16_128_20&#39;)"><span class="hl_varref"><span class="mpre">pipe</span></span></a><span class="mpre">)
    let </span><a name="loc_136_9_136_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_9_136_17&#39;)"><span class="hl_vardecl"><span class="mpre">sBackend</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Backend</span></span><span class="mpre"> </span><a href="#loc_129_9_129_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_9_129_16&#39;)"><span class="hl_varref"><span class="mpre">noFlush</span></span></a><span class="mpre"> </span><a href="#loc_130_9_130_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_9_130_16&#39;)"><span class="hl_varref"><span class="mpre">noClose</span></span></a><span class="mpre"> (</span><a href="PipeChan.html#loc_41_1_41_11" onmouseover="nemnem.highlightLocalToRemote(&#39;PipeChan.html#loc_41_1_41_11&#39;)"><span class="hl_varref"><span class="mpre">writePipeB</span></span></a><span class="mpre"> </span><a href="#loc_128_16_128_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_16_128_20&#39;)"><span class="hl_varref"><span class="mpre">pipe</span></span></a><span class="mpre">) (</span><a href="PipeChan.html#loc_40_1_40_10" onmouseover="nemnem.highlightLocalToRemote(&#39;PipeChan.html#loc_40_1_40_10&#39;)"><span class="hl_varref"><span class="mpre">readPipeB</span></span></a><span class="mpre"> </span><a href="#loc_128_16_128_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_16_128_20&#39;)"><span class="hl_varref"><span class="mpre">pipe</span></span></a><span class="mpre">)
    </span><a name="loc_137_5_137_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_5_137_10&#39;)"><span class="hl_vardecl"><span class="mpre">cCtx&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.html#loc_141_1_141_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.html#loc_141_1_141_11&#39;)"><span class="hl_varref"><span class="mpre">contextNew</span></span></a><span class="mpre"> </span><a href="#loc_135_9_135_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_9_135_17&#39;)"><span class="hl_varref"><span class="mpre">cBackend</span></span></a><span class="mpre"> </span><a href="#loc_128_22_128_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_22_128_29&#39;)"><span class="hl_varref"><span class="mpre">cParams</span></span></a><span class="mpre"> </span><a href="#loc_132_5_132_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_5_132_9&#39;)"><span class="hl_varref"><span class="mpre">cRNG</span></span></a><span class="mpre">
    </span><a name="loc_138_5_138_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_5_138_10&#39;)"><span class="hl_vardecl"><span class="mpre">sCtx&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="Network.TLS.Context.html#loc_141_1_141_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.html#loc_141_1_141_11&#39;)"><span class="hl_varref"><span class="mpre">contextNew</span></span></a><span class="mpre"> </span><a href="#loc_136_9_136_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_9_136_17&#39;)"><span class="hl_varref"><span class="mpre">sBackend</span></span></a><span class="mpre"> </span><a href="#loc_128_31_128_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_31_128_38&#39;)"><span class="hl_varref"><span class="mpre">sParams</span></span></a><span class="mpre"> </span><a href="#loc_133_5_133_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_5_133_9&#39;)"><span class="hl_varref"><span class="mpre">sRNG</span></span></a><span class="mpre">

    </span><a href="Network.TLS.Context.html#loc_216_1_216_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.html#loc_216_1_216_22&#39;)"><span class="hl_varref"><span class="mpre">contextHookSetLogging</span></span></a><span class="mpre"> </span><a href="#loc_137_5_137_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_5_137_10&#39;)"><span class="hl_varref"><span class="mpre">cCtx&#39;</span></span></a><span class="mpre"> (</span><a href="#loc_145_9_145_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_9_145_16&#39;)"><span class="hl_varref"><span class="mpre">logging</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;client: &quot;</span></span><span class="mpre">)
    </span><a href="Network.TLS.Context.html#loc_216_1_216_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Context.html#loc_216_1_216_22&#39;)"><span class="hl_varref"><span class="mpre">contextHookSetLogging</span></span></a><span class="mpre"> </span><a href="#loc_138_5_138_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_5_138_10&#39;)"><span class="hl_varref"><span class="mpre">sCtx&#39;</span></span></a><span class="mpre"> (</span><a href="#loc_145_9_145_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_9_145_16&#39;)"><span class="hl_varref"><span class="mpre">logging</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;server: &quot;</span></span><span class="mpre">)

    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_137_5_137_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_5_137_10&#39;)"><span class="hl_varref"><span class="mpre">cCtx&#39;</span></span></a><span class="mpre">, </span><a href="#loc_138_5_138_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_5_138_10&#39;)"><span class="hl_varref"><span class="mpre">sCtx&#39;</span></span></a><span class="mpre">)
  where
        </span><a name="loc_145_9_145_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_9_145_16&#39;)"><span class="hl_fundecl"><span class="mpre">logging</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">pre</span></span><span class="mpre"> =
            if </span><a href="#loc_26_1_26_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_1_26_6&#39;)"><span class="hl_varref"><span class="mpre">debug</span></span></a><span class="mpre">
                then </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 147, srcSpanStartColumn = 22, srcSpanEndLine = 148, srcSpanEndColumn = 91}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 147, srcSpanStartColumn = 26, srcSpanEndLine = 147, srcSpanEndColumn = 27},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Tests/Connection.hs&quot;, srcSpanStartLine = 148, srcS"><span class="mpre">def { loggingPacketSent = putStrLn . ((pre ++ &quot;&gt;&gt; &quot;) ++)
                                    , loggingPacketRecv = putStrLn . ((pre ++ &quot;&lt;&lt; &quot;) ++) }</span></span><span class="mpre">
                else </span><a href="Data.Default.Class.html#loc_40_5_40_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Default.Class.html#loc_40_5_40_8&#39;)"><span class="hl_varref"><span class="mpre">def</span></span></a><span class="mpre">

</span><a name="loc_151_1_151_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_1_151_18&#39;)"><span class="hl_fundecl"><span class="mpre">establishDataPipe</span></span></a><span class="mpre"> </span><a name="loc_151_19_151_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_19_151_25&#39;)"><span class="hl_vardecl"><span class="mpre">params</span></span></a><span class="mpre"> </span><a name="loc_151_26_151_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_26_151_35&#39;)"><span class="hl_vardecl"><span class="mpre">tlsServer</span></span></a><span class="mpre"> </span><a name="loc_151_36_151_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_36_151_45&#39;)"><span class="hl_vardecl"><span class="mpre">tlsClient</span></span></a><span class="mpre"> = do
    </span><span class="hl_comment"><span class="mpre">-- initial setup</span></span><span class="mpre">
    </span><a name="loc_153_5_153_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_5_153_9&#39;)"><span class="hl_vardecl"><span class="mpre">pipe</span></span></a><span class="mpre">        &lt;- </span><a href="PipeChan.html#loc_33_1_33_8" onmouseover="nemnem.highlightLocalToRemote(&#39;PipeChan.html#loc_33_1_33_8&#39;)"><span class="hl_varref"><span class="mpre">newPipe</span></span></a><span class="mpre">
    _           &lt;- (</span><a href="PipeChan.html#loc_35_1_35_8" onmouseover="nemnem.highlightLocalToRemote(&#39;PipeChan.html#loc_35_1_35_8&#39;)"><span class="hl_varref"><span class="mpre">runPipe</span></span></a><span class="mpre"> </span><a href="#loc_153_5_153_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_5_153_9&#39;)"><span class="hl_varref"><span class="mpre">pipe</span></span></a><span class="mpre">)
    </span><a name="loc_155_5_155_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_5_155_15&#39;)"><span class="hl_vardecl"><span class="mpre">startQueue</span></span></a><span class="mpre">  &lt;- </span><a href="Control.Concurrent.Chan.html#loc_71_1_71_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_71_1_71_8&#39;)"><span class="hl_varref"><span class="mpre">newChan</span></span></a><span class="mpre">
    </span><a name="loc_156_5_156_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_5_156_16&#39;)"><span class="hl_vardecl"><span class="mpre">resultQueue</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Concurrent.Chan.html#loc_71_1_71_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.Chan.html#loc_71_1_71_8&#39;)"><span class="hl_varref"><span class="mpre">newChan</span></span></a><span class="mpre">

    (</span><a name="loc_158_6_158_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_6_158_10&#39;)"><span class="hl_vardecl"><span class="mpre">cCtx</span></span></a><span class="mpre">, </span><a name="loc_158_12_158_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_12_158_16&#39;)"><span class="hl_vardecl"><span class="mpre">sCtx</span></span></a><span class="mpre">) &lt;- </span><a href="#loc_128_1_128_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_1_128_15&#39;)"><span class="hl_varref"><span class="mpre">newPairContext</span></span></a><span class="mpre"> </span><a href="#loc_153_5_153_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_5_153_9&#39;)"><span class="hl_varref"><span class="mpre">pipe</span></span></a><span class="mpre"> </span><a href="#loc_151_19_151_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_19_151_25&#39;)"><span class="hl_varref"><span class="mpre">params</span></span></a><span class="mpre">

    _ &lt;- </span><span class="hl_varref"><span class="mpre">forkIO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Exception.Base.html#loc_150_1_150_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_150_1_150_6&#39;)"><span class="hl_varref"><span class="mpre">E.catch</span></span></a><span class="mpre"> (</span><a href="#loc_151_26_151_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_26_151_35&#39;)"><span class="hl_varref"><span class="mpre">tlsServer</span></span></a><span class="mpre"> </span><a href="#loc_158_12_158_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_12_158_16&#39;)"><span class="hl_varref"><span class="mpre">sCtx</span></span></a><span class="mpre"> </span><a href="#loc_156_5_156_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_5_156_16&#39;)"><span class="hl_varref"><span class="mpre">resultQueue</span></span></a><span class="mpre">) (</span><a href="#loc_166_9_166_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_9_166_22&#39;)"><span class="hl_varref"><span class="mpre">printAndRaise</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;server&quot;</span></span><span class="mpre">)
    _ &lt;- </span><span class="hl_varref"><span class="mpre">forkIO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Exception.Base.html#loc_150_1_150_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_150_1_150_6&#39;)"><span class="hl_varref"><span class="mpre">E.catch</span></span></a><span class="mpre"> (</span><a href="#loc_151_36_151_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_36_151_45&#39;)"><span class="hl_varref"><span class="mpre">tlsClient</span></span></a><span class="mpre"> </span><a href="#loc_155_5_155_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_5_155_15&#39;)"><span class="hl_varref"><span class="mpre">startQueue</span></span></a><span class="mpre"> </span><a href="#loc_158_6_158_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_6_158_10&#39;)"><span class="hl_varref"><span class="mpre">cCtx</span></span></a><span class="mpre">) (</span><a href="#loc_166_9_166_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_9_166_22&#39;)"><span class="hl_varref"><span class="mpre">printAndRaise</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;client&quot;</span></span><span class="mpre">)

    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_155_5_155_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_5_155_15&#39;)"><span class="hl_varref"><span class="mpre">startQueue</span></span></a><span class="mpre">, </span><a href="#loc_156_5_156_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_5_156_16&#39;)"><span class="hl_varref"><span class="mpre">resultQueue</span></span></a><span class="mpre">)
  where
        </span><a href="#loc_166_9_166_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_9_166_22&#39;)"><span class="mpre">printAndRaise</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">E.SomeException</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
        </span><a name="loc_166_9_166_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_9_166_22&#39;)"><span class="hl_fundecl"><span class="mpre">printAndRaise</span></span></a><span class="mpre"> </span><a name="loc_166_23_166_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_23_166_24&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_166_25_166_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_25_166_26&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">putStrLn</span></span><span class="mpre"> (</span><a href="#loc_166_23_166_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_23_166_24&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; exception: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_166_25_166_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_25_166_26&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">E.throw</span></span><span class="mpre"> </span><a href="#loc_166_25_166_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_25_166_26&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
</span></div></body></html>