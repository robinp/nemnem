<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">module Network.WaiSpec (spec) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-3.0.0.2/test/Network/WaiSpec.hs&quot;, srcSpanStartLine = 3, srcSpanStartColumn = 8, srcSpanEndLine = 3, srcSpanEndColumn = 18}, srcInfoPoints = []}) &quot;Test.Hspec&quot;"><span class="mpre">Test.Hspec</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-3.0.0.2/test/Network/WaiSpec.hs&quot;, srcSpanStartLine = 4, srcSpanStartColumn = 8, srcSpanEndLine = 4, srcSpanEndColumn = 29}, srcInfoPoints = []}) &quot;Test.Hspec.QuickCheck&quot;"><span class="mpre">Test.Hspec.QuickCheck</span></span><span class="mpre"> (prop)
import Network.Wai
import Network.Wai.Internal (</span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="mpre">Request</span></a><span class="mpre"> (</span><a href="Network.Wai.Internal.html#loc_20_16_20_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_16_20_23&#39;)"><span class="mpre">Request</span></a><span class="mpre">))
import Data.IORef
import Data.Monoid
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-3.0.0.2/test/Network/WaiSpec.hs&quot;, srcSpanStartLine = 9, srcSpanStartColumn = 18, srcSpanEndLine = 9, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as S
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-3.0.0.2/test/Network/WaiSpec.hs&quot;, srcSpanStartLine = 10, srcSpanStartColumn = 18, srcSpanEndLine = 10, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L
import Blaze.ByteString.Builder (</span><a href="Blaze.ByteString.Builder.Internal.html#loc_299_1_299_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_299_1_299_13&#39;)"><span class="mpre">toByteString</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="mpre">Builder</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Word.html#loc_269_1_269_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Word.html#loc_269_1_269_10&#39;)"><span class="mpre">fromWord8</span></a><span class="mpre">)
import Control.Monad (</span><a href="Control.Monad.html#loc_168_1_168_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_168_1_168_6&#39;)"><span class="mpre">forM_</span></a><span class="mpre">)

</span><a href="#loc_15_1_15_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_1_15_5&#39;)"><span class="mpre">spec</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Spec</span></span><span class="mpre">
</span><a name="loc_15_1_15_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_15_1_15_5&#39;)"><span class="hl_vardecl"><span class="mpre">spec</span></span></a><span class="mpre"> = do
    </span><span class="hl_varref"><span class="mpre">describe</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;responseToStream&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        let </span><a name="loc_17_13_17_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_13_17_20&#39;)"><span class="hl_fundecl"><span class="mpre">getBody</span></span></a><span class="mpre"> </span><a name="loc_17_21_17_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_21_17_24&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> = do
                let (_, _, </span><a name="loc_18_28_18_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_28_18_29&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre">) = </span><a href="Network.Wai.html#loc_198_1_198_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_198_1_198_17&#39;)"><span class="hl_varref"><span class="mpre">responseToStream</span></span></a><span class="mpre"> </span><a href="#loc_17_21_17_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_21_17_24&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">
                </span><a href="#loc_18_28_18_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_28_18_29&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_19_22_19_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_22_19_35&#39;)"><span class="hl_vardecl"><span class="mpre">streamingBody</span></span></a><span class="mpre"> -&gt; do
                    </span><a name="loc_20_21_20_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_21_20_31&#39;)"><span class="hl_vardecl"><span class="mpre">builderRef</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">
                    let </span><a href="#loc_22_25_22_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_25_22_28&#39;)"><span class="mpre">add</span></a><span class="mpre"> :: </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
                        </span><a name="loc_22_25_22_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_25_22_28&#39;)"><span class="hl_fundecl"><span class="mpre">add</span></span></a><span class="mpre"> </span><a name="loc_22_29_22_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_29_22_30&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = </span><a href="Data.IORef.html#loc_101_1_101_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_101_1_101_18&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef</span></span></a><span class="mpre"> </span><a href="#loc_20_21_20_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_21_20_31&#39;)"><span class="hl_varref"><span class="mpre">builderRef</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_22_65_22_72" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_65_22_72&#39;)"><span class="hl_vardecl"><span class="mpre">builder</span></span></a><span class="mpre"> -&gt;
                            (</span><a href="#loc_22_65_22_72" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_65_22_72&#39;)"><span class="hl_varref"><span class="mpre">builder</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_infix"><span class="mpre">`mappend`</span></span></a><span class="mpre"> </span><a href="#loc_22_29_22_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_29_22_30&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)
                        </span><a href="#loc_25_25_25_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_25_25_30&#39;)"><span class="mpre">flush</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
                        </span><a name="loc_25_25_25_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_25_25_30&#39;)"><span class="hl_vardecl"><span class="mpre">flush</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
                    </span><a href="#loc_19_22_19_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_22_19_35&#39;)"><span class="hl_varref"><span class="mpre">streamingBody</span></span></a><span class="mpre"> </span><a href="#loc_22_25_22_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_25_22_28&#39;)"><span class="hl_varref"><span class="mpre">add</span></span></a><span class="mpre"> </span><a href="#loc_25_25_25_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_25_25_30&#39;)"><span class="hl_varref"><span class="mpre">flush</span></span></a><span class="mpre">
                    </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.html#loc_299_1_299_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_299_1_299_13&#39;)"><span class="hl_varref"><span class="mpre">toByteString</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_20_21_20_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_21_20_31&#39;)"><span class="hl_varref"><span class="mpre">builderRef</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">prop</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;responseLBS&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_28_31_28_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_31_28_36&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre"> -&gt; do
            </span><a name="loc_29_13_29_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_13_29_17&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_17_13_17_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_13_17_20&#39;)"><span class="hl_varref"><span class="mpre">getBody</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Wai.html#loc_130_1_130_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_130_1_130_12&#39;)"><span class="hl_varref"><span class="mpre">responseLBS</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.pack</span></span><span class="mpre"> </span><a href="#loc_28_31_28_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_31_28_36&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">
            </span><a href="#loc_29_13_29_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_29_13_29_17&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.pack</span></span><span class="mpre"> </span><a href="#loc_28_31_28_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_31_28_36&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">prop</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;responseBuilder&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_31_35_31_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_35_31_40&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre"> -&gt; do
            </span><a name="loc_32_13_32_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_13_32_17&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_17_13_17_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_13_17_20&#39;)"><span class="hl_varref"><span class="mpre">getBody</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Wai.html#loc_125_1_125_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_125_1_125_16&#39;)"><span class="hl_varref"><span class="mpre">responseBuilder</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre">
                            </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Word.html#loc_269_1_269_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Word.html#loc_269_1_269_10&#39;)"><span class="hl_varref"><span class="mpre">fromWord8</span></span></a><span class="mpre"> </span><a href="#loc_31_35_31_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_35_31_40&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">
            </span><a href="#loc_32_13_32_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_13_32_17&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.pack</span></span><span class="mpre"> </span><a href="#loc_31_35_31_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_35_31_40&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">prop</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;responseStream&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_35_34_35_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_34_35_40&#39;)"><span class="hl_vardecl"><span class="mpre">chunks</span></span></a><span class="mpre"> -&gt; do
            </span><a name="loc_36_13_36_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_13_36_17&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_17_13_17_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_13_17_20&#39;)"><span class="hl_varref"><span class="mpre">getBody</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Wai.html#loc_158_1_158_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_158_1_158_15&#39;)"><span class="hl_varref"><span class="mpre">responseStream</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_36_69_36_78" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_69_36_78&#39;)"><span class="hl_vardecl"><span class="mpre">sendChunk</span></span></a><span class="mpre"> _ -&gt;
                </span><a href="Control.Monad.html#loc_168_1_168_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_168_1_168_6&#39;)"><span class="hl_varref"><span class="mpre">forM_</span></span></a><span class="mpre"> </span><a href="#loc_35_34_35_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_34_35_40&#39;)"><span class="hl_varref"><span class="mpre">chunks</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_37_33_37_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_33_37_38&#39;)"><span class="hl_vardecl"><span class="mpre">chunk</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_36_69_36_78" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_69_36_78&#39;)"><span class="hl_varref"><span class="mpre">sendChunk</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Word.html#loc_269_1_269_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Word.html#loc_269_1_269_10&#39;)"><span class="hl_varref"><span class="mpre">fromWord8</span></span></a><span class="mpre"> </span><a href="#loc_37_33_37_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_33_37_38&#39;)"><span class="hl_varref"><span class="mpre">chunk</span></span></a><span class="mpre">
            </span><a href="#loc_36_13_36_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_13_36_17&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.concat</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.pack</span></span><span class="mpre"> </span><a href="#loc_35_34_35_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_34_35_40&#39;)"><span class="hl_varref"><span class="mpre">chunks</span></span></a><span class="mpre">)
        </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;responseFile total&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            let </span><a name="loc_40_17_40_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_17_40_19&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;wai.cabal&quot;</span></span><span class="mpre">
            </span><a name="loc_41_13_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_13_41_17&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_17_13_17_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_13_17_20&#39;)"><span class="hl_varref"><span class="mpre">getBody</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Wai.html#loc_99_1_99_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_99_1_99_13&#39;)"><span class="hl_varref"><span class="mpre">responseFile</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> </span><a href="#loc_40_17_40_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_17_40_19&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
            </span><a name="loc_42_13_42_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_13_42_21&#39;)"><span class="hl_vardecl"><span class="mpre">expected</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">S.readFile</span></span><span class="mpre"> </span><a href="#loc_40_17_40_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_17_40_19&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
            </span><a href="#loc_41_13_41_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_13_41_17&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><a href="#loc_42_13_42_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_13_42_21&#39;)"><span class="hl_varref"><span class="mpre">expected</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">prop</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;responseFile partial&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_44_40_44_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_40_44_47&#39;)"><span class="hl_vardecl"><span class="mpre">offset&#39;</span></span></a><span class="mpre"> </span><a name="loc_44_48_44_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_48_44_54&#39;)"><span class="hl_vardecl"><span class="mpre">count&#39;</span></span></a><span class="mpre"> -&gt; do
            let </span><a name="loc_45_17_45_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_17_45_19&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;wai.cabal&quot;</span></span><span class="mpre">
            </span><a name="loc_46_13_46_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_13_46_20&#39;)"><span class="hl_vardecl"><span class="mpre">totalBS</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">S.readFile</span></span><span class="mpre"> </span><a href="#loc_45_17_45_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_17_45_19&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
            let </span><a name="loc_47_17_47_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_17_47_22&#39;)"><span class="hl_vardecl"><span class="mpre">total</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_46_13_46_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_13_46_20&#39;)"><span class="hl_varref"><span class="mpre">totalBS</span></span></a><span class="mpre">
                </span><a name="loc_48_17_48_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_17_48_23&#39;)"><span class="hl_vardecl"><span class="mpre">offset</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">abs</span></span><span class="mpre"> </span><a href="#loc_44_40_44_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_40_44_47&#39;)"><span class="hl_varref"><span class="mpre">offset&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`mod`</span></span><span class="mpre"> </span><a href="#loc_47_17_47_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_17_47_22&#39;)"><span class="hl_varref"><span class="mpre">total</span></span></a><span class="mpre">
                </span><a name="loc_49_17_49_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_17_49_22&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">abs</span></span><span class="mpre"> </span><a href="#loc_44_48_44_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_48_44_54&#39;)"><span class="hl_varref"><span class="mpre">count&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`mod`</span></span><span class="mpre"> (</span><a href="#loc_47_17_47_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_17_47_22&#39;)"><span class="hl_varref"><span class="mpre">total</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_48_17_48_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_17_48_23&#39;)"><span class="hl_varref"><span class="mpre">offset</span></span></a><span class="mpre">)
            </span><a name="loc_50_13_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_13_50_17&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_17_13_17_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_13_17_20&#39;)"><span class="hl_varref"><span class="mpre">getBody</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Wai.html#loc_99_1_99_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_99_1_99_13&#39;)"><span class="hl_varref"><span class="mpre">responseFile</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> </span><a href="#loc_45_17_45_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_17_45_19&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-3.0.0.2/test/Network/WaiSpec.hs&quot;, srcSpanStartLine = 50, srcSpanStartColumn = 74, srcSpanEndLine = 54, srcSpanEndColumn = 18}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-3.0.0.2/test/Network/WaiSpec.hs&quot;, srcSpanStartLine = 51, srcSpanStartColumn = 17, srcSpanEndLine = 51, srcSpanEndColumn = 18},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-3.0.0.2/test/Network/WaiSpec.hs&quot;, srcSpanStartLi"><span class="mpre">FilePart
                { filePartOffset = fromIntegral offset
                , filePartByteCount = fromIntegral count
                , filePartFileSize = fromIntegral total
                }</span></span><span class="mpre">
            let </span><a name="loc_55_17_55_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_17_55_25&#39;)"><span class="hl_vardecl"><span class="mpre">expected</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.take</span></span><span class="mpre"> </span><a href="#loc_49_17_49_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_17_49_22&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.drop</span></span><span class="mpre"> </span><a href="#loc_48_17_48_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_17_48_23&#39;)"><span class="hl_varref"><span class="mpre">offset</span></span></a><span class="mpre"> </span><a href="#loc_46_13_46_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_13_46_20&#39;)"><span class="hl_varref"><span class="mpre">totalBS</span></span></a><span class="mpre">
            </span><a href="#loc_50_13_50_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_13_50_17&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><a href="#loc_55_17_55_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_17_55_25&#39;)"><span class="hl_varref"><span class="mpre">expected</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">describe</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;lazyRequestBody&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><span class="hl_varref"><span class="mpre">prop</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;works&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_58_25_58_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_25_58_31&#39;)"><span class="hl_vardecl"><span class="mpre">chunks</span></span></a><span class="mpre"> -&gt; do
            </span><span class="hl_vardecl"><span class="mpre">ref</span></span><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.pack</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">filter</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre">) </span><a href="#loc_58_25_58_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_25_58_31&#39;)"><span class="hl_varref"><span class="mpre">chunks</span></span></a><span class="mpre">
            let </span><a name="loc_60_17_60_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_17_60_20&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-3.0.0.2/test/Network/WaiSpec.hs&quot;, srcSpanStartLine = 60, srcSpanStartColumn = 23, srcSpanEndLine = 65, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-3.0.0.2/test/Network/WaiSpec.hs&quot;, srcSpanStartLine = 61, srcSpanStartColumn = 25, srcSpanEndLine = 61, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-3.0.0.2/test/Network/WaiSpec.hs&quot;, srcSpanStartLi"><span class="mpre">Request
                        { requestBody = atomicModifyIORef ref $ \bss -&gt;
                            case bss of
                                [] -&gt; ([], S.empty)
                                x:y -&gt; (y, x)
                        }</span></span><span class="mpre">
            </span><a name="loc_66_13_66_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_13_66_17&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Wai.html#loc_286_1_286_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_286_1_286_16&#39;)"><span class="hl_varref"><span class="mpre">lazyRequestBody</span></span></a><span class="mpre"> </span><a href="#loc_60_17_60_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_17_60_20&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">
            </span><a href="#loc_66_13_66_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_13_66_17&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.fromChunks</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.pack</span></span><span class="mpre"> </span><a href="#loc_58_25_58_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_25_58_31&#39;)"><span class="hl_varref"><span class="mpre">chunks</span></span></a><span class="mpre">)
        </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;is lazy&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            let </span><a name="loc_69_17_69_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_17_69_20&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-3.0.0.2/test/Network/WaiSpec.hs&quot;, srcSpanStartLine = 69, srcSpanStartColumn = 23, srcSpanEndLine = 71, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-3.0.0.2/test/Network/WaiSpec.hs&quot;, srcSpanStartLine = 70, srcSpanStartColumn = 25, srcSpanEndLine = 70, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/wai-3.0.0.2/test/Network/WaiSpec.hs&quot;, srcSpanStartLi"><span class="mpre">Request
                        { requestBody = error &quot;requestBody&quot;
                        }</span></span><span class="mpre">
            _ &lt;- </span><a href="Network.Wai.html#loc_286_1_286_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.html#loc_286_1_286_16&#39;)"><span class="hl_varref"><span class="mpre">lazyRequestBody</span></span></a><span class="mpre"> </span><a href="#loc_69_17_69_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_17_69_20&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
</span></div></body></html>