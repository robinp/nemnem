<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">module Data.Conduit.LazySpec (spec) where

import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/conduit-extra-1.1.1/test/Data/Conduit/LazySpec.hs&quot;, srcSpanStartLine = 3, srcSpanStartColumn = 18, srcSpanEndLine = 3, srcSpanEndColumn = 35}, srcInfoPoints = []}) &quot;Data.Conduit.Lazy&quot;"><span class="mpre">Data.Conduit.Lazy</span></span><span class="mpre"> as CLazy
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/conduit-extra-1.1.1/test/Data/Conduit/LazySpec.hs&quot;, srcSpanStartLine = 4, srcSpanStartColumn = 8, srcSpanEndLine = 4, srcSpanEndColumn = 18}, srcInfoPoints = []}) &quot;Test.Hspec&quot;"><span class="mpre">Test.Hspec</span></span><span class="mpre">
import Control.Monad.IO.Class
import qualified Data.Conduit as C
import qualified Data.Conduit.Binary as CB
import Control.Monad.Trans.Resource
import Data.Monoid
import qualified Data.IORef as I
import Control.Monad (</span><a href="Control.Monad.html#loc_189_1_189_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_189_1_189_8&#39;)"><span class="mpre">forever</span></a><span class="mpre">)

</span><a href="#loc_14_1_14_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_14_1_14_5&#39;)"><span class="mpre">spec</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Spec</span></span><span class="mpre">
</span><a name="loc_14_1_14_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_14_1_14_5&#39;)"><span class="hl_vardecl"><span class="mpre">spec</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">describe</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Data.Conduit.Lazy&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do

    </span><span class="hl_varref"><span class="mpre">describe</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;lazy&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><a href="#loc_44_1_44_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_4&#39;)"><span class="hl_varref"><span class="mpre">it&#39;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;works inside a ResourceT&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Monad.Trans.Resource.html#loc_200_1_200_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.Resource.html#loc_200_1_200_13&#39;)"><span class="hl_varref"><span class="mpre">runResourceT</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a name="loc_18_13_18_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_13_18_20&#39;)"><span class="hl_vardecl"><span class="mpre">counter</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">I.newIORef</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
            let </span><a name="loc_19_17_19_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_17_19_21&#39;)"><span class="hl_fundecl"><span class="mpre">incr</span></span></a><span class="mpre"> </span><a name="loc_19_22_19_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_22_19_23&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> = do
                    </span><a name="loc_20_21_20_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_21_20_27&#39;)"><span class="hl_vardecl"><span class="mpre">istate</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">I.newIORef</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a href="#loc_19_22_19_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_22_19_23&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)
                    let </span><a name="loc_21_25_21_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_25_21_29&#39;)"><span class="hl_vardecl"><span class="mpre">loop</span></span></a><span class="mpre"> = do
                            </span><a name="loc_22_29_22_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_29_22_32&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.IORef.html#loc_101_1_101_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_101_1_101_18&#39;)"><span class="hl_varref"><span class="mpre">I.atomicModifyIORef</span></span></a><span class="mpre"> </span><a href="#loc_20_21_20_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_21_20_27&#39;)"><span class="hl_varref"><span class="mpre">istate</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">(,)</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">)
                            case </span><a href="#loc_22_29_22_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_29_22_32&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre"> of
                                </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
                                </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_25_38_25_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_38_25_39&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; do
                                    </span><a name="loc_26_37_26_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_37_26_42&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.IORef.html#loc_101_1_101_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_101_1_101_18&#39;)"><span class="hl_varref"><span class="mpre">I.atomicModifyIORef</span></span></a><span class="mpre"> </span><a href="#loc_18_13_18_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_13_18_20&#39;)"><span class="hl_varref"><span class="mpre">counter</span></span></a><span class="mpre">
                                        (\</span><a name="loc_27_43_27_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_43_27_44&#39;)"><span class="hl_vardecl"><span class="mpre">j</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_27_43_27_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_43_27_44&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">, </span><a href="#loc_27_43_27_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_43_27_44&#39;)"><span class="hl_varref"><span class="mpre">j</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">))
                                    </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_26_37_26_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_37_26_42&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><a href="#loc_19_22_19_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_22_19_23&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
                                    </span><a href="Data.Conduit.html#loc_180_1_180_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.html#loc_180_1_180_6&#39;)"><span class="hl_varref"><span class="mpre">C.yield</span></span></a><span class="mpre"> </span><a href="#loc_25_38_25_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_38_25_39&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
                                    </span><a href="#loc_21_25_21_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_25_21_29&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre">
                    </span><a href="#loc_21_25_21_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_21_25_21_29&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre">
            </span><a name="loc_32_13_32_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_13_32_17&#39;)"><span class="hl_vardecl"><span class="mpre">nums</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">CLazy.lazyConsume</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_19_17_19_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_17_19_21&#39;)"><span class="hl_varref"><span class="mpre">incr</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpEnumFromTo (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/conduit-extra-1.1.1/test/Data/Conduit/LazySpec.hs&quot;, srcSpanStartLine = 32, srcSpanStartColumn = 60, srcSpanEndLine = 32, srcSpanEndColumn = 67}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/conduit-extra-1.1.1/test/Data/Conduit/LazySpec.hs&quot;, srcSpanStartLine = 32, srcSpanStartColumn = 60, srcSpanEndLine = 32, srcSpanEndColumn = 61},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/conduit-extra-1.1.1/tes"><span class="mpre">[1..10]</span></span><span class="mpre">
            </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_32_13_32_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_13_32_17&#39;)"><span class="hl_varref"><span class="mpre">nums</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpEnumFromTo (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/conduit-extra-1.1.1/test/Data/Conduit/LazySpec.hs&quot;, srcSpanStartLine = 33, srcSpanStartColumn = 38, srcSpanEndLine = 33, srcSpanEndColumn = 45}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/conduit-extra-1.1.1/test/Data/Conduit/LazySpec.hs&quot;, srcSpanStartLine = 33, srcSpanStartColumn = 38, srcSpanEndLine = 33, srcSpanEndColumn = 39},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/conduit-extra-1.1.1/tes"><span class="mpre">[1..10]</span></span><span class="mpre">

        </span><a href="#loc_44_1_44_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_4&#39;)"><span class="hl_varref"><span class="mpre">it&#39;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;returns nothing outside ResourceT&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a name="loc_36_13_36_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_13_36_16&#39;)"><span class="hl_vardecl"><span class="mpre">bss</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.Trans.Resource.html#loc_200_1_200_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.Resource.html#loc_200_1_200_13&#39;)"><span class="hl_varref"><span class="mpre">runResourceT</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">CLazy.lazyConsume</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Conduit.Binary.html#loc_71_1_71_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.Binary.html#loc_71_1_71_11&#39;)"><span class="hl_varref"><span class="mpre">CB.sourceFile</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;test/main.hs&quot;</span></span><span class="mpre">
            </span><a href="#loc_36_13_36_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_13_36_16&#39;)"><span class="hl_varref"><span class="mpre">bss</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> []

        </span><a href="#loc_44_1_44_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_4&#39;)"><span class="hl_varref"><span class="mpre">it&#39;</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;works with pure sources&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a name="loc_40_13_40_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_13_40_17&#39;)"><span class="hl_vardecl"><span class="mpre">nums</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">CLazy.lazyConsume</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Monad.html#loc_189_1_189_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_189_1_189_8&#39;)"><span class="hl_varref"><span class="mpre">forever</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Conduit.html#loc_180_1_180_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.html#loc_180_1_180_6&#39;)"><span class="hl_varref"><span class="mpre">C.yield</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">take</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">100</span></span><span class="mpre"> </span><a href="#loc_40_13_40_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_13_40_17&#39;)"><span class="hl_varref"><span class="mpre">nums</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">replicate</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">100</span></span><span class="mpre"> (</span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)

</span><a href="#loc_44_1_44_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_4&#39;)"><span class="mpre">it&#39;</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Spec</span></span><span class="mpre">
</span><a name="loc_44_1_44_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_1_44_4&#39;)"><span class="hl_vardecl"><span class="mpre">it&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre">
</span></div></body></html>