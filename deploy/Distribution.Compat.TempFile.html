<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE CPP #-}
{-# OPTIONS_HADDOCK hide #-}
module Distribution.Compat.TempFile (
  openTempFile,
  openBinaryTempFile,
  openNewBinaryFile,
  createTempDirectory,
  ) where


import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/Cabal-1.18.1.3/Distribution/Compat/TempFile.hs&quot;, srcSpanStartLine = 11, srcSpanStartColumn = 8, srcSpanEndLine = 11, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;System.FilePath&quot;"><span class="mpre">System.FilePath</span></span><span class="mpre">        ((&lt;/&gt;))
import Foreign.C              (eEXIST)

import System.IO              (Handle, openTempFile, openBinaryTempFile)
import Data.Bits              ((.|.))
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/Cabal-1.18.1.3/Distribution/Compat/TempFile.hs&quot;, srcSpanStartLine = 16, srcSpanStartColumn = 8, srcSpanEndLine = 16, srcSpanEndColumn = 30}, srcInfoPoints = []}) &quot;System.Posix.Internals&quot;"><span class="mpre">System.Posix.Internals</span></span><span class="mpre"> (c_open, c_close, o_CREAT, o_EXCL, o_RDWR,
                               o_BINARY, o_NONBLOCK, o_NOCTTY)
import System.IO.Error        (</span><a href="System.IO.Error.html#loc_130_1_130_21" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Error.html#loc_130_1_130_21&#39;)"><span class="mpre">isAlreadyExistsError</span></a><span class="mpre">)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/Cabal-1.18.1.3/Distribution/Compat/TempFile.hs&quot;, srcSpanStartLine = 19, srcSpanStartColumn = 8, srcSpanEndLine = 19, srcSpanEndColumn = 30}, srcInfoPoints = []}) &quot;System.Posix.Internals&quot;"><span class="mpre">System.Posix.Internals</span></span><span class="mpre"> (withFilePath)
import Foreign.C              (CInt)
import GHC.IO.Handle.FD       (</span><a href="GHC.IO.Handle.FD.html#loc_272_1_272_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.FD.html#loc_272_1_272_11&#39;)"><span class="mpre">fdToHandle</span></a><span class="mpre">)
import Distribution.Compat.Exception (</span><a href="Distribution.Compat.Exception.html#loc_11_1_11_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Compat.Exception.html#loc_11_1_11_6&#39;)"><span class="mpre">tryIO</span></a><span class="mpre">)
import Control.Exception      (</span><a href="Control.Exception.Base.html#loc_229_1_229_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_229_1_229_12&#39;)"><span class="mpre">onException</span></a><span class="mpre">)
import Foreign.C              (getErrno, errnoToIOError)

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/Cabal-1.18.1.3/Distribution/Compat/TempFile.hs&quot;, srcSpanStartLine = 26, srcSpanStartColumn = 8, srcSpanEndLine = 26, srcSpanEndColumn = 30}, srcInfoPoints = []}) &quot;System.Posix.Internals&quot;"><span class="mpre">System.Posix.Internals</span></span><span class="mpre"> (c_getpid)

#ifdef mingw32_HOST_OS
import System.Directory       ( </span><a href="System.Directory.html#loc_258_1_258_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_258_1_258_16&#39;)"><span class="mpre">createDirectory</span></a><span class="mpre"> )
#else
import qualified System.Posix
#endif

</span><span class="hl_comment"><span class="mpre">-- ------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * temporary files</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- This is here for Haskell implementations that do not come with</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- System.IO.openTempFile. This includes nhc-1.20, hugs-2006.9.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- TODO: Not sure about jhc</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- This is a copy/paste of the openBinaryTempFile definition, but</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- if uses 666 rather than 600 for the permissions. The base library</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- needs to be changed to make this better.</span></span><span class="mpre">
</span><a href="#loc_46_1_46_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_1_46_18&#39;)"><span class="mpre">openNewBinaryFile</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Handle</span></span><span class="mpre">)
</span><a name="loc_46_1_46_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_1_46_18&#39;)"><span class="hl_fundecl"><span class="mpre">openNewBinaryFile</span></span></a><span class="mpre"> </span><a name="loc_46_19_46_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_22&#39;)"><span class="hl_vardecl"><span class="mpre">dir</span></span></a><span class="mpre"> </span><a name="loc_46_23_46_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_23_46_31&#39;)"><span class="hl_vardecl"><span class="mpre">template</span></span></a><span class="mpre"> = do
  </span><a name="loc_47_3_47_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_3_47_6&#39;)"><span class="hl_vardecl"><span class="mpre">pid</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">c_getpid</span></span><span class="mpre">
  </span><a href="#loc_69_5_69_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_5_69_17&#39;)"><span class="hl_varref"><span class="mpre">findTempName</span></span></a><span class="mpre"> </span><a href="#loc_47_3_47_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_3_47_6&#39;)"><span class="hl_varref"><span class="mpre">pid</span></span></a><span class="mpre">
  where
    </span><span class="hl_comment"><span class="mpre">-- We split off the last extension, so we can use .foo.ext files</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- for temporary files (hidden on Unix OSes). Unfortunately we&#39;re</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- below filepath in the hierarchy here.</span></span><span class="mpre">
    (</span><a name="loc_53_6_53_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_6_53_12&#39;)"><span class="hl_vardecl"><span class="mpre">prefix</span></span></a><span class="mpre">,</span><a name="loc_53_13_53_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_13_53_19&#39;)"><span class="hl_vardecl"><span class="mpre">suffix</span></span></a><span class="mpre">) =
       case </span><span class="hl_varref"><span class="mpre">break</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;.&#39;</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">reverse</span></span><span class="mpre"> </span><a href="#loc_46_23_46_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_23_46_31&#39;)"><span class="hl_varref"><span class="mpre">template</span></span></a><span class="mpre"> of
         </span><span class="hl_comment"><span class="mpre">-- First case: template contains no &#39;.&#39;s. Just re-reverse it.</span></span><span class="mpre">
         (</span><a name="loc_56_11_56_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_11_56_21&#39;)"><span class="hl_vardecl"><span class="mpre">rev_suffix</span></span></a><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">)       -&gt; (</span><span class="hl_varref"><span class="mpre">reverse</span></span><span class="mpre"> </span><a href="#loc_56_11_56_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_11_56_21&#39;)"><span class="hl_varref"><span class="mpre">rev_suffix</span></span></a><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">)
         </span><span class="hl_comment"><span class="mpre">-- Second case: template contains at least one &#39;.&#39;. Strip the</span></span><span class="mpre">
         </span><span class="hl_comment"><span class="mpre">-- dot from the prefix and prepend it to the suffix (if we don&#39;t</span></span><span class="mpre">
         </span><span class="hl_comment"><span class="mpre">-- do this, the unique number will get added after the &#39;.&#39; and</span></span><span class="mpre">
         </span><span class="hl_comment"><span class="mpre">-- thus be part of the extension, which is wrong.)</span></span><span class="mpre">
         (</span><a name="loc_61_11_61_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_11_61_21&#39;)"><span class="hl_vardecl"><span class="mpre">rev_suffix</span></span></a><span class="mpre">, </span><span class="hl_char"><span class="mpre">&#39;.&#39;</span></span><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_61_27_61_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_27_61_31&#39;)"><span class="hl_vardecl"><span class="mpre">rest</span></span></a><span class="mpre">) -&gt; (</span><span class="hl_varref"><span class="mpre">reverse</span></span><span class="mpre"> </span><a href="#loc_61_27_61_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_27_61_31&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre">, </span><span class="hl_char"><span class="mpre">&#39;.&#39;</span></span><span class="hl_infix"><span class="mpre">:</span></span><span class="hl_varref"><span class="mpre">reverse</span></span><span class="mpre"> </span><a href="#loc_61_11_61_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_11_61_21&#39;)"><span class="hl_varref"><span class="mpre">rev_suffix</span></span></a><span class="mpre">)
         </span><span class="hl_comment"><span class="mpre">-- Otherwise, something is wrong, because (break (== &#39;.&#39;)) should</span></span><span class="mpre">
         </span><span class="hl_comment"><span class="mpre">-- always return a pair with either the empty string or a string</span></span><span class="mpre">
         </span><span class="hl_comment"><span class="mpre">-- beginning with &#39;.&#39; as the second component.</span></span><span class="mpre">
         _                      -&gt; </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;bug in System.IO.openTempFile&quot;</span></span><span class="mpre">

    </span><a name="loc_67_5_67_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_5_67_11&#39;)"><span class="hl_vardecl"><span class="mpre">oflags</span></span></a><span class="mpre"> = </span><a href="#loc_107_1_107_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_1_107_9&#39;)"><span class="hl_varref"><span class="mpre">rw_flags</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">o_EXCL</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">o_BINARY</span></span><span class="mpre">

    </span><a name="loc_69_5_69_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_5_69_17&#39;)"><span class="hl_fundecl"><span class="mpre">findTempName</span></span></a><span class="mpre"> </span><a name="loc_69_18_69_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_18_69_19&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = do
      </span><a name="loc_70_7_70_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_7_70_9&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">withFilePath</span></span><span class="mpre"> </span><a href="#loc_86_9_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_17&#39;)"><span class="hl_varref"><span class="mpre">filepath</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_70_39_70_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_39_70_40&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> -&gt;
              </span><span class="hl_varref"><span class="mpre">c_open</span></span><span class="mpre"> </span><a href="#loc_70_39_70_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_39_70_40&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_67_5_67_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_5_67_11&#39;)"><span class="hl_varref"><span class="mpre">oflags</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0o666</span></span><span class="mpre">
      if </span><a href="#loc_70_7_70_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_7_70_9&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
       then do
         </span><a name="loc_74_10_74_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_10_74_15&#39;)"><span class="hl_vardecl"><span class="mpre">errno</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getErrno</span></span><span class="mpre">
         if </span><a href="#loc_74_10_74_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_10_74_15&#39;)"><span class="hl_varref"><span class="mpre">errno</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">eEXIST</span></span><span class="mpre">
           then </span><a href="#loc_69_5_69_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_5_69_17&#39;)"><span class="hl_varref"><span class="mpre">findTempName</span></span></a><span class="mpre"> (</span><a href="#loc_69_18_69_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_18_69_19&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
           else </span><span class="hl_varref"><span class="mpre">ioError</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">errnoToIOError</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;openNewBinaryFile&quot;</span></span><span class="mpre"> </span><a href="#loc_74_10_74_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_10_74_15&#39;)"><span class="hl_varref"><span class="mpre">errno</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_46_19_46_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_22&#39;)"><span class="hl_varref"><span class="mpre">dir</span></span></a><span class="mpre">))
       else do
         </span><span class="hl_comment"><span class="mpre">-- TODO: We want to tell fdToHandle what the filepath is,</span></span><span class="mpre">
         </span><span class="hl_comment"><span class="mpre">-- as any exceptions etc will only be able to report the</span></span><span class="mpre">
         </span><span class="hl_comment"><span class="mpre">-- fd currently</span></span><span class="mpre">
         </span><a name="loc_82_10_82_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_10_82_11&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Handle.FD.html#loc_272_1_272_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.FD.html#loc_272_1_272_11&#39;)"><span class="hl_varref"><span class="mpre">fdToHandle</span></span></a><span class="mpre"> </span><a href="#loc_70_7_70_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_7_70_9&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="Control.Exception.Base.html#loc_229_1_229_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_229_1_229_12&#39;)"><span class="hl_infix"><span class="mpre">`onException`</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">c_close</span></span><span class="mpre"> </span><a href="#loc_70_7_70_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_7_70_9&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">
         </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_86_9_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_17&#39;)"><span class="hl_varref"><span class="mpre">filepath</span></span></a><span class="mpre">, </span><a href="#loc_82_10_82_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_10_82_11&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">)
      where
        </span><a name="loc_85_9_85_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_9_85_17&#39;)"><span class="hl_vardecl"><span class="mpre">filename</span></span></a><span class="mpre">        = </span><a href="#loc_53_6_53_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_6_53_12&#39;)"><span class="hl_varref"><span class="mpre">prefix</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_69_18_69_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_18_69_19&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_53_13_53_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_13_53_19&#39;)"><span class="hl_varref"><span class="mpre">suffix</span></span></a><span class="mpre">
        </span><a name="loc_86_9_86_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_9_86_17&#39;)"><span class="hl_vardecl"><span class="mpre">filepath</span></span></a><span class="mpre">        = </span><a href="#loc_46_19_46_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_19_46_22&#39;)"><span class="hl_varref"><span class="mpre">dir</span></span></a><span class="mpre"> </span><a href="#loc_89_9_89_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_9_89_16&#39;)"><span class="hl_infix"><span class="mpre">`combine`</span></span></a><span class="mpre"> </span><a href="#loc_85_9_85_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_9_85_17&#39;)"><span class="hl_varref"><span class="mpre">filename</span></span></a><span class="mpre">

        </span><span class="hl_comment"><span class="mpre">-- FIXME: bits copied from System.FilePath</span></span><span class="mpre">
        </span><a name="loc_89_9_89_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_9_89_16&#39;)"><span class="hl_fundecl"><span class="mpre">combine</span></span></a><span class="mpre"> </span><a name="loc_89_17_89_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_17_89_18&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> </span><a name="loc_89_19_89_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_19_89_20&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">
                  | </span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_89_19_89_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_19_89_20&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> = </span><a href="#loc_89_17_89_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_17_89_18&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
                  | </span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_89_17_89_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_17_89_18&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> = </span><a href="#loc_89_19_89_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_19_89_20&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
                  | </span><span class="hl_varref"><span class="mpre">last</span></span><span class="mpre"> </span><a href="#loc_89_17_89_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_17_89_18&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_98_1_98_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_14&#39;)"><span class="hl_varref"><span class="mpre">pathSeparator</span></span></a><span class="mpre"> = </span><a href="#loc_89_17_89_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_17_89_18&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_89_19_89_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_19_89_20&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
                  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="#loc_89_17_89_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_17_89_18&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> [</span><a href="#loc_98_1_98_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_14&#39;)"><span class="hl_varref"><span class="mpre">pathSeparator</span></span></a><span class="mpre">] </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_89_19_89_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_19_89_20&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- FIXME: Should use filepath library</span></span><span class="mpre">
</span><a href="#loc_98_1_98_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_14&#39;)"><span class="mpre">pathSeparator</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">
#ifdef mingw32_HOST_OS
</span><a name="loc_98_1_98_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_14&#39;)"><span class="hl_vardecl"><span class="mpre">pathSeparator</span></span></a><span class="mpre"> = </span><span class="hl_char"><span class="mpre">&#39;\\&#39;</span></span><span class="mpre">
#else
</span><span class="hl_vardecl"><span class="mpre">pathSeparator</span></span><span class="mpre"> = </span><span class="hl_char"><span class="mpre">&#39;/&#39;</span></span><span class="mpre">
#endif

</span><span class="hl_comment"><span class="mpre">-- FIXME: Copied from GHC.Handle</span></span><span class="mpre">
</span><a href="#loc_105_1_105_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_1_105_10&#39;)"><span class="mpre">std_flags</span></a><span class="mpre">, </span><a href="#loc_106_1_106_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_1_106_13&#39;)"><span class="mpre">output_flags</span></a><span class="mpre">, </span><a href="#loc_107_1_107_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_1_107_9&#39;)"><span class="mpre">rw_flags</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">CInt</span></span><span class="mpre">
</span><a name="loc_105_1_105_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_1_105_10&#39;)"><span class="hl_vardecl"><span class="mpre">std_flags</span></span></a><span class="mpre">    = </span><span class="hl_varref"><span class="mpre">o_NONBLOCK</span></span><span class="mpre">   </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">o_NOCTTY</span></span><span class="mpre">
</span><a name="loc_106_1_106_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_1_106_13&#39;)"><span class="hl_vardecl"><span class="mpre">output_flags</span></span></a><span class="mpre"> = </span><a href="#loc_105_1_105_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_1_105_10&#39;)"><span class="hl_varref"><span class="mpre">std_flags</span></span></a><span class="mpre">    </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">o_CREAT</span></span><span class="mpre">
</span><a name="loc_107_1_107_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_1_107_9&#39;)"><span class="hl_vardecl"><span class="mpre">rw_flags</span></span></a><span class="mpre">     = </span><a href="#loc_106_1_106_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_1_106_13&#39;)"><span class="hl_varref"><span class="mpre">output_flags</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">o_RDWR</span></span><span class="mpre">

</span><a href="#loc_110_1_110_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_1_110_20&#39;)"><span class="mpre">createTempDirectory</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre">
</span><a name="loc_110_1_110_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_1_110_20&#39;)"><span class="hl_fundecl"><span class="mpre">createTempDirectory</span></span></a><span class="mpre"> </span><a name="loc_110_21_110_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_21_110_24&#39;)"><span class="hl_vardecl"><span class="mpre">dir</span></span></a><span class="mpre"> </span><a name="loc_110_25_110_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_25_110_33&#39;)"><span class="hl_vardecl"><span class="mpre">template</span></span></a><span class="mpre"> = do
  </span><a name="loc_111_3_111_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_3_111_6&#39;)"><span class="hl_vardecl"><span class="mpre">pid</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">c_getpid</span></span><span class="mpre">
  </span><a href="#loc_114_5_114_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_5_114_17&#39;)"><span class="hl_varref"><span class="mpre">findTempName</span></span></a><span class="mpre"> </span><a href="#loc_111_3_111_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_3_111_6&#39;)"><span class="hl_varref"><span class="mpre">pid</span></span></a><span class="mpre">
  where
    </span><a name="loc_114_5_114_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_5_114_17&#39;)"><span class="hl_fundecl"><span class="mpre">findTempName</span></span></a><span class="mpre"> </span><a name="loc_114_18_114_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_18_114_19&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = do
      let </span><a name="loc_115_11_115_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_11_115_18&#39;)"><span class="hl_vardecl"><span class="mpre">dirpath</span></span></a><span class="mpre"> = </span><a href="#loc_110_21_110_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_21_110_24&#39;)"><span class="hl_varref"><span class="mpre">dir</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;/&gt;</span></span><span class="mpre"> </span><a href="#loc_110_25_110_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_25_110_33&#39;)"><span class="hl_varref"><span class="mpre">template</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;-&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_114_18_114_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_18_114_19&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
      </span><a name="loc_116_7_116_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_7_116_8&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="Distribution.Compat.Exception.html#loc_11_1_11_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Distribution.Compat.Exception.html#loc_11_1_11_6&#39;)"><span class="hl_varref"><span class="mpre">tryIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_124_1_124_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_1_124_13&#39;)"><span class="hl_varref"><span class="mpre">mkPrivateDir</span></span></a><span class="mpre"> </span><a href="#loc_115_11_115_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_11_115_18&#39;)"><span class="hl_varref"><span class="mpre">dirpath</span></span></a><span class="mpre">
      case </span><a href="#loc_116_7_116_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_7_116_8&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> _ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_115_11_115_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_11_115_18&#39;)"><span class="hl_varref"><span class="mpre">dirpath</span></span></a><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre">  </span><a name="loc_119_15_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_15_119_16&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> | </span><a href="System.IO.Error.html#loc_130_1_130_21" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Error.html#loc_130_1_130_21&#39;)"><span class="hl_varref"><span class="mpre">isAlreadyExistsError</span></span></a><span class="mpre"> </span><a href="#loc_119_15_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_15_119_16&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_114_5_114_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_5_114_17&#39;)"><span class="hl_varref"><span class="mpre">findTempName</span></span></a><span class="mpre"> (</span><a href="#loc_114_18_114_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_18_114_19&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
                | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">              -&gt; </span><span class="hl_varref"><span class="mpre">ioError</span></span><span class="mpre"> </span><a href="#loc_119_15_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_15_119_16&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">

</span><a href="#loc_124_1_124_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_1_124_13&#39;)"><span class="mpre">mkPrivateDir</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
#ifdef mingw32_HOST_OS
</span><a name="loc_124_1_124_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_1_124_13&#39;)"><span class="hl_fundecl"><span class="mpre">mkPrivateDir</span></span></a><span class="mpre"> </span><a name="loc_124_14_124_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_14_124_15&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = </span><a href="System.Directory.html#loc_258_1_258_16" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_258_1_258_16&#39;)"><span class="hl_varref"><span class="mpre">createDirectory</span></span></a><span class="mpre"> </span><a href="#loc_124_14_124_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_14_124_15&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
#else
</span><a href="#loc_124_1_124_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_1_124_13&#39;)"><span class="hl_fundecl"><span class="mpre">mkPrivateDir</span></span></a><span class="mpre"> </span><a name="loc_126_14_126_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_14_126_15&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">System.Posix.createDirectory</span></span><span class="mpre"> </span><a href="#loc_126_14_126_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_14_126_15&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0o700</span></span><span class="mpre">
#endif
</span></div></body></html>