<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Network.TLS.Backend</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A Backend represents a unified way to do IO on different</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- types without burdening our calling API with multiple</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ways to initialize a new context.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Typically, a backend provides:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * a way to read data</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * a way to write data</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * a way to close the stream</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * a way to flush the stream</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Network.TLS.Backend
    ( HasBackend(..)
    , Backend(..)
    ) where

import Control.Monad
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Backend.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 8, srcSpanEndLine = 24, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre"> (Socket, sClose)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Backend.hs&quot;, srcSpanStartLine = 25, srcSpanStartColumn = 18, srcSpanEndLine = 25, srcSpanEndColumn = 43}, srcInfoPoints = []}) &quot;Network.Socket.ByteString&quot;"><span class="mpre">Network.Socket.ByteString</span></span><span class="mpre"> as Socket
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Backend.hs&quot;, srcSpanStartLine = 26, srcSpanStartColumn = 8, srcSpanEndLine = 26, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Backend.hs&quot;, srcSpanStartLine = 27, srcSpanStartColumn = 18, srcSpanEndLine = 27, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import System.IO (</span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="mpre">Handle</span></a><span class="mpre">, </span><a href="GHC.IO.Handle.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_204_1_204_14&#39;)"><span class="mpre">hSetBuffering</span></a><span class="mpre">, </span><a href="GHC.IO.Handle.Types.html#loc_246_6_246_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_246_6_246_16&#39;)"><span class="mpre">BufferMode</span></a><span class="mpre">(..), </span><a href="GHC.IO.Handle.html#loc_293_1_293_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_293_1_293_7&#39;)"><span class="mpre">hFlush</span></a><span class="mpre">, </span><a href="GHC.IO.Handle.html#loc_86_1_86_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_86_1_86_7&#39;)"><span class="mpre">hClose</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Connection IO backend</span></span><span class="mpre">
data </span><a name="loc_31_6_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_6_31_13&#39;)"><span class="hl_tycondecl"><span class="mpre">Backend</span></span></a><span class="mpre"> = </span><a name="loc_31_16_31_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_16_31_23&#39;)"><span class="hl_condecl"><span class="mpre">Backend</span></span></a><span class="mpre">
    { </span><a name="loc_32_7_32_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_7_32_19&#39;)"><span class="hl_fielddecl"><span class="mpre">backendFlush</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">                </span><span class="hl_comment"><span class="mpre">-- ^ Flush the connection sending buffer, if any.</span></span><span class="mpre">
    , </span><a name="loc_33_7_33_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_7_33_19&#39;)"><span class="hl_fielddecl"><span class="mpre">backendClose</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">                </span><span class="hl_comment"><span class="mpre">-- ^ Close the connection.</span></span><span class="mpre">
    , </span><a name="loc_34_7_34_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_7_34_18&#39;)"><span class="hl_fielddecl"><span class="mpre">backendSend</span></span></a><span class="mpre">  :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^ Send a bytestring through the connection.</span></span><span class="mpre">
    , </span><a name="loc_35_7_35_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_7_35_18&#39;)"><span class="hl_fielddecl"><span class="mpre">backendRecv</span></span></a><span class="mpre">  :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ Receive specified number of bytes from the connection.</span></span><span class="mpre">
    }

class </span><a name="loc_38_7_38_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_7_38_17&#39;)"><span class="hl_classdecl"><span class="mpre">HasBackend</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> where
    </span><a name="loc_39_5_39_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_5_39_22&#39;)"><span class="mpre">initializeBackend</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
    </span><a name="loc_40_5_40_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_5_40_15&#39;)"><span class="mpre">getBackend</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_31_6_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_6_31_13&#39;)"><span class="hl_tyconref"><span class="mpre">Backend</span></span></a><span class="mpre">

instance </span><a href="#loc_38_7_38_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_7_38_17&#39;)"><span class="hl_classref"><span class="mpre">HasBackend</span></span></a><span class="mpre"> </span><a href="#loc_31_6_31_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_6_31_13&#39;)"><span class="hl_tyconref"><span class="mpre">Backend</span></span></a><span class="mpre"> where
    </span><a href="#loc_39_5_39_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_5_39_22&#39;)"><span class="hl_fundecl"><span class="mpre">initializeBackend</span></span></a><span class="mpre"> _ = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    </span><a href="#loc_40_5_40_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_5_40_15&#39;)"><span class="hl_vardecl"><span class="mpre">getBackend</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">

instance </span><a href="#loc_38_7_38_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_7_38_17&#39;)"><span class="hl_classref"><span class="mpre">HasBackend</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> where
    </span><a href="#loc_39_5_39_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_5_39_22&#39;)"><span class="hl_fundecl"><span class="mpre">initializeBackend</span></span></a><span class="mpre"> _ = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    </span><a href="#loc_40_5_40_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_5_40_15&#39;)"><span class="hl_fundecl"><span class="mpre">getBackend</span></span></a><span class="mpre"> </span><a name="loc_48_16_48_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_16_48_20&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> = </span><a href="#loc_31_16_31_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_16_31_23&#39;)"><span class="hl_conref"><span class="mpre">Backend</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">sClose</span></span><span class="mpre"> </span><a href="#loc_48_16_48_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_16_48_20&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">Socket.sendAll</span></span><span class="mpre"> </span><a href="#loc_48_16_48_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_16_48_20&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre">) </span><a href="#loc_49_13_49_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_13_49_20&#39;)"><span class="hl_varref"><span class="mpre">recvAll</span></span></a><span class="mpre">
      where </span><a name="loc_49_13_49_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_13_49_20&#39;)"><span class="hl_fundecl"><span class="mpre">recvAll</span></span></a><span class="mpre"> </span><a name="loc_49_21_49_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_21_49_22&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><a href="#loc_50_21_50_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_21_50_25&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_49_21_49_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_21_49_22&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
              where </span><a name="loc_50_21_50_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_21_50_25&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">    = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> []
                    </span><a href="#loc_50_21_50_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_21_50_25&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_51_26_51_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_26_51_30&#39;)"><span class="hl_vardecl"><span class="mpre">left</span></span></a><span class="mpre"> = do
                        </span><a name="loc_52_25_52_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_25_52_26&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">Socket.recv</span></span><span class="mpre"> </span><a href="#loc_48_16_48_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_16_48_20&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a href="#loc_51_26_51_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_26_51_30&#39;)"><span class="hl_varref"><span class="mpre">left</span></span></a><span class="mpre">
                        if </span><span class="hl_varref"><span class="mpre">B.null</span></span><span class="mpre"> </span><a href="#loc_52_25_52_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_25_52_26&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
                            then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> []
                            else </span><a href="Control.Monad.html#loc_274_1_274_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_274_1_274_6&#39;)"><span class="hl_varref"><span class="mpre">liftM</span></span></a><span class="mpre"> (</span><a href="#loc_52_25_52_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_25_52_26&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">) (</span><a href="#loc_50_21_50_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_21_50_25&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> (</span><a href="#loc_51_26_51_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_26_51_30&#39;)"><span class="hl_varref"><span class="mpre">left</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_52_25_52_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_25_52_26&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">))

instance </span><a href="#loc_38_7_38_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_7_38_17&#39;)"><span class="hl_classref"><span class="mpre">HasBackend</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> where
    </span><a href="#loc_39_5_39_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_5_39_22&#39;)"><span class="hl_fundecl"><span class="mpre">initializeBackend</span></span></a><span class="mpre"> </span><a name="loc_58_23_58_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_23_58_29&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> = </span><a href="GHC.IO.Handle.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">hSetBuffering</span></span></a><span class="mpre"> </span><a href="#loc_58_23_58_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_23_58_29&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">NoBuffering</span></span><span class="mpre">
    </span><a href="#loc_40_5_40_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_5_40_15&#39;)"><span class="hl_fundecl"><span class="mpre">getBackend</span></span></a><span class="mpre"> </span><a name="loc_59_16_59_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_16_59_22&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> = </span><a href="#loc_31_16_31_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_16_31_23&#39;)"><span class="hl_conref"><span class="mpre">Backend</span></span></a><span class="mpre"> (</span><a href="GHC.IO.Handle.html#loc_293_1_293_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_293_1_293_7&#39;)"><span class="hl_varref"><span class="mpre">hFlush</span></span></a><span class="mpre"> </span><a href="#loc_59_16_59_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_16_59_22&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">) (</span><a href="GHC.IO.Handle.html#loc_86_1_86_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.html#loc_86_1_86_7&#39;)"><span class="hl_varref"><span class="mpre">hClose</span></span></a><span class="mpre"> </span><a href="#loc_59_16_59_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_16_59_22&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">B.hPut</span></span><span class="mpre"> </span><a href="#loc_59_16_59_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_16_59_22&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">B.hGet</span></span><span class="mpre"> </span><a href="#loc_59_16_59_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_16_59_22&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">)
</span></div></body></html>