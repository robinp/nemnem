<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE BangPatterns      #-}
{-# LANGUAGE OverloadedStrings #-}

</span><span class="hl_comment"><span class="mpre">-- | Buffering for output streams based on bytestring builders.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Buffering an output stream can often improve throughput by reducing the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- number of system calls made through the file descriptor. The @blaze-builder@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- package provides an efficient set of primitives for serializing values</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- directly to an output buffer.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (/N.B./: most of the @blaze-builder@ package has been moved into</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @bytestring@ in versions \&gt;= 0.10; once two or three Haskell Platform</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- editions have been released that contain @bytestring@ 0.10 or higher, the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- dependency on @blaze-builder@ will be dropped in favor of the native support</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- for &#39;Builder&#39; contained in the @bytestring@ package.)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /Using this module/</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Given an &#39;OutputStream&#39; taking &#39;ByteString&#39;:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; someOutputStream :: OutputStream ByteString</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- You create a new output stream wrapping the original one that accepts</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Builder&#39; values:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     newStream &lt;- Streams.&#39;builderStream&#39; someOutputStream</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     Streams.&#39;write&#39; (&#39;Just&#39; $ &#39;Blaze.ByteString.Builder.fromByteString&#39; \&quot;hello\&quot;) newStream</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     ....</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- You can flush the output buffer using &#39;Blaze.ByteString.Builder.flush&#39;:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     ....</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     Streams.&#39;write&#39; (&#39;Just&#39; &#39;Blaze.ByteString.Builder.flush&#39;) newStream</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     ....</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- As a convention, &#39;builderStream&#39; will write the empty string to the wrapped</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;OutputStream&#39; upon a builder buffer flush. Output streams which receive</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;ByteString&#39; should either ignore the empty string or interpret it as a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- signal to flush their own buffers, as the &quot;System.IO.Streams.Zlib&quot; functions</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- do.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /Example/</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- example :: IO [ByteString]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- example = do</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     let l1 = &#39;Data.List.intersperse&#39; \&quot; \&quot; [\&quot;the\&quot;, \&quot;quick\&quot;, \&quot;brown\&quot;, \&quot;fox\&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     let l2 = &#39;Data.List.intersperse&#39; \&quot; \&quot; [\&quot;jumped\&quot;, \&quot;over\&quot;, \&quot;the\&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     let l  = map &#39;Blaze.ByteString.Builder.fromByteString&#39; l1 ++ [&#39;Blaze.ByteString.Builder.flush&#39;] ++ map &#39;Blaze.ByteString.Builder.fromByteString&#39; l2</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     is          \&lt;- Streams.&#39;System.IO.Streams.fromList&#39; l</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     (os0, grab) \&lt;- Streams.&#39;System.IO.Streams.listOutputStream&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     os          \&lt;- Streams.&#39;builderStream&#39; os0</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     Streams.&#39;System.IO.Streams.connect&#39; is os &gt;&gt; grab</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ghci&gt; example</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- [\&quot;the quick brown fox\&quot;,\&quot;\&quot;,\&quot;jumped over the\&quot;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module System.IO.Streams.Builder
 ( </span><span class="hl_comment"><span class="mpre">-- * Blaze builder conversion</span></span><span class="mpre">
   builderStream
 , unsafeBuilderStream
 , builderStreamWith
 ) where

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
import           Control.Monad                            (</span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">)
import           </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Builder.hs&quot;, srcSpanStartLine = 75, srcSpanStartColumn = 18, srcSpanEndLine = 75, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre">                    (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/io-streams-1.1.4.6/src/System/IO/Streams/Builder.hs&quot;, srcSpanStartLine = 76, srcSpanStartColumn = 18, srcSpanEndLine = 76, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre">                    as S
import           Data.IORef                               (</span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="mpre">newIORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="mpre">readIORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="mpre">writeIORef</span></a><span class="mpre">)
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
import           Blaze.ByteString.Builder.Internal        (</span><a href="Blaze.ByteString.Builder.Internal.html#loc_84_1_84_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_84_1_84_18&#39;)"><span class="mpre">defaultBufferSize</span></a><span class="mpre">)
import           Blaze.ByteString.Builder.Internal.Types  (</span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_35_6_35_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_35_6_35_14&#39;)"><span class="mpre">BufRange</span></a><span class="mpre"> (..), </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_37_6_37_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_37_6_37_17&#39;)"><span class="mpre">BuildSignal</span></a><span class="mpre"> (..), </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="mpre">Builder</span></a><span class="mpre"> (..), </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_63_1_63_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_63_1_63_10&#39;)"><span class="mpre">buildStep</span></a><span class="mpre">)
import           Blaze.ByteString.Builder.Internal.Buffer (</span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_71_6_71_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_71_6_71_12&#39;)"><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_71_15_71_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_71_15_71_21&#39;)"><span class="mpre">Buffer</span></a></a><span class="mpre">, BufferAllocStrategy, </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_167_1_167_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_167_1_167_22&#39;)"><span class="mpre">allNewBuffersStrategy</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_134_1_134_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_134_1_134_14&#39;)"><span class="mpre">execBuildStep</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_175_1_175_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_175_1_175_20&#39;)"><span class="mpre">reuseBufferStrategy</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_111_1_111_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_111_1_111_19&#39;)"><span class="mpre">unsafeFreezeBuffer</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_118_1_118_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_118_1_118_27&#39;)"><span class="mpre">unsafeFreezeNonEmptyBuffer</span></a><span class="mpre">, </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_127_1_127_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_127_1_127_17&#39;)"><span class="mpre">updateEndOfSlice</span></a><span class="mpre">)
import           System.IO.Streams.Internal               (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="mpre">OutputStream</span></a><span class="mpre">, </span><a href="System.IO.Streams.Internal.html#loc_273_1_273_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_273_1_273_17&#39;)"><span class="mpre">makeOutputStream</span></a><span class="mpre">, </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="mpre">write</span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Converts a &#39;ByteString&#39; sink into a &#39;Builder&#39; sink.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that if the generated builder receives a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Blaze.ByteString.Builder.flush&#39;, by convention it will send an empty string</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to the supplied @&#39;OutputStream&#39; &#39;ByteString&#39;@ to indicate that any output</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- buffers are to be flushed.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_94_1_94_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_14&#39;)"><span class="mpre">builderStream</span></a><span class="mpre"> :: </span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">)
</span><a name="loc_94_1_94_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_14&#39;)"><span class="hl_vardecl"><span class="mpre">builderStream</span></span></a><span class="mpre"> = </span><a href="#loc_127_1_127_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_1_127_18&#39;)"><span class="hl_varref"><span class="mpre">builderStreamWith</span></span></a><span class="mpre"> (</span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_167_1_167_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_167_1_167_22&#39;)"><span class="hl_varref"><span class="mpre">allNewBuffersStrategy</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.html#loc_84_1_84_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_84_1_84_18&#39;)"><span class="hl_varref"><span class="mpre">defaultBufferSize</span></span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Unsafe variation on &#39;builderStream&#39; that reuses an existing buffer for</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- efficiency.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /NOTE/: because the buffer is reused, subsequent &#39;ByteString&#39; values written</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to the wrapped &#39;OutputString&#39; will cause previous yielded strings to change.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Do not retain references to these &#39;ByteString&#39; values inside the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;OutputStream&#39; you pass to this function, or you will violate referential</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- transparency.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If you /must/ retain copies of these values, then please use</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Data.ByteString.copy&#39; to ensure that you have a fresh copy of the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- underlying string.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- You can create a Buffer with</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Blaze.ByteString.Builder.Internal.Buffer.allocBuffer&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_118_1_118_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_1_118_20&#39;)"><span class="mpre">unsafeBuilderStream</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_71_6_71_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_71_6_71_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre">
                    -&gt; </span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
                    -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">)
</span><a name="loc_118_1_118_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_1_118_20&#39;)"><span class="hl_vardecl"><span class="mpre">unsafeBuilderStream</span></span></a><span class="mpre"> = </span><a href="#loc_127_1_127_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_1_127_18&#39;)"><span class="hl_varref"><span class="mpre">builderStreamWith</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_175_1_175_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_175_1_175_20&#39;)"><span class="hl_varref"><span class="mpre">reuseBufferStrategy</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | A customized version of &#39;builderStream&#39;, using the specified</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;BufferAllocStrategy&#39;.</span></span><span class="mpre">
</span><a href="#loc_127_1_127_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_1_127_18&#39;)"><span class="mpre">builderStreamWith</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">BufferAllocStrategy</span></span><span class="mpre">
                  -&gt; </span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
                  -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="System.IO.Streams.Internal.html#loc_126_6_126_18" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_126_6_126_18&#39;)"><span class="hl_tyconref"><span class="mpre">OutputStream</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">)
</span><a name="loc_127_1_127_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_1_127_18&#39;)"><span class="hl_fundecl"><span class="mpre">builderStreamWith</span></span></a><span class="mpre"> (</span><a name="loc_127_20_127_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_20_127_26&#39;)"><span class="hl_vardecl"><span class="mpre">ioBuf0</span></span></a><span class="mpre">, </span><a name="loc_127_28_127_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_28_127_35&#39;)"><span class="hl_vardecl"><span class="mpre">nextBuf</span></span></a><span class="mpre">) </span><a name="loc_127_37_127_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_37_127_39&#39;)"><span class="hl_vardecl"><span class="mpre">os</span></span></a><span class="mpre"> = do
    </span><a name="loc_128_5_128_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_5_128_11&#39;)"><span class="hl_vardecl"><span class="mpre">bufRef</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_127_20_127_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_20_127_26&#39;)"><span class="hl_varref"><span class="mpre">ioBuf0</span></span></a><span class="mpre">
    </span><a href="System.IO.Streams.Internal.html#loc_273_1_273_17" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_273_1_273_17&#39;)"><span class="hl_varref"><span class="mpre">makeOutputStream</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_131_5_131_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_5_131_9&#39;)"><span class="hl_varref"><span class="mpre">sink</span></span></a><span class="mpre"> </span><a href="#loc_128_5_128_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_5_128_11&#39;)"><span class="hl_varref"><span class="mpre">bufRef</span></span></a><span class="mpre">
  where
    </span><a name="loc_131_5_131_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_5_131_9&#39;)"><span class="hl_fundecl"><span class="mpre">sink</span></span></a><span class="mpre"> </span><a name="loc_131_10_131_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_10_131_16&#39;)"><span class="hl_vardecl"><span class="mpre">bufRef</span></span></a><span class="mpre"> </span><a name="loc_131_17_131_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_17_131_18&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = do
        </span><a name="loc_132_9_132_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_9_132_12&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_131_10_131_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_10_131_16&#39;)"><span class="hl_varref"><span class="mpre">bufRef</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> (</span><a href="#loc_135_9_135_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_9_135_12&#39;)"><span class="hl_varref"><span class="mpre">eof</span></span></a><span class="mpre"> </span><a href="#loc_132_9_132_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_9_132_12&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">) (</span><a href="#loc_143_9_143_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_9_143_14&#39;)"><span class="hl_varref"><span class="mpre">chunk</span></span></a><span class="mpre"> </span><a href="#loc_132_9_132_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_9_132_12&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">) </span><a href="#loc_131_17_131_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_17_131_18&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
      where
        </span><a name="loc_135_9_135_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_9_135_12&#39;)"><span class="hl_fundecl"><span class="mpre">eof</span></span></a><span class="mpre"> </span><a name="loc_135_13_135_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_13_135_18&#39;)"><span class="hl_vardecl"><span class="mpre">ioBuf</span></span></a><span class="mpre"> = do
            </span><a name="loc_136_13_136_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_13_136_16&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_135_13_135_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_13_135_18&#39;)"><span class="hl_varref"><span class="mpre">ioBuf</span></span></a><span class="mpre">
            case </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_118_1_118_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_118_1_118_27&#39;)"><span class="hl_varref"><span class="mpre">unsafeFreezeNonEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_136_13_136_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_13_136_16&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> of
              </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">    -&gt; </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> </span><a href="#loc_127_37_127_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_37_127_39&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre">
              </span><a name="loc_139_15_139_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_15_139_16&#39;)"><span class="hl_specname"><span class="mpre">x</span></span></a><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_139_23_139_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_23_139_24&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">) -&gt; do
                 </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_139_23_139_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_23_139_24&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_139_15_139_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_15_139_16&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="#loc_127_37_127_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_37_127_39&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre">
                 </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> </span><a href="#loc_127_37_127_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_37_127_39&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre">

        </span><a name="loc_143_9_143_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_9_143_14&#39;)"><span class="hl_fundecl"><span class="mpre">chunk</span></span></a><span class="mpre"> </span><a name="loc_143_15_143_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_15_143_20&#39;)"><span class="hl_vardecl"><span class="mpre">ioBuf</span></span></a><span class="mpre"> </span><a name="loc_143_21_143_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_21_143_22&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = </span><a href="#loc_147_5_147_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_5_147_9&#39;)"><span class="hl_varref"><span class="mpre">feed</span></span></a><span class="mpre"> </span><a href="#loc_131_10_131_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_10_131_16&#39;)"><span class="hl_varref"><span class="mpre">bufRef</span></span></a><span class="mpre"> (</span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_70_5_70_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_70_5_70_14&#39;)"><span class="hl_varref"><span class="mpre">unBuilder</span></span></a><span class="mpre"> </span><a href="#loc_143_21_143_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_21_143_22&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> (</span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_63_1_63_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_63_1_63_10&#39;)"><span class="hl_varref"><span class="mpre">buildStep</span></span></a><span class="mpre"> </span><a href="#loc_145_5_145_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_5_145_14&#39;)"><span class="hl_varref"><span class="mpre">finalStep</span></span></a><span class="mpre">)) </span><a href="#loc_143_15_143_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_15_143_20&#39;)"><span class="hl_varref"><span class="mpre">ioBuf</span></span></a><span class="mpre">

    </span><a name="loc_145_5_145_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_5_145_14&#39;)"><span class="hl_fundecl"><span class="mpre">finalStep</span></span></a><span class="mpre"> !(</span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_35_17_35_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_35_17_35_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_145_26_145_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_26_145_28&#39;)"><span class="hl_vardecl"><span class="mpre">pf</span></span></a><span class="mpre"> _) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_38_5_38_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_38_5_38_9&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> </span><a href="#loc_145_26_145_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_26_145_28&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

    </span><a name="loc_147_5_147_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_5_147_9&#39;)"><span class="hl_fundecl"><span class="mpre">feed</span></span></a><span class="mpre"> </span><a name="loc_147_10_147_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_10_147_16&#39;)"><span class="hl_vardecl"><span class="mpre">bufRef</span></span></a><span class="mpre"> </span><a name="loc_147_17_147_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_17_147_22&#39;)"><span class="hl_vardecl"><span class="mpre">bStep</span></span></a><span class="mpre"> </span><a name="loc_147_23_147_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_23_147_28&#39;)"><span class="hl_vardecl"><span class="mpre">ioBuf</span></span></a><span class="mpre"> = do
        !</span><a name="loc_148_10_148_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_10_148_13&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre">   &lt;- </span><a href="#loc_147_23_147_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_23_147_28&#39;)"><span class="hl_varref"><span class="mpre">ioBuf</span></span></a><span class="mpre">
        </span><a name="loc_149_9_149_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_9_149_15&#39;)"><span class="hl_vardecl"><span class="mpre">signal</span></span></a><span class="mpre"> &lt;- </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_134_1_134_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_134_1_134_14&#39;)"><span class="hl_varref"><span class="mpre">execBuildStep</span></span></a><span class="mpre"> </span><a href="#loc_147_17_147_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_17_147_22&#39;)"><span class="hl_varref"><span class="mpre">bStep</span></span></a><span class="mpre"> </span><a href="#loc_148_10_148_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_10_148_13&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">

        case </span><a href="#loc_149_9_149_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_9_149_15&#39;)"><span class="hl_varref"><span class="mpre">signal</span></span></a><span class="mpre"> of
          </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_38_5_38_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_38_5_38_9&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> </span><a name="loc_152_16_152_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_16_152_19&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;</span></span></a><span class="mpre"> _ -&gt;
              </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_147_10_147_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_10_147_16&#39;)"><span class="hl_varref"><span class="mpre">bufRef</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_127_1_127_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_127_1_127_17&#39;)"><span class="hl_varref"><span class="mpre">updateEndOfSlice</span></span></a><span class="mpre"> </span><a href="#loc_148_10_148_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_10_148_13&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a href="#loc_152_16_152_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_16_152_19&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre">))

          </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_39_5_39_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_39_5_39_15&#39;)"><span class="hl_conref"><span class="mpre">BufferFull</span></span></a><span class="mpre"> </span><a name="loc_155_22_155_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_22_155_29&#39;)"><span class="hl_vardecl"><span class="mpre">minSize</span></span></a><span class="mpre"> </span><a name="loc_155_30_155_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_30_155_33&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a name="loc_155_34_155_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_34_155_40&#39;)"><span class="hl_vardecl"><span class="mpre">bStep&#39;</span></span></a><span class="mpre"> -&gt; do
              let </span><a name="loc_156_19_156_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_19_156_23&#39;)"><span class="hl_vardecl"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> = </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_127_1_127_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_127_1_127_17&#39;)"><span class="hl_varref"><span class="mpre">updateEndOfSlice</span></span></a><span class="mpre"> </span><a href="#loc_148_10_148_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_10_148_13&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a href="#loc_155_30_155_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_30_155_33&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre">
                  </span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_158_19_158_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_19_158_23&#39;)"><span class="mpre">cont</span></a><span class="mpre"> #-}</span></span><span class="mpre">
                  </span><a name="loc_158_19_158_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_19_158_23&#39;)"><span class="hl_vardecl"><span class="mpre">cont</span></span></a><span class="mpre"> = do
                      </span><a name="loc_159_23_159_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_23_159_29&#39;)"><span class="hl_vardecl"><span class="mpre">ioBuf&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_127_28_127_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_28_127_35&#39;)"><span class="hl_varref"><span class="mpre">nextBuf</span></span></a><span class="mpre"> </span><a href="#loc_155_22_155_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_22_155_29&#39;)"><span class="hl_varref"><span class="mpre">minSize</span></span></a><span class="mpre"> </span><a href="#loc_156_19_156_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_19_156_23&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">
                      </span><a href="#loc_147_5_147_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_5_147_9&#39;)"><span class="hl_varref"><span class="mpre">feed</span></span></a><span class="mpre"> </span><a href="#loc_147_10_147_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_10_147_16&#39;)"><span class="hl_varref"><span class="mpre">bufRef</span></span></a><span class="mpre"> </span><a href="#loc_155_34_155_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_34_155_40&#39;)"><span class="hl_varref"><span class="mpre">bStep&#39;</span></span></a><span class="mpre"> </span><a href="#loc_159_23_159_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_23_159_29&#39;)"><span class="hl_varref"><span class="mpre">ioBuf&#39;</span></span></a><span class="mpre">

              </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_111_1_111_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_111_1_111_19&#39;)"><span class="hl_varref"><span class="mpre">unsafeFreezeBuffer</span></span></a><span class="mpre"> </span><a href="#loc_156_19_156_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_19_156_23&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">) </span><a href="#loc_127_37_127_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_37_127_39&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre">
              </span><a href="#loc_158_19_158_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_19_158_23&#39;)"><span class="hl_varref"><span class="mpre">cont</span></span></a><span class="mpre">

          </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_43_5_43_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_43_5_43_21&#39;)"><span class="hl_conref"><span class="mpre">InsertByteString</span></span></a><span class="mpre"> </span><a name="loc_165_28_165_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_28_165_31&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a name="loc_165_32_165_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_32_165_34&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a name="loc_165_35_165_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_35_165_41&#39;)"><span class="hl_vardecl"><span class="mpre">bStep&#39;</span></span></a><span class="mpre"> -&gt; do
              let </span><a name="loc_166_19_166_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_19_166_23&#39;)"><span class="hl_vardecl"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> = </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_127_1_127_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_127_1_127_17&#39;)"><span class="hl_varref"><span class="mpre">updateEndOfSlice</span></span></a><span class="mpre"> </span><a href="#loc_148_10_148_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_10_148_13&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a href="#loc_165_28_165_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_28_165_31&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre">

              case </span><a href="Blaze.ByteString.Builder.Internal.Buffer.html#loc_118_1_118_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Buffer.html#loc_118_1_118_27&#39;)"><span class="hl_varref"><span class="mpre">unsafeFreezeNonEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_166_19_166_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_19_166_23&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> of
                </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
                </span><a name="loc_170_17_170_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_17_170_18&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">       -&gt; </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_170_17_170_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_17_170_18&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> </span><a href="#loc_127_37_127_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_37_127_39&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre">

              </span><span class="hl_comment"><span class="mpre">-- empty string here notifies downstream of flush</span></span><span class="mpre">
              </span><a href="System.IO.Streams.Internal.html#loc_147_1_147_6" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Streams.Internal.html#loc_147_1_147_6&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_165_32_165_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_32_165_34&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">) </span><a href="#loc_127_37_127_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_37_127_39&#39;)"><span class="hl_varref"><span class="mpre">os</span></span></a><span class="mpre">

              </span><a name="loc_175_15_175_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_15_175_21&#39;)"><span class="hl_vardecl"><span class="mpre">ioBuf&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_127_28_127_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_28_127_35&#39;)"><span class="hl_varref"><span class="mpre">nextBuf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><a href="#loc_166_19_166_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_19_166_23&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">
              </span><a href="#loc_147_5_147_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_5_147_9&#39;)"><span class="hl_varref"><span class="mpre">feed</span></span></a><span class="mpre"> </span><a href="#loc_147_10_147_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_10_147_16&#39;)"><span class="hl_varref"><span class="mpre">bufRef</span></span></a><span class="mpre"> </span><a href="#loc_165_35_165_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_35_165_41&#39;)"><span class="hl_varref"><span class="mpre">bStep&#39;</span></span></a><span class="mpre"> </span><a href="#loc_175_15_175_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_15_175_21&#39;)"><span class="hl_varref"><span class="mpre">ioBuf&#39;</span></span></a><span class="mpre">
</span></div></body></html>