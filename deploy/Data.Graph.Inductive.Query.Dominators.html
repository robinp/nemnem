<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- Find Dominators of a graph.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Author: Bertram Felgenhauer &lt;int-e@gmx.de&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Implementation based on</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Keith D. Cooper, Timothy J. Harvey, Ken Kennedy,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;A Simple, Fast Dominance Algorithm&quot;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (http://citeseer.ist.psu.edu/cooper01simple.html)</span></span><span class="mpre">

module Data.Graph.Inductive.Query.Dominators (
    dom,
    iDom
) where

import Data.Graph.Inductive.Graph
import Data.Graph.Inductive.Query.DFS
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 17, srcSpanStartColumn = 8, srcSpanEndLine = 17, srcSpanEndColumn = 17}, srcInfoPoints = []}) &quot;Data.Tree&quot;"><span class="mpre">Data.Tree</span></span><span class="mpre"> (Tree(..))
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 18, srcSpanStartColumn = 18, srcSpanEndLine = 18, srcSpanEndColumn = 27}, srcInfoPoints = []}) &quot;Data.Tree&quot;"><span class="mpre">Data.Tree</span></span><span class="mpre"> as T
import Data.Array
import Data.IntMap (IntMap)
import qualified Data.IntMap as I

</span><span class="hl_comment"><span class="mpre">-- | return immediate dominators for each node of a graph, given a root</span></span><span class="mpre">
</span><a href="#loc_25_1_25_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_1_25_5&#39;)"><span class="mpre">iDom</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 9, srcSpanEndLine = 24, srcSpanEndColumn = 20}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 18, srcSpanEndLine = 24, srcSpanEndColumn = 20}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/v"><span class="mpre">Graph gr =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">gr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Node</span></span><span class="mpre"> -&gt; [(</span><span class="hl_tyconref"><span class="mpre">Node</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">Node</span></span><span class="mpre">)]
</span><a name="loc_25_1_25_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_1_25_5&#39;)"><span class="hl_fundecl"><span class="mpre">iDom</span></span></a><span class="mpre"> </span><a name="loc_25_6_25_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_6_25_7&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre"> </span><a name="loc_25_8_25_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_8_25_12&#39;)"><span class="hl_vardecl"><span class="mpre">root</span></span></a><span class="mpre"> = let (</span><a name="loc_25_20_25_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_20_25_26&#39;)"><span class="hl_vardecl"><span class="mpre">result</span></span></a><span class="mpre">, </span><a name="loc_25_28_25_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_28_25_34&#39;)"><span class="hl_vardecl"><span class="mpre">toNode</span></span></a><span class="mpre">, _) = </span><a href="#loc_52_1_52_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_9&#39;)"><span class="hl_varref"><span class="mpre">idomWork</span></span></a><span class="mpre"> </span><a href="#loc_25_6_25_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_6_25_7&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre"> </span><a href="#loc_25_8_25_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_8_25_12&#39;)"><span class="hl_varref"><span class="mpre">root</span></span></a><span class="mpre">
              in  </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> (\(</span><a name="loc_26_26_26_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_26_26_27&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">, </span><a name="loc_26_29_26_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_29_26_30&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">) -&gt; (</span><a href="#loc_25_28_25_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_28_25_34&#39;)"><span class="hl_varref"><span class="mpre">toNode</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="#loc_26_26_26_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_26_26_27&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">, </span><a href="#loc_25_28_25_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_28_25_34&#39;)"><span class="hl_varref"><span class="mpre">toNode</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="#loc_26_29_26_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_29_26_30&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">)) (</span><span class="hl_varref"><span class="mpre">assocs</span></span><span class="mpre"> </span><a href="#loc_25_20_25_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_20_25_26&#39;)"><span class="hl_varref"><span class="mpre">result</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | return the set of dominators of the nodes of a graph, given a root</span></span><span class="mpre">
</span><a href="#loc_30_1_30_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_1_30_4&#39;)"><span class="mpre">dom</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 29, srcSpanStartColumn = 8, srcSpanEndLine = 29, srcSpanEndColumn = 19}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 29, srcSpanStartColumn = 17, srcSpanEndLine = 29, srcSpanEndColumn = 19}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/v"><span class="mpre">Graph gr =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">gr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Node</span></span><span class="mpre"> -&gt; [(</span><span class="hl_tyconref"><span class="mpre">Node</span></span><span class="mpre">,[</span><span class="hl_tyconref"><span class="mpre">Node</span></span><span class="mpre">])]
</span><a name="loc_30_1_30_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_1_30_4&#39;)"><span class="hl_fundecl"><span class="mpre">dom</span></span></a><span class="mpre"> </span><a name="loc_30_5_30_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_5_30_6&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre"> </span><a name="loc_30_7_30_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_7_30_11&#39;)"><span class="hl_vardecl"><span class="mpre">root</span></span></a><span class="mpre"> = let
    (</span><a name="loc_31_6_31_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_6_31_10&#39;)"><span class="hl_vardecl"><span class="mpre">iDom</span></span></a><span class="mpre">, </span><a name="loc_31_12_31_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_12_31_18&#39;)"><span class="hl_vardecl"><span class="mpre">toNode</span></span></a><span class="mpre">, </span><a name="loc_31_20_31_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_20_31_28&#39;)"><span class="hl_vardecl"><span class="mpre">fromNode</span></span></a><span class="mpre">) = </span><a href="#loc_52_1_52_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_9&#39;)"><span class="hl_varref"><span class="mpre">idomWork</span></span></a><span class="mpre"> </span><a href="#loc_30_5_30_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_5_30_6&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre"> </span><a href="#loc_30_7_30_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_7_30_11&#39;)"><span class="hl_varref"><span class="mpre">root</span></span></a><span class="mpre">
    </span><a name="loc_32_5_32_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_5_32_9&#39;)"><span class="hl_vardecl"><span class="mpre">dom&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_86_1_86_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_1_86_7&#39;)"><span class="hl_varref"><span class="mpre">getDom</span></span></a><span class="mpre"> </span><a href="#loc_31_12_31_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_12_31_18&#39;)"><span class="hl_varref"><span class="mpre">toNode</span></span></a><span class="mpre"> </span><a href="#loc_31_6_31_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_6_31_10&#39;)"><span class="hl_varref"><span class="mpre">iDom</span></span></a><span class="mpre">
    </span><a name="loc_33_5_33_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_5_33_11&#39;)"><span class="hl_vardecl"><span class="mpre">nodes&#39;</span></span></a><span class="mpre"> = </span><a href="Data.Graph.Inductive.Graph.html#loc_232_1_232_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Graph.Inductive.Graph.html#loc_232_1_232_6&#39;)"><span class="hl_varref"><span class="mpre">nodes</span></span></a><span class="mpre"> </span><a href="#loc_30_5_30_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_5_30_6&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre">
    </span><a name="loc_34_5_34_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_5_34_9&#39;)"><span class="hl_vardecl"><span class="mpre">rest</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">I.keys</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">I.filter</span></span><span class="mpre"> (-</span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre">) </span><a href="#loc_31_20_31_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_20_31_28&#39;)"><span class="hl_varref"><span class="mpre">fromNode</span></span></a><span class="mpre">)
  in
    [(</span><a href="#loc_31_12_31_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_12_31_18&#39;)"><span class="hl_varref"><span class="mpre">toNode</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="#loc_36_31_36_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_31_36_32&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">, </span><a href="#loc_32_5_32_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_5_32_9&#39;)"><span class="hl_varref"><span class="mpre">dom&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="#loc_36_31_36_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_31_36_32&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">) | </span><a name="loc_36_31_36_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_31_36_32&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">range</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">bounds</span></span><span class="mpre"> </span><a href="#loc_32_5_32_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_5_32_9&#39;)"><span class="hl_varref"><span class="mpre">dom&#39;</span></span></a><span class="mpre">)] </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">
    [(</span><a href="#loc_37_20_37_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_20_37_21&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">, </span><a href="#loc_33_5_33_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_5_33_11&#39;)"><span class="hl_varref"><span class="mpre">nodes&#39;</span></span></a><span class="mpre">) | </span><a name="loc_37_20_37_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_20_37_21&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_34_5_34_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_5_34_9&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre">]

</span><span class="hl_comment"><span class="mpre">-- internal node type</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 40, srcSpanStartColumn = 1, srcSpanEndLine = 40, srcSpanEndColumn = 17}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 40, srcSpanStartColumn = 1, srcSpanEndLine = 40, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph"><span class="mpre">type Node&#39; = Int</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- array containing the immediate dominator of each node, or an approximation</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- thereof. the dominance set of a node can be found by taking the union of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- {node} and the dominance set of its immediate dominator.</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 44, srcSpanStartColumn = 1, srcSpanEndLine = 44, srcSpanEndColumn = 30}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 44, srcSpanStartColumn = 1, srcSpanEndLine = 44, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph"><span class="mpre">type IDom = Array Node&#39; Node&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- array containing the list of predecessors of each node</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 46, srcSpanStartColumn = 1, srcSpanEndLine = 46, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 46, srcSpanStartColumn = 1, srcSpanEndLine = 46, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph"><span class="mpre">type Preds = Array Node&#39; [Node&#39;]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- arrays for translating internal nodes back to graph nodes and back</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 48, srcSpanStartColumn = 1, srcSpanEndLine = 48, srcSpanEndColumn = 31}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 48, srcSpanStartColumn = 1, srcSpanEndLine = 48, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph"><span class="mpre">type ToNode = Array Node&#39; Node</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 49, srcSpanStartColumn = 1, srcSpanEndLine = 49, srcSpanEndColumn = 29}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 49, srcSpanStartColumn = 1, srcSpanEndLine = 49, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph"><span class="mpre">type FromNode = IntMap Node&#39;</span></span><span class="mpre">

</span><a href="#loc_52_1_52_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_9&#39;)"><span class="mpre">idomWork</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 51, srcSpanStartColumn = 13, srcSpanEndLine = 51, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 51, srcSpanStartColumn = 22, srcSpanEndLine = 51, srcSpanEndColumn = 24}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/"><span class="mpre">Graph gr =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">gr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Node</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">IDom</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">ToNode</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">FromNode</span></span><span class="mpre">)
</span><a name="loc_52_1_52_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_9&#39;)"><span class="hl_fundecl"><span class="mpre">idomWork</span></span></a><span class="mpre"> </span><a name="loc_52_10_52_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_10_52_11&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre"> </span><a name="loc_52_12_52_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_12_52_16&#39;)"><span class="hl_vardecl"><span class="mpre">root</span></span></a><span class="mpre"> = let
    </span><span class="hl_comment"><span class="mpre">-- use depth first tree from root do build the first approximation</span></span><span class="mpre">
    </span><a name="loc_54_5_54_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_5_54_10&#39;)"><span class="hl_specname"><span class="mpre">trees</span></span></a><span class="mpre">@(</span><span class="warning" data-warning="PatPIrrPat (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 12, srcSpanEndLine = 54, srcSpanEndColumn = 19}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 12, srcSpanEndLine = 54, srcSpanEndColumn = 13}]}) (PList (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/va"><span class="mpre">~[tree]</span></span><span class="mpre">) = </span><a href="Data.Graph.Inductive.Query.DFS.html#loc_168_1_168_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Graph.Inductive.Query.DFS.html#loc_168_1_168_4&#39;)"><span class="hl_varref"><span class="mpre">dff</span></span></a><span class="mpre"> [</span><a href="#loc_52_12_52_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_12_52_16&#39;)"><span class="hl_varref"><span class="mpre">root</span></span></a><span class="mpre">] </span><a href="#loc_52_10_52_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_10_52_11&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- relabel the tree so that paths from the root have increasing nodes</span></span><span class="mpre">
    (</span><a name="loc_56_6_56_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_6_56_7&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">, </span><a name="loc_56_9_56_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_9_56_14&#39;)"><span class="hl_vardecl"><span class="mpre">ntree</span></span></a><span class="mpre">) = </span><a href="#loc_94_1_94_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_11&#39;)"><span class="hl_varref"><span class="mpre">numberTree</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">tree</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- the approximation iDom0 just maps each node to its parent</span></span><span class="mpre">
    </span><a name="loc_58_5_58_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_5_58_10&#39;)"><span class="hl_vardecl"><span class="mpre">iDom0</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">array</span></span><span class="mpre"> (</span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">, </span><a href="#loc_56_6_56_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_6_56_7&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">tail</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_106_1_106_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_1_106_10&#39;)"><span class="hl_varref"><span class="mpre">treeEdges</span></span></a><span class="mpre"> (-</span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_56_9_56_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_9_56_14&#39;)"><span class="hl_varref"><span class="mpre">ntree</span></span></a><span class="mpre">)
    </span><span class="hl_comment"><span class="mpre">-- fromNode translates graph nodes to relabeled (internal) nodes</span></span><span class="mpre">
    </span><a name="loc_60_5_60_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_5_60_13&#39;)"><span class="hl_vardecl"><span class="mpre">fromNode</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">I.unionWith</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">I.fromList</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">zip</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">T.flatten</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">tree</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">T.flatten</span></span><span class="mpre"> </span><a href="#loc_56_9_56_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_9_56_14&#39;)"><span class="hl_varref"><span class="mpre">ntree</span></span></a><span class="mpre">))) (</span><span class="hl_varref"><span class="mpre">I.fromList</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">zip</span></span><span class="mpre"> (</span><a href="Data.Graph.Inductive.Graph.html#loc_232_1_232_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Graph.Inductive.Graph.html#loc_232_1_232_6&#39;)"><span class="hl_varref"><span class="mpre">nodes</span></span></a><span class="mpre"> </span><a href="#loc_52_10_52_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_10_52_11&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">repeat</span></span><span class="mpre"> (-</span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">))))
    </span><span class="hl_comment"><span class="mpre">-- toNode translates internal nodes to graph nodes</span></span><span class="mpre">
    </span><a name="loc_62_5_62_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_5_62_11&#39;)"><span class="hl_vardecl"><span class="mpre">toNode</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">array</span></span><span class="mpre"> (</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">, </span><a href="#loc_56_6_56_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_6_56_7&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">zip</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">T.flatten</span></span><span class="mpre"> </span><a href="#loc_56_9_56_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_9_56_14&#39;)"><span class="hl_varref"><span class="mpre">ntree</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">T.flatten</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">tree</span></span><span class="mpre">))
    </span><a name="loc_63_5_63_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_10&#39;)"><span class="hl_vardecl"><span class="mpre">preds</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">array</span></span><span class="mpre"> (</span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">, </span><a href="#loc_56_6_56_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_6_56_7&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) [(</span><a href="#loc_64_54_64_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_54_64_55&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">filter</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> -</span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> (</span><a href="#loc_60_5_60_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_5_60_13&#39;)"><span class="hl_varref"><span class="mpre">fromNode</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">I.!</span></span><span class="mpre">)
                            (</span><a href="Data.Graph.Inductive.Graph.html#loc_322_1_322_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Graph.Inductive.Graph.html#loc_322_1_322_4&#39;)"><span class="hl_varref"><span class="mpre">pre</span></span></a><span class="mpre"> </span><a href="#loc_52_10_52_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_10_52_11&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre"> (</span><a href="#loc_62_5_62_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_5_62_11&#39;)"><span class="hl_varref"><span class="mpre">toNode</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="#loc_64_54_64_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_54_64_55&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">)))) | </span><a name="loc_64_54_64_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_54_64_55&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> &lt;- </span><span class="warning" data-warning="ExpEnumFromTo (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 64, srcSpanStartColumn = 59, srcSpanEndLine = 64, srcSpanEndColumn = 67}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 64, srcSpanStartColumn = 59, srcSpanEndLine = 64, srcSpanEndColumn = 60},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/"><span class="mpre">[1..s-1]</span></span><span class="mpre">]
    </span><span class="hl_comment"><span class="mpre">-- iteratively improve the approximation to find iDom.</span></span><span class="mpre">
    </span><a name="loc_66_5_66_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_5_66_9&#39;)"><span class="hl_vardecl"><span class="mpre">iDom</span></span></a><span class="mpre"> = </span><a href="#loc_110_1_110_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_1_110_6&#39;)"><span class="hl_varref"><span class="mpre">fixEq</span></span></a><span class="mpre"> (</span><a href="#loc_74_1_74_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_11&#39;)"><span class="hl_varref"><span class="mpre">refineIDom</span></span></a><span class="mpre"> </span><a href="#loc_63_5_63_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_10&#39;)"><span class="hl_varref"><span class="mpre">preds</span></span></a><span class="mpre">) </span><a href="#loc_58_5_58_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_5_58_10&#39;)"><span class="hl_varref"><span class="mpre">iDom0</span></span></a><span class="mpre">
  in
    if </span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_54_5_54_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_5_54_10&#39;)"><span class="hl_varref"><span class="mpre">trees</span></span></a><span class="mpre"> then </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Dominators.idomWork: root not in graph&quot;</span></span><span class="mpre">
                  else (</span><a href="#loc_66_5_66_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_5_66_9&#39;)"><span class="hl_varref"><span class="mpre">iDom</span></span></a><span class="mpre">, </span><a href="#loc_62_5_62_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_5_62_11&#39;)"><span class="hl_varref"><span class="mpre">toNode</span></span></a><span class="mpre">, </span><a href="#loc_60_5_60_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_5_60_13&#39;)"><span class="hl_varref"><span class="mpre">fromNode</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- for each node in iDom, find the intersection of all its predecessor&#39;s</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- dominating sets, and update iDom accordingly.</span></span><span class="mpre">
</span><a href="#loc_74_1_74_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_11&#39;)"><span class="mpre">refineIDom</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Preds</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IDom</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IDom</span></span><span class="mpre">
</span><a name="loc_74_1_74_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_11&#39;)"><span class="hl_fundecl"><span class="mpre">refineIDom</span></span></a><span class="mpre"> </span><a name="loc_74_12_74_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_12_74_17&#39;)"><span class="hl_vardecl"><span class="mpre">preds</span></span></a><span class="mpre"> </span><a name="loc_74_18_74_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_18_74_22&#39;)"><span class="hl_vardecl"><span class="mpre">iDom</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">foldl1</span></span><span class="mpre"> (</span><a href="#loc_78_1_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_10&#39;)"><span class="hl_varref"><span class="mpre">intersect</span></span></a><span class="mpre"> </span><a href="#loc_74_18_74_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_18_74_22&#39;)"><span class="hl_varref"><span class="mpre">iDom</span></span></a><span class="mpre">)) </span><a href="#loc_74_12_74_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_12_74_17&#39;)"><span class="hl_varref"><span class="mpre">preds</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- find the intersection of the two given dominance sets.</span></span><span class="mpre">
</span><a href="#loc_78_1_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_10&#39;)"><span class="mpre">intersect</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IDom</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Node&#39;</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Node&#39;</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Node&#39;</span></span><span class="mpre">
</span><a name="loc_78_1_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_10&#39;)"><span class="hl_fundecl"><span class="mpre">intersect</span></span></a><span class="mpre"> </span><a name="loc_78_11_78_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_11_78_15&#39;)"><span class="hl_vardecl"><span class="mpre">iDom</span></span></a><span class="mpre"> </span><a name="loc_78_16_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_16_78_17&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> </span><a name="loc_78_18_78_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_18_78_19&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = case </span><a href="#loc_78_16_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_16_78_17&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`compare`</span></span><span class="mpre"> </span><a href="#loc_78_18_78_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_18_78_19&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> of
    </span><span class="hl_conref"><span class="mpre">LT</span></span><span class="mpre"> -&gt; </span><a href="#loc_78_1_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_10&#39;)"><span class="hl_varref"><span class="mpre">intersect</span></span></a><span class="mpre"> </span><a href="#loc_78_11_78_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_11_78_15&#39;)"><span class="hl_varref"><span class="mpre">iDom</span></span></a><span class="mpre"> </span><a href="#loc_78_16_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_16_78_17&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> (</span><a href="#loc_78_11_78_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_11_78_15&#39;)"><span class="hl_varref"><span class="mpre">iDom</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="#loc_78_18_78_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_18_78_19&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">)
    </span><span class="hl_conref"><span class="mpre">EQ</span></span><span class="mpre"> -&gt; </span><a href="#loc_78_16_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_16_78_17&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">
    </span><span class="hl_conref"><span class="mpre">GT</span></span><span class="mpre"> -&gt; </span><a href="#loc_78_1_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_10&#39;)"><span class="hl_varref"><span class="mpre">intersect</span></span></a><span class="mpre"> </span><a href="#loc_78_11_78_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_11_78_15&#39;)"><span class="hl_varref"><span class="mpre">iDom</span></span></a><span class="mpre"> (</span><a href="#loc_78_11_78_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_11_78_15&#39;)"><span class="hl_varref"><span class="mpre">iDom</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="#loc_78_16_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_16_78_17&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">) </span><a href="#loc_78_18_78_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_18_78_19&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- convert an IDom to dominance sets. we translate to graph nodes here</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- because mapping later would be more expensive and lose sharing.</span></span><span class="mpre">
</span><a href="#loc_86_1_86_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_1_86_7&#39;)"><span class="mpre">getDom</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ToNode</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IDom</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Array</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Node&#39;</span></span><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">Node</span></span><span class="mpre">]
</span><a name="loc_86_1_86_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_1_86_7&#39;)"><span class="hl_fundecl"><span class="mpre">getDom</span></span></a><span class="mpre"> </span><a name="loc_86_8_86_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_8_86_14&#39;)"><span class="hl_vardecl"><span class="mpre">toNode</span></span></a><span class="mpre"> </span><a name="loc_86_15_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_15_86_19&#39;)"><span class="hl_vardecl"><span class="mpre">iDom</span></span></a><span class="mpre"> = let
    </span><a name="loc_87_5_87_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_8&#39;)"><span class="hl_vardecl"><span class="mpre">res</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">array</span></span><span class="mpre"> (</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">, </span><span class="hl_varref"><span class="mpre">snd</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">bounds</span></span><span class="mpre"> </span><a href="#loc_86_15_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_15_86_19&#39;)"><span class="hl_varref"><span class="mpre">iDom</span></span></a><span class="mpre">)) ((</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">, [</span><a href="#loc_86_8_86_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_8_86_14&#39;)"><span class="hl_varref"><span class="mpre">toNode</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">]) </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">
          [(</span><a href="#loc_88_49_88_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_49_88_50&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">, </span><a href="#loc_86_8_86_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_8_86_14&#39;)"><span class="hl_varref"><span class="mpre">toNode</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="#loc_88_49_88_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_49_88_50&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_8&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> (</span><a href="#loc_86_15_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_15_86_19&#39;)"><span class="hl_varref"><span class="mpre">iDom</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="#loc_88_49_88_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_49_88_50&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">)) | </span><a name="loc_88_49_88_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_49_88_50&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">range</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">bounds</span></span><span class="mpre"> </span><a href="#loc_86_15_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_15_86_19&#39;)"><span class="hl_varref"><span class="mpre">iDom</span></span></a><span class="mpre">)])
  in
    </span><a href="#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_5_87_8&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- relabel tree, labeling vertices with consecutive numbers in depth first order</span></span><span class="mpre">
</span><a href="#loc_94_1_94_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_11&#39;)"><span class="mpre">numberTree</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Node&#39;</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Tree</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Node&#39;</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Tree</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Node&#39;</span></span><span class="mpre">)
</span><a name="loc_94_1_94_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_11&#39;)"><span class="hl_fundecl"><span class="mpre">numberTree</span></span></a><span class="mpre"> </span><a name="loc_94_12_94_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_12_94_13&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Node</span></span><span class="mpre"> _ </span><a name="loc_94_22_94_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_22_94_24&#39;)"><span class="hl_vardecl"><span class="mpre">ts</span></span></a><span class="mpre">) = let (</span><a name="loc_94_33_94_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_33_94_35&#39;)"><span class="hl_vardecl"><span class="mpre">n&#39;</span></span></a><span class="mpre">, </span><a name="loc_94_37_94_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_37_94_40&#39;)"><span class="hl_vardecl"><span class="mpre">ts&#39;</span></span></a><span class="mpre">) = </span><a href="#loc_99_1_99_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_13&#39;)"><span class="hl_varref"><span class="mpre">numberForest</span></span></a><span class="mpre"> (</span><a href="#loc_94_12_94_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_12_94_13&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_94_22_94_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_22_94_24&#39;)"><span class="hl_varref"><span class="mpre">ts</span></span></a><span class="mpre">
                           in  (</span><a href="#loc_94_33_94_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_33_94_35&#39;)"><span class="hl_varref"><span class="mpre">n&#39;</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">Node</span></span><span class="mpre"> </span><a href="#loc_94_12_94_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_12_94_13&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_94_37_94_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_37_94_40&#39;)"><span class="hl_varref"><span class="mpre">ts&#39;</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- same as numberTree, for forests.</span></span><span class="mpre">
</span><a href="#loc_99_1_99_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_13&#39;)"><span class="mpre">numberForest</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Node&#39;</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">Tree</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">] -&gt; (</span><span class="hl_tyconref"><span class="mpre">Node&#39;</span></span><span class="mpre">, [</span><span class="hl_tyconref"><span class="mpre">Tree</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Node&#39;</span></span><span class="mpre">])
</span><a name="loc_99_1_99_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_13&#39;)"><span class="hl_fundecl"><span class="mpre">numberForest</span></span></a><span class="mpre"> </span><a name="loc_99_14_99_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_14_99_15&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> []     = (</span><a href="#loc_99_14_99_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_14_99_15&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">, [])
</span><a href="#loc_99_1_99_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_13&#39;)"><span class="hl_fundecl"><span class="mpre">numberForest</span></span></a><span class="mpre"> </span><a name="loc_100_14_100_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_14_100_15&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> (</span><a name="loc_100_17_100_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_17_100_18&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_100_19_100_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_19_100_21&#39;)"><span class="hl_vardecl"><span class="mpre">ts</span></span></a><span class="mpre">) = let (</span><a name="loc_100_30_100_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_30_100_32&#39;)"><span class="hl_vardecl"><span class="mpre">n&#39;</span></span></a><span class="mpre">, </span><a name="loc_100_34_100_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_34_100_36&#39;)"><span class="hl_vardecl"><span class="mpre">t&#39;</span></span></a><span class="mpre">)   = </span><a href="#loc_94_1_94_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_11&#39;)"><span class="hl_varref"><span class="mpre">numberTree</span></span></a><span class="mpre"> </span><a href="#loc_100_14_100_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_14_100_15&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_100_17_100_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_17_100_18&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">
                            (</span><a name="loc_101_30_101_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_30_101_33&#39;)"><span class="hl_vardecl"><span class="mpre">n&#39;&#39;</span></span></a><span class="mpre">, </span><a name="loc_101_35_101_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_35_101_38&#39;)"><span class="hl_vardecl"><span class="mpre">ts&#39;</span></span></a><span class="mpre">) = </span><a href="#loc_99_1_99_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_13&#39;)"><span class="hl_varref"><span class="mpre">numberForest</span></span></a><span class="mpre"> </span><a href="#loc_100_30_100_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_30_100_32&#39;)"><span class="hl_varref"><span class="mpre">n&#39;</span></span></a><span class="mpre"> </span><a href="#loc_100_19_100_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_19_100_21&#39;)"><span class="hl_varref"><span class="mpre">ts</span></span></a><span class="mpre">
                        in  (</span><a href="#loc_101_30_101_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_30_101_33&#39;)"><span class="hl_varref"><span class="mpre">n&#39;&#39;</span></span></a><span class="mpre">, </span><a href="#loc_100_34_100_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_34_100_36&#39;)"><span class="hl_varref"><span class="mpre">t&#39;</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_101_35_101_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_35_101_38&#39;)"><span class="hl_varref"><span class="mpre">ts&#39;</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- return the edges of the tree, with an added dummy root node.</span></span><span class="mpre">
</span><a href="#loc_106_1_106_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_1_106_10&#39;)"><span class="mpre">treeEdges</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Tree</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; [(</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">,</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)]
</span><a name="loc_106_1_106_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_1_106_10&#39;)"><span class="hl_fundecl"><span class="mpre">treeEdges</span></span></a><span class="mpre"> </span><a name="loc_106_11_106_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_11_106_12&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Node</span></span><span class="mpre"> </span><a name="loc_106_19_106_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_19_106_20&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> </span><a name="loc_106_21_106_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_21_106_23&#39;)"><span class="hl_vardecl"><span class="mpre">ts</span></span></a><span class="mpre">) = (</span><a href="#loc_106_19_106_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_19_106_20&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">,</span><a href="#loc_106_11_106_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_11_106_12&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">concatMap</span></span><span class="mpre"> (</span><a href="#loc_106_1_106_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_1_106_10&#39;)"><span class="hl_varref"><span class="mpre">treeEdges</span></span></a><span class="mpre"> </span><a href="#loc_106_19_106_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_19_106_20&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">) </span><a href="#loc_106_21_106_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_21_106_23&#39;)"><span class="hl_varref"><span class="mpre">ts</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- find a fixed point of f, iteratively</span></span><span class="mpre">
</span><a href="#loc_110_1_110_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_1_110_6&#39;)"><span class="mpre">fixEq</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 109, srcSpanStartColumn = 10, srcSpanEndLine = 109, srcSpanEndColumn = 17}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/fgl-5.5.0.1/Data/Graph/Inductive/Query/Dominators.hs&quot;, srcSpanStartLine = 109, srcSpanStartColumn = 15, srcSpanEndLine = 109, srcSpanEndColumn = 17}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/h"><span class="mpre">Eq a =&gt;</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_110_1_110_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_1_110_6&#39;)"><span class="hl_fundecl"><span class="mpre">fixEq</span></span></a><span class="mpre"> </span><a name="loc_110_7_110_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_7_110_8&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_110_9_110_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_9_110_10&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> | </span><a href="#loc_112_11_112_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_11_112_13&#39;)"><span class="hl_varref"><span class="mpre">v&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_110_9_110_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_9_110_10&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">   = </span><a href="#loc_110_9_110_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_9_110_10&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">
          | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="#loc_110_1_110_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_1_110_6&#39;)"><span class="hl_varref"><span class="mpre">fixEq</span></span></a><span class="mpre"> </span><a href="#loc_110_7_110_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_7_110_8&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_112_11_112_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_11_112_13&#39;)"><span class="hl_varref"><span class="mpre">v&#39;</span></span></a><span class="mpre">
    where </span><a name="loc_112_11_112_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_11_112_13&#39;)"><span class="hl_vardecl"><span class="mpre">v&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_110_7_110_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_7_110_8&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_110_9_110_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_9_110_10&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-
:m +Data.Graph.Inductive
let g0 = mkGraph [(i,()) | i &lt;- [0..4]] [(a,b,()) | (a,b) &lt;- [(0,1),(1,2),(0,3),(3,2),(4,0)]] :: Gr () ()
let g1 = mkGraph [(i,()) | i &lt;- [0..4]] [(a,b,()) | (a,b) &lt;- [(0,1),(1,2),(2,3),(1,3),(3,4)]] :: Gr () ()
let g2,g3,g4 :: Int -&gt; Gr () (); g2 n = mkGraph [(i,()) | i &lt;- [0..n-1]] ([(a,a+1,()) | a &lt;- [0..n-2]] ++ [(a,a+2,()) | a &lt;- [0..n-3]]); g3 n =mkGraph [(i,()) | i &lt;- [0..n-1]] ([(a,a+2,()) | a &lt;- [0..n-3]] ++ [(a,a+1,()) | a &lt;- [0..n-2]]); g4 n =mkGraph [(i,()) | i &lt;- [0..n-1]] ([(a+2,a,()) | a &lt;- [0..n-3]] ++ [(a+1,a,()) | a &lt;- [0..n-2]])
:m -Data.Graph.Inductive
-}</span></span><span class="mpre">
</span></div></body></html>