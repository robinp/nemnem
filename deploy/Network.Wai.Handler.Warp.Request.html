<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE BangPatterns #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE CPP #-}
{-# OPTIONS_GHC -fno-warn-deprecations #-}

module Network.Wai.Handler.Warp.Request (
    recvRequest
  , headerLines
  ) where

import Control.Applicative
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Request.hs&quot;, srcSpanStartLine = 12, srcSpanStartColumn = 18, srcSpanEndLine = 12, srcSpanEndColumn = 36}, srcInfoPoints = []}) &quot;Control.Concurrent&quot;"><span class="mpre">Control.Concurrent</span></span><span class="mpre"> as Conc (yield)
import Control.Exception (</span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="mpre">throwIO</span></a><span class="mpre">)
import Data.Array ((!))
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Request.hs&quot;, srcSpanStartLine = 15, srcSpanStartColumn = 8, srcSpanEndLine = 15, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Request.hs&quot;, srcSpanStartLine = 16, srcSpanStartColumn = 18, srcSpanEndLine = 16, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as S
import qualified Data.ByteString.Unsafe as SU
import qualified Data.CaseInsensitive as CI
import qualified Data.IORef as I
import Data.Monoid (</span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="mpre">mempty</span></a><span class="mpre">)
import qualified Network.HTTP.Types as H
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Request.hs&quot;, srcSpanStartLine = 22, srcSpanStartColumn = 8, srcSpanEndLine = 22, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre"> (SockAddr)
import Network.Wai
import Network.Wai.Handler.Warp.Conduit
import Network.Wai.Handler.Warp.Header
import Network.Wai.Handler.Warp.ReadInt
import Network.Wai.Handler.Warp.RequestHeader
import Network.Wai.Handler.Warp.Settings (</span><a href="Network.Wai.Handler.Warp.Settings.html#loc_29_6_29_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Settings.html#loc_29_6_29_14&#39;)"><a href="Network.Wai.Handler.Warp.Settings.html#loc_29_17_29_25" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Settings.html#loc_29_17_29_25&#39;)"><span class="mpre">Settings</span></a></a><span class="mpre">, </span><a href="Network.Wai.Handler.Warp.Settings.html#loc_52_7_52_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Settings.html#loc_52_7_52_26&#39;)"><span class="mpre">settingsNoParsePath</span></a><span class="mpre">)
import qualified Network.Wai.Handler.Warp.Timeout as Timeout
import Network.Wai.Handler.Warp.Types
import Network.Wai.Internal
import Prelude hiding (</span><a href="Data.List.html#loc_1044_1_1044_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_1044_1_1044_6&#39;)"><span class="mpre">lines</span></a><span class="mpre">)
import Control.Monad (</span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- FIXME come up with good values here</span></span><span class="mpre">
</span><a href="#loc_39_1_39_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_21&#39;)"><span class="mpre">maxTotalHeaderLength</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_39_1_39_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_21&#39;)"><span class="hl_vardecl"><span class="mpre">maxTotalHeaderLength</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">50</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1024</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Receiving a HTTP request from &#39;Connection&#39; and parsing its header</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   to create &#39;Request&#39;.</span></span><span class="mpre">
</span><a href="#loc_55_1_55_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_12&#39;)"><span class="mpre">recvRequest</span></a><span class="mpre"> :: </span><a href="Network.Wai.Handler.Warp.Settings.html#loc_29_6_29_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Settings.html#loc_29_6_29_14&#39;)"><span class="hl_tyconref"><span class="mpre">Settings</span></span></a><span class="mpre">
            -&gt; </span><a href="Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre">
            -&gt; </span><a href="Network.Wai.Handler.Warp.Types.html#loc_88_6_88_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_88_6_88_18&#39;)"><span class="hl_tyconref"><span class="mpre">InternalInfo</span></span></a><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">SockAddr</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ Peer&#39;s address.</span></span><span class="mpre">
            -&gt; </span><a href="Network.Wai.Handler.Warp.Types.html#loc_96_6_96_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_96_6_96_12&#39;)"><span class="hl_tyconref"><span class="mpre">Source</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ Where HTTP request comes from.</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.Wai.Internal.html#loc_20_6_20_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_20_6_20_13&#39;)"><span class="hl_tyconref"><span class="mpre">Request</span></span></a><span class="mpre">
                  ,</span><span class="hl_tyconref"><span class="mpre">IndexedHeader</span></span><span class="mpre">) </span><span class="hl_comment"><span class="mpre">-- ^</span></span><span class="mpre">
            </span><span class="hl_comment"><span class="mpre">-- &#39;Request&#39; passed to &#39;Application&#39;,</span></span><span class="mpre">
            </span><span class="hl_comment"><span class="mpre">-- &#39;IndexedHeader&#39; of HTTP request for internal use,</span></span><span class="mpre">

</span><a name="loc_55_1_55_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_12&#39;)"><span class="hl_fundecl"><span class="mpre">recvRequest</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">settings</span></span><span class="mpre"> </span><a name="loc_55_22_55_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_22_55_26&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_55_27_55_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_27_55_29&#39;)"><span class="hl_vardecl"><span class="mpre">ii</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">addr</span></span><span class="mpre"> </span><a name="loc_55_35_55_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_35_55_38&#39;)"><span class="hl_vardecl"><span class="mpre">src</span></span></a><span class="mpre"> = do
    </span><a name="loc_56_5_56_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_5_56_13&#39;)"><span class="hl_vardecl"><span class="mpre">hdrlines</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_88_1_88_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_12&#39;)"><span class="hl_varref"><span class="mpre">headerLines</span></span></a><span class="mpre"> </span><a href="#loc_55_35_55_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_35_55_38&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre">
    (</span><span class="hl_vardecl"><span class="mpre">method</span></span><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">unparsedPath</span></span><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">path</span></span><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">query</span></span><span class="mpre">, </span><a name="loc_57_41_57_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_41_57_52&#39;)"><span class="hl_vardecl"><span class="mpre">httpversion</span></span></a><span class="mpre">, </span><a name="loc_57_54_57_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_54_57_57&#39;)"><span class="hl_vardecl"><span class="mpre">hdr</span></span></a><span class="mpre">) &lt;- </span><a href="Network.Wai.Handler.Warp.RequestHeader.html#loc_36_1_36_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.RequestHeader.html#loc_36_1_36_17&#39;)"><span class="hl_varref"><span class="mpre">parseHeaderLines</span></span></a><span class="mpre"> </span><a href="#loc_56_5_56_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_5_56_13&#39;)"><span class="hl_varref"><span class="mpre">hdrlines</span></span></a><span class="mpre">
    let </span><a name="loc_58_9_58_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_15&#39;)"><span class="hl_vardecl"><span class="mpre">idxhdr</span></span></a><span class="mpre"> = </span><a href="Network.Wai.Handler.Warp.Header.html#loc_18_1_18_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Header.html#loc_18_1_18_19&#39;)"><span class="hl_varref"><span class="mpre">indexRequestHeader</span></span></a><span class="mpre"> </span><a href="#loc_57_54_57_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_54_57_57&#39;)"><span class="hl_varref"><span class="mpre">hdr</span></span></a><span class="mpre">
        </span><a name="loc_59_9_59_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_9_59_15&#39;)"><span class="hl_vardecl"><span class="mpre">expect</span></span></a><span class="mpre"> = </span><a href="#loc_58_9_58_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_15&#39;)"><span class="hl_varref"><span class="mpre">idxhdr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Header.html#loc_24_1_24_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Header.html#loc_24_1_24_10&#39;)"><span class="hl_varref"><span class="mpre">idxExpect</span></span></a><span class="mpre">
        </span><a name="loc_60_9_60_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_9_60_11&#39;)"><span class="hl_vardecl"><span class="mpre">cl</span></span></a><span class="mpre"> = </span><a href="#loc_58_9_58_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_15&#39;)"><span class="hl_varref"><span class="mpre">idxhdr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Header.html#loc_22_1_22_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Header.html#loc_22_1_22_17&#39;)"><span class="hl_varref"><span class="mpre">idxContentLength</span></span></a><span class="mpre">
        </span><a name="loc_61_9_61_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_9_61_11&#39;)"><span class="hl_vardecl"><span class="mpre">te</span></span></a><span class="mpre"> = </span><a href="#loc_58_9_58_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_15&#39;)"><span class="hl_varref"><span class="mpre">idxhdr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">!</span></span><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Header.html#loc_23_1_23_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Header.html#loc_23_1_23_20&#39;)"><span class="hl_varref"><span class="mpre">idxTransferEncoding</span></span></a><span class="mpre">
    </span><a href="#loc_100_1_100_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_13&#39;)"><span class="hl_varref"><span class="mpre">handleExpect</span></span></a><span class="mpre"> </span><a href="#loc_55_22_55_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_22_55_26&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_57_41_57_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_41_57_52&#39;)"><span class="hl_varref"><span class="mpre">httpversion</span></span></a><span class="mpre"> </span><a href="#loc_59_9_59_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_9_59_15&#39;)"><span class="hl_varref"><span class="mpre">expect</span></span></a><span class="mpre">
    (</span><a name="loc_63_6_63_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_6_63_11&#39;)"><span class="hl_vardecl"><span class="mpre">rbody</span></span></a><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">bodyLength</span></span><span class="mpre">) &lt;- </span><a href="#loc_117_1_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_14&#39;)"><span class="hl_varref"><span class="mpre">bodyAndSource</span></span></a><span class="mpre"> </span><a href="#loc_55_35_55_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_35_55_38&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre"> </span><a href="#loc_60_9_60_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_9_60_11&#39;)"><span class="hl_varref"><span class="mpre">cl</span></span></a><span class="mpre"> </span><a href="#loc_61_9_61_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_9_61_11&#39;)"><span class="hl_varref"><span class="mpre">te</span></span></a><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">rbody&#39;</span></span><span class="mpre"> &lt;- </span><a href="#loc_140_1_140_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_1_140_12&#39;)"><span class="hl_varref"><span class="mpre">timeoutBody</span></span></a><span class="mpre"> </span><a href="#loc_83_5_83_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_5_83_7&#39;)"><span class="hl_varref"><span class="mpre">th</span></span></a><span class="mpre"> </span><a href="#loc_63_6_63_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_6_63_11&#39;)"><span class="hl_varref"><span class="mpre">rbody</span></span></a><span class="mpre">
    let </span><a name="loc_65_9_65_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_9_65_12&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Request.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 15, srcSpanEndLine = 80, srcSpanEndColumn = 12}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Request.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 23, srcSpanEndLine = 65, srcSpanEndColumn = 24},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/H"><span class="mpre">Request {
            requestMethod     = method
          , httpVersion       = httpversion
          , pathInfo          = H.decodePathSegments path
          , rawPathInfo       = if settingsNoParsePath settings then unparsedPath else path
          , rawQueryString    = query
          , queryString       = H.parseQuery query
          , requestHeaders    = hdr
          , isSecure          = False
          , remoteHost        = addr
          , requestBody       = rbody&#39;
          , vault             = mempty
          , requestBodyLength = bodyLength
          , requestHeaderHost = idxhdr ! idxHost
          , requestHeaderRange = idxhdr ! idxRange
          }</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_65_9_65_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_9_65_12&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">, </span><a href="#loc_58_9_58_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_58_9_58_15&#39;)"><span class="hl_varref"><span class="mpre">idxhdr</span></span></a><span class="mpre">)
  where
    </span><a name="loc_83_5_83_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_5_83_7&#39;)"><span class="hl_vardecl"><span class="mpre">th</span></span></a><span class="mpre"> = </span><a href="Network.Wai.Handler.Warp.Types.html#loc_89_5_89_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_89_5_89_17&#39;)"><span class="hl_varref"><span class="mpre">threadHandle</span></span></a><span class="mpre"> </span><a href="#loc_55_27_55_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_27_55_29&#39;)"><span class="hl_varref"><span class="mpre">ii</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_88_1_88_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_12&#39;)"><span class="mpre">headerLines</span></a><span class="mpre"> :: </span><a href="Network.Wai.Handler.Warp.Types.html#loc_96_6_96_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_96_6_96_12&#39;)"><span class="hl_tyconref"><span class="mpre">Source</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">]
</span><a name="loc_88_1_88_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_12&#39;)"><span class="hl_fundecl"><span class="mpre">headerLines</span></span></a><span class="mpre"> </span><a name="loc_88_13_88_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_13_88_16&#39;)"><span class="hl_vardecl"><span class="mpre">src</span></span></a><span class="mpre"> = do
    </span><a name="loc_89_5_89_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_5_89_7&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Wai.Handler.Warp.Types.html#loc_104_1_104_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_104_1_104_11&#39;)"><span class="hl_varref"><span class="mpre">readSource</span></span></a><span class="mpre"> </span><a href="#loc_88_13_88_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_13_88_16&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre">
    if </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_89_5_89_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_5_89_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
        then </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Types.html#loc_44_23_44_37" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_44_23_44_37&#39;)"><span class="hl_conref"><span class="mpre">NotEnoughLines</span></span></a><span class="mpre"> []
        else </span><a href="#loc_180_1_180_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_1_180_5&#39;)"><span class="hl_varref"><span class="mpre">push</span></span></a><span class="mpre"> </span><a href="#loc_88_13_88_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_13_88_16&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre"> (</span><a href="#loc_167_17_167_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_17_167_25&#39;)"><span class="hl_conref"><span class="mpre">THStatus</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">) </span><a href="#loc_89_5_89_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_5_89_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_100_1_100_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_13&#39;)"><span class="mpre">handleExpect</span></a><span class="mpre"> :: </span><a href="Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_73_6_73_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connection</span></span></a><span class="mpre">
             -&gt; </span><a href="Network.HTTP.Types.Version.html#loc_13_6_13_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Version.html#loc_13_6_13_17&#39;)"><span class="hl_tyconref"><span class="mpre">H.HttpVersion</span></span></a><span class="mpre">
             -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HeaderValue</span></span><span class="mpre">
             -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_100_1_100_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_13&#39;)"><span class="hl_fundecl"><span class="mpre">handleExpect</span></span></a><span class="mpre"> </span><a name="loc_100_14_100_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_14_100_18&#39;)"><span class="hl_vardecl"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a name="loc_100_19_100_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_19_100_22&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;100-continue&quot;</span></span><span class="mpre">) = do
    </span><a href="Network.Wai.Handler.Warp.Types.html#loc_75_7_75_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_75_7_75_18&#39;)"><span class="hl_varref"><span class="mpre">connSendAll</span></span></a><span class="mpre"> </span><a href="#loc_100_14_100_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_14_100_18&#39;)"><span class="hl_varref"><span class="mpre">conn</span></span></a><span class="mpre"> </span><a href="#loc_104_5_104_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_5_104_13&#39;)"><span class="hl_varref"><span class="mpre">continue</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">Conc.yield</span></span><span class="mpre">
  where
    </span><a name="loc_104_5_104_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_5_104_13&#39;)"><span class="hl_vardecl"><span class="mpre">continue</span></span></a><span class="mpre">
      | </span><a href="#loc_100_19_100_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_19_100_22&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="Network.HTTP.Types.Version.html#loc_33_1_33_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.HTTP.Types.Version.html#loc_33_1_33_7&#39;)"><span class="hl_varref"><span class="mpre">H.http11</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;HTTP/1.1 100 Continue\r\n\r\n&quot;</span></span><span class="mpre">
      | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">       = </span><span class="hl_string"><span class="mpre">&quot;HTTP/1.0 100 Continue\r\n\r\n&quot;</span></span><span class="mpre">
</span><a href="#loc_100_1_100_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_13&#39;)"><span class="hl_fundecl"><span class="mpre">handleExpect</span></span></a><span class="mpre"> _    _   _                     = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_117_1_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_14&#39;)"><span class="mpre">bodyAndSource</span></a><span class="mpre"> :: </span><a href="Network.Wai.Handler.Warp.Types.html#loc_96_6_96_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_96_6_96_12&#39;)"><span class="hl_tyconref"><span class="mpre">Source</span></span></a><span class="mpre">
              -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HeaderValue</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ content length</span></span><span class="mpre">
              -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HeaderValue</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ transfer-encoding</span></span><span class="mpre">
              -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
                    ,</span><a href="Network.Wai.Internal.html#loc_93_6_93_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_93_6_93_23&#39;)"><span class="hl_tyconref"><span class="mpre">RequestBodyLength</span></span></a><span class="mpre">
                    )
</span><a name="loc_117_1_117_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_1_117_14&#39;)"><span class="hl_fundecl"><span class="mpre">bodyAndSource</span></span></a><span class="mpre"> </span><a name="loc_117_15_117_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_15_117_18&#39;)"><span class="hl_vardecl"><span class="mpre">src</span></span></a><span class="mpre"> </span><a name="loc_117_19_117_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_19_117_21&#39;)"><span class="hl_vardecl"><span class="mpre">cl</span></span></a><span class="mpre"> </span><a name="loc_117_22_117_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_22_117_24&#39;)"><span class="hl_vardecl"><span class="mpre">te</span></span></a><span class="mpre">
  | </span><a href="#loc_127_5_127_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_5_127_12&#39;)"><span class="hl_varref"><span class="mpre">chunked</span></span></a><span class="mpre"> = do
      </span><a name="loc_119_7_119_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_7_119_11&#39;)"><span class="hl_vardecl"><span class="mpre">csrc</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Wai.Handler.Warp.Conduit.html#loc_85_1_85_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Conduit.html#loc_85_1_85_10&#39;)"><span class="hl_varref"><span class="mpre">mkCSource</span></span></a><span class="mpre"> </span><a href="#loc_117_15_117_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_15_117_18&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Network.Wai.Handler.Warp.Conduit.html#loc_90_1_90_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Conduit.html#loc_90_1_90_12&#39;)"><span class="hl_varref"><span class="mpre">readCSource</span></span></a><span class="mpre"> </span><a href="#loc_119_7_119_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_7_119_11&#39;)"><span class="hl_varref"><span class="mpre">csrc</span></span></a><span class="mpre">, </span><a href="Network.Wai.Internal.html#loc_93_26_93_37" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_93_26_93_37&#39;)"><span class="hl_conref"><span class="mpre">ChunkedBody</span></span></a><span class="mpre">)
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do
      </span><a name="loc_122_7_122_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_7_122_11&#39;)"><span class="hl_vardecl"><span class="mpre">isrc</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Wai.Handler.Warp.Conduit.html#loc_21_1_21_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Conduit.html#loc_21_1_21_10&#39;)"><span class="hl_varref"><span class="mpre">mkISource</span></span></a><span class="mpre"> </span><a href="#loc_117_15_117_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_15_117_18&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre"> </span><a href="#loc_125_5_125_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_5_125_8&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Network.Wai.Handler.Warp.Conduit.html#loc_30_1_30_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Conduit.html#loc_30_1_30_12&#39;)"><span class="hl_varref"><span class="mpre">readISource</span></span></a><span class="mpre"> </span><a href="#loc_122_7_122_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_7_122_11&#39;)"><span class="hl_varref"><span class="mpre">isrc</span></span></a><span class="mpre">, </span><a href="#loc_126_5_126_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_5_126_12&#39;)"><span class="hl_varref"><span class="mpre">bodyLen</span></span></a><span class="mpre">)
  where
    </span><a name="loc_125_5_125_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_5_125_8&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> = </span><a href="#loc_130_1_130_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_9&#39;)"><span class="hl_varref"><span class="mpre">toLength</span></span></a><span class="mpre"> </span><a href="#loc_117_19_117_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_19_117_21&#39;)"><span class="hl_varref"><span class="mpre">cl</span></span></a><span class="mpre">
    </span><a name="loc_126_5_126_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_5_126_12&#39;)"><span class="hl_vardecl"><span class="mpre">bodyLen</span></span></a><span class="mpre"> = </span><a href="Network.Wai.Internal.html#loc_93_40_93_51" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Internal.html#loc_93_40_93_51&#39;)"><span class="hl_conref"><span class="mpre">KnownLength</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_125_5_125_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_5_125_8&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
    </span><a name="loc_127_5_127_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_5_127_12&#39;)"><span class="hl_vardecl"><span class="mpre">chunked</span></span></a><span class="mpre"> = </span><a href="#loc_134_1_134_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_1_134_10&#39;)"><span class="hl_varref"><span class="mpre">isChunked</span></span></a><span class="mpre"> </span><a href="#loc_117_22_117_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_22_117_24&#39;)"><span class="hl_varref"><span class="mpre">te</span></span></a><span class="mpre">

</span><a href="#loc_130_1_130_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_9&#39;)"><span class="mpre">toLength</span></a><span class="mpre"> :: </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HeaderValue</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_130_1_130_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_9&#39;)"><span class="hl_fundecl"><span class="mpre">toLength</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">   = </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
</span><a href="#loc_130_1_130_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_9&#39;)"><span class="hl_fundecl"><span class="mpre">toLength</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_131_16_131_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_16_131_18&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">) = </span><a href="Network.Wai.Handler.Warp.ReadInt.html#loc_25_1_25_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.ReadInt.html#loc_25_1_25_8&#39;)"><span class="hl_varref"><span class="mpre">readInt</span></span></a><span class="mpre"> </span><a href="#loc_131_16_131_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_16_131_18&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">

</span><a href="#loc_134_1_134_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_1_134_10&#39;)"><span class="mpre">isChunked</span></a><span class="mpre"> :: </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">HeaderValue</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_134_1_134_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_1_134_10&#39;)"><span class="hl_fundecl"><span class="mpre">isChunked</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_134_17_134_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_17_134_19&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">) = </span><a href="Data.CaseInsensitive.Internal.html#loc_146_5_146_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.CaseInsensitive.Internal.html#loc_146_5_146_13&#39;)"><span class="hl_varref"><span class="mpre">CI.foldCase</span></span></a><span class="mpre"> </span><a href="#loc_134_17_134_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_17_134_19&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;chunked&quot;</span></span><span class="mpre">
</span><a href="#loc_134_1_134_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_1_134_10&#39;)"><span class="hl_fundecl"><span class="mpre">isChunked</span></span></a><span class="mpre"> _         = </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_140_1_140_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_1_140_12&#39;)"><span class="mpre">timeoutBody</span></a><span class="mpre"> :: </span><a href="Network.Wai.Handler.Warp.Timeout.html#loc_70_6_70_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Timeout.html#loc_70_6_70_12&#39;)"><span class="hl_tyconref"><span class="mpre">Timeout.Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">)
</span><a name="loc_140_1_140_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_1_140_12&#39;)"><span class="hl_fundecl"><span class="mpre">timeoutBody</span></span></a><span class="mpre"> </span><a name="loc_140_13_140_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_13_140_26&#39;)"><span class="hl_vardecl"><span class="mpre">timeoutHandle</span></span></a><span class="mpre"> </span><a name="loc_140_27_140_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_27_140_32&#39;)"><span class="hl_vardecl"><span class="mpre">rbody</span></span></a><span class="mpre"> = do
    </span><a name="loc_141_5_141_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_5_141_15&#39;)"><span class="hl_vardecl"><span class="mpre">isFirstRef</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">I.newIORef</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">

    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><a name="loc_144_9_144_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_9_144_16&#39;)"><span class="hl_vardecl"><span class="mpre">isFirst</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">I.readIORef</span></span></a><span class="mpre"> </span><a href="#loc_141_5_141_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_5_141_15&#39;)"><span class="hl_varref"><span class="mpre">isFirstRef</span></span></a><span class="mpre">

        </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_144_9_144_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_9_144_16&#39;)"><span class="hl_varref"><span class="mpre">isFirst</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
            </span><span class="hl_comment"><span class="mpre">-- Timeout handling was paused after receiving the full request</span></span><span class="mpre">
            </span><span class="hl_comment"><span class="mpre">-- headers. Now we need to resume it to avoid a slowloris</span></span><span class="mpre">
            </span><span class="hl_comment"><span class="mpre">-- attack during request body sending.</span></span><span class="mpre">
            </span><a href="Network.Wai.Handler.Warp.Timeout.html#loc_172_1_172_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Timeout.html#loc_172_1_172_7&#39;)"><span class="hl_varref"><span class="mpre">Timeout.resume</span></span></a><span class="mpre"> </span><a href="#loc_140_13_140_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_13_140_26&#39;)"><span class="hl_varref"><span class="mpre">timeoutHandle</span></span></a><span class="mpre">

        </span><a name="loc_152_9_152_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_9_152_11&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_140_27_140_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_27_140_32&#39;)"><span class="hl_varref"><span class="mpre">rbody</span></span></a><span class="mpre">

        </span><span class="hl_comment"><span class="mpre">-- As soon as we finish receiving the request body, whether</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- because the application is not interested in more bytes, or</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- because there is no more data available, pause the timeout</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- handler again.</span></span><span class="mpre">
        </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_152_9_152_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_9_152_11&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">) (</span><a href="Network.Wai.Handler.Warp.Timeout.html#loc_167_1_167_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Timeout.html#loc_167_1_167_6&#39;)"><span class="hl_varref"><span class="mpre">Timeout.pause</span></span></a><span class="mpre"> </span><a href="#loc_140_13_140_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_13_140_26&#39;)"><span class="hl_varref"><span class="mpre">timeoutHandle</span></span></a><span class="mpre">)

        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_152_9_152_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_9_152_11&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Request.hs&quot;, srcSpanStartLine = 164, srcSpanStartColumn = 1, srcSpanEndLine = 164, srcSpanEndColumn = 39}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Request.hs&quot;, srcSpanStartLine = 164, srcSpanStartColumn = 1, srcSpanEndLine = 164, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/H"><span class="mpre">type BSEndo = ByteString -&gt; ByteString</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Request.hs&quot;, srcSpanStartLine = 165, srcSpanStartColumn = 1, srcSpanEndLine = 165, srcSpanEndColumn = 47}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/Handler/Warp/Request.hs&quot;, srcSpanStartLine = 165, srcSpanStartColumn = 1, srcSpanEndLine = 165, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/Network/Wai/H"><span class="mpre">type BSEndoList = [ByteString] -&gt; [ByteString]</span></span><span class="mpre">

data </span><a name="loc_167_6_167_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_6_167_14&#39;)"><span class="hl_tycondecl"><span class="mpre">THStatus</span></span></a><span class="mpre"> = </span><a name="loc_167_17_167_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_17_167_25&#39;)"><span class="hl_condecl"><span class="mpre">THStatus</span></span></a><span class="mpre">
    {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- running total byte count</span></span><span class="mpre">
    </span><span class="hl_tyconref"><span class="mpre">BSEndoList</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- previously parsed lines</span></span><span class="mpre">
    </span><span class="hl_tyconref"><span class="mpre">BSEndo</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- bytestrings to be prepended</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{- FIXME
close :: Sink ByteString IO a
close = throwIO IncompleteHeaders
-}</span></span><span class="mpre">

</span><a href="#loc_180_1_180_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_1_180_5&#39;)"><span class="mpre">push</span></a><span class="mpre"> :: </span><a href="Network.Wai.Handler.Warp.Types.html#loc_96_6_96_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_96_6_96_12&#39;)"><span class="hl_tyconref"><span class="mpre">Source</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_167_6_167_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_6_167_14&#39;)"><span class="hl_tyconref"><span class="mpre">THStatus</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">]
</span><a name="loc_180_1_180_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_1_180_5&#39;)"><span class="hl_fundecl"><span class="mpre">push</span></span></a><span class="mpre"> </span><a name="loc_180_6_180_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_9&#39;)"><span class="hl_vardecl"><span class="mpre">src</span></span></a><span class="mpre"> (</span><a href="#loc_167_17_167_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_17_167_25&#39;)"><span class="hl_conref"><span class="mpre">THStatus</span></span></a><span class="mpre"> </span><a name="loc_180_20_180_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_20_180_23&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_180_24_180_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_24_180_29&#39;)"><span class="hl_vardecl"><span class="mpre">lines</span></span></a><span class="mpre"> </span><a name="loc_180_30_180_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_30_180_37&#39;)"><span class="hl_vardecl"><span class="mpre">prepend</span></span></a><span class="mpre">) </span><a name="loc_180_39_180_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_39_180_42&#39;)"><span class="hl_vardecl"><span class="mpre">bs&#39;</span></span></a><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- Too many bytes</span></span><span class="mpre">
        | </span><a href="#loc_180_20_180_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_20_180_23&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><a href="#loc_39_1_39_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_21&#39;)"><span class="hl_varref"><span class="mpre">maxTotalHeaderLength</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Types.html#loc_49_23_49_38" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_49_23_49_38&#39;)"><span class="hl_conref"><span class="mpre">OverLargeHeader</span></span></a><span class="mpre">
        | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="#loc_205_5_205_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_5_205_10&#39;)"><span class="hl_varref"><span class="mpre">push&#39;</span></span></a><span class="mpre"> </span><a href="#loc_187_5_187_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_5_187_8&#39;)"><span class="hl_varref"><span class="mpre">mnl</span></span></a><span class="mpre">
  where
    </span><a name="loc_185_5_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_7&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="#loc_180_30_180_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_30_180_37&#39;)"><span class="hl_varref"><span class="mpre">prepend</span></span></a><span class="mpre"> </span><a href="#loc_180_39_180_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_39_180_42&#39;)"><span class="hl_varref"><span class="mpre">bs&#39;</span></span></a><span class="mpre">
    </span><a name="loc_186_5_186_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_5_186_10&#39;)"><span class="hl_vardecl"><span class="mpre">bsLen</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.length</span></span><span class="mpre"> </span><a href="#loc_185_5_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
    </span><a name="loc_187_5_187_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_5_187_8&#39;)"><span class="hl_vardecl"><span class="mpre">mnl</span></span></a><span class="mpre"> = do
        </span><a name="loc_188_9_188_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_9_188_11&#39;)"><span class="hl_vardecl"><span class="mpre">nl</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">S.elemIndex</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">10</span></span><span class="mpre"> </span><a href="#loc_185_5_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- check if there are two more bytes in the bs</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- if so, see if the second of those is a horizontal space</span></span><span class="mpre">
        if </span><a href="#loc_186_5_186_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_5_186_10&#39;)"><span class="hl_varref"><span class="mpre">bsLen</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><a href="#loc_188_9_188_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_9_188_11&#39;)"><span class="hl_varref"><span class="mpre">nl</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> then
            let </span><a name="loc_192_17_192_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_17_192_18&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.index</span></span><span class="mpre"> </span><a href="#loc_185_5_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> (</span><a href="#loc_188_9_188_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_9_188_11&#39;)"><span class="hl_varref"><span class="mpre">nl</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
                </span><a name="loc_193_17_193_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_17_193_18&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = case </span><a href="#loc_188_9_188_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_9_188_11&#39;)"><span class="hl_varref"><span class="mpre">nl</span></span></a><span class="mpre"> of
                      </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
                      </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">S.index</span></span><span class="mpre"> </span><a href="#loc_185_5_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">13</span></span><span class="mpre">
                      _ -&gt; </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
            in </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a href="#loc_188_9_188_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_9_188_11&#39;)"><span class="hl_varref"><span class="mpre">nl</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><a href="#loc_193_17_193_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_17_193_18&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> (</span><a href="#loc_192_17_192_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_17_192_18&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">32</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><a href="#loc_192_17_192_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_17_192_18&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">9</span></span><span class="mpre">))
            else
            </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a href="#loc_188_9_188_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_188_9_188_11&#39;)"><span class="hl_varref"><span class="mpre">nl</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">)

    </span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_205_5_205_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_5_205_10&#39;)"><span class="mpre">push&#39;</span></a><span class="mpre"> #-}</span></span><span class="mpre">
    </span><a href="#loc_205_5_205_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_5_205_10&#39;)"><span class="mpre">push&#39;</span></a><span class="mpre"> :: </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">]
    </span><span class="hl_comment"><span class="mpre">-- No newline find in this chunk.  Add it to the prepend,</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- update the length, and continue processing.</span></span><span class="mpre">
    </span><a name="loc_205_5_205_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_5_205_10&#39;)"><span class="hl_fundecl"><span class="mpre">push&#39;</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> = do
        </span><a name="loc_206_9_206_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_9_206_11&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Wai.Handler.Warp.Types.html#loc_114_1_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_114_1_114_12&#39;)"><span class="hl_varref"><span class="mpre">readSource&#39;</span></span></a><span class="mpre"> </span><a href="#loc_180_6_180_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_9&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre">
        </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_206_9_206_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_9_206_11&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Types.html#loc_47_23_47_40" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_47_23_47_40&#39;)"><span class="hl_conref"><span class="mpre">IncompleteHeaders</span></span></a><span class="mpre">
        </span><a href="#loc_180_1_180_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_1_180_5&#39;)"><span class="hl_varref"><span class="mpre">push</span></span></a><span class="mpre"> </span><a href="#loc_180_6_180_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_9&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre"> </span><a href="#loc_212_9_212_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_9_212_15&#39;)"><span class="hl_varref"><span class="mpre">status</span></span></a><span class="mpre"> </span><a href="#loc_206_9_206_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_9_206_11&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
      where
        </span><a name="loc_210_9_210_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_9_210_13&#39;)"><span class="hl_vardecl"><span class="mpre">len&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_180_20_180_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_20_180_23&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_186_5_186_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_5_186_10&#39;)"><span class="hl_varref"><span class="mpre">bsLen</span></span></a><span class="mpre">
        </span><a name="loc_211_9_211_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_9_211_17&#39;)"><span class="hl_vardecl"><span class="mpre">prepend&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.append</span></span><span class="mpre"> </span><a href="#loc_185_5_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
        </span><a name="loc_212_9_212_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_9_212_15&#39;)"><span class="hl_vardecl"><span class="mpre">status</span></span></a><span class="mpre"> = </span><a href="#loc_167_17_167_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_17_167_25&#39;)"><span class="hl_conref"><span class="mpre">THStatus</span></span></a><span class="mpre"> </span><a href="#loc_210_9_210_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_210_9_210_13&#39;)"><span class="hl_varref"><span class="mpre">len&#39;</span></span></a><span class="mpre"> </span><a href="#loc_180_24_180_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_24_180_29&#39;)"><span class="hl_varref"><span class="mpre">lines</span></span></a><span class="mpre"> </span><a href="#loc_211_9_211_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_9_211_17&#39;)"><span class="hl_varref"><span class="mpre">prepend&#39;</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- Found a newline, but next line continues as a multiline header</span></span><span class="mpre">
    </span><a href="#loc_205_5_205_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_5_205_10&#39;)"><span class="hl_fundecl"><span class="mpre">push&#39;</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a name="loc_214_18_214_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_18_214_21&#39;)"><span class="hl_vardecl"><span class="mpre">end</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">)) = </span><a href="#loc_180_1_180_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_1_180_5&#39;)"><span class="hl_varref"><span class="mpre">push</span></span></a><span class="mpre"> </span><a href="#loc_180_6_180_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_9&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre"> </span><a href="#loc_219_9_219_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_9_219_15&#39;)"><span class="hl_varref"><span class="mpre">status</span></span></a><span class="mpre"> </span><a href="#loc_216_9_216_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_9_216_13&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre">
      where
        </span><a name="loc_216_9_216_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_216_9_216_13&#39;)"><span class="hl_vardecl"><span class="mpre">rest</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.drop</span></span><span class="mpre"> (</span><a href="#loc_214_18_214_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_18_214_21&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_185_5_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
        </span><a name="loc_217_9_217_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_9_217_17&#39;)"><span class="hl_vardecl"><span class="mpre">prepend&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S.append</span></span><span class="mpre"> (</span><a href="Data.ByteString.Unsafe.html#loc_142_1_142_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Unsafe.html#loc_142_1_142_11&#39;)"><span class="hl_varref"><span class="mpre">SU.unsafeTake</span></span></a><span class="mpre"> (</span><a href="#loc_245_1_245_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_1_245_8&#39;)"><span class="hl_varref"><span class="mpre">checkCR</span></span></a><span class="mpre"> </span><a href="#loc_185_5_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a href="#loc_214_18_214_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_18_214_21&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre">) </span><a href="#loc_185_5_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">)
        </span><a name="loc_218_9_218_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_9_218_13&#39;)"><span class="hl_vardecl"><span class="mpre">len&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_180_20_180_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_20_180_23&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_214_18_214_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_18_214_21&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre">
        </span><a name="loc_219_9_219_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_219_9_219_15&#39;)"><span class="hl_vardecl"><span class="mpre">status</span></span></a><span class="mpre"> = </span><a href="#loc_167_17_167_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_17_167_25&#39;)"><span class="hl_conref"><span class="mpre">THStatus</span></span></a><span class="mpre"> </span><a href="#loc_218_9_218_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_9_218_13&#39;)"><span class="hl_varref"><span class="mpre">len&#39;</span></span></a><span class="mpre"> </span><a href="#loc_180_24_180_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_24_180_29&#39;)"><span class="hl_varref"><span class="mpre">lines</span></span></a><span class="mpre"> </span><a href="#loc_217_9_217_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_9_217_17&#39;)"><span class="hl_varref"><span class="mpre">prepend&#39;</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- Found a newline at position end.</span></span><span class="mpre">
    </span><a href="#loc_205_5_205_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_5_205_10&#39;)"><span class="hl_fundecl"><span class="mpre">push&#39;</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a name="loc_221_18_221_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_18_221_21&#39;)"><span class="hl_vardecl"><span class="mpre">end</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">))
      </span><span class="hl_comment"><span class="mpre">-- leftover</span></span><span class="mpre">
      | </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_241_9_241_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_9_241_13&#39;)"><span class="hl_varref"><span class="mpre">line</span></span></a><span class="mpre"> = do
            </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_240_9_240_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_9_240_14&#39;)"><span class="hl_varref"><span class="mpre">start</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_186_5_186_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_5_186_10&#39;)"><span class="hl_varref"><span class="mpre">bsLen</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Types.html#loc_117_1_117_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_117_1_117_15&#39;)"><span class="hl_varref"><span class="mpre">leftoverSource</span></span></a><span class="mpre"> </span><a href="#loc_180_6_180_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_9&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Unsafe.html#loc_148_1_148_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Unsafe.html#loc_148_1_148_11&#39;)"><span class="hl_varref"><span class="mpre">SU.unsafeDrop</span></span></a><span class="mpre"> </span><a href="#loc_240_9_240_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_9_240_14&#39;)"><span class="hl_varref"><span class="mpre">start</span></span></a><span class="mpre"> </span><a href="#loc_185_5_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">)
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_180_24_180_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_24_180_29&#39;)"><span class="hl_varref"><span class="mpre">lines</span></span></a><span class="mpre"> [])
      </span><span class="hl_comment"><span class="mpre">-- more headers</span></span><span class="mpre">
      | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">   = let </span><a name="loc_227_27_227_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_27_227_31&#39;)"><span class="hl_vardecl"><span class="mpre">len&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_180_20_180_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_20_180_23&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_240_9_240_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_9_240_14&#39;)"><span class="hl_varref"><span class="mpre">start</span></span></a><span class="mpre">
                          </span><a name="loc_228_27_228_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_27_228_33&#39;)"><span class="hl_vardecl"><span class="mpre">lines&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_180_24_180_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_24_180_29&#39;)"><span class="hl_varref"><span class="mpre">lines</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (</span><a href="#loc_241_9_241_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_9_241_13&#39;)"><span class="hl_varref"><span class="mpre">line</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">)
                          </span><a name="loc_229_27_229_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_27_229_33&#39;)"><span class="hl_vardecl"><span class="mpre">status</span></span></a><span class="mpre"> = </span><a href="#loc_167_17_167_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_17_167_25&#39;)"><span class="hl_conref"><span class="mpre">THStatus</span></span></a><span class="mpre"> </span><a href="#loc_227_27_227_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_227_27_227_31&#39;)"><span class="hl_varref"><span class="mpre">len&#39;</span></span></a><span class="mpre"> </span><a href="#loc_228_27_228_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_228_27_228_33&#39;)"><span class="hl_varref"><span class="mpre">lines&#39;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">
                      in if </span><a href="#loc_240_9_240_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_9_240_14&#39;)"><span class="hl_varref"><span class="mpre">start</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_186_5_186_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_5_186_10&#39;)"><span class="hl_varref"><span class="mpre">bsLen</span></span></a><span class="mpre"> then
                             </span><span class="hl_comment"><span class="mpre">-- more bytes in this chunk, push again</span></span><span class="mpre">
                             let </span><a name="loc_232_34_232_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_34_232_38&#39;)"><span class="hl_vardecl"><span class="mpre">bs&#39;&#39;</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Unsafe.html#loc_148_1_148_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Unsafe.html#loc_148_1_148_11&#39;)"><span class="hl_varref"><span class="mpre">SU.unsafeDrop</span></span></a><span class="mpre"> </span><a href="#loc_240_9_240_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_9_240_14&#39;)"><span class="hl_varref"><span class="mpre">start</span></span></a><span class="mpre"> </span><a href="#loc_185_5_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
                              in </span><a href="#loc_180_1_180_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_1_180_5&#39;)"><span class="hl_varref"><span class="mpre">push</span></span></a><span class="mpre"> </span><a href="#loc_180_6_180_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_9&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre"> </span><a href="#loc_229_27_229_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_27_229_33&#39;)"><span class="hl_varref"><span class="mpre">status</span></span></a><span class="mpre"> </span><a href="#loc_232_34_232_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_232_34_232_38&#39;)"><span class="hl_varref"><span class="mpre">bs&#39;&#39;</span></span></a><span class="mpre">
                           else do
                             </span><span class="hl_comment"><span class="mpre">-- no more bytes in this chunk, ask for more</span></span><span class="mpre">
                             </span><a name="loc_236_30_236_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_236_30_236_32&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Wai.Handler.Warp.Types.html#loc_114_1_114_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_114_1_114_12&#39;)"><span class="hl_varref"><span class="mpre">readSource&#39;</span></span></a><span class="mpre"> </span><a href="#loc_180_6_180_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_9&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre">
                             </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_236_30_236_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_236_30_236_32&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><a href="Network.Wai.Handler.Warp.Types.html#loc_47_23_47_40" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Types.html#loc_47_23_47_40&#39;)"><span class="hl_conref"><span class="mpre">IncompleteHeaders</span></span></a><span class="mpre">
                             </span><a href="#loc_180_1_180_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_1_180_5&#39;)"><span class="hl_varref"><span class="mpre">push</span></span></a><span class="mpre"> </span><a href="#loc_180_6_180_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_6_180_9&#39;)"><span class="hl_varref"><span class="mpre">src</span></span></a><span class="mpre"> </span><a href="#loc_229_27_229_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_27_229_33&#39;)"><span class="hl_varref"><span class="mpre">status</span></span></a><span class="mpre"> </span><a href="#loc_236_30_236_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_236_30_236_32&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
      where
        </span><a name="loc_240_9_240_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_240_9_240_14&#39;)"><span class="hl_vardecl"><span class="mpre">start</span></span></a><span class="mpre"> = </span><a href="#loc_221_18_221_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_18_221_21&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- start of next chunk</span></span><span class="mpre">
        </span><a name="loc_241_9_241_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_9_241_13&#39;)"><span class="hl_vardecl"><span class="mpre">line</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Unsafe.html#loc_142_1_142_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Unsafe.html#loc_142_1_142_11&#39;)"><span class="hl_varref"><span class="mpre">SU.unsafeTake</span></span></a><span class="mpre"> (</span><a href="#loc_245_1_245_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_1_245_8&#39;)"><span class="hl_varref"><span class="mpre">checkCR</span></span></a><span class="mpre"> </span><a href="#loc_185_5_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a href="#loc_221_18_221_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_221_18_221_21&#39;)"><span class="hl_varref"><span class="mpre">end</span></span></a><span class="mpre">) </span><a href="#loc_185_5_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_7&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_245_1_245_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_1_245_8&#39;)"><span class="mpre">checkCR</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_245_1_245_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_1_245_8&#39;)"><span class="mpre">checkCR</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_245_1_245_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_1_245_8&#39;)"><span class="hl_fundecl"><span class="mpre">checkCR</span></span></a><span class="mpre"> </span><a name="loc_245_9_245_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_9_245_11&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a name="loc_245_12_245_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_12_245_15&#39;)"><span class="hl_vardecl"><span class="mpre">pos</span></span></a><span class="mpre"> = if </span><span class="hl_num"><span class="mpre">13</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.index</span></span><span class="mpre"> </span><a href="#loc_245_9_245_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_9_245_11&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a href="#loc_247_6_247_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_6_247_7&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> then </span><a href="#loc_247_6_247_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_6_247_7&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> else </span><a href="#loc_245_12_245_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_12_245_15&#39;)"><span class="hl_varref"><span class="mpre">pos</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- 13 is CR</span></span><span class="mpre">
  where
    !</span><a name="loc_247_6_247_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_247_6_247_7&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = </span><a href="#loc_245_12_245_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_12_245_15&#39;)"><span class="hl_varref"><span class="mpre">pos</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
</span></div></body></html>