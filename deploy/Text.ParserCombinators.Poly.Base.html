<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">module Text.ParserCombinators.Poly.Base
  ( </span><span class="hl_comment"><span class="mpre">-- * The PolyParse classes</span></span><span class="mpre">
    Commitment(..)        </span><span class="hl_comment"><span class="mpre">-- class of all two-level-error values</span></span><span class="mpre">
  , PolyParse                </span><span class="hl_comment"><span class="mpre">-- class of all monadic two-level-error parsers</span></span><span class="mpre">

    </span><span class="hl_comment"><span class="mpre">-- * Combinators general to all parser types.</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- ** Simple combinators</span></span><span class="mpre">
  , apply        </span><span class="hl_comment"><span class="mpre">-- :: PolyParse p =&gt; p (a-&gt;b) -&gt; p a -&gt; p b</span></span><span class="mpre">
  , discard        </span><span class="hl_comment"><span class="mpre">-- :: PolyParse p =&gt; p a      -&gt; p b -&gt; p a</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- ** Error-handling</span></span><span class="mpre">
  , failBad        </span><span class="hl_comment"><span class="mpre">-- :: PolyParse p =&gt; String -&gt; p a</span></span><span class="mpre">
  , adjustErrBad</span><span class="hl_comment"><span class="mpre">-- :: PolyParse p =&gt; p a -&gt; (String-&gt;String) -&gt; p a</span></span><span class="mpre">
  , indent        </span><span class="hl_comment"><span class="mpre">-- :: Int -&gt; String -&gt; String</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- ** Choices</span></span><span class="mpre">
  , oneOf        </span><span class="hl_comment"><span class="mpre">-- :: PolyParse p =&gt; [p a] -&gt; p a</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- ** Sequences</span></span><span class="mpre">
  , exactly        </span><span class="hl_comment"><span class="mpre">-- :: PolyParse p =&gt; Int -&gt; p a -&gt; p [a]</span></span><span class="mpre">
  , upto        </span><span class="hl_comment"><span class="mpre">-- :: PolyParse p =&gt; Int -&gt; p a -&gt; p [a]</span></span><span class="mpre">
  , many1        </span><span class="hl_comment"><span class="mpre">-- :: PolyParse p =&gt; p a -&gt; p [a]</span></span><span class="mpre">
  , sepBy        </span><span class="hl_comment"><span class="mpre">-- :: PolyParse p =&gt; p a -&gt; p sep -&gt; p [a]</span></span><span class="mpre">
  , sepBy1        </span><span class="hl_comment"><span class="mpre">-- :: PolyParse p =&gt; p a -&gt; p sep -&gt; p [a]</span></span><span class="mpre">
  , bracketSep        </span><span class="hl_comment"><span class="mpre">-- :: PolyParse p =&gt; p bra -&gt; p sep -&gt; p ket -&gt; p a -&gt; p [a]</span></span><span class="mpre">
  , bracket        </span><span class="hl_comment"><span class="mpre">-- :: PolyParse p =&gt; p bra -&gt; p ket -&gt; p a -&gt; p a</span></span><span class="mpre">
  , manyFinally </span><span class="hl_comment"><span class="mpre">-- :: PolyParse p =&gt; p a -&gt; p z -&gt; p [a]</span></span><span class="mpre">
  , manyFinally&#39;</span><span class="hl_comment"><span class="mpre">-- :: PolyParse p =&gt; p a -&gt; p z -&gt; p [a]</span></span><span class="mpre">
  ) where

import Control.Applicative

#ifdef __NHC__
</span><span class="warning" data-warning="DeclDefaultDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 31, srcSpanStartColumn = 1, srcSpanEndLine = 31, srcSpanEndColumn = 28}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 31, srcSpanStartColumn = 1, srcSpanEndLine = 31, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src"><span class="mpre">default (Integer,Double,[])</span></span><span class="mpre">        </span><span class="hl_comment"><span class="mpre">-- hack to avoid bizarre type defaulting error</span></span><span class="mpre">
instance </span><a href="#loc_44_7_44_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_7_44_17&#39;)"><span class="hl_classref"><span class="mpre">Commitment</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">[]</span></span><span class="mpre">
instance </span><a href="#loc_66_7_66_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_7_66_16&#39;)"><span class="hl_classref"><span class="mpre">PolyParse</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">[]</span></span><span class="mpre">
#endif

</span><span class="hl_comment"><span class="mpre">-- | The @Commitment@ class is an abstraction over all the current</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   concrete representations of monadic/applicative parser combinators in this</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   package.  The common feature is two-level error-handling.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   Some primitives must be implemented specific to each parser type</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   (e.g. depending on whether the parser has a running state, or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   whether it is lazy).  But given those primitives, large numbers of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   combinators do not depend any further on the internal structure of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   the particular parser.</span></span><span class="mpre">
class </span><a name="loc_44_7_44_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_7_44_17&#39;)"><span class="hl_classdecl"><span class="mpre">Commitment</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> where
    </span><span class="hl_comment"><span class="mpre">-- | Commit is a way of raising the severity of any errors found within</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">--   its argument.  Used in the middle of a parser definition, it means that</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">--   any operations prior to commitment fail softly, but after commitment,</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">--   they fail hard.</span></span><span class="mpre">
    </span><a name="loc_49_5_49_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_5_49_11&#39;)"><span class="mpre">commit</span></a><span class="mpre">    :: </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- | @p `adjustErr` f@ applies the transformation @f@ to any error message</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">--   generated in @p@, having no effect if @p@ succeeds.</span></span><span class="mpre">
    </span><a name="loc_52_5_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_14&#39;)"><span class="mpre">adjustErr</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- | Parse the first alternative that succeeds, but if none succeed,</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">--   report only the severe errors, and if none of those, then report</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">--   all the soft errors.</span></span><span class="mpre">
    </span><a name="loc_56_5_56_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_5_56_11&#39;)"><span class="mpre">oneOf&#39;</span></a><span class="mpre">    :: [(</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">, </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)] -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | The @PolyParse@ class is an abstraction gathering all of the common</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   features that a two-level error-handling parser requires:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   the applicative parsing interface, the monadic interface, and commitment.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   There are two additional basic combinators that we expect to be implemented</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   afresh for every concrete type, but which (for technical reasons)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   cannot be class methods.  They are @next@ and @satisfy@.</span></span><span class="mpre">
class </span><span class="warning" data-warning="ClassDecl ContextCxTuple (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 7, srcSpanEndLine = 65, srcSpanEndColumn = 74}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 7, srcSpanEndLine = 65, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Tex"><span class="mpre">(Functor p, Monad p, Applicative p, Alternative p, Commitment p) =&gt;</span></span><span class="mpre">
      </span><a name="loc_66_7_66_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_7_66_16&#39;)"><span class="hl_classdecl"><span class="mpre">PolyParse</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclInfixDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 68, srcSpanStartColumn = 1, srcSpanEndLine = 68, srcSpanEndColumn = 17}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 68, srcSpanStartColumn = 8, srcSpanEndLine = 68, srcSpanEndColumn = 9}]}) (AssocLeft (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/ho"><span class="mpre">infixl 3 `apply`</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclInfixDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 69, srcSpanStartColumn = 1, srcSpanEndLine = 69, srcSpanEndColumn = 19}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 69, srcSpanStartColumn = 8, srcSpanEndLine = 69, srcSpanEndColumn = 9}]}) (AssocLeft (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/ho"><span class="mpre">infixl 3 `discard`</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Apply a parsed function to a parsed value.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   Rather like ordinary function application lifted into parsers.</span></span><span class="mpre">
</span><a href="#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_6&#39;)"><span class="mpre">apply</span></a><span class="mpre">  :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 73, srcSpanStartColumn = 11, srcSpanEndLine = 73, srcSpanEndColumn = 25}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 73, srcSpanStartColumn = 23, srcSpanEndLine = 73, srcSpanEndColumn = 25}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/hom"><span class="mpre">PolyParse p =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">-&gt;</span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
</span><a name="loc_74_1_74_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_6&#39;)"><span class="hl_vardecl"><span class="mpre">apply</span></span></a><span class="mpre"> = </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_varref"><span class="mpre">(&lt;*&gt;)</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | @x `discard` y@ parses both x and y, but discards the result of y.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   Rather like @const@ lifted into parsers.</span></span><span class="mpre">
</span><a href="#loc_79_4_79_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_4_79_13&#39;)"><span class="mpre">discard</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 78, srcSpanStartColumn = 12, srcSpanEndLine = 78, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 78, srcSpanStartColumn = 24, srcSpanEndLine = 78, srcSpanEndColumn = 26}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/hom"><span class="mpre">PolyParse p =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_79_1_79_3" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_3&#39;)"><span class="hl_vardecl"><span class="mpre">px</span></span></a><span class="mpre"> </span><a name="loc_79_4_79_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_4_79_13&#39;)"><span class="hl_fundecl"><span class="mpre">`discard`</span></span></a><span class="mpre"> </span><a name="loc_79_14_79_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_14_79_16&#39;)"><span class="hl_vardecl"><span class="mpre">py</span></span></a><span class="mpre"> = do { </span><a name="loc_79_24_79_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_24_79_25&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_79_1_79_3" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_3&#39;)"><span class="hl_varref"><span class="mpre">px</span></span></a><span class="mpre">; </span><a name="loc_79_33_79_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_33_79_34&#39;)"><span class="hl_vardecl"><span class="mpre">y</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_79_14_79_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_14_79_16&#39;)"><span class="hl_varref"><span class="mpre">py</span></span></a><span class="mpre">; </span><a href="#loc_79_33_79_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_33_79_34&#39;)"><span class="hl_varref"><span class="mpre">y</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`seq`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_79_24_79_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_24_79_25&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">; }

</span><span class="hl_comment"><span class="mpre">{-
-- Combinators we expect most concrete parser types to implement.
--   For technical reasons, they cannot be class members.

-- | Yield the next token
next      :: PolyParse p =&gt; p t
  --  where t is constrained to be the input token type

-- | One token satisfying a predicate.
satisfy :: PolyParse p =&gt; (t-&gt;Bool) -&gt; p t t
satisfy p = do{ x &lt;- next
              ; if p x then return x else fail &quot;Parse.satisfy: failed&quot;
              }
  -- note: must be re-defined for each implementation because
  --       its type cannot be expressed otherwise.
-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | When a simple fail is not strong enough, use failBad for emphasis.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   An emphasised (severe) error cannot be overridden by choice</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   operators.</span></span><span class="mpre">
</span><a href="#loc_102_1_102_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_1_102_8&#39;)"><span class="mpre">failBad</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 101, srcSpanStartColumn = 12, srcSpanEndLine = 101, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 101, srcSpanStartColumn = 24, srcSpanEndLine = 101, srcSpanEndColumn = 26}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;"><span class="mpre">PolyParse p =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_102_1_102_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_1_102_8&#39;)"><span class="hl_fundecl"><span class="mpre">failBad</span></span></a><span class="mpre"> </span><a name="loc_102_9_102_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_9_102_10&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> = </span><a href="#loc_49_5_49_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_5_49_11&#39;)"><span class="hl_varref"><span class="mpre">commit</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fail</span></span><span class="mpre"> </span><a href="#loc_102_9_102_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_9_102_10&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | @adjustErrBad@ is just like @adjustErr@ except it also raises the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   severity of the error.</span></span><span class="mpre">
</span><a href="#loc_107_3_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_3_107_17&#39;)"><span class="mpre">adjustErrBad</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 106, srcSpanStartColumn = 17, srcSpanEndLine = 106, srcSpanEndColumn = 31}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 106, srcSpanStartColumn = 29, srcSpanEndLine = 106, srcSpanEndColumn = 31}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;"><span class="mpre">PolyParse p =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">-&gt;</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_107_1_107_2" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_1_107_2&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_107_3_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_3_107_17&#39;)"><span class="hl_fundecl"><span class="mpre">`adjustErrBad`</span></span></a><span class="mpre"> </span><a name="loc_107_18_107_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_18_107_19&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_49_5_49_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_49_5_49_11&#39;)"><span class="hl_varref"><span class="mpre">commit</span></span></a><span class="mpre"> (</span><a href="#loc_107_1_107_2" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_1_107_2&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_52_5_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_14&#39;)"><span class="hl_infix"><span class="mpre">`adjustErr`</span></span></a><span class="mpre"> </span><a href="#loc_107_18_107_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_18_107_19&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Parse the first alternative in the list that succeeds.</span></span><span class="mpre">
</span><a href="#loc_111_1_111_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_1_111_6&#39;)"><span class="mpre">oneOf</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 110, srcSpanStartColumn = 10, srcSpanEndLine = 110, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 110, srcSpanStartColumn = 22, srcSpanEndLine = 110, srcSpanEndColumn = 24}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;"><span class="mpre">PolyParse p =&gt;</span></span><span class="mpre"> [</span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">] -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_111_1_111_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_1_111_6&#39;)"><span class="hl_fundecl"><span class="mpre">oneOf</span></span></a><span class="mpre"> []     = </span><span class="hl_varref"><span class="mpre">fail</span></span><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;failed to parse any of the possible choices&quot;</span></span><span class="mpre">)
</span><a href="#loc_111_1_111_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_1_111_6&#39;)"><span class="hl_fundecl"><span class="mpre">oneOf</span></span></a><span class="mpre"> (</span><a name="loc_112_8_112_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_8_112_9&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_112_10_112_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_10_112_12&#39;)"><span class="hl_vardecl"><span class="mpre">ps</span></span></a><span class="mpre">) = </span><a href="#loc_112_8_112_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_8_112_9&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_142_5_142_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_142_5_142_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;|&gt;</span></span></a><span class="mpre"> </span><a href="#loc_111_1_111_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_1_111_6&#39;)"><span class="hl_varref"><span class="mpre">oneOf</span></span></a><span class="mpre"> </span><a href="#loc_112_10_112_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_10_112_12&#39;)"><span class="hl_varref"><span class="mpre">ps</span></span></a><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--oneOf :: Show t =&gt; [Parser t a] -&gt; Parser t a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--oneOf []     = do { n &lt;- next</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--                  ; fail (&quot;failed to parse any of the possible choices&quot;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--                         ++&quot;\n  next token is &quot;++show n)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--                  }</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--oneOf (p:ps) = p `onFail` oneOf ps</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Helper for formatting error messages: indents all lines by a fixed amount.</span></span><span class="mpre">
</span><a href="#loc_122_1_122_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_1_122_7&#39;)"><span class="mpre">indent</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_122_1_122_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_1_122_7&#39;)"><span class="hl_fundecl"><span class="mpre">indent</span></span></a><span class="mpre"> </span><a name="loc_122_8_122_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_8_122_9&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">unlines</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">replicate</span></span><span class="mpre"> </span><a href="#loc_122_8_122_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_8_122_9&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39; &#39;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">lines</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | &#39;exactly n p&#39; parses precisely n items, using the parser p, in sequence.</span></span><span class="mpre">
</span><a href="#loc_126_1_126_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_8&#39;)"><span class="mpre">exactly</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 125, srcSpanStartColumn = 12, srcSpanEndLine = 125, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 125, srcSpanStartColumn = 24, srcSpanEndLine = 125, srcSpanEndColumn = 26}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;"><span class="mpre">PolyParse p =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">]
</span><a name="loc_126_1_126_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_8&#39;)"><span class="hl_fundecl"><span class="mpre">exactly</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">p</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> []
</span><a href="#loc_126_1_126_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_8&#39;)"><span class="hl_fundecl"><span class="mpre">exactly</span></span></a><span class="mpre"> </span><a name="loc_127_9_127_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_9_127_10&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> </span><a name="loc_127_11_127_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_11_127_12&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">(:)</span></span><span class="mpre"> </span><a href="#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_6&#39;)"><span class="hl_infix"><span class="mpre">`apply`</span></span></a><span class="mpre">  (</span><a href="#loc_127_11_127_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_11_127_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_52_5_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_14&#39;)"><span class="hl_infix"><span class="mpre">`adjustErr`</span></span></a><span class="mpre"> ((</span><span class="hl_string"><span class="mpre">&quot;When expecting exactly &quot;</span></span><span class="mpre">
                                                    </span><span class="hl_infix"><span class="mpre">++</span></span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_127_9_127_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_9_127_10&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="hl_infix"><span class="mpre">++</span></span><span class="hl_string"><span class="mpre">&quot; more items&quot;</span></span><span class="mpre">)</span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">))
                         </span><a href="#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_6&#39;)"><span class="hl_infix"><span class="mpre">`apply`</span></span></a><span class="mpre">  </span><a href="#loc_126_1_126_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_8&#39;)"><span class="hl_varref"><span class="mpre">exactly</span></span></a><span class="mpre"> (</span><a href="#loc_127_9_127_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_9_127_10&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_127_11_127_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_11_127_12&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | &#39;upto n p&#39; parses n or fewer items, using the parser p, in sequence.</span></span><span class="mpre">
</span><a href="#loc_133_1_133_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_5&#39;)"><span class="mpre">upto</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 132, srcSpanStartColumn = 9, srcSpanEndLine = 132, srcSpanEndColumn = 23}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 132, srcSpanStartColumn = 21, srcSpanEndLine = 132, srcSpanEndColumn = 23}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/"><span class="mpre">PolyParse p =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">]
</span><a name="loc_133_1_133_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_5&#39;)"><span class="hl_fundecl"><span class="mpre">upto</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">p</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> []
</span><a href="#loc_133_1_133_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_5&#39;)"><span class="hl_fundecl"><span class="mpre">upto</span></span></a><span class="mpre"> </span><a name="loc_134_6_134_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_6_134_7&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> </span><a name="loc_134_8_134_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_8_134_9&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = do </span><a name="loc_134_15_134_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_15_134_16&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_134_8_134_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_8_134_9&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_134_15_134_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_15_134_16&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">) </span><a href="#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_6&#39;)"><span class="hl_infix"><span class="mpre">`apply`</span></span></a><span class="mpre"> </span><a href="#loc_133_1_133_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_5&#39;)"><span class="hl_varref"><span class="mpre">upto</span></span></a><span class="mpre"> (</span><a href="#loc_134_6_134_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_6_134_7&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_134_8_134_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_8_134_9&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">
           </span><a href="Control.Applicative.html#loc_142_5_142_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_142_5_142_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;|&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> []


</span><span class="hl_comment"><span class="mpre">{- is in Control.Applicative
-- | &#39;optional&#39; indicates whether the parser succeeded through the Maybe type.
optional :: PolyParse p =&gt; p a -&gt; p (Maybe a)
optional p = fmap Just p `onFail` return Nothing
-}</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">{- is in Control.Applicative
-- | &#39;many p&#39; parses a list of elements with individual parser p.
--   Cannot fail, since an empty list is a valid return value.
many :: PolyParse p =&gt; p a -&gt; p [a]
many p = many1 p `onFail` return []
-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Parse a non-empty list of items.</span></span><span class="mpre">
</span><a href="#loc_152_1_152_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_1_152_6&#39;)"><span class="mpre">many1</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 151, srcSpanStartColumn = 10, srcSpanEndLine = 151, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 151, srcSpanStartColumn = 22, srcSpanEndLine = 151, srcSpanEndColumn = 24}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;"><span class="mpre">PolyParse p =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">]
</span><a name="loc_152_1_152_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_1_152_6&#39;)"><span class="hl_fundecl"><span class="mpre">many1</span></span></a><span class="mpre"> </span><a name="loc_152_7_152_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_7_152_8&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = do { </span><a name="loc_152_16_152_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_16_152_17&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_152_7_152_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_7_152_8&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_52_5_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_14&#39;)"><span class="hl_infix"><span class="mpre">`adjustErr`</span></span></a><span class="mpre"> ((</span><span class="hl_string"><span class="mpre">&quot;In a sequence:\n&quot;</span></span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">)</span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_122_1_122_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_1_122_7&#39;)"><span class="hl_varref"><span class="mpre">indent</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">)
             ; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_152_16_152_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_16_152_17&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">) </span><a href="#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_6&#39;)"><span class="hl_infix"><span class="mpre">`apply`</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_152_5_152_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_152_5_152_9&#39;)"><span class="hl_varref"><span class="mpre">many</span></span></a><span class="mpre"> </span><a href="#loc_152_7_152_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_7_152_8&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">
             }
</span><span class="hl_comment"><span class="mpre">--       `adjustErr` (&quot;When looking for a non-empty sequence:\n\t&quot;++)</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Parse a list of items separated by discarded junk.</span></span><span class="mpre">
</span><a href="#loc_159_1_159_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_1_159_6&#39;)"><span class="mpre">sepBy</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 158, srcSpanStartColumn = 10, srcSpanEndLine = 158, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 158, srcSpanStartColumn = 22, srcSpanEndLine = 158, srcSpanEndColumn = 24}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;"><span class="mpre">PolyParse p =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">sep</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">]
</span><a name="loc_159_1_159_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_1_159_6&#39;)"><span class="hl_fundecl"><span class="mpre">sepBy</span></span></a><span class="mpre"> </span><a name="loc_159_7_159_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_7_159_8&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_159_9_159_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_9_159_12&#39;)"><span class="hl_vardecl"><span class="mpre">sep</span></span></a><span class="mpre"> = do </span><a href="#loc_163_1_163_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_1_163_7&#39;)"><span class="hl_varref"><span class="mpre">sepBy1</span></span></a><span class="mpre"> </span><a href="#loc_159_7_159_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_7_159_8&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_159_9_159_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_9_159_12&#39;)"><span class="hl_varref"><span class="mpre">sep</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_142_5_142_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_142_5_142_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;|&gt;</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> []

</span><span class="hl_comment"><span class="mpre">-- | Parse a non-empty list of items separated by discarded junk.</span></span><span class="mpre">
</span><a href="#loc_163_1_163_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_1_163_7&#39;)"><span class="mpre">sepBy1</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 162, srcSpanStartColumn = 11, srcSpanEndLine = 162, srcSpanEndColumn = 25}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 162, srcSpanStartColumn = 23, srcSpanEndLine = 162, srcSpanEndColumn = 25}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;"><span class="mpre">PolyParse p =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">sep</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">]
</span><a name="loc_163_1_163_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_1_163_7&#39;)"><span class="hl_fundecl"><span class="mpre">sepBy1</span></span></a><span class="mpre"> </span><a name="loc_163_8_163_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_8_163_9&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_163_10_163_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_10_163_13&#39;)"><span class="hl_vardecl"><span class="mpre">sep</span></span></a><span class="mpre"> = do { </span><a name="loc_163_21_163_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_21_163_22&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_163_8_163_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_8_163_9&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">
                  ; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_163_21_163_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_21_163_22&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">) </span><a href="#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_6&#39;)"><span class="hl_infix"><span class="mpre">`apply`</span></span></a><span class="mpre"> </span><a href="Control.Applicative.html#loc_152_5_152_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_152_5_152_9&#39;)"><span class="hl_varref"><span class="mpre">many</span></span></a><span class="mpre"> (do {</span><a href="#loc_163_10_163_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_10_163_13&#39;)"><span class="hl_varref"><span class="mpre">sep</span></span></a><span class="mpre">; </span><a href="#loc_163_8_163_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_163_8_163_9&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">})
                  }
         </span><a href="#loc_52_5_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_14&#39;)"><span class="hl_infix"><span class="mpre">`adjustErr`</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;When looking for a non-empty sequence with separators:\n\t&quot;</span></span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">)
 
</span><span class="hl_comment"><span class="mpre">-- | Parse a list of items, discarding the start, end, and separator</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   items.</span></span><span class="mpre">
</span><a href="#loc_171_1_171_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_1_171_11&#39;)"><span class="mpre">bracketSep</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 170, srcSpanStartColumn = 15, srcSpanEndLine = 170, srcSpanEndColumn = 29}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 170, srcSpanStartColumn = 27, srcSpanEndLine = 170, srcSpanEndColumn = 29}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;"><span class="mpre">PolyParse p =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">bra</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">sep</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">]
</span><a name="loc_171_1_171_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_1_171_11&#39;)"><span class="hl_fundecl"><span class="mpre">bracketSep</span></span></a><span class="mpre"> </span><a name="loc_171_12_171_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_12_171_16&#39;)"><span class="hl_vardecl"><span class="mpre">open</span></span></a><span class="mpre"> </span><a name="loc_171_17_171_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_17_171_20&#39;)"><span class="hl_vardecl"><span class="mpre">sep</span></span></a><span class="mpre"> </span><a name="loc_171_21_171_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_21_171_26&#39;)"><span class="hl_vardecl"><span class="mpre">close</span></span></a><span class="mpre"> </span><a name="loc_171_27_171_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_27_171_28&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> =
    do { </span><a href="#loc_171_12_171_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_12_171_16&#39;)"><span class="hl_varref"><span class="mpre">open</span></span></a><span class="mpre">; </span><a href="#loc_171_21_171_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_21_171_26&#39;)"><span class="hl_varref"><span class="mpre">close</span></span></a><span class="mpre">; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> [] }
       </span><a href="Control.Applicative.html#loc_142_5_142_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_142_5_142_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;|&gt;</span></span></a><span class="mpre">
    do { </span><a href="#loc_171_12_171_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_12_171_16&#39;)"><span class="hl_varref"><span class="mpre">open</span></span></a><span class="mpre">    </span><a href="#loc_52_5_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_14&#39;)"><span class="hl_infix"><span class="mpre">`adjustErr`</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;Missing opening bracket:\n\t&quot;</span></span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">)
       ; </span><a name="loc_175_10_175_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_10_175_11&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_171_27_171_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_27_171_28&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">  </span><a href="#loc_52_5_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_14&#39;)"><span class="hl_infix"><span class="mpre">`adjustErr`</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;After first bracket in a group:\n\t&quot;</span></span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">)
       ; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_175_10_175_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_10_175_11&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">)
           </span><a href="#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_6&#39;)"><span class="hl_infix"><span class="mpre">`apply`</span></span></a><span class="mpre"> </span><a href="#loc_197_1_197_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_1_197_12&#39;)"><span class="hl_varref"><span class="mpre">manyFinally</span></span></a><span class="mpre"> (do {</span><a href="#loc_171_17_171_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_17_171_20&#39;)"><span class="hl_varref"><span class="mpre">sep</span></span></a><span class="mpre">; </span><a href="#loc_171_27_171_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_27_171_28&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">})
              (</span><a href="#loc_171_21_171_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_21_171_26&#39;)"><span class="hl_varref"><span class="mpre">close</span></span></a><span class="mpre"> </span><a href="#loc_107_3_107_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_3_107_17&#39;)"><span class="hl_infix"><span class="mpre">`adjustErrBad`</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;When looking for closing bracket:\n\t&quot;</span></span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">))
       }

</span><span class="hl_comment"><span class="mpre">-- | Parse a bracketed item, discarding the brackets.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   If everything matches /except/ the closing bracket, the whole</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   parse fails soft, which can give less-than-satisfying error messages.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   If you want better error messages, try calling with e.g.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--     @bracket open (commit close) item@</span></span><span class="mpre">
</span><a href="#loc_187_1_187_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_1_187_8&#39;)"><span class="mpre">bracket</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 186, srcSpanStartColumn = 12, srcSpanEndLine = 186, srcSpanEndColumn = 26}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 186, srcSpanStartColumn = 24, srcSpanEndLine = 186, srcSpanEndColumn = 26}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;"><span class="mpre">PolyParse p =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">bra</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">ket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_187_1_187_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_1_187_8&#39;)"><span class="hl_fundecl"><span class="mpre">bracket</span></span></a><span class="mpre"> </span><a name="loc_187_9_187_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_9_187_13&#39;)"><span class="hl_vardecl"><span class="mpre">open</span></span></a><span class="mpre"> </span><a name="loc_187_14_187_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_14_187_19&#39;)"><span class="hl_vardecl"><span class="mpre">close</span></span></a><span class="mpre"> </span><a name="loc_187_20_187_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_20_187_21&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> = do
    do { </span><a href="#loc_187_9_187_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_9_187_13&#39;)"><span class="hl_varref"><span class="mpre">open</span></span></a><span class="mpre">    </span><a href="#loc_52_5_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_14&#39;)"><span class="hl_infix"><span class="mpre">`adjustErr`</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;Missing opening bracket:\n\t&quot;</span></span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">)
       ; </span><a href="#loc_187_20_187_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_20_187_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_79_4_79_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_4_79_13&#39;)"><span class="hl_infix"><span class="mpre">`discard`</span></span></a><span class="mpre"> (</span><a href="#loc_187_14_187_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_14_187_19&#39;)"><span class="hl_varref"><span class="mpre">close</span></span></a><span class="mpre"> </span><a href="#loc_52_5_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_5_52_14&#39;)"><span class="hl_infix"><span class="mpre">`adjustErr`</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;Missing closing bracket:\n\t&quot;</span></span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">))
       }

</span><span class="hl_comment"><span class="mpre">-- | @manyFinally e t@ parses a possibly-empty sequence of @e@&#39;s,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   terminated by a @t@.  The final @t@ is discarded.  Any parse failures</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   could be due either to a badly-formed terminator or a badly-formed</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   element, so it raises both possible errors.</span></span><span class="mpre">
</span><a href="#loc_197_1_197_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_1_197_12&#39;)"><span class="mpre">manyFinally</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 196, srcSpanStartColumn = 16, srcSpanEndLine = 196, srcSpanEndColumn = 30}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 196, srcSpanStartColumn = 28, srcSpanEndLine = 196, srcSpanEndColumn = 30}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;"><span class="mpre">PolyParse p =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">z</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">]
</span><a name="loc_197_1_197_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_1_197_12&#39;)"><span class="hl_fundecl"><span class="mpre">manyFinally</span></span></a><span class="mpre"> </span><a name="loc_197_13_197_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_13_197_14&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_197_15_197_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_15_197_16&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> =
    (</span><a href="Control.Applicative.html#loc_152_5_152_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_152_5_152_9&#39;)"><span class="hl_varref"><span class="mpre">many</span></span></a><span class="mpre"> </span><a href="#loc_197_13_197_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_13_197_14&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_79_4_79_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_4_79_13&#39;)"><span class="hl_infix"><span class="mpre">`discard`</span></span></a><span class="mpre"> </span><a href="#loc_197_15_197_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_15_197_16&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">)
      </span><a href="Control.Applicative.html#loc_142_5_142_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_142_5_142_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;|&gt;</span></span></a><span class="mpre">
    </span><a href="#loc_56_5_56_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_5_56_11&#39;)"><span class="hl_varref"><span class="mpre">oneOf&#39;</span></span></a><span class="mpre"> [ (</span><span class="hl_string"><span class="mpre">&quot;sequence terminator&quot;</span></span><span class="mpre">, do { </span><a href="#loc_197_15_197_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_15_197_16&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> [] } )
           , (</span><span class="hl_string"><span class="mpre">&quot;item in a sequence&quot;</span></span><span class="mpre">,  do { </span><a href="#loc_197_13_197_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_13_197_14&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> [] } )
           ]
</span><span class="hl_comment"><span class="mpre">{-
manyFinally p t =
    do { xs &lt;- many p
       ; oneOf&#39; [ (&quot;sequence terminator&quot;, do { t; return () } )
                , (&quot;item in a sequence&quot;,  do { p; return () } )
                ]
       ; return xs
       }
-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | @manyFinally&#39;@ is like @manyFinally@, except when the terminator</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   parser overlaps with the element parser.  In @manyFinally e t@,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   the parser @t@ is tried only when parser @e@ fails, whereas in</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   @manyFinally&#39; e t@, the parser @t@ is always tried first, then</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   parser @e@ only if the terminator is not found.  For instance,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   @manyFinally (accept &quot;01&quot;) (accept &quot;0&quot;)@ on input @&quot;0101010&quot;@ returns</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   @[&quot;01&quot;,&quot;01&quot;,&quot;01&quot;]@, whereas @manyFinally&#39;@ with the same arguments</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   and input returns @[]@.</span></span><span class="mpre">
</span><a href="#loc_222_1_222_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_1_222_13&#39;)"><span class="mpre">manyFinally&#39;</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 221, srcSpanStartColumn = 17, srcSpanEndLine = 221, srcSpanEndColumn = 31}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/polyparse-1.9/src/Text/ParserCombinators/Poly/Base.hs&quot;, srcSpanStartLine = 221, srcSpanStartColumn = 29, srcSpanEndLine = 221, srcSpanEndColumn = 31}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;"><span class="mpre">PolyParse p =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">z</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">p</span></span><span class="mpre"> [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">]
</span><a name="loc_222_1_222_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_1_222_13&#39;)"><span class="hl_fundecl"><span class="mpre">manyFinally&#39;</span></span></a><span class="mpre"> </span><a name="loc_222_14_222_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_14_222_15&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_222_16_222_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_16_222_17&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> =
    (do </span><a href="#loc_222_16_222_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_16_222_17&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> [])
      </span><a href="Control.Applicative.html#loc_142_5_142_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_142_5_142_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;|&gt;</span></span></a><span class="mpre">
    (do </span><a name="loc_225_9_225_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_9_225_10&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_222_14_222_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_14_222_15&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_225_9_225_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_9_225_10&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">) </span><a href="#loc_74_1_74_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_6&#39;)"><span class="hl_infix"><span class="mpre">`apply`</span></span></a><span class="mpre"> </span><a href="#loc_222_1_222_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_1_222_13&#39;)"><span class="hl_varref"><span class="mpre">manyFinally&#39;</span></span></a><span class="mpre"> </span><a href="#loc_222_14_222_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_14_222_15&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_222_16_222_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_16_222_17&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">)
      </span><a href="Control.Applicative.html#loc_142_5_142_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_142_5_142_10&#39;)"><span class="hl_infix"><span class="mpre">&lt;|&gt;</span></span></a><span class="mpre">
    </span><a href="#loc_56_5_56_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_5_56_11&#39;)"><span class="hl_varref"><span class="mpre">oneOf&#39;</span></span></a><span class="mpre"> [ (</span><span class="hl_string"><span class="mpre">&quot;sequence terminator&quot;</span></span><span class="mpre">, do { </span><a href="#loc_222_16_222_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_16_222_17&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> [] } )
           , (</span><span class="hl_string"><span class="mpre">&quot;item in a sequence&quot;</span></span><span class="mpre">,  do { </span><a href="#loc_222_14_222_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_222_14_222_15&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> [] } )
           ]

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">
</span></div></body></html>