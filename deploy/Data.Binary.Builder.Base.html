<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE BangPatterns, CPP, MagicHash #-}
#if __GLASGOW_HASKELL__ &gt;= 701
{-# LANGUAGE Trustworthy #-}
#endif

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Data.Binary.Builder.Base</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   : Lennart Kolmodin, Ross Paterson</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD3-style (see LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Lennart Kolmodin &lt;kolmodin@gmail.com&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : portable to Hugs and GHC</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A module exporting types and functions that are shared by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Data.Binary.Builder&#39; and &#39;Data.Binary.Builder.Internal&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

#if defined(__GLASGOW_HASKELL__) &amp;&amp; !defined(__HADDOCK__)
#include &quot;MachDeps.h&quot;
#endif

module Data.Binary.Builder.Base (
    </span><span class="hl_comment"><span class="mpre">-- * The Builder type</span></span><span class="mpre">
      Builder
    , toLazyByteString

    </span><span class="hl_comment"><span class="mpre">-- * Constructing Builders</span></span><span class="mpre">
    , empty
    , singleton
    , append
    , fromByteString        </span><span class="hl_comment"><span class="mpre">-- :: S.ByteString -&gt; Builder</span></span><span class="mpre">
    , fromLazyByteString    </span><span class="hl_comment"><span class="mpre">-- :: L.ByteString -&gt; Builder</span></span><span class="mpre">

    </span><span class="hl_comment"><span class="mpre">-- * Flushing the buffer state</span></span><span class="mpre">
    , flush

    </span><span class="hl_comment"><span class="mpre">-- * Derived Builders</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- ** Big-endian writes</span></span><span class="mpre">
    , putWord16be           </span><span class="hl_comment"><span class="mpre">-- :: Word16 -&gt; Builder</span></span><span class="mpre">
    , putWord32be           </span><span class="hl_comment"><span class="mpre">-- :: Word32 -&gt; Builder</span></span><span class="mpre">
    , putWord64be           </span><span class="hl_comment"><span class="mpre">-- :: Word64 -&gt; Builder</span></span><span class="mpre">

    </span><span class="hl_comment"><span class="mpre">-- ** Little-endian writes</span></span><span class="mpre">
    , putWord16le           </span><span class="hl_comment"><span class="mpre">-- :: Word16 -&gt; Builder</span></span><span class="mpre">
    , putWord32le           </span><span class="hl_comment"><span class="mpre">-- :: Word32 -&gt; Builder</span></span><span class="mpre">
    , putWord64le           </span><span class="hl_comment"><span class="mpre">-- :: Word64 -&gt; Builder</span></span><span class="mpre">

    </span><span class="hl_comment"><span class="mpre">-- ** Host-endian, unaligned writes</span></span><span class="mpre">
    , putWordhost           </span><span class="hl_comment"><span class="mpre">-- :: Word -&gt; Builder</span></span><span class="mpre">
    , putWord16host         </span><span class="hl_comment"><span class="mpre">-- :: Word16 -&gt; Builder</span></span><span class="mpre">
    , putWord32host         </span><span class="hl_comment"><span class="mpre">-- :: Word32 -&gt; Builder</span></span><span class="mpre">
    , putWord64host         </span><span class="hl_comment"><span class="mpre">-- :: Word64 -&gt; Builder</span></span><span class="mpre">

      </span><span class="hl_comment"><span class="mpre">-- ** Unicode</span></span><span class="mpre">
    , putCharUtf8

      </span><span class="hl_comment"><span class="mpre">-- * Low-level construction of Builders</span></span><span class="mpre">
    , writeN
    , writeAtMost
    ) where

import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/binary-0.7.1.0/src/Data/Binary/Builder/Base.hs&quot;, srcSpanStartLine = 65, srcSpanStartColumn = 18, srcSpanEndLine = 65, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre">      as S
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/binary-0.7.1.0/src/Data/Binary/Builder/Base.hs&quot;, srcSpanStartLine = 66, srcSpanStartColumn = 18, srcSpanEndLine = 66, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L
import Data.Monoid
import Data.Word
import Foreign

import System.IO.Unsafe as IO ( </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="mpre">unsafePerformIO</span></a><span class="mpre"> )

#ifdef BYTESTRING_IN_BASE
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/binary-0.7.1.0/src/Data/Binary/Builder/Base.hs&quot;, srcSpanStartLine = 74, srcSpanStartColumn = 8, srcSpanEndLine = 74, srcSpanEndColumn = 28}, srcInfoPoints = []}) &quot;Data.ByteString.Base&quot;"><span class="mpre">Data.ByteString.Base</span></span><span class="mpre"> (inlinePerformIO)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/binary-0.7.1.0/src/Data/Binary/Builder/Base.hs&quot;, srcSpanStartLine = 75, srcSpanStartColumn = 18, srcSpanEndLine = 75, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Base&quot;"><span class="mpre">Data.ByteString.Base</span></span><span class="mpre"> as S
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/binary-0.7.1.0/src/Data/Binary/Builder/Base.hs&quot;, srcSpanStartLine = 76, srcSpanStartColumn = 18, srcSpanEndLine = 76, srcSpanEndColumn = 43}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy.Base&quot;"><span class="mpre">Data.ByteString.Lazy.Base</span></span><span class="mpre"> as L
#else
import Data.ByteString.Internal (</span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="mpre">inlinePerformIO</span></a><span class="mpre">)
import qualified Data.ByteString.Internal as S
import qualified Data.ByteString.Lazy.Internal as L
#endif

#if defined(__GLASGOW_HASKELL__) &amp;&amp; !defined(__HADDOCK__)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/binary-0.7.1.0/src/Data/Binary/Builder/Base.hs&quot;, srcSpanStartLine = 84, srcSpanStartColumn = 8, srcSpanEndLine = 84, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/binary-0.7.1.0/src/Data/Binary/Builder/Base.hs&quot;, srcSpanStartLine = 85, srcSpanStartColumn = 8, srcSpanEndLine = 85, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Word&quot;"><span class="mpre">GHC.Word</span></span><span class="mpre"> (Word32(..),Word16(..),Word64(..))
# if WORD_SIZE_IN_BITS &lt; 64
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/binary-0.7.1.0/src/Data/Binary/Builder/Base.hs&quot;, srcSpanStartLine = 87, srcSpanStartColumn = 8, srcSpanEndLine = 87, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Word&quot;"><span class="mpre">GHC.Word</span></span><span class="mpre"> (uncheckedShiftRL64#)
# endif
#endif

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A &#39;Builder&#39; is an efficient way to build lazy &#39;L.ByteString&#39;s.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- There are several functions for constructing &#39;Builder&#39;s, but only one</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to inspect them: to extract any data, you have to turn them into lazy</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;L.ByteString&#39;s using &#39;toLazyByteString&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Internally, a &#39;Builder&#39; constructs a lazy &#39;L.Bytestring&#39; by filling byte</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- arrays piece by piece.  As each buffer is filled, it is \&#39;popped\&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- off, to become a new chunk of the resulting lazy &#39;L.ByteString&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- All this is hidden from the user of the &#39;Builder&#39;.</span></span><span class="mpre">

newtype </span><a name="loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tycondecl"><span class="mpre">Builder</span></span></a><span class="mpre"> = </span><a name="loc_103_19_103_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_19_103_26&#39;)"><span class="hl_condecl"><span class="mpre">Builder</span></span></a><span class="mpre"> {
        </span><a name="loc_104_9_104_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_9_104_19&#39;)"><span class="hl_fielddecl"><span class="mpre">runBuilder</span></span></a><span class="mpre"> :: (</span><a href="#loc_167_6_167_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_6_167_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre">)
                   -&gt; </span><a href="#loc_167_6_167_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_6_167_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre">
                   -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre">
    }

instance </span><a href="Data.Monoid.html#loc_79_7_79_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_79_7_79_13&#39;)"><span class="hl_classref"><span class="mpre">Monoid</span></span></a><span class="mpre"> </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre"> where
    </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_vardecl"><span class="mpre">mempty</span></span></a><span class="mpre">  = </span><a href="#loc_124_1_124_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_1_124_6&#39;)"><span class="hl_varref"><span class="mpre">empty</span></span></a><span class="mpre">
    </span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="mpre">mempty</span></a><span class="mpre"> #-}</span></span><span class="mpre">
    </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_vardecl"><span class="mpre">mappend</span></span></a><span class="mpre"> = </span><a href="#loc_143_1_143_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_7&#39;)"><span class="hl_varref"><span class="mpre">append</span></span></a><span class="mpre">
    </span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="mpre">mappend</span></a><span class="mpre"> #-}</span></span><span class="mpre">
    </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_vardecl"><span class="mpre">mconcat</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">foldr</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_varref"><span class="mpre">mappend</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">
    </span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="mpre">mconcat</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(1)./ The empty Builder, satisfying</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * @&#39;toLazyByteString&#39; &#39;empty&#39; = &#39;L.empty&#39;@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_124_1_124_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_1_124_6&#39;)"><span class="mpre">empty</span></a><span class="mpre"> :: </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_124_1_124_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_1_124_6&#39;)"><span class="hl_vardecl"><span class="mpre">empty</span></span></a><span class="mpre"> = </span><a href="#loc_103_19_103_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_19_103_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> (\ </span><a name="loc_124_20_124_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_20_124_21&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> </span><a name="loc_124_22_124_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_22_124_23&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_124_20_124_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_20_124_21&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_124_22_124_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_22_124_23&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_124_1_124_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_1_124_6&#39;)"><span class="mpre">empty</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(1)./ A Builder taking a single byte, satisfying</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * @&#39;toLazyByteString&#39; (&#39;singleton&#39; b) = &#39;L.singleton&#39; b@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_132_1_132_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_10&#39;)"><span class="mpre">singleton</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_132_1_132_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_10&#39;)"><span class="hl_vardecl"><span class="mpre">singleton</span></span></a><span class="mpre"> = </span><a href="#loc_239_1_239_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_7&#39;)"><span class="hl_varref"><span class="mpre">writeN</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">flip</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_132_1_132_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_10&#39;)"><span class="mpre">singleton</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(1)./ The concatenation of two Builders, an associative operation</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- with identity &#39;empty&#39;, satisfying</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * @&#39;toLazyByteString&#39; (&#39;append&#39; x y) = &#39;L.append&#39; (&#39;toLazyByteString&#39; x) (&#39;toLazyByteString&#39; y)@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_143_1_143_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_7&#39;)"><span class="mpre">append</span></a><span class="mpre"> :: </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_143_1_143_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_7&#39;)"><span class="hl_fundecl"><span class="mpre">append</span></span></a><span class="mpre"> (</span><a href="#loc_103_19_103_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_19_103_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><a name="loc_143_17_143_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_17_143_18&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre">) (</span><a href="#loc_103_19_103_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_19_103_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><a name="loc_143_29_143_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_29_143_30&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre">) = </span><a href="#loc_103_19_103_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_19_103_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> (</span><a href="#loc_143_17_143_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_17_143_18&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_143_29_143_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_29_143_30&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE [0] </span><a href="#loc_143_1_143_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_7&#39;)"><span class="mpre">append</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(1)./ A Builder taking a &#39;S.ByteString&#39;, satisfying</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * @&#39;toLazyByteString&#39; (&#39;fromByteString&#39; bs) = &#39;L.fromChunks&#39; [bs]@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_151_1_151_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_1_151_15&#39;)"><span class="mpre">fromByteString</span></a><span class="mpre"> :: </span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">S.ByteString</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_151_1_151_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_1_151_15&#39;)"><span class="hl_fundecl"><span class="mpre">fromByteString</span></span></a><span class="mpre"> </span><a name="loc_151_16_151_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_16_151_18&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_151_16_151_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_16_151_18&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="#loc_124_1_124_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_1_124_6&#39;)"><span class="hl_varref"><span class="mpre">empty</span></span></a><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><a href="#loc_187_1_187_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_1_187_6&#39;)"><span class="hl_varref"><span class="mpre">flush</span></span></a><span class="mpre"> </span><a href="#loc_143_1_143_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_7&#39;)"><span class="hl_infix"><span class="mpre">`append`</span></span></a><span class="mpre"> </span><a href="#loc_218_1_218_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_1_218_11&#39;)"><span class="hl_varref"><span class="mpre">mapBuilder</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Lazy.Internal.html#loc_82_27_82_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_27_82_32&#39;)"><span class="hl_conref"><span class="mpre">L.Chunk</span></span></a><span class="mpre"> </span><a href="#loc_151_16_151_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_16_151_18&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_151_1_151_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_1_151_15&#39;)"><span class="mpre">fromByteString</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(1)./ A Builder taking a lazy &#39;L.ByteString&#39;, satisfying</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * @&#39;toLazyByteString&#39; (&#39;fromLazyByteString&#39; bs) = bs@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_161_1_161_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_1_161_19&#39;)"><span class="mpre">fromLazyByteString</span></a><span class="mpre"> :: </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_161_1_161_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_1_161_19&#39;)"><span class="hl_fundecl"><span class="mpre">fromLazyByteString</span></span></a><span class="mpre"> </span><a name="loc_161_20_161_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_20_161_23&#39;)"><span class="hl_vardecl"><span class="mpre">bss</span></span></a><span class="mpre"> = </span><a href="#loc_187_1_187_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_1_187_6&#39;)"><span class="hl_varref"><span class="mpre">flush</span></span></a><span class="mpre"> </span><a href="#loc_143_1_143_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_7&#39;)"><span class="hl_infix"><span class="mpre">`append`</span></span></a><span class="mpre"> </span><a href="#loc_218_1_218_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_1_218_11&#39;)"><span class="hl_varref"><span class="mpre">mapBuilder</span></span></a><span class="mpre"> (</span><a href="#loc_161_20_161_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_20_161_23&#39;)"><span class="hl_varref"><span class="mpre">bss</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`L.append`</span></span><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_161_1_161_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_1_161_19&#39;)"><span class="mpre">fromLazyByteString</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Our internal buffer type</span></span><span class="mpre">
data </span><a name="loc_167_6_167_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_6_167_12&#39;)"><span class="hl_tycondecl"><span class="mpre">Buffer</span></span></a><span class="mpre"> = </span><a name="loc_167_15_167_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_15_167_21&#39;)"><span class="hl_condecl"><span class="mpre">Buffer</span></span></a><span class="mpre"> {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
                     {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">                </span><span class="hl_comment"><span class="mpre">-- offset</span></span><span class="mpre">
                     {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">                </span><span class="hl_comment"><span class="mpre">-- used bytes</span></span><span class="mpre">
                     {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">                </span><span class="hl_comment"><span class="mpre">-- length left</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(n)./ Extract a lazy &#39;L.ByteString&#39; from a &#39;Builder&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The construction work takes place if and when the relevant part of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the lazy &#39;L.ByteString&#39; is demanded.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_179_1_179_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_1_179_17&#39;)"><span class="mpre">toLazyByteString</span></a><span class="mpre"> :: </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre"> -&gt; </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre">
</span><a name="loc_179_1_179_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_1_179_17&#39;)"><span class="hl_fundecl"><span class="mpre">toLazyByteString</span></span></a><span class="mpre"> </span><a name="loc_179_18_179_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_18_179_19&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">IO.unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a name="loc_180_5_180_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_5_180_8&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_249_1_249_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_1_249_10&#39;)"><span class="hl_varref"><span class="mpre">newBuffer</span></span></a><span class="mpre"> </span><a href="#loc_200_1_200_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_1_200_12&#39;)"><span class="hl_varref"><span class="mpre">defaultSize</span></span></a><span class="mpre">
    </span><a href="#loc_104_9_104_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_9_104_19&#39;)"><span class="hl_varref"><span class="mpre">runBuilder</span></span></a><span class="mpre"> (</span><a href="#loc_179_18_179_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_18_179_19&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_143_1_143_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_7&#39;)"><span class="hl_infix"><span class="mpre">`append`</span></span></a><span class="mpre"> </span><a href="#loc_187_1_187_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_1_187_6&#39;)"><span class="hl_varref"><span class="mpre">flush</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_19_82_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_19_82_24&#39;)"><span class="hl_conref"><span class="mpre">L.Empty</span></span></a><span class="mpre">)) </span><a href="#loc_180_5_180_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_5_180_8&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_179_1_179_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_1_179_17&#39;)"><span class="mpre">toLazyByteString</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(1)./ Pop the &#39;S.ByteString&#39; we have constructed so far, if any,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- yielding a new chunk in the result lazy &#39;L.ByteString&#39;.</span></span><span class="mpre">
</span><a href="#loc_187_1_187_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_1_187_6&#39;)"><span class="mpre">flush</span></a><span class="mpre"> :: </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_187_1_187_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_1_187_6&#39;)"><span class="hl_vardecl"><span class="mpre">flush</span></span></a><span class="mpre"> = </span><a href="#loc_103_19_103_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_19_103_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_187_21_187_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_21_187_22&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> </span><a name="loc_187_23_187_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_23_187_26&#39;)"><span class="hl_specname"><span class="mpre">buf</span></span></a><span class="mpre">@(</span><a href="#loc_167_15_167_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_15_167_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a name="loc_187_35_187_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_35_187_36&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_187_37_187_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_37_187_38&#39;)"><span class="hl_vardecl"><span class="mpre">o</span></span></a><span class="mpre"> </span><a name="loc_187_39_187_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_39_187_40&#39;)"><span class="hl_vardecl"><span class="mpre">u</span></span></a><span class="mpre"> </span><a name="loc_187_41_187_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_41_187_42&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) -&gt;
    if </span><a href="#loc_187_39_187_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_39_187_40&#39;)"><span class="hl_varref"><span class="mpre">u</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- Invariant (from Data.ByteString.Lazy)</span></span><span class="mpre">
      then </span><a href="#loc_187_21_187_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_21_187_22&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_187_23_187_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_23_187_26&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
      else let !</span><a name="loc_190_17_190_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_17_190_18&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">  = </span><a href="#loc_167_15_167_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_15_167_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a href="#loc_187_35_187_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_35_187_36&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> (</span><a href="#loc_187_37_187_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_37_187_38&#39;)"><span class="hl_varref"><span class="mpre">o</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_187_39_187_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_39_187_40&#39;)"><span class="hl_varref"><span class="mpre">u</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_187_41_187_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_41_187_42&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
               !</span><a name="loc_191_17_191_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_17_191_19&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">S.PS</span></span></a><span class="mpre"> </span><a href="#loc_187_35_187_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_35_187_36&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_187_37_187_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_37_187_38&#39;)"><span class="hl_varref"><span class="mpre">o</span></span></a><span class="mpre"> </span><a href="#loc_187_39_187_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_39_187_40&#39;)"><span class="hl_varref"><span class="mpre">u</span></span></a><span class="mpre">
           in </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_27_82_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_27_82_32&#39;)"><span class="hl_conref"><span class="mpre">L.Chunk</span></span></a><span class="mpre"> </span><a href="#loc_191_17_191_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_17_191_19&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">inlinePerformIO</span></span></a><span class="mpre"> (</span><a href="#loc_187_21_187_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_21_187_22&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_190_17_190_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_17_190_18&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">))

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- copied from Data.ByteString.Lazy</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_200_1_200_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_1_200_12&#39;)"><span class="mpre">defaultSize</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_200_1_200_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_1_200_12&#39;)"><span class="hl_vardecl"><span class="mpre">defaultSize</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">32</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><a href="#loc_201_11_201_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_11_201_12&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_202_11_202_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_11_202_19&#39;)"><span class="hl_varref"><span class="mpre">overhead</span></span></a><span class="mpre">
    where </span><a name="loc_201_11_201_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_11_201_12&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">1024</span></span><span class="mpre">
          </span><a name="loc_202_11_202_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_11_202_19&#39;)"><span class="hl_vardecl"><span class="mpre">overhead</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Sequence an IO operation on the buffer</span></span><span class="mpre">
</span><a href="#loc_208_1_208_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_1_208_11&#39;)"><span class="mpre">withBuffer</span></a><span class="mpre"> :: (</span><a href="#loc_167_6_167_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_6_167_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_167_6_167_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_6_167_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre">) -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_208_1_208_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_1_208_11&#39;)"><span class="hl_fundecl"><span class="mpre">withBuffer</span></span></a><span class="mpre"> </span><a name="loc_208_12_208_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_12_208_13&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_103_19_103_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_19_103_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_208_28_208_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_28_208_29&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> </span><a name="loc_208_30_208_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_30_208_33&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_208_12_208_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_12_208_13&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_208_30_208_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_30_208_33&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="#loc_208_28_208_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_28_208_29&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_208_1_208_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_1_208_11&#39;)"><span class="mpre">withBuffer</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Get the size of the buffer</span></span><span class="mpre">
</span><a href="#loc_213_1_213_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_1_213_9&#39;)"><span class="mpre">withSize</span></a><span class="mpre"> :: (</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">) -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_213_1_213_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_1_213_9&#39;)"><span class="hl_fundecl"><span class="mpre">withSize</span></span></a><span class="mpre"> </span><a name="loc_213_10_213_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_10_213_11&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_103_19_103_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_19_103_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_213_26_213_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_26_213_27&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> </span><a name="loc_213_28_213_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_28_213_31&#39;)"><span class="hl_specname"><span class="mpre">buf</span></span></a><span class="mpre">@(</span><a href="#loc_167_15_167_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_15_167_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> _ _ _ </span><a name="loc_213_46_213_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_46_213_47&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) -&gt;
    </span><a href="#loc_104_9_104_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_9_104_19&#39;)"><span class="hl_varref"><span class="mpre">runBuilder</span></span></a><span class="mpre"> (</span><a href="#loc_213_10_213_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_10_213_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_213_46_213_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_46_213_47&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">) </span><a href="#loc_213_26_213_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_26_213_27&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_213_28_213_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_28_213_31&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Map the resulting list of bytestrings.</span></span><span class="mpre">
</span><a href="#loc_218_1_218_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_1_218_11&#39;)"><span class="mpre">mapBuilder</span></a><span class="mpre"> :: (</span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre"> -&gt; </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre">) -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_218_1_218_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_1_218_11&#39;)"><span class="hl_fundecl"><span class="mpre">mapBuilder</span></span></a><span class="mpre"> </span><a name="loc_218_12_218_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_12_218_13&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_103_19_103_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_19_103_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> </span><a href="#loc_218_12_218_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_12_218_13&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Ensure that there are at least @n@ many bytes available.</span></span><span class="mpre">
</span><a href="#loc_224_1_224_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_1_224_11&#39;)"><span class="mpre">ensureFree</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_224_1_224_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_1_224_11&#39;)"><span class="hl_fundecl"><span class="mpre">ensureFree</span></span></a><span class="mpre"> </span><a name="loc_224_12_224_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_12_224_13&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><a href="#loc_224_12_224_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_12_224_13&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`seq`</span></span><span class="mpre"> </span><a href="#loc_213_1_213_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_213_1_213_9&#39;)"><span class="hl_varref"><span class="mpre">withSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_224_37_224_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_37_224_38&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> -&gt;
    if </span><a href="#loc_224_12_224_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_12_224_13&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><a href="#loc_224_37_224_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_37_224_38&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> then </span><a href="#loc_124_1_124_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_1_124_6&#39;)"><span class="hl_varref"><span class="mpre">empty</span></span></a><span class="mpre"> else
        </span><a href="#loc_187_1_187_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_1_187_6&#39;)"><span class="hl_varref"><span class="mpre">flush</span></span></a><span class="mpre"> </span><a href="#loc_143_1_143_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_7&#39;)"><span class="hl_infix"><span class="mpre">`append`</span></span></a><span class="mpre"> </span><a href="#loc_208_1_208_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_1_208_11&#39;)"><span class="hl_varref"><span class="mpre">withBuffer</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> (</span><a href="#loc_249_1_249_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_1_249_10&#39;)"><span class="hl_varref"><span class="mpre">newBuffer</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">max</span></span><span class="mpre"> </span><a href="#loc_224_12_224_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_12_224_13&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_200_1_200_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_1_200_12&#39;)"><span class="hl_varref"><span class="mpre">defaultSize</span></span></a><span class="mpre">)))
</span><span class="hl_pragma"><span class="mpre">{-# INLINE [0] </span><a href="#loc_224_1_224_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_1_224_11&#39;)"><span class="mpre">ensureFree</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Ensure that @n@ bytes are available, and then use @f@ to write at</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- most @n@ bytes into memory.  @f@ must return the actual number of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- bytes written.</span></span><span class="mpre">
</span><a href="#loc_233_1_233_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_1_233_12&#39;)"><span class="mpre">writeAtMost</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">) -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_233_1_233_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_1_233_12&#39;)"><span class="hl_fundecl"><span class="mpre">writeAtMost</span></span></a><span class="mpre"> </span><a name="loc_233_13_233_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_13_233_14&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> </span><a name="loc_233_15_233_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_15_233_16&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_224_1_224_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_1_224_11&#39;)"><span class="hl_varref"><span class="mpre">ensureFree</span></span></a><span class="mpre"> </span><a href="#loc_233_13_233_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_13_233_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_143_1_143_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_7&#39;)"><span class="hl_infix"><span class="mpre">`append`</span></span></a><span class="mpre"> </span><a href="#loc_208_1_208_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_1_208_11&#39;)"><span class="hl_varref"><span class="mpre">withBuffer</span></span></a><span class="mpre"> (</span><a href="#loc_243_1_243_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_1_243_12&#39;)"><span class="hl_varref"><span class="mpre">writeBuffer</span></span></a><span class="mpre"> </span><a href="#loc_233_15_233_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_15_233_16&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE [0] </span><a href="#loc_233_1_233_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_1_233_12&#39;)"><span class="mpre">writeAtMost</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Ensure that @n@ bytes are available, and then use @f@ to write</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exactly @n@ bytes into memory.</span></span><span class="mpre">
</span><a href="#loc_239_1_239_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_7&#39;)"><span class="mpre">writeN</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">) -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_239_1_239_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_7&#39;)"><span class="hl_fundecl"><span class="mpre">writeN</span></span></a><span class="mpre"> </span><a name="loc_239_8_239_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_8_239_9&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> </span><a name="loc_239_10_239_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_10_239_11&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_233_1_233_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_1_233_12&#39;)"><span class="hl_varref"><span class="mpre">writeAtMost</span></span></a><span class="mpre"> </span><a href="#loc_239_8_239_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_8_239_9&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> (\ </span><a name="loc_239_31_239_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_31_239_32&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_239_10_239_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_10_239_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_239_31_239_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_31_239_32&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_239_8_239_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_8_239_9&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_239_1_239_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_7&#39;)"><span class="mpre">writeN</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_243_1_243_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_1_243_12&#39;)"><span class="mpre">writeBuffer</span></a><span class="mpre"> :: (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">) -&gt; </span><a href="#loc_167_6_167_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_6_167_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_167_6_167_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_6_167_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre">
</span><a name="loc_243_1_243_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_1_243_12&#39;)"><span class="hl_fundecl"><span class="mpre">writeBuffer</span></span></a><span class="mpre"> </span><a name="loc_243_13_243_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_13_243_14&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> (</span><a href="#loc_167_15_167_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_15_167_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a name="loc_243_23_243_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_23_243_25&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a name="loc_243_26_243_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_26_243_27&#39;)"><span class="hl_vardecl"><span class="mpre">o</span></span></a><span class="mpre"> </span><a name="loc_243_28_243_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_28_243_29&#39;)"><span class="hl_vardecl"><span class="mpre">u</span></span></a><span class="mpre"> </span><a name="loc_243_30_243_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_30_243_31&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">) = do
    </span><a name="loc_244_5_244_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_5_244_6&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> </span><a href="#loc_243_23_243_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_23_243_25&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> (\</span><a name="loc_244_30_244_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_30_244_31&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_243_13_243_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_13_243_14&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> (</span><a href="#loc_244_30_244_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_30_244_31&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> (</span><a href="#loc_243_26_243_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_26_243_27&#39;)"><span class="hl_varref"><span class="mpre">o</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_243_28_243_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_28_243_29&#39;)"><span class="hl_varref"><span class="mpre">u</span></span></a><span class="mpre">)))
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="#loc_167_15_167_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_15_167_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a href="#loc_243_23_243_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_23_243_25&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a href="#loc_243_26_243_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_26_243_27&#39;)"><span class="hl_varref"><span class="mpre">o</span></span></a><span class="mpre"> (</span><a href="#loc_243_28_243_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_28_243_29&#39;)"><span class="hl_varref"><span class="mpre">u</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_244_5_244_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_5_244_6&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">) (</span><a href="#loc_243_30_243_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_30_243_31&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><a href="#loc_244_5_244_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_5_244_6&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_243_1_243_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_243_1_243_12&#39;)"><span class="mpre">writeBuffer</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_249_1_249_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_1_249_10&#39;)"><span class="mpre">newBuffer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_167_6_167_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_6_167_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre">
</span><a name="loc_249_1_249_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_1_249_10&#39;)"><span class="hl_fundecl"><span class="mpre">newBuffer</span></span></a><span class="mpre"> </span><a name="loc_249_11_249_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_11_249_15&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> = do
    </span><a name="loc_250_5_250_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_5_250_7&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> &lt;- </span><a href="Data.ByteString.Internal.html#loc_489_1_489_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_489_1_489_17&#39;)"><span class="hl_varref"><span class="mpre">S.mallocByteString</span></span></a><span class="mpre"> </span><a href="#loc_249_11_249_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_11_249_15&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="#loc_167_15_167_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_15_167_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a href="#loc_250_5_250_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_5_250_7&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_249_11_249_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_11_249_15&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_249_1_249_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_1_249_10&#39;)"><span class="mpre">newBuffer</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- We rely on the fromIntegral to do the right masking for us.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The inlining here is critical, and can be worth 4x performance</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Write a Word16 in big endian format</span></span><span class="mpre">
</span><a href="#loc_263_1_263_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_263_1_263_12&#39;)"><span class="mpre">putWord16be</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word16</span></span><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_263_1_263_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_263_1_263_12&#39;)"><span class="hl_fundecl"><span class="mpre">putWord16be</span></span></a><span class="mpre"> </span><a name="loc_263_13_263_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_263_13_263_14&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> = </span><a href="#loc_239_1_239_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_7&#39;)"><span class="hl_varref"><span class="mpre">writeN</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_263_29_263_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_263_29_263_30&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_263_29_263_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_263_29_263_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">               (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_469_1_469_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_469_1_469_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w16</span></span></a><span class="mpre"> </span><a href="#loc_263_13_263_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_263_13_263_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_263_29_263_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_263_29_263_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_263_13_263_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_263_13_263_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">)              :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_263_1_263_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_263_1_263_12&#39;)"><span class="mpre">putWord16be</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Write a Word16 in little endian format</span></span><span class="mpre">
</span><a href="#loc_270_1_270_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_1_270_12&#39;)"><span class="mpre">putWord16le</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word16</span></span><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_270_1_270_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_1_270_12&#39;)"><span class="hl_fundecl"><span class="mpre">putWord16le</span></span></a><span class="mpre"> </span><a name="loc_270_13_270_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_13_270_14&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> = </span><a href="#loc_239_1_239_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_7&#39;)"><span class="hl_varref"><span class="mpre">writeN</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_270_29_270_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_29_270_30&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_270_29_270_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_29_270_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">               (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_270_13_270_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_13_270_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">)              :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_270_29_270_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_29_270_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_469_1_469_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_469_1_469_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w16</span></span></a><span class="mpre"> </span><a href="#loc_270_13_270_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_13_270_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_270_1_270_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_270_1_270_12&#39;)"><span class="mpre">putWord16le</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- putWord16le w16 = writeN 2 (\p -&gt; poke (castPtr p) w16)</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Write a Word32 in big endian format</span></span><span class="mpre">
</span><a href="#loc_279_1_279_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_1_279_12&#39;)"><span class="mpre">putWord32be</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word32</span></span><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_279_1_279_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_1_279_12&#39;)"><span class="hl_fundecl"><span class="mpre">putWord32be</span></span></a><span class="mpre"> </span><a name="loc_279_13_279_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_13_279_14&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> = </span><a href="#loc_239_1_239_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_7&#39;)"><span class="hl_varref"><span class="mpre">writeN</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">4</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_279_29_279_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_29_279_30&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_279_29_279_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_29_279_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">               (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_279_13_279_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_13_279_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">24</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_279_29_279_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_29_279_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_279_13_279_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_13_279_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_279_29_279_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_29_279_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_279_13_279_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_13_279_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">  </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_279_29_279_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_29_279_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">3</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_279_13_279_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_13_279_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">)               :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_279_1_279_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_1_279_12&#39;)"><span class="mpre">putWord32be</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a data type to tag Put/Check. writes construct these which are then</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- inlined and flattened. matching Checks will be more robust with rules.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Write a Word32 in little endian format</span></span><span class="mpre">
</span><a href="#loc_293_1_293_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_1_293_12&#39;)"><span class="mpre">putWord32le</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word32</span></span><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_293_1_293_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_1_293_12&#39;)"><span class="hl_fundecl"><span class="mpre">putWord32le</span></span></a><span class="mpre"> </span><a name="loc_293_13_293_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_13_293_14&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> = </span><a href="#loc_239_1_239_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_7&#39;)"><span class="hl_varref"><span class="mpre">writeN</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">4</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_293_29_293_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_29_293_30&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_293_29_293_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_29_293_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">               (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_293_13_293_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_13_293_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">)               :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_293_29_293_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_29_293_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_293_13_293_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_13_293_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">  </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_293_29_293_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_29_293_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_293_13_293_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_13_293_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_293_29_293_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_29_293_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">3</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_293_13_293_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_13_293_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">24</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_293_1_293_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_293_1_293_12&#39;)"><span class="mpre">putWord32le</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- on a little endian machine:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- putWord32le w32 = writeN 4 (\p -&gt; poke (castPtr p) w32)</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Write a Word64 in big endian format</span></span><span class="mpre">
</span><a href="#loc_310_1_310_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_310_1_310_12&#39;)"><span class="mpre">putWord64be</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word64</span></span><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
#if WORD_SIZE_IN_BITS &lt; 64
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- To avoid expensive 64 bit shifts on 32 bit machines, we cast to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Word32, and write that</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a name="loc_310_1_310_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_310_1_310_12&#39;)"><span class="hl_fundecl"><span class="mpre">putWord64be</span></span></a><span class="mpre"> </span><a name="loc_310_13_310_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_310_13_310_14&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> =
    let </span><a name="loc_311_9_311_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_9_311_10&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> </span><a href="#loc_310_13_310_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_310_13_310_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">32</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word32</span></span><span class="mpre">
        </span><a name="loc_312_9_312_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_9_312_10&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_310_13_310_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_310_13_310_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">                 :: </span><span class="hl_tyconref"><span class="mpre">Word32</span></span><span class="mpre">
    in </span><a href="#loc_239_1_239_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_7&#39;)"><span class="hl_varref"><span class="mpre">writeN</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_313_20_313_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_20_313_21&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_313_20_313_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_20_313_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">               (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_311_9_311_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_9_311_10&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">24</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_313_20_313_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_20_313_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_311_9_311_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_9_311_10&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_313_20_313_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_20_313_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_311_9_311_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_9_311_10&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">  </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_313_20_313_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_20_313_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">3</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_311_9_311_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_311_9_311_10&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)               :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_313_20_313_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_20_313_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">4</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_312_9_312_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_9_312_10&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">24</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_313_20_313_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_20_313_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">5</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_312_9_312_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_9_312_10&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_313_20_313_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_20_313_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">6</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_312_9_312_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_9_312_10&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">  </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_313_20_313_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_313_20_313_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">7</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_312_9_312_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_9_312_10&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">)               :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
#else
</span><a href="#loc_310_1_310_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_310_1_310_12&#39;)"><span class="hl_fundecl"><span class="mpre">putWord64be</span></span></a><span class="mpre"> </span><a name="loc_323_13_323_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_13_323_14&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> = </span><a href="#loc_239_1_239_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_7&#39;)"><span class="hl_varref"><span class="mpre">writeN</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_323_29_323_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_29_323_30&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_323_29_323_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_29_323_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">               (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> </span><a href="#loc_323_13_323_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_13_323_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">56</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_323_29_323_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_29_323_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> </span><a href="#loc_323_13_323_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_13_323_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">48</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_323_29_323_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_29_323_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> </span><a href="#loc_323_13_323_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_13_323_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">40</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_323_29_323_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_29_323_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">3</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> </span><a href="#loc_323_13_323_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_13_323_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">32</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_323_29_323_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_29_323_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">4</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> </span><a href="#loc_323_13_323_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_13_323_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">24</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_323_29_323_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_29_323_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">5</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> </span><a href="#loc_323_13_323_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_13_323_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_323_29_323_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_29_323_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">6</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> </span><a href="#loc_323_13_323_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_13_323_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">  </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_323_29_323_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_29_323_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">7</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_323_13_323_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_13_323_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">)               :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
#endif
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_310_1_310_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_310_1_310_12&#39;)"><span class="mpre">putWord64be</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Write a Word64 in little endian format</span></span><span class="mpre">
</span><a href="#loc_339_1_339_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_1_339_12&#39;)"><span class="mpre">putWord64le</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word64</span></span><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">

#if WORD_SIZE_IN_BITS &lt; 64
</span><a name="loc_339_1_339_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_1_339_12&#39;)"><span class="hl_fundecl"><span class="mpre">putWord64le</span></span></a><span class="mpre"> </span><a name="loc_339_13_339_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_13_339_14&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> =
    let </span><a name="loc_340_9_340_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_340_9_340_10&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> </span><a href="#loc_339_13_339_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_13_339_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">32</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word32</span></span><span class="mpre">
        </span><a name="loc_341_9_341_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_341_9_341_10&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_339_13_339_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_13_339_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">                 :: </span><span class="hl_tyconref"><span class="mpre">Word32</span></span><span class="mpre">
    in </span><a href="#loc_239_1_239_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_7&#39;)"><span class="hl_varref"><span class="mpre">writeN</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_342_20_342_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_20_342_21&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_342_20_342_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_20_342_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">)             (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_341_9_341_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_341_9_341_10&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)               :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_342_20_342_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_20_342_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_341_9_341_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_341_9_341_10&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">  </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_342_20_342_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_20_342_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_341_9_341_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_341_9_341_10&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_342_20_342_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_20_342_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">3</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_341_9_341_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_341_9_341_10&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">24</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_342_20_342_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_20_342_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">4</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_340_9_340_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_340_9_340_10&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">)               :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_342_20_342_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_20_342_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">5</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_340_9_340_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_340_9_340_10&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">  </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_342_20_342_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_20_342_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">6</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_340_9_340_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_340_9_340_10&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_342_20_342_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_20_342_21&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">7</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> </span><a href="#loc_340_9_340_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_340_9_340_10&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">24</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
#else
</span><a href="#loc_339_1_339_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_1_339_12&#39;)"><span class="hl_fundecl"><span class="mpre">putWord64le</span></span></a><span class="mpre"> </span><a name="loc_352_13_352_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_13_352_14&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> = </span><a href="#loc_239_1_239_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_7&#39;)"><span class="hl_varref"><span class="mpre">writeN</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_352_29_352_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_29_352_30&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; do
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_352_29_352_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_29_352_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">               (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_352_13_352_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_13_352_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">)               :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_352_29_352_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_29_352_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> </span><a href="#loc_352_13_352_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_13_352_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">  </span><span class="hl_num"><span class="mpre">8</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_352_29_352_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_29_352_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> </span><a href="#loc_352_13_352_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_13_352_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_352_29_352_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_29_352_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">3</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> </span><a href="#loc_352_13_352_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_13_352_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">24</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_352_29_352_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_29_352_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">4</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> </span><a href="#loc_352_13_352_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_13_352_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">32</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_352_29_352_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_29_352_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">5</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> </span><a href="#loc_352_13_352_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_13_352_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">40</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_352_29_352_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_29_352_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">6</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> </span><a href="#loc_352_13_352_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_13_352_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">48</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
    </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_352_29_352_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_29_352_30&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">7</span></span><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_varref"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> </span><a href="#loc_352_13_352_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_13_352_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">56</span></span><span class="mpre">) :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
#endif
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_339_1_339_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_1_339_12&#39;)"><span class="mpre">putWord64le</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- on a little endian machine:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- putWord64le w64 = writeN 8 (\p -&gt; poke (castPtr p) w64)</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Unaligned, word size ops</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | /O(1)./ A Builder taking a single native machine word. The word is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- written in host order, host endian form, for the machine you&#39;re on.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- On a 64 bit machine the Word is an 8 byte value, on a 32 bit machine,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 4 bytes. Values written this way are not portable to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- different endian or word sized machines, without conversion.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_377_1_377_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_377_1_377_12&#39;)"><span class="mpre">putWordhost</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word</span></span><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_377_1_377_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_377_1_377_12&#39;)"><span class="hl_fundecl"><span class="mpre">putWordhost</span></span></a><span class="mpre"> </span><a name="loc_377_13_377_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_377_13_377_14&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> =
    </span><a href="#loc_239_1_239_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_7&#39;)"><span class="hl_varref"><span class="mpre">writeN</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word</span></span><span class="mpre">)) (\</span><a name="loc_378_43_378_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_43_378_44&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_378_43_378_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_378_43_378_44&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">) </span><a href="#loc_377_13_377_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_377_13_377_14&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_377_1_377_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_377_1_377_12&#39;)"><span class="mpre">putWordhost</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Write a Word16 in native host order and host endianness.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 2 bytes will be written, unaligned.</span></span><span class="mpre">
</span><a href="#loc_384_1_384_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_1_384_14&#39;)"><span class="mpre">putWord16host</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word16</span></span><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_384_1_384_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_1_384_14&#39;)"><span class="hl_fundecl"><span class="mpre">putWord16host</span></span></a><span class="mpre"> </span><a name="loc_384_15_384_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_15_384_18&#39;)"><span class="hl_vardecl"><span class="mpre">w16</span></span></a><span class="mpre"> =
    </span><a href="#loc_239_1_239_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_7&#39;)"><span class="hl_varref"><span class="mpre">writeN</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word16</span></span><span class="mpre">)) (\</span><a name="loc_385_45_385_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_385_45_385_46&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_385_45_385_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_385_45_385_46&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">) </span><a href="#loc_384_15_384_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_15_384_18&#39;)"><span class="hl_varref"><span class="mpre">w16</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_384_1_384_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_1_384_14&#39;)"><span class="mpre">putWord16host</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Write a Word32 in native host order and host endianness.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 4 bytes will be written, unaligned.</span></span><span class="mpre">
</span><a href="#loc_391_1_391_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_1_391_14&#39;)"><span class="mpre">putWord32host</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word32</span></span><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_391_1_391_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_1_391_14&#39;)"><span class="hl_fundecl"><span class="mpre">putWord32host</span></span></a><span class="mpre"> </span><a name="loc_391_15_391_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_15_391_18&#39;)"><span class="hl_vardecl"><span class="mpre">w32</span></span></a><span class="mpre"> =
    </span><a href="#loc_239_1_239_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_7&#39;)"><span class="hl_varref"><span class="mpre">writeN</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word32</span></span><span class="mpre">)) (\</span><a name="loc_392_45_392_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_392_45_392_46&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_392_45_392_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_392_45_392_46&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">) </span><a href="#loc_391_15_391_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_15_391_18&#39;)"><span class="hl_varref"><span class="mpre">w32</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_391_1_391_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_1_391_14&#39;)"><span class="mpre">putWord32host</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Write a Word64 in native host order.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- On a 32 bit machine we write two host order Word32s, in big endian form.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 8 bytes will be written, unaligned.</span></span><span class="mpre">
</span><a href="#loc_399_1_399_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_399_1_399_14&#39;)"><span class="mpre">putWord64host</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word64</span></span><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_399_1_399_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_399_1_399_14&#39;)"><span class="hl_fundecl"><span class="mpre">putWord64host</span></span></a><span class="mpre"> </span><a name="loc_399_15_399_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_399_15_399_16&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> =
    </span><a href="#loc_239_1_239_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_1_239_7&#39;)"><span class="hl_varref"><span class="mpre">writeN</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word64</span></span><span class="mpre">)) (\</span><a name="loc_400_45_400_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_45_400_46&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_400_45_400_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_45_400_46&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">) </span><a href="#loc_399_15_399_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_399_15_399_16&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_399_1_399_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_399_1_399_14&#39;)"><span class="mpre">putWord64host</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Unicode</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Code lifted from the text package by Bryan O&#39;Sullivan.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Write a character using UTF-8 encoding.</span></span><span class="mpre">
</span><a href="#loc_410_1_410_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_1_410_12&#39;)"><span class="mpre">putCharUtf8</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><a href="#loc_103_9_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_410_1_410_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_1_410_12&#39;)"><span class="hl_fundecl"><span class="mpre">putCharUtf8</span></span></a><span class="mpre"> </span><a name="loc_410_13_410_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_13_410_14&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="#loc_233_1_233_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_233_1_233_12&#39;)"><span class="hl_varref"><span class="mpre">writeAtMost</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">4</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_410_35_410_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_35_410_36&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> -&gt; case </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> of
    _ | </span><a href="#loc_428_7_428_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_7_428_8&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x7F</span></span><span class="mpre">   -&gt; </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_410_35_410_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_35_410_36&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_429_7_429_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_429_7_429_8&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
      | </span><a href="#loc_428_7_428_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_7_428_8&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x07FF</span></span><span class="mpre"> -&gt; do
          </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_410_35_410_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_35_410_36&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_430_8_430_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_430_8_430_10&#39;)"><span class="hl_varref"><span class="mpre">a2</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_410_35_410_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_35_410_36&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_430_11_430_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_430_11_430_13&#39;)"><span class="hl_varref"><span class="mpre">b2</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">
      | </span><a href="#loc_428_7_428_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_7_428_8&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xFFFF</span></span><span class="mpre"> -&gt; do
          </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_410_35_410_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_35_410_36&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_431_8_431_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_8_431_10&#39;)"><span class="hl_varref"><span class="mpre">a3</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_410_35_410_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_35_410_36&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_431_11_431_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_11_431_13&#39;)"><span class="hl_varref"><span class="mpre">b3</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_410_35_410_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_35_410_36&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">) </span><a href="#loc_431_14_431_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_14_431_16&#39;)"><span class="hl_varref"><span class="mpre">c3</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">3</span></span><span class="mpre">
      | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">   -&gt; do
          </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> </span><a href="#loc_410_35_410_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_35_410_36&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_432_8_432_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_432_8_432_10&#39;)"><span class="hl_varref"><span class="mpre">a4</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_410_35_410_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_35_410_36&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_432_11_432_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_432_11_432_13&#39;)"><span class="hl_varref"><span class="mpre">b4</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_410_35_410_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_35_410_36&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">) </span><a href="#loc_432_14_432_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_432_14_432_16&#39;)"><span class="hl_varref"><span class="mpre">c4</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">poke</span></span><span class="mpre"> (</span><a href="#loc_410_35_410_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_35_410_36&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">3</span></span><span class="mpre">) </span><a href="#loc_432_17_432_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_432_17_432_19&#39;)"><span class="hl_varref"><span class="mpre">d4</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">4</span></span><span class="mpre">
  where
      </span><a name="loc_428_7_428_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_7_428_8&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">ord</span></span><span class="mpre"> </span><a href="#loc_410_13_410_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_13_410_14&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
      </span><a name="loc_429_7_429_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_429_7_429_8&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_428_7_428_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_428_7_428_8&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
      (</span><a name="loc_430_8_430_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_430_8_430_10&#39;)"><span class="hl_vardecl"><span class="mpre">a2</span></span></a><span class="mpre">,</span><a name="loc_430_11_430_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_430_11_430_13&#39;)"><span class="hl_vardecl"><span class="mpre">b2</span></span></a><span class="mpre">) = </span><a href="#loc_435_1_435_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_435_1_435_5&#39;)"><span class="hl_varref"><span class="mpre">ord2</span></span></a><span class="mpre"> </span><a href="#loc_410_13_410_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_13_410_14&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
      (</span><a name="loc_431_8_431_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_8_431_10&#39;)"><span class="hl_vardecl"><span class="mpre">a3</span></span></a><span class="mpre">,</span><a name="loc_431_11_431_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_11_431_13&#39;)"><span class="hl_vardecl"><span class="mpre">b3</span></span></a><span class="mpre">,</span><a name="loc_431_14_431_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_14_431_16&#39;)"><span class="hl_vardecl"><span class="mpre">c3</span></span></a><span class="mpre">) = </span><a href="#loc_442_1_442_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_442_1_442_5&#39;)"><span class="hl_varref"><span class="mpre">ord3</span></span></a><span class="mpre"> </span><a href="#loc_410_13_410_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_13_410_14&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
      (</span><a name="loc_432_8_432_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_432_8_432_10&#39;)"><span class="hl_vardecl"><span class="mpre">a4</span></span></a><span class="mpre">,</span><a name="loc_432_11_432_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_432_11_432_13&#39;)"><span class="hl_vardecl"><span class="mpre">b4</span></span></a><span class="mpre">,</span><a name="loc_432_14_432_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_432_14_432_16&#39;)"><span class="hl_vardecl"><span class="mpre">c4</span></span></a><span class="mpre">,</span><a name="loc_432_17_432_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_432_17_432_19&#39;)"><span class="hl_vardecl"><span class="mpre">d4</span></span></a><span class="mpre">) = </span><a href="#loc_450_1_450_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_450_1_450_5&#39;)"><span class="hl_varref"><span class="mpre">ord4</span></span></a><span class="mpre"> </span><a href="#loc_410_13_410_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_410_13_410_14&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">

</span><a href="#loc_435_1_435_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_435_1_435_5&#39;)"><span class="mpre">ord2</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
</span><a name="loc_435_1_435_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_435_1_435_5&#39;)"><span class="hl_fundecl"><span class="mpre">ord2</span></span></a><span class="mpre"> </span><a name="loc_435_6_435_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_435_6_435_7&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = (</span><a href="#loc_438_5_438_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_438_5_438_7&#39;)"><span class="hl_varref"><span class="mpre">x1</span></span></a><span class="mpre">,</span><a href="#loc_439_5_439_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_5_439_7&#39;)"><span class="hl_varref"><span class="mpre">x2</span></span></a><span class="mpre">)
  where
    </span><a name="loc_437_5_437_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_437_5_437_6&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">ord</span></span><span class="mpre"> </span><a href="#loc_435_6_435_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_435_6_435_7&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">
    </span><a name="loc_438_5_438_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_438_5_438_7&#39;)"><span class="hl_vardecl"><span class="mpre">x1</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> (</span><a href="#loc_437_5_437_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_437_5_437_6&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">6</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xC0</span></span><span class="mpre">
    </span><a name="loc_439_5_439_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_5_439_7&#39;)"><span class="hl_vardecl"><span class="mpre">x2</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> (</span><a href="#loc_437_5_437_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_437_5_437_6&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x3F</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x80</span></span><span class="mpre">

</span><a href="#loc_442_1_442_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_442_1_442_5&#39;)"><span class="mpre">ord3</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
</span><a name="loc_442_1_442_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_442_1_442_5&#39;)"><span class="hl_fundecl"><span class="mpre">ord3</span></span></a><span class="mpre"> </span><a name="loc_442_6_442_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_442_6_442_7&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = (</span><a href="#loc_445_5_445_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_445_5_445_7&#39;)"><span class="hl_varref"><span class="mpre">x1</span></span></a><span class="mpre">,</span><a href="#loc_446_5_446_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_446_5_446_7&#39;)"><span class="hl_varref"><span class="mpre">x2</span></span></a><span class="mpre">,</span><a href="#loc_447_5_447_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_5_447_7&#39;)"><span class="hl_varref"><span class="mpre">x3</span></span></a><span class="mpre">)
  where
    </span><a name="loc_444_5_444_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_444_5_444_6&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">ord</span></span><span class="mpre"> </span><a href="#loc_442_6_442_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_442_6_442_7&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">
    </span><a name="loc_445_5_445_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_445_5_445_7&#39;)"><span class="hl_vardecl"><span class="mpre">x1</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> (</span><a href="#loc_444_5_444_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_444_5_444_6&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">12</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xE0</span></span><span class="mpre">
    </span><a name="loc_446_5_446_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_446_5_446_7&#39;)"><span class="hl_vardecl"><span class="mpre">x2</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> ((</span><a href="#loc_444_5_444_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_444_5_444_6&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">6</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x3F</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x80</span></span><span class="mpre">
    </span><a name="loc_447_5_447_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_5_447_7&#39;)"><span class="hl_vardecl"><span class="mpre">x3</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> (</span><a href="#loc_444_5_444_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_444_5_444_6&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x3F</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x80</span></span><span class="mpre">

</span><a href="#loc_450_1_450_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_450_1_450_5&#39;)"><span class="mpre">ord4</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
</span><a name="loc_450_1_450_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_450_1_450_5&#39;)"><span class="hl_fundecl"><span class="mpre">ord4</span></span></a><span class="mpre"> </span><a name="loc_450_6_450_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_450_6_450_7&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = (</span><a href="#loc_453_5_453_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_453_5_453_7&#39;)"><span class="hl_varref"><span class="mpre">x1</span></span></a><span class="mpre">,</span><a href="#loc_454_5_454_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_454_5_454_7&#39;)"><span class="hl_varref"><span class="mpre">x2</span></span></a><span class="mpre">,</span><a href="#loc_455_5_455_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_5_455_7&#39;)"><span class="hl_varref"><span class="mpre">x3</span></span></a><span class="mpre">,</span><a href="#loc_456_5_456_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_456_5_456_7&#39;)"><span class="hl_varref"><span class="mpre">x4</span></span></a><span class="mpre">)
  where
    </span><a name="loc_452_5_452_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_452_5_452_6&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">ord</span></span><span class="mpre"> </span><a href="#loc_450_6_450_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_450_6_450_7&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">
    </span><a name="loc_453_5_453_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_453_5_453_7&#39;)"><span class="hl_vardecl"><span class="mpre">x1</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> (</span><a href="#loc_452_5_452_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_452_5_452_6&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">18</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xF0</span></span><span class="mpre">
    </span><a name="loc_454_5_454_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_454_5_454_7&#39;)"><span class="hl_vardecl"><span class="mpre">x2</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> ((</span><a href="#loc_452_5_452_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_452_5_452_6&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">12</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x3F</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x80</span></span><span class="mpre">
    </span><a name="loc_455_5_455_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_5_455_7&#39;)"><span class="hl_vardecl"><span class="mpre">x3</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> ((</span><a href="#loc_452_5_452_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_452_5_452_6&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_infix"><span class="mpre">`shiftR`</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">6</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x3F</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x80</span></span><span class="mpre">
    </span><a name="loc_456_5_456_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_456_5_456_7&#39;)"><span class="hl_vardecl"><span class="mpre">x4</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> (</span><a href="#loc_452_5_452_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_452_5_452_6&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x3F</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x80</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Unchecked shifts</span></span><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_469_1_469_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_469_1_469_11&#39;)"><span class="mpre">shiftr_w16</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_469_1_469_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_469_1_469_11&#39;)"><span class="mpre">shiftr_w16</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word16</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Word16</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="mpre">shiftr_w32</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="mpre">shiftr_w32</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word32</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Word32</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="mpre">shiftr_w64</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="mpre">shiftr_w64</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word64</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Word64</span></span><span class="mpre">

#if defined(__GLASGOW_HASKELL__) &amp;&amp; !defined(__HADDOCK__)
</span><a name="loc_469_1_469_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_469_1_469_11&#39;)"><span class="hl_fundecl"><span class="mpre">shiftr_w16</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">W16#</span></span><span class="mpre"> </span><a name="loc_469_18_469_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_469_18_469_19&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre">) (</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_469_25_469_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_469_25_469_26&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">W16#</span></span><span class="mpre"> (</span><a href="#loc_469_18_469_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_469_18_469_19&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`uncheckedShiftRL#`</span></span><span class="mpre">   </span><a href="#loc_469_25_469_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_469_25_469_26&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">)
</span><a name="loc_470_1_470_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_1_470_11&#39;)"><span class="hl_fundecl"><span class="mpre">shiftr_w32</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">W32#</span></span><span class="mpre"> </span><a name="loc_470_18_470_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_18_470_19&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre">) (</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_470_25_470_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_25_470_26&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">W32#</span></span><span class="mpre"> (</span><a href="#loc_470_18_470_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_18_470_19&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`uncheckedShiftRL#`</span></span><span class="mpre">   </span><a href="#loc_470_25_470_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_25_470_26&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">)

# if WORD_SIZE_IN_BITS &lt; 64
</span><a name="loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_fundecl"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">W64#</span></span><span class="mpre"> </span><a name="loc_473_18_473_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_18_473_19&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre">) (</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_473_25_473_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_25_473_26&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">W64#</span></span><span class="mpre"> (</span><a href="#loc_473_18_473_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_18_473_19&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`uncheckedShiftRL64#`</span></span><span class="mpre"> </span><a href="#loc_473_25_473_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_25_473_26&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">)
# else
</span><a href="#loc_473_1_473_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_473_1_473_11&#39;)"><span class="hl_fundecl"><span class="mpre">shiftr_w64</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">W64#</span></span><span class="mpre"> </span><a name="loc_475_18_475_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_18_475_19&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre">) (</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_475_25_475_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_25_475_26&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">W64#</span></span><span class="mpre"> (</span><a href="#loc_475_18_475_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_18_475_19&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`uncheckedShiftRL#`</span></span><span class="mpre"> </span><a href="#loc_475_25_475_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_25_475_26&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">)
# endif

#else
</span><span class="hl_vardecl"><span class="mpre">shiftr_w16</span></span><span class="mpre"> = </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_varref"><span class="mpre">shiftR</span></span></a><span class="mpre">
</span><span class="hl_vardecl"><span class="mpre">shiftr_w32</span></span><span class="mpre"> = </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_varref"><span class="mpre">shiftR</span></span></a><span class="mpre">
</span><span class="hl_vardecl"><span class="mpre">shiftr_w64</span></span><span class="mpre"> = </span><a href="Data.Bits.html#loc_226_5_226_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_226_5_226_11&#39;)"><span class="hl_varref"><span class="mpre">shiftR</span></span></a><span class="mpre">
#endif

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Some nice rules for Builder</span></span><span class="mpre">

#if __GLASGOW_HASKELL__ &gt;= 700
</span><span class="hl_comment"><span class="mpre">-- In versions of GHC prior to 7.0 these rules would make GHC believe</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- that &#39;writeN&#39; and &#39;ensureFree&#39; are recursive and the rules wouldn&#39;t</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- fire.</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# RULES

&quot;append/writeAtMost&quot; forall a b (f::Ptr Word8 -&gt; IO Int)
                                (g::Ptr Word8 -&gt; IO Int) ws.
    append (writeAtMost a f) (append (writeAtMost b g) ws) =
        append (writeAtMost (a+b) (\p -&gt; f p &gt;&gt;= \n -&gt;
                                    g (p `plusPtr` n) &gt;&gt;= \m -&gt;
                                    let s = n+m in s `seq` return s)) ws

&quot;writeAtMost/writeAtMost&quot; forall a b (f::Ptr Word8 -&gt; IO Int)
                                     (g::Ptr Word8 -&gt; IO Int).
    append (writeAtMost a f) (writeAtMost b g) =
        writeAtMost (a+b) (\p -&gt; f p &gt;&gt;= \n -&gt;
                            g (p `plusPtr` n) &gt;&gt;= \m -&gt;
                            let s = n+m in s `seq` return s)

&quot;ensureFree/ensureFree&quot; forall a b .
    append (ensureFree a) (ensureFree b) = ensureFree (max a b)

&quot;flush/flush&quot;
    append flush flush = flush

 #-}</span></span><span class="mpre">
#endif
</span></div></body></html>