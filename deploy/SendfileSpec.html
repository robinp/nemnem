<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE OverloadedStrings #-}

module SendfileSpec where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/simple-sendfile-0.2.15/test/SendfileSpec.hs&quot;, srcSpanStartLine = 5, srcSpanStartColumn = 8, srcSpanEndLine = 5, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;Control.Concurrent&quot;"><span class="mpre">Control.Concurrent</span></span><span class="mpre">
import Control.Exception
import Control.Monad
import Control.Monad.Trans.Resource (MonadResource, </span><a href="Control.Monad.Trans.Resource.html#loc_200_1_200_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.Resource.html#loc_200_1_200_13&#39;)"><span class="mpre">runResourceT</span></a><span class="mpre">)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/simple-sendfile-0.2.15/test/SendfileSpec.hs&quot;, srcSpanStartLine = 9, srcSpanStartColumn = 8, srcSpanEndLine = 9, srcSpanEndColumn = 29}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as BS
import Data.Conduit
import Data.Conduit.Binary as CB
import Data.Conduit.List as CL
import Data.Conduit.Network
import Data.IORef
import Network.Sendfile
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/simple-sendfile-0.2.15/test/SendfileSpec.hs&quot;, srcSpanStartLine = 16, srcSpanStartColumn = 8, srcSpanEndLine = 16, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre">
import System.Directory
import System.Exit
import System.IO
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/simple-sendfile-0.2.15/test/SendfileSpec.hs&quot;, srcSpanStartLine = 20, srcSpanStartColumn = 8, srcSpanEndLine = 20, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;System.Posix.Files&quot;"><span class="mpre">System.Posix.Files</span></span><span class="mpre">
import System.Process
import System.Timeout
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/simple-sendfile-0.2.15/test/SendfileSpec.hs&quot;, srcSpanStartLine = 23, srcSpanStartColumn = 8, srcSpanEndLine = 23, srcSpanEndColumn = 18}, srcInfoPoints = []}) &quot;Test.Hspec&quot;"><span class="mpre">Test.Hspec</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_28_1_28_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_1_28_5&#39;)"><span class="mpre">spec</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Spec</span></span><span class="mpre">
</span><a name="loc_28_1_28_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_1_28_5&#39;)"><span class="hl_vardecl"><span class="mpre">spec</span></span></a><span class="mpre"> = do
    </span><span class="hl_varref"><span class="mpre">describe</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;sendfile&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;sends an entire file&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a href="#loc_62_1_62_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_9&#39;)"><span class="hl_varref"><span class="mpre">sendFile</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">EntireFile</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldReturn`</span></span><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_206_5_206_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_206_5_206_16&#39;)"><span class="hl_conref"><span class="mpre">ExitSuccess</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;sends a part of file&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a href="#loc_62_1_62_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_9&#39;)"><span class="hl_varref"><span class="mpre">sendFile</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">PartOfFile</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2000</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1000000</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">`shouldReturn`</span></span><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_206_5_206_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_206_5_206_16&#39;)"><span class="hl_conref"><span class="mpre">ExitSuccess</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;terminates even if length is over&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a href="#loc_57_5_57_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_5_57_20&#39;)"><span class="hl_varref"><span class="mpre">shouldTerminate</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_126_1_126_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_12&#39;)"><span class="hl_varref"><span class="mpre">sendIllegal</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">PartOfFile</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2000</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">5000000</span></span><span class="mpre">)
        </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;terminates even if offset is over&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a href="#loc_57_5_57_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_5_57_20&#39;)"><span class="hl_varref"><span class="mpre">shouldTerminate</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_126_1_126_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_12&#39;)"><span class="hl_varref"><span class="mpre">sendIllegal</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">PartOfFile</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">5000000</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">6000000</span></span><span class="mpre">)
        </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;terminates even if the file is truncated&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a href="#loc_57_5_57_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_5_57_20&#39;)"><span class="hl_varref"><span class="mpre">shouldTerminate</span></span></a><span class="mpre"> </span><a href="#loc_164_1_164_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_1_164_13&#39;)"><span class="hl_varref"><span class="mpre">truncateFile</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">describe</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;sendfileWithHeader&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;sends an header and an entire file&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a href="#loc_65_1_65_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_1_65_10&#39;)"><span class="hl_varref"><span class="mpre">sendFileH</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">EntireFile</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldReturn`</span></span><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_206_5_206_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_206_5_206_16&#39;)"><span class="hl_conref"><span class="mpre">ExitSuccess</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;sends an header and a part of file&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a href="#loc_65_1_65_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_1_65_10&#39;)"><span class="hl_varref"><span class="mpre">sendFileH</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">PartOfFile</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2000</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1000000</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">`shouldReturn`</span></span><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_206_5_206_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_206_5_206_16&#39;)"><span class="hl_conref"><span class="mpre">ExitSuccess</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;sends a large header and an entire file&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a href="#loc_77_1_77_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_1_77_15&#39;)"><span class="hl_varref"><span class="mpre">sendFileHLarge</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">EntireFile</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldReturn`</span></span><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_206_5_206_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_206_5_206_16&#39;)"><span class="hl_conref"><span class="mpre">ExitSuccess</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;sends a large header and a part of file&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a href="#loc_77_1_77_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_1_77_15&#39;)"><span class="hl_varref"><span class="mpre">sendFileHLarge</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">PartOfFile</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2000</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1000000</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">`shouldReturn`</span></span><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_206_5_206_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_206_5_206_16&#39;)"><span class="hl_conref"><span class="mpre">ExitSuccess</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;terminates even if length is over&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a href="#loc_57_5_57_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_5_57_20&#39;)"><span class="hl_varref"><span class="mpre">shouldTerminate</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_129_1_129_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_13&#39;)"><span class="hl_varref"><span class="mpre">sendIllegalH</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">PartOfFile</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">2000</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">5000000</span></span><span class="mpre">)
        </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;terminates even if offset is over&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a href="#loc_57_5_57_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_5_57_20&#39;)"><span class="hl_varref"><span class="mpre">shouldTerminate</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_129_1_129_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_13&#39;)"><span class="hl_varref"><span class="mpre">sendIllegalH</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">PartOfFile</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">5000000</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">6000000</span></span><span class="mpre">)
        </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;terminates even if the file is truncated&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a href="#loc_57_5_57_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_5_57_20&#39;)"><span class="hl_varref"><span class="mpre">shouldTerminate</span></span></a><span class="mpre"> </span><a href="#loc_167_1_167_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_1_167_14&#39;)"><span class="hl_varref"><span class="mpre">truncateFileH</span></span></a><span class="mpre">
  where
    </span><a name="loc_56_5_56_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_5_56_13&#39;)"><span class="hl_vardecl"><span class="mpre">fiveSecs</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">5000000</span></span><span class="mpre">
    </span><a name="loc_57_5_57_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_5_57_20&#39;)"><span class="hl_fundecl"><span class="mpre">shouldTerminate</span></span></a><span class="mpre"> </span><a name="loc_57_21_57_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_21_57_25&#39;)"><span class="hl_vardecl"><span class="mpre">body</span></span></a><span class="mpre"> = </span><a href="System.Timeout.html#loc_79_1_79_8" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Timeout.html#loc_79_1_79_8&#39;)"><span class="hl_varref"><span class="mpre">timeout</span></span></a><span class="mpre"> </span><a href="#loc_56_5_56_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_5_56_13&#39;)"><span class="hl_varref"><span class="mpre">fiveSecs</span></span></a><span class="mpre"> </span><a href="#loc_57_21_57_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_21_57_25&#39;)"><span class="hl_varref"><span class="mpre">body</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldReturn`</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_62_1_62_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_9&#39;)"><span class="mpre">sendFile</span></a><span class="mpre"> :: </span><a href="Network.Sendfile.Types.html#loc_6_6_6_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Sendfile.Types.html#loc_6_6_6_15&#39;)"><span class="hl_tyconref"><span class="mpre">FileRange</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_205_6_205_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_205_6_205_14&#39;)"><span class="hl_tyconref"><span class="mpre">ExitCode</span></span></a><span class="mpre">
</span><a name="loc_62_1_62_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_1_62_9&#39;)"><span class="hl_fundecl"><span class="mpre">sendFile</span></span></a><span class="mpre"> </span><a name="loc_62_10_62_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_10_62_15&#39;)"><span class="hl_vardecl"><span class="mpre">range</span></span></a><span class="mpre"> = </span><a href="#loc_89_1_89_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_1_89_13&#39;)"><span class="hl_varref"><span class="mpre">sendFileCore</span></span></a><span class="mpre"> </span><a href="#loc_62_10_62_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_10_62_15&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre"> []

</span><a href="#loc_65_1_65_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_1_65_10&#39;)"><span class="mpre">sendFileH</span></a><span class="mpre"> :: </span><a href="Network.Sendfile.Types.html#loc_6_6_6_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Sendfile.Types.html#loc_6_6_6_15&#39;)"><span class="hl_tyconref"><span class="mpre">FileRange</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_205_6_205_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_205_6_205_14&#39;)"><span class="hl_tyconref"><span class="mpre">ExitCode</span></span></a><span class="mpre">
</span><a name="loc_65_1_65_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_1_65_10&#39;)"><span class="hl_fundecl"><span class="mpre">sendFileH</span></span></a><span class="mpre"> </span><a name="loc_65_11_65_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_11_65_16&#39;)"><span class="hl_vardecl"><span class="mpre">range</span></span></a><span class="mpre"> = </span><a href="#loc_89_1_89_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_1_89_13&#39;)"><span class="hl_varref"><span class="mpre">sendFileCore</span></span></a><span class="mpre"> </span><a href="#loc_65_11_65_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_11_65_16&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre"> </span><a href="#loc_67_5_67_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_5_67_12&#39;)"><span class="hl_varref"><span class="mpre">headers</span></span></a><span class="mpre">
  where
    </span><a name="loc_67_5_67_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_5_67_12&#39;)"><span class="hl_vardecl"><span class="mpre">headers</span></span></a><span class="mpre"> = [
        </span><span class="hl_varref"><span class="mpre">BS.replicate</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">100</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;a&#39;</span></span><span class="mpre">
      , </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">
      , </span><span class="hl_varref"><span class="mpre">BS.replicate</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">200</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;b&#39;</span></span><span class="mpre">
      , </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">
      , </span><span class="hl_varref"><span class="mpre">BS.replicate</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">300</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;c&#39;</span></span><span class="mpre">
      , </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">
      ]

</span><a href="#loc_77_1_77_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_1_77_15&#39;)"><span class="mpre">sendFileHLarge</span></a><span class="mpre"> :: </span><a href="Network.Sendfile.Types.html#loc_6_6_6_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Sendfile.Types.html#loc_6_6_6_15&#39;)"><span class="hl_tyconref"><span class="mpre">FileRange</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_205_6_205_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_205_6_205_14&#39;)"><span class="hl_tyconref"><span class="mpre">ExitCode</span></span></a><span class="mpre">
</span><a name="loc_77_1_77_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_1_77_15&#39;)"><span class="hl_fundecl"><span class="mpre">sendFileHLarge</span></span></a><span class="mpre"> </span><a name="loc_77_16_77_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_16_77_21&#39;)"><span class="hl_vardecl"><span class="mpre">range</span></span></a><span class="mpre"> = </span><a href="#loc_89_1_89_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_1_89_13&#39;)"><span class="hl_varref"><span class="mpre">sendFileCore</span></span></a><span class="mpre"> </span><a href="#loc_77_16_77_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_16_77_21&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre"> </span><a href="#loc_79_5_79_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_5_79_12&#39;)"><span class="hl_varref"><span class="mpre">headers</span></span></a><span class="mpre">
  where
    </span><a name="loc_79_5_79_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_5_79_12&#39;)"><span class="hl_vardecl"><span class="mpre">headers</span></span></a><span class="mpre"> = [
        </span><span class="hl_varref"><span class="mpre">BS.replicate</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">10000</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;a&#39;</span></span><span class="mpre">
      , </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">
      , </span><span class="hl_varref"><span class="mpre">BS.replicate</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">20000</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;b&#39;</span></span><span class="mpre">
      , </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">
      , </span><span class="hl_varref"><span class="mpre">BS.replicate</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">30000</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;c&#39;</span></span><span class="mpre">
      , </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">
      ]

</span><a href="#loc_89_1_89_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_1_89_13&#39;)"><span class="mpre">sendFileCore</span></a><span class="mpre"> :: </span><a href="Network.Sendfile.Types.html#loc_6_6_6_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Sendfile.Types.html#loc_6_6_6_15&#39;)"><span class="hl_tyconref"><span class="mpre">FileRange</span></span></a><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_205_6_205_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_205_6_205_14&#39;)"><span class="hl_tyconref"><span class="mpre">ExitCode</span></span></a><span class="mpre">
</span><a name="loc_89_1_89_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_1_89_13&#39;)"><span class="hl_fundecl"><span class="mpre">sendFileCore</span></span></a><span class="mpre"> </span><a name="loc_89_14_89_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_14_89_19&#39;)"><span class="hl_vardecl"><span class="mpre">range</span></span></a><span class="mpre"> </span><a name="loc_89_20_89_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_20_89_27&#39;)"><span class="hl_vardecl"><span class="mpre">headers</span></span></a><span class="mpre"> = </span><a href="Control.Exception.Base.html#loc_259_1_259_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_259_1_259_8&#39;)"><span class="hl_varref"><span class="mpre">bracket</span></span></a><span class="mpre"> </span><a href="#loc_105_5_105_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_5_105_10&#39;)"><span class="hl_varref"><span class="mpre">setup</span></span></a><span class="mpre"> </span><a href="#loc_114_5_114_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_5_114_13&#39;)"><span class="hl_varref"><span class="mpre">teardown</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_89_57_89_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_57_89_59&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">,_) -&gt; do
    </span><a href="Control.Monad.Trans.Resource.html#loc_200_1_200_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.Resource.html#loc_200_1_200_13&#39;)"><span class="hl_varref"><span class="mpre">runResourceT</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Conduit.Network.html#loc_61_1_61_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.Network.html#loc_61_1_61_13&#39;)"><span class="hl_varref"><span class="mpre">sourceSocket</span></span></a><span class="mpre"> </span><a href="#loc_89_57_89_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_57_89_59&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre"> </span><a href="Data.Conduit.html#loc_116_5_116_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.html#loc_116_5_116_7&#39;)"><span class="hl_infix"><span class="mpre">$$</span></span></a><span class="mpre"> </span><a href="Data.Conduit.Binary.html#loc_211_1_211_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.Binary.html#loc_211_1_211_9&#39;)"><span class="hl_varref"><span class="mpre">sinkFile</span></span></a><span class="mpre"> </span><a href="#loc_120_5_120_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_5_120_15&#39;)"><span class="hl_varref"><span class="mpre">outputFile</span></span></a><span class="mpre">
    </span><a href="Control.Monad.Trans.Resource.html#loc_200_1_200_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.Resource.html#loc_200_1_200_13&#39;)"><span class="hl_varref"><span class="mpre">runResourceT</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_94_5_94_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_5_94_13&#39;)"><span class="hl_varref"><span class="mpre">copyfile</span></span></a><span class="mpre"> </span><a href="#loc_89_14_89_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_14_89_19&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre">
    </span><a href="System.Process.html#loc_881_1_881_7" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Process.html#loc_881_1_881_7&#39;)"><span class="hl_varref"><span class="mpre">system</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;cmp -s &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_120_5_120_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_5_120_15&#39;)"><span class="hl_varref"><span class="mpre">outputFile</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_121_5_121_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_5_121_17&#39;)"><span class="hl_varref"><span class="mpre">expectedFile</span></span></a><span class="mpre">
  where
    </span><a name="loc_94_5_94_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_5_94_13&#39;)"><span class="hl_fundecl"><span class="mpre">copyfile</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">EntireFile</span></span><span class="mpre"> = do
        </span><span class="hl_comment"><span class="mpre">-- of course, we can use &lt;&gt; here</span></span><span class="mpre">
        </span><a href="Data.Conduit.List.html#loc_115_1_115_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.List.html#loc_115_1_115_11&#39;)"><span class="hl_varref"><span class="mpre">sourceList</span></span></a><span class="mpre"> </span><a href="#loc_89_20_89_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_20_89_27&#39;)"><span class="hl_varref"><span class="mpre">headers</span></span></a><span class="mpre"> </span><a href="Data.Conduit.html#loc_116_5_116_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.html#loc_116_5_116_7&#39;)"><span class="hl_infix"><span class="mpre">$$</span></span></a><span class="mpre"> </span><a href="Data.Conduit.Binary.html#loc_211_1_211_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.Binary.html#loc_211_1_211_9&#39;)"><span class="hl_varref"><span class="mpre">sinkFile</span></span></a><span class="mpre"> </span><a href="#loc_121_5_121_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_5_121_17&#39;)"><span class="hl_varref"><span class="mpre">expectedFile</span></span></a><span class="mpre">
        </span><a href="Data.Conduit.Binary.html#loc_71_1_71_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.Binary.html#loc_71_1_71_11&#39;)"><span class="hl_varref"><span class="mpre">sourceFile</span></span></a><span class="mpre"> </span><a href="#loc_119_5_119_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_5_119_14&#39;)"><span class="hl_varref"><span class="mpre">inputFile</span></span></a><span class="mpre"> </span><a href="Data.Conduit.html#loc_116_5_116_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.html#loc_116_5_116_7&#39;)"><span class="hl_infix"><span class="mpre">$$</span></span></a><span class="mpre"> </span><a href="#loc_218_1_218_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_1_218_15&#39;)"><span class="hl_varref"><span class="mpre">sinkAppendFile</span></span></a><span class="mpre"> </span><a href="#loc_121_5_121_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_5_121_17&#39;)"><span class="hl_varref"><span class="mpre">expectedFile</span></span></a><span class="mpre">
    </span><a href="#loc_94_5_94_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_5_94_13&#39;)"><span class="hl_fundecl"><span class="mpre">copyfile</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">PartOfFile</span></span><span class="mpre"> </span><a name="loc_98_26_98_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_26_98_29&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_98_30_98_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_30_98_33&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">) = do
        </span><a href="Data.Conduit.List.html#loc_115_1_115_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.List.html#loc_115_1_115_11&#39;)"><span class="hl_varref"><span class="mpre">sourceList</span></span></a><span class="mpre"> </span><a href="#loc_89_20_89_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_20_89_27&#39;)"><span class="hl_varref"><span class="mpre">headers</span></span></a><span class="mpre"> </span><a href="Data.Conduit.html#loc_116_5_116_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.html#loc_116_5_116_7&#39;)"><span class="hl_infix"><span class="mpre">$$</span></span></a><span class="mpre"> </span><a href="Data.Conduit.Binary.html#loc_211_1_211_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.Binary.html#loc_211_1_211_9&#39;)"><span class="hl_varref"><span class="mpre">sinkFile</span></span></a><span class="mpre"> </span><a href="#loc_121_5_121_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_5_121_17&#39;)"><span class="hl_varref"><span class="mpre">expectedFile</span></span></a><span class="mpre">
        </span><a href="Data.Conduit.Binary.html#loc_71_1_71_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.Binary.html#loc_71_1_71_11&#39;)"><span class="hl_varref"><span class="mpre">sourceFile</span></span></a><span class="mpre"> </span><a href="#loc_119_5_119_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_5_119_14&#39;)"><span class="hl_varref"><span class="mpre">inputFile</span></span></a><span class="mpre"> </span><a href="Data.Conduit.html#loc_134_14_134_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.html#loc_134_14_134_16&#39;)"><span class="hl_infix"><span class="mpre">$=</span></span></a><span class="mpre"> </span><a href="Data.Conduit.Binary.html#loc_241_1_241_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.Binary.html#loc_241_1_241_8&#39;)"><span class="hl_varref"><span class="mpre">CB.isolate</span></span></a><span class="mpre"> (</span><a href="#loc_103_9_103_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_13&#39;)"><span class="hl_varref"><span class="mpre">off&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_104_9_104_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_9_104_13&#39;)"><span class="hl_varref"><span class="mpre">len&#39;</span></span></a><span class="mpre">)
                             </span><a href="Data.Conduit.html#loc_116_5_116_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.html#loc_116_5_116_7&#39;)"><span class="hl_infix"><span class="mpre">$$</span></span></a><span class="mpre"> (</span><a href="Data.Conduit.Binary.html#loc_305_1_305_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.Binary.html#loc_305_1_305_5&#39;)"><span class="hl_varref"><span class="mpre">CB.take</span></span></a><span class="mpre"> </span><a href="#loc_103_9_103_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_13&#39;)"><span class="hl_varref"><span class="mpre">off&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_218_1_218_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_1_218_15&#39;)"><span class="hl_varref"><span class="mpre">sinkAppendFile</span></span></a><span class="mpre"> </span><a href="#loc_121_5_121_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_5_121_17&#39;)"><span class="hl_varref"><span class="mpre">expectedFile</span></span></a><span class="mpre">)
      where
        </span><a name="loc_103_9_103_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_9_103_13&#39;)"><span class="hl_vardecl"><span class="mpre">off&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_98_26_98_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_26_98_29&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre">
        </span><a name="loc_104_9_104_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_9_104_13&#39;)"><span class="hl_vardecl"><span class="mpre">len&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_98_30_98_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_30_98_33&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
    </span><a name="loc_105_5_105_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_5_105_10&#39;)"><span class="hl_vardecl"><span class="mpre">setup</span></span></a><span class="mpre"> = do
        (</span><a name="loc_106_10_106_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_10_106_12&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">,</span><a name="loc_106_13_106_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_13_106_15&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">) &lt;- </span><span class="hl_varref"><span class="mpre">socketPair</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">AF_UNIX</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Stream</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
        </span><a name="loc_107_9_107_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_12&#39;)"><span class="hl_vardecl"><span class="mpre">tid</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">forkIO</span></span><span class="mpre"> (</span><a href="#loc_110_9_110_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_9_110_11&#39;)"><span class="hl_varref"><span class="mpre">sf</span></span></a><span class="mpre"> </span><a href="#loc_106_10_106_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_10_106_12&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre"> </span><a href="Control.Exception.Base.html#loc_273_3_273_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_273_3_273_12&#39;)"><span class="hl_infix"><span class="mpre">`finally`</span></span></a><span class="mpre"> </span><a href="#loc_113_9_113_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_9_113_16&#39;)"><span class="hl_varref"><span class="mpre">sendEOF</span></span></a><span class="mpre"> </span><a href="#loc_106_10_106_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_10_106_12&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre">)
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_106_13_106_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_13_106_15&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre">,</span><a href="#loc_107_9_107_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_12&#39;)"><span class="hl_varref"><span class="mpre">tid</span></span></a><span class="mpre">)
      where
        </span><a name="loc_110_9_110_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_9_110_11&#39;)"><span class="hl_fundecl"><span class="mpre">sf</span></span></a><span class="mpre"> </span><a name="loc_110_12_110_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_12_110_14&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">
          | </span><a href="#loc_89_20_89_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_20_89_27&#39;)"><span class="hl_varref"><span class="mpre">headers</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> [] = </span><a href="Network.Sendfile.Fallback.html#loc_24_1_24_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Sendfile.Fallback.html#loc_24_1_24_9&#39;)"><span class="hl_varref"><span class="mpre">sendfile</span></span></a><span class="mpre"> </span><a href="#loc_110_12_110_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_12_110_14&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre"> </span><a href="#loc_119_5_119_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_5_119_14&#39;)"><span class="hl_varref"><span class="mpre">inputFile</span></span></a><span class="mpre"> </span><a href="#loc_89_14_89_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_14_89_19&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)
          | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">     = </span><a href="Network.Sendfile.Fallback.html#loc_50_1_50_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Sendfile.Fallback.html#loc_50_1_50_19&#39;)"><span class="hl_varref"><span class="mpre">sendfileWithHeader</span></span></a><span class="mpre"> </span><a href="#loc_110_12_110_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_12_110_14&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre"> </span><a href="#loc_119_5_119_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_5_119_14&#39;)"><span class="hl_varref"><span class="mpre">inputFile</span></span></a><span class="mpre"> </span><a href="#loc_89_14_89_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_14_89_19&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">) </span><a href="#loc_89_20_89_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_20_89_27&#39;)"><span class="hl_varref"><span class="mpre">headers</span></span></a><span class="mpre">
        </span><a name="loc_113_9_113_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_9_113_16&#39;)"><span class="hl_vardecl"><span class="mpre">sendEOF</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">sClose</span></span><span class="mpre">
    </span><a name="loc_114_5_114_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_5_114_13&#39;)"><span class="hl_fundecl"><span class="mpre">teardown</span></span></a><span class="mpre"> (</span><a name="loc_114_15_114_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_15_114_17&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">,</span><a name="loc_114_18_114_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_18_114_21&#39;)"><span class="hl_vardecl"><span class="mpre">tid</span></span></a><span class="mpre">) = do
        </span><span class="hl_varref"><span class="mpre">sClose</span></span><span class="mpre"> </span><a href="#loc_114_15_114_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_15_114_17&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">killThread</span></span><span class="mpre"> </span><a href="#loc_114_18_114_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_18_114_21&#39;)"><span class="hl_varref"><span class="mpre">tid</span></span></a><span class="mpre">
        </span><a href="#loc_211_1_211_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_19&#39;)"><span class="hl_varref"><span class="mpre">removeFileIfExists</span></span></a><span class="mpre"> </span><a href="#loc_120_5_120_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_5_120_15&#39;)"><span class="hl_varref"><span class="mpre">outputFile</span></span></a><span class="mpre">
        </span><a href="#loc_211_1_211_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_19&#39;)"><span class="hl_varref"><span class="mpre">removeFileIfExists</span></span></a><span class="mpre"> </span><a href="#loc_121_5_121_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_5_121_17&#39;)"><span class="hl_varref"><span class="mpre">expectedFile</span></span></a><span class="mpre">
    </span><a name="loc_119_5_119_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_5_119_14&#39;)"><span class="hl_vardecl"><span class="mpre">inputFile</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;test/inputFile&quot;</span></span><span class="mpre">
    </span><a name="loc_120_5_120_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_5_120_15&#39;)"><span class="hl_vardecl"><span class="mpre">outputFile</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;test/outputFile&quot;</span></span><span class="mpre">
    </span><a name="loc_121_5_121_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_5_121_17&#39;)"><span class="hl_vardecl"><span class="mpre">expectedFile</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;test/expectedFile&quot;</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_126_1_126_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_12&#39;)"><span class="mpre">sendIllegal</span></a><span class="mpre"> :: </span><a href="Network.Sendfile.Types.html#loc_6_6_6_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Sendfile.Types.html#loc_6_6_6_15&#39;)"><span class="hl_tyconref"><span class="mpre">FileRange</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_126_1_126_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_12&#39;)"><span class="hl_fundecl"><span class="mpre">sendIllegal</span></span></a><span class="mpre"> </span><a name="loc_126_13_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_13_126_18&#39;)"><span class="hl_vardecl"><span class="mpre">range</span></span></a><span class="mpre"> = </span><a href="#loc_141_1_141_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_1_141_16&#39;)"><span class="hl_varref"><span class="mpre">sendIllegalCore</span></span></a><span class="mpre"> </span><a href="#loc_126_13_126_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_13_126_18&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre"> []

</span><a href="#loc_129_1_129_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_13&#39;)"><span class="mpre">sendIllegalH</span></a><span class="mpre"> :: </span><a href="Network.Sendfile.Types.html#loc_6_6_6_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Sendfile.Types.html#loc_6_6_6_15&#39;)"><span class="hl_tyconref"><span class="mpre">FileRange</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_129_1_129_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_1_129_13&#39;)"><span class="hl_fundecl"><span class="mpre">sendIllegalH</span></span></a><span class="mpre"> </span><a name="loc_129_14_129_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_14_129_19&#39;)"><span class="hl_vardecl"><span class="mpre">range</span></span></a><span class="mpre"> = </span><a href="#loc_141_1_141_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_1_141_16&#39;)"><span class="hl_varref"><span class="mpre">sendIllegalCore</span></span></a><span class="mpre"> </span><a href="#loc_129_14_129_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_14_129_19&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre"> </span><a href="#loc_131_5_131_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_5_131_12&#39;)"><span class="hl_varref"><span class="mpre">headers</span></span></a><span class="mpre">
  where
    </span><a name="loc_131_5_131_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_5_131_12&#39;)"><span class="hl_vardecl"><span class="mpre">headers</span></span></a><span class="mpre"> = [
        </span><span class="hl_varref"><span class="mpre">BS.replicate</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">100</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;a&#39;</span></span><span class="mpre">
      , </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">
      , </span><span class="hl_varref"><span class="mpre">BS.replicate</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">200</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;b&#39;</span></span><span class="mpre">
      , </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">
      , </span><span class="hl_varref"><span class="mpre">BS.replicate</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">300</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;c&#39;</span></span><span class="mpre">
      , </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">
      ]

</span><a href="#loc_141_1_141_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_1_141_16&#39;)"><span class="mpre">sendIllegalCore</span></a><span class="mpre"> :: </span><a href="Network.Sendfile.Types.html#loc_6_6_6_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Sendfile.Types.html#loc_6_6_6_15&#39;)"><span class="hl_tyconref"><span class="mpre">FileRange</span></span></a><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_141_1_141_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_1_141_16&#39;)"><span class="hl_fundecl"><span class="mpre">sendIllegalCore</span></span></a><span class="mpre"> </span><a name="loc_141_17_141_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_17_141_22&#39;)"><span class="hl_vardecl"><span class="mpre">range</span></span></a><span class="mpre"> </span><a name="loc_141_23_141_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_23_141_30&#39;)"><span class="hl_vardecl"><span class="mpre">headers</span></span></a><span class="mpre"> = </span><a href="Control.Exception.Base.html#loc_259_1_259_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_259_1_259_8&#39;)"><span class="hl_varref"><span class="mpre">bracket</span></span></a><span class="mpre"> </span><a href="#loc_145_5_145_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_5_145_10&#39;)"><span class="hl_varref"><span class="mpre">setup</span></span></a><span class="mpre"> </span><a href="#loc_154_5_154_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_5_154_13&#39;)"><span class="hl_varref"><span class="mpre">teardown</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_141_60_141_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_60_141_62&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">,_) -&gt; do
    </span><a href="Control.Monad.Trans.Resource.html#loc_200_1_200_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.Resource.html#loc_200_1_200_13&#39;)"><span class="hl_varref"><span class="mpre">runResourceT</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Conduit.Network.html#loc_61_1_61_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.Network.html#loc_61_1_61_13&#39;)"><span class="hl_varref"><span class="mpre">sourceSocket</span></span></a><span class="mpre"> </span><a href="#loc_141_60_141_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_60_141_62&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre"> </span><a href="Data.Conduit.html#loc_116_5_116_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.html#loc_116_5_116_7&#39;)"><span class="hl_infix"><span class="mpre">$$</span></span></a><span class="mpre"> </span><a href="Data.Conduit.Binary.html#loc_211_1_211_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.Binary.html#loc_211_1_211_9&#39;)"><span class="hl_varref"><span class="mpre">sinkFile</span></span></a><span class="mpre"> </span><a href="#loc_159_5_159_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_5_159_15&#39;)"><span class="hl_varref"><span class="mpre">outputFile</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
  where
    </span><a name="loc_145_5_145_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_5_145_10&#39;)"><span class="hl_vardecl"><span class="mpre">setup</span></span></a><span class="mpre"> = do
        (</span><a name="loc_146_10_146_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_10_146_12&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">,</span><a name="loc_146_13_146_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_13_146_15&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">) &lt;- </span><span class="hl_varref"><span class="mpre">socketPair</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">AF_UNIX</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Stream</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
        </span><a name="loc_147_9_147_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_9_147_12&#39;)"><span class="hl_vardecl"><span class="mpre">tid</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">forkIO</span></span><span class="mpre"> (</span><a href="#loc_150_9_150_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_9_150_11&#39;)"><span class="hl_varref"><span class="mpre">sf</span></span></a><span class="mpre"> </span><a href="#loc_146_10_146_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_10_146_12&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre"> </span><a href="Control.Exception.Base.html#loc_273_3_273_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_273_3_273_12&#39;)"><span class="hl_infix"><span class="mpre">`finally`</span></span></a><span class="mpre"> </span><a href="#loc_153_9_153_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_9_153_16&#39;)"><span class="hl_varref"><span class="mpre">sendEOF</span></span></a><span class="mpre"> </span><a href="#loc_146_10_146_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_10_146_12&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre">)
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_146_13_146_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_13_146_15&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre">,</span><a href="#loc_147_9_147_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_9_147_12&#39;)"><span class="hl_varref"><span class="mpre">tid</span></span></a><span class="mpre">)
      where
        </span><a name="loc_150_9_150_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_9_150_11&#39;)"><span class="hl_fundecl"><span class="mpre">sf</span></span></a><span class="mpre"> </span><a name="loc_150_12_150_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_12_150_14&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">
          | </span><a href="#loc_141_23_141_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_23_141_30&#39;)"><span class="hl_varref"><span class="mpre">headers</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> [] = </span><a href="Network.Sendfile.Fallback.html#loc_24_1_24_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Sendfile.Fallback.html#loc_24_1_24_9&#39;)"><span class="hl_varref"><span class="mpre">sendfile</span></span></a><span class="mpre"> </span><a href="#loc_150_12_150_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_12_150_14&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre"> </span><a href="#loc_158_5_158_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_5_158_14&#39;)"><span class="hl_varref"><span class="mpre">inputFile</span></span></a><span class="mpre"> </span><a href="#loc_141_17_141_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_17_141_22&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)
          | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">     = </span><a href="Network.Sendfile.Fallback.html#loc_50_1_50_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Sendfile.Fallback.html#loc_50_1_50_19&#39;)"><span class="hl_varref"><span class="mpre">sendfileWithHeader</span></span></a><span class="mpre"> </span><a href="#loc_150_12_150_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_12_150_14&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre"> </span><a href="#loc_158_5_158_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_5_158_14&#39;)"><span class="hl_varref"><span class="mpre">inputFile</span></span></a><span class="mpre"> </span><a href="#loc_141_17_141_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_17_141_22&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">) </span><a href="#loc_141_23_141_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_23_141_30&#39;)"><span class="hl_varref"><span class="mpre">headers</span></span></a><span class="mpre">
        </span><a name="loc_153_9_153_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_9_153_16&#39;)"><span class="hl_vardecl"><span class="mpre">sendEOF</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">sClose</span></span><span class="mpre">
    </span><a name="loc_154_5_154_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_5_154_13&#39;)"><span class="hl_fundecl"><span class="mpre">teardown</span></span></a><span class="mpre"> (</span><a name="loc_154_15_154_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_15_154_17&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">,</span><a name="loc_154_18_154_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_18_154_21&#39;)"><span class="hl_vardecl"><span class="mpre">tid</span></span></a><span class="mpre">) = do
        </span><span class="hl_varref"><span class="mpre">sClose</span></span><span class="mpre"> </span><a href="#loc_154_15_154_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_15_154_17&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">killThread</span></span><span class="mpre"> </span><a href="#loc_154_18_154_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_18_154_21&#39;)"><span class="hl_varref"><span class="mpre">tid</span></span></a><span class="mpre">
        </span><a href="#loc_211_1_211_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_19&#39;)"><span class="hl_varref"><span class="mpre">removeFileIfExists</span></span></a><span class="mpre"> </span><a href="#loc_159_5_159_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_5_159_15&#39;)"><span class="hl_varref"><span class="mpre">outputFile</span></span></a><span class="mpre">
    </span><a name="loc_158_5_158_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_5_158_14&#39;)"><span class="hl_vardecl"><span class="mpre">inputFile</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;test/inputFile&quot;</span></span><span class="mpre">
    </span><a name="loc_159_5_159_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_159_5_159_15&#39;)"><span class="hl_vardecl"><span class="mpre">outputFile</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;test/outputFile&quot;</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_164_1_164_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_1_164_13&#39;)"><span class="mpre">truncateFile</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_164_1_164_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_1_164_13&#39;)"><span class="hl_vardecl"><span class="mpre">truncateFile</span></span></a><span class="mpre"> = </span><a href="#loc_179_1_179_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_1_179_17&#39;)"><span class="hl_varref"><span class="mpre">truncateFileCore</span></span></a><span class="mpre"> []

</span><a href="#loc_167_1_167_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_1_167_14&#39;)"><span class="mpre">truncateFileH</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_167_1_167_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_1_167_14&#39;)"><span class="hl_vardecl"><span class="mpre">truncateFileH</span></span></a><span class="mpre"> = </span><a href="#loc_179_1_179_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_1_179_17&#39;)"><span class="hl_varref"><span class="mpre">truncateFileCore</span></span></a><span class="mpre"> </span><a href="#loc_169_5_169_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_5_169_12&#39;)"><span class="hl_varref"><span class="mpre">headers</span></span></a><span class="mpre">
  where
    </span><a name="loc_169_5_169_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_5_169_12&#39;)"><span class="hl_vardecl"><span class="mpre">headers</span></span></a><span class="mpre"> = [
        </span><span class="hl_varref"><span class="mpre">BS.replicate</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">100</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;a&#39;</span></span><span class="mpre">
      , </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">
      , </span><span class="hl_varref"><span class="mpre">BS.replicate</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">200</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;b&#39;</span></span><span class="mpre">
      , </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">
      , </span><span class="hl_varref"><span class="mpre">BS.replicate</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">300</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;c&#39;</span></span><span class="mpre">
      , </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre">
      ]

</span><a href="#loc_179_1_179_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_1_179_17&#39;)"><span class="mpre">truncateFileCore</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_179_1_179_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_1_179_17&#39;)"><span class="hl_fundecl"><span class="mpre">truncateFileCore</span></span></a><span class="mpre"> </span><a name="loc_179_18_179_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_18_179_25&#39;)"><span class="hl_vardecl"><span class="mpre">headers</span></span></a><span class="mpre"> = </span><a href="Control.Exception.Base.html#loc_259_1_259_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_259_1_259_8&#39;)"><span class="hl_varref"><span class="mpre">bracket</span></span></a><span class="mpre"> </span><a href="#loc_183_5_183_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_5_183_10&#39;)"><span class="hl_varref"><span class="mpre">setup</span></span></a><span class="mpre"> </span><a href="#loc_198_5_198_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_5_198_13&#39;)"><span class="hl_varref"><span class="mpre">teardown</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_179_55_179_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_55_179_57&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">,_) -&gt; do
    </span><a href="Control.Monad.Trans.Resource.html#loc_200_1_200_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.Resource.html#loc_200_1_200_13&#39;)"><span class="hl_varref"><span class="mpre">runResourceT</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Conduit.Network.html#loc_61_1_61_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.Network.html#loc_61_1_61_13&#39;)"><span class="hl_varref"><span class="mpre">sourceSocket</span></span></a><span class="mpre"> </span><a href="#loc_179_55_179_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_55_179_57&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre"> </span><a href="Data.Conduit.html#loc_116_5_116_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.html#loc_116_5_116_7&#39;)"><span class="hl_infix"><span class="mpre">$$</span></span></a><span class="mpre"> </span><a href="Data.Conduit.Binary.html#loc_211_1_211_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.Binary.html#loc_211_1_211_9&#39;)"><span class="hl_varref"><span class="mpre">sinkFile</span></span></a><span class="mpre"> </span><a href="#loc_205_5_205_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_5_205_15&#39;)"><span class="hl_varref"><span class="mpre">outputFile</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
  where
    </span><a name="loc_183_5_183_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_5_183_10&#39;)"><span class="hl_vardecl"><span class="mpre">setup</span></span></a><span class="mpre"> = do
        </span><a href="Control.Monad.Trans.Resource.html#loc_200_1_200_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Trans.Resource.html#loc_200_1_200_13&#39;)"><span class="hl_varref"><span class="mpre">runResourceT</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Conduit.Binary.html#loc_71_1_71_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.Binary.html#loc_71_1_71_11&#39;)"><span class="hl_varref"><span class="mpre">sourceFile</span></span></a><span class="mpre"> </span><a href="#loc_203_5_203_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_5_203_14&#39;)"><span class="hl_varref"><span class="mpre">inputFile</span></span></a><span class="mpre"> </span><a href="Data.Conduit.html#loc_116_5_116_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.html#loc_116_5_116_7&#39;)"><span class="hl_infix"><span class="mpre">$$</span></span></a><span class="mpre"> </span><a href="Data.Conduit.Binary.html#loc_211_1_211_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.Binary.html#loc_211_1_211_9&#39;)"><span class="hl_varref"><span class="mpre">sinkFile</span></span></a><span class="mpre"> </span><a href="#loc_204_5_204_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_5_204_13&#39;)"><span class="hl_varref"><span class="mpre">tempFile</span></span></a><span class="mpre">
        (</span><a name="loc_185_10_185_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_10_185_12&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">,</span><a name="loc_185_13_185_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_13_185_15&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">) &lt;- </span><span class="hl_varref"><span class="mpre">socketPair</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">AF_UNIX</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Stream</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
        </span><a name="loc_186_9_186_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_9_186_12&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> (</span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)
        </span><a name="loc_187_9_187_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_9_187_12&#39;)"><span class="hl_vardecl"><span class="mpre">tid</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">forkIO</span></span><span class="mpre"> (</span><a href="#loc_190_9_190_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_9_190_11&#39;)"><span class="hl_varref"><span class="mpre">sf</span></span></a><span class="mpre"> </span><a href="#loc_185_10_185_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_10_185_12&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre"> </span><a href="#loc_186_9_186_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_9_186_12&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> </span><a href="Control.Exception.Base.html#loc_273_3_273_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_273_3_273_12&#39;)"><span class="hl_infix"><span class="mpre">`finally`</span></span></a><span class="mpre"> </span><a href="#loc_193_9_193_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_9_193_16&#39;)"><span class="hl_varref"><span class="mpre">sendEOF</span></span></a><span class="mpre"> </span><a href="#loc_185_10_185_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_10_185_12&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre">)
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_185_13_185_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_13_185_15&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre">,</span><a href="#loc_187_9_187_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_187_9_187_12&#39;)"><span class="hl_varref"><span class="mpre">tid</span></span></a><span class="mpre">)
      where
        </span><a name="loc_190_9_190_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_9_190_11&#39;)"><span class="hl_fundecl"><span class="mpre">sf</span></span></a><span class="mpre"> </span><a name="loc_190_12_190_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_12_190_14&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre"> </span><a name="loc_190_15_190_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_15_190_18&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre">
          | </span><a href="#loc_179_18_179_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_18_179_25&#39;)"><span class="hl_varref"><span class="mpre">headers</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> [] = </span><a href="Network.Sendfile.Fallback.html#loc_24_1_24_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Sendfile.Fallback.html#loc_24_1_24_9&#39;)"><span class="hl_varref"><span class="mpre">sendfile</span></span></a><span class="mpre"> </span><a href="#loc_190_12_190_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_12_190_14&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre"> </span><a href="#loc_204_5_204_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_5_204_13&#39;)"><span class="hl_varref"><span class="mpre">tempFile</span></span></a><span class="mpre"> </span><a href="#loc_206_5_206_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_5_206_10&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre"> (</span><a href="#loc_194_9_194_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_9_194_13&#39;)"><span class="hl_varref"><span class="mpre">hook</span></span></a><span class="mpre"> </span><a href="#loc_190_15_190_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_15_190_18&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">)
          | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">     = </span><a href="Network.Sendfile.Fallback.html#loc_50_1_50_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Sendfile.Fallback.html#loc_50_1_50_19&#39;)"><span class="hl_varref"><span class="mpre">sendfileWithHeader</span></span></a><span class="mpre"> </span><a href="#loc_190_12_190_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_12_190_14&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre"> </span><a href="#loc_204_5_204_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_5_204_13&#39;)"><span class="hl_varref"><span class="mpre">tempFile</span></span></a><span class="mpre"> </span><a href="#loc_206_5_206_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_5_206_10&#39;)"><span class="hl_varref"><span class="mpre">range</span></span></a><span class="mpre"> (</span><a href="#loc_194_9_194_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_9_194_13&#39;)"><span class="hl_varref"><span class="mpre">hook</span></span></a><span class="mpre"> </span><a href="#loc_190_15_190_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_15_190_18&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">) </span><a href="#loc_179_18_179_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_18_179_25&#39;)"><span class="hl_varref"><span class="mpre">headers</span></span></a><span class="mpre">
        </span><a name="loc_193_9_193_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_9_193_16&#39;)"><span class="hl_vardecl"><span class="mpre">sendEOF</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">sClose</span></span><span class="mpre">
        </span><a name="loc_194_9_194_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_9_194_13&#39;)"><span class="hl_fundecl"><span class="mpre">hook</span></span></a><span class="mpre"> </span><a name="loc_194_14_194_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_14_194_17&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> = do
            </span><a name="loc_195_13_195_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_13_195_14&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_194_14_194_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_14_194_17&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre">
            </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_195_13_195_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_13_195_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">10</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">setFileSize</span></span><span class="mpre"> </span><a href="#loc_204_5_204_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_5_204_13&#39;)"><span class="hl_varref"><span class="mpre">tempFile</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">900000</span></span><span class="mpre">
            </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_194_14_194_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_14_194_17&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> (</span><a href="#loc_195_13_195_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_13_195_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
    </span><a name="loc_198_5_198_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_5_198_13&#39;)"><span class="hl_fundecl"><span class="mpre">teardown</span></span></a><span class="mpre"> (</span><a name="loc_198_15_198_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_15_198_17&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">,</span><a name="loc_198_18_198_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_18_198_21&#39;)"><span class="hl_vardecl"><span class="mpre">tid</span></span></a><span class="mpre">) = do
        </span><span class="hl_varref"><span class="mpre">sClose</span></span><span class="mpre"> </span><a href="#loc_198_15_198_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_15_198_17&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">killThread</span></span><span class="mpre"> </span><a href="#loc_198_18_198_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_18_198_21&#39;)"><span class="hl_varref"><span class="mpre">tid</span></span></a><span class="mpre">
        </span><a href="#loc_211_1_211_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_19&#39;)"><span class="hl_varref"><span class="mpre">removeFileIfExists</span></span></a><span class="mpre"> </span><a href="#loc_204_5_204_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_5_204_13&#39;)"><span class="hl_varref"><span class="mpre">tempFile</span></span></a><span class="mpre">
        </span><a href="#loc_211_1_211_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_19&#39;)"><span class="hl_varref"><span class="mpre">removeFileIfExists</span></span></a><span class="mpre"> </span><a href="#loc_205_5_205_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_5_205_15&#39;)"><span class="hl_varref"><span class="mpre">outputFile</span></span></a><span class="mpre">
    </span><a name="loc_203_5_203_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_5_203_14&#39;)"><span class="hl_vardecl"><span class="mpre">inputFile</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;test/inputFile&quot;</span></span><span class="mpre">
    </span><a name="loc_204_5_204_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_5_204_13&#39;)"><span class="hl_vardecl"><span class="mpre">tempFile</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;test/tempFile&quot;</span></span><span class="mpre">
    </span><a name="loc_205_5_205_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_5_205_15&#39;)"><span class="hl_vardecl"><span class="mpre">outputFile</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;test/outputFile&quot;</span></span><span class="mpre">
    </span><a name="loc_206_5_206_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_5_206_10&#39;)"><span class="hl_vardecl"><span class="mpre">range</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">EntireFile</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">----------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_211_1_211_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_19&#39;)"><span class="mpre">removeFileIfExists</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_211_1_211_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_19&#39;)"><span class="hl_fundecl"><span class="mpre">removeFileIfExists</span></span></a><span class="mpre"> </span><a name="loc_211_20_211_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_20_211_24&#39;)"><span class="hl_vardecl"><span class="mpre">file</span></span></a><span class="mpre"> = do
    </span><a name="loc_212_5_212_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_5_212_10&#39;)"><span class="hl_vardecl"><span class="mpre">exist</span></span></a><span class="mpre"> &lt;- </span><a href="System.Directory.html#loc_726_1_726_14" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_726_1_726_14&#39;)"><span class="hl_varref"><span class="mpre">doesFileExist</span></span></a><span class="mpre"> </span><a href="#loc_211_20_211_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_20_211_24&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre">
    </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_212_5_212_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_212_5_212_10&#39;)"><span class="hl_varref"><span class="mpre">exist</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="System.Directory.html#loc_400_1_400_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.Directory.html#loc_400_1_400_11&#39;)"><span class="hl_varref"><span class="mpre">removeFile</span></span></a><span class="mpre"> </span><a href="#loc_211_20_211_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_20_211_24&#39;)"><span class="hl_varref"><span class="mpre">file</span></span></a><span class="mpre">

</span><a href="#loc_218_1_218_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_1_218_15&#39;)"><span class="mpre">sinkAppendFile</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/simple-sendfile-0.2.15/test/SendfileSpec.hs&quot;, srcSpanStartLine = 215, srcSpanStartColumn = 19, srcSpanEndLine = 216, srcSpanEndColumn = 21}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/simple-sendfile-0.2.15/test/SendfileSpec.hs&quot;, srcSpanStartLine = 216, srcSpanStartColumn = 19, srcSpanEndLine = 216, srcSpanEndColumn = 21}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem"><span class="mpre">MonadResource m
                  =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre">
                  -&gt; </span><span class="hl_tyconref"><span class="mpre">Sink</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_218_1_218_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_1_218_15&#39;)"><span class="hl_fundecl"><span class="mpre">sinkAppendFile</span></span></a><span class="mpre"> </span><a name="loc_218_16_218_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_16_218_18&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> = </span><a href="Data.Conduit.Binary.html#loc_154_1_154_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Conduit.Binary.html#loc_154_1_154_13&#39;)"><span class="hl_varref"><span class="mpre">sinkIOHandle</span></span></a><span class="mpre"> (</span><a href="GHC.IO.Handle.FD.html#loc_177_1_177_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.FD.html#loc_177_1_177_15&#39;)"><span class="hl_varref"><span class="mpre">openBinaryFile</span></span></a><span class="mpre"> </span><a href="#loc_218_16_218_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_16_218_18&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a href="GHC.IO.IOMode.html#loc_28_44_28_54" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.IOMode.html#loc_28_44_28_54&#39;)"><span class="hl_conref"><span class="mpre">AppendMode</span></span></a><span class="mpre">)
</span></div></body></html>