<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Trustworthy #-}
{-# LANGUAGE BangPatterns, NoImplicitPrelude #-}
module GHC.Event.Thread
    ( getSystemEventManager
    , getSystemTimerManager
    , ensureIOManagerIsRunning
    , ioManagerCapabilitiesChanged
    , threadWaitRead
    , threadWaitWrite
    , threadWaitReadSTM
    , threadWaitWriteSTM
    , closeFdWith
    , threadDelay
    , registerDelay
    ) where

import Control.Exception (</span><a href="Control.Exception.Base.html#loc_273_3_273_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_273_3_273_12&#39;)"><span class="mpre">finally</span></a><span class="mpre">)
import Control.Monad (</span><a href="Control.Monad.html#loc_163_1_163_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_163_1_163_5&#39;)"><span class="mpre">forM</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_168_1_168_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_168_1_168_6&#39;)"><span class="mpre">forM_</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_106_1_106_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_106_1_106_10&#39;)"><span class="mpre">sequence_</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_214_1_214_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_214_1_214_9&#39;)"><span class="mpre">zipWithM</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="mpre">when</span></a><span class="mpre">)
import Data.IORef (</span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="mpre">IORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="mpre">newIORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="mpre">readIORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="mpre">writeIORef</span></a><span class="mpre">)
import Data.List (zipWith3)
import Data.Maybe (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="mpre">Maybe</span></a><span class="mpre">(..))
import Data.Tuple (</span><a href="Data.Tuple.html#loc_52_1_52_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Tuple.html#loc_52_1_52_4&#39;)"><span class="mpre">snd</span></a><span class="mpre">)
import Foreign.C.Error (</span><a href="Foreign.C.Error.html#loc_148_1_148_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.C.Error.html#loc_148_1_148_6&#39;)"><span class="mpre">eBADF</span></a><span class="mpre">, </span><a href="Foreign.C.Error.html#loc_467_1_467_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.C.Error.html#loc_467_1_467_15&#39;)"><span class="mpre">errnoToIOError</span></a><span class="mpre">)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 8, srcSpanEndLine = 24, srcSpanEndColumn = 19}, srcInfoPoints = []}) &quot;Foreign.Ptr&quot;"><span class="mpre">Foreign.Ptr</span></span><span class="mpre"> (Ptr)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 25, srcSpanStartColumn = 8, srcSpanEndLine = 25, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 26, srcSpanStartColumn = 8, srcSpanEndLine = 26, srcSpanEndColumn = 21}, srcInfoPoints = []}) &quot;GHC.Conc.Sync&quot;"><span class="mpre">GHC.Conc.Sync</span></span><span class="mpre"> (TVar, ThreadId, ThreadStatus(..), atomically, forkIO,
                      labelThread, modifyMVar_, withMVar, newTVar, sharedCAF,
                      getNumCapabilities, threadCapability, myThreadId, forkOn,
                      threadStatus, writeTVar, newTVarIO, readTVar, retry,throwSTM,STM)
import GHC.IO (</span><a href="GHC.IO.html#loc_426_1_426_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_426_1_426_6&#39;)"><span class="mpre">mask_</span></a><span class="mpre">, </span><a href="GHC.IO.html#loc_360_1_360_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_360_1_360_12&#39;)"><span class="mpre">onException</span></a><span class="mpre">)
import GHC.IO.Exception (</span><a href="GHC.IO.Exception.html#loc_221_1_221_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_221_1_221_8&#39;)"><span class="mpre">ioError</span></a><span class="mpre">)
import GHC.IOArray (</span><a href="GHC.IOArray.html#loc_42_9_42_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_42_9_42_16&#39;)"><a href="GHC.IOArray.html#loc_42_23_42_30" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_42_23_42_30&#39;)"><span class="mpre">IOArray</span></a></a><span class="mpre">, </span><a href="GHC.IOArray.html#loc_51_1_51_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_51_1_51_11&#39;)"><span class="mpre">newIOArray</span></a><span class="mpre">, </span><a href="GHC.IOArray.html#loc_65_1_65_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_65_1_65_12&#39;)"><span class="mpre">readIOArray</span></a><span class="mpre">, </span><a href="GHC.IOArray.html#loc_69_1_69_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_69_1_69_13&#39;)"><span class="mpre">writeIOArray</span></a><span class="mpre">,
                    </span><a href="GHC.IOArray.html#loc_73_1_73_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_73_1_73_14&#39;)"><span class="mpre">boundsIOArray</span></a><span class="mpre">)
import GHC.MVar (</span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><a href="GHC.MVar.html#loc_39_15_39_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_15_39_19&#39;)"><span class="mpre">MVar</span></a></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_64_1_64_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_64_1_64_13&#39;)"><span class="mpre">newEmptyMVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="mpre">newMVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="mpre">putMVar</span></a><span class="mpre">, </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="mpre">takeMVar</span></a><span class="mpre">)
import GHC.Event.Internal (</span><a href="GHC.Event.Internal.html#loc_60_1_60_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_60_1_60_8&#39;)"><span class="mpre">eventIs</span></a><span class="mpre">, </span><a href="GHC.Event.Internal.html#loc_56_1_56_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_56_1_56_9&#39;)"><span class="mpre">evtClose</span></a><span class="mpre">)
import GHC.Event.Manager (</span><a href="GHC.Event.Internal.html#loc_37_9_37_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_37_9_37_14&#39;)"><span class="mpre">Event</span></a><span class="mpre">, </span><a href="GHC.Event.Manager.html#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_114_6_114_18&#39;)"><span class="mpre">EventManager</span></a><span class="mpre">, </span><a href="GHC.Event.Internal.html#loc_46_1_46_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_46_1_46_8&#39;)"><span class="mpre">evtRead</span></a><span class="mpre">, </span><a href="GHC.Event.Internal.html#loc_51_1_51_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_51_1_51_9&#39;)"><span class="mpre">evtWrite</span></a><span class="mpre">, </span><a href="GHC.Event.Manager.html#loc_241_1_241_5" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_241_1_241_5&#39;)"><span class="mpre">loop</span></a><span class="mpre">,
                             </span><a href="GHC.Event.Manager.html#loc_169_1_169_4" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_169_1_169_4&#39;)"><span class="mpre">new</span></a><span class="mpre">, </span><a href="GHC.Event.Manager.html#loc_339_1_339_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_339_1_339_11&#39;)"><span class="mpre">registerFd</span></a><span class="mpre">, </span><a href="GHC.Event.Manager.html#loc_371_1_371_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_371_1_371_14&#39;)"><span class="mpre">unregisterFd_</span></a><span class="mpre">)
import qualified GHC.Event.Manager as M
import qualified GHC.Event.TimerManager as TM
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 40, srcSpanStartColumn = 8, srcSpanEndLine = 40, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;GHC.Num&quot;"><span class="mpre">GHC.Num</span></span><span class="mpre"> ((-), (+))
import System.IO.Unsafe (</span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="mpre">unsafePerformIO</span></a><span class="mpre">)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 42, srcSpanStartColumn = 8, srcSpanEndLine = 42, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;System.Posix.Types&quot;"><span class="mpre">System.Posix.Types</span></span><span class="mpre"> (Fd)

</span><span class="hl_comment"><span class="mpre">-- | Suspends the current thread for a given number of microseconds</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (GHC only).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- There is no guarantee that the thread will be rescheduled promptly</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- when the delay has expired, but the thread will never continue to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- run /earlier/ than specified.</span></span><span class="mpre">
</span><a href="#loc_51_1_51_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_12&#39;)"><span class="mpre">threadDelay</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_51_1_51_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_1_51_12&#39;)"><span class="hl_fundecl"><span class="mpre">threadDelay</span></span></a><span class="mpre"> </span><a name="loc_51_13_51_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_13_51_18&#39;)"><span class="hl_vardecl"><span class="mpre">usecs</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_426_1_426_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_426_1_426_6&#39;)"><span class="hl_varref"><span class="mpre">mask_</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
  </span><a name="loc_52_3_52_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_3_52_6&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_206_1_206_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_1_206_22&#39;)"><span class="hl_varref"><span class="mpre">getSystemTimerManager</span></span></a><span class="mpre">
  </span><a name="loc_53_3_53_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_3_53_4&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_64_1_64_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_64_1_64_13&#39;)"><span class="hl_varref"><span class="mpre">newEmptyMVar</span></span></a><span class="mpre">
  </span><a name="loc_54_3_54_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_3_54_6&#39;)"><span class="hl_vardecl"><span class="mpre">reg</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.Event.TimerManager.html#loc_241_1_241_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.TimerManager.html#loc_241_1_241_16&#39;)"><span class="hl_varref"><span class="mpre">TM.registerTimeout</span></span></a><span class="mpre"> </span><a href="#loc_52_3_52_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_3_52_6&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_51_13_51_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_51_13_51_18&#39;)"><span class="hl_varref"><span class="mpre">usecs</span></span></a><span class="mpre"> (</span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_53_3_53_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_3_53_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)
  </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="hl_varref"><span class="mpre">takeMVar</span></span></a><span class="mpre"> </span><a href="#loc_53_3_53_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_3_53_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="GHC.IO.html#loc_360_1_360_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_360_1_360_12&#39;)"><span class="hl_infix"><span class="mpre">`onException`</span></span></a><span class="mpre"> </span><a href="GHC.Event.TimerManager.html#loc_254_1_254_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.TimerManager.html#loc_254_1_254_18&#39;)"><span class="hl_varref"><span class="mpre">TM.unregisterTimeout</span></span></a><span class="mpre"> </span><a href="#loc_52_3_52_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_3_52_6&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_54_3_54_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_3_54_6&#39;)"><span class="hl_varref"><span class="mpre">reg</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Set the value of returned TVar to True after a given number of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- microseconds. The caveats associated with threadDelay also apply.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_61_1_61_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_14&#39;)"><span class="mpre">registerDelay</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">TVar</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">)
</span><a name="loc_61_1_61_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_14&#39;)"><span class="hl_fundecl"><span class="mpre">registerDelay</span></span></a><span class="mpre"> </span><a name="loc_61_15_61_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_15_61_20&#39;)"><span class="hl_vardecl"><span class="mpre">usecs</span></span></a><span class="mpre"> = do
  </span><a name="loc_62_3_62_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_3_62_4&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">atomically</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">newTVar</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
  </span><a name="loc_63_3_63_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_3_63_6&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_206_1_206_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_1_206_22&#39;)"><span class="hl_varref"><span class="mpre">getSystemTimerManager</span></span></a><span class="mpre">
  _ &lt;- </span><a href="GHC.Event.TimerManager.html#loc_241_1_241_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.TimerManager.html#loc_241_1_241_16&#39;)"><span class="hl_varref"><span class="mpre">TM.registerTimeout</span></span></a><span class="mpre"> </span><a href="#loc_63_3_63_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_3_63_6&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_61_15_61_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_15_61_20&#39;)"><span class="hl_varref"><span class="mpre">usecs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">atomically</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_62_3_62_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_3_62_4&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_62_3_62_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_3_62_4&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Block the current thread until data is available to read from the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- given file descriptor.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This will throw an &#39;IOError&#39; if the file descriptor was closed</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- while this thread was blocked.  To safely close a file descriptor</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- that has been used with &#39;threadWaitRead&#39;, use &#39;closeFdWith&#39;.</span></span><span class="mpre">
</span><a href="#loc_74_1_74_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_15&#39;)"><span class="mpre">threadWaitRead</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_74_1_74_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_15&#39;)"><span class="hl_vardecl"><span class="mpre">threadWaitRead</span></span></a><span class="mpre"> = </span><a href="#loc_109_1_109_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_1_109_11&#39;)"><span class="hl_varref"><span class="mpre">threadWait</span></span></a><span class="mpre"> </span><a href="GHC.Event.Internal.html#loc_46_1_46_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_46_1_46_8&#39;)"><span class="hl_varref"><span class="mpre">evtRead</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_74_1_74_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_1_74_15&#39;)"><span class="mpre">threadWaitRead</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Block the current thread until the given file descriptor can</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- accept data to write.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This will throw an &#39;IOError&#39; if the file descriptor was closed</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- while this thread was blocked.  To safely close a file descriptor</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- that has been used with &#39;threadWaitWrite&#39;, use &#39;closeFdWith&#39;.</span></span><span class="mpre">
</span><a href="#loc_84_1_84_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_16&#39;)"><span class="mpre">threadWaitWrite</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_84_1_84_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_16&#39;)"><span class="hl_vardecl"><span class="mpre">threadWaitWrite</span></span></a><span class="mpre"> = </span><a href="#loc_109_1_109_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_1_109_11&#39;)"><span class="hl_varref"><span class="mpre">threadWait</span></span></a><span class="mpre"> </span><a href="GHC.Event.Internal.html#loc_51_1_51_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_51_1_51_9&#39;)"><span class="hl_varref"><span class="mpre">evtWrite</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_84_1_84_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_16&#39;)"><span class="mpre">threadWaitWrite</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Close a file descriptor in a concurrency-safe way.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Any threads that are blocked on the file descriptor via</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;threadWaitRead&#39; or &#39;threadWaitWrite&#39; will be unblocked by having</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- IO exceptions thrown.</span></span><span class="mpre">
</span><a href="#loc_95_1_95_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_1_95_12&#39;)"><span class="mpre">closeFdWith</span></a><span class="mpre"> :: (</span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)        </span><span class="hl_comment"><span class="mpre">-- ^ Action that performs the close.</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre">                   </span><span class="hl_comment"><span class="mpre">-- ^ File descriptor to close.</span></span><span class="mpre">
            -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_95_1_95_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_1_95_12&#39;)"><span class="hl_fundecl"><span class="mpre">closeFdWith</span></span></a><span class="mpre"> </span><a name="loc_95_13_95_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_13_95_18&#39;)"><span class="hl_vardecl"><span class="mpre">close</span></span></a><span class="mpre"> </span><a name="loc_95_19_95_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_19_95_21&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> = do
  </span><a name="loc_96_3_96_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_3_96_20&#39;)"><span class="hl_vardecl"><span class="mpre">eventManagerArray</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_182_1_182_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_13&#39;)"><span class="hl_varref"><span class="mpre">eventManager</span></span></a><span class="mpre">
  let (</span><span class="hl_vardecl"><span class="mpre">low</span></span><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">high</span></span><span class="mpre">) = </span><a href="GHC.IOArray.html#loc_73_1_73_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_73_1_73_14&#39;)"><span class="hl_varref"><span class="mpre">boundsIOArray</span></span></a><span class="mpre"> </span><a href="#loc_96_3_96_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_3_96_20&#39;)"><span class="hl_varref"><span class="mpre">eventManagerArray</span></span></a><span class="mpre">
  </span><a name="loc_98_3_98_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_3_98_7&#39;)"><span class="hl_vardecl"><span class="mpre">mgrs</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.html#loc_163_1_163_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_163_1_163_5&#39;)"><span class="hl_varref"><span class="mpre">forM</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpEnumFromTo (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 98, srcSpanStartColumn = 16, srcSpanEndLine = 98, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 98, srcSpanStartColumn = 16, srcSpanEndLine = 98, srcSpanEndColumn = 17},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 98,"><span class="mpre">[low..high]</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_98_31_98_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_31_98_32&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> -&gt; do
    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (_,!</span><a name="loc_99_14_99_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_14_99_17&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre">) &lt;- </span><a href="GHC.IOArray.html#loc_65_1_65_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_65_1_65_12&#39;)"><span class="hl_varref"><span class="mpre">readIOArray</span></span></a><span class="mpre"> </span><a href="#loc_96_3_96_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_3_96_20&#39;)"><span class="hl_varref"><span class="mpre">eventManagerArray</span></span></a><span class="mpre"> </span><a href="#loc_98_31_98_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_31_98_32&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_99_14_99_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_14_99_17&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">
  </span><a href="GHC.IO.html#loc_426_1_426_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_426_1_426_6&#39;)"><span class="hl_varref"><span class="mpre">mask_</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a name="loc_102_5_102_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_5_102_11&#39;)"><span class="hl_vardecl"><span class="mpre">tables</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.html#loc_163_1_163_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_163_1_163_5&#39;)"><span class="hl_varref"><span class="mpre">forM</span></span></a><span class="mpre"> </span><a href="#loc_98_3_98_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_3_98_7&#39;)"><span class="hl_varref"><span class="mpre">mgrs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_102_28_102_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_28_102_31&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="hl_varref"><span class="mpre">takeMVar</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.Event.Manager.html#loc_133_1_133_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_133_1_133_17&#39;)"><span class="hl_varref"><span class="mpre">M.callbackTableVar</span></span></a><span class="mpre"> </span><a href="#loc_102_28_102_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_28_102_31&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_95_19_95_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_19_95_21&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">
    </span><a name="loc_103_5_103_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_5_103_11&#39;)"><span class="hl_vardecl"><span class="mpre">cbApps</span></span></a><span class="mpre"> &lt;- </span><a href="Control.Monad.html#loc_214_1_214_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_214_1_214_9&#39;)"><span class="hl_varref"><span class="mpre">zipWithM</span></span></a><span class="mpre"> (\</span><a name="loc_103_26_103_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_26_103_29&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a name="loc_103_30_103_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_30_103_35&#39;)"><span class="hl_vardecl"><span class="mpre">table</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.Event.Manager.html#loc_417_1_417_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_417_1_417_9&#39;)"><span class="hl_varref"><span class="mpre">M.closeFd_</span></span></a><span class="mpre"> </span><a href="#loc_103_26_103_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_26_103_29&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_103_30_103_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_30_103_35&#39;)"><span class="hl_varref"><span class="mpre">table</span></span></a><span class="mpre"> </span><a href="#loc_95_19_95_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_19_95_21&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">) </span><a href="#loc_98_3_98_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_3_98_7&#39;)"><span class="hl_varref"><span class="mpre">mgrs</span></span></a><span class="mpre"> </span><a href="#loc_102_5_102_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_5_102_11&#39;)"><span class="hl_varref"><span class="mpre">tables</span></span></a><span class="mpre">
    </span><a href="#loc_95_13_95_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_13_95_18&#39;)"><span class="hl_varref"><span class="mpre">close</span></span></a><span class="mpre"> </span><a href="#loc_95_19_95_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_19_95_21&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="Control.Exception.Base.html#loc_273_3_273_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_273_3_273_12&#39;)"><span class="hl_infix"><span class="mpre">`finally`</span></span></a><span class="mpre"> </span><a href="Control.Monad.html#loc_106_1_106_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_106_1_106_10&#39;)"><span class="hl_varref"><span class="mpre">sequence_</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">zipWith3</span></span><span class="mpre"> </span><a href="#loc_106_5_106_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_5_106_11&#39;)"><span class="hl_varref"><span class="mpre">finish</span></span></a><span class="mpre"> </span><a href="#loc_98_3_98_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_3_98_7&#39;)"><span class="hl_varref"><span class="mpre">mgrs</span></span></a><span class="mpre"> </span><a href="#loc_102_5_102_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_5_102_11&#39;)"><span class="hl_varref"><span class="mpre">tables</span></span></a><span class="mpre"> </span><a href="#loc_103_5_103_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_5_103_11&#39;)"><span class="hl_varref"><span class="mpre">cbApps</span></span></a><span class="mpre">)
  where
    </span><a name="loc_106_5_106_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_5_106_11&#39;)"><span class="hl_fundecl"><span class="mpre">finish</span></span></a><span class="mpre"> </span><a name="loc_106_12_106_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_12_106_15&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a name="loc_106_16_106_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_16_106_21&#39;)"><span class="hl_vardecl"><span class="mpre">table</span></span></a><span class="mpre"> </span><a name="loc_106_22_106_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_22_106_27&#39;)"><span class="hl_vardecl"><span class="mpre">cbApp</span></span></a><span class="mpre"> = </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> (</span><a href="GHC.Event.Manager.html#loc_133_1_133_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_133_1_133_17&#39;)"><span class="hl_varref"><span class="mpre">M.callbackTableVar</span></span></a><span class="mpre"> </span><a href="#loc_106_12_106_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_12_106_15&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_95_19_95_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_19_95_21&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">) </span><a href="#loc_106_16_106_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_16_106_21&#39;)"><span class="hl_varref"><span class="mpre">table</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_106_22_106_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_22_106_27&#39;)"><span class="hl_varref"><span class="mpre">cbApp</span></span></a><span class="mpre">

</span><a href="#loc_109_1_109_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_1_109_11&#39;)"><span class="mpre">threadWait</span></a><span class="mpre"> :: </span><a href="GHC.Event.Internal.html#loc_37_9_37_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_37_9_37_14&#39;)"><span class="hl_tyconref"><span class="mpre">Event</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_109_1_109_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_1_109_11&#39;)"><span class="hl_fundecl"><span class="mpre">threadWait</span></span></a><span class="mpre"> </span><a name="loc_109_12_109_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_12_109_15&#39;)"><span class="hl_vardecl"><span class="mpre">evt</span></span></a><span class="mpre"> </span><a name="loc_109_16_109_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_16_109_18&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_426_1_426_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_426_1_426_6&#39;)"><span class="hl_varref"><span class="mpre">mask_</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
  </span><a name="loc_110_3_110_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_3_110_4&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_64_1_64_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_64_1_64_13&#39;)"><span class="hl_varref"><span class="mpre">newEmptyMVar</span></span></a><span class="mpre">
  </span><a name="loc_111_3_111_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_3_111_6&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_173_1_173_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_1_173_23&#39;)"><span class="hl_varref"><span class="mpre">getSystemEventManager_</span></span></a><span class="mpre">
  </span><a name="loc_112_3_112_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_3_112_6&#39;)"><span class="hl_vardecl"><span class="mpre">reg</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.Event.Manager.html#loc_339_1_339_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_339_1_339_11&#39;)"><span class="hl_varref"><span class="mpre">registerFd</span></span></a><span class="mpre"> </span><a href="#loc_111_3_111_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_3_111_6&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> (\_ </span><a name="loc_112_29_112_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_29_112_30&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.MVar.html#loc_133_1_133_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_133_1_133_8&#39;)"><span class="hl_varref"><span class="mpre">putMVar</span></span></a><span class="mpre"> </span><a href="#loc_110_3_110_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_3_110_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_112_29_112_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_29_112_30&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">) </span><a href="#loc_109_16_109_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_16_109_18&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="#loc_109_12_109_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_12_109_15&#39;)"><span class="hl_varref"><span class="mpre">evt</span></span></a><span class="mpre">
  </span><a name="loc_113_3_113_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_3_113_7&#39;)"><span class="hl_vardecl"><span class="mpre">evt&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_91_1_91_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_91_1_91_9&#39;)"><span class="hl_varref"><span class="mpre">takeMVar</span></span></a><span class="mpre"> </span><a href="#loc_110_3_110_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_3_110_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="GHC.IO.html#loc_360_1_360_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_360_1_360_12&#39;)"><span class="hl_infix"><span class="mpre">`onException`</span></span></a><span class="mpre"> </span><a href="GHC.Event.Manager.html#loc_371_1_371_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_371_1_371_14&#39;)"><span class="hl_varref"><span class="mpre">unregisterFd_</span></span></a><span class="mpre"> </span><a href="#loc_111_3_111_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_3_111_6&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_112_3_112_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_3_112_6&#39;)"><span class="hl_varref"><span class="mpre">reg</span></span></a><span class="mpre">
  if </span><a href="#loc_113_3_113_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_3_113_7&#39;)"><span class="hl_varref"><span class="mpre">evt&#39;</span></span></a><span class="mpre"> </span><a href="GHC.Event.Internal.html#loc_60_1_60_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_60_1_60_8&#39;)"><span class="hl_infix"><span class="mpre">`eventIs`</span></span></a><span class="mpre"> </span><a href="GHC.Event.Internal.html#loc_56_1_56_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_56_1_56_9&#39;)"><span class="hl_varref"><span class="mpre">evtClose</span></span></a><span class="mpre">
    then </span><a href="GHC.IO.Exception.html#loc_221_1_221_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_221_1_221_8&#39;)"><span class="hl_varref"><span class="mpre">ioError</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Foreign.C.Error.html#loc_467_1_467_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.C.Error.html#loc_467_1_467_15&#39;)"><span class="hl_varref"><span class="mpre">errnoToIOError</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;threadWait&quot;</span></span><span class="mpre"> </span><a href="Foreign.C.Error.html#loc_148_1_148_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.C.Error.html#loc_148_1_148_6&#39;)"><span class="hl_varref"><span class="mpre">eBADF</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
    else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">


</span><a href="#loc_120_1_120_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_1_120_14&#39;)"><span class="mpre">threadWaitSTM</span></a><span class="mpre"> :: </span><a href="GHC.Event.Internal.html#loc_37_9_37_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_37_9_37_14&#39;)"><span class="hl_tyconref"><span class="mpre">Event</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)
</span><a name="loc_120_1_120_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_1_120_14&#39;)"><span class="hl_fundecl"><span class="mpre">threadWaitSTM</span></span></a><span class="mpre"> </span><a name="loc_120_15_120_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_15_120_18&#39;)"><span class="hl_vardecl"><span class="mpre">evt</span></span></a><span class="mpre"> </span><a name="loc_120_19_120_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_19_120_21&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_426_1_426_6" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_426_1_426_6&#39;)"><span class="hl_varref"><span class="mpre">mask_</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
  </span><a name="loc_121_3_121_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_3_121_4&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVarIO</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
  </span><a name="loc_122_3_122_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_3_122_6&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_173_1_173_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_1_173_23&#39;)"><span class="hl_varref"><span class="mpre">getSystemEventManager_</span></span></a><span class="mpre">
  </span><a name="loc_123_3_123_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_3_123_6&#39;)"><span class="hl_vardecl"><span class="mpre">reg</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.Event.Manager.html#loc_339_1_339_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_339_1_339_11&#39;)"><span class="hl_varref"><span class="mpre">registerFd</span></span></a><span class="mpre"> </span><a href="#loc_122_3_122_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_3_122_6&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> (\_ </span><a name="loc_123_29_123_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_29_123_30&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">atomically</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_121_3_121_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_3_121_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_123_29_123_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_29_123_30&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">))) </span><a href="#loc_120_19_120_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_19_120_21&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a href="#loc_120_15_120_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_15_120_18&#39;)"><span class="hl_varref"><span class="mpre">evt</span></span></a><span class="mpre">
  let </span><a name="loc_124_7_124_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_7_124_17&#39;)"><span class="hl_vardecl"><span class="mpre">waitAction</span></span></a><span class="mpre"> =
        do </span><a name="loc_125_12_125_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_12_125_16&#39;)"><span class="hl_vardecl"><span class="mpre">mevt</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_121_3_121_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_3_121_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
           case </span><a href="#loc_125_12_125_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_12_125_16&#39;)"><span class="hl_varref"><span class="mpre">mevt</span></span></a><span class="mpre"> of
             </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">retry</span></span><span class="mpre">
             </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_128_19_128_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_19_128_23&#39;)"><span class="hl_vardecl"><span class="mpre">evt&#39;</span></span></a><span class="mpre"> -&gt;
               if </span><a href="#loc_128_19_128_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_19_128_23&#39;)"><span class="hl_varref"><span class="mpre">evt&#39;</span></span></a><span class="mpre"> </span><a href="GHC.Event.Internal.html#loc_60_1_60_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_60_1_60_8&#39;)"><span class="hl_infix"><span class="mpre">`eventIs`</span></span></a><span class="mpre"> </span><a href="GHC.Event.Internal.html#loc_56_1_56_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_56_1_56_9&#39;)"><span class="hl_varref"><span class="mpre">evtClose</span></span></a><span class="mpre">
               then </span><span class="hl_varref"><span class="mpre">throwSTM</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Foreign.C.Error.html#loc_467_1_467_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.C.Error.html#loc_467_1_467_15&#39;)"><span class="hl_varref"><span class="mpre">errnoToIOError</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;threadWaitSTM&quot;</span></span><span class="mpre"> </span><a href="Foreign.C.Error.html#loc_148_1_148_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.C.Error.html#loc_148_1_148_6&#39;)"><span class="hl_varref"><span class="mpre">eBADF</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
               else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_124_7_124_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_7_124_17&#39;)"><span class="hl_varref"><span class="mpre">waitAction</span></span></a><span class="mpre">, </span><a href="GHC.Event.Manager.html#loc_371_1_371_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_371_1_371_14&#39;)"><span class="hl_varref"><span class="mpre">unregisterFd_</span></span></a><span class="mpre"> </span><a href="#loc_122_3_122_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_3_122_6&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_123_3_123_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_3_123_6&#39;)"><span class="hl_varref"><span class="mpre">reg</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Allows a thread to use an STM action to wait for a file descriptor to be readable.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The STM action will retry until the file descriptor has data ready.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The second element of the return value pair is an IO action that can be used</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to deregister interest in the file descriptor.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The STM action will throw an &#39;IOError&#39; if the file descriptor was closed</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- while the STM action is being executed.  To safely close a file descriptor</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- that has been used with &#39;threadWaitReadSTM&#39;, use &#39;closeFdWith&#39;.</span></span><span class="mpre">
</span><a href="#loc_143_1_143_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_18&#39;)"><span class="mpre">threadWaitReadSTM</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)
</span><a name="loc_143_1_143_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_18&#39;)"><span class="hl_vardecl"><span class="mpre">threadWaitReadSTM</span></span></a><span class="mpre"> = </span><a href="#loc_120_1_120_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_1_120_14&#39;)"><span class="hl_varref"><span class="mpre">threadWaitSTM</span></span></a><span class="mpre"> </span><a href="GHC.Event.Internal.html#loc_46_1_46_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_46_1_46_8&#39;)"><span class="hl_varref"><span class="mpre">evtRead</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_143_1_143_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_18&#39;)"><span class="mpre">threadWaitReadSTM</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Allows a thread to use an STM action to wait until a file descriptor can accept a write.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The STM action will retry while the file until the given file descriptor can accept a write.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The second element of the return value pair is an IO action that can be used to deregister</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- interest in the file descriptor.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The STM action will throw an &#39;IOError&#39; if the file descriptor was closed</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- while the STM action is being executed.  To safely close a file descriptor</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- that has been used with &#39;threadWaitWriteSTM&#39;, use &#39;closeFdWith&#39;.</span></span><span class="mpre">
</span><a href="#loc_155_1_155_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_19&#39;)"><span class="mpre">threadWaitWriteSTM</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Fd</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)
</span><a name="loc_155_1_155_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_19&#39;)"><span class="hl_vardecl"><span class="mpre">threadWaitWriteSTM</span></span></a><span class="mpre"> = </span><a href="#loc_120_1_120_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_1_120_14&#39;)"><span class="hl_varref"><span class="mpre">threadWaitSTM</span></span></a><span class="mpre"> </span><a href="GHC.Event.Internal.html#loc_51_1_51_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Internal.html#loc_51_1_51_9&#39;)"><span class="hl_varref"><span class="mpre">evtWrite</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_155_1_155_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_19&#39;)"><span class="mpre">threadWaitWriteSTM</span></a><span class="mpre"> #-}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | Retrieve the system event manager for the capability on which the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- calling thread is running.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This function always returns &#39;Just&#39; the current thread&#39;s event manager</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- when using the threaded RTS and &#39;Nothing&#39; otherwise.</span></span><span class="mpre">
</span><a href="#loc_165_1_165_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_22&#39;)"><span class="mpre">getSystemEventManager</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><a href="GHC.Event.Manager.html#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre">)
</span><a name="loc_165_1_165_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_22&#39;)"><span class="hl_vardecl"><span class="mpre">getSystemEventManager</span></span></a><span class="mpre"> = do
  </span><a name="loc_166_3_166_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_3_166_4&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">myThreadId</span></span><span class="mpre">
  (</span><a name="loc_167_4_167_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_4_167_7&#39;)"><span class="hl_vardecl"><span class="mpre">cap</span></span></a><span class="mpre">, _) &lt;- </span><span class="hl_varref"><span class="mpre">threadCapability</span></span><span class="mpre"> </span><a href="#loc_166_3_166_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_166_3_166_4&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">
  </span><a name="loc_168_3_168_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_3_168_20&#39;)"><span class="hl_vardecl"><span class="mpre">eventManagerArray</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_182_1_182_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_13&#39;)"><span class="hl_varref"><span class="mpre">eventManager</span></span></a><span class="mpre">
  </span><a name="loc_169_3_169_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_3_169_7&#39;)"><span class="hl_vardecl"><span class="mpre">mmgr</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IOArray.html#loc_65_1_65_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_65_1_65_12&#39;)"><span class="hl_varref"><span class="mpre">readIOArray</span></span></a><span class="mpre"> </span><a href="#loc_168_3_168_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_3_168_20&#39;)"><span class="hl_varref"><span class="mpre">eventManagerArray</span></span></a><span class="mpre"> </span><a href="#loc_167_4_167_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_4_167_7&#39;)"><span class="hl_varref"><span class="mpre">cap</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> </span><a href="Data.Tuple.html#loc_52_1_52_4" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Tuple.html#loc_52_1_52_4&#39;)"><span class="hl_varref"><span class="mpre">snd</span></span></a><span class="mpre"> </span><a href="#loc_169_3_169_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_169_3_169_7&#39;)"><span class="hl_varref"><span class="mpre">mmgr</span></span></a><span class="mpre">

</span><a href="#loc_173_1_173_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_1_173_23&#39;)"><span class="mpre">getSystemEventManager_</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.Event.Manager.html#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre">
</span><a name="loc_173_1_173_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_1_173_23&#39;)"><span class="hl_vardecl"><span class="mpre">getSystemEventManager_</span></span></a><span class="mpre"> = do
  </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_174_8_174_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_8_174_11&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_165_1_165_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_22&#39;)"><span class="hl_varref"><span class="mpre">getSystemEventManager</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_174_8_174_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_8_174_11&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_173_1_173_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_1_173_23&#39;)"><span class="mpre">getSystemEventManager_</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 178, srcSpanStartColumn = 1, srcSpanEndLine = 179, srcSpanEndColumn = 70}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 178, srcSpanStartColumn = 1, srcSpanEndLine = 178, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 178, s"><span class="mpre">foreign import ccall unsafe &quot;getOrSetSystemEventThreadEventManagerStore&quot;
    getOrSetSystemEventThreadEventManagerStore :: Ptr a -&gt; IO (Ptr a)</span></span><span class="mpre">

</span><a href="#loc_182_1_182_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_13&#39;)"><span class="mpre">eventManager</span></a><span class="mpre"> :: </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> (</span><a href="GHC.IOArray.html#loc_42_9_42_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_42_9_42_16&#39;)"><span class="hl_tyconref"><span class="mpre">IOArray</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">ThreadId</span></span><span class="mpre">, </span><a href="GHC.Event.Manager.html#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre">)))
</span><a name="loc_182_1_182_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_13&#39;)"><span class="hl_vardecl"><span class="mpre">eventManager</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a name="loc_183_5_183_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_5_183_12&#39;)"><span class="hl_vardecl"><span class="mpre">numCaps</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getNumCapabilities</span></span><span class="mpre">
    </span><a name="loc_184_5_184_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_5_184_22&#39;)"><span class="hl_vardecl"><span class="mpre">eventManagerArray</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IOArray.html#loc_51_1_51_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_51_1_51_11&#39;)"><span class="hl_varref"><span class="mpre">newIOArray</span></span></a><span class="mpre"> (</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">, </span><a href="#loc_183_5_183_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_5_183_12&#39;)"><span class="hl_varref"><span class="mpre">numCaps</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
    </span><a name="loc_185_5_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_7&#39;)"><span class="hl_vardecl"><span class="mpre">em</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="#loc_184_5_184_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_5_184_22&#39;)"><span class="hl_varref"><span class="mpre">eventManagerArray</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">sharedCAF</span></span><span class="mpre"> </span><a href="#loc_185_5_185_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_5_185_7&#39;)"><span class="hl_varref"><span class="mpre">em</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">getOrSetSystemEventThreadEventManagerStore</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_182_1_182_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_13&#39;)"><span class="mpre">eventManager</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_190_1_190_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_1_190_24&#39;)"><span class="mpre">numEnabledEventManagers</span></a><span class="mpre"> :: </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_190_1_190_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_1_190_24&#39;)"><span class="hl_vardecl"><span class="mpre">numEnabledEventManagers</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
  </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_190_1_190_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_1_190_24&#39;)"><span class="mpre">numEnabledEventManagers</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 194, srcSpanStartColumn = 1, srcSpanEndLine = 195, srcSpanEndColumn = 73}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 194, srcSpanStartColumn = 1, srcSpanEndLine = 194, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 194, s"><span class="mpre">foreign import ccall unsafe &quot;getOrSetSystemEventThreadIOManagerThreadStore&quot;
    getOrSetSystemEventThreadIOManagerThreadStore :: Ptr a -&gt; IO (Ptr a)</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | The ioManagerLock protects the &#39;eventManager&#39; value:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Only one thread at a time can start or shutdown event managers.</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_201_1_201_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_1_201_14&#39;)"><span class="mpre">ioManagerLock</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_201_1_201_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_1_201_14&#39;)"><span class="mpre">ioManagerLock</span></a><span class="mpre"> :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_201_1_201_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_1_201_14&#39;)"><span class="hl_vardecl"><span class="mpre">ioManagerLock</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
   </span><a name="loc_202_4_202_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_4_202_5&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="hl_varref"><span class="mpre">newMVar</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
   </span><span class="hl_varref"><span class="mpre">sharedCAF</span></span><span class="mpre"> </span><a href="#loc_202_4_202_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_4_202_5&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">getOrSetSystemEventThreadIOManagerThreadStore</span></span><span class="mpre">

</span><a href="#loc_206_1_206_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_1_206_22&#39;)"><span class="mpre">getSystemTimerManager</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="GHC.Event.TimerManager.html#loc_115_6_115_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.TimerManager.html#loc_115_6_115_18&#39;)"><span class="hl_tyconref"><span class="mpre">TM.TimerManager</span></span></a><span class="mpre">
</span><a name="loc_206_1_206_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_1_206_22&#39;)"><span class="hl_vardecl"><span class="mpre">getSystemTimerManager</span></span></a><span class="mpre"> = do
  </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_207_8_207_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_8_207_11&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_214_1_214_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_1_214_13&#39;)"><span class="hl_varref"><span class="mpre">timerManager</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_207_8_207_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_8_207_11&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 210, srcSpanStartColumn = 1, srcSpanEndLine = 211, srcSpanEndColumn = 70}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 210, srcSpanStartColumn = 1, srcSpanEndLine = 210, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 210, s"><span class="mpre">foreign import ccall unsafe &quot;getOrSetSystemTimerThreadEventManagerStore&quot;
    getOrSetSystemTimerThreadEventManagerStore :: Ptr a -&gt; IO (Ptr a)</span></span><span class="mpre">

</span><a href="#loc_214_1_214_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_1_214_13&#39;)"><span class="mpre">timerManager</span></a><span class="mpre"> :: </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><a href="GHC.Event.TimerManager.html#loc_115_6_115_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.TimerManager.html#loc_115_6_115_18&#39;)"><span class="hl_tyconref"><span class="mpre">TM.TimerManager</span></span></a><span class="mpre">)
</span><a name="loc_214_1_214_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_1_214_13&#39;)"><span class="hl_vardecl"><span class="mpre">timerManager</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><a name="loc_215_5_215_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_5_215_7&#39;)"><span class="hl_vardecl"><span class="mpre">em</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_42_1_42_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_42_1_42_9&#39;)"><span class="hl_varref"><span class="mpre">newIORef</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">sharedCAF</span></span><span class="mpre"> </span><a href="#loc_215_5_215_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_215_5_215_7&#39;)"><span class="hl_varref"><span class="mpre">em</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">getOrSetSystemTimerThreadEventManagerStore</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_214_1_214_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_1_214_13&#39;)"><span class="mpre">timerManager</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 219, srcSpanStartColumn = 1, srcSpanEndLine = 220, srcSpanEndColumn = 73}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 219, srcSpanStartColumn = 1, srcSpanEndLine = 219, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 219, s"><span class="mpre">foreign import ccall unsafe &quot;getOrSetSystemTimerThreadIOManagerThreadStore&quot;
    getOrSetSystemTimerThreadIOManagerThreadStore :: Ptr a -&gt; IO (Ptr a)</span></span><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_224_1_224_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_1_224_22&#39;)"><span class="mpre">timerManagerThreadVar</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_224_1_224_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_1_224_22&#39;)"><span class="mpre">timerManagerThreadVar</span></a><span class="mpre"> :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ThreadId</span></span><span class="mpre">)
</span><a name="loc_224_1_224_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_1_224_22&#39;)"><span class="hl_vardecl"><span class="mpre">timerManagerThreadVar</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_165_1_165_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_165_1_165_16&#39;)"><span class="hl_varref"><span class="mpre">unsafePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
   </span><a name="loc_225_4_225_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_4_225_5&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.MVar.html#loc_70_1_70_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_70_1_70_8&#39;)"><span class="hl_varref"><span class="mpre">newMVar</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
   </span><span class="hl_varref"><span class="mpre">sharedCAF</span></span><span class="mpre"> </span><a href="#loc_225_4_225_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_225_4_225_5&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">getOrSetSystemTimerThreadIOManagerThreadStore</span></span><span class="mpre">

</span><a href="#loc_229_1_229_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_1_229_25&#39;)"><span class="mpre">ensureIOManagerIsRunning</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_229_1_229_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_1_229_25&#39;)"><span class="hl_vardecl"><span class="mpre">ensureIOManagerIsRunning</span></span></a><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">threaded</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do
      </span><a href="#loc_236_1_236_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_236_1_236_22&#39;)"><span class="hl_varref"><span class="mpre">startIOManagerThreads</span></span></a><span class="mpre">
      </span><a href="#loc_277_1_277_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_1_277_24&#39;)"><span class="hl_varref"><span class="mpre">startTimerManagerThread</span></span></a><span class="mpre">

</span><a href="#loc_236_1_236_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_236_1_236_22&#39;)"><span class="mpre">startIOManagerThreads</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_236_1_236_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_236_1_236_22&#39;)"><span class="hl_vardecl"><span class="mpre">startIOManagerThreads</span></span></a><span class="mpre"> =
  </span><span class="hl_varref"><span class="mpre">withMVar</span></span><span class="mpre"> </span><a href="#loc_201_1_201_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_1_201_14&#39;)"><span class="hl_varref"><span class="mpre">ioManagerLock</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \_ -&gt; do
    </span><a name="loc_238_5_238_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_238_5_238_22&#39;)"><span class="hl_vardecl"><span class="mpre">eventManagerArray</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_182_1_182_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_13&#39;)"><span class="hl_varref"><span class="mpre">eventManager</span></span></a><span class="mpre">
    let (_, </span><a name="loc_239_13_239_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_13_239_17&#39;)"><span class="hl_vardecl"><span class="mpre">high</span></span></a><span class="mpre">) = </span><a href="GHC.IOArray.html#loc_73_1_73_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_73_1_73_14&#39;)"><span class="hl_varref"><span class="mpre">boundsIOArray</span></span></a><span class="mpre"> </span><a href="#loc_238_5_238_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_238_5_238_22&#39;)"><span class="hl_varref"><span class="mpre">eventManagerArray</span></span></a><span class="mpre">
    </span><a href="Control.Monad.html#loc_168_1_168_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_168_1_168_6&#39;)"><span class="hl_varref"><span class="mpre">forM_</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpEnumFromTo (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 240, srcSpanStartColumn = 11, srcSpanEndLine = 240, srcSpanEndColumn = 20}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 240, srcSpanStartColumn = 11, srcSpanEndLine = 240, srcSpanEndColumn = 12},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine ="><span class="mpre">[0..high]</span></span><span class="mpre"> (</span><a href="#loc_253_1_253_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_1_253_21&#39;)"><span class="hl_varref"><span class="mpre">startIOManagerThread</span></span></a><span class="mpre"> </span><a href="#loc_238_5_238_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_238_5_238_22&#39;)"><span class="hl_varref"><span class="mpre">eventManagerArray</span></span></a><span class="mpre">)
    </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_190_1_190_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_1_190_24&#39;)"><span class="hl_varref"><span class="mpre">numEnabledEventManagers</span></span></a><span class="mpre"> (</span><a href="#loc_239_13_239_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_13_239_17&#39;)"><span class="hl_varref"><span class="mpre">high</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)

</span><a href="#loc_244_1_244_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_1_244_16&#39;)"><span class="mpre">restartPollLoop</span></a><span class="mpre"> :: </span><a href="GHC.Event.Manager.html#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ThreadId</span></span><span class="mpre">
</span><a name="loc_244_1_244_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_1_244_16&#39;)"><span class="hl_fundecl"><span class="mpre">restartPollLoop</span></span></a><span class="mpre"> </span><a name="loc_244_17_244_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_17_244_20&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a name="loc_244_21_244_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_21_244_22&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> = do
  </span><a href="GHC.Event.Manager.html#loc_218_1_218_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_218_1_218_8&#39;)"><span class="hl_varref"><span class="mpre">M.release</span></span></a><span class="mpre"> </span><a href="#loc_244_17_244_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_17_244_20&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">
  !</span><a name="loc_246_4_246_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_246_4_246_5&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">forkOn</span></span><span class="mpre"> </span><a href="#loc_244_21_244_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_21_244_22&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.Event.Manager.html#loc_241_1_241_5" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_241_1_241_5&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_244_17_244_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_17_244_20&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">labelThread</span></span><span class="mpre"> </span><a href="#loc_246_4_246_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_246_4_246_5&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;IOManager&quot;</span></span><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_246_4_246_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_246_4_246_5&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">

</span><a href="#loc_253_1_253_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_1_253_21&#39;)"><span class="mpre">startIOManagerThread</span></a><span class="mpre"> :: </span><a href="GHC.IOArray.html#loc_42_9_42_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_42_9_42_16&#39;)"><span class="hl_tyconref"><span class="mpre">IOArray</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">ThreadId</span></span><span class="mpre">, </span><a href="GHC.Event.Manager.html#loc_114_6_114_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_114_6_114_18&#39;)"><span class="hl_tyconref"><span class="mpre">EventManager</span></span></a><span class="mpre">))
                        -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
                        -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_253_1_253_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_1_253_21&#39;)"><span class="hl_fundecl"><span class="mpre">startIOManagerThread</span></span></a><span class="mpre"> </span><a name="loc_253_22_253_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_22_253_39&#39;)"><span class="hl_vardecl"><span class="mpre">eventManagerArray</span></span></a><span class="mpre"> </span><a name="loc_253_40_253_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_40_253_41&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> = do
  let </span><a name="loc_254_7_254_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_7_254_13&#39;)"><span class="hl_vardecl"><span class="mpre">create</span></span></a><span class="mpre"> = do
        !</span><a name="loc_255_10_255_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_255_10_255_13&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.Event.Manager.html#loc_169_1_169_4" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_169_1_169_4&#39;)"><span class="hl_varref"><span class="mpre">new</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
        !</span><a name="loc_256_10_256_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_256_10_256_11&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">forkOn</span></span><span class="mpre"> </span><a href="#loc_253_40_253_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_40_253_41&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.Event.Manager.html#loc_241_1_241_5" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_241_1_241_5&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_255_10_255_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_255_10_255_13&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">labelThread</span></span><span class="mpre"> </span><a href="#loc_256_10_256_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_256_10_256_11&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;IOManager&quot;</span></span><span class="mpre">
        </span><a href="GHC.IOArray.html#loc_69_1_69_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_69_1_69_13&#39;)"><span class="hl_varref"><span class="mpre">writeIOArray</span></span></a><span class="mpre"> </span><a href="#loc_253_22_253_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_22_253_39&#39;)"><span class="hl_varref"><span class="mpre">eventManagerArray</span></span></a><span class="mpre"> </span><a href="#loc_253_40_253_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_40_253_41&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a href="#loc_256_10_256_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_256_10_256_11&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">,</span><a href="#loc_255_10_255_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_255_10_255_13&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">))
  </span><a name="loc_259_3_259_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_3_259_6&#39;)"><span class="hl_vardecl"><span class="mpre">old</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IOArray.html#loc_65_1_65_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_65_1_65_12&#39;)"><span class="hl_varref"><span class="mpre">readIOArray</span></span></a><span class="mpre"> </span><a href="#loc_253_22_253_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_22_253_39&#39;)"><span class="hl_varref"><span class="mpre">eventManagerArray</span></span></a><span class="mpre"> </span><a href="#loc_253_40_253_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_40_253_41&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
  case </span><a href="#loc_259_3_259_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_3_259_6&#39;)"><span class="hl_varref"><span class="mpre">old</span></span></a><span class="mpre"> of
    </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">     -&gt; </span><a href="#loc_254_7_254_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_7_254_13&#39;)"><span class="hl_varref"><span class="mpre">create</span></span></a><span class="mpre">
    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a name="loc_262_11_262_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_262_11_262_12&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre">,</span><a name="loc_262_13_262_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_262_13_262_15&#39;)"><span class="hl_vardecl"><span class="mpre">em</span></span></a><span class="mpre">) -&gt; do
      </span><a name="loc_263_7_263_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_263_7_263_8&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">threadStatus</span></span><span class="mpre"> </span><a href="#loc_262_11_262_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_262_11_262_12&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">
      case </span><a href="#loc_263_7_263_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_263_7_263_8&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">ThreadFinished</span></span><span class="mpre"> -&gt; </span><a href="#loc_254_7_254_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_7_254_13&#39;)"><span class="hl_varref"><span class="mpre">create</span></span></a><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">ThreadDied</span></span><span class="mpre">     -&gt; do
          </span><span class="hl_comment"><span class="mpre">-- Sanity check: if the thread has died, there is a chance</span></span><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- that event manager is still alive. This could happend during</span></span><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- the fork, for example. In this case we should clean up</span></span><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- open pipes and everything else related to the event manager.</span></span><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- See #4449</span></span><span class="mpre">
          </span><a href="GHC.Event.Manager.html#loc_226_1_226_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_226_1_226_8&#39;)"><span class="hl_varref"><span class="mpre">M.cleanup</span></span></a><span class="mpre"> </span><a href="#loc_262_13_262_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_262_13_262_15&#39;)"><span class="hl_varref"><span class="mpre">em</span></span></a><span class="mpre">
          </span><a href="#loc_254_7_254_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_7_254_13&#39;)"><span class="hl_varref"><span class="mpre">create</span></span></a><span class="mpre">
        </span><span class="hl_vardecl"><span class="mpre">_other</span></span><span class="mpre">         -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><a href="#loc_277_1_277_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_1_277_24&#39;)"><span class="mpre">startTimerManagerThread</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_277_1_277_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_1_277_24&#39;)"><span class="hl_vardecl"><span class="mpre">startTimerManagerThread</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">modifyMVar_</span></span><span class="mpre"> </span><a href="#loc_224_1_224_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_224_1_224_22&#39;)"><span class="hl_varref"><span class="mpre">timerManagerThreadVar</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_277_64_277_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_64_277_67&#39;)"><span class="hl_vardecl"><span class="mpre">old</span></span></a><span class="mpre"> -&gt; do
  let </span><a name="loc_278_7_278_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_7_278_13&#39;)"><span class="hl_vardecl"><span class="mpre">create</span></span></a><span class="mpre"> = do
        !</span><a name="loc_279_10_279_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_10_279_13&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.Event.TimerManager.html#loc_143_1_143_4" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.TimerManager.html#loc_143_1_143_4&#39;)"><span class="hl_varref"><span class="mpre">TM.new</span></span></a><span class="mpre">
        </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_214_1_214_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_1_214_13&#39;)"><span class="hl_varref"><span class="mpre">timerManager</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_279_10_279_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_10_279_13&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">
        !</span><a name="loc_281_10_281_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_10_281_11&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">forkIO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.Event.TimerManager.html#loc_190_1_190_5" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.TimerManager.html#loc_190_1_190_5&#39;)"><span class="hl_varref"><span class="mpre">TM.loop</span></span></a><span class="mpre"> </span><a href="#loc_279_10_279_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_279_10_279_13&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="Control.Exception.Base.html#loc_273_3_273_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_273_3_273_12&#39;)"><span class="hl_infix"><span class="mpre">`finally`</span></span></a><span class="mpre"> </span><a href="#loc_304_1_304_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_1_304_17&#39;)"><span class="hl_varref"><span class="mpre">shutdownManagers</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">labelThread</span></span><span class="mpre"> </span><a href="#loc_281_10_281_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_10_281_11&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;TimerManager&quot;</span></span><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_281_10_281_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_10_281_11&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">
  case </span><a href="#loc_277_64_277_67" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_64_277_67&#39;)"><span class="hl_varref"><span class="mpre">old</span></span></a><span class="mpre"> of
    </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">            -&gt; </span><a href="#loc_278_7_278_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_7_278_13&#39;)"><span class="hl_varref"><span class="mpre">create</span></span></a><span class="mpre">
    </span><a name="loc_286_5_286_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_5_286_7&#39;)"><span class="hl_specname"><span class="mpre">st</span></span></a><span class="mpre">@(</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_286_14_286_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_14_286_15&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre">) -&gt; do
      </span><a name="loc_287_7_287_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_7_287_8&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">threadStatus</span></span><span class="mpre"> </span><a href="#loc_286_14_286_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_14_286_15&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">
      case </span><a href="#loc_287_7_287_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_287_7_287_8&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">ThreadFinished</span></span><span class="mpre"> -&gt; </span><a href="#loc_278_7_278_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_7_278_13&#39;)"><span class="hl_varref"><span class="mpre">create</span></span></a><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">ThreadDied</span></span><span class="mpre">     -&gt; do
          </span><span class="hl_comment"><span class="mpre">-- Sanity check: if the thread has died, there is a chance</span></span><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- that event manager is still alive. This could happend during</span></span><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- the fork, for example. In this case we should clean up</span></span><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- open pipes and everything else related to the event manager.</span></span><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- See #4449</span></span><span class="mpre">
          </span><a name="loc_296_11_296_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_296_11_296_14&#39;)"><span class="hl_vardecl"><span class="mpre">mem</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_214_1_214_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_1_214_13&#39;)"><span class="hl_varref"><span class="mpre">timerManager</span></span></a><span class="mpre">
          _ &lt;- case </span><a href="#loc_296_11_296_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_296_11_296_14&#39;)"><span class="hl_varref"><span class="mpre">mem</span></span></a><span class="mpre"> of
                 </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
                 </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_299_23_299_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_23_299_25&#39;)"><span class="hl_vardecl"><span class="mpre">em</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.Event.TimerManager.html#loc_176_1_176_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.TimerManager.html#loc_176_1_176_8&#39;)"><span class="hl_varref"><span class="mpre">TM.cleanup</span></span></a><span class="mpre"> </span><a href="#loc_299_23_299_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_23_299_25&#39;)"><span class="hl_varref"><span class="mpre">em</span></span></a><span class="mpre">
          </span><a href="#loc_278_7_278_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_278_7_278_13&#39;)"><span class="hl_varref"><span class="mpre">create</span></span></a><span class="mpre">
        </span><span class="hl_vardecl"><span class="mpre">_other</span></span><span class="mpre">         -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_286_5_286_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_5_286_7&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">

</span><a href="#loc_304_1_304_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_1_304_17&#39;)"><span class="mpre">shutdownManagers</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_304_1_304_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_304_1_304_17&#39;)"><span class="hl_vardecl"><span class="mpre">shutdownManagers</span></span></a><span class="mpre"> =
  </span><span class="hl_varref"><span class="mpre">withMVar</span></span><span class="mpre"> </span><a href="#loc_201_1_201_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_1_201_14&#39;)"><span class="hl_varref"><span class="mpre">ioManagerLock</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \_ -&gt; do
    </span><a name="loc_306_5_306_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_306_5_306_22&#39;)"><span class="hl_vardecl"><span class="mpre">eventManagerArray</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_182_1_182_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_13&#39;)"><span class="hl_varref"><span class="mpre">eventManager</span></span></a><span class="mpre">
    let (_, </span><span class="hl_vardecl"><span class="mpre">high</span></span><span class="mpre">) = </span><a href="GHC.IOArray.html#loc_73_1_73_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_73_1_73_14&#39;)"><span class="hl_varref"><span class="mpre">boundsIOArray</span></span></a><span class="mpre"> </span><a href="#loc_306_5_306_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_306_5_306_22&#39;)"><span class="hl_varref"><span class="mpre">eventManagerArray</span></span></a><span class="mpre">
    </span><a href="Control.Monad.html#loc_168_1_168_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_168_1_168_6&#39;)"><span class="hl_varref"><span class="mpre">forM_</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpEnumFromTo (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 308, srcSpanStartColumn = 11, srcSpanEndLine = 308, srcSpanEndColumn = 20}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 308, srcSpanStartColumn = 11, srcSpanEndLine = 308, srcSpanEndColumn = 12},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine ="><span class="mpre">[0..high]</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_308_24_308_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_308_24_308_25&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> -&gt; do
      </span><a name="loc_309_7_309_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_7_309_11&#39;)"><span class="hl_vardecl"><span class="mpre">mmgr</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IOArray.html#loc_65_1_65_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_65_1_65_12&#39;)"><span class="hl_varref"><span class="mpre">readIOArray</span></span></a><span class="mpre"> </span><a href="#loc_306_5_306_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_306_5_306_22&#39;)"><span class="hl_varref"><span class="mpre">eventManagerArray</span></span></a><span class="mpre"> </span><a href="#loc_308_24_308_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_308_24_308_25&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
      case </span><a href="#loc_309_7_309_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_309_7_309_11&#39;)"><span class="hl_varref"><span class="mpre">mmgr</span></span></a><span class="mpre"> of
        </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
        </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (_,</span><a name="loc_312_17_312_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_17_312_20&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre">) -&gt; </span><a href="GHC.Event.Manager.html#loc_211_1_211_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Event.Manager.html#loc_211_1_211_9&#39;)"><span class="hl_varref"><span class="mpre">M.shutdown</span></span></a><span class="mpre"> </span><a href="#loc_312_17_312_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_17_312_20&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 314, srcSpanStartColumn = 1, srcSpanEndLine = 314, srcSpanEndColumn = 71}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 314, srcSpanStartColumn = 1, srcSpanEndLine = 314, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 314, s"><span class="mpre">foreign import ccall unsafe &quot;rtsSupportsBoundThreads&quot; threaded :: Bool</span></span><span class="mpre">

</span><a href="#loc_317_1_317_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_1_317_29&#39;)"><span class="mpre">ioManagerCapabilitiesChanged</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_317_1_317_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_317_1_317_29&#39;)"><span class="hl_vardecl"><span class="mpre">ioManagerCapabilitiesChanged</span></span></a><span class="mpre"> = do
  </span><span class="hl_varref"><span class="mpre">withMVar</span></span><span class="mpre"> </span><a href="#loc_201_1_201_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_1_201_14&#39;)"><span class="hl_varref"><span class="mpre">ioManagerLock</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \_ -&gt; do
    </span><a name="loc_319_5_319_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_319_5_319_15&#39;)"><span class="hl_vardecl"><span class="mpre">new_n_caps</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getNumCapabilities</span></span><span class="mpre">
    </span><a name="loc_320_5_320_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_320_5_320_15&#39;)"><span class="hl_vardecl"><span class="mpre">numEnabled</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_190_1_190_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_1_190_24&#39;)"><span class="hl_varref"><span class="mpre">numEnabledEventManagers</span></span></a><span class="mpre">
    </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_190_1_190_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_1_190_24&#39;)"><span class="hl_varref"><span class="mpre">numEnabledEventManagers</span></span></a><span class="mpre"> </span><a href="#loc_319_5_319_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_319_5_319_15&#39;)"><span class="hl_varref"><span class="mpre">new_n_caps</span></span></a><span class="mpre">
    </span><a name="loc_322_5_322_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_322_5_322_22&#39;)"><span class="hl_vardecl"><span class="mpre">eventManagerArray</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_182_1_182_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_13&#39;)"><span class="hl_varref"><span class="mpre">eventManager</span></span></a><span class="mpre">
    let (_, </span><a name="loc_323_13_323_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_13_323_17&#39;)"><span class="hl_vardecl"><span class="mpre">high</span></span></a><span class="mpre">) = </span><a href="GHC.IOArray.html#loc_73_1_73_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_73_1_73_14&#39;)"><span class="hl_varref"><span class="mpre">boundsIOArray</span></span></a><span class="mpre"> </span><a href="#loc_322_5_322_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_322_5_322_22&#39;)"><span class="hl_varref"><span class="mpre">eventManagerArray</span></span></a><span class="mpre">
    let </span><a name="loc_324_9_324_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_9_324_19&#39;)"><span class="hl_vardecl"><span class="mpre">old_n_caps</span></span></a><span class="mpre"> = </span><a href="#loc_323_13_323_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_323_13_323_17&#39;)"><span class="hl_varref"><span class="mpre">high</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">
    if </span><a href="#loc_319_5_319_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_319_5_319_15&#39;)"><span class="hl_varref"><span class="mpre">new_n_caps</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><a href="#loc_324_9_324_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_324_9_324_19&#39;)"><span class="hl_varref"><span class="mpre">old_n_caps</span></span></a><span class="mpre">
      then do </span><a name="loc_326_15_326_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_326_15_326_36&#39;)"><span class="hl_vardecl"><span class="mpre">new_eventManagerArray</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IOArray.html#loc_51_1_51_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_51_1_51_11&#39;)"><span class="hl_varref"><span class="mpre">newIOArray</span></span></a><span class="mpre"> (</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">, </span><a href="#loc_319_5_319_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_319_5_319_15&#39;)"><span class="hl_varref"><span class="mpre">new_n_caps</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">

              </span><span class="hl_comment"><span class="mpre">-- copy the existing values into the new array:</span></span><span class="mpre">
              </span><a href="Control.Monad.html#loc_168_1_168_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_168_1_168_6&#39;)"><span class="hl_varref"><span class="mpre">forM_</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpEnumFromTo (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 329, srcSpanStartColumn = 21, srcSpanEndLine = 329, srcSpanEndColumn = 30}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 329, srcSpanStartColumn = 21, srcSpanEndLine = 329, srcSpanEndColumn = 22},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine ="><span class="mpre">[0..high]</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_329_34_329_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_34_329_35&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> -&gt; do
                </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a name="loc_330_23_330_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_330_23_330_26&#39;)"><span class="hl_vardecl"><span class="mpre">tid</span></span></a><span class="mpre">,</span><a name="loc_330_27_330_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_330_27_330_30&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre">) &lt;- </span><a href="GHC.IOArray.html#loc_65_1_65_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_65_1_65_12&#39;)"><span class="hl_varref"><span class="mpre">readIOArray</span></span></a><span class="mpre"> </span><a href="#loc_322_5_322_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_322_5_322_22&#39;)"><span class="hl_varref"><span class="mpre">eventManagerArray</span></span></a><span class="mpre"> </span><a href="#loc_329_34_329_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_34_329_35&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
                if </span><a href="#loc_329_34_329_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_34_329_35&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_320_5_320_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_320_5_320_15&#39;)"><span class="hl_varref"><span class="mpre">numEnabled</span></span></a><span class="mpre">
                  then </span><a href="GHC.IOArray.html#loc_69_1_69_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_69_1_69_13&#39;)"><span class="hl_varref"><span class="mpre">writeIOArray</span></span></a><span class="mpre"> </span><a href="#loc_326_15_326_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_326_15_326_36&#39;)"><span class="hl_varref"><span class="mpre">new_eventManagerArray</span></span></a><span class="mpre"> </span><a href="#loc_329_34_329_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_34_329_35&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a href="#loc_330_23_330_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_330_23_330_26&#39;)"><span class="hl_varref"><span class="mpre">tid</span></span></a><span class="mpre">,</span><a href="#loc_330_27_330_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_330_27_330_30&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">))
                  else do </span><a name="loc_333_27_333_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_333_27_333_31&#39;)"><span class="hl_vardecl"><span class="mpre">tid&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_244_1_244_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_1_244_16&#39;)"><span class="hl_varref"><span class="mpre">restartPollLoop</span></span></a><span class="mpre"> </span><a href="#loc_330_27_330_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_330_27_330_30&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_329_34_329_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_34_329_35&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
                          </span><a href="GHC.IOArray.html#loc_69_1_69_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_69_1_69_13&#39;)"><span class="hl_varref"><span class="mpre">writeIOArray</span></span></a><span class="mpre"> </span><a href="#loc_326_15_326_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_326_15_326_36&#39;)"><span class="hl_varref"><span class="mpre">new_eventManagerArray</span></span></a><span class="mpre"> </span><a href="#loc_329_34_329_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_329_34_329_35&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a href="#loc_333_27_333_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_333_27_333_31&#39;)"><span class="hl_varref"><span class="mpre">tid&#39;</span></span></a><span class="mpre">,</span><a href="#loc_330_27_330_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_330_27_330_30&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">))

              </span><span class="hl_comment"><span class="mpre">-- create new IO managers for the new caps:</span></span><span class="mpre">
              </span><a href="Control.Monad.html#loc_168_1_168_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_168_1_168_6&#39;)"><span class="hl_varref"><span class="mpre">forM_</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpEnumFromTo (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 337, srcSpanStartColumn = 21, srcSpanEndLine = 337, srcSpanEndColumn = 47}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 337, srcSpanStartColumn = 21, srcSpanEndLine = 337, srcSpanEndColumn = 22},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine ="><span class="mpre">[old_n_caps..new_n_caps-1]</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
                </span><a href="#loc_253_1_253_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_253_1_253_21&#39;)"><span class="hl_varref"><span class="mpre">startIOManagerThread</span></span></a><span class="mpre"> </span><a href="#loc_326_15_326_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_326_15_326_36&#39;)"><span class="hl_varref"><span class="mpre">new_eventManagerArray</span></span></a><span class="mpre">

              </span><span class="hl_comment"><span class="mpre">-- update the event manager array reference:</span></span><span class="mpre">
              </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_182_1_182_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_1_182_13&#39;)"><span class="hl_varref"><span class="mpre">eventManager</span></span></a><span class="mpre"> </span><a href="#loc_326_15_326_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_326_15_326_36&#39;)"><span class="hl_varref"><span class="mpre">new_eventManagerArray</span></span></a><span class="mpre">
      else </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_319_5_319_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_319_5_319_15&#39;)"><span class="hl_varref"><span class="mpre">new_n_caps</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><a href="#loc_320_5_320_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_320_5_320_15&#39;)"><span class="hl_varref"><span class="mpre">numEnabled</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
            </span><a href="Control.Monad.html#loc_168_1_168_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_168_1_168_6&#39;)"><span class="hl_varref"><span class="mpre">forM_</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpEnumFromTo (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 343, srcSpanStartColumn = 19, srcSpanEndLine = 343, srcSpanEndColumn = 45}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine = 343, srcSpanStartColumn = 19, srcSpanEndLine = 343, srcSpanEndColumn = 20},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/Event/Thread.hs&quot;, srcSpanStartLine ="><span class="mpre">[numEnabled..new_n_caps-1]</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_343_49_343_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_49_343_50&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> -&gt; do
              </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (_,</span><a name="loc_344_23_344_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_23_344_26&#39;)"><span class="hl_vardecl"><span class="mpre">mgr</span></span></a><span class="mpre">) &lt;- </span><a href="GHC.IOArray.html#loc_65_1_65_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_65_1_65_12&#39;)"><span class="hl_varref"><span class="mpre">readIOArray</span></span></a><span class="mpre"> </span><a href="#loc_322_5_322_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_322_5_322_22&#39;)"><span class="hl_varref"><span class="mpre">eventManagerArray</span></span></a><span class="mpre"> </span><a href="#loc_343_49_343_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_49_343_50&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
              </span><a name="loc_345_15_345_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_345_15_345_18&#39;)"><span class="hl_vardecl"><span class="mpre">tid</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_244_1_244_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_244_1_244_16&#39;)"><span class="hl_varref"><span class="mpre">restartPollLoop</span></span></a><span class="mpre"> </span><a href="#loc_344_23_344_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_23_344_26&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre"> </span><a href="#loc_343_49_343_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_49_343_50&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
              </span><a href="GHC.IOArray.html#loc_69_1_69_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IOArray.html#loc_69_1_69_13&#39;)"><span class="hl_varref"><span class="mpre">writeIOArray</span></span></a><span class="mpre"> </span><a href="#loc_322_5_322_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_322_5_322_22&#39;)"><span class="hl_varref"><span class="mpre">eventManagerArray</span></span></a><span class="mpre"> </span><a href="#loc_343_49_343_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_343_49_343_50&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> (</span><a href="#loc_345_15_345_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_345_15_345_18&#39;)"><span class="hl_varref"><span class="mpre">tid</span></span></a><span class="mpre">,</span><a href="#loc_344_23_344_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_344_23_344_26&#39;)"><span class="hl_varref"><span class="mpre">mgr</span></span></a><span class="mpre">))
</span></div></body></html>