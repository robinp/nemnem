<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Crypto.Random.AESCtr</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : stable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- this CPRNG is an AES based counter system.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the internal size of fields are: 16 bytes IV, 16 bytes counter, 32 bytes key</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- each block are generated the following way:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   aes (IV `xor` counter) -&gt; 16 bytes output</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
{-# LANGUAGE CPP #-}
{-# LANGUAGE BangPatterns #-}
module Crypto.Random.AESCtr
    ( AESRNG
    , make
    , makeSystem
    ) where

import Crypto.Random
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 8, srcSpanEndLine = 24, srcSpanEndColumn = 21}, srcInfoPoints = []}) &quot;System.Random&quot;"><span class="mpre">System.Random</span></span><span class="mpre"> (RandomGen(..))
import Crypto.Random.AESCtr.Internal
import Control.Arrow (</span><a href="Control.Arrow.html#loc_96_5_96_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Arrow.html#loc_96_5_96_11&#39;)"><span class="mpre">second</span></a><span class="mpre">)

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;, srcSpanStartLine = 28, srcSpanStartColumn = 8, srcSpanEndLine = 28, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;, srcSpanStartLine = 29, srcSpanStartColumn = 18, srcSpanEndLine = 29, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B

import Data.Byteable
import Data.Bits (</span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="mpre">xor</span></a><span class="mpre">, (.&amp;.))

</span><span class="hl_comment"><span class="mpre">-- | AES Counter mode Pseudo random generator.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Provide a very good Cryptographic pseudo random generator</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- that create pseudo random output based an AES cipher</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- used in counter mode, initialized from random key, random IV</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- and random nonce.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This CPRG uses 64 bytes of pure entropy to create its random state.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- By default, this generator will automatically reseed after generating</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- 1 megabyte of data.</span></span><span class="mpre">
data </span><a name="loc_45_6_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_6_45_12&#39;)"><span class="hl_tycondecl"><span class="mpre">AESRNG</span></span></a><span class="mpre"> = </span><span class="hl_condecl"><span class="mpre">AESRNG</span></span><span class="mpre"> { </span><a name="loc_45_24_45_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_24_45_35&#39;)"><span class="hl_fielddecl"><span class="mpre">aesrngState</span></span></a><span class="mpre">     :: </span><a href="Crypto.Random.AESCtr.Internal.html#loc_32_6_32_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_32_6_32_9&#39;)"><span class="hl_tyconref"><span class="mpre">RNG</span></span></a><span class="mpre">
                     , </span><a name="loc_46_24_46_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_24_46_37&#39;)"><span class="hl_fielddecl"><span class="mpre">aesrngEntropy</span></span></a><span class="mpre">   :: </span><a href="Crypto.Random.Entropy.html#loc_82_6_82_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.html#loc_82_6_82_17&#39;)"><span class="hl_tyconref"><span class="mpre">EntropyPool</span></span></a><span class="mpre">
                     , </span><a name="loc_47_24_47_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_24_47_39&#39;)"><span class="hl_fielddecl"><span class="mpre">aesrngThreshold</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ in number of generated block</span></span><span class="mpre">
                     , </span><a name="loc_48_24_48_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_24_48_35&#39;)"><span class="hl_fielddecl"><span class="mpre">aesrngCache</span></span></a><span class="mpre">     :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> }

instance </span><span class="hl_classref"><span class="mpre">Show</span></span><span class="mpre"> </span><a href="#loc_45_6_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_6_45_12&#39;)"><span class="hl_tyconref"><span class="mpre">AESRNG</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">show</span></span><span class="mpre"> _ = </span><span class="hl_string"><span class="mpre">&quot;aesrng[..]&quot;</span></span><span class="mpre">

</span><a href="#loc_54_1_54_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_9&#39;)"><span class="mpre">makeFrom</span></a><span class="mpre"> :: </span><a href="Crypto.Random.Entropy.html#loc_82_6_82_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.html#loc_82_6_82_17&#39;)"><span class="hl_tyconref"><span class="mpre">EntropyPool</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><a href="#loc_45_6_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_6_45_12&#39;)"><span class="hl_tyconref"><span class="mpre">AESRNG</span></span></a><span class="mpre">
</span><a name="loc_54_1_54_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_9&#39;)"><span class="hl_fundecl"><span class="mpre">makeFrom</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">entPool</span></span><span class="mpre"> </span><a name="loc_54_18_54_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_18_54_19&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 22, srcSpanEndLine = 58, srcSpanEndColumn = 37}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;, srcSpanStartLine = 55, srcSpanStartColumn = 5, srcSpanEndLine = 55, srcSpanEndColumn = 6},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;, srcS"><span class="mpre">AESRNG
    { aesrngState        = rng
    , aesrngEntropy      = entPool
    , aesrngThreshold    = 1024 </span><span class="hl_comment"><span class="mpre">-- in blocks generated, so 1mb</span></span><span class="mpre">
    , aesrngCache        = B.empty }</span></span><span class="mpre">
  where </span><span class="hl_vardecl"><span class="mpre">rng</span></span><span class="mpre">            = </span><a href="Crypto.Random.AESCtr.Internal.html#loc_32_12_32_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_32_12_32_15&#39;)"><span class="hl_conref"><span class="mpre">RNG</span></span></a><span class="mpre"> (</span><a href="Crypto.Random.AESCtr.Internal.html#loc_47_1_47_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_47_1_47_7&#39;)"><span class="hl_varref"><span class="mpre">get128</span></span></a><span class="mpre"> </span><a href="#loc_60_20_60_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_20_60_22&#39;)"><span class="hl_varref"><span class="mpre">iv</span></span></a><span class="mpre">) (</span><a href="Crypto.Random.AESCtr.Internal.html#loc_47_1_47_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_47_1_47_7&#39;)"><span class="hl_varref"><span class="mpre">get128</span></span></a><span class="mpre"> </span><a href="#loc_60_15_60_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_15_60_18&#39;)"><span class="hl_varref"><span class="mpre">cnt</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_60_10_60_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_10_60_13&#39;)"><span class="hl_varref"><span class="mpre">key</span></span></a><span class="mpre">
        (</span><a name="loc_60_10_60_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_10_60_13&#39;)"><span class="hl_vardecl"><span class="mpre">key</span></span></a><span class="mpre">, </span><a name="loc_60_15_60_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_15_60_18&#39;)"><span class="hl_vardecl"><span class="mpre">cnt</span></span></a><span class="mpre">, </span><a name="loc_60_20_60_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_60_20_60_22&#39;)"><span class="hl_vardecl"><span class="mpre">iv</span></span></a><span class="mpre">) = </span><a href="Crypto.Random.AESCtr.Internal.html#loc_66_1_66_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_66_1_66_11&#39;)"><span class="hl_varref"><span class="mpre">makeParams</span></span></a><span class="mpre"> </span><a href="#loc_54_18_54_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_18_54_19&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | make an AES RNG from an EntropyPool.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- use `makeSystem` to not have to deal with the entropy pool.</span></span><span class="mpre">
</span><a href="#loc_66_1_66_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_5&#39;)"><span class="mpre">make</span></a><span class="mpre"> :: </span><a href="Crypto.Random.Entropy.html#loc_82_6_82_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.html#loc_82_6_82_17&#39;)"><span class="hl_tyconref"><span class="mpre">EntropyPool</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_45_6_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_6_45_12&#39;)"><span class="hl_tyconref"><span class="mpre">AESRNG</span></span></a><span class="mpre">
</span><a name="loc_66_1_66_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_5&#39;)"><span class="hl_fundecl"><span class="mpre">make</span></span></a><span class="mpre"> </span><a name="loc_66_6_66_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_6_66_13&#39;)"><span class="hl_vardecl"><span class="mpre">entPool</span></span></a><span class="mpre"> = </span><a href="#loc_54_1_54_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_9&#39;)"><span class="hl_varref"><span class="mpre">makeFrom</span></span></a><span class="mpre"> </span><a href="#loc_66_6_66_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_6_66_13&#39;)"><span class="hl_varref"><span class="mpre">entPool</span></span></a><span class="mpre"> </span><a href="#loc_67_10_67_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_10_67_11&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
  where !</span><a name="loc_67_10_67_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_10_67_11&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = </span><a href="Data.Byteable.html#loc_24_5_24_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Byteable.html#loc_24_5_24_12&#39;)"><span class="hl_varref"><span class="mpre">toBytes</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Crypto.Random.Entropy.html#loc_152_1_152_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.html#loc_152_1_152_12&#39;)"><span class="hl_varref"><span class="mpre">grabEntropy</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">64</span></span><span class="mpre"> </span><a href="#loc_66_6_66_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_6_66_13&#39;)"><span class="hl_varref"><span class="mpre">entPool</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Initialize a new AES RNG using the system entropy.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- {-# DEPRECATED makeSystem &quot;use cprgCreate with an entropy pool&quot; #-}</span></span><span class="mpre">
</span><a href="#loc_72_1_72_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_1_72_11&#39;)"><span class="mpre">makeSystem</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_45_6_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_6_45_12&#39;)"><span class="hl_tyconref"><span class="mpre">AESRNG</span></span></a><span class="mpre">
</span><a name="loc_72_1_72_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_1_72_11&#39;)"><span class="hl_vardecl"><span class="mpre">makeSystem</span></span></a><span class="mpre"> = </span><a href="#loc_66_1_66_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_5&#39;)"><span class="hl_varref"><span class="mpre">make</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><a href="Crypto.Random.Entropy.html#loc_103_1_103_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.html#loc_103_1_103_18&#39;)"><span class="hl_varref"><span class="mpre">createEntropyPool</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | get a Random number of bytes from the RNG.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- it generate randomness by block of chunkSize bytes and will returns</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a block bigger or equal to the size requested.</span></span><span class="mpre">
</span><a href="#loc_78_1_78_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_20&#39;)"><span class="mpre">genRandomBytesState</span></a><span class="mpre"> :: </span><a href="Crypto.Random.AESCtr.Internal.html#loc_32_6_32_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_32_6_32_9&#39;)"><span class="hl_tyconref"><span class="mpre">RNG</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">, </span><a href="Crypto.Random.AESCtr.Internal.html#loc_32_6_32_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_32_6_32_9&#39;)"><span class="hl_tyconref"><span class="mpre">RNG</span></span></a><span class="mpre">)
</span><a name="loc_78_1_78_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_20&#39;)"><span class="hl_fundecl"><span class="mpre">genRandomBytesState</span></span></a><span class="mpre"> </span><a name="loc_78_21_78_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_21_78_24&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a name="loc_78_25_78_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_25_78_26&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">
    | </span><a href="#loc_78_25_78_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_25_78_26&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><a href="Crypto.Random.AESCtr.Internal.html#loc_73_1_73_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_73_1_73_10&#39;)"><span class="hl_varref"><span class="mpre">chunkSize</span></span></a><span class="mpre"> = </span><a href="Crypto.Random.AESCtr.Internal.html#loc_76_1_76_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_76_1_76_13&#39;)"><span class="hl_varref"><span class="mpre">genNextChunk</span></span></a><span class="mpre"> </span><a href="#loc_78_21_78_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_21_78_24&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">      = let (</span><a name="loc_80_29_80_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_29_80_31&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">, </span><a name="loc_80_33_80_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_33_80_37&#39;)"><span class="hl_vardecl"><span class="mpre">rng&#39;</span></span></a><span class="mpre">) = </span><a href="#loc_82_9_82_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_9_82_12&#39;)"><span class="hl_varref"><span class="mpre">acc</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> [] </span><a href="#loc_78_21_78_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_21_78_24&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre">
                        in (</span><span class="hl_varref"><span class="mpre">B.concat</span></span><span class="mpre"> </span><a href="#loc_80_29_80_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_29_80_31&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">, </span><a href="#loc_80_33_80_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_33_80_37&#39;)"><span class="hl_varref"><span class="mpre">rng&#39;</span></span></a><span class="mpre">)
  where </span><a name="loc_82_9_82_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_9_82_12&#39;)"><span class="hl_fundecl"><span class="mpre">acc</span></span></a><span class="mpre"> </span><a name="loc_82_13_82_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_13_82_14&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> </span><a name="loc_82_15_82_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_15_82_17&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a name="loc_82_18_82_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_18_82_19&#39;)"><span class="hl_vardecl"><span class="mpre">g</span></span></a><span class="mpre">
            | </span><a href="#loc_82_13_82_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_13_82_14&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><a href="Crypto.Random.AESCtr.Internal.html#loc_73_1_73_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_73_1_73_10&#39;)"><span class="hl_varref"><span class="mpre">chunkSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="#loc_78_25_78_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_25_78_26&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> = (</span><a href="#loc_82_15_82_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_15_82_17&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">, </span><a href="#loc_82_18_82_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_18_82_19&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre">)
            | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">          = let (</span><a name="loc_84_41_84_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_41_84_42&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">, </span><a name="loc_84_44_84_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_44_84_46&#39;)"><span class="hl_vardecl"><span class="mpre">g&#39;</span></span></a><span class="mpre">) = </span><a href="Crypto.Random.AESCtr.Internal.html#loc_76_1_76_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_76_1_76_13&#39;)"><span class="hl_varref"><span class="mpre">genNextChunk</span></span></a><span class="mpre"> </span><a href="#loc_82_18_82_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_18_82_19&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre">
                                    in </span><a href="#loc_82_9_82_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_9_82_12&#39;)"><span class="hl_varref"><span class="mpre">acc</span></span></a><span class="mpre"> (</span><a href="#loc_82_13_82_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_13_82_14&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) (</span><a href="#loc_84_41_84_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_41_84_42&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_82_15_82_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_15_82_17&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">) </span><a href="#loc_84_44_84_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_44_84_46&#39;)"><span class="hl_varref"><span class="mpre">g&#39;</span></span></a><span class="mpre">

</span><a href="#loc_88_1_88_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_19&#39;)"><span class="mpre">genRanBytesNoCheck</span></a><span class="mpre"> :: </span><a href="#loc_45_6_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_6_45_12&#39;)"><span class="hl_tyconref"><span class="mpre">AESRNG</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">, </span><a href="#loc_45_6_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_6_45_12&#39;)"><span class="hl_tyconref"><span class="mpre">AESRNG</span></span></a><span class="mpre">)
</span><a name="loc_88_1_88_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_19&#39;)"><span class="hl_fundecl"><span class="mpre">genRanBytesNoCheck</span></span></a><span class="mpre"> </span><a name="loc_88_20_88_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_20_88_23&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a name="loc_88_24_88_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_24_88_25&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> (</span><a href="#loc_48_24_48_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_24_48_35&#39;)"><span class="hl_varref"><span class="mpre">aesrngCache</span></span></a><span class="mpre"> </span><a href="#loc_88_20_88_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_20_88_23&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="#loc_88_24_88_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_24_88_25&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> = let (</span><a name="loc_89_46_89_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_46_89_48&#39;)"><span class="hl_vardecl"><span class="mpre">b1</span></span></a><span class="mpre">,</span><span class="hl_vardecl"><span class="mpre">b2</span></span><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">B.splitAt</span></span><span class="mpre"> </span><a href="#loc_88_24_88_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_24_88_25&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> (</span><a href="#loc_48_24_48_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_24_48_35&#39;)"><span class="hl_varref"><span class="mpre">aesrngCache</span></span></a><span class="mpre"> </span><a href="#loc_88_20_88_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_20_88_23&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre">)
                                         in (</span><a href="#loc_89_46_89_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_46_89_48&#39;)"><span class="hl_varref"><span class="mpre">b1</span></span></a><span class="mpre">, </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;, srcSpanStartLine = 90, srcSpanStartColumn = 50, srcSpanEndLine = 90, srcSpanEndColumn = 74}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;, srcSpanStartLine = 90, srcSpanStartColumn = 54, srcSpanEndLine = 90, srcSpanEndColumn = 55},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;, sr"><span class="mpre">rng { aesrngCache = b2 }</span></span><span class="mpre">)
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">                       =
        let (</span><a name="loc_92_14_92_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_14_92_15&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">rng&#39;</span></span><span class="mpre">) = </span><a href="#loc_78_1_78_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_20&#39;)"><span class="hl_varref"><span class="mpre">genRandomBytesState</span></span></a><span class="mpre"> (</span><a href="#loc_45_24_45_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_24_45_35&#39;)"><span class="hl_varref"><span class="mpre">aesrngState</span></span></a><span class="mpre"> </span><a href="#loc_88_20_88_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_20_88_23&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre">) </span><a href="#loc_88_24_88_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_24_88_25&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
            (</span><a name="loc_93_14_93_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_14_93_16&#39;)"><span class="hl_vardecl"><span class="mpre">b1</span></span></a><span class="mpre">, </span><span class="hl_vardecl"><span class="mpre">b2</span></span><span class="mpre">)  = </span><span class="hl_varref"><span class="mpre">B.splitAt</span></span><span class="mpre"> </span><a href="#loc_88_24_88_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_24_88_25&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_92_14_92_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_14_92_15&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
         in (</span><a href="#loc_93_14_93_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_14_93_16&#39;)"><span class="hl_varref"><span class="mpre">b1</span></span></a><span class="mpre">, </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;, srcSpanStartLine = 94, srcSpanStartColumn = 18, srcSpanEndLine = 94, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;, srcSpanStartLine = 94, srcSpanStartColumn = 22, srcSpanEndLine = 94, srcSpanEndColumn = 23},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;, sr"><span class="mpre">rng { aesrngState = rng&#39;, aesrngCache = b2 }</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | generate a random set of bytes</span></span><span class="mpre">
</span><a href="#loc_98_1_98_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_12&#39;)"><span class="mpre">genRanBytes</span></a><span class="mpre"> :: </span><a href="#loc_45_6_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_6_45_12&#39;)"><span class="hl_tyconref"><span class="mpre">AESRNG</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">, </span><a href="#loc_45_6_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_6_45_12&#39;)"><span class="hl_tyconref"><span class="mpre">AESRNG</span></span></a><span class="mpre">)
</span><a name="loc_98_1_98_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_12&#39;)"><span class="hl_fundecl"><span class="mpre">genRanBytes</span></span></a><span class="mpre"> </span><a name="loc_98_13_98_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_13_98_16&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a name="loc_98_17_98_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_17_98_18&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><a href="Control.Arrow.html#loc_96_5_96_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Arrow.html#loc_96_5_96_11&#39;)"><span class="hl_varref"><span class="mpre">second</span></span></a><span class="mpre"> </span><a href="#loc_101_1_101_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_16&#39;)"><span class="hl_varref"><span class="mpre">reseedThreshold</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_88_1_88_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_19&#39;)"><span class="hl_varref"><span class="mpre">genRanBytesNoCheck</span></span></a><span class="mpre"> </span><a href="#loc_98_13_98_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_13_98_16&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a href="#loc_98_17_98_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_17_98_18&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">

</span><a href="#loc_101_1_101_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_16&#39;)"><span class="mpre">reseedThreshold</span></a><span class="mpre"> :: </span><a href="#loc_45_6_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_6_45_12&#39;)"><span class="hl_tyconref"><span class="mpre">AESRNG</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_45_6_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_6_45_12&#39;)"><span class="hl_tyconref"><span class="mpre">AESRNG</span></span></a><span class="mpre">
</span><a name="loc_101_1_101_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_16&#39;)"><span class="hl_fundecl"><span class="mpre">reseedThreshold</span></span></a><span class="mpre"> </span><a name="loc_101_17_101_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_17_101_20&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre">
    | </span><a href="Crypto.Random.AESCtr.Internal.html#loc_39_1_39_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_39_1_39_21&#39;)"><span class="hl_varref"><span class="mpre">getNbChunksGenerated</span></span></a><span class="mpre"> (</span><a href="#loc_45_24_45_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_24_45_35&#39;)"><span class="hl_varref"><span class="mpre">aesrngState</span></span></a><span class="mpre"> </span><a href="#loc_101_17_101_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_17_101_20&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><a href="#loc_107_9_107_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_12&#39;)"><span class="hl_varref"><span class="mpre">lvl</span></span></a><span class="mpre"> =
         let </span><span class="hl_vardecl"><span class="mpre">ent</span></span><span class="mpre"> = </span><a href="Data.Byteable.html#loc_24_5_24_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Byteable.html#loc_24_5_24_12&#39;)"><span class="hl_varref"><span class="mpre">toBytes</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Crypto.Random.Entropy.html#loc_152_1_152_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.html#loc_152_1_152_12&#39;)"><span class="hl_varref"><span class="mpre">grabEntropy</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">64</span></span><span class="mpre"> (</span><a href="#loc_46_24_46_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_24_46_37&#39;)"><span class="hl_varref"><span class="mpre">aesrngEntropy</span></span></a><span class="mpre"> </span><a href="#loc_101_17_101_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_17_101_20&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre">)
          in </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;, srcSpanStartLine = 104, srcSpanStartColumn = 14, srcSpanEndLine = 104, srcSpanEndColumn = 69}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;, srcSpanStartLine = 104, srcSpanStartColumn = 18, srcSpanEndLine = 104, srcSpanEndColumn = 19},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;"><span class="mpre">rng { aesrngState = reseedState ent (aesrngState rng) }</span></span><span class="mpre">
    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">  = </span><a href="#loc_101_17_101_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_17_101_20&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre">
  where
        </span><a name="loc_107_9_107_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_9_107_12&#39;)"><span class="hl_vardecl"><span class="mpre">lvl</span></span></a><span class="mpre"> = </span><a href="#loc_47_24_47_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_24_47_39&#39;)"><span class="hl_varref"><span class="mpre">aesrngThreshold</span></span></a><span class="mpre"> </span><a href="#loc_101_17_101_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_17_101_20&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre">
        </span><a href="#loc_109_9_109_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_9_109_20&#39;)"><span class="mpre">reseedState</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><a href="Crypto.Random.AESCtr.Internal.html#loc_32_6_32_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_32_6_32_9&#39;)"><span class="hl_tyconref"><span class="mpre">RNG</span></span></a><span class="mpre"> -&gt; </span><a href="Crypto.Random.AESCtr.Internal.html#loc_32_6_32_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_32_6_32_9&#39;)"><span class="hl_tyconref"><span class="mpre">RNG</span></span></a><span class="mpre">
        </span><a name="loc_109_9_109_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_9_109_20&#39;)"><span class="hl_fundecl"><span class="mpre">reseedState</span></span></a><span class="mpre"> </span><a name="loc_109_21_109_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_21_109_22&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> </span><a name="loc_109_23_109_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_23_109_24&#39;)"><span class="hl_specname"><span class="mpre">g</span></span></a><span class="mpre">@(</span><a href="Crypto.Random.AESCtr.Internal.html#loc_32_12_32_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_32_12_32_15&#39;)"><span class="hl_conref"><span class="mpre">RNG</span></span></a><span class="mpre"> _ </span><a name="loc_109_32_109_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_32_109_36&#39;)"><span class="hl_vardecl"><span class="mpre">cnt1</span></span></a><span class="mpre"> _ _) = </span><a href="Crypto.Random.AESCtr.Internal.html#loc_32_12_32_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_32_12_32_15&#39;)"><span class="hl_conref"><span class="mpre">RNG</span></span></a><span class="mpre"> (</span><a href="Crypto.Random.AESCtr.Internal.html#loc_47_1_47_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_47_1_47_7&#39;)"><span class="hl_varref"><span class="mpre">get128</span></span></a><span class="mpre"> </span><a href="#loc_110_20_110_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_20_110_23&#39;)"><span class="hl_varref"><span class="mpre">r16</span></span></a><span class="mpre"> </span><a href="Crypto.Random.AESCtr.Internal.html#loc_54_1_54_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_54_1_54_7&#39;)"><span class="hl_infix"><span class="mpre">`xor128`</span></span></a><span class="mpre"> </span><a href="Crypto.Random.AESCtr.Internal.html#loc_47_1_47_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_47_1_47_7&#39;)"><span class="hl_varref"><span class="mpre">get128</span></span></a><span class="mpre"> </span><a href="#loc_111_32_111_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_32_111_35&#39;)"><span class="hl_varref"><span class="mpre">iv2</span></span></a><span class="mpre">) (</span><a href="#loc_109_32_109_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_32_109_36&#39;)"><span class="hl_varref"><span class="mpre">cnt1</span></span></a><span class="mpre"> </span><a href="Crypto.Random.AESCtr.Internal.html#loc_54_1_54_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_54_1_54_7&#39;)"><span class="hl_infix"><span class="mpre">`xor128`</span></span></a><span class="mpre"> </span><a href="Crypto.Random.AESCtr.Internal.html#loc_47_1_47_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_47_1_47_7&#39;)"><span class="hl_varref"><span class="mpre">get128</span></span></a><span class="mpre"> </span><a href="#loc_111_26_111_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_26_111_30&#39;)"><span class="hl_varref"><span class="mpre">cnt2</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_111_20_111_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_20_111_24&#39;)"><span class="hl_varref"><span class="mpre">key2</span></span></a><span class="mpre">
            where (</span><a name="loc_110_20_110_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_20_110_23&#39;)"><span class="hl_vardecl"><span class="mpre">r16</span></span></a><span class="mpre">, _)          = </span><a href="Crypto.Random.AESCtr.Internal.html#loc_76_1_76_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_76_1_76_13&#39;)"><span class="hl_varref"><span class="mpre">genNextChunk</span></span></a><span class="mpre"> </span><a href="#loc_109_23_109_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_23_109_24&#39;)"><span class="hl_varref"><span class="mpre">g</span></span></a><span class="mpre">
                  (</span><a name="loc_111_20_111_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_20_111_24&#39;)"><span class="hl_vardecl"><span class="mpre">key2</span></span></a><span class="mpre">, </span><a name="loc_111_26_111_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_26_111_30&#39;)"><span class="hl_vardecl"><span class="mpre">cnt2</span></span></a><span class="mpre">, </span><a name="loc_111_32_111_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_32_111_35&#39;)"><span class="hl_vardecl"><span class="mpre">iv2</span></span></a><span class="mpre">) = </span><a href="Crypto.Random.AESCtr.Internal.html#loc_66_1_66_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_66_1_66_11&#39;)"><span class="hl_varref"><span class="mpre">makeParams</span></span></a><span class="mpre"> </span><a href="#loc_109_21_109_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_21_109_22&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

instance </span><a href="Crypto.Random.Generator.html#loc_16_7_16_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Generator.html#loc_16_7_16_11&#39;)"><span class="hl_classref"><span class="mpre">CPRG</span></span></a><span class="mpre"> </span><a href="#loc_45_6_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_6_45_12&#39;)"><span class="hl_tyconref"><span class="mpre">AESRNG</span></span></a><span class="mpre"> where
    </span><span class="hl_vardecl"><span class="mpre">cprgCreate</span></span><span class="mpre">                      = </span><a href="#loc_66_1_66_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_5&#39;)"><span class="hl_varref"><span class="mpre">make</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">cprgSetReseedThreshold</span></span><span class="mpre"> </span><a name="loc_115_28_115_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_28_115_31&#39;)"><span class="hl_vardecl"><span class="mpre">lvl</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">rng</span></span><span class="mpre">  = </span><a href="#loc_101_1_101_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_16&#39;)"><span class="hl_varref"><span class="mpre">reseedThreshold</span></span></a><span class="mpre"> (</span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;, srcSpanStartLine = 115, srcSpanStartColumn = 56, srcSpanEndLine = 115, srcSpanEndColumn = 118}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs&quot;, srcSpanStartLine = 115, srcSpanStartColumn = 60, srcSpanEndLine = 115, srcSpanEndColumn = 61},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/cprng-aes-0.5.2/Crypto/Random/AESCtr.hs"><span class="mpre">rng { aesrngThreshold = if nbChunks &gt; 0 then nbChunks else 1 }</span></span><span class="mpre">)
      where </span><span class="hl_vardecl"><span class="mpre">nbChunks</span></span><span class="mpre"> = </span><a href="#loc_115_28_115_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_28_115_31&#39;)"><span class="hl_varref"><span class="mpre">lvl</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`div`</span></span><span class="mpre"> </span><a href="Crypto.Random.AESCtr.Internal.html#loc_73_1_73_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_73_1_73_10&#39;)"><span class="hl_varref"><span class="mpre">chunkSize</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">cprgGenerate</span></span><span class="mpre"> </span><a name="loc_117_18_117_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_18_117_21&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_117_22_117_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_22_117_25&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre">            = </span><a href="#loc_98_1_98_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_12&#39;)"><span class="hl_varref"><span class="mpre">genRanBytes</span></span></a><span class="mpre"> </span><a href="#loc_117_22_117_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_22_117_25&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a href="#loc_117_18_117_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_18_117_21&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
    </span><span class="hl_fundecl"><span class="mpre">cprgGenerateWithEntropy</span></span><span class="mpre"> </span><a name="loc_118_29_118_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_29_118_32&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre"> </span><a name="loc_118_33_118_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_33_118_36&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> =
        let </span><a name="loc_119_13_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_13_119_16&#39;)"><span class="hl_vardecl"><span class="mpre">ent</span></span></a><span class="mpre">        = </span><a href="Data.Byteable.html#loc_24_5_24_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Byteable.html#loc_24_5_24_12&#39;)"><span class="hl_varref"><span class="mpre">toBytes</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Crypto.Random.Entropy.html#loc_152_1_152_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.html#loc_152_1_152_12&#39;)"><span class="hl_varref"><span class="mpre">grabEntropy</span></span></a><span class="mpre"> </span><a href="#loc_118_29_118_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_29_118_32&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre"> (</span><a href="#loc_46_24_46_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_24_46_37&#39;)"><span class="hl_varref"><span class="mpre">aesrngEntropy</span></span></a><span class="mpre"> </span><a href="#loc_118_33_118_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_33_118_36&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre">)
            (</span><a name="loc_120_14_120_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_14_120_16&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">, </span><a name="loc_120_18_120_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_18_120_22&#39;)"><span class="hl_vardecl"><span class="mpre">rng&#39;</span></span></a><span class="mpre">) = </span><a href="#loc_98_1_98_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_12&#39;)"><span class="hl_varref"><span class="mpre">genRanBytes</span></span></a><span class="mpre"> </span><a href="#loc_118_33_118_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_33_118_36&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre"> </span><a href="#loc_118_29_118_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_29_118_32&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
         in (</span><span class="hl_varref"><span class="mpre">B.pack</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.zipWith</span></span><span class="mpre"> </span><a href="Data.Bits.html#loc_87_5_87_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Bits.html#loc_87_5_87_8&#39;)"><span class="hl_varref"><span class="mpre">xor</span></span></a><span class="mpre"> </span><a href="#loc_119_13_119_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_13_119_16&#39;)"><span class="hl_varref"><span class="mpre">ent</span></span></a><span class="mpre"> </span><a href="#loc_120_14_120_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_14_120_16&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">, </span><a href="#loc_120_18_120_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_18_120_22&#39;)"><span class="hl_varref"><span class="mpre">rng&#39;</span></span></a><span class="mpre">)
    </span><span class="hl_fundecl"><span class="mpre">cprgFork</span></span><span class="mpre"> </span><a name="loc_122_14_122_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_14_122_17&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> = let (</span><a name="loc_122_25_122_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_25_122_26&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">,</span><a name="loc_122_27_122_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_27_122_31&#39;)"><span class="hl_vardecl"><span class="mpre">rng&#39;</span></span></a><span class="mpre">) = </span><a href="#loc_98_1_98_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_12&#39;)"><span class="hl_varref"><span class="mpre">genRanBytes</span></span></a><span class="mpre"> </span><a href="#loc_122_14_122_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_14_122_17&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">64</span></span><span class="mpre">
                    in (</span><a href="#loc_122_27_122_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_27_122_31&#39;)"><span class="hl_varref"><span class="mpre">rng&#39;</span></span></a><span class="mpre">, </span><a href="#loc_54_1_54_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_54_1_54_9&#39;)"><span class="hl_varref"><span class="mpre">makeFrom</span></span></a><span class="mpre"> (</span><a href="#loc_46_24_46_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_24_46_37&#39;)"><span class="hl_varref"><span class="mpre">aesrngEntropy</span></span></a><span class="mpre"> </span><a href="#loc_122_14_122_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_14_122_17&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre">) </span><a href="#loc_122_25_122_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_25_122_26&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">)

instance </span><span class="hl_classref"><span class="mpre">RandomGen</span></span><span class="mpre"> </span><a href="#loc_45_6_45_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_6_45_12&#39;)"><span class="hl_tyconref"><span class="mpre">AESRNG</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">next</span></span><span class="mpre"> </span><a name="loc_126_10_126_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_10_126_13&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> =
        let (</span><a name="loc_127_14_127_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_14_127_16&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">, </span><a name="loc_127_18_127_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_18_127_22&#39;)"><span class="hl_vardecl"><span class="mpre">rng&#39;</span></span></a><span class="mpre">) = </span><a href="#loc_98_1_98_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_1_98_12&#39;)"><span class="hl_varref"><span class="mpre">genRanBytes</span></span></a><span class="mpre"> </span><a href="#loc_126_10_126_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_10_126_13&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">16</span></span><span class="mpre"> in
        let (</span><a href="Crypto.Random.AESCtr.Internal.html#loc_29_16_29_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_29_16_29_23&#39;)"><span class="hl_conref"><span class="mpre">Word128</span></span></a><span class="mpre"> </span><a name="loc_128_22_128_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_22_128_23&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> _) = </span><a href="Crypto.Random.AESCtr.Internal.html#loc_47_1_47_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.AESCtr.Internal.html#loc_47_1_47_7&#39;)"><span class="hl_varref"><span class="mpre">get128</span></span></a><span class="mpre"> </span><a href="#loc_127_14_127_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_14_127_16&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> in
        let </span><a name="loc_129_13_129_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_13_129_14&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><a href="#loc_128_22_128_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_22_128_23&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.&amp;.</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x7fffffff</span></span><span class="mpre">) in
        (</span><a href="#loc_129_13_129_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_13_129_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">, </span><a href="#loc_127_18_127_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_18_127_22&#39;)"><span class="hl_varref"><span class="mpre">rng&#39;</span></span></a><span class="mpre">)
    </span><span class="hl_fundecl"><span class="mpre">split</span></span><span class="mpre"> </span><a name="loc_131_11_131_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_11_131_14&#39;)"><span class="hl_vardecl"><span class="mpre">rng</span></span></a><span class="mpre"> =
        let </span><a name="loc_132_13_132_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_13_132_17&#39;)"><span class="hl_vardecl"><span class="mpre">rng&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_66_1_66_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_1_66_5&#39;)"><span class="hl_varref"><span class="mpre">make</span></span></a><span class="mpre"> (</span><a href="#loc_46_24_46_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_24_46_37&#39;)"><span class="hl_varref"><span class="mpre">aesrngEntropy</span></span></a><span class="mpre"> </span><a href="#loc_131_11_131_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_11_131_14&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre">)
         in (</span><a href="#loc_131_11_131_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_11_131_14&#39;)"><span class="hl_varref"><span class="mpre">rng</span></span></a><span class="mpre">, </span><a href="#loc_132_13_132_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_13_132_17&#39;)"><span class="hl_varref"><span class="mpre">rng&#39;</span></span></a><span class="mpre">)
    </span><span class="hl_fundecl"><span class="mpre">genRange</span></span><span class="mpre"> _ = (</span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">, </span><span class="hl_num"><span class="mpre">0x7fffffff</span></span><span class="mpre">)
</span></div></body></html>