<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE CPP #-}
#ifdef __GLASGOW_HASKELL__
{-# LANGUAGE Safe #-}
#endif
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Andy Gill and Colin Runciman, June 2006</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Datatypes and file-access routines for the tick data file</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- (@.tix@) used by Hpc.</span></span><span class="mpre">
module Trace.Hpc.Tix(Tix(..), TixModule(..),
                     tixModuleName, tixModuleHash, tixModuleTixs,
                     readTix, writeTix, getTixFileName) where

import Data.List (</span><a href="Data.List.html#loc_294_1_294_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_294_1_294_11&#39;)"><span class="mpre">isSuffixOf</span></a><span class="mpre">)
import Trace.Hpc.Util (</span><a href="Trace.Hpc.Util.html#loc_69_9_69_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Trace.Hpc.Util.html#loc_69_9_69_13&#39;)"><span class="mpre">Hash</span></a><span class="mpre">, </span><a href="Trace.Hpc.Util.html#loc_114_1_114_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Trace.Hpc.Util.html#loc_114_1_114_8&#39;)"><span class="mpre">catchIO</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | &#39;Tix&#39; is the storage format for our dynamic imformation about</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- what boxes are ticked.</span></span><span class="mpre">
data </span><a name="loc_20_6_20_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_6_20_9&#39;)"><span class="hl_tycondecl"><span class="mpre">Tix</span></span></a><span class="mpre"> = </span><a name="loc_20_12_20_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_12_20_15&#39;)"><span class="hl_condecl"><span class="mpre">Tix</span></span></a><span class="mpre"> [</span><a href="#loc_23_6_23_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_6_23_15&#39;)"><span class="hl_tyconref"><span class="mpre">TixModule</span></span></a><span class="mpre">]
        </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hpc-0.6.0.1/Trace/Hpc/Tix.hs&quot;, srcSpanStartLine = 21, srcSpanStartColumn = 9, srcSpanEndLine = 21, srcSpanEndColumn = 34}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hpc-0.6.0.1/Trace/Hpc/Tix.hs&quot;, srcSpanStartLine = 21, srcSpanStartColumn = 9, srcSpanEndLine = 21, srcSpanEndColumn = 17},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hpc-0.6.0.1/Trace/Hpc/Tix.hs&quot;, srcSpanStartLine = 21, srcSpanStartCol"><span class="mpre">deriving (Read, Show, Eq)</span></span><span class="mpre">

data </span><a name="loc_23_6_23_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_6_23_15&#39;)"><span class="hl_tycondecl"><span class="mpre">TixModule</span></span></a><span class="mpre"> = </span><a name="loc_23_18_23_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_18_23_27&#39;)"><span class="hl_condecl"><span class="mpre">TixModule</span></span></a><span class="mpre">
                 </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">--  module name</span></span><span class="mpre">
                 </span><a href="Trace.Hpc.Util.html#loc_69_9_69_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Trace.Hpc.Util.html#loc_69_9_69_13&#39;)"><span class="hl_tyconref"><span class="mpre">Hash</span></span></a><span class="mpre">      </span><span class="hl_comment"><span class="mpre">--  hash number</span></span><span class="mpre">
                 </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">       </span><span class="hl_comment"><span class="mpre">--  length of Tix list (allows pre-allocation at parse time).</span></span><span class="mpre">
                 [</span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">] </span><span class="hl_comment"><span class="mpre">--  actual ticks</span></span><span class="mpre">
        </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hpc-0.6.0.1/Trace/Hpc/Tix.hs&quot;, srcSpanStartLine = 28, srcSpanStartColumn = 9, srcSpanEndLine = 28, srcSpanEndColumn = 34}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hpc-0.6.0.1/Trace/Hpc/Tix.hs&quot;, srcSpanStartLine = 28, srcSpanStartColumn = 9, srcSpanEndLine = 28, srcSpanEndColumn = 17},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/hpc-0.6.0.1/Trace/Hpc/Tix.hs&quot;, srcSpanStartLine = 28, srcSpanStartCol"><span class="mpre">deriving (Read, Show, Eq)</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- TODO: Turn extractors below into proper &#39;TixModule&#39; field-labels</span></span><span class="mpre">
</span><a href="#loc_32_1_32_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_1_32_14&#39;)"><span class="mpre">tixModuleName</span></a><span class="mpre"> :: </span><a href="#loc_23_6_23_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_6_23_15&#39;)"><span class="hl_tyconref"><span class="mpre">TixModule</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_32_1_32_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_1_32_14&#39;)"><span class="hl_fundecl"><span class="mpre">tixModuleName</span></span></a><span class="mpre"> (</span><a href="#loc_23_18_23_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_18_23_27&#39;)"><span class="hl_conref"><span class="mpre">TixModule</span></span></a><span class="mpre"> </span><a name="loc_32_26_32_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_26_32_28&#39;)"><span class="hl_vardecl"><span class="mpre">nm</span></span></a><span class="mpre"> _ _ _) = </span><a href="#loc_32_26_32_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_26_32_28&#39;)"><span class="hl_varref"><span class="mpre">nm</span></span></a><span class="mpre">
</span><a href="#loc_34_1_34_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_14&#39;)"><span class="mpre">tixModuleHash</span></a><span class="mpre"> :: </span><a href="#loc_23_6_23_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_6_23_15&#39;)"><span class="hl_tyconref"><span class="mpre">TixModule</span></span></a><span class="mpre"> -&gt; </span><a href="Trace.Hpc.Util.html#loc_69_9_69_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Trace.Hpc.Util.html#loc_69_9_69_13&#39;)"><span class="hl_tyconref"><span class="mpre">Hash</span></span></a><span class="mpre">
</span><a name="loc_34_1_34_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_14&#39;)"><span class="hl_fundecl"><span class="mpre">tixModuleHash</span></span></a><span class="mpre"> (</span><a href="#loc_23_18_23_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_18_23_27&#39;)"><span class="hl_conref"><span class="mpre">TixModule</span></span></a><span class="mpre"> _ </span><a name="loc_34_28_34_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_28_34_29&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre">  _ _) = </span><a href="#loc_34_28_34_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_28_34_29&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
</span><a href="#loc_36_1_36_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_14&#39;)"><span class="mpre">tixModuleTixs</span></a><span class="mpre"> :: </span><a href="#loc_23_6_23_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_6_23_15&#39;)"><span class="hl_tyconref"><span class="mpre">TixModule</span></span></a><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">Integer</span></span><span class="mpre">]
</span><a name="loc_36_1_36_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_1_36_14&#39;)"><span class="hl_fundecl"><span class="mpre">tixModuleTixs</span></span></a><span class="mpre"> (</span><a href="#loc_23_18_23_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_18_23_27&#39;)"><span class="hl_conref"><span class="mpre">TixModule</span></span></a><span class="mpre">  _ _ _ </span><a name="loc_36_33_36_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_33_36_37&#39;)"><span class="hl_vardecl"><span class="mpre">tixs</span></span></a><span class="mpre">) = </span><a href="#loc_36_33_36_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_33_36_37&#39;)"><span class="hl_varref"><span class="mpre">tixs</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- We /always/ read and write Tix from the current working directory.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Read a @.tix@ File.</span></span><span class="mpre">
</span><a href="#loc_43_1_43_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_8&#39;)"><span class="mpre">readTix</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="#loc_20_6_20_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_6_20_9&#39;)"><span class="hl_tyconref"><span class="mpre">Tix</span></span></a><span class="mpre">)
</span><a name="loc_43_1_43_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_1_43_8&#39;)"><span class="hl_fundecl"><span class="mpre">readTix</span></span></a><span class="mpre"> </span><a name="loc_43_9_43_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_9_43_21&#39;)"><span class="hl_vardecl"><span class="mpre">tix_filename</span></span></a><span class="mpre"> =
  </span><a href="Trace.Hpc.Util.html#loc_114_1_114_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Trace.Hpc.Util.html#loc_114_1_114_8&#39;)"><span class="hl_varref"><span class="mpre">catchIO</span></span></a><span class="mpre"> (do </span><a name="loc_44_15_44_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_15_44_23&#39;)"><span class="hl_vardecl"><span class="mpre">contents</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readFile</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_43_9_43_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_9_43_21&#39;)"><span class="hl_varref"><span class="mpre">tix_filename</span></span></a><span class="mpre">
              </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">read</span></span><span class="mpre"> </span><a href="#loc_44_15_44_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_15_44_23&#39;)"><span class="hl_varref"><span class="mpre">contents</span></span></a><span class="mpre">)
          (\ _ -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Write a @.tix@ File.</span></span><span class="mpre">
</span><a href="#loc_52_1_52_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_9&#39;)"><span class="mpre">writeTix</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
         -&gt; </span><a href="#loc_20_6_20_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_20_6_20_9&#39;)"><span class="hl_tyconref"><span class="mpre">Tix</span></span></a><span class="mpre">
         -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_52_1_52_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_1_52_9&#39;)"><span class="hl_fundecl"><span class="mpre">writeTix</span></span></a><span class="mpre"> </span><a name="loc_52_10_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_10_52_14&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre"> </span><a name="loc_52_15_52_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_15_52_18&#39;)"><span class="hl_vardecl"><span class="mpre">tix</span></span></a><span class="mpre"> =
  </span><span class="hl_varref"><span class="mpre">writeFile</span></span><span class="mpre"> </span><a href="#loc_52_10_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_10_52_14&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_52_15_52_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_15_52_18&#39;)"><span class="hl_varref"><span class="mpre">tix</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">{-
tixName :: String -&gt; String
tixName name = name ++ &quot;.tix&quot;
-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | &#39;getTixFullName&#39; takes a binary or @.tix@-file name,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- and normalizes it into a @.tix@-file name.</span></span><span class="mpre">
</span><a href="#loc_63_1_63_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_1_63_15&#39;)"><span class="mpre">getTixFileName</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_63_1_63_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_1_63_15&#39;)"><span class="hl_fundecl"><span class="mpre">getTixFileName</span></span></a><span class="mpre"> </span><a name="loc_63_16_63_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_16_63_19&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> | </span><span class="hl_string"><span class="mpre">&quot;.tix&quot;</span></span><span class="mpre"> </span><a href="Data.List.html#loc_294_1_294_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.List.html#loc_294_1_294_11&#39;)"><span class="hl_infix"><span class="mpre">`isSuffixOf`</span></span></a><span class="mpre"> </span><a href="#loc_63_16_63_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_16_63_19&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
                   = </span><a href="#loc_63_16_63_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_16_63_19&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
                   | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">
                   = </span><a href="#loc_63_16_63_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_16_63_19&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;.tix&quot;</span></span><span class="mpre">
</span></div></body></html>