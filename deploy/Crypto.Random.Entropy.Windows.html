<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Crypto.Random.Entropy.Windows</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : Good</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- code originally from the entropy package and thus is:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--   Copyright (c) Thomas DuBuisson.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
{-# LANGUAGE ForeignFunctionInterface #-}
module Crypto.Random.Entropy.Windows
    ( WinCryptoAPI
    ) where

import Data.Int (Int32)
import Data.Word (Word32, Word8)
import Foreign.C.String (CString, withCString)
import Foreign.Ptr (Ptr, nullPtr)
import Foreign.Marshal.Alloc (alloca)
import Foreign.Marshal.Utils (toBool)
import Foreign.Storable (peek)

import Crypto.Random.Entropy.Source

</span><span class="hl_comment"><span class="mpre">-- Define the constants we need from WinCrypt.h </span></span><span class="mpre">
</span><a href="#loc_28_1_28_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_1_28_10&#39;)"><span class="mpre">msDefProv</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_28_1_28_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_1_28_10&#39;)"><span class="hl_vardecl"><span class="mpre">msDefProv</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;Microsoft Base Cryptographic Provider v1.0&quot;</span></span><span class="mpre">

</span><a href="#loc_31_1_31_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_1_31_12&#39;)"><span class="mpre">provRSAFull</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word32</span></span><span class="mpre">
</span><a name="loc_31_1_31_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_1_31_12&#39;)"><span class="hl_vardecl"><span class="mpre">provRSAFull</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">

</span><a href="#loc_34_1_34_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_19&#39;)"><span class="mpre">cryptVerifyContext</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word32</span></span><span class="mpre">
</span><a name="loc_34_1_34_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_19&#39;)"><span class="hl_vardecl"><span class="mpre">cryptVerifyContext</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">0xF0000000</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | handle to windows crypto API for random generation</span></span><span class="mpre">
data </span><a name="loc_37_6_37_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_6_37_18&#39;)"><span class="hl_tycondecl"><span class="mpre">WinCryptoAPI</span></span></a><span class="mpre"> = </span><a name="loc_37_21_37_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_21_37_33&#39;)"><span class="hl_condecl"><span class="mpre">WinCryptoAPI</span></span></a><span class="mpre">

instance </span><a href="Crypto.Random.Entropy.Source.html#loc_15_7_15_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Source.html#loc_15_7_15_20&#39;)"><span class="hl_classref"><span class="mpre">EntropySource</span></span></a><span class="mpre"> </span><a href="#loc_37_6_37_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_6_37_18&#39;)"><span class="hl_tyconref"><span class="mpre">WinCryptoAPI</span></span></a><span class="mpre"> where
    </span><a href="Crypto.Random.Entropy.Source.html#loc_17_5_17_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Source.html#loc_17_5_17_16&#39;)"><span class="hl_vardecl"><span class="mpre">entropyOpen</span></span></a><span class="mpre"> = do
        </span><a name="loc_41_9_41_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_9_41_13&#39;)"><span class="hl_vardecl"><span class="mpre">mctx</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_64_1_64_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_16&#39;)"><span class="hl_varref"><span class="mpre">cryptAcquireCtx</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">) (\</span><a name="loc_42_34_42_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_34_42_37&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_78_1_78_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_16&#39;)"><span class="hl_varref"><span class="mpre">cryptReleaseCtx</span></span></a><span class="mpre"> </span><a href="#loc_42_34_42_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_34_42_37&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a href="#loc_37_21_37_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_21_37_33&#39;)"><span class="hl_conref"><span class="mpre">WinCryptoAPI</span></span></a><span class="mpre">)) </span><a href="#loc_41_9_41_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_41_9_41_13&#39;)"><span class="hl_varref"><span class="mpre">mctx</span></span></a><span class="mpre">
    </span><a href="Crypto.Random.Entropy.Source.html#loc_20_5_20_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Source.html#loc_20_5_20_18&#39;)"><span class="hl_fundecl"><span class="mpre">entropyGather</span></span></a><span class="mpre"> </span><a href="#loc_37_21_37_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_21_37_33&#39;)"><span class="hl_conref"><span class="mpre">WinCryptoAPI</span></span></a><span class="mpre"> </span><a name="loc_43_32_43_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_32_43_35&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_43_36_43_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_36_43_37&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = do
        </span><a name="loc_44_9_44_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_9_44_13&#39;)"><span class="hl_vardecl"><span class="mpre">mctx</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_64_1_64_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_16&#39;)"><span class="hl_varref"><span class="mpre">cryptAcquireCtx</span></span></a><span class="mpre">
        case </span><a href="#loc_44_9_44_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_44_9_44_13&#39;)"><span class="hl_varref"><span class="mpre">mctx</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;cannot re-grab win crypto api&quot;</span></span><span class="mpre">
            </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_47_18_47_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_18_47_21&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> -&gt; do
                </span><a name="loc_48_17_48_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_17_48_18&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_73_1_73_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_15&#39;)"><span class="hl_varref"><span class="mpre">cryptGenRandom</span></span></a><span class="mpre"> </span><a href="#loc_47_18_47_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_18_47_21&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_43_32_43_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_32_43_35&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_43_36_43_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_36_43_37&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
                </span><a href="#loc_78_1_78_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_16&#39;)"><span class="hl_varref"><span class="mpre">cryptReleaseCtx</span></span></a><span class="mpre"> </span><a href="#loc_47_18_47_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_18_47_21&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_48_17_48_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_17_48_18&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
    </span><a href="Crypto.Random.Entropy.Source.html#loc_22_5_22_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Crypto.Random.Entropy.Source.html#loc_22_5_22_17&#39;)"><span class="hl_fundecl"><span class="mpre">entropyClose</span></span></a><span class="mpre"> </span><a href="#loc_37_21_37_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_21_37_33&#39;)"><span class="hl_conref"><span class="mpre">WinCryptoAPI</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy/Windows.hs&quot;, srcSpanStartLine = 53, srcSpanStartColumn = 1, srcSpanEndLine = 53, srcSpanEndColumn = 23}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy/Windows.hs&quot;, srcSpanStartLine = 53, srcSpanStartColumn = 1, srcSpanEndLine = 53, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Cr"><span class="mpre">type CryptCtx = Word32</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- Declare the required CryptoAPI imports </span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy/Windows.hs&quot;, srcSpanStartLine = 56, srcSpanStartColumn = 1, srcSpanEndLine = 57, srcSpanEndColumn = 92}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy/Windows.hs&quot;, srcSpanStartLine = 56, srcSpanStartColumn = 1, srcSpanEndLine = 56, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Cryp"><span class="mpre">foreign import stdcall unsafe &quot;CryptAcquireContextA&quot;
   c_cryptAcquireCtx :: Ptr Word32 -&gt; CString -&gt; CString -&gt; Word32 -&gt; Word32 -&gt; IO CryptCtx</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy/Windows.hs&quot;, srcSpanStartLine = 58, srcSpanStartColumn = 1, srcSpanEndLine = 59, srcSpanEndColumn = 67}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy/Windows.hs&quot;, srcSpanStartLine = 58, srcSpanStartColumn = 1, srcSpanEndLine = 58, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Cryp"><span class="mpre">foreign import stdcall unsafe &quot;CryptGenRandom&quot;
   c_cryptGenRandom :: CryptCtx -&gt; Word32 -&gt; Ptr Word8 -&gt; IO Int32</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy/Windows.hs&quot;, srcSpanStartLine = 60, srcSpanStartColumn = 1, srcSpanEndLine = 61, srcSpanEndColumn = 55}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Crypto/Random/Entropy/Windows.hs&quot;, srcSpanStartLine = 60, srcSpanStartColumn = 1, srcSpanEndLine = 60, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/crypto-random-0.0.7/Cryp"><span class="mpre">foreign import stdcall unsafe &quot;CryptReleaseContext&quot;
   c_cryptReleaseCtx :: CryptCtx -&gt; Word32 -&gt; IO Int32</span></span><span class="mpre">

</span><a href="#loc_64_1_64_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_16&#39;)"><span class="mpre">cryptAcquireCtx</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CryptCtx</span></span><span class="mpre">)
</span><a name="loc_64_1_64_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_16&#39;)"><span class="hl_vardecl"><span class="mpre">cryptAcquireCtx</span></span></a><span class="mpre"> = 
    </span><span class="hl_varref"><span class="mpre">alloca</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_65_15_65_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_15_65_24&#39;)"><span class="hl_vardecl"><span class="mpre">handlePtr</span></span></a><span class="mpre"> -&gt; 
    </span><span class="hl_varref"><span class="mpre">withCString</span></span><span class="mpre"> </span><a href="#loc_28_1_28_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_28_1_28_10&#39;)"><span class="hl_varref"><span class="mpre">msDefProv</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_66_30_66_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_30_66_38&#39;)"><span class="hl_vardecl"><span class="mpre">provName</span></span></a><span class="mpre"> -&gt; do
        </span><a name="loc_67_9_67_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_9_67_10&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">toBool</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">c_cryptAcquireCtx</span></span><span class="mpre"> </span><a href="#loc_65_15_65_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_15_65_24&#39;)"><span class="hl_varref"><span class="mpre">handlePtr</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">nullPtr</span></span><span class="mpre"> </span><a href="#loc_66_30_66_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_66_30_66_38&#39;)"><span class="hl_varref"><span class="mpre">provName</span></span></a><span class="mpre"> </span><a href="#loc_31_1_31_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_31_1_31_12&#39;)"><span class="hl_varref"><span class="mpre">provRSAFull</span></span></a><span class="mpre"> </span><a href="#loc_34_1_34_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_34_1_34_19&#39;)"><span class="hl_varref"><span class="mpre">cryptVerifyContext</span></span></a><span class="mpre">
        if </span><a href="#loc_67_9_67_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_67_9_67_10&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
            then </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">peek</span></span><span class="mpre"> </span><a href="#loc_65_15_65_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_15_65_24&#39;)"><span class="hl_varref"><span class="mpre">handlePtr</span></span></a><span class="mpre">
            else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">

</span><a href="#loc_73_1_73_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_15&#39;)"><span class="mpre">cryptGenRandom</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">CryptCtx</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_73_1_73_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_1_73_15&#39;)"><span class="hl_fundecl"><span class="mpre">cryptGenRandom</span></span></a><span class="mpre"> </span><a name="loc_73_16_73_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_16_73_17&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_73_18_73_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_18_73_21&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a name="loc_73_22_73_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_22_73_23&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = do
    </span><a name="loc_74_5_74_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_5_74_12&#39;)"><span class="hl_vardecl"><span class="mpre">success</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">toBool</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">c_cryptGenRandom</span></span><span class="mpre"> </span><a href="#loc_73_16_73_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_16_73_17&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_73_22_73_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_22_73_23&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">) </span><a href="#loc_73_18_73_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_18_73_21&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> if </span><a href="#loc_74_5_74_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_74_5_74_12&#39;)"><span class="hl_varref"><span class="mpre">success</span></span></a><span class="mpre"> then </span><a href="#loc_73_22_73_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_22_73_23&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> else </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">

</span><a href="#loc_78_1_78_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_16&#39;)"><span class="mpre">cryptReleaseCtx</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">CryptCtx</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_78_1_78_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_16&#39;)"><span class="hl_fundecl"><span class="mpre">cryptReleaseCtx</span></span></a><span class="mpre"> </span><a name="loc_78_17_78_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_18&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> = do
    </span><a name="loc_79_5_79_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_5_79_12&#39;)"><span class="hl_vardecl"><span class="mpre">success</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">toBool</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">c_cryptReleaseCtx</span></span><span class="mpre"> </span><a href="#loc_78_17_78_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_18&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
    if </span><a href="#loc_79_5_79_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_5_79_12&#39;)"><span class="hl_varref"><span class="mpre">success</span></span></a><span class="mpre">
        then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
        else </span><span class="hl_varref"><span class="mpre">fail</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;cryptReleaseCtx&quot;</span></span><span class="mpre">
</span></div></body></html>