<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Unsafe #-}
{-# LANGUAGE MagicHash, UnboxedTuples, RankNTypes #-}
{-# OPTIONS_HADDOCK hide #-}

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Control.Monad.ST.Lazy.Imp</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow 2001</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD-style (see the file libraries/base/LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  libraries@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  provisional</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (requires universal quantification for runST)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This module presents an identical interface to &quot;Control.Monad.ST&quot;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- except that the monad delays evaluation of state operations until</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a value depending on them is required.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module Control.Monad.ST.Lazy.Imp (
        </span><span class="hl_comment"><span class="mpre">-- * The &#39;ST&#39; monad</span></span><span class="mpre">
        ST,
        runST,
        fixST,

        </span><span class="hl_comment"><span class="mpre">-- * Converting between strict and lazy &#39;ST&#39;</span></span><span class="mpre">
        strictToLazyST, lazyToStrictST,

        </span><span class="hl_comment"><span class="mpre">-- * Converting &#39;ST&#39; To &#39;IO&#39;</span></span><span class="mpre">
        RealWorld,
        stToIO,

        </span><span class="hl_comment"><span class="mpre">-- * Unsafe operations</span></span><span class="mpre">
        unsafeInterleaveST,
        unsafeIOToST
    ) where

import Prelude

import Control.Monad.Fix

import qualified Control.Monad.ST.Safe as ST
import qualified Control.Monad.ST.Unsafe as ST

import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Control/Monad/ST/Lazy/Imp.hs&quot;, srcSpanStartLine = 46, srcSpanStartColumn = 18, srcSpanEndLine = 46, srcSpanEndColumn = 24}, srcInfoPoints = []}) &quot;GHC.ST&quot;"><span class="mpre">GHC.ST</span></span><span class="mpre"> as GHC.ST
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Control/Monad/ST/Lazy/Imp.hs&quot;, srcSpanStartLine = 47, srcSpanStartColumn = 8, srcSpanEndLine = 47, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | The lazy state-transformer monad.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A computation of type @&#39;ST&#39; s a@ transforms an internal state indexed</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- by @s@, and returns a value of type @a@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The @s@ parameter is either</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * an unstantiated type variable (inside invocations of &#39;runST&#39;), or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * &#39;RealWorld&#39; (inside invocations of &#39;stToIO&#39;).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- It serves to keep the internal states of different invocations of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;runST&#39; separate from each other and from invocations of &#39;stToIO&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The &#39;&gt;&gt;=&#39; and &#39;&gt;&gt;&#39; operations are not strict in the state.  For example,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @&#39;runST&#39; (writeSTRef _|_ v &gt;&gt;= readSTRef _|_ &gt;&gt; return 2) = 2@</span></span><span class="mpre">
newtype </span><a name="loc_64_9_64_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_11&#39;)"><span class="hl_tycondecl"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_64_18_64_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_18_64_20&#39;)"><span class="hl_condecl"><span class="mpre">ST</span></span></a><span class="mpre"> (</span><a href="#loc_65_6_65_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_6_65_11&#39;)"><span class="hl_tyconref"><span class="mpre">State</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><a href="#loc_65_6_65_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_6_65_11&#39;)"><span class="hl_tyconref"><span class="mpre">State</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre">))
data </span><a name="loc_65_6_65_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_6_65_11&#39;)"><span class="hl_tycondecl"><span class="mpre">State</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> = </span><a name="loc_65_16_65_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_16_65_18&#39;)"><span class="hl_condecl"><span class="mpre">S#</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">State#</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre">)

instance </span><span class="hl_classref"><span class="mpre">Functor</span></span><span class="mpre"> (</span><a href="#loc_64_9_64_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_11&#39;)"><span class="hl_tyconref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre">) where
    </span><span class="hl_fundecl"><span class="mpre">fmap</span></span><span class="mpre"> </span><a name="loc_68_10_68_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_10_68_11&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> </span><a name="loc_68_12_68_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_12_68_13&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><a href="#loc_64_18_64_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_18_64_20&#39;)"><span class="hl_conref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_68_23_68_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_23_68_24&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
      let 
       </span><a href="#loc_64_18_64_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_18_64_20&#39;)"><span class="hl_conref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><a name="loc_70_11_70_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_11_70_14&#39;)"><span class="hl_vardecl"><span class="mpre">m_a</span></span></a><span class="mpre"> = </span><a href="#loc_68_12_68_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_12_68_13&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
       (</span><a name="loc_71_9_71_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_9_71_10&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">,</span><a name="loc_71_11_71_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_16&#39;)"><span class="hl_vardecl"><span class="mpre">new_s</span></span></a><span class="mpre">) = </span><a href="#loc_70_11_70_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_11_70_14&#39;)"><span class="hl_varref"><span class="mpre">m_a</span></span></a><span class="mpre"> </span><a href="#loc_68_23_68_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_23_68_24&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
      in
      (</span><a href="#loc_68_10_68_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_10_68_11&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_71_9_71_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_9_71_10&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">,</span><a href="#loc_71_11_71_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_11_71_16&#39;)"><span class="hl_varref"><span class="mpre">new_s</span></span></a><span class="mpre">)

instance </span><span class="hl_classref"><span class="mpre">Monad</span></span><span class="mpre"> (</span><a href="#loc_64_9_64_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_11&#39;)"><span class="hl_tyconref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre">) where

        </span><span class="hl_fundecl"><span class="mpre">return</span></span><span class="mpre"> </span><a name="loc_77_16_77_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_16_77_17&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = </span><a href="#loc_64_18_64_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_18_64_20&#39;)"><span class="hl_conref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_77_27_77_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_27_77_28&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_77_16_77_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_16_77_17&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">,</span><a href="#loc_77_27_77_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_77_27_77_28&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)
        </span><a name="loc_78_9_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_9_78_10&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_fundecl"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a name="loc_78_14_78_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_14_78_15&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre">   =  </span><a href="#loc_78_9_78_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_9_78_10&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> \ _ -&gt; </span><a href="#loc_78_14_78_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_14_78_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">
        </span><span class="hl_fundecl"><span class="mpre">fail</span></span><span class="mpre"> </span><a name="loc_79_14_79_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_14_79_15&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">   = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><a href="#loc_79_14_79_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_14_79_15&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">

        (</span><a href="#loc_64_18_64_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_18_64_20&#39;)"><span class="hl_conref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><a name="loc_81_13_81_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_13_81_14&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) </span><span class="hl_fundecl"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a name="loc_81_20_81_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_20_81_21&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre">
         = </span><a href="#loc_64_18_64_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_18_64_20&#39;)"><span class="hl_conref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_82_19_82_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_19_82_20&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
           let
             (</span><a name="loc_84_15_84_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_15_84_16&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">,</span><a name="loc_84_17_84_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_17_84_22&#39;)"><span class="hl_vardecl"><span class="mpre">new_s</span></span></a><span class="mpre">) = </span><a href="#loc_81_13_81_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_13_81_14&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_82_19_82_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_19_82_20&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
             </span><a href="#loc_64_18_64_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_18_64_20&#39;)"><span class="hl_conref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><a name="loc_85_17_85_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_17_85_20&#39;)"><span class="hl_vardecl"><span class="mpre">k_a</span></span></a><span class="mpre"> = </span><a href="#loc_81_20_81_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_20_81_21&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_84_15_84_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_15_84_16&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
           in
           </span><a href="#loc_85_17_85_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_17_85_20&#39;)"><span class="hl_varref"><span class="mpre">k_a</span></span></a><span class="mpre"> </span><a href="#loc_84_17_84_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_17_84_22&#39;)"><span class="hl_varref"><span class="mpre">new_s</span></span></a><span class="mpre">

</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_94_1_94_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_6&#39;)"><span class="mpre">runST</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- | Return the value computed by a state transformer computation.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The @forall@ ensures that the internal state used by the &#39;ST&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- computation is inaccessible to the rest of the program.</span></span><span class="mpre">
</span><a href="#loc_94_1_94_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_6&#39;)"><span class="mpre">runST</span></a><span class="mpre"> :: (forall </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre">. </span><a href="#loc_64_9_64_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_11&#39;)"><span class="hl_tyconref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_94_1_94_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_6&#39;)"><span class="hl_fundecl"><span class="mpre">runST</span></span></a><span class="mpre"> </span><a name="loc_94_7_94_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_7_94_9&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> = case </span><a href="#loc_94_7_94_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_7_94_9&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre"> of </span><a href="#loc_64_18_64_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_18_64_20&#39;)"><span class="hl_conref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><a name="loc_94_26_94_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_26_94_32&#39;)"><span class="hl_vardecl"><span class="mpre">the_st</span></span></a><span class="mpre"> -&gt; let (</span><a name="loc_94_41_94_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_41_94_42&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">,_) = </span><a href="#loc_94_26_94_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_26_94_32&#39;)"><span class="hl_varref"><span class="mpre">the_st</span></span></a><span class="mpre"> (</span><a href="#loc_65_16_65_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_16_65_18&#39;)"><span class="hl_conref"><span class="mpre">S#</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">realWorld#</span></span><span class="mpre">) in </span><a href="#loc_94_41_94_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_41_94_42&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Allow the result of a state transformer computation to be used (lazily)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- inside the computation.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that if @f@ is strict, @&#39;fixST&#39; f = _|_@.</span></span><span class="mpre">
</span><a href="#loc_100_1_100_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_6&#39;)"><span class="mpre">fixST</span></a><span class="mpre"> :: (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_64_9_64_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_11&#39;)"><span class="hl_tyconref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><a href="#loc_64_9_64_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_11&#39;)"><span class="hl_tyconref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_100_1_100_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_6&#39;)"><span class="hl_fundecl"><span class="mpre">fixST</span></span></a><span class="mpre"> </span><a name="loc_100_7_100_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_7_100_8&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><a href="#loc_64_18_64_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_18_64_20&#39;)"><span class="hl_conref"><span class="mpre">ST</span></span></a><span class="mpre"> (\ </span><a name="loc_100_17_100_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_17_100_18&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; 
                let 
                   </span><a href="#loc_64_18_64_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_18_64_20&#39;)"><span class="hl_conref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><a name="loc_102_23_102_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_23_102_26&#39;)"><span class="hl_vardecl"><span class="mpre">m_r</span></span></a><span class="mpre"> = </span><a href="#loc_100_7_100_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_7_100_8&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_103_21_103_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_21_103_22&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
                   (</span><a name="loc_103_21_103_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_21_103_22&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">,</span><a name="loc_103_23_103_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_23_103_25&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre">) = </span><a href="#loc_102_23_102_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_23_102_26&#39;)"><span class="hl_varref"><span class="mpre">m_r</span></span></a><span class="mpre"> </span><a href="#loc_100_17_100_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_17_100_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
                in
                   (</span><a href="#loc_103_21_103_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_21_103_22&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">,</span><a href="#loc_103_23_103_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_23_103_25&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">))

instance </span><a href="Control.Monad.Fix.html#loc_48_20_48_28" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Fix.html#loc_48_20_48_28&#39;)"><span class="hl_classref"><span class="mpre">MonadFix</span></span></a><span class="mpre"> (</span><a href="#loc_64_9_64_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_11&#39;)"><span class="hl_tyconref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre">) where
        </span><a href="Control.Monad.Fix.html#loc_53_9_53_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Fix.html#loc_53_9_53_13&#39;)"><span class="hl_vardecl"><span class="mpre">mfix</span></span></a><span class="mpre"> = </span><a href="#loc_100_1_100_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_6&#39;)"><span class="hl_varref"><span class="mpre">fixST</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Strict &lt;--&gt; Lazy</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-|
Convert a strict &#39;ST&#39; computation into a lazy one.  The strict state
thread passed to &#39;strictToLazyST&#39; is not performed until the result of
the lazy state thread it returns is demanded.
-}</span></span><span class="mpre">
</span><a href="#loc_119_1_119_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_15&#39;)"><span class="mpre">strictToLazyST</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ST.ST</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_64_9_64_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_11&#39;)"><span class="hl_tyconref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_119_1_119_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_15&#39;)"><span class="hl_fundecl"><span class="mpre">strictToLazyST</span></span></a><span class="mpre"> </span><a name="loc_119_16_119_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_16_119_17&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> = </span><a href="#loc_64_18_64_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_18_64_20&#39;)"><span class="hl_conref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_119_26_119_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_26_119_27&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
        let 
           </span><a name="loc_121_12_121_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_12_121_14&#39;)"><span class="hl_vardecl"><span class="mpre">pr</span></span></a><span class="mpre"> = case </span><a href="#loc_119_26_119_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_26_119_27&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of { </span><a href="#loc_65_16_65_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_16_65_18&#39;)"><span class="hl_conref"><span class="mpre">S#</span></span></a><span class="mpre"> </span><a name="loc_121_32_121_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_32_121_34&#39;)"><span class="hl_vardecl"><span class="mpre">s#</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">GHC.ST.liftST</span></span><span class="mpre"> </span><a href="#loc_119_16_119_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_16_119_17&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_121_32_121_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_32_121_34&#39;)"><span class="hl_varref"><span class="mpre">s#</span></span></a><span class="mpre"> }
           </span><a name="loc_122_12_122_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_12_122_13&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">  = case </span><a href="#loc_121_12_121_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_12_121_14&#39;)"><span class="hl_varref"><span class="mpre">pr</span></span></a><span class="mpre"> of { </span><span class="hl_conref"><span class="mpre">GHC.ST.STret</span></span><span class="mpre"> _ </span><a name="loc_122_45_122_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_45_122_46&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_122_45_122_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_45_122_46&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre"> }
           </span><a name="loc_123_12_123_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_12_123_14&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre"> = case </span><a href="#loc_121_12_121_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_12_121_14&#39;)"><span class="hl_varref"><span class="mpre">pr</span></span></a><span class="mpre"> of { </span><span class="hl_conref"><span class="mpre">GHC.ST.STret</span></span><span class="mpre"> </span><a name="loc_123_43_123_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_43_123_46&#39;)"><span class="hl_vardecl"><span class="mpre">s2#</span></span></a><span class="mpre"> _ -&gt; </span><a href="#loc_65_16_65_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_16_65_18&#39;)"><span class="hl_conref"><span class="mpre">S#</span></span></a><span class="mpre"> </span><a href="#loc_123_43_123_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_43_123_46&#39;)"><span class="hl_varref"><span class="mpre">s2#</span></span></a><span class="mpre"> }
        in
        (</span><a href="#loc_122_12_122_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_12_122_13&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">, </span><a href="#loc_123_12_123_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_12_123_14&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">{-| 
Convert a lazy &#39;ST&#39; computation into a strict one.
-}</span></span><span class="mpre">
</span><a href="#loc_131_1_131_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_1_131_15&#39;)"><span class="mpre">lazyToStrictST</span></a><span class="mpre"> :: </span><a href="#loc_64_9_64_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_11&#39;)"><span class="hl_tyconref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">ST.ST</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_131_1_131_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_1_131_15&#39;)"><span class="hl_fundecl"><span class="mpre">lazyToStrictST</span></span></a><span class="mpre"> (</span><a href="#loc_64_18_64_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_18_64_20&#39;)"><span class="hl_conref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><a name="loc_131_20_131_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_20_131_21&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) = </span><span class="hl_conref"><span class="mpre">GHC.ST.ST</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_131_38_131_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_38_131_39&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
        case (</span><a href="#loc_131_20_131_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_20_131_21&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> (</span><a href="#loc_65_16_65_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_16_65_18&#39;)"><span class="hl_conref"><span class="mpre">S#</span></span></a><span class="mpre"> </span><a href="#loc_131_38_131_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_38_131_39&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)) of (</span><a name="loc_132_29_132_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_29_132_30&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">, </span><a href="#loc_65_16_65_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_16_65_18&#39;)"><span class="hl_conref"><span class="mpre">S#</span></span></a><span class="mpre"> </span><a name="loc_132_35_132_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_35_132_37&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre">) -&gt; (# </span><a href="#loc_132_35_132_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_35_132_37&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a href="#loc_132_29_132_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_29_132_30&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> #)

</span><span class="hl_comment"><span class="mpre">-- | A monad transformer embedding lazy state transformers in the &#39;IO&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- monad.  The &#39;RealWorld&#39; parameter indicates that the internal state</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- used by the &#39;ST&#39; computation is a special one supplied by the &#39;IO&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- monad, and thus distinct from those used by invocations of &#39;runST&#39;.</span></span><span class="mpre">
</span><a href="#loc_139_1_139_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_7&#39;)"><span class="mpre">stToIO</span></a><span class="mpre"> :: </span><a href="#loc_64_9_64_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_11&#39;)"><span class="hl_tyconref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">RealWorld</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_139_1_139_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_139_1_139_7&#39;)"><span class="hl_vardecl"><span class="mpre">stToIO</span></span></a><span class="mpre"> = </span><a href="GHC.IO.html#loc_91_1_91_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_91_1_91_7&#39;)"><span class="hl_varref"><span class="mpre">ST.stToIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_131_1_131_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_1_131_15&#39;)"><span class="hl_varref"><span class="mpre">lazyToStrictST</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Strict &lt;--&gt; Lazy</span></span><span class="mpre">

</span><a href="#loc_145_1_145_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_1_145_19&#39;)"><span class="mpre">unsafeInterleaveST</span></a><span class="mpre"> :: </span><a href="#loc_64_9_64_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_11&#39;)"><span class="hl_tyconref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_64_9_64_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_11&#39;)"><span class="hl_tyconref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_145_1_145_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_1_145_19&#39;)"><span class="hl_vardecl"><span class="mpre">unsafeInterleaveST</span></span></a><span class="mpre"> = </span><a href="#loc_119_1_119_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_15&#39;)"><span class="hl_varref"><span class="mpre">strictToLazyST</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">ST.unsafeInterleaveST</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_131_1_131_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_1_131_15&#39;)"><span class="hl_varref"><span class="mpre">lazyToStrictST</span></span></a><span class="mpre">

</span><a href="#loc_148_1_148_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_1_148_13&#39;)"><span class="mpre">unsafeIOToST</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_64_9_64_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_9_64_11&#39;)"><span class="hl_tyconref"><span class="mpre">ST</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">s</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_148_1_148_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_148_1_148_13&#39;)"><span class="hl_vardecl"><span class="mpre">unsafeIOToST</span></span></a><span class="mpre"> = </span><a href="#loc_119_1_119_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_15&#39;)"><span class="hl_varref"><span class="mpre">strictToLazyST</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="GHC.IO.html#loc_100_1_100_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_100_1_100_13&#39;)"><span class="hl_varref"><span class="mpre">ST.unsafeIOToST</span></span></a><span class="mpre">

</span></div></body></html>