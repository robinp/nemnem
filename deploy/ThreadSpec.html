<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE BangPatterns #-}

module ThreadSpec where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/test/ThreadSpec.hs&quot;, srcSpanStartLine = 5, srcSpanStartColumn = 8, srcSpanEndLine = 5, srcSpanEndColumn = 26}, srcInfoPoints = []}) &quot;Control.Concurrent&quot;"><span class="mpre">Control.Concurrent</span></span><span class="mpre"> (threadDelay)
import Data.IORef (</span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="mpre">readIORef</span></a><span class="mpre">, </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="mpre">writeIORef</span></a><span class="mpre">, </span><a href="Data.IORef.html#loc_101_1_101_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_101_1_101_18&#39;)"><span class="mpre">atomicModifyIORef</span></a><span class="mpre">)
import Network.Wai.Handler.Warp.Thread
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/warp-3.0.0.3/test/ThreadSpec.hs&quot;, srcSpanStartLine = 8, srcSpanStartColumn = 8, srcSpanEndLine = 8, srcSpanEndColumn = 18}, srcInfoPoints = []}) &quot;Test.Hspec&quot;"><span class="mpre">Test.Hspec</span></span><span class="mpre">

</span><a href="#loc_11_1_11_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_11_1_11_5&#39;)"><span class="mpre">main</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_11_1_11_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_11_1_11_5&#39;)"><span class="hl_vardecl"><span class="mpre">main</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">hspec</span></span><span class="mpre"> </span><a href="#loc_14_1_14_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_14_1_14_5&#39;)"><span class="hl_varref"><span class="mpre">spec</span></span></a><span class="mpre">

</span><a href="#loc_14_1_14_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_14_1_14_5&#39;)"><span class="mpre">spec</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Spec</span></span><span class="mpre">
</span><a name="loc_14_1_14_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_14_1_14_5&#39;)"><span class="hl_vardecl"><span class="mpre">spec</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">describe</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;forkIOwithBreakableForever&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
    </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;can be breakable&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><a name="loc_16_9_16_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_9_16_13&#39;)"><span class="hl_vardecl"><span class="mpre">ref&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="Network.Wai.Handler.Warp.Thread.html#loc_19_1_19_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Thread.html#loc_19_1_19_27&#39;)"><span class="hl_varref"><span class="mpre">forkIOwithBreakableForever</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_16_52_16_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_52_16_55&#39;)"><span class="hl_vardecl"><span class="mpre">ref</span></span></a><span class="mpre"> -&gt; do
            </span><span class="hl_varref"><span class="mpre">threadDelay</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1000</span></span><span class="mpre">
            !_ &lt;- </span><a href="Data.IORef.html#loc_101_1_101_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_101_1_101_18&#39;)"><span class="hl_varref"><span class="mpre">atomicModifyIORef</span></span></a><span class="mpre"> </span><a href="#loc_16_52_16_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_52_16_55&#39;)"><span class="hl_varref"><span class="mpre">ref</span></span></a><span class="mpre"> (\</span><a name="loc_18_43_18_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_43_18_44&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; (</span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">, </span><a href="#loc_18_43_18_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_43_18_44&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">))
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">threadDelay</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">100000</span></span><span class="mpre">
        </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_16_9_16_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_9_16_13&#39;)"><span class="hl_varref"><span class="mpre">ref&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldReturn`</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
        _ &lt;- </span><a href="Network.Wai.Handler.Warp.Thread.html#loc_28_1_28_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Wai.Handler.Warp.Thread.html#loc_28_1_28_13&#39;)"><span class="hl_varref"><span class="mpre">breakForever</span></span></a><span class="mpre"> </span><a href="#loc_16_9_16_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_9_16_13&#39;)"><span class="hl_varref"><span class="mpre">ref&#39;</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">threadDelay</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">100000</span></span><span class="mpre">
        </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="#loc_16_9_16_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_9_16_13&#39;)"><span class="hl_varref"><span class="mpre">ref&#39;</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">threadDelay</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">100000</span></span><span class="mpre">
        </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="#loc_16_9_16_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_9_16_13&#39;)"><span class="hl_varref"><span class="mpre">ref&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`shouldReturn`</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
</span></div></body></html>