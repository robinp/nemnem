<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">{- |
This creates a lazy Trie based on a finite range of Ints and is used to
memorize a function over the subsets of this range.

To create a Trie you need two supply 2 things
  * Range of keys to bound
  * A function or functions used to construct the value for a subset of keys

The Trie uses the Array type internally.
-}</span></span><span class="mpre">
module Text.Regex.TDFA.IntArrTrieSet where

</span><span class="hl_comment"><span class="mpre">{- By Chris Kuklewicz, 2007. BSD License, see the LICENSE file. -}</span></span><span class="mpre">

import Data.Array.IArray(Array,(!),listArray)

data </span><a name="loc_17_6_17_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_6_17_13&#39;)"><span class="hl_tycondecl"><span class="mpre">TrieSet</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> = </span><a name="loc_17_18_17_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_18_17_25&#39;)"><span class="hl_condecl"><span class="mpre">TrieSet</span></span></a><span class="mpre"> { </span><a name="loc_17_28_17_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_28_17_33&#39;)"><span class="hl_fielddecl"><span class="mpre">value</span></span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre">
                         , </span><a name="loc_18_28_18_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_18_28_18_32&#39;)"><span class="hl_fielddecl"><span class="mpre">next</span></span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Array</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> (</span><a href="#loc_17_6_17_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_6_17_13&#39;)"><span class="hl_tyconref"><span class="mpre">TrieSet</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre">) }

</span><span class="hl_comment"><span class="mpre">-- | This is the accessor for the Trie. The list of keys should be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- sorted.</span></span><span class="mpre">
</span><a href="#loc_23_1_23_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_10&#39;)"><span class="mpre">lookupAsc</span></a><span class="mpre"> :: </span><a href="#loc_17_6_17_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_6_17_13&#39;)"><span class="hl_tyconref"><span class="mpre">TrieSet</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">] -&gt; </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre">
</span><a name="loc_23_1_23_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_10&#39;)"><span class="hl_fundecl"><span class="mpre">lookupAsc</span></span></a><span class="mpre"> (</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/IntArrTrieSet.hs&quot;, srcSpanStartLine = 23, srcSpanStartColumn = 12, srcSpanEndLine = 23, srcSpanEndColumn = 36}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/IntArrTrieSet.hs&quot;, srcSpanStartLine = 23, srcSpanStartColumn = 20, srcSpanEndLine = 23, srcSpanEndColumn = 21},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/T"><span class="mpre">TrieSet {value=v,next=n}</span></span><span class="mpre">) =
  (\</span><a name="loc_24_5_24_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_5_24_9&#39;)"><span class="hl_vardecl"><span class="mpre">keys</span></span></a><span class="mpre"> -&gt; case </span><a href="#loc_24_5_24_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_5_24_9&#39;)"><span class="hl_varref"><span class="mpre">keys</span></span></a><span class="mpre"> of [] -&gt; </span><span class="hl_varref"><span class="mpre">v</span></span><span class="mpre">
                         (</span><a name="loc_25_27_25_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_27_25_30&#39;)"><span class="hl_vardecl"><span class="mpre">key</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_25_31_25_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_31_25_36&#39;)"><span class="hl_vardecl"><span class="mpre">keys&#39;</span></span></a><span class="mpre">) -&gt; </span><a href="#loc_23_1_23_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_10&#39;)"><span class="hl_varref"><span class="mpre">lookupAsc</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">n</span></span><span class="hl_infix"><span class="mpre">!</span></span><a href="#loc_25_27_25_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_27_25_30&#39;)"><span class="hl_varref"><span class="mpre">key</span></span></a><span class="mpre">) </span><a href="#loc_25_31_25_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_31_25_36&#39;)"><span class="hl_varref"><span class="mpre">keys&#39;</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | This is a Trie constructor for a complete range of keys.</span></span><span class="mpre">
</span><a href="#loc_32_1_32_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_1_32_11&#39;)"><span class="mpre">fromBounds</span></a><span class="mpre"> :: (</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)     </span><span class="hl_comment"><span class="mpre">-- ^ (lower,upper) range of keys, lower&lt;=upper</span></span><span class="mpre">
           -&gt; ([</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">] -&gt; </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre">)  </span><span class="hl_comment"><span class="mpre">-- ^ Function from list of keys to its value.</span></span><span class="mpre">
                            </span><span class="hl_comment"><span class="mpre">--   It must work for distinct ascending lists.</span></span><span class="mpre">
           -&gt; </span><a href="#loc_17_6_17_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_6_17_13&#39;)"><span class="hl_tyconref"><span class="mpre">TrieSet</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre">     </span><span class="hl_comment"><span class="mpre">-- ^ The constructed Trie</span></span><span class="mpre">
</span><a name="loc_32_1_32_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_1_32_11&#39;)"><span class="hl_fundecl"><span class="mpre">fromBounds</span></span></a><span class="mpre"> (</span><a name="loc_32_13_32_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_13_32_18&#39;)"><span class="hl_vardecl"><span class="mpre">start</span></span></a><span class="mpre">,</span><span class="hl_vardecl"><span class="mpre">stop</span></span><span class="mpre">) </span><span class="hl_vardecl"><span class="mpre">keysToValue</span></span><span class="mpre"> = </span><a href="#loc_33_3_33_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_3_33_8&#39;)"><span class="hl_varref"><span class="mpre">build</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre"> </span><a href="#loc_32_13_32_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_13_32_18&#39;)"><span class="hl_varref"><span class="mpre">start</span></span></a><span class="mpre"> where
  </span><a name="loc_33_3_33_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_3_33_8&#39;)"><span class="hl_fundecl"><span class="mpre">build</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">keys</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">low</span></span><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/IntArrTrieSet.hs&quot;, srcSpanStartLine = 33, srcSpanStartColumn = 20, srcSpanEndLine = 35, srcSpanEndColumn = 87}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Regex/TDFA/IntArrTrieSet.hs&quot;, srcSpanStartLine = 33, srcSpanStartColumn = 28, srcSpanEndLine = 33, srcSpanEndColumn = 29},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/regex-tdfa-1.2.0/Text/Re"><span class="mpre">TrieSet { value = keysToValue (keys [])
                           , next = listArray (low,stop)
                                    [build (keys.(x:)) (succ x) | x &lt;- [low..stop] ] }</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | This is a Trie constructor for a complete range of keys that uses</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a function from single values and a merge operation on values to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- fill the Trie.</span></span><span class="mpre">
</span><a href="#loc_45_1_45_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_17&#39;)"><span class="mpre">fromSinglesMerge</span></a><span class="mpre"> :: </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre">          </span><span class="hl_comment"><span class="mpre">-- ^ value for (lookupAsc trie [])</span></span><span class="mpre">
                 -&gt; (</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre">-&gt;</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre">-&gt;</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre">)  </span><span class="hl_comment"><span class="mpre">-- ^ merge operation on values</span></span><span class="mpre">
                 -&gt; (</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)  </span><span class="hl_comment"><span class="mpre">-- ^ (lower,upper) range of keys, lower&lt;=upper</span></span><span class="mpre">
                 -&gt; (</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">-&gt;</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre">)   </span><span class="hl_comment"><span class="mpre">-- ^ Function from a single key to its value</span></span><span class="mpre">
                 -&gt; </span><a href="#loc_17_6_17_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_6_17_13&#39;)"><span class="hl_tyconref"><span class="mpre">TrieSet</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^ The constructed Trie</span></span><span class="mpre">
</span><a name="loc_45_1_45_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_17&#39;)"><span class="hl_fundecl"><span class="mpre">fromSinglesMerge</span></span></a><span class="mpre"> </span><a name="loc_45_18_45_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_18_45_28&#39;)"><span class="hl_vardecl"><span class="mpre">emptyValue</span></span></a><span class="mpre"> </span><a name="loc_45_29_45_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_29_45_40&#39;)"><span class="hl_vardecl"><span class="mpre">mergeValues</span></span></a><span class="mpre"> </span><a name="loc_45_41_45_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_41_45_46&#39;)"><span class="hl_vardecl"><span class="mpre">bound</span></span></a><span class="mpre"> </span><a name="loc_45_47_45_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_47_45_57&#39;)"><span class="hl_vardecl"><span class="mpre">keyToValue</span></span></a><span class="mpre"> = </span><a href="#loc_46_3_46_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_3_46_10&#39;)"><span class="hl_varref"><span class="mpre">trieSet</span></span></a><span class="mpre"> where
  </span><a name="loc_46_3_46_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_3_46_10&#39;)"><span class="hl_vardecl"><span class="mpre">trieSet</span></span></a><span class="mpre"> = </span><a href="#loc_32_1_32_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_1_32_11&#39;)"><span class="hl_varref"><span class="mpre">fromBounds</span></span></a><span class="mpre"> </span><a href="#loc_45_41_45_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_41_45_46&#39;)"><span class="hl_varref"><span class="mpre">bound</span></span></a><span class="mpre"> </span><a href="#loc_47_3_47_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_3_47_15&#39;)"><span class="hl_varref"><span class="mpre">keysToValue&#39;</span></span></a><span class="mpre">
  </span><a name="loc_47_3_47_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_3_47_15&#39;)"><span class="hl_fundecl"><span class="mpre">keysToValue&#39;</span></span></a><span class="mpre"> </span><a name="loc_47_16_47_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_16_47_20&#39;)"><span class="hl_vardecl"><span class="mpre">keys</span></span></a><span class="mpre"> =
    case </span><a href="#loc_47_16_47_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_16_47_20&#39;)"><span class="hl_varref"><span class="mpre">keys</span></span></a><span class="mpre"> of
      [] -&gt; </span><a href="#loc_45_18_45_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_18_45_28&#39;)"><span class="hl_varref"><span class="mpre">emptyValue</span></span></a><span class="mpre">
      [</span><a name="loc_50_8_50_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_8_50_11&#39;)"><span class="hl_vardecl"><span class="mpre">key</span></span></a><span class="mpre">] -&gt; </span><a href="#loc_45_47_45_57" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_47_45_57&#39;)"><span class="hl_varref"><span class="mpre">keyToValue</span></span></a><span class="mpre"> </span><a href="#loc_50_8_50_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_50_8_50_11&#39;)"><span class="hl_varref"><span class="mpre">key</span></span></a><span class="mpre">
      _ -&gt; </span><a href="#loc_45_29_45_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_29_45_40&#39;)"><span class="hl_varref"><span class="mpre">mergeValues</span></span></a><span class="mpre"> (</span><a href="#loc_52_3_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_3_52_14&#39;)"><span class="hl_varref"><span class="mpre">keysToValue</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">init</span></span><span class="mpre"> </span><a href="#loc_47_16_47_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_16_47_20&#39;)"><span class="hl_varref"><span class="mpre">keys</span></span></a><span class="mpre">)) (</span><a href="#loc_52_3_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_3_52_14&#39;)"><span class="hl_varref"><span class="mpre">keysToValue</span></span></a><span class="mpre"> [</span><span class="hl_varref"><span class="mpre">last</span></span><span class="mpre"> </span><a href="#loc_47_16_47_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_16_47_20&#39;)"><span class="hl_varref"><span class="mpre">keys</span></span></a><span class="mpre">])
  </span><a name="loc_52_3_52_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_3_52_14&#39;)"><span class="hl_vardecl"><span class="mpre">keysToValue</span></span></a><span class="mpre"> = </span><a href="#loc_23_1_23_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_10&#39;)"><span class="hl_varref"><span class="mpre">lookupAsc</span></span></a><span class="mpre"> </span><a href="#loc_46_3_46_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_3_46_10&#39;)"><span class="hl_varref"><span class="mpre">trieSet</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | This is a Trie constructor for a complete range of keys that uses</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a function from single values and a sum operation of values to fill</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the Trie.</span></span><span class="mpre">
</span><a href="#loc_61_1_61_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_15&#39;)"><span class="mpre">fromSinglesSum</span></a><span class="mpre"> :: ([</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre">]-&gt;</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre">)   </span><span class="hl_comment"><span class="mpre">-- ^ summation operation for values</span></span><span class="mpre">
               -&gt; (</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">,</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)  </span><span class="hl_comment"><span class="mpre">-- ^ (lower,upper) range of keys, lower &lt;= upper</span></span><span class="mpre">
               -&gt; (</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">-&gt;</span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre">)   </span><span class="hl_comment"><span class="mpre">-- ^ Function from a single key to its value</span></span><span class="mpre">
               -&gt; </span><a href="#loc_17_6_17_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_17_6_17_13&#39;)"><span class="hl_tyconref"><span class="mpre">TrieSet</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">v</span></span><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^ The constructed Trie</span></span><span class="mpre">
</span><a name="loc_61_1_61_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_15&#39;)"><span class="hl_fundecl"><span class="mpre">fromSinglesSum</span></span></a><span class="mpre"> </span><a name="loc_61_16_61_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_16_61_27&#39;)"><span class="hl_vardecl"><span class="mpre">mergeValues</span></span></a><span class="mpre"> </span><a name="loc_61_28_61_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_28_61_33&#39;)"><span class="hl_vardecl"><span class="mpre">bound</span></span></a><span class="mpre"> </span><a name="loc_61_34_61_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_34_61_44&#39;)"><span class="hl_vardecl"><span class="mpre">keyToValue</span></span></a><span class="mpre"> = </span><a href="#loc_62_3_62_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_3_62_10&#39;)"><span class="hl_varref"><span class="mpre">trieSet</span></span></a><span class="mpre"> where
  </span><a name="loc_62_3_62_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_3_62_10&#39;)"><span class="hl_vardecl"><span class="mpre">trieSet</span></span></a><span class="mpre"> = </span><a href="#loc_32_1_32_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_32_1_32_11&#39;)"><span class="hl_varref"><span class="mpre">fromBounds</span></span></a><span class="mpre"> </span><a href="#loc_61_28_61_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_28_61_33&#39;)"><span class="hl_varref"><span class="mpre">bound</span></span></a><span class="mpre"> </span><a href="#loc_63_3_63_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_3_63_15&#39;)"><span class="hl_varref"><span class="mpre">keysToValue&#39;</span></span></a><span class="mpre">
  </span><a name="loc_63_3_63_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_3_63_15&#39;)"><span class="hl_vardecl"><span class="mpre">keysToValue&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_61_16_61_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_16_61_27&#39;)"><span class="hl_varref"><span class="mpre">mergeValues</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_61_34_61_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_34_61_44&#39;)"><span class="hl_varref"><span class="mpre">keyToValue</span></span></a><span class="mpre">
</span></div></body></html>