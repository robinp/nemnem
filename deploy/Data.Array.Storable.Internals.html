<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE FlexibleInstances, MultiParamTypeClasses #-}
{-# OPTIONS_HADDOCK hide #-}
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Data.Array.Storable.Internals</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow 2011</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD-style (see the file libraries/base/LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  libraries@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (uses Data.Array.MArray)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Actual implementation of &quot;Data.Array.Storable&quot;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- /Since: 0.4.0.0/</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module Data.Array.Storable.Internals (
    StorableArray(..),
    withStorableArray,
    touchStorableArray,
    unsafeForeignPtrToStorableArray,
  ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/array-0.5.0.0/Data/Array/Storable/Internals.hs&quot;, srcSpanStartLine = 25, srcSpanStartColumn = 8, srcSpanEndLine = 25, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.Array.Base&quot;"><span class="mpre">Data.Array.Base</span></span><span class="mpre">
import Data.Array.MArray
import Foreign hiding (</span><a href="Foreign.Marshal.Array.html#loc_170_1_170_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Array.html#loc_170_1_170_9&#39;)"><span class="mpre">newArray</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |The array type</span></span><span class="mpre">
data </span><a name="loc_30_6_30_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_6_30_19&#39;)"><span class="hl_tycondecl"><span class="mpre">StorableArray</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">i</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> = </span><a name="loc_30_26_30_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_26_30_39&#39;)"><span class="hl_condecl"><span class="mpre">StorableArray</span></span></a><span class="mpre"> !</span><span class="hl_tyvar"><span class="mpre">i</span></span><span class="mpre"> !</span><span class="hl_tyvar"><span class="mpre">i</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> !(</span><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre">)

instance </span><span class="warning" data-warning="InstDecl ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/array-0.5.0.0/Data/Array/Storable/Internals.hs&quot;, srcSpanStartLine = 32, srcSpanStartColumn = 10, srcSpanEndLine = 32, srcSpanEndColumn = 23}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/array-0.5.0.0/Data/Array/Storable/Internals.hs&quot;, srcSpanStartLine = 32, srcSpanStartColumn = 21, srcSpanEndLine = 32, srcSpanEndColumn = 23}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemn"><span class="mpre">Storable e =&gt;</span></span><span class="mpre"> </span><span class="hl_classref"><span class="mpre">MArray</span></span><span class="mpre"> </span><a href="#loc_30_6_30_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_6_30_19&#39;)"><span class="hl_tyconref"><span class="mpre">StorableArray</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">getBounds</span></span><span class="mpre"> (</span><a href="#loc_30_26_30_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_26_30_39&#39;)"><span class="hl_conref"><span class="mpre">StorableArray</span></span></a><span class="mpre"> </span><a name="loc_33_30_33_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_30_33_31&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre"> </span><a name="loc_33_32_33_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_32_33_33&#39;)"><span class="hl_vardecl"><span class="mpre">u</span></span></a><span class="mpre"> _ _) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_33_30_33_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_30_33_31&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">,</span><a href="#loc_33_32_33_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_33_32_33_33&#39;)"><span class="hl_varref"><span class="mpre">u</span></span></a><span class="mpre">)

    </span><span class="hl_fundecl"><span class="mpre">getNumElements</span></span><span class="mpre"> (</span><a href="#loc_30_26_30_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_26_30_39&#39;)"><span class="hl_conref"><span class="mpre">StorableArray</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_l</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_u</span></span><span class="mpre"> </span><a name="loc_35_41_35_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_41_35_42&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> _) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_35_41_35_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_41_35_42&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">

    </span><span class="hl_fundecl"><span class="mpre">newArray</span></span><span class="mpre"> (</span><a name="loc_37_15_37_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_15_37_16&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">,</span><a name="loc_37_17_37_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_17_37_18&#39;)"><span class="hl_vardecl"><span class="mpre">u</span></span></a><span class="mpre">) </span><a name="loc_37_20_37_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_20_37_32&#39;)"><span class="hl_vardecl"><span class="mpre">initialValue</span></span></a><span class="mpre"> = do
        </span><a name="loc_38_9_38_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_9_38_11&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">mallocForeignPtrArray</span></span><span class="mpre"> </span><a href="#loc_43_9_43_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_9_43_13&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> </span><a href="#loc_38_9_38_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_9_38_11&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_39_30_39_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_30_39_31&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> -&gt;
            </span><span class="hl_varref"><span class="mpre">sequence_</span></span><span class="mpre"> [</span><span class="hl_varref"><span class="mpre">pokeElemOff</span></span><span class="mpre"> </span><a href="#loc_39_30_39_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_30_39_31&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><a href="#loc_40_55_40_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_55_40_56&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="#loc_37_20_37_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_20_37_32&#39;)"><span class="hl_varref"><span class="mpre">initialValue</span></span></a><span class="mpre"> | </span><a name="loc_40_55_40_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_40_55_40_56&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> &lt;- </span><span class="warning" data-warning="ExpEnumFromTo (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/array-0.5.0.0/Data/Array/Storable/Internals.hs&quot;, srcSpanStartLine = 40, srcSpanStartColumn = 60, srcSpanEndLine = 40, srcSpanEndColumn = 71}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/array-0.5.0.0/Data/Array/Storable/Internals.hs&quot;, srcSpanStartLine = 40, srcSpanStartColumn = 60, srcSpanEndLine = 40, srcSpanEndColumn = 61},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/array-0.5.0.0/Data/Array/Stor"><span class="mpre">[0..size-1]</span></span><span class="mpre">]
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_30_26_30_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_26_30_39&#39;)"><span class="hl_conref"><span class="mpre">StorableArray</span></span></a><span class="mpre"> </span><a href="#loc_37_15_37_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_15_37_16&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><a href="#loc_37_17_37_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_17_37_18&#39;)"><span class="hl_varref"><span class="mpre">u</span></span></a><span class="mpre"> </span><a href="#loc_43_9_43_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_9_43_13&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_38_9_38_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_38_9_38_11&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">)
        where
        </span><a name="loc_43_9_43_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_9_43_13&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">rangeSize</span></span><span class="mpre"> (</span><a href="#loc_37_15_37_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_15_37_16&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">,</span><a href="#loc_37_17_37_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_37_17_37_18&#39;)"><span class="hl_varref"><span class="mpre">u</span></span></a><span class="mpre">)

    </span><span class="hl_fundecl"><span class="mpre">unsafeNewArray_</span></span><span class="mpre"> (</span><a name="loc_45_22_45_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_22_45_23&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">,</span><a name="loc_45_24_45_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_24_45_25&#39;)"><span class="hl_vardecl"><span class="mpre">u</span></span></a><span class="mpre">) = do
        let </span><a name="loc_46_13_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_13_46_14&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">rangeSize</span></span><span class="mpre"> (</span><a href="#loc_45_22_45_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_22_45_23&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">,</span><a href="#loc_45_24_45_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_24_45_25&#39;)"><span class="hl_varref"><span class="mpre">u</span></span></a><span class="mpre">)
        </span><a name="loc_47_9_47_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_9_47_11&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">mallocForeignPtrArray</span></span><span class="mpre"> </span><a href="#loc_46_13_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_13_46_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_30_26_30_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_26_30_39&#39;)"><span class="hl_conref"><span class="mpre">StorableArray</span></span></a><span class="mpre"> </span><a href="#loc_45_22_45_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_22_45_23&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><a href="#loc_45_24_45_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_24_45_25&#39;)"><span class="hl_varref"><span class="mpre">u</span></span></a><span class="mpre"> </span><a href="#loc_46_13_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_13_46_14&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_47_9_47_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_9_47_11&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">)

    </span><span class="hl_vardecl"><span class="mpre">newArray_</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">unsafeNewArray_</span></span><span class="mpre">

    </span><span class="hl_fundecl"><span class="mpre">unsafeRead</span></span><span class="mpre"> (</span><a href="#loc_30_26_30_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_26_30_39&#39;)"><span class="hl_conref"><span class="mpre">StorableArray</span></span></a><span class="mpre"> _ _ _ </span><a name="loc_52_37_52_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_37_52_39&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre">) </span><a name="loc_52_41_52_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_41_52_42&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> =
        </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> </span><a href="#loc_52_37_52_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_37_52_39&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_53_30_53_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_30_53_31&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">peekElemOff</span></span><span class="mpre"> </span><a href="#loc_53_30_53_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_53_30_53_31&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><a href="#loc_52_41_52_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_41_52_42&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">

    </span><span class="hl_fundecl"><span class="mpre">unsafeWrite</span></span><span class="mpre"> (</span><a href="#loc_30_26_30_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_26_30_39&#39;)"><span class="hl_conref"><span class="mpre">StorableArray</span></span></a><span class="mpre"> _ _ _ </span><a name="loc_55_38_55_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_38_55_40&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre">) </span><a name="loc_55_42_55_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_42_55_43&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> </span><a name="loc_55_44_55_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_44_55_45&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> =
        </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> </span><a href="#loc_55_38_55_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_38_55_40&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_56_30_56_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_30_56_31&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">pokeElemOff</span></span><span class="mpre"> </span><a href="#loc_56_30_56_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_30_56_31&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><a href="#loc_55_42_55_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_42_55_43&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="#loc_55_44_55_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_44_55_45&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |The pointer to the array contents is obtained by &#39;withStorableArray&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The idea is similar to &#39;ForeignPtr&#39; (used internally here).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The pointer should be used only during execution of the &#39;IO&#39; action</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- retured by the function passed as argument to &#39;withStorableArray&#39;.</span></span><span class="mpre">
</span><a href="#loc_63_1_63_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_1_63_18&#39;)"><span class="mpre">withStorableArray</span></a><span class="mpre"> :: </span><a href="#loc_30_6_30_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_6_30_19&#39;)"><span class="hl_tyconref"><span class="mpre">StorableArray</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">i</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_63_1_63_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_1_63_18&#39;)"><span class="hl_fundecl"><span class="mpre">withStorableArray</span></span></a><span class="mpre"> (</span><a href="#loc_30_26_30_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_26_30_39&#39;)"><span class="hl_conref"><span class="mpre">StorableArray</span></span></a><span class="mpre"> _ _ _ </span><a name="loc_63_40_63_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_40_63_42&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre">) </span><a name="loc_63_44_63_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_44_63_45&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> </span><a href="#loc_63_40_63_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_40_63_42&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a href="#loc_63_44_63_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_44_63_45&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |If you want to use it afterwards, ensure that you</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;touchStorableArray&#39; after the last use of the pointer,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- so the array is not freed too early.</span></span><span class="mpre">
</span><a href="#loc_69_1_69_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_1_69_19&#39;)"><span class="mpre">touchStorableArray</span></a><span class="mpre"> :: </span><a href="#loc_30_6_30_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_6_30_19&#39;)"><span class="hl_tyconref"><span class="mpre">StorableArray</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">i</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_69_1_69_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_1_69_19&#39;)"><span class="hl_fundecl"><span class="mpre">touchStorableArray</span></span></a><span class="mpre"> (</span><a href="#loc_30_26_30_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_26_30_39&#39;)"><span class="hl_conref"><span class="mpre">StorableArray</span></span></a><span class="mpre"> _ _ _ </span><a name="loc_69_41_69_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_41_69_43&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre">) = </span><span class="hl_varref"><span class="mpre">touchForeignPtr</span></span><span class="mpre"> </span><a href="#loc_69_41_69_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_41_69_43&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Construct a &#39;StorableArray&#39; from an arbitrary &#39;ForeignPtr&#39;.  It is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the caller&#39;s responsibility to ensure that the &#39;ForeignPtr&#39; points to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- an area of memory sufficient for the specified bounds.</span></span><span class="mpre">
</span><a href="#loc_76_1_76_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_32&#39;)"><span class="mpre">unsafeForeignPtrToStorableArray</span></a><span class="mpre">
   :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/array-0.5.0.0/Data/Array/Storable/Internals.hs&quot;, srcSpanStartLine = 75, srcSpanStartColumn = 7, srcSpanEndLine = 75, srcSpanEndColumn = 14}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/array-0.5.0.0/Data/Array/Storable/Internals.hs&quot;, srcSpanStartLine = 75, srcSpanStartColumn = 12, srcSpanEndLine = 75, srcSpanEndColumn = 14}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemne"><span class="mpre">Ix i =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">i</span></span><span class="mpre">,</span><span class="hl_tyvar"><span class="mpre">i</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_30_6_30_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_6_30_19&#39;)"><span class="hl_tyconref"><span class="mpre">StorableArray</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">i</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre">)
</span><a name="loc_76_1_76_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_32&#39;)"><span class="hl_fundecl"><span class="mpre">unsafeForeignPtrToStorableArray</span></span></a><span class="mpre"> </span><a name="loc_76_33_76_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_33_76_34&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> (</span><a name="loc_76_36_76_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_36_76_37&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">,</span><a name="loc_76_38_76_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_38_76_39&#39;)"><span class="hl_vardecl"><span class="mpre">u</span></span></a><span class="mpre">) =
   </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_30_26_30_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_26_30_39&#39;)"><span class="hl_conref"><span class="mpre">StorableArray</span></span></a><span class="mpre"> </span><a href="#loc_76_36_76_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_36_76_37&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><a href="#loc_76_38_76_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_38_76_39&#39;)"><span class="hl_varref"><span class="mpre">u</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">rangeSize</span></span><span class="mpre"> (</span><a href="#loc_76_36_76_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_36_76_37&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">,</span><a href="#loc_76_38_76_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_38_76_39&#39;)"><span class="hl_varref"><span class="mpre">u</span></span></a><span class="mpre">)) </span><a href="#loc_76_33_76_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_33_76_34&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">)

</span></div></body></html>