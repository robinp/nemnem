<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Network.TLS.Context.Internal</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Network.TLS.Context.Internal
    (
    </span><span class="hl_comment"><span class="mpre">-- * Context configuration</span></span><span class="mpre">
      ClientParams(..)
    , ServerParams(..)
    , defaultParamsClient
    , SessionID
    , SessionData(..)
    , MaxFragmentEnum(..)
    , Measurement(..)

    </span><span class="hl_comment"><span class="mpre">-- * Context object and accessor</span></span><span class="mpre">
    , Context(..)
    , Hooks(..)
    , ctxEOF
    , ctxHasSSLv2ClientHello
    , ctxDisableSSLv2ClientHello
    , ctxEstablished
    , withLog
    , ctxWithHooks
    , contextModifyHooks
    , setEOF
    , setEstablished
    , contextFlush
    , contextClose
    , contextSend
    , contextRecv
    , updateMeasure
    , withMeasure
    , withReadLock
    , withWriteLock
    , withStateLock
    , withRWLock

    </span><span class="hl_comment"><span class="mpre">-- * information</span></span><span class="mpre">
    , Information(..)
    , contextGetInformation

    </span><span class="hl_comment"><span class="mpre">-- * Using context states</span></span><span class="mpre">
    , throwCore
    , usingState
    , usingState_
    , runTxState
    , runRxState
    , usingHState
    , getHState
    , getStateRNG
    ) where

import Network.TLS.Backend
import Network.TLS.Extension
import Network.TLS.Cipher
import Network.TLS.Struct
import Network.TLS.Compression (</span><a href="Network.TLS.Compression.html#loc_38_6_38_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Compression.html#loc_38_6_38_17&#39;)"><a href="Network.TLS.Compression.html#loc_38_49_38_60" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Compression.html#loc_38_49_38_60&#39;)"><span class="mpre">Compression</span></a></a><span class="mpre">)
import Network.TLS.State
import Network.TLS.Handshake.State
import Network.TLS.Hooks
import Network.TLS.Record.State
import Network.TLS.Parameters
import Network.TLS.Measurement
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context/Internal.hs&quot;, srcSpanStartLine = 68, srcSpanStartColumn = 18, srcSpanEndLine = 68, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B

import Control.Concurrent.MVar
import Control.Monad.State
import Control.Exception (</span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="mpre">throwIO</span></a><span class="mpre">, Exception())
import Data.IORef
import Data.Tuple


</span><span class="hl_comment"><span class="mpre">-- | Information related to a running context, e.g. current cipher</span></span><span class="mpre">
data </span><a name="loc_78_6_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_6_78_17&#39;)"><span class="hl_tycondecl"><span class="mpre">Information</span></span></a><span class="mpre"> = </span><a name="loc_78_20_78_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_20_78_31&#39;)"><span class="hl_condecl"><span class="mpre">Information</span></span></a><span class="mpre">
    { </span><a name="loc_79_7_79_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_7_79_18&#39;)"><span class="hl_fielddecl"><span class="mpre">infoVersion</span></span></a><span class="mpre">     :: </span><a href="Network.TLS.Types.html#loc_25_6_25_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Types.html#loc_25_6_25_13&#39;)"><span class="hl_tyconref"><span class="mpre">Version</span></span></a><span class="mpre">
    , </span><a name="loc_80_7_80_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_7_80_17&#39;)"><span class="hl_fielddecl"><span class="mpre">infoCipher</span></span></a><span class="mpre">      :: </span><a href="Network.TLS.Cipher.html#loc_82_6_82_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_82_6_82_12&#39;)"><span class="hl_tyconref"><span class="mpre">Cipher</span></span></a><span class="mpre">
    , </span><a name="loc_81_7_81_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_7_81_22&#39;)"><span class="hl_fielddecl"><span class="mpre">infoCompression</span></span></a><span class="mpre"> :: </span><a href="Network.TLS.Compression.html#loc_38_6_38_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Compression.html#loc_38_6_38_17&#39;)"><span class="hl_tyconref"><span class="mpre">Compression</span></span></a><span class="mpre">
    } </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context/Internal.hs&quot;, srcSpanStartLine = 82, srcSpanStartColumn = 7, srcSpanEndLine = 82, srcSpanEndColumn = 25}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context/Internal.hs&quot;, srcSpanStartLine = 82, srcSpanStartColumn = 7, srcSpanEndLine = 82, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context/Internal.hs&quot;,"><span class="mpre">deriving (Show,Eq)</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A TLS Context keep tls specific state, parameters and backend information.</span></span><span class="mpre">
data </span><a name="loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tycondecl"><span class="mpre">Context</span></span></a><span class="mpre"> = </span><span class="hl_condecl"><span class="mpre">Context</span></span><span class="mpre">
    { </span><a name="loc_86_7_86_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_7_86_20&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxConnection</span></span></a><span class="mpre">       :: </span><a href="Network.TLS.Backend.html#loc_31_6_31_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Backend.html#loc_31_6_31_13&#39;)"><span class="hl_tyconref"><span class="mpre">Backend</span></span></a><span class="mpre">   </span><span class="hl_comment"><span class="mpre">-- ^ return the backend object associated with this context</span></span><span class="mpre">
    , </span><a name="loc_87_7_87_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_7_87_19&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxSupported</span></span></a><span class="mpre">        :: </span><a href="Network.TLS.Parameters.html#loc_108_6_108_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_108_6_108_15&#39;)"><span class="hl_tyconref"><span class="mpre">Supported</span></span></a><span class="mpre">
    , </span><a name="loc_88_7_88_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_7_88_16&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxShared</span></span></a><span class="mpre">           :: </span><a href="Network.TLS.Parameters.html#loc_145_6_145_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_145_6_145_12&#39;)"><span class="hl_tyconref"><span class="mpre">Shared</span></span></a><span class="mpre">
    , </span><a name="loc_89_7_89_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_7_89_17&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxCiphers</span></span></a><span class="mpre">          :: [</span><a href="Network.TLS.Cipher.html#loc_82_6_82_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Cipher.html#loc_82_6_82_12&#39;)"><span class="hl_tyconref"><span class="mpre">Cipher</span></span></a><span class="mpre">]  </span><span class="hl_comment"><span class="mpre">-- ^ prepared list of allowed ciphers according to parameters</span></span><span class="mpre">
    , </span><a name="loc_90_7_90_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_7_90_15&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxState</span></span></a><span class="mpre">            :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_61_6_61_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_61_6_61_14&#39;)"><span class="hl_tyconref"><span class="mpre">TLSState</span></span></a><span class="mpre">
    , </span><a name="loc_91_7_91_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_7_91_21&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxMeasurement</span></span></a><span class="mpre">      :: </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><a href="Network.TLS.Measurement.html#loc_20_6_20_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Measurement.html#loc_20_6_20_17&#39;)"><span class="hl_tyconref"><span class="mpre">Measurement</span></span></a><span class="mpre">
    , </span><a name="loc_92_7_92_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_7_92_14&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxEOF_</span></span></a><span class="mpre">             :: </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ has the handle EOFed or not.</span></span><span class="mpre">
    , </span><a name="loc_93_7_93_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_7_93_22&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxEstablished_</span></span></a><span class="mpre">     :: </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ has the handshake been done and been successful.</span></span><span class="mpre">
    , </span><a name="loc_94_7_94_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_7_94_25&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxNeedEmptyPacket</span></span></a><span class="mpre">  :: </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ empty packet workaround for CBC guessability.</span></span><span class="mpre">
    , </span><a name="loc_95_7_95_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_7_95_26&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxSSLv2ClientHello</span></span></a><span class="mpre"> :: </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ enable the reception of compatibility SSLv2 client hello.</span></span><span class="mpre">
                                           </span><span class="hl_comment"><span class="mpre">-- the flag will be set to false regardless of its initial value</span></span><span class="mpre">
                                           </span><span class="hl_comment"><span class="mpre">-- after the first packet received.</span></span><span class="mpre">
    , </span><a name="loc_98_7_98_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_7_98_17&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxTxState</span></span></a><span class="mpre">          :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a href="Network.TLS.Record.State.html#loc_50_6_50_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Record.State.html#loc_50_6_50_17&#39;)"><span class="hl_tyconref"><span class="mpre">RecordState</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ current tx state</span></span><span class="mpre">
    , </span><a name="loc_99_7_99_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_7_99_17&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxRxState</span></span></a><span class="mpre">          :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><a href="Network.TLS.Record.State.html#loc_50_6_50_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Record.State.html#loc_50_6_50_17&#39;)"><span class="hl_tyconref"><span class="mpre">RecordState</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- ^ current rx state</span></span><span class="mpre">
    , </span><a name="loc_100_7_100_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_7_100_19&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxHandshake</span></span></a><span class="mpre">        :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_62_6_62_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_62_6_62_20&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeState</span></span></a><span class="mpre">) </span><span class="hl_comment"><span class="mpre">-- ^ optional handshake state</span></span><span class="mpre">
    , </span><a name="loc_101_7_101_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_7_101_21&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxDoHandshake</span></span></a><span class="mpre">      :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
    , </span><a name="loc_102_7_102_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_7_102_25&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxDoHandshakeWith</span></span></a><span class="mpre">  :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Struct.html#loc_252_6_252_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_252_6_252_15&#39;)"><span class="hl_tyconref"><span class="mpre">Handshake</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
    , </span><a name="loc_103_7_103_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_7_103_15&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxHooks</span></span></a><span class="mpre">            :: </span><a href="GHC.IORef.html#loc_34_9_34_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_34_9_34_14&#39;)"><span class="hl_tyconref"><span class="mpre">IORef</span></span></a><span class="mpre"> </span><a href="Network.TLS.Hooks.html#loc_41_6_41_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Hooks.html#loc_41_6_41_11&#39;)"><span class="hl_tyconref"><span class="mpre">Hooks</span></span></a><span class="mpre">   </span><span class="hl_comment"><span class="mpre">-- ^ hooks for this context</span></span><span class="mpre">
    , </span><a name="loc_104_7_104_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_7_104_19&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxLockWrite</span></span></a><span class="mpre">        :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">       </span><span class="hl_comment"><span class="mpre">-- ^ lock to use for writing data (including updating the state)</span></span><span class="mpre">
    , </span><a name="loc_105_7_105_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_7_105_18&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxLockRead</span></span></a><span class="mpre">         :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">       </span><span class="hl_comment"><span class="mpre">-- ^ lock to use for reading data (including updating the state)</span></span><span class="mpre">
    , </span><a name="loc_106_7_106_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_7_106_19&#39;)"><span class="hl_fielddecl"><span class="mpre">ctxLockState</span></span></a><span class="mpre">        :: </span><a href="GHC.MVar.html#loc_39_6_39_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_39_6_39_10&#39;)"><span class="hl_tyconref"><span class="mpre">MVar</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">       </span><span class="hl_comment"><span class="mpre">-- ^ lock used during read/write when receiving and sending packet.</span></span><span class="mpre">
                                           </span><span class="hl_comment"><span class="mpre">-- it is usually nested in a write or read lock.</span></span><span class="mpre">
    }

</span><a href="#loc_111_1_111_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_1_111_14&#39;)"><span class="mpre">updateMeasure</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; (</span><a href="Network.TLS.Measurement.html#loc_20_6_20_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Measurement.html#loc_20_6_20_17&#39;)"><span class="hl_tyconref"><span class="mpre">Measurement</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Measurement.html#loc_20_6_20_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Measurement.html#loc_20_6_20_17&#39;)"><span class="hl_tyconref"><span class="mpre">Measurement</span></span></a><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_111_1_111_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_1_111_14&#39;)"><span class="hl_fundecl"><span class="mpre">updateMeasure</span></span></a><span class="mpre"> </span><a name="loc_111_15_111_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_15_111_18&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_111_19_111_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_19_111_20&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = do
    </span><a name="loc_112_5_112_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_5_112_6&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> (</span><a href="#loc_91_7_91_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_7_91_21&#39;)"><span class="hl_varref"><span class="mpre">ctxMeasurement</span></span></a><span class="mpre"> </span><a href="#loc_111_15_111_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_15_111_18&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">)
    </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> (</span><a href="#loc_91_7_91_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_7_91_21&#39;)"><span class="hl_varref"><span class="mpre">ctxMeasurement</span></span></a><span class="mpre"> </span><a href="#loc_111_15_111_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_15_111_18&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="#loc_111_19_111_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_19_111_20&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_112_5_112_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_5_112_6&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">

</span><a href="#loc_116_1_116_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_1_116_12&#39;)"><span class="mpre">withMeasure</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; (</span><a href="Network.TLS.Measurement.html#loc_20_6_20_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Measurement.html#loc_20_6_20_17&#39;)"><span class="hl_tyconref"><span class="mpre">Measurement</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_116_1_116_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_1_116_12&#39;)"><span class="hl_fundecl"><span class="mpre">withMeasure</span></span></a><span class="mpre"> </span><a name="loc_116_13_116_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_13_116_16&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_116_17_116_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_17_116_18&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> (</span><a href="#loc_91_7_91_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_7_91_21&#39;)"><span class="hl_varref"><span class="mpre">ctxMeasurement</span></span></a><span class="mpre"> </span><a href="#loc_116_13_116_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_13_116_16&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="#loc_116_17_116_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_116_17_116_18&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">

</span><a href="#loc_119_1_119_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_13&#39;)"><span class="mpre">contextFlush</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_119_1_119_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_1_119_13&#39;)"><span class="hl_vardecl"><span class="mpre">contextFlush</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Backend.html#loc_32_7_32_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Backend.html#loc_32_7_32_19&#39;)"><span class="hl_varref"><span class="mpre">backendFlush</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_86_7_86_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_7_86_20&#39;)"><span class="hl_varref"><span class="mpre">ctxConnection</span></span></a><span class="mpre">

</span><a href="#loc_122_1_122_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_1_122_13&#39;)"><span class="mpre">contextClose</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_122_1_122_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_1_122_13&#39;)"><span class="hl_vardecl"><span class="mpre">contextClose</span></span></a><span class="mpre"> = </span><a href="Network.TLS.Backend.html#loc_33_7_33_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Backend.html#loc_33_7_33_19&#39;)"><span class="hl_varref"><span class="mpre">backendClose</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_86_7_86_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_7_86_20&#39;)"><span class="hl_varref"><span class="mpre">ctxConnection</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Information about the current context</span></span><span class="mpre">
</span><a href="#loc_126_1_126_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_22&#39;)"><span class="mpre">contextGetInformation</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="#loc_78_6_78_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_6_78_17&#39;)"><span class="hl_tyconref"><span class="mpre">Information</span></span></a><span class="mpre">)
</span><a name="loc_126_1_126_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_22&#39;)"><span class="hl_fundecl"><span class="mpre">contextGetInformation</span></span></a><span class="mpre"> </span><a name="loc_126_23_126_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_23_126_26&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> = do
    </span><a name="loc_127_5_127_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_5_127_8&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre">    &lt;- </span><a href="#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_126_23_126_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_23_126_26&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_73_7_73_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_73_7_73_16&#39;)"><span class="hl_varref"><span class="mpre">stVersion</span></span></a><span class="mpre">
    (</span><a name="loc_128_6_128_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_6_128_12&#39;)"><span class="hl_vardecl"><span class="mpre">cipher</span></span></a><span class="mpre">,</span><a name="loc_128_13_128_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_13_128_17&#39;)"><span class="hl_vardecl"><span class="mpre">comp</span></span></a><span class="mpre">) &lt;- </span><a href="#loc_170_1_170_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_18&#39;)"><span class="hl_varref"><span class="mpre">failOnEitherError</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_203_1_203_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_1_203_11&#39;)"><span class="hl_varref"><span class="mpre">runRxState</span></span></a><span class="mpre"> </span><a href="#loc_126_23_126_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_23_126_26&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Monad.State.Class.html#loc_95_1_95_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.State.Class.html#loc_95_1_95_5&#39;)"><span class="hl_varref"><span class="mpre">gets</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_128_67_128_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_67_128_69&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> -&gt; (</span><a href="Network.TLS.Record.State.html#loc_51_7_51_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Record.State.html#loc_51_7_51_15&#39;)"><span class="hl_varref"><span class="mpre">stCipher</span></span></a><span class="mpre"> </span><a href="#loc_128_67_128_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_67_128_69&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">, </span><a href="Network.TLS.Record.State.html#loc_52_7_52_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Record.State.html#loc_52_7_52_20&#39;)"><span class="hl_varref"><span class="mpre">stCompression</span></span></a><span class="mpre"> </span><a href="#loc_128_67_128_69" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_67_128_69&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">)
    case (</span><a href="#loc_127_5_127_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_5_127_8&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre">, </span><a href="#loc_128_6_128_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_6_128_12&#39;)"><span class="hl_varref"><span class="mpre">cipher</span></span></a><span class="mpre">) of
        (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_130_15_130_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_15_130_16&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_130_23_130_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_23_130_24&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre">) -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_78_20_78_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_20_78_31&#39;)"><span class="hl_conref"><span class="mpre">Information</span></span></a><span class="mpre"> </span><a href="#loc_130_15_130_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_15_130_16&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre"> </span><a href="#loc_130_23_130_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_23_130_24&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><a href="#loc_128_13_128_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_128_13_128_17&#39;)"><span class="hl_varref"><span class="mpre">comp</span></span></a><span class="mpre">
        _                -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">

</span><a href="#loc_134_1_134_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_1_134_12&#39;)"><span class="mpre">contextSend</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_134_1_134_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_1_134_12&#39;)"><span class="hl_fundecl"><span class="mpre">contextSend</span></span></a><span class="mpre"> </span><a name="loc_134_13_134_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_13_134_14&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> </span><a name="loc_134_15_134_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_15_134_16&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = </span><a href="#loc_111_1_111_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_1_111_14&#39;)"><span class="hl_varref"><span class="mpre">updateMeasure</span></span></a><span class="mpre"> </span><a href="#loc_134_13_134_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_13_134_14&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Measurement.html#loc_38_1_38_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Measurement.html#loc_38_1_38_13&#39;)"><span class="hl_varref"><span class="mpre">addBytesSent</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.length</span></span><span class="mpre"> </span><a href="#loc_134_15_134_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_15_134_16&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> (</span><a href="Network.TLS.Backend.html#loc_34_7_34_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Backend.html#loc_34_7_34_18&#39;)"><span class="hl_varref"><span class="mpre">backendSend</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_86_7_86_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_7_86_20&#39;)"><span class="hl_varref"><span class="mpre">ctxConnection</span></span></a><span class="mpre"> </span><a href="#loc_134_13_134_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_13_134_14&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">) </span><a href="#loc_134_15_134_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_15_134_16&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

</span><a href="#loc_137_1_137_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_12&#39;)"><span class="mpre">contextRecv</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre">
</span><a name="loc_137_1_137_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_1_137_12&#39;)"><span class="hl_fundecl"><span class="mpre">contextRecv</span></span></a><span class="mpre"> </span><a name="loc_137_13_137_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_13_137_14&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> </span><a name="loc_137_15_137_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_15_137_17&#39;)"><span class="hl_vardecl"><span class="mpre">sz</span></span></a><span class="mpre"> = </span><a href="#loc_111_1_111_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_1_111_14&#39;)"><span class="hl_varref"><span class="mpre">updateMeasure</span></span></a><span class="mpre"> </span><a href="#loc_137_13_137_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_13_137_14&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> (</span><a href="Network.TLS.Measurement.html#loc_34_1_34_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Measurement.html#loc_34_1_34_17&#39;)"><span class="hl_varref"><span class="mpre">addBytesReceived</span></span></a><span class="mpre"> </span><a href="#loc_137_15_137_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_15_137_17&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> (</span><a href="Network.TLS.Backend.html#loc_35_7_35_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Backend.html#loc_35_7_35_18&#39;)"><span class="hl_varref"><span class="mpre">backendRecv</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_86_7_86_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_7_86_20&#39;)"><span class="hl_varref"><span class="mpre">ctxConnection</span></span></a><span class="mpre"> </span><a href="#loc_137_13_137_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_13_137_14&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">) </span><a href="#loc_137_15_137_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_15_137_17&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre">

</span><a href="#loc_140_1_140_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_1_140_7&#39;)"><span class="mpre">ctxEOF</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_140_1_140_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_1_140_7&#39;)"><span class="hl_fundecl"><span class="mpre">ctxEOF</span></span></a><span class="mpre"> </span><a name="loc_140_8_140_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_8_140_11&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> = </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_92_7_92_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_7_92_14&#39;)"><span class="hl_varref"><span class="mpre">ctxEOF_</span></span></a><span class="mpre"> </span><a href="#loc_140_8_140_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_8_140_11&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">

</span><a href="#loc_143_1_143_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_23&#39;)"><span class="mpre">ctxHasSSLv2ClientHello</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_143_1_143_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_1_143_23&#39;)"><span class="hl_fundecl"><span class="mpre">ctxHasSSLv2ClientHello</span></span></a><span class="mpre"> </span><a name="loc_143_24_143_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_24_143_27&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> = </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_95_7_95_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_7_95_26&#39;)"><span class="hl_varref"><span class="mpre">ctxSSLv2ClientHello</span></span></a><span class="mpre"> </span><a href="#loc_143_24_143_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_24_143_27&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">

</span><a href="#loc_146_1_146_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_1_146_27&#39;)"><span class="mpre">ctxDisableSSLv2ClientHello</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_146_1_146_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_1_146_27&#39;)"><span class="hl_fundecl"><span class="mpre">ctxDisableSSLv2ClientHello</span></span></a><span class="mpre"> </span><a name="loc_146_28_146_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_28_146_31&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> = </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> (</span><a href="#loc_95_7_95_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_7_95_26&#39;)"><span class="hl_varref"><span class="mpre">ctxSSLv2ClientHello</span></span></a><span class="mpre"> </span><a href="#loc_146_28_146_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_28_146_31&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

</span><a href="#loc_149_1_149_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_1_149_7&#39;)"><span class="mpre">setEOF</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_149_1_149_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_1_149_7&#39;)"><span class="hl_fundecl"><span class="mpre">setEOF</span></span></a><span class="mpre"> </span><a name="loc_149_8_149_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_8_149_11&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> = </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> (</span><a href="#loc_92_7_92_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_92_7_92_14&#39;)"><span class="hl_varref"><span class="mpre">ctxEOF_</span></span></a><span class="mpre"> </span><a href="#loc_149_8_149_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_149_8_149_11&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">

</span><a href="#loc_152_1_152_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_1_152_15&#39;)"><span class="mpre">ctxEstablished</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_152_1_152_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_1_152_15&#39;)"><span class="hl_fundecl"><span class="mpre">ctxEstablished</span></span></a><span class="mpre"> </span><a name="loc_152_16_152_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_16_152_19&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> = </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_93_7_93_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_7_93_22&#39;)"><span class="hl_varref"><span class="mpre">ctxEstablished_</span></span></a><span class="mpre"> </span><a href="#loc_152_16_152_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_152_16_152_19&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">

</span><a href="#loc_155_1_155_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_13&#39;)"><span class="mpre">ctxWithHooks</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; (</span><a href="Network.TLS.Hooks.html#loc_41_6_41_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Hooks.html#loc_41_6_41_11&#39;)"><span class="hl_tyconref"><span class="mpre">Hooks</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_155_1_155_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_13&#39;)"><span class="hl_fundecl"><span class="mpre">ctxWithHooks</span></span></a><span class="mpre"> </span><a name="loc_155_14_155_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_14_155_17&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_155_18_155_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_18_155_19&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> (</span><a href="#loc_103_7_103_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_7_103_15&#39;)"><span class="hl_varref"><span class="mpre">ctxHooks</span></span></a><span class="mpre"> </span><a href="#loc_155_14_155_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_14_155_17&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="#loc_155_18_155_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_18_155_19&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">

</span><a href="#loc_158_1_158_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_1_158_19&#39;)"><span class="mpre">contextModifyHooks</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; (</span><a href="Network.TLS.Hooks.html#loc_41_6_41_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Hooks.html#loc_41_6_41_11&#39;)"><span class="hl_tyconref"><span class="mpre">Hooks</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Hooks.html#loc_41_6_41_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Hooks.html#loc_41_6_41_11&#39;)"><span class="hl_tyconref"><span class="mpre">Hooks</span></span></a><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_158_1_158_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_1_158_19&#39;)"><span class="hl_fundecl"><span class="mpre">contextModifyHooks</span></span></a><span class="mpre"> </span><a name="loc_158_20_158_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_20_158_23&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_158_24_158_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_24_158_25&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="Data.IORef.html#loc_70_1_70_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.IORef.html#loc_70_1_70_12&#39;)"><span class="hl_varref"><span class="mpre">modifyIORef</span></span></a><span class="mpre"> (</span><a href="#loc_103_7_103_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_7_103_15&#39;)"><span class="hl_varref"><span class="mpre">ctxHooks</span></span></a><span class="mpre"> </span><a href="#loc_158_20_158_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_20_158_23&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><a href="#loc_158_24_158_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_158_24_158_25&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">

</span><a href="#loc_161_1_161_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_1_161_15&#39;)"><span class="mpre">setEstablished</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_161_1_161_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_1_161_15&#39;)"><span class="hl_fundecl"><span class="mpre">setEstablished</span></span></a><span class="mpre"> </span><a name="loc_161_16_161_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_16_161_19&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_161_20_161_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_20_161_21&#39;)"><span class="hl_vardecl"><span class="mpre">v</span></span></a><span class="mpre"> = </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> (</span><a href="#loc_93_7_93_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_7_93_22&#39;)"><span class="hl_varref"><span class="mpre">ctxEstablished_</span></span></a><span class="mpre"> </span><a href="#loc_161_16_161_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_16_161_19&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><a href="#loc_161_20_161_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_20_161_21&#39;)"><span class="hl_varref"><span class="mpre">v</span></span></a><span class="mpre">

</span><a href="#loc_164_1_164_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_1_164_8&#39;)"><span class="mpre">withLog</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; (</span><a href="Network.TLS.Hooks.html#loc_22_6_22_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Hooks.html#loc_22_6_22_13&#39;)"><span class="hl_tyconref"><span class="mpre">Logging</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_164_1_164_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_1_164_8&#39;)"><span class="hl_fundecl"><span class="mpre">withLog</span></span></a><span class="mpre"> </span><a name="loc_164_9_164_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_9_164_12&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_164_13_164_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_13_164_14&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_155_1_155_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_155_1_155_13&#39;)"><span class="hl_varref"><span class="mpre">ctxWithHooks</span></span></a><span class="mpre"> </span><a href="#loc_164_9_164_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_9_164_12&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="#loc_164_13_164_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_164_13_164_14&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Network.TLS.Hooks.html#loc_47_7_47_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Hooks.html#loc_47_7_47_18&#39;)"><span class="hl_varref"><span class="mpre">hookLogging</span></span></a><span class="mpre">)

</span><a href="#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_1_167_10&#39;)"><span class="mpre">throwCore</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxTuple (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context/Internal.hs&quot;, srcSpanStartLine = 166, srcSpanStartColumn = 14, srcSpanEndLine = 166, srcSpanEndColumn = 41}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context/Internal.hs&quot;, srcSpanStartLine = 166, srcSpanStartColumn = 14, srcSpanEndLine = 166, srcSpanEndColumn = 15},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context/Internal"><span class="mpre">(MonadIO m, Exception e) =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_167_1_167_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_1_167_10&#39;)"><span class="hl_vardecl"><span class="mpre">throwCore</span></span></a><span class="mpre"> = </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre">

</span><a href="#loc_170_1_170_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_18&#39;)"><span class="mpre">failOnEitherError</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context/Internal.hs&quot;, srcSpanStartLine = 169, srcSpanStartColumn = 22, srcSpanEndLine = 169, srcSpanEndColumn = 34}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/tls-1.2.8/Network/TLS/Context/Internal.hs&quot;, srcSpanStartLine = 169, srcSpanStartColumn = 32, srcSpanEndLine = 169, srcSpanEndColumn = 34}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pul"><span class="mpre">MonadIO m =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_121_6_121_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_121_6_121_14&#39;)"><span class="hl_tyconref"><span class="mpre">TLSError</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_170_1_170_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_18&#39;)"><span class="hl_fundecl"><span class="mpre">failOnEitherError</span></span></a><span class="mpre"> </span><a name="loc_170_19_170_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_19_170_20&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = do
    </span><a name="loc_171_5_171_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_5_171_8&#39;)"><span class="hl_vardecl"><span class="mpre">ret</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_170_19_170_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_19_170_20&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">
    case </span><a href="#loc_171_5_171_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_5_171_8&#39;)"><span class="hl_varref"><span class="mpre">ret</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_173_14_173_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_14_173_17&#39;)"><span class="hl_vardecl"><span class="mpre">err</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><a href="#loc_173_14_173_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_173_14_173_17&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a name="loc_174_15_174_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_15_174_16&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_174_15_174_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_15_174_16&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

</span><a href="#loc_177_1_177_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_11&#39;)"><span class="mpre">usingState</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.State.html#loc_77_9_77_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_77_9_77_14&#39;)"><span class="hl_tyconref"><span class="mpre">TLSSt</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_121_6_121_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_121_6_121_14&#39;)"><span class="hl_tyconref"><span class="mpre">TLSError</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_177_1_177_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_11&#39;)"><span class="hl_fundecl"><span class="mpre">usingState</span></span></a><span class="mpre"> </span><a name="loc_177_12_177_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_12_177_15&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_177_16_177_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_16_177_17&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> =
    </span><a href="Control.Concurrent.MVar.html#loc_228_1_228_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_228_1_228_11&#39;)"><span class="hl_varref"><span class="mpre">modifyMVar</span></span></a><span class="mpre"> (</span><a href="#loc_90_7_90_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_7_90_15&#39;)"><span class="hl_varref"><span class="mpre">ctxState</span></span></a><span class="mpre"> </span><a href="#loc_177_12_177_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_12_177_15&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_178_34_178_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_34_178_36&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> -&gt;
            let (</span><a name="loc_179_18_179_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_18_179_19&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">, </span><a name="loc_179_21_179_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_21_179_26&#39;)"><span class="hl_vardecl"><span class="mpre">newst</span></span></a><span class="mpre">) = </span><a href="Network.TLS.State.html#loc_88_1_88_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_88_1_88_12&#39;)"><span class="hl_varref"><span class="mpre">runTLSState</span></span></a><span class="mpre"> </span><a href="#loc_177_16_177_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_16_177_17&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_178_34_178_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_178_34_178_36&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">
             in </span><a href="#loc_179_21_179_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_21_179_26&#39;)"><span class="hl_varref"><span class="mpre">newst</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`seq`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_179_21_179_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_21_179_26&#39;)"><span class="hl_varref"><span class="mpre">newst</span></span></a><span class="mpre">, </span><a href="#loc_179_18_179_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_179_18_179_19&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)

</span><a href="#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_12&#39;)"><span class="mpre">usingState_</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.State.html#loc_77_9_77_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_77_9_77_14&#39;)"><span class="hl_tyconref"><span class="mpre">TLSSt</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_183_1_183_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_12&#39;)"><span class="hl_fundecl"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a name="loc_183_13_183_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_13_183_16&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_183_17_183_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_17_183_18&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_170_1_170_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_170_1_170_18&#39;)"><span class="hl_varref"><span class="mpre">failOnEitherError</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_177_1_177_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_11&#39;)"><span class="hl_varref"><span class="mpre">usingState</span></span></a><span class="mpre"> </span><a href="#loc_183_13_183_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_13_183_16&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_183_17_183_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_17_183_18&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">

</span><a href="#loc_186_1_186_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_1_186_12&#39;)"><span class="mpre">usingHState</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Handshake.State.html#loc_86_9_86_19" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_86_9_86_19&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeM</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_186_1_186_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_1_186_12&#39;)"><span class="hl_fundecl"><span class="mpre">usingHState</span></span></a><span class="mpre"> </span><a name="loc_186_13_186_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_13_186_16&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_186_17_186_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_17_186_18&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Concurrent.MVar.html#loc_228_1_228_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_228_1_228_11&#39;)"><span class="hl_varref"><span class="mpre">modifyMVar</span></span></a><span class="mpre"> (</span><a href="#loc_100_7_100_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_7_100_19&#39;)"><span class="hl_varref"><span class="mpre">ctxHandshake</span></span></a><span class="mpre"> </span><a href="#loc_186_13_186_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_13_186_16&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_186_63_186_66" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_63_186_66&#39;)"><span class="hl_vardecl"><span class="mpre">mst</span></span></a><span class="mpre"> -&gt;
    case </span><a href="#loc_186_63_186_66" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_63_186_66&#39;)"><span class="hl_varref"><span class="mpre">mst</span></span></a><span class="mpre"> of
        </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><a href="#loc_167_1_167_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_167_1_167_10&#39;)"><span class="hl_varref"><span class="mpre">throwCore</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_122_7_122_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_122_7_122_17&#39;)"><span class="hl_conref"><span class="mpre">Error_Misc</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;missing handshake&quot;</span></span><span class="mpre">
        </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_189_14_189_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_14_189_16&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Tuple.html#loc_64_1_64_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Tuple.html#loc_64_1_64_5&#39;)"><span class="hl_varref"><span class="mpre">swap</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_119_1_119_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_119_1_119_13&#39;)"><span class="hl_varref"><span class="mpre">runHandshake</span></span></a><span class="mpre"> </span><a href="#loc_189_14_189_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_14_189_16&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre"> </span><a href="#loc_186_17_186_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_186_17_186_18&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">)

</span><a href="#loc_192_1_192_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_1_192_10&#39;)"><span class="mpre">getHState</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Network.TLS.Handshake.State.html#loc_62_6_62_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Handshake.State.html#loc_62_6_62_20&#39;)"><span class="hl_tyconref"><span class="mpre">HandshakeState</span></span></a><span class="mpre">)
</span><a name="loc_192_1_192_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_1_192_10&#39;)"><span class="hl_fundecl"><span class="mpre">getHState</span></span></a><span class="mpre"> </span><a name="loc_192_11_192_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_11_192_14&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> = </span><a href="Control.Monad.IO.Class.html#loc_32_5_32_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.IO.Class.html#loc_32_5_32_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.MVar.html#loc_116_1_116_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.MVar.html#loc_116_1_116_9&#39;)"><span class="hl_varref"><span class="mpre">readMVar</span></span></a><span class="mpre"> (</span><a href="#loc_100_7_100_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_7_100_19&#39;)"><span class="hl_varref"><span class="mpre">ctxHandshake</span></span></a><span class="mpre"> </span><a href="#loc_192_11_192_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_192_11_192_14&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">)

</span><a href="#loc_195_1_195_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_1_195_11&#39;)"><span class="mpre">runTxState</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Record.State.html#loc_57_9_57_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Record.State.html#loc_57_9_57_16&#39;)"><span class="hl_tyconref"><span class="mpre">RecordM</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_121_6_121_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_121_6_121_14&#39;)"><span class="hl_tyconref"><span class="mpre">TLSError</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_195_1_195_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_1_195_11&#39;)"><span class="hl_fundecl"><span class="mpre">runTxState</span></span></a><span class="mpre"> </span><a name="loc_195_12_195_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_12_195_15&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_195_16_195_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_16_195_17&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = do
    </span><a name="loc_196_5_196_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_5_196_8&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_195_12_195_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_12_195_15&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> (</span><a href="Network.TLS.State.html#loc_168_1_168_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_168_1_168_22&#39;)"><span class="hl_varref"><span class="mpre">getVersionWithDefault</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">maximum</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.Parameters.html#loc_113_7_113_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Parameters.html#loc_113_7_113_24&#39;)"><span class="hl_varref"><span class="mpre">supportedVersions</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_87_7_87_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_7_87_19&#39;)"><span class="hl_varref"><span class="mpre">ctxSupported</span></span></a><span class="mpre"> </span><a href="#loc_195_12_195_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_12_195_15&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">)
    </span><a href="Control.Concurrent.MVar.html#loc_228_1_228_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_228_1_228_11&#39;)"><span class="hl_varref"><span class="mpre">modifyMVar</span></span></a><span class="mpre"> (</span><a href="#loc_98_7_98_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_7_98_17&#39;)"><span class="hl_varref"><span class="mpre">ctxTxState</span></span></a><span class="mpre"> </span><a href="#loc_195_12_195_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_12_195_15&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_197_36_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_36_197_38&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> -&gt;
        case </span><a href="Network.TLS.Record.State.html#loc_57_31_57_41" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Record.State.html#loc_57_31_57_41&#39;)"><span class="hl_varref"><span class="mpre">runRecordM</span></span></a><span class="mpre"> </span><a href="#loc_195_16_195_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_16_195_17&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_196_5_196_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_5_196_8&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_197_36_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_36_197_38&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_199_18_199_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_18_199_21&#39;)"><span class="hl_vardecl"><span class="mpre">err</span></span></a><span class="mpre">         -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_197_36_197_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_197_36_197_38&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_199_18_199_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_199_18_199_21&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre">)
            </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a name="loc_200_20_200_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_20_200_21&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">, </span><a name="loc_200_23_200_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_23_200_28&#39;)"><span class="hl_vardecl"><span class="mpre">newSt</span></span></a><span class="mpre">) -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_200_23_200_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_23_200_28&#39;)"><span class="hl_varref"><span class="mpre">newSt</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a href="#loc_200_20_200_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_20_200_21&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)

</span><a href="#loc_203_1_203_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_1_203_11&#39;)"><span class="mpre">runRxState</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><a href="Network.TLS.Record.State.html#loc_57_9_57_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Record.State.html#loc_57_9_57_16&#39;)"><span class="hl_tyconref"><span class="mpre">RecordM</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="Network.TLS.Struct.html#loc_121_6_121_14" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Struct.html#loc_121_6_121_14&#39;)"><span class="hl_tyconref"><span class="mpre">TLSError</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_203_1_203_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_1_203_11&#39;)"><span class="hl_fundecl"><span class="mpre">runRxState</span></span></a><span class="mpre"> </span><a name="loc_203_12_203_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_12_203_15&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_203_16_203_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_16_203_17&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = do
    </span><a name="loc_204_5_204_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_5_204_8&#39;)"><span class="hl_vardecl"><span class="mpre">ver</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_203_12_203_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_12_203_15&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="Network.TLS.State.html#loc_165_1_165_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_165_1_165_11&#39;)"><span class="hl_varref"><span class="mpre">getVersion</span></span></a><span class="mpre">
    </span><a href="Control.Concurrent.MVar.html#loc_228_1_228_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_228_1_228_11&#39;)"><span class="hl_varref"><span class="mpre">modifyMVar</span></span></a><span class="mpre"> (</span><a href="#loc_99_7_99_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_7_99_17&#39;)"><span class="hl_varref"><span class="mpre">ctxRxState</span></span></a><span class="mpre"> </span><a href="#loc_203_12_203_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_12_203_15&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_205_36_205_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_36_205_38&#39;)"><span class="hl_vardecl"><span class="mpre">st</span></span></a><span class="mpre"> -&gt;
        case </span><a href="Network.TLS.Record.State.html#loc_57_31_57_41" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.Record.State.html#loc_57_31_57_41&#39;)"><span class="hl_varref"><span class="mpre">runRecordM</span></span></a><span class="mpre"> </span><a href="#loc_203_16_203_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_16_203_17&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_204_5_204_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_5_204_8&#39;)"><span class="hl_varref"><span class="mpre">ver</span></span></a><span class="mpre"> </span><a href="#loc_205_36_205_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_36_205_38&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a name="loc_207_18_207_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_18_207_21&#39;)"><span class="hl_vardecl"><span class="mpre">err</span></span></a><span class="mpre">         -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_205_36_205_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_205_36_205_38&#39;)"><span class="hl_varref"><span class="mpre">st</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_207_18_207_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_207_18_207_21&#39;)"><span class="hl_varref"><span class="mpre">err</span></span></a><span class="mpre">)
            </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a name="loc_208_20_208_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_20_208_21&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre">, </span><a name="loc_208_23_208_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_23_208_28&#39;)"><span class="hl_vardecl"><span class="mpre">newSt</span></span></a><span class="mpre">) -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_208_23_208_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_23_208_28&#39;)"><span class="hl_varref"><span class="mpre">newSt</span></span></a><span class="mpre">, </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><a href="#loc_208_20_208_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_208_20_208_21&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">)

</span><a href="#loc_211_1_211_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_12&#39;)"><span class="mpre">getStateRNG</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bytes</span></span><span class="mpre">
</span><a name="loc_211_1_211_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_1_211_12&#39;)"><span class="hl_fundecl"><span class="mpre">getStateRNG</span></span></a><span class="mpre"> </span><a name="loc_211_13_211_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_13_211_16&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_211_17_211_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_17_211_18&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> = </span><a href="#loc_183_1_183_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_183_1_183_12&#39;)"><span class="hl_varref"><span class="mpre">usingState_</span></span></a><span class="mpre"> </span><a href="#loc_211_13_211_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_13_211_16&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.TLS.State.html#loc_207_1_207_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.TLS.State.html#loc_207_1_207_10&#39;)"><span class="hl_varref"><span class="mpre">genRandom</span></span></a><span class="mpre"> </span><a href="#loc_211_17_211_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_211_17_211_18&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">

</span><a href="#loc_214_1_214_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_1_214_13&#39;)"><span class="mpre">withReadLock</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_214_1_214_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_1_214_13&#39;)"><span class="hl_fundecl"><span class="mpre">withReadLock</span></span></a><span class="mpre"> </span><a name="loc_214_14_214_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_14_214_17&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_214_18_214_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_18_214_19&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="Control.Concurrent.MVar.html#loc_185_1_185_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_185_1_185_9&#39;)"><span class="hl_varref"><span class="mpre">withMVar</span></span></a><span class="mpre"> (</span><a href="#loc_105_7_105_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_7_105_18&#39;)"><span class="hl_varref"><span class="mpre">ctxLockRead</span></span></a><span class="mpre"> </span><a href="#loc_214_14_214_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_14_214_17&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> </span><a href="#loc_214_18_214_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_18_214_19&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">)

</span><a href="#loc_217_1_217_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_1_217_14&#39;)"><span class="mpre">withWriteLock</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_217_1_217_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_1_217_14&#39;)"><span class="hl_fundecl"><span class="mpre">withWriteLock</span></span></a><span class="mpre"> </span><a name="loc_217_15_217_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_15_217_18&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_217_19_217_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_19_217_20&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="Control.Concurrent.MVar.html#loc_185_1_185_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_185_1_185_9&#39;)"><span class="hl_varref"><span class="mpre">withMVar</span></span></a><span class="mpre"> (</span><a href="#loc_104_7_104_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_7_104_19&#39;)"><span class="hl_varref"><span class="mpre">ctxLockWrite</span></span></a><span class="mpre"> </span><a href="#loc_217_15_217_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_15_217_18&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> </span><a href="#loc_217_19_217_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_19_217_20&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">)

</span><a href="#loc_220_1_220_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_1_220_11&#39;)"><span class="mpre">withRWLock</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_220_1_220_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_1_220_11&#39;)"><span class="hl_fundecl"><span class="mpre">withRWLock</span></span></a><span class="mpre"> </span><a name="loc_220_12_220_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_12_220_15&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_220_16_220_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_16_220_17&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="#loc_214_1_214_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_1_214_13&#39;)"><span class="hl_varref"><span class="mpre">withReadLock</span></span></a><span class="mpre"> </span><a href="#loc_220_12_220_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_12_220_15&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_217_1_217_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_217_1_217_14&#39;)"><span class="hl_varref"><span class="mpre">withWriteLock</span></span></a><span class="mpre"> </span><a href="#loc_220_12_220_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_12_220_15&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a href="#loc_220_16_220_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_16_220_17&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">

</span><a href="#loc_223_1_223_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_1_223_14&#39;)"><span class="mpre">withStateLock</span></a><span class="mpre"> :: </span><a href="#loc_85_6_85_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_6_85_13&#39;)"><span class="hl_tyconref"><span class="mpre">Context</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_223_1_223_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_1_223_14&#39;)"><span class="hl_fundecl"><span class="mpre">withStateLock</span></span></a><span class="mpre"> </span><a name="loc_223_15_223_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_15_223_18&#39;)"><span class="hl_vardecl"><span class="mpre">ctx</span></span></a><span class="mpre"> </span><a name="loc_223_19_223_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_19_223_20&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = </span><a href="Control.Concurrent.MVar.html#loc_185_1_185_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Concurrent.MVar.html#loc_185_1_185_9&#39;)"><span class="hl_varref"><span class="mpre">withMVar</span></span></a><span class="mpre"> (</span><a href="#loc_106_7_106_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_7_106_19&#39;)"><span class="hl_varref"><span class="mpre">ctxLockState</span></span></a><span class="mpre"> </span><a href="#loc_223_15_223_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_15_223_18&#39;)"><span class="hl_varref"><span class="mpre">ctx</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> </span><a href="#loc_223_19_223_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_223_19_223_20&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">)
</span></div></body></html>