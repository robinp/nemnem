<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE OverloadedStrings #-}
module Data.Streaming.NetworkSpec where

import           </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/streaming-commons-0.1.3/test/Data/Streaming/NetworkSpec.hs&quot;, srcSpanStartLine = 4, srcSpanStartColumn = 18, srcSpanEndLine = 4, srcSpanEndColumn = 42}, srcInfoPoints = []}) &quot;Control.Concurrent.Async&quot;"><span class="mpre">Control.Concurrent.Async</span></span><span class="mpre"> (withAsync)
import           Control.Exception        (</span><a href="Control.Exception.Base.html#loc_259_1_259_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_259_1_259_8&#39;)"><span class="mpre">bracket</span></a><span class="mpre">)
import           Control.Monad            (</span><a href="Control.Monad.html#loc_189_1_189_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_189_1_189_8&#39;)"><span class="mpre">forever</span></a><span class="mpre">, </span><a href="Control.Monad.html#loc_254_1_254_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_254_1_254_12&#39;)"><span class="mpre">replicateM_</span></a><span class="mpre">)
import           Data.Array.Unboxed       (elems)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/streaming-commons-0.1.3/test/Data/Streaming/NetworkSpec.hs&quot;, srcSpanStartLine = 8, srcSpanStartColumn = 18, srcSpanEndLine = 8, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre">    as S8
import           Data.Char                (</span><a href="GHC.Unicode.html#loc_144_1_144_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_144_1_144_8&#39;)"><span class="mpre">toUpper</span></a><span class="mpre">)
import           </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/streaming-commons-0.1.3/test/Data/Streaming/NetworkSpec.hs&quot;, srcSpanStartLine = 10, srcSpanStartColumn = 18, srcSpanEndLine = 10, srcSpanEndColumn = 40}, srcInfoPoints = []}) &quot;Data.Streaming.Network&quot;"><span class="mpre">Data.Streaming.Network</span></span><span class="mpre">
import           </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/streaming-commons-0.1.3/test/Data/Streaming/NetworkSpec.hs&quot;, srcSpanStartLine = 11, srcSpanStartColumn = 18, srcSpanEndLine = 11, srcSpanEndColumn = 32}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre">           (sClose)
import           </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/streaming-commons-0.1.3/test/Data/Streaming/NetworkSpec.hs&quot;, srcSpanStartLine = 12, srcSpanStartColumn = 18, srcSpanEndLine = 12, srcSpanEndColumn = 28}, srcInfoPoints = []}) &quot;Test.Hspec&quot;"><span class="mpre">Test.Hspec</span></span><span class="mpre">
import           </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/streaming-commons-0.1.3/test/Data/Streaming/NetworkSpec.hs&quot;, srcSpanStartLine = 13, srcSpanStartColumn = 18, srcSpanEndLine = 13, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Test.Hspec.QuickCheck&quot;"><span class="mpre">Test.Hspec.QuickCheck</span></span><span class="mpre">

</span><a href="#loc_16_1_16_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_5&#39;)"><span class="mpre">spec</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Spec</span></span><span class="mpre">
</span><a name="loc_16_1_16_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_16_1_16_5&#39;)"><span class="hl_vardecl"><span class="mpre">spec</span></span></a><span class="mpre"> = do
    </span><span class="hl_varref"><span class="mpre">describe</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;getUnassignedPort&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><span class="hl_varref"><span class="mpre">it</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;sanity&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Control.Monad.html#loc_254_1_254_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_254_1_254_12&#39;)"><span class="hl_varref"><span class="mpre">replicateM_</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">100000</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
            </span><a name="loc_19_13_19_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_13_19_17&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">getUnassignedPort</span></span><span class="mpre">
            (</span><a href="#loc_19_13_19_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_19_13_19_17&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`elem`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">elems</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">unassignedPorts</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">describe</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;bindRandomPortTCP&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
        </span><span class="hl_varref"><span class="mpre">modifyMaxSuccess</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">const</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">5</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">prop</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;sanity&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_22_55_22_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_55_22_62&#39;)"><span class="hl_vardecl"><span class="mpre">content</span></span></a><span class="mpre"> -&gt; </span><a href="Control.Exception.Base.html#loc_259_1_259_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_259_1_259_8&#39;)"><span class="hl_varref"><span class="mpre">bracket</span></span></a><span class="mpre">
            (</span><span class="hl_varref"><span class="mpre">bindRandomPortTCP</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;*4&quot;</span></span><span class="mpre">)
            (</span><span class="hl_varref"><span class="mpre">sClose</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">snd</span></span><span class="mpre">)
            </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a name="loc_25_17_25_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_17_25_21&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre">, </span><a name="loc_25_23_25_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_23_25_29&#39;)"><span class="hl_vardecl"><span class="mpre">socket</span></span></a><span class="mpre">) -&gt; do
                let </span><a name="loc_26_21_26_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_21_26_27&#39;)"><span class="hl_fundecl"><span class="mpre">server</span></span></a><span class="mpre"> </span><a name="loc_26_28_26_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_28_26_30&#39;)"><span class="hl_vardecl"><span class="mpre">ad</span></span></a><span class="mpre"> = </span><a href="Control.Monad.html#loc_189_1_189_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_189_1_189_8&#39;)"><span class="hl_varref"><span class="mpre">forever</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">appRead</span></span><span class="mpre"> </span><a href="#loc_26_28_26_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_28_26_30&#39;)"><span class="hl_varref"><span class="mpre">ad</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">appWrite</span></span><span class="mpre"> </span><a href="#loc_26_28_26_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_28_26_30&#39;)"><span class="hl_varref"><span class="mpre">ad</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S8.map</span></span><span class="mpre"> </span><a href="GHC.Unicode.html#loc_144_1_144_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_144_1_144_8&#39;)"><span class="hl_varref"><span class="mpre">toUpper</span></span></a><span class="mpre">
                    </span><a name="loc_27_21_27_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_21_27_27&#39;)"><span class="hl_fundecl"><span class="mpre">client</span></span></a><span class="mpre"> </span><a name="loc_27_28_27_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_28_27_30&#39;)"><span class="hl_vardecl"><span class="mpre">ad</span></span></a><span class="mpre"> = do
                        </span><span class="hl_varref"><span class="mpre">appWrite</span></span><span class="mpre"> </span><a href="#loc_27_28_27_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_28_27_30&#39;)"><span class="hl_varref"><span class="mpre">ad</span></span></a><span class="mpre"> </span><a href="#loc_30_21_30_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_21_30_23&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
                        </span><span class="hl_varref"><span class="mpre">appRead</span></span><span class="mpre"> </span><a href="#loc_27_28_27_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_28_27_30&#39;)"><span class="hl_varref"><span class="mpre">ad</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">`shouldBe`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S8.map</span></span><span class="mpre"> </span><a href="GHC.Unicode.html#loc_144_1_144_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Unicode.html#loc_144_1_144_8&#39;)"><span class="hl_varref"><span class="mpre">toUpper</span></span></a><span class="mpre"> </span><a href="#loc_30_21_30_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_21_30_23&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">)
                    </span><a name="loc_30_21_30_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_30_21_30_23&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">
                        | </span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_22_55_22_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_55_22_62&#39;)"><span class="hl_varref"><span class="mpre">content</span></span></a><span class="mpre"> = </span><span class="hl_string"><span class="mpre">&quot;hello&quot;</span></span><span class="mpre">
                        | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">S8.pack</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">take</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1000</span></span><span class="mpre"> </span><a href="#loc_22_55_22_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_22_55_22_62&#39;)"><span class="hl_varref"><span class="mpre">content</span></span></a><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">withAsync</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">runTCPServer</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">serverSettingsTCPSocket</span></span><span class="mpre"> </span><a href="#loc_25_23_25_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_23_25_29&#39;)"><span class="hl_varref"><span class="mpre">socket</span></span></a><span class="mpre">) </span><a href="#loc_26_21_26_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_21_26_27&#39;)"><span class="hl_varref"><span class="mpre">server</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \_ -&gt; do
                    </span><span class="hl_varref"><span class="mpre">runTCPClient</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">clientSettingsTCP</span></span><span class="mpre"> </span><a href="#loc_25_17_25_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_17_25_21&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;127.0.0.1&quot;</span></span><span class="mpre">) </span><a href="#loc_27_21_27_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_21_27_27&#39;)"><span class="hl_varref"><span class="mpre">client</span></span></a><span class="mpre">
</span></div></body></html>