<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="hl_comment"><span class="mpre">-- | Search for a pattern in a file, find the number of occurences</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Tested in this benchmark:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- * Searching all occurences of a pattern using library routines</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Benchmarks.Search
    ( benchmark
    ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/benchmarks/haskell/Benchmarks/Search.hs&quot;, srcSpanStartLine = 11, srcSpanStartColumn = 8, srcSpanEndLine = 11, srcSpanEndColumn = 17}, srcInfoPoints = []}) &quot;Criterion&quot;"><span class="mpre">Criterion</span></span><span class="mpre"> (Benchmark, bench, bgroup, whnf)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/benchmarks/haskell/Benchmarks/Search.hs&quot;, srcSpanStartLine = 12, srcSpanStartColumn = 18, srcSpanEndLine = 12, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/text-1.1.1.3/benchmarks/haskell/Benchmarks/Search.hs&quot;, srcSpanStartLine = 13, srcSpanStartColumn = 18, srcSpanEndLine = 13, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as BL
import qualified Data.ByteString.Lazy.Search as BL
import qualified Data.ByteString.Search as B
import qualified Data.Text as T
import qualified Data.Text.Encoding as T
import qualified Data.Text.IO as T
import qualified Data.Text.Lazy as TL
import qualified Data.Text.Lazy.IO as TL

</span><a href="#loc_23_1_23_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_10&#39;)"><span class="mpre">benchmark</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FilePath</span></span><span class="mpre"> -&gt; </span><a href="Data.Text.Internal.html#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">T.Text</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Benchmark</span></span><span class="mpre">
</span><a name="loc_23_1_23_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_1_23_10&#39;)"><span class="hl_fundecl"><span class="mpre">benchmark</span></span></a><span class="mpre"> </span><a name="loc_23_11_23_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_11_23_13&#39;)"><span class="hl_vardecl"><span class="mpre">fp</span></span></a><span class="mpre"> </span><a name="loc_23_14_23_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_14_23_21&#39;)"><span class="hl_vardecl"><span class="mpre">needleT</span></span></a><span class="mpre"> = do
    </span><a name="loc_24_5_24_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_5_24_6&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">  &lt;- </span><span class="hl_varref"><span class="mpre">B.readFile</span></span><span class="mpre"> </span><a href="#loc_23_11_23_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_11_23_13&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
    </span><a name="loc_25_5_25_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_5_25_7&#39;)"><span class="hl_vardecl"><span class="mpre">bl</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">BL.readFile</span></span><span class="mpre"> </span><a href="#loc_23_11_23_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_11_23_13&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
    </span><a name="loc_26_5_26_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_5_26_6&#39;)"><span class="hl_vardecl"><span class="mpre">t</span></span></a><span class="mpre">  &lt;- </span><a href="Data.Text.IO.html#loc_88_1_88_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.IO.html#loc_88_1_88_9&#39;)"><span class="hl_varref"><span class="mpre">T.readFile</span></span></a><span class="mpre"> </span><a href="#loc_23_11_23_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_11_23_13&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
    </span><a name="loc_27_5_27_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_5_27_7&#39;)"><span class="hl_vardecl"><span class="mpre">tl</span></span></a><span class="mpre"> &lt;- </span><a href="Data.Text.Lazy.IO.html#loc_82_1_82_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Lazy.IO.html#loc_82_1_82_9&#39;)"><span class="hl_varref"><span class="mpre">TL.readFile</span></span></a><span class="mpre"> </span><a href="#loc_23_11_23_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_11_23_13&#39;)"><span class="hl_varref"><span class="mpre">fp</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">bgroup</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;FileIndices&quot;</span></span><span class="mpre">
        [ </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;ByteString&quot;</span></span><span class="mpre">     </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">whnf</span></span><span class="mpre"> (</span><a href="#loc_39_1_39_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_11&#39;)"><span class="hl_varref"><span class="mpre">byteString</span></span></a><span class="mpre"> </span><a href="#loc_35_5_35_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_5_35_12&#39;)"><span class="hl_varref"><span class="mpre">needleB</span></span></a><span class="mpre">)     </span><a href="#loc_24_5_24_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_24_5_24_6&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">
        , </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;LazyByteString&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">whnf</span></span><span class="mpre"> (</span><a href="#loc_42_1_42_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_15&#39;)"><span class="hl_varref"><span class="mpre">lazyByteString</span></span></a><span class="mpre"> </span><a href="#loc_35_5_35_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_5_35_12&#39;)"><span class="hl_varref"><span class="mpre">needleB</span></span></a><span class="mpre">) </span><a href="#loc_25_5_25_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_25_5_25_7&#39;)"><span class="hl_varref"><span class="mpre">bl</span></span></a><span class="mpre">
        , </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Text&quot;</span></span><span class="mpre">           </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">whnf</span></span><span class="mpre"> (</span><a href="#loc_45_1_45_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_5&#39;)"><span class="hl_varref"><span class="mpre">text</span></span></a><span class="mpre"> </span><a href="#loc_23_14_23_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_14_23_21&#39;)"><span class="hl_varref"><span class="mpre">needleT</span></span></a><span class="mpre">)           </span><a href="#loc_26_5_26_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_26_5_26_6&#39;)"><span class="hl_varref"><span class="mpre">t</span></span></a><span class="mpre">
        , </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;LazyText&quot;</span></span><span class="mpre">       </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">whnf</span></span><span class="mpre"> (</span><a href="#loc_48_1_48_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_1_48_9&#39;)"><span class="hl_varref"><span class="mpre">lazyText</span></span></a><span class="mpre"> </span><a href="#loc_36_5_36_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_5_36_13&#39;)"><span class="hl_varref"><span class="mpre">needleTL</span></span></a><span class="mpre">)      </span><a href="#loc_27_5_27_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_27_5_27_7&#39;)"><span class="hl_varref"><span class="mpre">tl</span></span></a><span class="mpre">
        ]
  where
    </span><a name="loc_35_5_35_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_35_5_35_12&#39;)"><span class="hl_vardecl"><span class="mpre">needleB</span></span></a><span class="mpre"> = </span><a href="Data.Text.Encoding.html#loc_386_1_386_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Encoding.html#loc_386_1_386_11&#39;)"><span class="hl_varref"><span class="mpre">T.encodeUtf8</span></span></a><span class="mpre"> </span><a href="#loc_23_14_23_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_14_23_21&#39;)"><span class="hl_varref"><span class="mpre">needleT</span></span></a><span class="mpre">
    </span><a name="loc_36_5_36_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_36_5_36_13&#39;)"><span class="hl_vardecl"><span class="mpre">needleTL</span></span></a><span class="mpre"> = </span><a href="Data.Text.Lazy.html#loc_385_1_385_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Lazy.html#loc_385_1_385_11&#39;)"><span class="hl_varref"><span class="mpre">TL.fromChunks</span></span></a><span class="mpre"> [</span><a href="#loc_23_14_23_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_23_14_23_21&#39;)"><span class="hl_varref"><span class="mpre">needleT</span></span></a><span class="mpre">]

</span><a href="#loc_39_1_39_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_11&#39;)"><span class="mpre">byteString</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_39_1_39_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_11&#39;)"><span class="hl_fundecl"><span class="mpre">byteString</span></span></a><span class="mpre"> </span><a name="loc_39_12_39_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_12_39_18&#39;)"><span class="hl_vardecl"><span class="mpre">needle</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">length</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.ByteString.Search.html#loc_128_1_128_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Search.html#loc_128_1_128_8&#39;)"><span class="hl_varref"><span class="mpre">B.indices</span></span></a><span class="mpre"> </span><a href="#loc_39_12_39_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_12_39_18&#39;)"><span class="hl_varref"><span class="mpre">needle</span></span></a><span class="mpre">

</span><a href="#loc_42_1_42_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_15&#39;)"><span class="mpre">lazyByteString</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">B.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">BL.ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_42_1_42_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_15&#39;)"><span class="hl_fundecl"><span class="mpre">lazyByteString</span></span></a><span class="mpre"> </span><a name="loc_42_16_42_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_16_42_22&#39;)"><span class="hl_vardecl"><span class="mpre">needle</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">length</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.ByteString.Lazy.Search.html#loc_172_1_172_8" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Search.html#loc_172_1_172_8&#39;)"><span class="hl_varref"><span class="mpre">BL.indices</span></span></a><span class="mpre"> </span><a href="#loc_42_16_42_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_16_42_22&#39;)"><span class="hl_varref"><span class="mpre">needle</span></span></a><span class="mpre">

</span><a href="#loc_45_1_45_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_5&#39;)"><span class="mpre">text</span></a><span class="mpre"> :: </span><a href="Data.Text.Internal.html#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">T.Text</span></span></a><span class="mpre"> -&gt; </span><a href="Data.Text.Internal.html#loc_50_6_50_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.html#loc_50_6_50_10&#39;)"><span class="hl_tyconref"><span class="mpre">T.Text</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_45_1_45_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_5&#39;)"><span class="hl_vardecl"><span class="mpre">text</span></span></a><span class="mpre"> = </span><a href="Data.Text.html#loc_1439_1_1439_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.html#loc_1439_1_1439_6&#39;)"><span class="hl_varref"><span class="mpre">T.count</span></span></a><span class="mpre">

</span><a href="#loc_48_1_48_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_1_48_9&#39;)"><span class="mpre">lazyText</span></a><span class="mpre"> :: </span><a href="Data.Text.Internal.Lazy.html#loc_47_6_47_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Lazy.html#loc_47_6_47_10&#39;)"><span class="hl_tyconref"><span class="mpre">TL.Text</span></span></a><span class="mpre"> -&gt; </span><a href="Data.Text.Internal.Lazy.html#loc_47_6_47_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Internal.Lazy.html#loc_47_6_47_10&#39;)"><span class="hl_tyconref"><span class="mpre">TL.Text</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_48_1_48_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_1_48_9&#39;)"><span class="hl_fundecl"><span class="mpre">lazyText</span></span></a><span class="mpre"> </span><a name="loc_48_10_48_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_10_48_16&#39;)"><span class="hl_vardecl"><span class="mpre">needle</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.Text.Lazy.html#loc_1515_1_1515_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Text.Lazy.html#loc_1515_1_1515_6&#39;)"><span class="hl_varref"><span class="mpre">TL.count</span></span></a><span class="mpre"> </span><a href="#loc_48_10_48_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_48_10_48_16&#39;)"><span class="hl_varref"><span class="mpre">needle</span></span></a><span class="mpre">
</span></div></body></html>