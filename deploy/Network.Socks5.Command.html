<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE DeriveDataTypeable #-}
{-# LANGUAGE ViewPatterns #-}
{-# LANGUAGE CPP #-}
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : Network.Socks5.Command</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD-style</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Vincent Hanquez &lt;vincent@snarc.org&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : unknown</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Network.Socks5.Command
    ( establish
    , Connect(..)
    , Command(..)
    , connectIPV4
    , connectIPV6
    , connectDomainName
    </span><span class="hl_comment"><span class="mpre">-- * lowlevel interface</span></span><span class="mpre">
    , rpc
    , rpc_
    , sendSerialized
    , waitSerialized
    ) where

import Control.Applicative
import Control.Exception
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 27, srcSpanStartColumn = 8, srcSpanEndLine = 27, srcSpanEndColumn = 23}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> (ByteString)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 28, srcSpanStartColumn = 18, srcSpanEndLine = 28, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre"> as B
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 29, srcSpanStartColumn = 18, srcSpanEndLine = 29, srcSpanEndColumn = 39}, srcInfoPoints = []}) &quot;Data.ByteString.Char8&quot;"><span class="mpre">Data.ByteString.Char8</span></span><span class="mpre"> as BC
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 30, srcSpanStartColumn = 8, srcSpanEndLine = 30, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Data.Serialize&quot;"><span class="mpre">Data.Serialize</span></span><span class="mpre">

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 32, srcSpanStartColumn = 8, srcSpanEndLine = 32, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Network.Socket&quot;"><span class="mpre">Network.Socket</span></span><span class="mpre"> (Socket, PortNumber, HostAddress, HostAddress6)
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 33, srcSpanStartColumn = 8, srcSpanEndLine = 33, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Network.Socket.ByteString&quot;"><span class="mpre">Network.Socket.ByteString</span></span><span class="mpre">

import Network.Socks5.Types
import Network.Socks5.Wire

</span><a href="#loc_39_1_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_10&#39;)"><span class="mpre">establish</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; [</span><a href="Network.Socks5.Types.html#loc_44_6_44_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_44_6_44_17&#39;)"><span class="hl_tyconref"><span class="mpre">SocksMethod</span></span></a><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="Network.Socks5.Types.html#loc_44_6_44_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_44_6_44_17&#39;)"><span class="hl_tyconref"><span class="mpre">SocksMethod</span></span></a><span class="mpre">
</span><a name="loc_39_1_39_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_1_39_10&#39;)"><span class="hl_fundecl"><span class="mpre">establish</span></span></a><span class="mpre"> </span><a name="loc_39_11_39_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_11_39_17&#39;)"><span class="hl_vardecl"><span class="mpre">socket</span></span></a><span class="mpre"> </span><a name="loc_39_18_39_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_18_39_25&#39;)"><span class="hl_vardecl"><span class="mpre">methods</span></span></a><span class="mpre"> = do
    </span><span class="hl_varref"><span class="mpre">sendAll</span></span><span class="mpre"> </span><a href="#loc_39_11_39_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_11_39_17&#39;)"><span class="hl_varref"><span class="mpre">socket</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">encode</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">SocksHello</span></span><span class="mpre"> </span><a href="#loc_39_18_39_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_18_39_25&#39;)"><span class="hl_varref"><span class="mpre">methods</span></span></a><span class="mpre">)
    </span><a href="Network.Socks5.Wire.html#loc_30_48_30_75" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Wire.html#loc_30_48_30_75&#39;)"><span class="hl_varref"><span class="mpre">getSocksHelloResponseMethod</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="#loc_99_1_99_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_11&#39;)"><span class="hl_varref"><span class="mpre">runGetDone</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">get</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">recv</span></span><span class="mpre"> </span><a href="#loc_39_11_39_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_39_11_39_17&#39;)"><span class="hl_varref"><span class="mpre">socket</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">4096</span></span><span class="mpre">)

newtype </span><a name="loc_43_9_43_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_9_43_16&#39;)"><span class="hl_tycondecl"><span class="mpre">Connect</span></span></a><span class="mpre"> = </span><a name="loc_43_19_43_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_19_43_26&#39;)"><span class="hl_condecl"><span class="mpre">Connect</span></span></a><span class="mpre"> </span><a href="Network.Socks5.Types.html#loc_87_6_87_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_87_6_87_18&#39;)"><span class="hl_tyconref"><span class="mpre">SocksAddress</span></span></a><span class="mpre"> </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 43, srcSpanStartColumn = 40, srcSpanEndLine = 43, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 43, srcSpanStartColumn = 40, srcSpanEndLine = 43, srcSpanEndColumn = 48},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanSt"><span class="mpre">deriving (Show,Eq,Ord)</span></span><span class="mpre">

class </span><a name="loc_45_7_45_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_7_45_14&#39;)"><span class="hl_classdecl"><span class="mpre">Command</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> where
    </span><a name="loc_46_5_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_5_46_14&#39;)"><span class="mpre">toRequest</span></a><span class="mpre">   :: </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="Network.Socks5.Wire.html#loc_34_6_34_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Wire.html#loc_34_6_34_18&#39;)"><span class="hl_tyconref"><span class="mpre">SocksRequest</span></span></a><span class="mpre">
    </span><a name="loc_47_5_47_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_5_47_16&#39;)"><span class="mpre">fromRequest</span></a><span class="mpre"> :: </span><a href="Network.Socks5.Wire.html#loc_34_6_34_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Wire.html#loc_34_6_34_18&#39;)"><span class="hl_tyconref"><span class="mpre">SocksRequest</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">

instance </span><a href="#loc_45_7_45_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_7_45_14&#39;)"><span class="hl_classref"><span class="mpre">Command</span></span></a><span class="mpre"> </span><a href="Network.Socks5.Wire.html#loc_34_6_34_18" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Wire.html#loc_34_6_34_18&#39;)"><span class="hl_tyconref"><span class="mpre">SocksRequest</span></span></a><span class="mpre"> where
    </span><a href="#loc_46_5_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_5_46_14&#39;)"><span class="hl_vardecl"><span class="mpre">toRequest</span></span></a><span class="mpre">   = </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">
    </span><a href="#loc_47_5_47_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_5_47_16&#39;)"><span class="hl_vardecl"><span class="mpre">fromRequest</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre">

instance </span><a href="#loc_45_7_45_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_7_45_14&#39;)"><span class="hl_classref"><span class="mpre">Command</span></span></a><span class="mpre"> </span><a href="#loc_43_9_43_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_9_43_16&#39;)"><span class="hl_tyconref"><span class="mpre">Connect</span></span></a><span class="mpre"> where
    </span><a href="#loc_46_5_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_5_46_14&#39;)"><span class="hl_fundecl"><span class="mpre">toRequest</span></span></a><span class="mpre"> (</span><a href="#loc_43_19_43_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_19_43_26&#39;)"><span class="hl_conref"><span class="mpre">Connect</span></span></a><span class="mpre"> (</span><a href="Network.Socks5.Types.html#loc_87_21_87_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_87_21_87_33&#39;)"><span class="hl_conref"><span class="mpre">SocksAddress</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">ha</span></span><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">port</span></span><span class="mpre">)) = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 50, srcSpanEndLine = 58, srcSpanEndColumn = 14}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 55, srcSpanStartColumn = 13, srcSpanEndLine = 55, srcSpanEndColumn = 14},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanS"><span class="mpre">SocksRequest
            { requestCommand  = SocksCommandConnect
            , requestDstAddr  = ha
            , requestDstPort  = fromIntegral port
            }</span></span><span class="mpre">
    </span><a href="#loc_47_5_47_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_47_5_47_16&#39;)"><span class="hl_fundecl"><span class="mpre">fromRequest</span></span></a><span class="mpre"> </span><a name="loc_59_17_59_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_17_59_20&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre">
        | </span><a href="Network.Socks5.Wire.html#loc_35_7_35_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Wire.html#loc_35_7_35_21&#39;)"><span class="hl_varref"><span class="mpre">requestCommand</span></span></a><span class="mpre"> </span><a href="#loc_59_17_59_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_17_59_20&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">/=</span></span><span class="mpre"> </span><a href="Network.Socks5.Types.html#loc_34_7_34_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_34_7_34_26&#39;)"><span class="hl_conref"><span class="mpre">SocksCommandConnect</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
        | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_43_19_43_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_19_43_26&#39;)"><span class="hl_conref"><span class="mpre">Connect</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Socks5.Types.html#loc_87_21_87_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_87_21_87_33&#39;)"><span class="hl_conref"><span class="mpre">SocksAddress</span></span></a><span class="mpre"> (</span><a href="Network.Socks5.Wire.html#loc_36_7_36_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Wire.html#loc_36_7_36_21&#39;)"><span class="hl_varref"><span class="mpre">requestDstAddr</span></span></a><span class="mpre"> </span><a href="#loc_59_17_59_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_17_59_20&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">) (</span><a href="Network.Socks5.Wire.html#loc_37_7_37_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Wire.html#loc_37_7_37_21&#39;)"><span class="hl_varref"><span class="mpre">requestDstPort</span></span></a><span class="mpre"> </span><a href="#loc_59_17_59_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_59_17_59_20&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">)

</span><a href="#loc_64_1_64_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_12&#39;)"><span class="mpre">connectIPV4</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">HostAddress</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">PortNumber</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">HostAddress</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">PortNumber</span></span><span class="mpre">)
</span><a name="loc_64_1_64_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_1_64_12&#39;)"><span class="hl_fundecl"><span class="mpre">connectIPV4</span></span></a><span class="mpre"> </span><a name="loc_64_13_64_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_13_64_19&#39;)"><span class="hl_vardecl"><span class="mpre">socket</span></span></a><span class="mpre"> </span><a name="loc_64_20_64_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_20_64_28&#39;)"><span class="hl_vardecl"><span class="mpre">hostaddr</span></span></a><span class="mpre"> </span><a name="loc_64_29_64_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_29_64_33&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> = </span><a href="#loc_65_11_65_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_11_65_18&#39;)"><span class="hl_varref"><span class="mpre">onReply</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="#loc_94_1_94_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_5&#39;)"><span class="hl_varref"><span class="mpre">rpc_</span></span></a><span class="mpre"> </span><a href="#loc_64_13_64_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_13_64_19&#39;)"><span class="hl_varref"><span class="mpre">socket</span></span></a><span class="mpre"> (</span><a href="#loc_43_19_43_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_19_43_26&#39;)"><span class="hl_conref"><span class="mpre">Connect</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Socks5.Types.html#loc_87_21_87_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_87_21_87_33&#39;)"><span class="hl_conref"><span class="mpre">SocksAddress</span></span></a><span class="mpre"> (</span><a href="Network.Socks5.Types.html#loc_54_7_54_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_54_7_54_20&#39;)"><span class="hl_conref"><span class="mpre">SocksAddrIPV4</span></span></a><span class="mpre"> </span><a href="#loc_64_20_64_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_20_64_28&#39;)"><span class="hl_varref"><span class="mpre">hostaddr</span></span></a><span class="mpre">) </span><a href="#loc_64_29_64_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_64_29_64_33&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre">)
    where </span><a name="loc_65_11_65_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_11_65_18&#39;)"><span class="hl_fundecl"><span class="mpre">onReply</span></span></a><span class="mpre"> (</span><a href="Network.Socks5.Types.html#loc_54_7_54_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_54_7_54_20&#39;)"><span class="hl_conref"><span class="mpre">SocksAddrIPV4</span></span></a><span class="mpre"> </span><a name="loc_65_34_65_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_34_65_35&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre">, </span><a name="loc_65_37_65_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_37_65_38&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre">) = (</span><a href="#loc_65_34_65_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_34_65_35&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">, </span><a href="#loc_65_37_65_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_37_65_38&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">)
          </span><a href="#loc_65_11_65_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_65_11_65_18&#39;)"><span class="hl_fundecl"><span class="mpre">onReply</span></span></a><span class="mpre"> _                    = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;ipv4 requested, got something different&quot;</span></span><span class="mpre">

</span><a href="#loc_69_1_69_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_1_69_12&#39;)"><span class="mpre">connectIPV6</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">HostAddress6</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">PortNumber</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">HostAddress6</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">PortNumber</span></span><span class="mpre">)
</span><a name="loc_69_1_69_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_1_69_12&#39;)"><span class="hl_fundecl"><span class="mpre">connectIPV6</span></span></a><span class="mpre"> </span><a name="loc_69_13_69_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_13_69_19&#39;)"><span class="hl_vardecl"><span class="mpre">socket</span></span></a><span class="mpre"> </span><a name="loc_69_20_69_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_20_69_29&#39;)"><span class="hl_vardecl"><span class="mpre">hostaddr6</span></span></a><span class="mpre"> </span><a name="loc_69_30_69_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_30_69_34&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> = </span><a href="#loc_70_11_70_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_11_70_18&#39;)"><span class="hl_varref"><span class="mpre">onReply</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="#loc_94_1_94_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_5&#39;)"><span class="hl_varref"><span class="mpre">rpc_</span></span></a><span class="mpre"> </span><a href="#loc_69_13_69_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_13_69_19&#39;)"><span class="hl_varref"><span class="mpre">socket</span></span></a><span class="mpre"> (</span><a href="#loc_43_19_43_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_19_43_26&#39;)"><span class="hl_conref"><span class="mpre">Connect</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Socks5.Types.html#loc_87_21_87_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_87_21_87_33&#39;)"><span class="hl_conref"><span class="mpre">SocksAddress</span></span></a><span class="mpre"> (</span><a href="Network.Socks5.Types.html#loc_56_7_56_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_56_7_56_20&#39;)"><span class="hl_conref"><span class="mpre">SocksAddrIPV6</span></span></a><span class="mpre"> </span><a href="#loc_69_20_69_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_20_69_29&#39;)"><span class="hl_varref"><span class="mpre">hostaddr6</span></span></a><span class="mpre">) </span><a href="#loc_69_30_69_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_69_30_69_34&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre">)
    where </span><a name="loc_70_11_70_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_11_70_18&#39;)"><span class="hl_fundecl"><span class="mpre">onReply</span></span></a><span class="mpre"> (</span><a href="Network.Socks5.Types.html#loc_56_7_56_20" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_56_7_56_20&#39;)"><span class="hl_conref"><span class="mpre">SocksAddrIPV6</span></span></a><span class="mpre"> </span><a name="loc_70_34_70_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_34_70_35&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre">, </span><a name="loc_70_37_70_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_37_70_38&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre">) = (</span><a href="#loc_70_34_70_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_34_70_35&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">, </span><a href="#loc_70_37_70_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_37_70_38&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre">)
          </span><a href="#loc_70_11_70_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_70_11_70_18&#39;)"><span class="hl_fundecl"><span class="mpre">onReply</span></span></a><span class="mpre"> _                    = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;ipv6 requested, got something different&quot;</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- TODO: FQDN should only be ascii, maybe putting a &quot;fqdn&quot; data type</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in front to make sure and make the BC.pack safe.</span></span><span class="mpre">
</span><a href="#loc_76_1_76_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_18&#39;)"><span class="mpre">connectDomainName</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">PortNumber</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.Socks5.Types.html#loc_53_6_53_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_53_6_53_22&#39;)"><span class="hl_tyconref"><span class="mpre">SocksHostAddress</span></span></a><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">PortNumber</span></span><span class="mpre">)
</span><a name="loc_76_1_76_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_1_76_18&#39;)"><span class="hl_fundecl"><span class="mpre">connectDomainName</span></span></a><span class="mpre"> </span><a name="loc_76_19_76_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_19_76_25&#39;)"><span class="hl_vardecl"><span class="mpre">socket</span></span></a><span class="mpre"> </span><a name="loc_76_26_76_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_26_76_30&#39;)"><span class="hl_vardecl"><span class="mpre">fqdn</span></span></a><span class="mpre"> </span><a name="loc_76_31_76_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_31_76_35&#39;)"><span class="hl_vardecl"><span class="mpre">port</span></span></a><span class="mpre"> = </span><a href="#loc_94_1_94_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_5&#39;)"><span class="hl_varref"><span class="mpre">rpc_</span></span></a><span class="mpre"> </span><a href="#loc_76_19_76_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_19_76_25&#39;)"><span class="hl_varref"><span class="mpre">socket</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_43_19_43_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_19_43_26&#39;)"><span class="hl_conref"><span class="mpre">Connect</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Socks5.Types.html#loc_87_21_87_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_87_21_87_33&#39;)"><span class="hl_conref"><span class="mpre">SocksAddress</span></span></a><span class="mpre"> (</span><a href="Network.Socks5.Types.html#loc_55_7_55_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_55_7_55_26&#39;)"><span class="hl_conref"><span class="mpre">SocksAddrDomainName</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">BC.pack</span></span><span class="mpre"> </span><a href="#loc_76_26_76_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_26_76_30&#39;)"><span class="hl_varref"><span class="mpre">fqdn</span></span></a><span class="mpre">) </span><a href="#loc_76_31_76_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_76_31_76_35&#39;)"><span class="hl_varref"><span class="mpre">port</span></span></a><span class="mpre">

</span><a href="#loc_79_1_79_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_15&#39;)"><span class="mpre">sendSerialized</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 78, srcSpanStartColumn = 19, srcSpanEndLine = 78, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 78, srcSpanStartColumn = 31, srcSpanEndLine = 78, srcSpanEndColumn = 33}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5."><span class="mpre">Serialize a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_79_1_79_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_15&#39;)"><span class="hl_fundecl"><span class="mpre">sendSerialized</span></span></a><span class="mpre"> </span><a name="loc_79_16_79_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_16_79_20&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> </span><a name="loc_79_21_79_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_21_79_22&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">sendAll</span></span><span class="mpre"> </span><a href="#loc_79_16_79_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_16_79_20&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">encode</span></span><span class="mpre"> </span><a href="#loc_79_21_79_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_21_79_22&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">

</span><a href="#loc_82_1_82_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_1_82_15&#39;)"><span class="mpre">waitSerialized</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 81, srcSpanStartColumn = 19, srcSpanEndLine = 81, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 81, srcSpanStartColumn = 31, srcSpanEndLine = 81, srcSpanEndColumn = 33}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5."><span class="mpre">Serialize a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_82_1_82_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_1_82_15&#39;)"><span class="hl_fundecl"><span class="mpre">waitSerialized</span></span></a><span class="mpre"> </span><a name="loc_82_16_82_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_16_82_20&#39;)"><span class="hl_vardecl"><span class="mpre">sock</span></span></a><span class="mpre"> = </span><a href="#loc_99_1_99_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_11&#39;)"><span class="hl_varref"><span class="mpre">runGetDone</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">get</span></span><span class="mpre"> (</span><a href="#loc_111_1_111_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_1_111_8&#39;)"><span class="hl_varref"><span class="mpre">getMore</span></span></a><span class="mpre"> </span><a href="#loc_82_16_82_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_16_82_20&#39;)"><span class="hl_varref"><span class="mpre">sock</span></span></a><span class="mpre">)

</span><a href="#loc_85_1_85_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_4&#39;)"><span class="mpre">rpc</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 84, srcSpanStartColumn = 8, srcSpanEndLine = 84, srcSpanEndColumn = 20}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 84, srcSpanStartColumn = 18, srcSpanEndLine = 84, srcSpanEndColumn = 20}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4"><span class="mpre">Command a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> </span><a href="Network.Socks5.Types.html#loc_97_6_97_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_97_6_97_16&#39;)"><span class="hl_tyconref"><span class="mpre">SocksError</span></span></a><span class="mpre"> (</span><a href="Network.Socks5.Types.html#loc_53_6_53_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_53_6_53_22&#39;)"><span class="hl_tyconref"><span class="mpre">SocksHostAddress</span></span></a><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">PortNumber</span></span><span class="mpre">))
</span><a name="loc_85_1_85_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_4&#39;)"><span class="hl_fundecl"><span class="mpre">rpc</span></span></a><span class="mpre"> </span><a name="loc_85_5_85_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_5_85_11&#39;)"><span class="hl_vardecl"><span class="mpre">socket</span></span></a><span class="mpre"> </span><a name="loc_85_12_85_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_12_85_15&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> = do
    </span><a href="#loc_79_1_79_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_1_79_15&#39;)"><span class="hl_varref"><span class="mpre">sendSerialized</span></span></a><span class="mpre"> </span><a href="#loc_85_5_85_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_5_85_11&#39;)"><span class="hl_varref"><span class="mpre">socket</span></span></a><span class="mpre"> (</span><a href="#loc_46_5_46_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_46_5_46_14&#39;)"><span class="hl_varref"><span class="mpre">toRequest</span></span></a><span class="mpre"> </span><a href="#loc_85_12_85_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_12_85_15&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre">)
    </span><a href="#loc_88_11_88_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_11_88_18&#39;)"><span class="hl_varref"><span class="mpre">onReply</span></span></a><span class="mpre"> </span><a href="Data.Functor.html#loc_32_1_32_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Functor.html#loc_32_1_32_6&#39;)"><span class="hl_infix"><span class="mpre">&lt;$&gt;</span></span></a><span class="mpre"> </span><a href="#loc_99_1_99_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_11&#39;)"><span class="hl_varref"><span class="mpre">runGetDone</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">get</span></span><span class="mpre"> (</span><a href="#loc_111_1_111_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_1_111_8&#39;)"><span class="hl_varref"><span class="mpre">getMore</span></span></a><span class="mpre"> </span><a href="#loc_85_5_85_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_5_85_11&#39;)"><span class="hl_varref"><span class="mpre">socket</span></span></a><span class="mpre">)
    where </span><a name="loc_88_11_88_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_11_88_18&#39;)"><span class="hl_fundecl"><span class="mpre">onReply</span></span></a><span class="mpre"> </span><a name="loc_88_19_88_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_19_88_22&#39;)"><span class="hl_specname"><span class="mpre">res</span></span></a><span class="mpre">@(</span><span class="warning" data-warning="PatPViewPat (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 88, srcSpanStartColumn = 24, srcSpanEndLine = 88, srcSpanEndColumn = 46}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 88, srcSpanStartColumn = 38, srcSpanEndLine = 88, srcSpanEndColumn = 40}]}) (Var (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/N"><span class="mpre">responseReply -&gt; reply</span></span><span class="mpre">) =
                case </span><span class="hl_varref"><span class="mpre">reply</span></span><span class="mpre"> of
                    </span><a href="Network.Socks5.Types.html#loc_92_7_92_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_92_7_92_24&#39;)"><span class="hl_conref"><span class="mpre">SocksReplySuccess</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> (</span><a href="Network.Socks5.Wire.html#loc_43_7_43_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Wire.html#loc_43_7_43_23&#39;)"><span class="hl_varref"><span class="mpre">responseBindAddr</span></span></a><span class="mpre"> </span><a href="#loc_88_19_88_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_19_88_22&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Network.Socks5.Wire.html#loc_44_7_44_23" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Wire.html#loc_44_7_44_23&#39;)"><span class="hl_varref"><span class="mpre">responseBindPort</span></span></a><span class="mpre"> </span><a href="#loc_88_19_88_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_19_88_22&#39;)"><span class="hl_varref"><span class="mpre">res</span></span></a><span class="mpre">)
                    </span><a href="Network.Socks5.Types.html#loc_93_7_93_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_93_7_93_22&#39;)"><span class="hl_conref"><span class="mpre">SocksReplyError</span></span></a><span class="mpre"> </span><a name="loc_91_37_91_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_37_91_38&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><a href="#loc_91_37_91_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_37_91_38&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">

</span><a href="#loc_94_1_94_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_5&#39;)"><span class="mpre">rpc_</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 93, srcSpanStartColumn = 9, srcSpanEndLine = 93, srcSpanEndColumn = 21}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 93, srcSpanStartColumn = 19, srcSpanEndLine = 93, srcSpanEndColumn = 21}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4"><span class="mpre">Command a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Network.Socks5.Types.html#loc_53_6_53_22" onmouseover="nemnem.highlightLocalToRemote(&#39;Network.Socks5.Types.html#loc_53_6_53_22&#39;)"><span class="hl_tyconref"><span class="mpre">SocksHostAddress</span></span></a><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">PortNumber</span></span><span class="mpre">)
</span><a name="loc_94_1_94_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_1_94_5&#39;)"><span class="hl_fundecl"><span class="mpre">rpc_</span></span></a><span class="mpre"> </span><a name="loc_94_6_94_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_12&#39;)"><span class="hl_vardecl"><span class="mpre">socket</span></span></a><span class="mpre"> </span><a name="loc_94_13_94_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_13_94_16&#39;)"><span class="hl_vardecl"><span class="mpre">req</span></span></a><span class="mpre"> = </span><a href="#loc_85_1_85_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_1_85_4&#39;)"><span class="hl_varref"><span class="mpre">rpc</span></span></a><span class="mpre"> </span><a href="#loc_94_6_94_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_6_94_12&#39;)"><span class="hl_varref"><span class="mpre">socket</span></span></a><span class="mpre"> </span><a href="#loc_94_13_94_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_13_94_16&#39;)"><span class="hl_varref"><span class="mpre">req</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">either</span></span><span class="mpre"> </span><a href="GHC.IO.html#loc_304_1_304_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_304_1_304_8&#39;)"><span class="hl_varref"><span class="mpre">throwIO</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- this function expect all the data to be consumed. this is fine for intertwined message,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- but might not be a good idea for multi messages from one party.</span></span><span class="mpre">
</span><a href="#loc_99_1_99_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_11&#39;)"><span class="mpre">runGetDone</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 98, srcSpanStartColumn = 15, srcSpanEndLine = 98, srcSpanEndColumn = 29}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5.4/Network/Socks5/Command.hs&quot;, srcSpanStartLine = 98, srcSpanStartColumn = 27, srcSpanEndLine = 98, srcSpanEndColumn = 29}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/socks-0.5."><span class="mpre">Serialize a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Get</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_99_1_99_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_1_99_11&#39;)"><span class="hl_fundecl"><span class="mpre">runGetDone</span></span></a><span class="mpre"> </span><a name="loc_99_12_99_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_12_99_18&#39;)"><span class="hl_vardecl"><span class="mpre">getter</span></span></a><span class="mpre"> </span><a name="loc_99_19_99_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_19_99_24&#39;)"><span class="hl_vardecl"><span class="mpre">ioget</span></span></a><span class="mpre"> = </span><a href="#loc_99_19_99_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_19_99_24&#39;)"><span class="hl_varref"><span class="mpre">ioget</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">runGetPartial</span></span><span class="mpre"> </span><a href="#loc_99_12_99_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_12_99_18&#39;)"><span class="hl_varref"><span class="mpre">getter</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="#loc_101_5_101_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_5_101_6&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> where
#if MIN_VERSION_cereal(0,4,0)
    </span><a name="loc_101_5_101_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_5_101_6&#39;)"><span class="hl_fundecl"><span class="mpre">r</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Fail</span></span><span class="mpre"> </span><a name="loc_101_13_101_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_13_101_14&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> _)     = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><a href="#loc_101_13_101_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_13_101_14&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
#else
    </span><a href="#loc_101_5_101_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_5_101_6&#39;)"><span class="hl_fundecl"><span class="mpre">r</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Fail</span></span><span class="mpre"> </span><a name="loc_103_13_103_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_13_103_14&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">)       = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><a href="#loc_103_13_103_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_13_103_14&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
#endif
    </span><a href="#loc_101_5_101_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_5_101_6&#39;)"><span class="hl_fundecl"><span class="mpre">r</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Partial</span></span><span class="mpre"> </span><a name="loc_105_16_105_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_16_105_20&#39;)"><span class="hl_vardecl"><span class="mpre">cont</span></span></a><span class="mpre">) = </span><a href="#loc_99_19_99_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_99_19_99_24&#39;)"><span class="hl_varref"><span class="mpre">ioget</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="#loc_101_5_101_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_5_101_6&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_105_16_105_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_16_105_20&#39;)"><span class="hl_varref"><span class="mpre">cont</span></span></a><span class="mpre">
    </span><a href="#loc_101_5_101_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_5_101_6&#39;)"><span class="hl_fundecl"><span class="mpre">r</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Done</span></span><span class="mpre"> </span><a name="loc_106_13_106_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_13_106_14&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> </span><a name="loc_106_15_106_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_15_106_16&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">)
        | </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">B.null</span></span><span class="mpre"> </span><a href="#loc_106_15_106_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_15_106_16&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;got too many bytes while receiving data&quot;</span></span><span class="mpre">
        | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">      = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_106_13_106_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_13_106_14&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre">

</span><a href="#loc_111_1_111_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_1_111_8&#39;)"><span class="mpre">getMore</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Socket</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">ByteString</span></span><span class="mpre">
</span><a name="loc_111_1_111_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_1_111_8&#39;)"><span class="hl_fundecl"><span class="mpre">getMore</span></span></a><span class="mpre"> </span><a name="loc_111_9_111_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_9_111_15&#39;)"><span class="hl_vardecl"><span class="mpre">socket</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">recv</span></span><span class="mpre"> </span><a href="#loc_111_9_111_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_9_111_15&#39;)"><span class="hl_varref"><span class="mpre">socket</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">4096</span></span><span class="mpre">
</span></div></body></html>