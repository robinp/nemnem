<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Trustworthy #-}
{-# LANGUAGE CPP
           , NoImplicitPrelude
           , RecordWildCards
           , BangPatterns
           , NondecreasingIndentation
           , MagicHash
  #-}
{-# OPTIONS_GHC -fno-warn-name-shadowing #-}
{-# OPTIONS_GHC -fno-warn-unused-matches #-}
{-# OPTIONS_HADDOCK hide #-}

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  GHC.IO.Text</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow, 1992-2008</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  see libraries/base/LICENSE</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  libraries@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  internal</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- String I\/O functions</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module GHC.IO.Handle.Text ( 
        hWaitForInput, hGetChar, hGetLine, hGetContents, hPutChar, hPutStr,
        commitBuffer&#39;,       </span><span class="hl_comment"><span class="mpre">-- hack, see below</span></span><span class="mpre">
        hGetBuf, hGetBufSome, hGetBufNonBlocking, hPutBuf, hPutBufNonBlocking,
        memcpy, hPutStrLn,
    ) where

import GHC.IO
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 35, srcSpanStartColumn = 8, srcSpanEndLine = 35, srcSpanEndColumn = 17}, srcInfoPoints = []}) &quot;GHC.IO.FD&quot;"><span class="mpre">GHC.IO.FD</span></span><span class="mpre">
import GHC.IO.Buffer
import qualified GHC.IO.BufferedIO as Buffered
import GHC.IO.Exception
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 39, srcSpanStartColumn = 8, srcSpanEndLine = 39, srcSpanEndColumn = 21}, srcInfoPoints = []}) &quot;GHC.Exception&quot;"><span class="mpre">GHC.Exception</span></span><span class="mpre">
import GHC.IO.Handle.Types
import GHC.IO.Handle.Internals
import qualified GHC.IO.Device as IODevice
import qualified GHC.IO.Device as RawIO

import Foreign
import Foreign.C

import qualified Control.Exception as Exception
import Data.Typeable
import System.IO.Error
import Data.Maybe
import Control.Monad

import GHC.IORef
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 55, srcSpanStartColumn = 8, srcSpanEndLine = 55, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 56, srcSpanStartColumn = 8, srcSpanEndLine = 56, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Real&quot;"><span class="mpre">GHC.Real</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 57, srcSpanStartColumn = 8, srcSpanEndLine = 57, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;GHC.Num&quot;"><span class="mpre">GHC.Num</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 58, srcSpanStartColumn = 8, srcSpanEndLine = 58, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Show&quot;"><span class="mpre">GHC.Show</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 59, srcSpanStartColumn = 8, srcSpanEndLine = 59, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.List&quot;"><span class="mpre">GHC.List</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Simple input operations</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- If hWaitForInput finds anything in the Handle&#39;s buffer, it</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- immediately returns.  If not, it tries to read from the underlying</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- OS handle. Notice that for buffered Handles connected to terminals</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- this means waiting until a complete line is available.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Computation &#39;hWaitForInput&#39; @hdl t@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- waits until input is available on handle @hdl@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- It returns &#39;True&#39; as soon as input is available on @hdl@,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- or &#39;False&#39; if no input is available within @t@ milliseconds.  Note that</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;hWaitForInput&#39; waits until one or more full /characters/ are available,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- which means that it needs to do decoding, and hence may fail</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- with a decoding error.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If @t@ is less than zero, then @hWaitForInput@ waits indefinitely.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This operation may fail with:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isEOFError&#39; if the end of file has been reached.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * a decoding error, if the input begins with an invalid byte sequence</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    in this Handle&#39;s encoding.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- NOTE for GHC users: unless you use the @-threaded@ flag,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @hWaitForInput hdl t@ where @t &gt;= 0@ will block all other Haskell</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- threads for the duration of the call.  It behaves like a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @safe@ foreign call in this respect.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">

</span><a href="#loc_93_1_93_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_14&#39;)"><span class="mpre">hWaitForInput</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_93_1_93_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_1_93_14&#39;)"><span class="hl_fundecl"><span class="mpre">hWaitForInput</span></span></a><span class="mpre"> </span><a name="loc_93_15_93_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_15_93_16&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_93_17_93_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_17_93_22&#39;)"><span class="hl_vardecl"><span class="mpre">msecs</span></span></a><span class="mpre"> = do
  </span><a href="GHC.IO.Handle.Internals.html#loc_264_1_264_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_264_1_264_20&#39;)"><span class="hl_varref"><span class="mpre">wantReadableHandle_</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hWaitForInput&quot;</span></span><span class="mpre"> </span><a href="#loc_93_15_93_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_15_93_16&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_94_45_94_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_45_94_52&#39;)"><span class="hl_specname"><span class="mpre">handle_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 94, srcSpanStartColumn = 53, srcSpanEndLine = 94, srcSpanEndColumn = 65}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 94, srcSpanStartColumn = 61, srcSpanEndLine = 94, srcSpanEndColumn = 62},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 94,"><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; do
  </span><a name="loc_95_3_95_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_3_95_7&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre">

  if </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_95_3_95_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_3_95_7&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre">) then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> else do

  if </span><a href="#loc_93_17_93_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_17_93_22&#39;)"><span class="hl_varref"><span class="mpre">msecs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> 
        then do </span><a name="loc_100_17_100_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_17_100_22&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Handle.Internals.html#loc_825_1_825_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_825_1_825_15&#39;)"><span class="hl_varref"><span class="mpre">readTextDevice</span></span></a><span class="mpre"> </span><a href="#loc_94_45_94_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_45_94_52&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><a href="#loc_95_3_95_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_3_95_7&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre">
                </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre"> </span><a href="#loc_100_17_100_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_17_100_22&#39;)"><span class="hl_varref"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
        else do
               </span><span class="hl_comment"><span class="mpre">-- there might be bytes in the byte buffer waiting to be decoded</span></span><span class="mpre">
               </span><a name="loc_105_16_105_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_16_105_21&#39;)"><span class="hl_vardecl"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Handle.Internals.html#loc_926_1_926_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_926_1_926_14&#39;)"><span class="hl_varref"><span class="mpre">decodeByteBuf</span></span></a><span class="mpre"> </span><a href="#loc_94_45_94_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_45_94_52&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><a href="#loc_95_3_95_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_95_3_95_7&#39;)"><span class="hl_varref"><span class="mpre">cbuf</span></span></a><span class="mpre">
               </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre"> </span><a href="#loc_105_16_105_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_16_105_21&#39;)"><span class="hl_varref"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre">

               if </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_105_16_105_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_16_105_21&#39;)"><span class="hl_varref"><span class="mpre">cbuf&#39;</span></span></a><span class="mpre">) then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> else do

                </span><a name="loc_110_17_110_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_17_110_18&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Device.html#loc_67_3_67_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_67_3_67_8&#39;)"><span class="hl_varref"><span class="mpre">IODevice.ready</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="hl_comment"><span class="mpre">{-read-}</span></span><span class="mpre"> </span><a href="#loc_93_17_93_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_93_17_93_22&#39;)"><span class="hl_varref"><span class="mpre">msecs</span></span></a><span class="mpre">
                if </span><a href="#loc_110_17_110_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_17_110_18&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> then do </span><span class="hl_comment"><span class="mpre">-- Call hLookAhead&#39; to throw an EOF</span></span><span class="mpre">
                             </span><span class="hl_comment"><span class="mpre">-- exception if appropriate</span></span><span class="mpre">
                             _ &lt;- </span><a href="GHC.IO.Handle.Internals.html#loc_786_1_786_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_786_1_786_12&#39;)"><span class="hl_varref"><span class="mpre">hLookAhead_</span></span></a><span class="mpre"> </span><a href="#loc_94_45_94_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_45_94_52&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">
                             </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
                     else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- XXX we should only return when there are full characters</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- not when there are only bytes.  That would mean looping</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- and re-running IODevice.ready if we don&#39;t have any full</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- characters; but we don&#39;t know how long we&#39;ve waited</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- so far.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- hGetChar</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Computation &#39;hGetChar&#39; @hdl@ reads a character from the file or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- channel managed by @hdl@, blocking until a character is available.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This operation may fail with:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isEOFError&#39; if the end of file has been reached.</span></span><span class="mpre">

</span><a href="#loc_133_1_133_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_9&#39;)"><span class="mpre">hGetChar</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">
</span><a name="loc_133_1_133_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_1_133_9&#39;)"><span class="hl_fundecl"><span class="mpre">hGetChar</span></span></a><span class="mpre"> </span><a name="loc_133_10_133_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_10_133_16&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> =
  </span><a href="GHC.IO.Handle.Internals.html#loc_264_1_264_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_264_1_264_20&#39;)"><span class="hl_varref"><span class="mpre">wantReadableHandle_</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hGetChar&quot;</span></span><span class="mpre"> </span><a href="#loc_133_10_133_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_10_133_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_134_44_134_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_44_134_51&#39;)"><span class="hl_specname"><span class="mpre">handle_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 134, srcSpanStartColumn = 52, srcSpanEndLine = 134, srcSpanEndColumn = 64}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 134, srcSpanStartColumn = 60, srcSpanEndLine = 134, srcSpanEndColumn = 61},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; do

  </span><span class="hl_comment"><span class="mpre">-- buffering mode makes no difference: we just read whatever is available</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- from the device (blocking only if there is nothing available), and then</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- return the first character.</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- See [note Buffered Reading] in GHC.IO.Handle.Types</span></span><span class="mpre">
  </span><a name="loc_140_3_140_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_3_140_7&#39;)"><span class="hl_vardecl"><span class="mpre">buf0</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre">

  </span><a name="loc_142_3_142_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_3_142_7&#39;)"><span class="hl_vardecl"><span class="mpre">buf1</span></span></a><span class="mpre"> &lt;- if </span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_140_3_140_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_3_140_7&#39;)"><span class="hl_varref"><span class="mpre">buf0</span></span></a><span class="mpre">
             then </span><a href="GHC.IO.Handle.Internals.html#loc_825_1_825_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_825_1_825_15&#39;)"><span class="hl_varref"><span class="mpre">readTextDevice</span></span></a><span class="mpre"> </span><a href="#loc_134_44_134_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_44_134_51&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><a href="#loc_140_3_140_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_3_140_7&#39;)"><span class="hl_varref"><span class="mpre">buf0</span></span></a><span class="mpre">
             else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_140_3_140_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_3_140_7&#39;)"><span class="hl_varref"><span class="mpre">buf0</span></span></a><span class="mpre">

  (</span><a name="loc_146_4_146_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_4_146_6&#39;)"><span class="hl_vardecl"><span class="mpre">c1</span></span></a><span class="mpre">,</span><a name="loc_146_7_146_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_7_146_8&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">) &lt;- </span><a href="GHC.IO.Buffer.html#loc_119_1_119_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_119_1_119_12&#39;)"><span class="hl_varref"><span class="mpre">readCharBuf</span></span></a><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_182_9_182_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_182_9_182_15&#39;)"><span class="hl_varref"><span class="mpre">bufRaw</span></span></a><span class="mpre"> </span><a href="#loc_142_3_142_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_3_142_7&#39;)"><span class="hl_varref"><span class="mpre">buf1</span></span></a><span class="mpre">) (</span><a href="GHC.IO.Buffer.html#loc_185_9_185_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_185_9_185_13&#39;)"><span class="hl_varref"><span class="mpre">bufL</span></span></a><span class="mpre"> </span><a href="#loc_142_3_142_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_3_142_7&#39;)"><span class="hl_varref"><span class="mpre">buf1</span></span></a><span class="mpre">)
  let </span><a name="loc_147_7_147_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_7_147_11&#39;)"><span class="hl_vardecl"><span class="mpre">buf2</span></span></a><span class="mpre"> = </span><a href="GHC.IO.Buffer.html#loc_232_1_232_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_232_1_232_14&#39;)"><span class="hl_varref"><span class="mpre">bufferAdjustL</span></span></a><span class="mpre"> </span><a href="#loc_146_7_146_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_7_146_8&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><a href="#loc_142_3_142_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_3_142_7&#39;)"><span class="hl_varref"><span class="mpre">buf1</span></span></a><span class="mpre">

  if </span><a href="GHC.IO.Handle.Types.html#loc_137_7_137_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_137_7_137_16&#39;)"><span class="hl_varref"><span class="mpre">haInputNL</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_355_16_355_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_355_16_355_20&#39;)"><span class="hl_conref"><span class="mpre">CRLF</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_146_4_146_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_4_146_6&#39;)"><span class="hl_varref"><span class="mpre">c1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\r&#39;</span></span><span class="mpre">
     then do
            </span><a name="loc_151_13_151_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_13_151_18&#39;)"><span class="hl_vardecl"><span class="mpre">mbuf3</span></span></a><span class="mpre"> &lt;- if </span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_147_7_147_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_7_147_11&#39;)"><span class="hl_varref"><span class="mpre">buf2</span></span></a><span class="mpre">
                      then </span><a href="#loc_249_1_249_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_1_249_20&#39;)"><span class="hl_varref"><span class="mpre">maybeFillReadBuffer</span></span></a><span class="mpre"> </span><a href="#loc_134_44_134_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_44_134_51&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><a href="#loc_147_7_147_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_7_147_11&#39;)"><span class="hl_varref"><span class="mpre">buf2</span></span></a><span class="mpre">
                      else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_147_7_147_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_7_147_11&#39;)"><span class="hl_varref"><span class="mpre">buf2</span></span></a><span class="mpre">)

            case </span><a href="#loc_151_13_151_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_151_13_151_18&#39;)"><span class="hl_varref"><span class="mpre">mbuf3</span></span></a><span class="mpre"> of
               </span><span class="hl_comment"><span class="mpre">-- EOF, so just return the &#39;\r&#39; we have</span></span><span class="mpre">
               </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; do
                  </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre"> </span><a href="#loc_147_7_147_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_7_147_11&#39;)"><span class="hl_varref"><span class="mpre">buf2</span></span></a><span class="mpre">
                  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\r&#39;</span></span><span class="mpre">
               </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_160_21_160_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_21_160_25&#39;)"><span class="hl_vardecl"><span class="mpre">buf3</span></span></a><span class="mpre"> -&gt; do
                  (</span><a name="loc_161_20_161_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_20_161_22&#39;)"><span class="hl_vardecl"><span class="mpre">c2</span></span></a><span class="mpre">,</span><a name="loc_161_23_161_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_23_161_25&#39;)"><span class="hl_vardecl"><span class="mpre">i2</span></span></a><span class="mpre">) &lt;- </span><a href="GHC.IO.Buffer.html#loc_119_1_119_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_119_1_119_12&#39;)"><span class="hl_varref"><span class="mpre">readCharBuf</span></span></a><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_182_9_182_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_182_9_182_15&#39;)"><span class="hl_varref"><span class="mpre">bufRaw</span></span></a><span class="mpre"> </span><a href="#loc_147_7_147_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_7_147_11&#39;)"><span class="hl_varref"><span class="mpre">buf2</span></span></a><span class="mpre">) (</span><a href="GHC.IO.Buffer.html#loc_185_9_185_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_185_9_185_13&#39;)"><span class="hl_varref"><span class="mpre">bufL</span></span></a><span class="mpre"> </span><a href="#loc_147_7_147_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_7_147_11&#39;)"><span class="hl_varref"><span class="mpre">buf2</span></span></a><span class="mpre">)
                  if </span><a href="#loc_161_20_161_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_20_161_22&#39;)"><span class="hl_varref"><span class="mpre">c2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre">
                     then do
                       </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_232_1_232_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_232_1_232_14&#39;)"><span class="hl_varref"><span class="mpre">bufferAdjustL</span></span></a><span class="mpre"> </span><a href="#loc_161_23_161_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_161_23_161_25&#39;)"><span class="hl_varref"><span class="mpre">i2</span></span></a><span class="mpre"> </span><a href="#loc_160_21_160_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_21_160_25&#39;)"><span class="hl_varref"><span class="mpre">buf3</span></span></a><span class="mpre">)
                       </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre">
                     else do
                       </span><span class="hl_comment"><span class="mpre">-- not a \r\n sequence, so just return the \r</span></span><span class="mpre">
                       </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre"> </span><a href="#loc_160_21_160_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_160_21_160_25&#39;)"><span class="hl_varref"><span class="mpre">buf3</span></span></a><span class="mpre">
                       </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\r&#39;</span></span><span class="mpre">
     else do
            </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre"> </span><a href="#loc_147_7_147_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_7_147_11&#39;)"><span class="hl_varref"><span class="mpre">buf2</span></span></a><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_146_4_146_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_4_146_6&#39;)"><span class="hl_varref"><span class="mpre">c1</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- hGetLine</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Computation &#39;hGetLine&#39; @hdl@ reads a line from the file or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- channel managed by @hdl@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This operation may fail with:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isEOFError&#39; if the end of file is encountered when reading</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    the /first/ character of the line.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If &#39;hGetLine&#39; encounters end-of-file at any other point while reading</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- in a line, it is treated as a line terminator and the (partial)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- line is returned.</span></span><span class="mpre">

</span><a href="#loc_190_1_190_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_1_190_9&#39;)"><span class="mpre">hGetLine</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_190_1_190_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_1_190_9&#39;)"><span class="hl_fundecl"><span class="mpre">hGetLine</span></span></a><span class="mpre"> </span><a name="loc_190_10_190_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_10_190_11&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> =
  </span><a href="GHC.IO.Handle.Internals.html#loc_264_1_264_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_264_1_264_20&#39;)"><span class="hl_varref"><span class="mpre">wantReadableHandle_</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hGetLine&quot;</span></span><span class="mpre"> </span><a href="#loc_190_10_190_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_190_10_190_11&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_191_40_191_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_40_191_47&#39;)"><span class="hl_vardecl"><span class="mpre">handle_</span></span></a><span class="mpre"> -&gt; do
     </span><a href="#loc_195_1_195_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_1_195_17&#39;)"><span class="hl_varref"><span class="mpre">hGetLineBuffered</span></span></a><span class="mpre"> </span><a href="#loc_191_40_191_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_191_40_191_47&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">

</span><a href="#loc_195_1_195_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_1_195_17&#39;)"><span class="mpre">hGetLineBuffered</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_195_1_195_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_1_195_17&#39;)"><span class="hl_fundecl"><span class="mpre">hGetLineBuffered</span></span></a><span class="mpre"> </span><a name="loc_195_18_195_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_18_195_25&#39;)"><span class="hl_specname"><span class="mpre">handle_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 195, srcSpanStartColumn = 26, srcSpanEndLine = 195, srcSpanEndColumn = 38}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 195, srcSpanStartColumn = 34, srcSpanEndLine = 195, srcSpanEndColumn = 35},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre"> = do
  </span><a name="loc_196_3_196_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_3_196_6&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre">
  </span><a href="#loc_202_1_202_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_1_202_21&#39;)"><span class="hl_varref"><span class="mpre">hGetLineBufferedLoop</span></span></a><span class="mpre"> </span><a href="#loc_195_18_195_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_18_195_25&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><a href="#loc_196_3_196_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_3_196_6&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> []

</span><a href="#loc_202_1_202_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_1_202_21&#39;)"><span class="mpre">hGetLineBufferedLoop</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre">
                     -&gt; </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">]
                     -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_202_1_202_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_1_202_21&#39;)"><span class="hl_fundecl"><span class="mpre">hGetLineBufferedLoop</span></span></a><span class="mpre"> </span><a name="loc_202_22_202_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_22_202_29&#39;)"><span class="hl_specname"><span class="mpre">handle_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 202, srcSpanStartColumn = 30, srcSpanEndLine = 202, srcSpanEndColumn = 42}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 202, srcSpanStartColumn = 38, srcSpanEndLine = 202, srcSpanEndColumn = 39},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre">
        </span><a name="loc_203_9_203_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_9_203_12&#39;)"><span class="hl_specname"><span class="mpre">buf</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 203, srcSpanStartColumn = 13, srcSpanEndLine = 203, srcSpanEndColumn = 51}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 203, srcSpanStartColumn = 19, srcSpanEndLine = 203, srcSpanEndColumn = 20},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Buffer{ bufL=r0, bufR=w, bufRaw=raw0 }</span></span><span class="mpre"> </span><a name="loc_203_52_203_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_52_203_55&#39;)"><span class="hl_vardecl"><span class="mpre">xss</span></span></a><span class="mpre"> =
  let
        </span><span class="hl_comment"><span class="mpre">-- find the end-of-line character, if there is one</span></span><span class="mpre">
        </span><a name="loc_206_9_206_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_9_206_13&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_206_14_206_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_14_206_17&#39;)"><span class="hl_vardecl"><span class="mpre">raw</span></span></a><span class="mpre"> </span><a name="loc_206_18_206_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_18_206_19&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">
           | </span><a href="#loc_206_18_206_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_18_206_19&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">, </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre">)
           | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> =  do
                (</span><a name="loc_209_18_209_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_18_209_19&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre">,</span><a name="loc_209_20_209_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_20_209_22&#39;)"><span class="hl_vardecl"><span class="mpre">r&#39;</span></span></a><span class="mpre">) &lt;- </span><a href="GHC.IO.Buffer.html#loc_119_1_119_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_119_1_119_12&#39;)"><span class="hl_varref"><span class="mpre">readCharBuf</span></span></a><span class="mpre"> </span><a href="#loc_206_14_206_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_14_206_17&#39;)"><span class="hl_varref"><span class="mpre">raw</span></span></a><span class="mpre"> </span><a href="#loc_206_18_206_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_18_206_19&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">
                if </span><a href="#loc_209_18_209_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_18_209_19&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre">
                   then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">, </span><a href="#loc_206_18_206_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_18_206_19&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">) </span><span class="hl_comment"><span class="mpre">-- NB. not r&#39;: don&#39;t include the &#39;\n&#39;</span></span><span class="mpre">
                   else </span><a href="#loc_206_9_206_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_9_206_13&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_206_14_206_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_14_206_17&#39;)"><span class="hl_varref"><span class="mpre">raw</span></span></a><span class="mpre"> </span><a href="#loc_209_20_209_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_209_20_209_22&#39;)"><span class="hl_varref"><span class="mpre">r&#39;</span></span></a><span class="mpre">
  in do
  (</span><a name="loc_214_4_214_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_4_214_7&#39;)"><span class="hl_vardecl"><span class="mpre">eol</span></span></a><span class="mpre">, </span><a name="loc_214_9_214_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_9_214_12&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre">) &lt;- </span><a href="#loc_206_9_206_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_9_206_13&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw0</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">r0</span></span><span class="mpre">

  </span><a href="GHC.IO.Handle.Internals.html#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;hGetLineBufferedLoop: r=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">r0</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;, w=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;, off=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_214_9_214_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_9_214_12&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre">)

  (</span><a name="loc_218_4_218_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_4_218_6&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre">,</span><a name="loc_218_7_218_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_7_218_9&#39;)"><span class="hl_vardecl"><span class="mpre">r&#39;</span></span></a><span class="mpre">) &lt;- if </span><a href="GHC.IO.Handle.Types.html#loc_137_7_137_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_137_7_137_16&#39;)"><span class="hl_varref"><span class="mpre">haInputNL</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_355_16_355_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_355_16_355_20&#39;)"><span class="hl_conref"><span class="mpre">CRLF</span></span></a><span class="mpre">
                then </span><a href="#loc_294_1_294_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_1_294_10&#39;)"><span class="hl_varref"><span class="mpre">unpack_nl</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw0</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">r0</span></span><span class="mpre"> </span><a href="#loc_214_9_214_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_9_214_12&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
                else do </span><a name="loc_220_25_220_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_25_220_27&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_264_1_264_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_1_264_7&#39;)"><span class="hl_varref"><span class="mpre">unpack</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw0</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">r0</span></span><span class="mpre"> </span><a href="#loc_214_9_214_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_9_214_12&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
                        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_220_25_220_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_220_25_220_27&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">,</span><a href="#loc_214_9_214_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_9_214_12&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre">)

  </span><span class="hl_comment"><span class="mpre">-- if eol == True, then off is the offset of the &#39;\n&#39;</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- otherwise off == w and the buffer is now empty.</span></span><span class="mpre">
  if </span><a href="#loc_214_4_214_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_4_214_7&#39;)"><span class="hl_varref"><span class="mpre">eol</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- r&#39; == off</span></span><span class="mpre">
        then do </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_232_1_232_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_232_1_232_14&#39;)"><span class="hl_varref"><span class="mpre">bufferAdjustL</span></span></a><span class="mpre"> (</span><a href="#loc_214_9_214_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_214_9_214_12&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">) </span><a href="#loc_203_9_203_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_9_203_12&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">)
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">reverse</span></span><span class="mpre"> (</span><a href="#loc_218_4_218_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_4_218_6&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_203_52_203_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_52_203_55&#39;)"><span class="hl_varref"><span class="mpre">xss</span></span></a><span class="mpre">)))
        else do
             let </span><a name="loc_229_18_229_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_18_229_22&#39;)"><span class="hl_vardecl"><span class="mpre">buf1</span></span></a><span class="mpre"> = </span><a href="GHC.IO.Buffer.html#loc_232_1_232_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_232_1_232_14&#39;)"><span class="hl_varref"><span class="mpre">bufferAdjustL</span></span></a><span class="mpre"> </span><a href="#loc_218_7_218_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_7_218_9&#39;)"><span class="hl_varref"><span class="mpre">r&#39;</span></span></a><span class="mpre"> </span><a href="#loc_203_9_203_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_9_203_12&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
             </span><a name="loc_230_14_230_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_14_230_23&#39;)"><span class="hl_vardecl"><span class="mpre">maybe_buf</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_249_1_249_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_1_249_20&#39;)"><span class="hl_varref"><span class="mpre">maybeFillReadBuffer</span></span></a><span class="mpre"> </span><a href="#loc_202_22_202_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_22_202_29&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><a href="#loc_229_18_229_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_18_229_22&#39;)"><span class="hl_varref"><span class="mpre">buf1</span></span></a><span class="mpre">
             case </span><a href="#loc_230_14_230_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_230_14_230_23&#39;)"><span class="hl_varref"><span class="mpre">maybe_buf</span></span></a><span class="mpre"> of
                </span><span class="hl_comment"><span class="mpre">-- Nothing indicates we caught an EOF, and we may have a</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- partial line to return.</span></span><span class="mpre">
                </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; do
                     </span><span class="hl_comment"><span class="mpre">-- we reached EOF.  There might be a lone \r left</span></span><span class="mpre">
                     </span><span class="hl_comment"><span class="mpre">-- in the buffer, so check for that and</span></span><span class="mpre">
                     </span><span class="hl_comment"><span class="mpre">-- append it to the line if necessary.</span></span><span class="mpre">
                     </span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
                     let </span><a name="loc_239_26_239_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_26_239_29&#39;)"><span class="hl_vardecl"><span class="mpre">pre</span></span></a><span class="mpre"> = if </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_229_18_229_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_229_18_229_22&#39;)"><span class="hl_varref"><span class="mpre">buf1</span></span></a><span class="mpre">) then </span><span class="hl_string"><span class="mpre">&quot;\r&quot;</span></span><span class="mpre"> else </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
                     </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 240, srcSpanStartColumn = 46, srcSpanEndLine = 240, srcSpanEndColumn = 68}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 240, srcSpanStartColumn = 50, srcSpanEndLine = 240, srcSpanEndColumn = 51},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartL"><span class="mpre">buf1{ bufL=0, bufR=0 }</span></span><span class="mpre">
                     let </span><a name="loc_241_26_241_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_26_241_29&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">reverse</span></span><span class="mpre"> (</span><a href="#loc_239_26_239_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_239_26_239_29&#39;)"><span class="hl_varref"><span class="mpre">pre</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_218_4_218_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_4_218_6&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_203_52_203_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_52_203_55&#39;)"><span class="hl_varref"><span class="mpre">xss</span></span></a><span class="mpre">))
                     if </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_241_26_241_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_26_241_29&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">)
                        then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_241_26_241_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_241_26_241_29&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
                        else </span><a href="GHC.IO.Handle.Internals.html#loc_327_1_327_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_327_1_327_8&#39;)"><span class="hl_varref"><span class="mpre">ioe_EOF</span></span></a><span class="mpre">
                </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_245_22_245_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_22_245_29&#39;)"><span class="hl_vardecl"><span class="mpre">new_buf</span></span></a><span class="mpre"> -&gt;
                     </span><a href="#loc_202_1_202_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_1_202_21&#39;)"><span class="hl_varref"><span class="mpre">hGetLineBufferedLoop</span></span></a><span class="mpre"> </span><a href="#loc_202_22_202_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_202_22_202_29&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><a href="#loc_245_22_245_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_245_22_245_29&#39;)"><span class="hl_varref"><span class="mpre">new_buf</span></span></a><span class="mpre"> (</span><a href="#loc_218_4_218_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_218_4_218_6&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_203_52_203_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_52_203_55&#39;)"><span class="hl_varref"><span class="mpre">xss</span></span></a><span class="mpre">)

</span><a href="#loc_249_1_249_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_1_249_20&#39;)"><span class="mpre">maybeFillReadBuffer</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre">)
</span><a name="loc_249_1_249_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_1_249_20&#39;)"><span class="hl_fundecl"><span class="mpre">maybeFillReadBuffer</span></span></a><span class="mpre"> </span><a name="loc_249_21_249_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_21_249_28&#39;)"><span class="hl_vardecl"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><a name="loc_249_29_249_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_29_249_32&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre">
  = </span><a href="Control.Exception.Base.html#loc_150_1_150_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_150_1_150_6&#39;)"><span class="hl_varref"><span class="mpre">Exception.catch</span></span></a><span class="mpre">
     (do </span><a name="loc_251_10_251_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_251_10_251_14&#39;)"><span class="hl_vardecl"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_429_1_429_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_429_1_429_18&#39;)"><span class="hl_varref"><span class="mpre">getSomeCharacters</span></span></a><span class="mpre"> </span><a href="#loc_249_21_249_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_21_249_28&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><a href="#loc_249_29_249_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_29_249_32&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
         </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_251_10_251_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_251_10_251_14&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">)
     )
     (\</span><a name="loc_254_8_254_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_8_254_9&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; do if </span><a href="System.IO.Error.html#loc_152_1_152_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Error.html#loc_152_1_152_11&#39;)"><span class="hl_varref"><span class="mpre">isEOFError</span></span></a><span class="mpre"> </span><a href="#loc_254_8_254_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_8_254_9&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
                  then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">
                  else </span><a href="GHC.IO.Exception.html#loc_221_1_221_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_221_1_221_8&#39;)"><span class="hl_varref"><span class="mpre">ioError</span></span></a><span class="mpre"> </span><a href="#loc_254_8_254_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_254_8_254_9&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- See GHC.IO.Buffer</span></span><span class="mpre">
#define CHARBUF_UTF32
</span><span class="hl_comment"><span class="mpre">-- #define CHARBUF_UTF16</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- NB. performance-critical code: eyeball the Core.</span></span><span class="mpre">
</span><a href="#loc_264_1_264_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_1_264_7&#39;)"><span class="mpre">unpack</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">RawCharBuffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">]
</span><a name="loc_264_1_264_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_1_264_7&#39;)"><span class="hl_fundecl"><span class="mpre">unpack</span></span></a><span class="mpre"> !</span><a name="loc_264_9_264_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_9_264_12&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> !</span><a name="loc_264_14_264_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_14_264_15&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> !</span><a name="loc_264_17_264_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_17_264_18&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> </span><a name="loc_264_19_264_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_19_264_23&#39;)"><span class="hl_vardecl"><span class="mpre">acc0</span></span></a><span class="mpre">
 | </span><a href="#loc_264_14_264_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_14_264_15&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_264_17_264_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_17_264_18&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">    = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_264_19_264_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_19_264_23&#39;)"><span class="hl_varref"><span class="mpre">acc0</span></span></a><span class="mpre">
 | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = 
  </span><a href="GHC.IO.Buffer.html#loc_201_1_201_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_201_1_201_14&#39;)"><span class="hl_varref"><span class="mpre">withRawBuffer</span></span></a><span class="mpre"> </span><a href="#loc_264_9_264_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_9_264_12&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_267_24_267_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_24_267_28&#39;)"><span class="hl_vardecl"><span class="mpre">pbuf</span></span></a><span class="mpre"> -&gt; 
    let
        </span><a name="loc_269_9_269_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_9_269_17&#39;)"><span class="hl_fundecl"><span class="mpre">unpackRB</span></span></a><span class="mpre"> </span><a name="loc_269_18_269_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_18_269_21&#39;)"><span class="hl_vardecl"><span class="mpre">acc</span></span></a><span class="mpre"> !</span><a name="loc_269_23_269_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_23_269_24&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">
         | </span><a href="#loc_269_23_269_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_23_269_24&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_264_14_264_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_14_264_15&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_269_18_269_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_18_269_21&#39;)"><span class="hl_varref"><span class="mpre">acc</span></span></a><span class="mpre">
         | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do
              </span><span class="hl_comment"><span class="mpre">-- Here, we are rather careful to only put an *evaluated* character</span></span><span class="mpre">
              </span><span class="hl_comment"><span class="mpre">-- in the output string. Due to pointer tagging, this allows the consumer</span></span><span class="mpre">
              </span><span class="hl_comment"><span class="mpre">-- to avoid ping-ponging between the actual consumer code and the thunk code</span></span><span class="mpre">
#ifdef CHARBUF_UTF16
              </span><span class="hl_comment"><span class="mpre">-- reverse-order decoding of UTF-16</span></span><span class="mpre">
              </span><a name="loc_277_15_277_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_15_277_17&#39;)"><span class="hl_vardecl"><span class="mpre">c2</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekElemOff</span></span><span class="mpre"> </span><a href="#loc_267_24_267_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_24_267_28&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> </span><a href="#loc_269_23_269_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_23_269_24&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
              if (</span><a href="#loc_277_15_277_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_15_277_17&#39;)"><span class="hl_varref"><span class="mpre">c2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xdc00</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">||</span></span><span class="mpre"> </span><a href="#loc_277_15_277_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_15_277_17&#39;)"><span class="hl_varref"><span class="mpre">c2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xdffff</span></span><span class="mpre">)
                 then </span><a href="#loc_269_9_269_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_9_269_17&#39;)"><span class="hl_varref"><span class="mpre">unpackRB</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">unsafeChr</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_277_15_277_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_15_277_17&#39;)"><span class="hl_varref"><span class="mpre">c2</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_269_18_269_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_18_269_21&#39;)"><span class="hl_varref"><span class="mpre">acc</span></span></a><span class="mpre">) (</span><a href="#loc_269_23_269_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_23_269_24&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
                 else do </span><a name="loc_280_26_280_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_26_280_28&#39;)"><span class="hl_vardecl"><span class="mpre">c1</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekElemOff</span></span><span class="mpre"> </span><a href="#loc_267_24_267_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_24_267_28&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> (</span><a href="#loc_269_23_269_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_23_269_24&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
                         let </span><a name="loc_281_30_281_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_30_281_31&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_280_26_280_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_280_26_280_28&#39;)"><span class="hl_varref"><span class="mpre">c1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xd800</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x400</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre">
                                 (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_277_15_277_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_15_277_17&#39;)"><span class="hl_varref"><span class="mpre">c2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0xdc00</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0x10000</span></span><span class="mpre">
                         case </span><span class="hl_varref"><span class="mpre">desurrogatifyRoundtripCharacter</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">unsafeChr</span></span><span class="mpre"> </span><a href="#loc_281_30_281_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_281_30_281_31&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">) of
                           { </span><span class="hl_conref"><span class="mpre">C#</span></span><span class="mpre"> </span><a name="loc_284_33_284_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_284_33_284_35&#39;)"><span class="hl_vardecl"><span class="mpre">c#</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_269_9_269_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_9_269_17&#39;)"><span class="hl_varref"><span class="mpre">unpackRB</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">C#</span></span><span class="mpre"> </span><a href="#loc_284_33_284_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_284_33_284_35&#39;)"><span class="hl_varref"><span class="mpre">c#</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_269_18_269_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_18_269_21&#39;)"><span class="hl_varref"><span class="mpre">acc</span></span></a><span class="mpre">) (</span><a href="#loc_269_23_269_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_23_269_24&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">) }
#else
              </span><a name="loc_286_15_286_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_15_286_16&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekElemOff</span></span><span class="mpre"> </span><a href="#loc_267_24_267_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_24_267_28&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> </span><a href="#loc_269_23_269_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_23_269_24&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
              </span><a href="#loc_269_9_269_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_9_269_17&#39;)"><span class="hl_varref"><span class="mpre">unpackRB</span></span></a><span class="mpre"> (</span><a href="#loc_286_15_286_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_286_15_286_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_269_18_269_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_18_269_21&#39;)"><span class="hl_varref"><span class="mpre">acc</span></span></a><span class="mpre">) (</span><a href="#loc_269_23_269_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_23_269_24&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
#endif
     in
     </span><a href="#loc_269_9_269_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_269_9_269_17&#39;)"><span class="hl_varref"><span class="mpre">unpackRB</span></span></a><span class="mpre"> </span><a href="#loc_264_19_264_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_19_264_23&#39;)"><span class="hl_varref"><span class="mpre">acc0</span></span></a><span class="mpre"> (</span><a href="#loc_264_17_264_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_17_264_18&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- NB. performance-critical code: eyeball the Core.</span></span><span class="mpre">
</span><a href="#loc_294_1_294_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_1_294_10&#39;)"><span class="mpre">unpack_nl</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">RawCharBuffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> ([</span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">],</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)
</span><a name="loc_294_1_294_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_1_294_10&#39;)"><span class="hl_fundecl"><span class="mpre">unpack_nl</span></span></a><span class="mpre"> !</span><a name="loc_294_12_294_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_12_294_15&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> !</span><a name="loc_294_17_294_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_17_294_18&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> !</span><a name="loc_294_20_294_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_20_294_21&#39;)"><span class="hl_vardecl"><span class="mpre">w</span></span></a><span class="mpre"> </span><a name="loc_294_22_294_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_22_294_26&#39;)"><span class="hl_vardecl"><span class="mpre">acc0</span></span></a><span class="mpre">
 | </span><a href="#loc_294_17_294_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_17_294_18&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_294_20_294_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_20_294_21&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">    =  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_294_22_294_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_22_294_26&#39;)"><span class="hl_varref"><span class="mpre">acc0</span></span></a><span class="mpre">, </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">)
 | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> =
  </span><a href="GHC.IO.Buffer.html#loc_201_1_201_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_201_1_201_14&#39;)"><span class="hl_varref"><span class="mpre">withRawBuffer</span></span></a><span class="mpre"> </span><a href="#loc_294_12_294_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_12_294_15&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_297_24_297_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_24_297_28&#39;)"><span class="hl_vardecl"><span class="mpre">pbuf</span></span></a><span class="mpre"> -&gt;
    let
        </span><a name="loc_299_9_299_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_9_299_17&#39;)"><span class="hl_fundecl"><span class="mpre">unpackRB</span></span></a><span class="mpre"> </span><a name="loc_299_18_299_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_18_299_21&#39;)"><span class="hl_vardecl"><span class="mpre">acc</span></span></a><span class="mpre"> !</span><a name="loc_299_23_299_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_23_299_24&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre">
         | </span><a href="#loc_299_23_299_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_23_299_24&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_294_17_294_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_17_294_18&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_299_18_299_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_18_299_21&#39;)"><span class="hl_varref"><span class="mpre">acc</span></span></a><span class="mpre">
         | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do
              </span><a name="loc_302_15_302_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_15_302_16&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekElemOff</span></span><span class="mpre"> </span><a href="#loc_297_24_297_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_24_297_28&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> </span><a href="#loc_299_23_299_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_23_299_24&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">
              if (</span><a href="#loc_302_15_302_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_15_302_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&amp;&amp;</span></span><span class="mpre"> </span><a href="#loc_299_23_299_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_23_299_24&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><a href="#loc_294_17_294_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_17_294_18&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">)
                 then do
                         </span><a name="loc_305_26_305_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_305_26_305_28&#39;)"><span class="hl_vardecl"><span class="mpre">c1</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekElemOff</span></span><span class="mpre"> </span><a href="#loc_297_24_297_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_24_297_28&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> (</span><a href="#loc_299_23_299_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_23_299_24&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
                         if (</span><a href="#loc_305_26_305_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_305_26_305_28&#39;)"><span class="hl_varref"><span class="mpre">c1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\r&#39;</span></span><span class="mpre">)
                            then </span><a href="#loc_299_9_299_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_9_299_17&#39;)"><span class="hl_varref"><span class="mpre">unpackRB</span></span></a><span class="mpre"> (</span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_299_18_299_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_18_299_21&#39;)"><span class="hl_varref"><span class="mpre">acc</span></span></a><span class="mpre">) (</span><a href="#loc_299_23_299_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_23_299_24&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">)
                            else </span><a href="#loc_299_9_299_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_9_299_17&#39;)"><span class="hl_varref"><span class="mpre">unpackRB</span></span></a><span class="mpre"> (</span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_299_18_299_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_18_299_21&#39;)"><span class="hl_varref"><span class="mpre">acc</span></span></a><span class="mpre">) (</span><a href="#loc_299_23_299_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_23_299_24&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
                 else do
                         </span><a href="#loc_299_9_299_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_9_299_17&#39;)"><span class="hl_varref"><span class="mpre">unpackRB</span></span></a><span class="mpre"> (</span><a href="#loc_302_15_302_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_302_15_302_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_299_18_299_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_18_299_21&#39;)"><span class="hl_varref"><span class="mpre">acc</span></span></a><span class="mpre">) (</span><a href="#loc_299_23_299_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_23_299_24&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
     in do
     </span><a name="loc_312_6_312_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_6_312_7&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">peekElemOff</span></span><span class="mpre"> </span><a href="#loc_297_24_297_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_297_24_297_28&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> (</span><a href="#loc_294_20_294_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_20_294_21&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
     if (</span><a href="#loc_312_6_312_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_312_6_312_7&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\r&#39;</span></span><span class="mpre">)
        then do 
                </span><span class="hl_comment"><span class="mpre">-- If the last char is a &#39;\r&#39;, we need to know whether or</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- not it is followed by a &#39;\n&#39;, so leave it in the buffer</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- for now and just unpack the rest.</span></span><span class="mpre">
                </span><a name="loc_318_17_318_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_17_318_20&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_299_9_299_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_9_299_17&#39;)"><span class="hl_varref"><span class="mpre">unpackRB</span></span></a><span class="mpre"> </span><a href="#loc_294_22_294_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_22_294_26&#39;)"><span class="hl_varref"><span class="mpre">acc0</span></span></a><span class="mpre"> (</span><a href="#loc_294_20_294_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_20_294_21&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre">)
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_318_17_318_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_318_17_318_20&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">, </span><a href="#loc_294_20_294_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_20_294_21&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
        else do
                </span><a name="loc_321_17_321_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_17_321_20&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_299_9_299_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_299_9_299_17&#39;)"><span class="hl_varref"><span class="mpre">unpackRB</span></span></a><span class="mpre"> </span><a href="#loc_294_22_294_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_22_294_26&#39;)"><span class="hl_varref"><span class="mpre">acc0</span></span></a><span class="mpre"> (</span><a href="#loc_294_20_294_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_20_294_21&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">)
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_321_17_321_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_321_17_321_20&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">, </span><a href="#loc_294_20_294_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_20_294_21&#39;)"><span class="hl_varref"><span class="mpre">w</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- Note [#5536]</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- We originally had</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    let c&#39; = desurrogatifyRoundtripCharacter c in</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    c&#39; `seq` unpackRB (c&#39;:acc) (i-1)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- but this resulted in Core like</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    case (case x &lt;# y of True -&gt; C# e1; False -&gt; C# e2) of c</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      C# _ -&gt; unpackRB (c:acc) (i-1)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- which compiles into a continuation for the outer case, with each</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- branch of the inner case building a C# and then jumping to the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- continuation.  We&#39;d rather not have this extra jump, which makes</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- quite a difference to performance (see #5536) It turns out that</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- matching on the C# directly causes GHC to do the case-of-case,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- giving much straighter code.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- hGetContents</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- hGetContents on a DuplexHandle only affects the read side: you can</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- carry on writing to it afterwards.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Computation &#39;hGetContents&#39; @hdl@ returns the list of characters</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- corresponding to the unread portion of the channel or file managed</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- by @hdl@, which is put into an intermediate state, /semi-closed/.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- In this state, @hdl@ is effectively closed,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- but items are read from @hdl@ on demand and accumulated in a special</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- list returned by &#39;hGetContents&#39; @hdl@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Any operation that fails because a handle is closed,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- also fails if a handle is semi-closed.  The only exception is &#39;hClose&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A semi-closed handle becomes closed:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * if &#39;hClose&#39; is applied to it;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * if an I\/O error occurs when reading an item from the handle;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * or once the entire contents of the handle has been read.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Once a semi-closed handle becomes closed, the contents of the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- associated list becomes fixed.  The contents of this final list is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- only partially specified: it will contain at least all the items of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the stream that were evaluated prior to the handle becoming closed.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Any I\/O errors encountered while a handle is semi-closed are simply</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- discarded.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This operation may fail with:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isEOFError&#39; if the end of file has been reached.</span></span><span class="mpre">

</span><a href="#loc_379_1_379_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_379_1_379_13&#39;)"><span class="mpre">hGetContents</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_379_1_379_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_379_1_379_13&#39;)"><span class="hl_fundecl"><span class="mpre">hGetContents</span></span></a><span class="mpre"> </span><a name="loc_379_14_379_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_379_14_379_20&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> = 
   </span><a href="GHC.IO.Handle.Internals.html#loc_261_1_261_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_261_1_261_19&#39;)"><span class="hl_varref"><span class="mpre">wantReadableHandle</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hGetContents&quot;</span></span><span class="mpre"> </span><a href="#loc_379_14_379_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_379_14_379_20&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><span class="hl_vardecl"><span class="mpre">handle_</span></span><span class="mpre"> -&gt; do
      </span><a name="loc_381_7_381_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_381_7_381_9&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_389_1_389_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_1_389_9&#39;)"><span class="hl_varref"><span class="mpre">lazyRead</span></span></a><span class="mpre"> </span><a href="#loc_379_14_379_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_379_14_379_20&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 382, srcSpanStartColumn = 15, srcSpanEndLine = 382, srcSpanEndColumn = 48}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 382, srcSpanStartColumn = 22, srcSpanEndLine = 382, srcSpanEndColumn = 23},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartL"><span class="mpre">handle_{ haType=SemiClosedHandle}</span></span><span class="mpre">, </span><a href="#loc_381_7_381_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_381_7_381_9&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre"> )

</span><span class="hl_comment"><span class="mpre">-- Note that someone may close the semi-closed handle (or change its</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- buffering), so each time these lazy read functions are pulled on,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- they have to check whether the handle has indeed been closed.</span></span><span class="mpre">

</span><a href="#loc_389_1_389_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_1_389_9&#39;)"><span class="mpre">lazyRead</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
</span><a name="loc_389_1_389_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_1_389_9&#39;)"><span class="hl_fundecl"><span class="mpre">lazyRead</span></span></a><span class="mpre"> </span><a name="loc_389_10_389_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_10_389_16&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> = 
   </span><a href="GHC.IO.html#loc_213_1_213_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.html#loc_213_1_213_19&#39;)"><span class="hl_varref"><span class="mpre">unsafeInterleaveIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
        </span><a href="GHC.IO.Handle.Internals.html#loc_125_1_125_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_125_1_125_11&#39;)"><span class="hl_varref"><span class="mpre">withHandle</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hGetContents&quot;</span></span><span class="mpre"> </span><a href="#loc_389_10_389_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_10_389_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_391_46_391_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_46_391_53&#39;)"><span class="hl_vardecl"><span class="mpre">handle_</span></span></a><span class="mpre"> -&gt; do
        case </span><a href="GHC.IO.Handle.Types.html#loc_128_7_128_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_128_7_128_13&#39;)"><span class="hl_varref"><span class="mpre">haType</span></span></a><span class="mpre"> </span><a href="#loc_391_46_391_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_46_391_53&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> of
          </span><a href="GHC.IO.Handle.Types.html#loc_155_4_155_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_155_4_155_16&#39;)"><span class="hl_conref"><span class="mpre">ClosedHandle</span></span></a><span class="mpre">     -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_391_46_391_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_46_391_53&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">, </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">)
          </span><a href="GHC.IO.Handle.Types.html#loc_156_4_156_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_156_4_156_20&#39;)"><span class="hl_conref"><span class="mpre">SemiClosedHandle</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_400_1_400_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_1_400_17&#39;)"><span class="hl_varref"><span class="mpre">lazyReadBuffered</span></span></a><span class="mpre"> </span><a href="#loc_389_10_389_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_10_389_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_391_46_391_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_391_46_391_53&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">
          _ -&gt; </span><a href="GHC.IO.Exception.html#loc_217_1_217_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_217_1_217_12&#39;)"><span class="hl_varref"><span class="mpre">ioException</span></span></a><span class="mpre"> 
                  (</span><span class="hl_conref"><span class="mpre">IOError</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_389_10_389_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_10_389_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">) </span><a href="GHC.IO.Exception.html#loc_264_5_264_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_264_5_264_21&#39;)"><span class="hl_conref"><span class="mpre">IllegalOperation</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hGetContents&quot;</span></span><span class="mpre">
                        </span><span class="hl_string"><span class="mpre">&quot;illegal handle type&quot;</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">)

</span><a href="#loc_400_1_400_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_1_400_17&#39;)"><span class="mpre">lazyReadBuffered</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre">, [</span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">])
</span><a name="loc_400_1_400_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_1_400_17&#39;)"><span class="hl_fundecl"><span class="mpre">lazyReadBuffered</span></span></a><span class="mpre"> </span><a name="loc_400_18_400_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_18_400_19&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_400_20_400_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_20_400_27&#39;)"><span class="hl_specname"><span class="mpre">handle_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 400, srcSpanStartColumn = 28, srcSpanEndLine = 400, srcSpanEndColumn = 40}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 400, srcSpanStartColumn = 36, srcSpanEndLine = 400, srcSpanEndColumn = 37},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre"> = do
   </span><a name="loc_401_4_401_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_401_4_401_7&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre">
   </span><a href="Control.Exception.Base.html#loc_150_1_150_6" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Exception.Base.html#loc_150_1_150_6&#39;)"><span class="hl_varref"><span class="mpre">Exception.catch</span></span></a><span class="mpre">
        (do
            </span><a name="loc_404_13_404_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_404_13_404_17&#39;)"><span class="hl_specname"><span class="mpre">buf&#39;</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 404, srcSpanStartColumn = 18, srcSpanEndLine = 404, srcSpanEndColumn = 28}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 404, srcSpanStartColumn = 24, srcSpanEndLine = 404, srcSpanEndColumn = 25},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Buffer{..}</span></span><span class="mpre"> &lt;- </span><a href="#loc_429_1_429_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_429_1_429_18&#39;)"><span class="hl_varref"><span class="mpre">getSomeCharacters</span></span></a><span class="mpre"> </span><a href="#loc_400_20_400_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_20_400_27&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><a href="#loc_401_4_401_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_401_4_401_7&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
            </span><a name="loc_405_13_405_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_13_405_22&#39;)"><span class="hl_vardecl"><span class="mpre">lazy_rest</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_389_1_389_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_1_389_9&#39;)"><span class="hl_varref"><span class="mpre">lazyRead</span></span></a><span class="mpre"> </span><a href="#loc_400_18_400_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_18_400_19&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">
            (</span><a name="loc_406_14_406_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_406_14_406_15&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre">,</span><a name="loc_406_16_406_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_406_16_406_17&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">) &lt;- if </span><a href="GHC.IO.Handle.Types.html#loc_137_7_137_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_137_7_137_16&#39;)"><span class="hl_varref"><span class="mpre">haInputNL</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_355_16_355_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_355_16_355_20&#39;)"><span class="hl_conref"><span class="mpre">CRLF</span></span></a><span class="mpre">
                         then </span><a href="#loc_294_1_294_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_294_1_294_10&#39;)"><span class="hl_varref"><span class="mpre">unpack_nl</span></span></a><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_182_9_182_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_182_9_182_15&#39;)"><span class="hl_varref"><span class="mpre">bufRaw</span></span></a><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_185_9_185_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_185_9_185_13&#39;)"><span class="hl_varref"><span class="mpre">bufL</span></span></a><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_186_9_186_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_186_9_186_13&#39;)"><span class="hl_varref"><span class="mpre">bufR</span></span></a><span class="mpre"> </span><a href="#loc_405_13_405_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_13_405_22&#39;)"><span class="hl_varref"><span class="mpre">lazy_rest</span></span></a><span class="mpre">
                         else do </span><a name="loc_408_34_408_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_408_34_408_35&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_264_1_264_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_264_1_264_7&#39;)"><span class="hl_varref"><span class="mpre">unpack</span></span></a><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_182_9_182_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_182_9_182_15&#39;)"><span class="hl_varref"><span class="mpre">bufRaw</span></span></a><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_185_9_185_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_185_9_185_13&#39;)"><span class="hl_varref"><span class="mpre">bufL</span></span></a><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_186_9_186_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_186_9_186_13&#39;)"><span class="hl_varref"><span class="mpre">bufR</span></span></a><span class="mpre"> </span><a href="#loc_405_13_405_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_405_13_405_22&#39;)"><span class="hl_varref"><span class="mpre">lazy_rest</span></span></a><span class="mpre">
                                 </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_408_34_408_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_408_34_408_35&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">,</span><a href="GHC.IO.Buffer.html#loc_186_9_186_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_186_9_186_13&#39;)"><span class="hl_varref"><span class="mpre">bufR</span></span></a><span class="mpre">)
            </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_232_1_232_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_232_1_232_14&#39;)"><span class="hl_varref"><span class="mpre">bufferAdjustL</span></span></a><span class="mpre"> </span><a href="#loc_406_16_406_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_406_16_406_17&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><a href="#loc_404_13_404_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_404_13_404_17&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">)
            </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_400_20_400_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_20_400_27&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">, </span><a href="#loc_406_14_406_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_406_14_406_15&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">)
        )
        (\</span><a name="loc_413_11_413_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_413_11_413_12&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> -&gt; do (</span><a name="loc_413_20_413_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_413_20_413_28&#39;)"><span class="hl_vardecl"><span class="mpre">handle_&#39;</span></span></a><span class="mpre">, _) &lt;- </span><a href="GHC.IO.Handle.Internals.html#loc_732_1_732_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_732_1_732_12&#39;)"><span class="hl_varref"><span class="mpre">hClose_help</span></span></a><span class="mpre"> </span><a href="#loc_400_20_400_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_20_400_27&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">
                  </span><a href="GHC.IO.Handle.Internals.html#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;hGetContents caught: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_413_11_413_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_413_11_413_12&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">)
                  </span><span class="hl_comment"><span class="mpre">-- We might have a \r cached in CRLF mode.  So we</span></span><span class="mpre">
                  </span><span class="hl_comment"><span class="mpre">-- need to check for that and return it:</span></span><span class="mpre">
                  let </span><a name="loc_417_23_417_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_23_417_24&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = if </span><a href="System.IO.Error.html#loc_152_1_152_11" onmouseover="nemnem.highlightLocalToRemote(&#39;System.IO.Error.html#loc_152_1_152_11&#39;)"><span class="hl_varref"><span class="mpre">isEOFError</span></span></a><span class="mpre"> </span><a href="#loc_413_11_413_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_413_11_413_12&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">
                             then if </span><span class="hl_varref"><span class="mpre">not</span></span><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_401_4_401_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_401_4_401_7&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">)
                                     then </span><span class="hl_string"><span class="mpre">&quot;\r&quot;</span></span><span class="mpre">
                                     else </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
                             else
                                  </span><span class="hl_varref"><span class="mpre">throw</span></span><span class="mpre"> (</span><a href="GHC.IO.Handle.Internals.html#loc_213_1_213_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_213_1_213_15&#39;)"><span class="hl_varref"><span class="mpre">augmentIOError</span></span></a><span class="mpre"> </span><a href="#loc_413_11_413_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_413_11_413_12&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hGetContents&quot;</span></span><span class="mpre"> </span><a href="#loc_400_18_400_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_400_18_400_19&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre">)

                  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_413_20_413_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_413_20_413_28&#39;)"><span class="hl_varref"><span class="mpre">handle_&#39;</span></span></a><span class="mpre">, </span><a href="#loc_417_23_417_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_417_23_417_24&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">)
        )

</span><span class="hl_comment"><span class="mpre">-- ensure we have some characters in the buffer</span></span><span class="mpre">
</span><a href="#loc_429_1_429_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_429_1_429_18&#39;)"><span class="mpre">getSomeCharacters</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre">
</span><a name="loc_429_1_429_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_429_1_429_18&#39;)"><span class="hl_fundecl"><span class="mpre">getSomeCharacters</span></span></a><span class="mpre"> </span><a name="loc_429_19_429_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_429_19_429_26&#39;)"><span class="hl_specname"><span class="mpre">handle_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 429, srcSpanStartColumn = 27, srcSpanEndLine = 429, srcSpanEndColumn = 39}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 429, srcSpanStartColumn = 35, srcSpanEndLine = 429, srcSpanEndColumn = 36},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre"> </span><a name="loc_429_40_429_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_429_40_429_43&#39;)"><span class="hl_specname"><span class="mpre">buf</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 429, srcSpanStartColumn = 44, srcSpanEndLine = 429, srcSpanEndColumn = 54}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 429, srcSpanStartColumn = 50, srcSpanEndLine = 429, srcSpanEndColumn = 51},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Buffer{..}</span></span><span class="mpre"> =
  case </span><a href="GHC.IO.Buffer.html#loc_223_1_223_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_223_1_223_12&#39;)"><span class="hl_varref"><span class="mpre">bufferElems</span></span></a><span class="mpre"> </span><a href="#loc_429_40_429_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_429_40_429_43&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> of

    </span><span class="hl_comment"><span class="mpre">-- buffer empty: read some more</span></span><span class="mpre">
    </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Internals.html#loc_825_1_825_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_825_1_825_15&#39;)"><span class="hl_varref"><span class="mpre">readTextDevice</span></span></a><span class="mpre"> </span><a href="#loc_429_19_429_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_429_19_429_26&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><a href="#loc_429_40_429_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_429_40_429_43&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">

    </span><span class="hl_comment"><span class="mpre">-- if the buffer has a single &#39;\r&#39; in it and we&#39;re doing newline</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- translation: read some more</span></span><span class="mpre">
    </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> | </span><a href="GHC.IO.Handle.Types.html#loc_137_7_137_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_137_7_137_16&#39;)"><span class="hl_varref"><span class="mpre">haInputNL</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_355_16_355_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_355_16_355_20&#39;)"><span class="hl_conref"><span class="mpre">CRLF</span></span></a><span class="mpre"> -&gt; do
      (</span><a name="loc_438_8_438_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_438_8_438_9&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre">,_) &lt;- </span><a href="GHC.IO.Buffer.html#loc_119_1_119_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_119_1_119_12&#39;)"><span class="hl_varref"><span class="mpre">readCharBuf</span></span></a><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_182_9_182_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_182_9_182_15&#39;)"><span class="hl_varref"><span class="mpre">bufRaw</span></span></a><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_185_9_185_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_185_9_185_13&#39;)"><span class="hl_varref"><span class="mpre">bufL</span></span></a><span class="mpre">
      if </span><a href="#loc_438_8_438_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_438_8_438_9&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\r&#39;</span></span><span class="mpre">
         then do </span><span class="hl_comment"><span class="mpre">-- shuffle the &#39;\r&#39; to the beginning.  This is only safe</span></span><span class="mpre">
                 </span><span class="hl_comment"><span class="mpre">-- if we&#39;re about to call readTextDevice, otherwise it</span></span><span class="mpre">
                 </span><span class="hl_comment"><span class="mpre">-- would mess up flushCharBuffer.</span></span><span class="mpre">
                 </span><span class="hl_comment"><span class="mpre">-- See [note Buffer Flushing], GHC.IO.Handle.Types</span></span><span class="mpre">
                 _ &lt;- </span><a href="GHC.IO.Buffer.html#loc_123_1_123_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_123_1_123_13&#39;)"><span class="hl_varref"><span class="mpre">writeCharBuf</span></span></a><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_182_9_182_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_182_9_182_15&#39;)"><span class="hl_varref"><span class="mpre">bufRaw</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\r&#39;</span></span><span class="mpre">
                 let </span><a name="loc_445_22_445_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_445_22_445_26&#39;)"><span class="hl_vardecl"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 445, srcSpanStartColumn = 29, srcSpanEndLine = 445, srcSpanEndColumn = 50}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 445, srcSpanStartColumn = 32, srcSpanEndLine = 445, srcSpanEndColumn = 33},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartL"><span class="mpre">buf{ bufL=0, bufR=1 }</span></span><span class="mpre">
                 </span><a href="GHC.IO.Handle.Internals.html#loc_825_1_825_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_825_1_825_15&#39;)"><span class="hl_varref"><span class="mpre">readTextDevice</span></span></a><span class="mpre"> </span><a href="#loc_429_19_429_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_429_19_429_26&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><a href="#loc_445_22_445_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_445_22_445_26&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">
         else do
                 </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_429_40_429_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_429_40_429_43&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">

    </span><span class="hl_comment"><span class="mpre">-- buffer has some chars in it already: just return it</span></span><span class="mpre">
    </span><span class="hl_vardecl"><span class="mpre">_otherwise</span></span><span class="mpre"> -&gt;
      </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_429_40_429_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_429_40_429_43&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- hPutChar</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Computation &#39;hPutChar&#39; @hdl ch@ writes the character @ch@ to the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- file or channel managed by @hdl@.  Characters may be buffered if</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- buffering is enabled for @hdl@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This operation may fail with:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isFullError&#39; if the device is full; or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isPermissionError&#39; if another system resource limit would be exceeded.</span></span><span class="mpre">

</span><a href="#loc_468_1_468_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_468_1_468_9&#39;)"><span class="mpre">hPutChar</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_468_1_468_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_468_1_468_9&#39;)"><span class="hl_fundecl"><span class="mpre">hPutChar</span></span></a><span class="mpre"> </span><a name="loc_468_10_468_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_468_10_468_16&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_468_17_468_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_468_17_468_18&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = do
    </span><a href="#loc_468_17_468_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_468_17_468_18&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`seq`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
    </span><a href="GHC.IO.Handle.Internals.html#loc_225_1_225_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_225_1_225_19&#39;)"><span class="hl_varref"><span class="mpre">wantWritableHandle</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hPutChar&quot;</span></span><span class="mpre"> </span><a href="#loc_468_10_468_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_468_10_468_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_470_46_470_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_46_470_53&#39;)"><span class="hl_vardecl"><span class="mpre">handle_</span></span></a><span class="mpre">  -&gt; do
     </span><a href="#loc_474_1_474_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_474_1_474_14&#39;)"><span class="hl_varref"><span class="mpre">hPutcBuffered</span></span></a><span class="mpre"> </span><a href="#loc_470_46_470_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_470_46_470_53&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><a href="#loc_468_17_468_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_468_17_468_18&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">

</span><a href="#loc_474_1_474_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_474_1_474_14&#39;)"><span class="mpre">hPutcBuffered</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_474_1_474_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_474_1_474_14&#39;)"><span class="hl_fundecl"><span class="mpre">hPutcBuffered</span></span></a><span class="mpre"> </span><a name="loc_474_15_474_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_474_15_474_22&#39;)"><span class="hl_specname"><span class="mpre">handle_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 474, srcSpanStartColumn = 23, srcSpanEndLine = 474, srcSpanEndColumn = 35}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 474, srcSpanStartColumn = 31, srcSpanEndLine = 474, srcSpanEndColumn = 32},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre"> </span><a name="loc_474_36_474_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_474_36_474_37&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = do
  </span><a name="loc_475_3_475_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_3_475_6&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre">
  if </span><a href="#loc_474_36_474_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_474_36_474_37&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre">
     then do </span><a name="loc_477_14_477_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_477_14_477_18&#39;)"><span class="hl_vardecl"><span class="mpre">buf1</span></span></a><span class="mpre"> &lt;- if </span><a href="GHC.IO.Handle.Types.html#loc_138_7_138_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_138_7_138_17&#39;)"><span class="hl_varref"><span class="mpre">haOutputNL</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_355_16_355_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_355_16_355_20&#39;)"><span class="hl_conref"><span class="mpre">CRLF</span></span></a><span class="mpre">
                        then do
                          </span><a name="loc_479_27_479_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_479_27_479_31&#39;)"><span class="hl_vardecl"><span class="mpre">buf1</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_494_5_494_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_5_494_9&#39;)"><span class="hl_varref"><span class="mpre">putc</span></span></a><span class="mpre"> </span><a href="#loc_475_3_475_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_3_475_6&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\r&#39;</span></span><span class="mpre">
                          </span><a href="#loc_494_5_494_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_5_494_9&#39;)"><span class="hl_varref"><span class="mpre">putc</span></span></a><span class="mpre"> </span><a href="#loc_479_27_479_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_479_27_479_31&#39;)"><span class="hl_varref"><span class="mpre">buf1</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre">
                        else do
                          </span><a href="#loc_494_5_494_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_5_494_9&#39;)"><span class="hl_varref"><span class="mpre">putc</span></span></a><span class="mpre"> </span><a href="#loc_475_3_475_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_3_475_6&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre">
             </span><a href="GHC.IO.Handle.Internals.html#loc_505_1_505_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_505_1_505_16&#39;)"><span class="hl_varref"><span class="mpre">writeCharBuffer</span></span></a><span class="mpre"> </span><a href="#loc_474_15_474_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_474_15_474_22&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><a href="#loc_477_14_477_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_477_14_477_18&#39;)"><span class="hl_varref"><span class="mpre">buf1</span></span></a><span class="mpre">
             </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_490_5_490_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_490_5_490_12&#39;)"><span class="hl_varref"><span class="mpre">is_line</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Internals.html#loc_495_1_495_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_495_1_495_21&#39;)"><span class="hl_varref"><span class="mpre">flushByteWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_474_15_474_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_474_15_474_22&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre">
      else do
          </span><a name="loc_486_11_486_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_486_11_486_15&#39;)"><span class="hl_vardecl"><span class="mpre">buf1</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_494_5_494_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_5_494_9&#39;)"><span class="hl_varref"><span class="mpre">putc</span></span></a><span class="mpre"> </span><a href="#loc_475_3_475_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_3_475_6&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a href="#loc_474_36_474_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_474_36_474_37&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">
          </span><a href="GHC.IO.Handle.Internals.html#loc_505_1_505_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_505_1_505_16&#39;)"><span class="hl_varref"><span class="mpre">writeCharBuffer</span></span></a><span class="mpre"> </span><a href="#loc_474_15_474_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_474_15_474_22&#39;)"><span class="hl_varref"><span class="mpre">handle_</span></span></a><span class="mpre"> </span><a href="#loc_486_11_486_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_486_11_486_15&#39;)"><span class="hl_varref"><span class="mpre">buf1</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
  where
    </span><a name="loc_490_5_490_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_490_5_490_12&#39;)"><span class="hl_vardecl"><span class="mpre">is_line</span></span></a><span class="mpre"> = case </span><a href="GHC.IO.Handle.Types.html#loc_130_7_130_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_130_7_130_19&#39;)"><span class="hl_varref"><span class="mpre">haBufferMode</span></span></a><span class="mpre"> of
                </span><a href="GHC.IO.Handle.Types.html#loc_248_4_248_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_248_4_248_17&#39;)"><span class="hl_conref"><span class="mpre">LineBuffering</span></span></a><span class="mpre"> -&gt; </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
                _             -&gt; </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

    </span><a name="loc_494_5_494_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_5_494_9&#39;)"><span class="hl_fundecl"><span class="mpre">putc</span></span></a><span class="mpre"> </span><a name="loc_494_10_494_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_10_494_13&#39;)"><span class="hl_specname"><span class="mpre">buf</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 494, srcSpanStartColumn = 14, srcSpanEndLine = 494, srcSpanEndColumn = 42}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 494, srcSpanStartColumn = 20, srcSpanEndLine = 494, srcSpanEndColumn = 21},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Buffer{ bufRaw=raw, bufR=w }</span></span><span class="mpre"> </span><a name="loc_494_43_494_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_43_494_44&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = do
       </span><a href="GHC.IO.Handle.Internals.html#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;putc: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="GHC.IO.Buffer.html#loc_267_1_267_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_267_1_267_14&#39;)"><span class="hl_varref"><span class="mpre">summaryBuffer</span></span></a><span class="mpre"> </span><a href="#loc_494_10_494_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_10_494_13&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">)
       </span><span class="hl_vardecl"><span class="mpre">w&#39;</span></span><span class="mpre">  &lt;- </span><a href="GHC.IO.Buffer.html#loc_123_1_123_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_123_1_123_13&#39;)"><span class="hl_varref"><span class="mpre">writeCharBuf</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre"> </span><a href="#loc_494_43_494_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_43_494_44&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">
       </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 497, srcSpanStartColumn = 15, srcSpanEndLine = 497, srcSpanEndColumn = 31}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 497, srcSpanStartColumn = 18, srcSpanEndLine = 497, srcSpanEndColumn = 19},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartL"><span class="mpre">buf{ bufR = w&#39; }</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- hPutStr</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- We go to some trouble to avoid keeping the handle locked while we&#39;re</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- evaluating the string argument to hPutStr, in case doing so triggers another</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- I/O operation on the same handle which would lead to deadlock.  The classic</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- case is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--              putStr (trace &quot;hello&quot; &quot;world&quot;)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- so the basic scheme is this:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      * copy the string into a fresh buffer,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--      * &quot;commit&quot; the buffer to the handle.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Committing may involve simply copying the contents of the new</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- buffer into the handle&#39;s buffer, flushing one or both buffers, or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- maybe just swapping the buffers over (if the handle&#39;s buffer was</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- empty).  See commitBuffer below.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Computation &#39;hPutStr&#39; @hdl s@ writes the string</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @s@ to the file or channel managed by @hdl@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This operation may fail with:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isFullError&#39; if the device is full; or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;isPermissionError&#39; if another system resource limit would be exceeded.</span></span><span class="mpre">

</span><a href="#loc_529_1_529_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_529_1_529_8&#39;)"><span class="mpre">hPutStr</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_529_1_529_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_529_1_529_8&#39;)"><span class="hl_fundecl"><span class="mpre">hPutStr</span></span></a><span class="mpre"> </span><a name="loc_529_9_529_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_529_9_529_15&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_529_16_529_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_529_16_529_19&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> = </span><a href="#loc_539_1_539_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_1_539_9&#39;)"><span class="hl_varref"><span class="mpre">hPutStr&#39;</span></span></a><span class="mpre"> </span><a href="#loc_529_9_529_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_529_9_529_15&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_529_16_529_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_529_16_529_19&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | The same as &#39;hPutStr&#39;, but adds a newline character.</span></span><span class="mpre">
</span><a href="#loc_533_1_533_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_533_1_533_10&#39;)"><span class="mpre">hPutStrLn</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_533_1_533_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_533_1_533_10&#39;)"><span class="hl_fundecl"><span class="mpre">hPutStrLn</span></span></a><span class="mpre"> </span><a name="loc_533_11_533_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_533_11_533_17&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_533_18_533_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_533_18_533_21&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> = </span><a href="#loc_539_1_539_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_1_539_9&#39;)"><span class="hl_varref"><span class="mpre">hPutStr&#39;</span></span></a><span class="mpre"> </span><a href="#loc_533_11_533_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_533_11_533_17&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_533_18_533_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_533_18_533_21&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- An optimisation: we treat hPutStrLn specially, to avoid the</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- overhead of a single putChar &#39;\n&#39;, which is quite high now that we</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- have to encode eagerly.</span></span><span class="mpre">

</span><a href="#loc_539_1_539_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_1_539_9&#39;)"><span class="mpre">hPutStr&#39;</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_539_1_539_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_1_539_9&#39;)"><span class="hl_fundecl"><span class="mpre">hPutStr&#39;</span></span></a><span class="mpre"> </span><a name="loc_539_10_539_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_10_539_16&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_539_17_539_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_17_539_20&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> </span><a name="loc_539_21_539_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_21_539_27&#39;)"><span class="hl_vardecl"><span class="mpre">add_nl</span></span></a><span class="mpre"> =
  do
    (</span><a name="loc_541_6_541_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_541_6_541_17&#39;)"><span class="hl_vardecl"><span class="mpre">buffer_mode</span></span></a><span class="mpre">, </span><a name="loc_541_19_541_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_541_19_541_21&#39;)"><span class="hl_vardecl"><span class="mpre">nl</span></span></a><span class="mpre">) &lt;-
         </span><a href="GHC.IO.Handle.Internals.html#loc_225_1_225_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_225_1_225_19&#39;)"><span class="hl_varref"><span class="mpre">wantWritableHandle</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hPutStr&quot;</span></span><span class="mpre"> </span><a href="#loc_539_10_539_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_10_539_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_542_49_542_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_542_49_542_51&#39;)"><span class="hl_vardecl"><span class="mpre">h_</span></span></a><span class="mpre"> -&gt; do
                       </span><a name="loc_543_24_543_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_24_543_29&#39;)"><span class="hl_vardecl"><span class="mpre">bmode</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_560_1_560_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_560_1_560_15&#39;)"><span class="hl_varref"><span class="mpre">getSpareBuffer</span></span></a><span class="mpre"> </span><a href="#loc_542_49_542_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_542_49_542_51&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
                       </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_543_24_543_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_543_24_543_29&#39;)"><span class="hl_varref"><span class="mpre">bmode</span></span></a><span class="mpre">, </span><a href="GHC.IO.Handle.Types.html#loc_138_7_138_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_138_7_138_17&#39;)"><span class="hl_varref"><span class="mpre">haOutputNL</span></span></a><span class="mpre"> </span><a href="#loc_542_49_542_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_542_49_542_51&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">)

    case </span><a href="#loc_541_6_541_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_541_6_541_17&#39;)"><span class="hl_varref"><span class="mpre">buffer_mode</span></span></a><span class="mpre"> of
       (</span><a href="GHC.IO.Handle.Types.html#loc_247_4_247_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_247_4_247_15&#39;)"><span class="hl_conref"><span class="mpre">NoBuffering</span></span></a><span class="mpre">, _) -&gt; do
            </span><a href="#loc_556_1_556_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_556_1_556_10&#39;)"><span class="hl_varref"><span class="mpre">hPutChars</span></span></a><span class="mpre"> </span><a href="#loc_539_10_539_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_10_539_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_539_17_539_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_17_539_20&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">        </span><span class="hl_comment"><span class="mpre">-- v. slow, but we don&#39;t care</span></span><span class="mpre">
            </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_539_21_539_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_21_539_27&#39;)"><span class="hl_varref"><span class="mpre">add_nl</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_468_1_468_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_468_1_468_9&#39;)"><span class="hl_varref"><span class="mpre">hPutChar</span></span></a><span class="mpre"> </span><a href="#loc_539_10_539_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_10_539_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre">
       (</span><a href="GHC.IO.Handle.Types.html#loc_248_4_248_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_248_4_248_17&#39;)"><span class="hl_conref"><span class="mpre">LineBuffering</span></span></a><span class="mpre">, </span><a name="loc_550_24_550_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_24_550_27&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre">) -&gt; do
            </span><a href="#loc_580_1_580_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_580_1_580_12&#39;)"><span class="hl_varref"><span class="mpre">writeBlocks</span></span></a><span class="mpre"> </span><a href="#loc_539_10_539_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_10_539_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">  </span><a href="#loc_539_21_539_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_21_539_27&#39;)"><span class="hl_varref"><span class="mpre">add_nl</span></span></a><span class="mpre"> </span><a href="#loc_541_19_541_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_541_19_541_21&#39;)"><span class="hl_varref"><span class="mpre">nl</span></span></a><span class="mpre"> </span><a href="#loc_550_24_550_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_24_550_27&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a href="#loc_539_17_539_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_17_539_20&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
       (</span><a href="GHC.IO.Handle.Types.html#loc_250_4_250_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_250_4_250_18&#39;)"><span class="hl_conref"><span class="mpre">BlockBuffering</span></span></a><span class="mpre"> _, </span><a name="loc_552_27_552_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_552_27_552_30&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre">) -&gt; do
            </span><a href="#loc_580_1_580_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_580_1_580_12&#39;)"><span class="hl_varref"><span class="mpre">writeBlocks</span></span></a><span class="mpre"> </span><a href="#loc_539_10_539_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_10_539_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> </span><a href="#loc_539_21_539_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_21_539_27&#39;)"><span class="hl_varref"><span class="mpre">add_nl</span></span></a><span class="mpre"> </span><a href="#loc_541_19_541_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_541_19_541_21&#39;)"><span class="hl_varref"><span class="mpre">nl</span></span></a><span class="mpre"> </span><a href="#loc_552_27_552_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_552_27_552_30&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> </span><a href="#loc_539_17_539_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_539_17_539_20&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">

</span><a href="#loc_556_1_556_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_556_1_556_10&#39;)"><span class="mpre">hPutChars</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_556_1_556_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_556_1_556_10&#39;)"><span class="hl_fundecl"><span class="mpre">hPutChars</span></span></a><span class="mpre"> _      [] = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
</span><a href="#loc_556_1_556_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_556_1_556_10&#39;)"><span class="hl_fundecl"><span class="mpre">hPutChars</span></span></a><span class="mpre"> </span><a name="loc_557_11_557_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_557_11_557_17&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> (</span><a name="loc_557_19_557_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_557_19_557_20&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_557_21_557_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_557_21_557_23&#39;)"><span class="hl_vardecl"><span class="mpre">cs</span></span></a><span class="mpre">) = </span><a href="#loc_468_1_468_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_468_1_468_9&#39;)"><span class="hl_varref"><span class="mpre">hPutChar</span></span></a><span class="mpre"> </span><a href="#loc_557_11_557_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_557_11_557_17&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_557_19_557_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_557_19_557_20&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> </span><a href="#loc_556_1_556_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_556_1_556_10&#39;)"><span class="hl_varref"><span class="mpre">hPutChars</span></span></a><span class="mpre"> </span><a href="#loc_557_11_557_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_557_11_557_17&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a href="#loc_557_21_557_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_557_21_557_23&#39;)"><span class="hl_varref"><span class="mpre">cs</span></span></a><span class="mpre">

</span><a href="#loc_560_1_560_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_560_1_560_15&#39;)"><span class="mpre">getSpareBuffer</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="GHC.IO.Handle.Types.html#loc_246_6_246_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_246_6_246_16&#39;)"><span class="hl_tyconref"><span class="mpre">BufferMode</span></span></a><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre">)
</span><a name="loc_560_1_560_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_560_1_560_15&#39;)"><span class="hl_fundecl"><span class="mpre">getSpareBuffer</span></span></a><span class="mpre"> </span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 560, srcSpanStartColumn = 16, srcSpanEndLine = 562, srcSpanEndColumn = 43}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 560, srcSpanStartColumn = 24, srcSpanEndLine = 560, srcSpanEndColumn = 25},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{haCharBuffer=ref, 
                        haBuffers=spare_ref,
                        haBufferMode=mode}</span></span><span class="mpre">
 = do
   case </span><span class="hl_varref"><span class="mpre">mode</span></span><span class="mpre"> of
     </span><a href="GHC.IO.Handle.Types.html#loc_247_4_247_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_247_4_247_15&#39;)"><span class="hl_conref"><span class="mpre">NoBuffering</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">mode</span></span><span class="mpre">, </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;no buffer!&quot;</span></span><span class="mpre">)
     _ -&gt; do
          </span><a name="loc_567_11_567_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_567_11_567_15&#39;)"><span class="hl_vardecl"><span class="mpre">bufs</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">spare_ref</span></span><span class="mpre">
          </span><a name="loc_568_11_568_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_568_11_568_14&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre">  &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">ref</span></span><span class="mpre">
          case </span><a href="#loc_567_11_567_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_567_11_567_15&#39;)"><span class="hl_varref"><span class="mpre">bufs</span></span></a><span class="mpre"> of
            </span><a href="GHC.IO.Handle.Types.html#loc_149_5_149_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_149_5_149_19&#39;)"><span class="hl_conref"><span class="mpre">BufferListCons</span></span></a><span class="mpre"> </span><a name="loc_570_28_570_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_570_28_570_29&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> </span><a name="loc_570_30_570_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_570_30_570_34&#39;)"><span class="hl_vardecl"><span class="mpre">rest</span></span></a><span class="mpre"> -&gt; do
                </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">spare_ref</span></span><span class="mpre"> </span><a href="#loc_570_30_570_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_570_30_570_34&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> ( </span><span class="hl_varref"><span class="mpre">mode</span></span><span class="mpre">, </span><a href="GHC.IO.Buffer.html#loc_240_1_240_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_240_1_240_12&#39;)"><span class="hl_varref"><span class="mpre">emptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_570_28_570_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_570_28_570_29&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_184_9_184_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_184_9_184_16&#39;)"><span class="hl_varref"><span class="mpre">bufSize</span></span></a><span class="mpre"> </span><a href="#loc_568_11_568_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_568_11_568_14&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">) </span><a href="GHC.IO.Buffer.html#loc_195_33_195_44" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_195_33_195_44&#39;)"><span class="hl_conref"><span class="mpre">WriteBuffer</span></span></a><span class="mpre">)
            </span><a href="GHC.IO.Handle.Types.html#loc_148_5_148_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_148_5_148_18&#39;)"><span class="hl_conref"><span class="mpre">BufferListNil</span></span></a><span class="mpre"> -&gt; do
                </span><a name="loc_574_17_574_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_574_17_574_24&#39;)"><span class="hl_vardecl"><span class="mpre">new_buf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Buffer.html#loc_247_1_247_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_247_1_247_14&#39;)"><span class="hl_varref"><span class="mpre">newCharBuffer</span></span></a><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_184_9_184_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_184_9_184_16&#39;)"><span class="hl_varref"><span class="mpre">bufSize</span></span></a><span class="mpre"> </span><a href="#loc_568_11_568_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_568_11_568_14&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">) </span><a href="GHC.IO.Buffer.html#loc_195_33_195_44" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_195_33_195_44&#39;)"><span class="hl_conref"><span class="mpre">WriteBuffer</span></span></a><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">mode</span></span><span class="mpre">, </span><a href="#loc_574_17_574_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_574_17_574_24&#39;)"><span class="hl_varref"><span class="mpre">new_buf</span></span></a><span class="mpre">)


</span><span class="hl_comment"><span class="mpre">-- NB. performance-critical code: eyeball the Core.</span></span><span class="mpre">
</span><a href="#loc_580_1_580_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_580_1_580_12&#39;)"><span class="mpre">writeBlocks</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_354_6_354_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_354_6_354_13&#39;)"><span class="hl_tyconref"><span class="mpre">Newline</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CharBufElem</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_580_1_580_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_580_1_580_12&#39;)"><span class="hl_fundecl"><span class="mpre">writeBlocks</span></span></a><span class="mpre"> </span><a name="loc_580_13_580_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_580_13_580_16&#39;)"><span class="hl_vardecl"><span class="mpre">hdl</span></span></a><span class="mpre"> </span><a name="loc_580_17_580_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_580_17_580_30&#39;)"><span class="hl_vardecl"><span class="mpre">line_buffered</span></span></a><span class="mpre"> </span><a name="loc_580_31_580_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_580_31_580_37&#39;)"><span class="hl_vardecl"><span class="mpre">add_nl</span></span></a><span class="mpre"> </span><a name="loc_580_38_580_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_580_38_580_40&#39;)"><span class="hl_vardecl"><span class="mpre">nl</span></span></a><span class="mpre">
            </span><span class="hl_specname"><span class="mpre">buf</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 581, srcSpanStartColumn = 17, srcSpanEndLine = 581, srcSpanEndColumn = 50}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 581, srcSpanStartColumn = 23, srcSpanEndLine = 581, srcSpanEndColumn = 24},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Buffer{ bufRaw=raw, bufSize=len }</span></span><span class="mpre"> </span><a name="loc_581_51_581_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_581_51_581_52&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> =
  let
   </span><a href="#loc_584_4_584_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_584_4_584_15&#39;)"><span class="mpre">shoveString</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">] -&gt; [</span><span class="hl_tyconref"><span class="mpre">Char</span></span><span class="mpre">] -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
   </span><a name="loc_584_4_584_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_584_4_584_15&#39;)"><span class="hl_fundecl"><span class="mpre">shoveString</span></span></a><span class="mpre"> !</span><a name="loc_584_17_584_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_584_17_584_18&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> [] [] = do
        </span><a href="#loc_627_1_627_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_1_627_13&#39;)"><span class="hl_varref"><span class="mpre">commitBuffer</span></span></a><span class="mpre"> </span><a href="#loc_580_13_580_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_580_13_580_16&#39;)"><span class="hl_varref"><span class="mpre">hdl</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">len</span></span><span class="mpre"> </span><a href="#loc_584_17_584_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_584_17_584_18&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="hl_comment"><span class="mpre">{-no flush-}</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="hl_comment"><span class="mpre">{-release-}</span></span><span class="mpre">
   </span><a href="#loc_584_4_584_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_584_4_584_15&#39;)"><span class="hl_fundecl"><span class="mpre">shoveString</span></span></a><span class="mpre"> !</span><a name="loc_586_17_586_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_586_17_586_18&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> [] </span><a name="loc_586_22_586_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_586_22_586_26&#39;)"><span class="hl_vardecl"><span class="mpre">rest</span></span></a><span class="mpre"> = do
        </span><a href="#loc_584_4_584_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_584_4_584_15&#39;)"><span class="hl_varref"><span class="mpre">shoveString</span></span></a><span class="mpre"> </span><a href="#loc_586_17_586_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_586_17_586_18&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_586_22_586_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_586_22_586_26&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre"> []
   </span><a href="#loc_584_4_584_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_584_4_584_15&#39;)"><span class="hl_fundecl"><span class="mpre">shoveString</span></span></a><span class="mpre"> !</span><a name="loc_588_17_588_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_17_588_18&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre"> (</span><a name="loc_588_20_588_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_20_588_21&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_588_22_588_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_22_588_24&#39;)"><span class="hl_vardecl"><span class="mpre">cs</span></span></a><span class="mpre">) </span><a name="loc_588_26_588_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_26_588_30&#39;)"><span class="hl_vardecl"><span class="mpre">rest</span></span></a><span class="mpre">
     </span><span class="hl_comment"><span class="mpre">-- n+1 so we have enough room to write &#39;\r\n&#39; if necessary</span></span><span class="mpre">
     | </span><a href="#loc_588_17_588_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_17_588_18&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;=</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">len</span></span><span class="mpre"> = do
        </span><a href="#loc_627_1_627_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_1_627_13&#39;)"><span class="hl_varref"><span class="mpre">commitBuffer</span></span></a><span class="mpre"> </span><a href="#loc_580_13_580_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_580_13_580_16&#39;)"><span class="hl_varref"><span class="mpre">hdl</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">len</span></span><span class="mpre"> </span><a href="#loc_588_17_588_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_17_588_18&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="hl_comment"><span class="mpre">{-flush-}</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
        </span><a href="#loc_584_4_584_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_584_4_584_15&#39;)"><span class="hl_varref"><span class="mpre">shoveString</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> (</span><a href="#loc_588_20_588_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_20_588_21&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_588_22_588_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_22_588_24&#39;)"><span class="hl_varref"><span class="mpre">cs</span></span></a><span class="mpre">) </span><a href="#loc_588_26_588_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_26_588_30&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre">
     | </span><a href="#loc_588_20_588_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_20_588_21&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre">  =  do
        </span><a name="loc_594_9_594_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_594_9_594_11&#39;)"><span class="hl_vardecl"><span class="mpre">n&#39;</span></span></a><span class="mpre"> &lt;- if </span><a href="#loc_580_38_580_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_580_38_580_40&#39;)"><span class="hl_varref"><span class="mpre">nl</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_355_16_355_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_355_16_355_20&#39;)"><span class="hl_conref"><span class="mpre">CRLF</span></span></a><span class="mpre">
                 then do 
                    </span><a name="loc_596_21_596_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_596_21_596_23&#39;)"><span class="hl_vardecl"><span class="mpre">n1</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Buffer.html#loc_123_1_123_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_123_1_123_13&#39;)"><span class="hl_varref"><span class="mpre">writeCharBuf</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw</span></span><span class="mpre"> </span><a href="#loc_588_17_588_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_17_588_18&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">  </span><span class="hl_char"><span class="mpre">&#39;\r&#39;</span></span><span class="mpre">
                    </span><a href="GHC.IO.Buffer.html#loc_123_1_123_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_123_1_123_13&#39;)"><span class="hl_varref"><span class="mpre">writeCharBuf</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw</span></span><span class="mpre"> </span><a href="#loc_596_21_596_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_596_21_596_23&#39;)"><span class="hl_varref"><span class="mpre">n1</span></span></a><span class="mpre"> </span><span class="hl_char"><span class="mpre">&#39;\n&#39;</span></span><span class="mpre">
                 else do
                    </span><a href="GHC.IO.Buffer.html#loc_123_1_123_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_123_1_123_13&#39;)"><span class="hl_varref"><span class="mpre">writeCharBuf</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw</span></span><span class="mpre"> </span><a href="#loc_588_17_588_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_17_588_18&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_588_20_588_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_20_588_21&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">
        if </span><a href="#loc_580_17_580_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_580_17_580_30&#39;)"><span class="hl_varref"><span class="mpre">line_buffered</span></span></a><span class="mpre">
           then do
                </span><span class="hl_comment"><span class="mpre">-- end of line, so write and flush</span></span><span class="mpre">
               </span><a href="#loc_627_1_627_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_1_627_13&#39;)"><span class="hl_varref"><span class="mpre">commitBuffer</span></span></a><span class="mpre"> </span><a href="#loc_580_13_580_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_580_13_580_16&#39;)"><span class="hl_varref"><span class="mpre">hdl</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">len</span></span><span class="mpre"> </span><a href="#loc_594_9_594_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_594_9_594_11&#39;)"><span class="hl_varref"><span class="mpre">n&#39;</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="hl_comment"><span class="mpre">{-flush-}</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
               </span><a href="#loc_584_4_584_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_584_4_584_15&#39;)"><span class="hl_varref"><span class="mpre">shoveString</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_588_22_588_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_22_588_24&#39;)"><span class="hl_varref"><span class="mpre">cs</span></span></a><span class="mpre"> </span><a href="#loc_588_26_588_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_26_588_30&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre">
           else do
               </span><a href="#loc_584_4_584_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_584_4_584_15&#39;)"><span class="hl_varref"><span class="mpre">shoveString</span></span></a><span class="mpre"> </span><a href="#loc_594_9_594_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_594_9_594_11&#39;)"><span class="hl_varref"><span class="mpre">n&#39;</span></span></a><span class="mpre"> </span><a href="#loc_588_22_588_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_22_588_24&#39;)"><span class="hl_varref"><span class="mpre">cs</span></span></a><span class="mpre"> </span><a href="#loc_588_26_588_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_26_588_30&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre">
     | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do
        </span><a name="loc_608_9_608_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_608_9_608_11&#39;)"><span class="hl_vardecl"><span class="mpre">n&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Buffer.html#loc_123_1_123_13" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_123_1_123_13&#39;)"><span class="hl_varref"><span class="mpre">writeCharBuf</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw</span></span><span class="mpre"> </span><a href="#loc_588_17_588_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_17_588_18&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_588_20_588_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_20_588_21&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">
        </span><a href="#loc_584_4_584_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_584_4_584_15&#39;)"><span class="hl_varref"><span class="mpre">shoveString</span></span></a><span class="mpre"> </span><a href="#loc_608_9_608_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_608_9_608_11&#39;)"><span class="hl_varref"><span class="mpre">n&#39;</span></span></a><span class="mpre"> </span><a href="#loc_588_22_588_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_22_588_24&#39;)"><span class="hl_varref"><span class="mpre">cs</span></span></a><span class="mpre"> </span><a href="#loc_588_26_588_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_588_26_588_30&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre">
  in
  </span><a href="#loc_584_4_584_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_584_4_584_15&#39;)"><span class="hl_varref"><span class="mpre">shoveString</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_581_51_581_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_581_51_581_52&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> (if </span><a href="#loc_580_31_580_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_580_31_580_37&#39;)"><span class="hl_varref"><span class="mpre">add_nl</span></span></a><span class="mpre"> then </span><span class="hl_string"><span class="mpre">&quot;\n&quot;</span></span><span class="mpre"> else </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- -----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- commitBuffer handle buf sz count flush release</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Write the contents of the buffer &#39;buf&#39; (&#39;sz&#39; bytes long, containing</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;count&#39; bytes of data) to handle (handle must be block or line buffered).</span></span><span class="mpre">

</span><a href="#loc_627_1_627_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_1_627_13&#39;)"><span class="mpre">commitBuffer</span></a><span class="mpre">
        :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre">                       </span><span class="hl_comment"><span class="mpre">-- handle to commit to</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">RawCharBuffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">         </span><span class="hl_comment"><span class="mpre">-- address and size (in bytes) of buffer</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">                          </span><span class="hl_comment"><span class="mpre">-- number of bytes of data in buffer</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">                         </span><span class="hl_comment"><span class="mpre">-- True &lt;=&gt; flush the handle afterward</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">                         </span><span class="hl_comment"><span class="mpre">-- release the buffer?</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">

</span><a name="loc_627_1_627_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_1_627_13&#39;)"><span class="hl_fundecl"><span class="mpre">commitBuffer</span></span></a><span class="mpre"> </span><a name="loc_627_14_627_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_14_627_17&#39;)"><span class="hl_vardecl"><span class="mpre">hdl</span></span></a><span class="mpre"> !</span><a name="loc_627_19_627_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_19_627_22&#39;)"><span class="hl_vardecl"><span class="mpre">raw</span></span></a><span class="mpre"> !</span><a name="loc_627_24_627_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_24_627_26&#39;)"><span class="hl_vardecl"><span class="mpre">sz</span></span></a><span class="mpre"> !</span><a name="loc_627_28_627_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_28_627_33&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> </span><a name="loc_627_34_627_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_34_627_39&#39;)"><span class="hl_vardecl"><span class="mpre">flush</span></span></a><span class="mpre"> </span><a name="loc_627_40_627_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_40_627_47&#39;)"><span class="hl_vardecl"><span class="mpre">release</span></span></a><span class="mpre"> = 
  </span><a href="GHC.IO.Handle.Internals.html#loc_225_1_225_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_225_1_225_19&#39;)"><span class="hl_varref"><span class="mpre">wantWritableHandle</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;commitBuffer&quot;</span></span><span class="mpre"> </span><a href="#loc_627_14_627_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_14_627_17&#39;)"><span class="hl_varref"><span class="mpre">hdl</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_628_44_628_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_628_44_628_46&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 628, srcSpanStartColumn = 47, srcSpanEndLine = 628, srcSpanEndColumn = 59}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 628, srcSpanStartColumn = 55, srcSpanEndLine = 628, srcSpanEndColumn = 56},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; do
      </span><a href="GHC.IO.Handle.Internals.html#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;commitBuffer: sz=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_627_24_627_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_24_627_26&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;, count=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_627_28_627_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_28_627_33&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
            </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;, flush=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_627_34_627_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_34_627_39&#39;)"><span class="hl_varref"><span class="mpre">flush</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;, release=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_627_40_627_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_40_627_47&#39;)"><span class="hl_varref"><span class="mpre">release</span></span></a><span class="mpre">)

      </span><a href="GHC.IO.Handle.Internals.html#loc_505_1_505_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_505_1_505_16&#39;)"><span class="hl_varref"><span class="mpre">writeCharBuffer</span></span></a><span class="mpre"> </span><a href="#loc_628_44_628_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_628_44_628_46&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 632, srcSpanStartColumn = 26, srcSpanEndLine = 633, srcSpanEndColumn = 66}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 632, srcSpanStartColumn = 32, srcSpanEndLine = 632, srcSpanEndColumn = 33},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartL"><span class="mpre">Buffer{ bufRaw=raw, bufState=WriteBuffer,
                                 bufL=0, bufR=count, bufSize=sz }</span></span><span class="mpre">

      </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_627_34_627_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_34_627_39&#39;)"><span class="hl_varref"><span class="mpre">flush</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Internals.html#loc_495_1_495_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_495_1_495_21&#39;)"><span class="hl_varref"><span class="mpre">flushByteWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_628_44_628_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_628_44_628_46&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">

      </span><span class="hl_comment"><span class="mpre">-- release the buffer if necessary</span></span><span class="mpre">
      </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_627_40_627_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_40_627_47&#39;)"><span class="hl_varref"><span class="mpre">release</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
          </span><span class="hl_comment"><span class="mpre">-- find size of current buffer</span></span><span class="mpre">
          </span><span class="hl_specname"><span class="mpre">old_buf</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 640, srcSpanStartColumn = 19, srcSpanEndLine = 640, srcSpanEndColumn = 41}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 640, srcSpanStartColumn = 25, srcSpanEndLine = 640, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Buffer{ bufSize=size }</span></span><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre">
          </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_627_24_627_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_24_627_26&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">size</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
               </span><a name="loc_642_16_642_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_642_16_642_26&#39;)"><span class="hl_vardecl"><span class="mpre">spare_bufs</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_133_7_133_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_133_7_133_16&#39;)"><span class="hl_varref"><span class="mpre">haBuffers</span></span></a><span class="mpre">
               </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_133_7_133_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_133_7_133_16&#39;)"><span class="hl_varref"><span class="mpre">haBuffers</span></span></a><span class="mpre"> (</span><a href="GHC.IO.Handle.Types.html#loc_149_5_149_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_149_5_149_19&#39;)"><span class="hl_conref"><span class="mpre">BufferListCons</span></span></a><span class="mpre"> </span><a href="#loc_627_19_627_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_627_19_627_22&#39;)"><span class="hl_varref"><span class="mpre">raw</span></span></a><span class="mpre"> </span><a href="#loc_642_16_642_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_642_16_642_26&#39;)"><span class="hl_varref"><span class="mpre">spare_bufs</span></span></a><span class="mpre">)

      </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- backwards compatibility; the text package uses this</span></span><span class="mpre">
</span><a href="#loc_650_1_650_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_1_650_14&#39;)"><span class="mpre">commitBuffer&#39;</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">RawCharBuffer</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre">
              -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">CharBuffer</span></span><span class="mpre">
</span><a name="loc_650_1_650_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_1_650_14&#39;)"><span class="hl_fundecl"><span class="mpre">commitBuffer&#39;</span></span></a><span class="mpre"> </span><a name="loc_650_15_650_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_15_650_18&#39;)"><span class="hl_vardecl"><span class="mpre">raw</span></span></a><span class="mpre"> </span><a name="loc_650_19_650_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_19_650_21&#39;)"><span class="hl_specname"><span class="mpre">sz</span></span></a><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> _) </span><a name="loc_650_29_650_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_29_650_34&#39;)"><span class="hl_specname"><span class="mpre">count</span></span></a><span class="mpre">@(</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> _) </span><a name="loc_650_42_650_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_42_650_47&#39;)"><span class="hl_vardecl"><span class="mpre">flush</span></span></a><span class="mpre"> </span><a name="loc_650_48_650_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_48_650_55&#39;)"><span class="hl_vardecl"><span class="mpre">release</span></span></a><span class="mpre"> </span><a name="loc_650_56_650_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_56_650_58&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 650, srcSpanStartColumn = 59, srcSpanEndLine = 650, srcSpanEndColumn = 71}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 650, srcSpanStartColumn = 67, srcSpanEndLine = 650, srcSpanEndColumn = 68},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre">
   = do
      </span><a href="GHC.IO.Handle.Internals.html#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;commitBuffer: sz=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_650_19_650_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_19_650_21&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;, count=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_650_29_650_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_29_650_34&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
            </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;, flush=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_650_42_650_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_42_650_47&#39;)"><span class="hl_varref"><span class="mpre">flush</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;, release=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_650_48_650_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_48_650_55&#39;)"><span class="hl_varref"><span class="mpre">release</span></span></a><span class="mpre">)

      let </span><a name="loc_655_11_655_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_655_11_655_19&#39;)"><span class="hl_vardecl"><span class="mpre">this_buf</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecConstr (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 655, srcSpanStartColumn = 22, srcSpanEndLine = 656, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 655, srcSpanStartColumn = 28, srcSpanEndLine = 655, srcSpanEndColumn = 29},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartL"><span class="mpre">Buffer{ bufRaw=raw, bufState=WriteBuffer,
                             bufL=0, bufR=count, bufSize=sz }</span></span><span class="mpre">

      </span><a href="GHC.IO.Handle.Internals.html#loc_505_1_505_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_505_1_505_16&#39;)"><span class="hl_varref"><span class="mpre">writeCharBuffer</span></span></a><span class="mpre"> </span><a href="#loc_650_56_650_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_56_650_58&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_655_11_655_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_655_11_655_19&#39;)"><span class="hl_varref"><span class="mpre">this_buf</span></span></a><span class="mpre">

      </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_650_42_650_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_42_650_47&#39;)"><span class="hl_varref"><span class="mpre">flush</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.IO.Handle.Internals.html#loc_495_1_495_21" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_495_1_495_21&#39;)"><span class="hl_varref"><span class="mpre">flushByteWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_650_56_650_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_56_650_58&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">

      </span><span class="hl_comment"><span class="mpre">-- release the buffer if necessary</span></span><span class="mpre">
      </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> </span><a href="#loc_650_48_650_55" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_48_650_55&#39;)"><span class="hl_varref"><span class="mpre">release</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
          </span><span class="hl_comment"><span class="mpre">-- find size of current buffer</span></span><span class="mpre">
          </span><span class="hl_specname"><span class="mpre">old_buf</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 665, srcSpanStartColumn = 19, srcSpanEndLine = 665, srcSpanEndColumn = 41}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 665, srcSpanStartColumn = 25, srcSpanEndLine = 665, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Buffer{ bufSize=size }</span></span><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_132_7_132_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_132_7_132_19&#39;)"><span class="hl_varref"><span class="mpre">haCharBuffer</span></span></a><span class="mpre">
          </span><a href="Control.Monad.html#loc_265_1_265_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_265_1_265_5&#39;)"><span class="hl_varref"><span class="mpre">when</span></span></a><span class="mpre"> (</span><a href="#loc_650_19_650_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_19_650_21&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">size</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do
               </span><a name="loc_667_16_667_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_667_16_667_26&#39;)"><span class="hl_vardecl"><span class="mpre">spare_bufs</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_133_7_133_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_133_7_133_16&#39;)"><span class="hl_varref"><span class="mpre">haBuffers</span></span></a><span class="mpre">
               </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_133_7_133_16" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_133_7_133_16&#39;)"><span class="hl_varref"><span class="mpre">haBuffers</span></span></a><span class="mpre"> (</span><a href="GHC.IO.Handle.Types.html#loc_149_5_149_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_149_5_149_19&#39;)"><span class="hl_conref"><span class="mpre">BufferListCons</span></span></a><span class="mpre"> </span><a href="#loc_650_15_650_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_650_15_650_18&#39;)"><span class="hl_varref"><span class="mpre">raw</span></span></a><span class="mpre"> </span><a href="#loc_667_16_667_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_667_16_667_26&#39;)"><span class="hl_varref"><span class="mpre">spare_bufs</span></span></a><span class="mpre">)

      </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_655_11_655_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_655_11_655_19&#39;)"><span class="hl_varref"><span class="mpre">this_buf</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Reading/writing sequences of bytes.</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- hPutBuf</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | &#39;hPutBuf&#39; @hdl buf count@ writes @count@ 8-bit bytes from the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- buffer @buf@ to the handle @hdl@.  It returns ().</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;hPutBuf&#39; ignores any text encoding that applies to the &#39;Handle&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- writing the bytes directly to the underlying file or device.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;hPutBuf&#39; ignores the prevailing &#39;TextEncoding&#39; and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;NewlineMode&#39; on the &#39;Handle&#39;, and writes bytes directly.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This operation may fail with:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * &#39;ResourceVanished&#39; if the handle is a pipe or socket, and the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    reading end is closed.  (If this is a POSIX system, and the program</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    has not asked to ignore SIGPIPE, then a SIGPIPE may be delivered</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    instead, whose default action is to terminate the program).</span></span><span class="mpre">

</span><a href="#loc_698_1_698_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_698_1_698_8&#39;)"><span class="mpre">hPutBuf</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre">                       </span><span class="hl_comment"><span class="mpre">-- handle to write to</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">                        </span><span class="hl_comment"><span class="mpre">-- address of buffer</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">                          </span><span class="hl_comment"><span class="mpre">-- number of bytes of data in buffer</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_698_1_698_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_698_1_698_8&#39;)"><span class="hl_fundecl"><span class="mpre">hPutBuf</span></span></a><span class="mpre"> </span><a name="loc_698_9_698_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_698_9_698_10&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_698_11_698_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_698_11_698_14&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_698_15_698_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_698_15_698_20&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> = do _ &lt;- </span><a href="#loc_713_1_713_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_1_713_9&#39;)"><span class="hl_varref"><span class="mpre">hPutBuf&#39;</span></span></a><span class="mpre"> </span><a href="#loc_698_9_698_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_698_9_698_10&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_698_11_698_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_698_11_698_14&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_698_15_698_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_698_15_698_20&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
                         </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><a href="#loc_706_1_706_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_706_1_706_19&#39;)"><span class="mpre">hPutBufNonBlocking</span></a><span class="mpre">
        :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre">                       </span><span class="hl_comment"><span class="mpre">-- handle to write to</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">                        </span><span class="hl_comment"><span class="mpre">-- address of buffer</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">                          </span><span class="hl_comment"><span class="mpre">-- number of bytes of data in buffer</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">                       </span><span class="hl_comment"><span class="mpre">-- returns: number of bytes written</span></span><span class="mpre">
</span><a name="loc_706_1_706_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_706_1_706_19&#39;)"><span class="hl_fundecl"><span class="mpre">hPutBufNonBlocking</span></span></a><span class="mpre"> </span><a name="loc_706_20_706_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_706_20_706_21&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_706_22_706_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_706_22_706_25&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_706_26_706_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_706_26_706_31&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> = </span><a href="#loc_713_1_713_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_1_713_9&#39;)"><span class="hl_varref"><span class="mpre">hPutBuf&#39;</span></span></a><span class="mpre"> </span><a href="#loc_706_20_706_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_706_20_706_21&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><a href="#loc_706_22_706_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_706_22_706_25&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_706_26_706_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_706_26_706_31&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">

</span><a href="#loc_713_1_713_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_1_713_9&#39;)"><span class="mpre">hPutBuf&#39;</span></a><span class="mpre">:: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre">                       </span><span class="hl_comment"><span class="mpre">-- handle to write to</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">                        </span><span class="hl_comment"><span class="mpre">-- address of buffer</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">                          </span><span class="hl_comment"><span class="mpre">-- number of bytes of data in buffer</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">                         </span><span class="hl_comment"><span class="mpre">-- allow blocking?</span></span><span class="mpre">
        -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_713_1_713_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_1_713_9&#39;)"><span class="hl_fundecl"><span class="mpre">hPutBuf&#39;</span></span></a><span class="mpre"> </span><a name="loc_713_10_713_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_10_713_16&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_713_17_713_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_17_713_20&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_713_21_713_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_21_713_26&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> </span><a name="loc_713_27_713_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_27_713_36&#39;)"><span class="hl_vardecl"><span class="mpre">can_block</span></span></a><span class="mpre">
  | </span><a href="#loc_713_21_713_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_21_713_26&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
  | </span><a href="#loc_713_21_713_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_21_713_26&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre">  </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><a href="#loc_999_1_999_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_999_1_999_18&#39;)"><span class="hl_varref"><span class="mpre">illegalBufferSize</span></span></a><span class="mpre"> </span><a href="#loc_713_10_713_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_10_713_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hPutBuf&quot;</span></span><span class="mpre"> </span><a href="#loc_713_21_713_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_21_713_26&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = 
    </span><a href="GHC.IO.Handle.Internals.html#loc_225_1_225_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_225_1_225_19&#39;)"><span class="hl_varref"><span class="mpre">wantWritableHandle</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hPutBuf&quot;</span></span><span class="mpre"> </span><a href="#loc_713_10_713_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_10_713_16&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> 
      \ </span><a name="loc_718_9_718_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_718_9_718_11&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 718, srcSpanStartColumn = 12, srcSpanEndLine = 718, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 718, srcSpanStartColumn = 20, srcSpanEndLine = 718, srcSpanEndColumn = 21},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; do
          </span><a href="GHC.IO.Handle.Internals.html#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;hPutBuf count=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><a href="#loc_713_21_713_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_21_713_26&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">)

          </span><a name="loc_721_11_721_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_721_11_721_12&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_732_1_732_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_1_732_9&#39;)"><span class="hl_varref"><span class="mpre">bufWrite</span></span></a><span class="mpre"> </span><a href="#loc_718_9_718_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_718_9_718_11&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_713_17_713_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_17_713_20&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">) </span><a href="#loc_713_21_713_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_21_713_26&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><a href="#loc_713_27_713_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_713_27_713_36&#39;)"><span class="hl_varref"><span class="mpre">can_block</span></span></a><span class="mpre">

          </span><span class="hl_comment"><span class="mpre">-- we must flush if this Handle is set to NoBuffering.  If</span></span><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- it is set to LineBuffering, be conservative and flush</span></span><span class="mpre">
          </span><span class="hl_comment"><span class="mpre">-- anyway (we didn&#39;t check for newlines in the data).</span></span><span class="mpre">
          case </span><a href="GHC.IO.Handle.Types.html#loc_130_7_130_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_130_7_130_19&#39;)"><span class="hl_varref"><span class="mpre">haBufferMode</span></span></a><span class="mpre"> of
             </span><a href="GHC.IO.Handle.Types.html#loc_250_4_250_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_250_4_250_18&#39;)"><span class="hl_conref"><span class="mpre">BlockBuffering</span></span></a><span class="mpre"> _      -&gt; do </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">
             </span><span class="hl_vardecl"><span class="mpre">_line_or_no_buffering</span></span><span class="mpre"> -&gt; do </span><a href="GHC.IO.Handle.Internals.html#loc_490_1_490_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_490_1_490_17&#39;)"><span class="hl_varref"><span class="mpre">flushWriteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_718_9_718_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_718_9_718_11&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_721_11_721_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_721_11_721_12&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

</span><a href="#loc_732_1_732_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_1_732_9&#39;)"><span class="mpre">bufWrite</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre">-&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_732_1_732_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_1_732_9&#39;)"><span class="hl_fundecl"><span class="mpre">bufWrite</span></span></a><span class="mpre"> </span><a name="loc_732_10_732_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_10_732_12&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 732, srcSpanStartColumn = 13, srcSpanEndLine = 732, srcSpanEndColumn = 25}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 732, srcSpanStartColumn = 21, srcSpanEndLine = 732, srcSpanEndColumn = 22},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre"> </span><a name="loc_732_26_732_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_26_732_29&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_732_30_732_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_30_732_35&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> </span><a name="loc_732_36_732_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_36_732_45&#39;)"><span class="hl_vardecl"><span class="mpre">can_block</span></span></a><span class="mpre"> =
  </span><span class="hl_varref"><span class="mpre">seq</span></span><span class="mpre"> </span><a href="#loc_732_30_732_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_30_732_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> do  </span><span class="hl_comment"><span class="mpre">-- strictness hack</span></span><span class="mpre">
  </span><a name="loc_734_3_734_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_734_3_734_10&#39;)"><span class="hl_specname"><span class="mpre">old_buf</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 734, srcSpanStartColumn = 11, srcSpanEndLine = 734, srcSpanEndColumn = 57}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 734, srcSpanStartColumn = 17, srcSpanEndLine = 734, srcSpanEndColumn = 18},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Buffer{ bufRaw=old_raw, bufR=w, bufSize=size }</span></span><span class="mpre">
     &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre">

  </span><span class="hl_comment"><span class="mpre">-- enough room in handle buffer?</span></span><span class="mpre">
  if (</span><span class="hl_varref"><span class="mpre">size</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><a href="#loc_732_30_732_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_30_732_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">)
        </span><span class="hl_comment"><span class="mpre">-- There&#39;s enough room in the buffer:</span></span><span class="mpre">
        </span><span class="hl_comment"><span class="mpre">-- just copy the data in and update bufR.</span></span><span class="mpre">
        then do </span><a href="GHC.IO.Handle.Internals.html#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> (</span><span class="hl_string"><span class="mpre">&quot;hPutBuf: copying to buffer, w=&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre">)
                </span><a href="#loc_981_1_981_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_981_1_981_16&#39;)"><span class="hl_varref"><span class="mpre">copyToRawBuffer</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">old_raw</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre"> </span><a href="#loc_732_26_732_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_26_732_29&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_732_30_732_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_30_732_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
                </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 743, srcSpanStartColumn = 41, srcSpanEndLine = 743, srcSpanEndColumn = 68}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 743, srcSpanStartColumn = 48, srcSpanEndLine = 743, srcSpanEndColumn = 49},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartL"><span class="mpre">old_buf{ bufR = w + count }</span></span><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_732_30_732_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_30_732_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">

        </span><span class="hl_comment"><span class="mpre">-- else, we have to flush</span></span><span class="mpre">
        else do </span><a href="GHC.IO.Handle.Internals.html#loc_801_1_801_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_801_1_801_8&#39;)"><span class="hl_varref"><span class="mpre">debugIO</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hPutBuf: flushing first&quot;</span></span><span class="mpre">
                </span><a name="loc_748_17_748_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_748_17_748_25&#39;)"><span class="hl_vardecl"><span class="mpre">old_buf&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.BufferedIO.html#loc_69_3_69_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_69_3_69_19&#39;)"><span class="hl_varref"><span class="mpre">Buffered.flushWriteBuffer</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre"> </span><a href="#loc_734_3_734_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_734_3_734_10&#39;)"><span class="hl_varref"><span class="mpre">old_buf</span></span></a><span class="mpre">
                        </span><span class="hl_comment"><span class="mpre">-- TODO: we should do a non-blocking flush here</span></span><span class="mpre">
                </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_748_17_748_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_748_17_748_25&#39;)"><span class="hl_varref"><span class="mpre">old_buf&#39;</span></span></a><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- if we can fit in the buffer, then just loop  </span></span><span class="mpre">
                if </span><a href="#loc_732_30_732_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_30_732_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">size</span></span><span class="mpre">
                   then </span><a href="#loc_732_1_732_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_1_732_9&#39;)"><span class="hl_varref"><span class="mpre">bufWrite</span></span></a><span class="mpre"> </span><a href="#loc_732_10_732_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_10_732_12&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_732_26_732_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_26_732_29&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_732_30_732_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_30_732_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><a href="#loc_732_36_732_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_36_732_45&#39;)"><span class="hl_varref"><span class="mpre">can_block</span></span></a><span class="mpre">
                   else if </span><a href="#loc_732_36_732_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_36_732_45&#39;)"><span class="hl_varref"><span class="mpre">can_block</span></span></a><span class="mpre">
                           then do </span><a href="#loc_760_1_760_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_760_1_760_11&#39;)"><span class="hl_varref"><span class="mpre">writeChunk</span></span></a><span class="mpre"> </span><a href="#loc_732_10_732_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_10_732_12&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_732_26_732_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_26_732_29&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">) </span><a href="#loc_732_30_732_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_30_732_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
                                   </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_732_30_732_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_30_732_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
                           else </span><a href="#loc_765_1_765_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_765_1_765_22&#39;)"><span class="hl_varref"><span class="mpre">writeChunkNonBlocking</span></span></a><span class="mpre"> </span><a href="#loc_732_10_732_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_10_732_12&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_732_26_732_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_26_732_29&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">) </span><a href="#loc_732_30_732_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_732_30_732_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">

</span><a href="#loc_760_1_760_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_760_1_760_11&#39;)"><span class="mpre">writeChunk</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_760_1_760_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_760_1_760_11&#39;)"><span class="hl_fundecl"><span class="mpre">writeChunk</span></span></a><span class="mpre"> </span><span class="hl_specname"><span class="mpre">h_</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 760, srcSpanStartColumn = 15, srcSpanEndLine = 760, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 760, srcSpanStartColumn = 23, srcSpanEndLine = 760, srcSpanEndColumn = 24},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre"> </span><a name="loc_760_28_760_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_760_28_760_31&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_760_32_760_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_760_32_760_37&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre">
  | </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">fd</span></span><span class="mpre"> &lt;- </span><a href="Data.Typeable.html#loc_112_1_112_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Typeable.html#loc_112_1_112_5&#39;)"><span class="hl_varref"><span class="mpre">cast</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre">  =  </span><a href="GHC.IO.Device.html#loc_53_3_53_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_53_3_53_8&#39;)"><span class="hl_varref"><span class="mpre">RawIO.write</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fd</span></span><span class="mpre">::</span><span class="hl_tyconref"><span class="mpre">FD</span></span><span class="mpre">) </span><a href="#loc_760_28_760_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_760_28_760_31&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_760_32_760_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_760_32_760_37&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Todo: hPutBuf&quot;</span></span><span class="mpre">

</span><a href="#loc_765_1_765_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_765_1_765_22&#39;)"><span class="mpre">writeChunkNonBlocking</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_765_1_765_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_765_1_765_22&#39;)"><span class="hl_fundecl"><span class="mpre">writeChunkNonBlocking</span></span></a><span class="mpre"> </span><span class="hl_specname"><span class="mpre">h_</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 765, srcSpanStartColumn = 26, srcSpanEndLine = 765, srcSpanEndColumn = 38}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 765, srcSpanStartColumn = 34, srcSpanEndLine = 765, srcSpanEndColumn = 35},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre"> </span><a name="loc_765_39_765_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_765_39_765_42&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_765_43_765_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_765_43_765_48&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre"> 
  | </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">fd</span></span><span class="mpre"> &lt;- </span><a href="Data.Typeable.html#loc_112_1_112_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Typeable.html#loc_112_1_112_5&#39;)"><span class="hl_varref"><span class="mpre">cast</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre">  =  </span><a href="GHC.IO.Device.html#loc_57_3_57_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_57_3_57_19&#39;)"><span class="hl_varref"><span class="mpre">RawIO.writeNonBlocking</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fd</span></span><span class="mpre">::</span><span class="hl_tyconref"><span class="mpre">FD</span></span><span class="mpre">) </span><a href="#loc_765_39_765_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_765_39_765_42&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_765_43_765_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_765_43_765_48&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;Todo: hPutBuf&quot;</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- hGetBuf</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | &#39;hGetBuf&#39; @hdl buf count@ reads data from the handle @hdl@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- into the buffer @buf@ until either EOF is reached or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @count@ 8-bit bytes have been read.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- It returns the number of bytes actually read.  This may be zero if</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- EOF was reached before any data was read (or if @count@ is zero).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;hGetBuf&#39; never raises an EOF exception, instead it returns a value</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- smaller than @count@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If the handle is a pipe or socket, and the writing end</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is closed, &#39;hGetBuf&#39; will behave as if EOF was reached.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;hGetBuf&#39; ignores the prevailing &#39;TextEncoding&#39; and &#39;NewlineMode&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- on the &#39;Handle&#39;, and reads bytes directly.</span></span><span class="mpre">

</span><a href="#loc_788_1_788_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_788_1_788_8&#39;)"><span class="mpre">hGetBuf</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_788_1_788_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_788_1_788_8&#39;)"><span class="hl_fundecl"><span class="mpre">hGetBuf</span></span></a><span class="mpre"> </span><a name="loc_788_9_788_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_788_9_788_10&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_788_11_788_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_788_11_788_14&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_788_15_788_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_788_15_788_20&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre">
  | </span><a href="#loc_788_15_788_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_788_15_788_20&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
  | </span><a href="#loc_788_15_788_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_788_15_788_20&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre">  </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><a href="#loc_999_1_999_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_999_1_999_18&#39;)"><span class="hl_varref"><span class="mpre">illegalBufferSize</span></span></a><span class="mpre"> </span><a href="#loc_788_9_788_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_788_9_788_10&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hGetBuf&quot;</span></span><span class="mpre"> </span><a href="#loc_788_15_788_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_788_15_788_20&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = 
      </span><a href="GHC.IO.Handle.Internals.html#loc_264_1_264_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_264_1_264_20&#39;)"><span class="hl_varref"><span class="mpre">wantReadableHandle_</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hGetBuf&quot;</span></span><span class="mpre"> </span><a href="#loc_788_9_788_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_788_9_788_10&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_792_43_792_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_792_43_792_45&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 792, srcSpanStartColumn = 46, srcSpanEndLine = 792, srcSpanEndColumn = 58}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 792, srcSpanStartColumn = 54, srcSpanEndLine = 792, srcSpanEndColumn = 55},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; do
         </span><a href="GHC.IO.Handle.Internals.html#loc_543_1_543_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_543_1_543_20&#39;)"><span class="hl_varref"><span class="mpre">flushCharReadBuffer</span></span></a><span class="mpre"> </span><a href="#loc_792_43_792_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_792_43_792_45&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
         </span><a name="loc_794_10_794_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_794_10_794_13&#39;)"><span class="hl_specname"><span class="mpre">buf</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 794, srcSpanStartColumn = 14, srcSpanEndLine = 794, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 794, srcSpanStartColumn = 20, srcSpanEndLine = 794, srcSpanEndColumn = 21},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Buffer{ bufRaw=raw, bufR=w, bufL=r, bufSize=sz }</span></span><span class="mpre">
            &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre">
         if </span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_794_10_794_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_794_10_794_13&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
            then </span><a href="#loc_830_1_830_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_830_1_830_13&#39;)"><span class="hl_varref"><span class="mpre">bufReadEmpty</span></span></a><span class="mpre">    </span><a href="#loc_792_43_792_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_792_43_792_45&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_794_10_794_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_794_10_794_13&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_788_11_788_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_788_11_788_14&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_788_15_788_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_788_15_788_20&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
            else </span><a href="#loc_805_1_805_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_805_1_805_16&#39;)"><span class="hl_varref"><span class="mpre">bufReadNonEmpty</span></span></a><span class="mpre"> </span><a href="#loc_792_43_792_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_792_43_792_45&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_794_10_794_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_794_10_794_13&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_788_11_788_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_788_11_788_14&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_788_15_788_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_788_15_788_20&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- small reads go through the buffer, large reads are satisfied by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- taking data first from the buffer and then direct from the file</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- descriptor.</span></span><span class="mpre">

</span><a href="#loc_805_1_805_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_805_1_805_16&#39;)"><span class="mpre">bufReadNonEmpty</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_805_1_805_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_805_1_805_16&#39;)"><span class="hl_fundecl"><span class="mpre">bufReadNonEmpty</span></span></a><span class="mpre"> </span><a name="loc_805_17_805_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_805_17_805_19&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 805, srcSpanStartColumn = 20, srcSpanEndLine = 805, srcSpanEndColumn = 32}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 805, srcSpanStartColumn = 28, srcSpanEndLine = 805, srcSpanEndColumn = 29},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre">
                </span><span class="hl_specname"><span class="mpre">buf</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 806, srcSpanStartColumn = 21, srcSpanEndLine = 806, srcSpanEndColumn = 69}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 806, srcSpanStartColumn = 27, srcSpanEndLine = 806, srcSpanEndColumn = 28},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Buffer{ bufRaw=raw, bufR=w, bufL=r, bufSize=sz }</span></span><span class="mpre">
                </span><a name="loc_807_17_807_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_807_17_807_20&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> !</span><a name="loc_807_22_807_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_807_22_807_28&#39;)"><span class="hl_vardecl"><span class="mpre">so_far</span></span></a><span class="mpre"> !</span><a name="loc_807_30_807_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_807_30_807_35&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre"> 
 = do
        let </span><a name="loc_809_13_809_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_809_13_809_18&#39;)"><span class="hl_vardecl"><span class="mpre">avail</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">r</span></span><span class="mpre">
        if (</span><a href="#loc_807_30_807_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_807_30_807_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_809_13_809_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_809_13_809_18&#39;)"><span class="hl_varref"><span class="mpre">avail</span></span></a><span class="mpre">)
           then do 
                </span><a href="#loc_987_1_987_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_987_1_987_18&#39;)"><span class="hl_varref"><span class="mpre">copyFromRawBuffer</span></span></a><span class="mpre"> </span><a href="#loc_807_17_807_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_807_17_807_20&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">r</span></span><span class="mpre"> </span><a href="#loc_807_30_807_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_807_30_807_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
                </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 813, srcSpanStartColumn = 41, srcSpanEndLine = 813, srcSpanEndColumn = 64}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 813, srcSpanStartColumn = 44, srcSpanEndLine = 813, srcSpanEndColumn = 45},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartL"><span class="mpre">buf{ bufL = r + count }</span></span><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_807_22_807_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_807_22_807_28&#39;)"><span class="hl_varref"><span class="mpre">so_far</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_807_30_807_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_807_30_807_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">)
           else do
  
        </span><a href="#loc_987_1_987_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_987_1_987_18&#39;)"><span class="hl_varref"><span class="mpre">copyFromRawBuffer</span></span></a><span class="mpre"> </span><a href="#loc_807_17_807_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_807_17_807_20&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">r</span></span><span class="mpre"> </span><a href="#loc_809_13_809_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_809_13_809_18&#39;)"><span class="hl_varref"><span class="mpre">avail</span></span></a><span class="mpre">
        let </span><a name="loc_818_13_818_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_818_13_818_17&#39;)"><span class="hl_vardecl"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 818, srcSpanStartColumn = 20, srcSpanEndLine = 818, srcSpanEndColumn = 41}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 818, srcSpanStartColumn = 23, srcSpanEndLine = 818, srcSpanEndColumn = 24},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartL"><span class="mpre">buf{ bufR=0, bufL=0 }</span></span><span class="mpre">
        </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_818_13_818_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_818_13_818_17&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">
        let </span><a name="loc_820_13_820_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_820_13_820_22&#39;)"><span class="hl_vardecl"><span class="mpre">remaining</span></span></a><span class="mpre"> = </span><a href="#loc_807_30_807_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_807_30_807_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_809_13_809_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_809_13_809_18&#39;)"><span class="hl_varref"><span class="mpre">avail</span></span></a><span class="mpre">
            </span><a name="loc_821_13_821_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_821_13_821_20&#39;)"><span class="hl_vardecl"><span class="mpre">so_far&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_807_22_807_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_807_22_807_28&#39;)"><span class="hl_varref"><span class="mpre">so_far</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_809_13_809_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_809_13_809_18&#39;)"><span class="hl_varref"><span class="mpre">avail</span></span></a><span class="mpre">
            </span><a name="loc_822_13_822_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_822_13_822_17&#39;)"><span class="hl_vardecl"><span class="mpre">ptr&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_807_17_807_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_807_17_807_20&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_809_13_809_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_809_13_809_18&#39;)"><span class="hl_varref"><span class="mpre">avail</span></span></a><span class="mpre">

        if </span><a href="#loc_820_13_820_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_820_13_820_22&#39;)"><span class="hl_varref"><span class="mpre">remaining</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> 
           then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_821_13_821_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_821_13_821_20&#39;)"><span class="hl_varref"><span class="mpre">so_far&#39;</span></span></a><span class="mpre">
           else </span><a href="#loc_830_1_830_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_830_1_830_13&#39;)"><span class="hl_varref"><span class="mpre">bufReadEmpty</span></span></a><span class="mpre"> </span><a href="#loc_805_17_805_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_805_17_805_19&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_818_13_818_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_818_13_818_17&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> </span><a href="#loc_822_13_822_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_822_13_822_17&#39;)"><span class="hl_varref"><span class="mpre">ptr&#39;</span></span></a><span class="mpre"> </span><a href="#loc_821_13_821_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_821_13_821_20&#39;)"><span class="hl_varref"><span class="mpre">so_far&#39;</span></span></a><span class="mpre"> </span><a href="#loc_820_13_820_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_820_13_820_22&#39;)"><span class="hl_varref"><span class="mpre">remaining</span></span></a><span class="mpre">


</span><a href="#loc_830_1_830_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_830_1_830_13&#39;)"><span class="mpre">bufReadEmpty</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_830_1_830_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_830_1_830_13&#39;)"><span class="hl_fundecl"><span class="mpre">bufReadEmpty</span></span></a><span class="mpre"> </span><a name="loc_830_14_830_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_830_14_830_16&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 830, srcSpanStartColumn = 17, srcSpanEndLine = 830, srcSpanEndColumn = 29}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 830, srcSpanStartColumn = 25, srcSpanEndLine = 830, srcSpanEndColumn = 26},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre">
             </span><a name="loc_831_14_831_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_831_14_831_17&#39;)"><span class="hl_specname"><span class="mpre">buf</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 831, srcSpanStartColumn = 18, srcSpanEndLine = 831, srcSpanEndColumn = 66}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 831, srcSpanStartColumn = 24, srcSpanEndLine = 831, srcSpanEndColumn = 25},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Buffer{ bufRaw=raw, bufR=w, bufL=r, bufSize=sz }</span></span><span class="mpre">
             </span><a name="loc_832_14_832_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_14_832_17&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_832_18_832_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_18_832_24&#39;)"><span class="hl_vardecl"><span class="mpre">so_far</span></span></a><span class="mpre"> </span><a name="loc_832_25_832_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_25_832_30&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre">
 | </span><a href="#loc_832_25_832_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_25_832_30&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">sz</span></span><span class="mpre">, </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">fd</span></span><span class="mpre"> &lt;- </span><a href="Data.Typeable.html#loc_112_1_112_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Typeable.html#loc_112_1_112_5&#39;)"><span class="hl_varref"><span class="mpre">cast</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre"> = </span><a href="#loc_842_3_842_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_842_3_842_7&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">fd</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_832_25_832_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_25_832_30&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
 | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do
     (</span><a name="loc_835_7_835_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_835_7_835_8&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">,</span><a name="loc_835_9_835_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_835_9_835_13&#39;)"><span class="hl_vardecl"><span class="mpre">buf&#39;</span></span></a><span class="mpre">) &lt;- </span><a href="GHC.IO.BufferedIO.html#loc_48_3_48_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_48_3_48_17&#39;)"><span class="hl_varref"><span class="mpre">Buffered.fillReadBuffer</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre"> </span><a href="#loc_831_14_831_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_831_14_831_17&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
     if </span><a href="#loc_835_7_835_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_835_7_835_8&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> 
        then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_832_18_832_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_18_832_24&#39;)"><span class="hl_varref"><span class="mpre">so_far</span></span></a><span class="mpre">
        else do </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_835_9_835_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_835_9_835_13&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">
                </span><a href="#loc_805_1_805_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_805_1_805_16&#39;)"><span class="hl_varref"><span class="mpre">bufReadNonEmpty</span></span></a><span class="mpre"> </span><a href="#loc_830_14_830_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_830_14_830_16&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_835_9_835_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_835_9_835_13&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> </span><a href="#loc_832_14_832_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_14_832_17&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_832_18_832_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_18_832_24&#39;)"><span class="hl_varref"><span class="mpre">so_far</span></span></a><span class="mpre"> </span><a href="#loc_832_25_832_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_25_832_30&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
 where
  </span><a href="#loc_842_3_842_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_842_3_842_7&#39;)"><span class="mpre">loop</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">FD</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
  </span><a name="loc_842_3_842_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_842_3_842_7&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">fd</span></span><span class="mpre"> </span><a name="loc_842_11_842_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_842_11_842_14&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_842_15_842_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_842_15_842_20&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre"> | </span><a href="#loc_842_15_842_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_842_15_842_20&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_832_18_832_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_18_832_24&#39;)"><span class="hl_varref"><span class="mpre">so_far</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_842_11_842_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_842_11_842_14&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre">)
  </span><a href="#loc_842_3_842_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_842_3_842_7&#39;)"><span class="hl_fundecl"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a name="loc_843_8_843_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_843_8_843_10&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> </span><a name="loc_843_11_843_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_843_11_843_14&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_843_15_843_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_843_15_843_20&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre"> = do
    </span><a name="loc_844_5_844_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_844_5_844_6&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Device.html#loc_45_3_45_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_45_3_45_7&#39;)"><span class="hl_varref"><span class="mpre">RawIO.read</span></span></a><span class="mpre"> (</span><a href="#loc_843_8_843_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_843_8_843_10&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre">::</span><span class="hl_tyconref"><span class="mpre">FD</span></span><span class="mpre">) (</span><a href="#loc_832_14_832_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_14_832_17&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_843_11_843_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_843_11_843_14&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre">) </span><a href="#loc_843_15_843_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_843_15_843_20&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">
    if </span><a href="#loc_844_5_844_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_844_5_844_6&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
        then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_832_18_832_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_832_18_832_24&#39;)"><span class="hl_varref"><span class="mpre">so_far</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_843_11_843_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_843_11_843_14&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre">)
        else </span><a href="#loc_842_3_842_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_842_3_842_7&#39;)"><span class="hl_varref"><span class="mpre">loop</span></span></a><span class="mpre"> </span><a href="#loc_843_8_843_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_843_8_843_10&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> (</span><a href="#loc_843_11_843_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_843_11_843_14&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_844_5_844_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_844_5_844_6&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">) (</span><a href="#loc_843_15_843_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_843_15_843_20&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_844_5_844_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_844_5_844_6&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- hGetBufSome</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | &#39;hGetBufSome&#39; @hdl buf count@ reads data from the handle @hdl@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- into the buffer @buf@.  If there is any data available to read,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- then &#39;hGetBufSome&#39; returns it immediately; it only blocks if there</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is no data to be read.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- It returns the number of bytes actually read.  This may be zero if</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- EOF was reached before any data was read (or if @count@ is zero).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;hGetBufSome&#39; never raises an EOF exception, instead it returns a value</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- smaller than @count@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If the handle is a pipe or socket, and the writing end</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is closed, &#39;hGetBufSome&#39; will behave as if EOF was reached.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;hGetBufSome&#39; ignores the prevailing &#39;TextEncoding&#39; and &#39;NewlineMode&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- on the &#39;Handle&#39;, and reads bytes directly.</span></span><span class="mpre">

</span><a href="#loc_870_1_870_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_1_870_12&#39;)"><span class="mpre">hGetBufSome</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_870_1_870_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_1_870_12&#39;)"><span class="hl_fundecl"><span class="mpre">hGetBufSome</span></span></a><span class="mpre"> </span><a name="loc_870_13_870_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_13_870_14&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_870_15_870_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_15_870_18&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_870_19_870_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_19_870_24&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre">
  | </span><a href="#loc_870_19_870_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_19_870_24&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
  | </span><a href="#loc_870_19_870_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_19_870_24&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre">  </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><a href="#loc_999_1_999_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_999_1_999_18&#39;)"><span class="hl_varref"><span class="mpre">illegalBufferSize</span></span></a><span class="mpre"> </span><a href="#loc_870_13_870_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_13_870_14&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hGetBufSome&quot;</span></span><span class="mpre"> </span><a href="#loc_870_19_870_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_19_870_24&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> =
      </span><a href="GHC.IO.Handle.Internals.html#loc_264_1_264_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_264_1_264_20&#39;)"><span class="hl_varref"><span class="mpre">wantReadableHandle_</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hGetBufSome&quot;</span></span><span class="mpre"> </span><a href="#loc_870_13_870_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_13_870_14&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_874_47_874_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_874_47_874_49&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 874, srcSpanStartColumn = 50, srcSpanEndLine = 874, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 874, srcSpanStartColumn = 58, srcSpanEndLine = 874, srcSpanEndColumn = 59},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; do
         </span><a href="GHC.IO.Handle.Internals.html#loc_543_1_543_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_543_1_543_20&#39;)"><span class="hl_varref"><span class="mpre">flushCharReadBuffer</span></span></a><span class="mpre"> </span><a href="#loc_874_47_874_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_874_47_874_49&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
         </span><a name="loc_876_10_876_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_876_10_876_13&#39;)"><span class="hl_specname"><span class="mpre">buf</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 876, srcSpanStartColumn = 14, srcSpanEndLine = 876, srcSpanEndColumn = 34}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 876, srcSpanStartColumn = 20, srcSpanEndLine = 876, srcSpanEndColumn = 21},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Buffer{ bufSize=sz }</span></span><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre">
         if </span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_876_10_876_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_876_10_876_13&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
            then case </span><a href="#loc_870_19_870_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_19_870_24&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">sz</span></span><span class="mpre"> of  </span><span class="hl_comment"><span class="mpre">-- large read? optimize it with a little special case:</span></span><span class="mpre">
                    </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> | </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_879_33_879_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_879_33_879_35&#39;)"><span class="hl_vardecl"><span class="mpre">fd</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_893_1_893_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_893_1_893_5&#39;)"><span class="hl_varref"><span class="mpre">haFD</span></span></a><span class="mpre"> </span><a href="#loc_874_47_874_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_874_47_874_49&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> -&gt; do </span><a href="GHC.IO.Device.html#loc_45_3_45_7" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_45_3_45_7&#39;)"><span class="hl_varref"><span class="mpre">RawIO.read</span></span></a><span class="mpre"> </span><a href="#loc_879_33_879_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_879_33_879_35&#39;)"><span class="hl_varref"><span class="mpre">fd</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_870_15_870_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_15_870_18&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">) </span><a href="#loc_870_19_870_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_19_870_24&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
                    _ -&gt; do (</span><a name="loc_880_30_880_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_880_30_880_31&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">,</span><a name="loc_880_32_880_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_880_32_880_36&#39;)"><span class="hl_vardecl"><span class="mpre">buf&#39;</span></span></a><span class="mpre">) &lt;- </span><a href="GHC.IO.BufferedIO.html#loc_48_3_48_17" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_48_3_48_17&#39;)"><span class="hl_varref"><span class="mpre">Buffered.fillReadBuffer</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre"> </span><a href="#loc_876_10_876_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_876_10_876_13&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
                            if </span><a href="#loc_880_30_880_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_880_30_880_31&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
                               then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
                               else do </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_880_32_880_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_880_32_880_36&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">
                                       </span><a href="#loc_954_1_954_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_954_1_954_18&#39;)"><span class="hl_varref"><span class="mpre">bufReadNBNonEmpty</span></span></a><span class="mpre"> </span><a href="#loc_874_47_874_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_874_47_874_49&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_880_32_880_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_880_32_880_36&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_870_15_870_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_15_870_18&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">min</span></span><span class="mpre"> </span><a href="#loc_880_30_880_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_880_30_880_31&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> </span><a href="#loc_870_19_870_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_19_870_24&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">)
                                        </span><span class="hl_comment"><span class="mpre">-- new count is  (min r count), so</span></span><span class="mpre">
                                        </span><span class="hl_comment"><span class="mpre">-- that bufReadNBNonEmpty will not</span></span><span class="mpre">
                                        </span><span class="hl_comment"><span class="mpre">-- issue another read.</span></span><span class="mpre">
            else
              let </span><a name="loc_889_19_889_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_889_19_889_25&#39;)"><span class="hl_vardecl"><span class="mpre">count&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">min</span></span><span class="mpre"> </span><a href="#loc_870_19_870_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_19_870_24&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> (</span><a href="GHC.IO.Buffer.html#loc_223_1_223_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_223_1_223_12&#39;)"><span class="hl_varref"><span class="mpre">bufferElems</span></span></a><span class="mpre"> </span><a href="#loc_876_10_876_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_876_10_876_13&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">)
              in </span><a href="#loc_954_1_954_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_954_1_954_18&#39;)"><span class="hl_varref"><span class="mpre">bufReadNBNonEmpty</span></span></a><span class="mpre"> </span><a href="#loc_874_47_874_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_874_47_874_49&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_876_10_876_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_876_10_876_13&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_870_15_870_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_870_15_870_18&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_889_19_889_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_889_19_889_25&#39;)"><span class="hl_varref"><span class="mpre">count&#39;</span></span></a><span class="mpre">

</span><a href="#loc_893_1_893_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_893_1_893_5&#39;)"><span class="mpre">haFD</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><a href="Data.Maybe.html#loc_49_7_49_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_7_49_12&#39;)"><span class="hl_tyconref"><span class="mpre">Maybe</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">FD</span></span><span class="mpre">
</span><a name="loc_893_1_893_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_893_1_893_5&#39;)"><span class="hl_fundecl"><span class="mpre">haFD</span></span></a><span class="mpre"> </span><span class="hl_specname"><span class="mpre">h_</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 893, srcSpanStartColumn = 9, srcSpanEndLine = 893, srcSpanEndColumn = 21}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 893, srcSpanStartColumn = 17, srcSpanEndLine = 893, srcSpanEndColumn = 18},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = "><span class="mpre">Handle__{..}</span></span><span class="mpre"> = </span><a href="Data.Typeable.html#loc_112_1_112_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Typeable.html#loc_112_1_112_5&#39;)"><span class="hl_varref"><span class="mpre">cast</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | &#39;hGetBufNonBlocking&#39; @hdl buf count@ reads data from the handle @hdl@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- into the buffer @buf@ until either EOF is reached, or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @count@ 8-bit bytes have been read, or there is no more data available</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to read immediately.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;hGetBufNonBlocking&#39; is identical to &#39;hGetBuf&#39;, except that it will</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- never block waiting for data to become available, instead it returns</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- only whatever data is available.  To wait for data to arrive before</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- calling &#39;hGetBufNonBlocking&#39;, use &#39;hWaitForInput&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If the handle is a pipe or socket, and the writing end</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is closed, &#39;hGetBufNonBlocking&#39; will behave as if EOF was reached.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;hGetBufNonBlocking&#39; ignores the prevailing &#39;TextEncoding&#39; and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;NewlineMode&#39; on the &#39;Handle&#39;, and reads bytes directly.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- NOTE: on Windows, this function does not work correctly; it</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- behaves identically to &#39;hGetBuf&#39;.</span></span><span class="mpre">

</span><a href="#loc_915_1_915_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_915_1_915_19&#39;)"><span class="mpre">hGetBufNonBlocking</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_915_1_915_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_915_1_915_19&#39;)"><span class="hl_fundecl"><span class="mpre">hGetBufNonBlocking</span></span></a><span class="mpre"> </span><a name="loc_915_20_915_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_915_20_915_21&#39;)"><span class="hl_vardecl"><span class="mpre">h</span></span></a><span class="mpre"> </span><a name="loc_915_22_915_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_915_22_915_25&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_915_26_915_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_915_26_915_31&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre">
  | </span><a href="#loc_915_26_915_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_915_26_915_31&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
  | </span><a href="#loc_915_26_915_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_915_26_915_31&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre">  </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> = </span><a href="#loc_999_1_999_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_999_1_999_18&#39;)"><span class="hl_varref"><span class="mpre">illegalBufferSize</span></span></a><span class="mpre"> </span><a href="#loc_915_20_915_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_915_20_915_21&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hGetBufNonBlocking&quot;</span></span><span class="mpre"> </span><a href="#loc_915_26_915_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_915_26_915_31&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = 
      </span><a href="GHC.IO.Handle.Internals.html#loc_264_1_264_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_264_1_264_20&#39;)"><span class="hl_varref"><span class="mpre">wantReadableHandle_</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;hGetBufNonBlocking&quot;</span></span><span class="mpre"> </span><a href="#loc_915_20_915_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_915_20_915_21&#39;)"><span class="hl_varref"><span class="mpre">h</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_919_54_919_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_919_54_919_56&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 919, srcSpanStartColumn = 57, srcSpanEndLine = 919, srcSpanEndColumn = 69}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 919, srcSpanStartColumn = 65, srcSpanEndLine = 919, srcSpanEndColumn = 66},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre"> -&gt; do
         </span><a href="GHC.IO.Handle.Internals.html#loc_543_1_543_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Internals.html#loc_543_1_543_20&#39;)"><span class="hl_varref"><span class="mpre">flushCharReadBuffer</span></span></a><span class="mpre"> </span><a href="#loc_919_54_919_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_919_54_919_56&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre">
         </span><a name="loc_921_10_921_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_921_10_921_13&#39;)"><span class="hl_specname"><span class="mpre">buf</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 921, srcSpanStartColumn = 14, srcSpanEndLine = 921, srcSpanEndColumn = 62}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 921, srcSpanStartColumn = 20, srcSpanEndLine = 921, srcSpanEndColumn = 21},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Buffer{ bufRaw=raw, bufR=w, bufL=r, bufSize=sz }</span></span><span class="mpre">
            &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre">
         if </span><a href="GHC.IO.Buffer.html#loc_204_1_204_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_204_1_204_14&#39;)"><span class="hl_varref"><span class="mpre">isEmptyBuffer</span></span></a><span class="mpre"> </span><a href="#loc_921_10_921_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_921_10_921_13&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
            then </span><a href="#loc_928_1_928_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_928_1_928_15&#39;)"><span class="hl_varref"><span class="mpre">bufReadNBEmpty</span></span></a><span class="mpre">    </span><a href="#loc_919_54_919_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_919_54_919_56&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_921_10_921_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_921_10_921_13&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_915_22_915_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_915_22_915_25&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_915_26_915_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_915_26_915_31&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
            else </span><a href="#loc_954_1_954_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_954_1_954_18&#39;)"><span class="hl_varref"><span class="mpre">bufReadNBNonEmpty</span></span></a><span class="mpre"> </span><a href="#loc_919_54_919_56" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_919_54_919_56&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_921_10_921_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_921_10_921_13&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">castPtr</span></span><span class="mpre"> </span><a href="#loc_915_22_915_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_915_22_915_25&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">) </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_915_26_915_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_915_26_915_31&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">

</span><a href="#loc_928_1_928_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_928_1_928_15&#39;)"><span class="mpre">bufReadNBEmpty</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_928_1_928_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_928_1_928_15&#39;)"><span class="hl_fundecl"><span class="mpre">bufReadNBEmpty</span></span></a><span class="mpre">   </span><a name="loc_928_18_928_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_928_18_928_20&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 928, srcSpanStartColumn = 21, srcSpanEndLine = 928, srcSpanEndColumn = 33}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 928, srcSpanStartColumn = 29, srcSpanEndLine = 928, srcSpanEndColumn = 30},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre">
                 </span><span class="hl_specname"><span class="mpre">buf</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 929, srcSpanStartColumn = 22, srcSpanEndLine = 929, srcSpanEndColumn = 70}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 929, srcSpanStartColumn = 28, srcSpanEndLine = 929, srcSpanEndColumn = 29},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Buffer{ bufRaw=raw, bufR=w, bufL=r, bufSize=sz }</span></span><span class="mpre">
                 </span><a name="loc_930_18_930_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_18_930_21&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_930_22_930_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_22_930_28&#39;)"><span class="hl_vardecl"><span class="mpre">so_far</span></span></a><span class="mpre"> </span><a name="loc_930_29_930_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_29_930_34&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre">
  | </span><a href="#loc_930_29_930_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_29_930_34&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&gt;</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">sz</span></span><span class="mpre">,
    </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">fd</span></span><span class="mpre"> &lt;- </span><a href="Data.Typeable.html#loc_112_1_112_5" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Typeable.html#loc_112_1_112_5&#39;)"><span class="hl_varref"><span class="mpre">cast</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre"> = do
       </span><a name="loc_933_8_933_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_933_8_933_9&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IO.Device.html#loc_50_3_50_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Device.html#loc_50_3_50_18&#39;)"><span class="hl_varref"><span class="mpre">RawIO.readNonBlocking</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fd</span></span><span class="mpre">::</span><span class="hl_tyconref"><span class="mpre">FD</span></span><span class="mpre">) </span><a href="#loc_930_18_930_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_18_930_21&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_930_29_930_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_29_930_34&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
       case </span><a href="#loc_933_8_933_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_933_8_933_9&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> of
         </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_930_22_930_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_22_930_28&#39;)"><span class="hl_varref"><span class="mpre">so_far</span></span></a><span class="mpre">
         </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_936_15_936_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_936_15_936_16&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_930_22_930_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_22_930_28&#39;)"><span class="hl_varref"><span class="mpre">so_far</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_936_15_936_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_936_15_936_16&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre">)

 | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = do
     </span><a name="loc_939_6_939_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_939_6_939_9&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> &lt;- </span><a href="GHC.IORef.html#loc_46_1_46_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_46_1_46_10&#39;)"><span class="hl_varref"><span class="mpre">readIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre">
     (</span><a name="loc_940_7_940_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_940_7_940_8&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">,</span><a name="loc_940_9_940_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_940_9_940_13&#39;)"><span class="hl_vardecl"><span class="mpre">buf&#39;</span></span></a><span class="mpre">) &lt;- </span><a href="GHC.IO.BufferedIO.html#loc_53_3_53_18" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.BufferedIO.html#loc_53_3_53_18&#39;)"><span class="hl_varref"><span class="mpre">Buffered.fillReadBuffer0</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_127_7_127_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_127_7_127_15&#39;)"><span class="hl_varref"><span class="mpre">haDevice</span></span></a><span class="mpre"> </span><a href="#loc_939_6_939_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_939_6_939_9&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
     case </span><a href="#loc_940_7_940_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_940_7_940_8&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> of
       </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_930_22_930_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_22_930_28&#39;)"><span class="hl_varref"><span class="mpre">so_far</span></span></a><span class="mpre">
       </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_930_22_930_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_22_930_28&#39;)"><span class="hl_varref"><span class="mpre">so_far</span></span></a><span class="mpre">
       </span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a name="loc_944_13_944_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_944_13_944_14&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre">  -&gt; do
         </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_940_9_940_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_940_9_940_13&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">
         </span><a href="#loc_954_1_954_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_954_1_954_18&#39;)"><span class="hl_varref"><span class="mpre">bufReadNBNonEmpty</span></span></a><span class="mpre"> </span><a href="#loc_928_18_928_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_928_18_928_20&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_940_9_940_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_940_9_940_13&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> </span><a href="#loc_930_18_930_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_18_930_21&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_930_22_930_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_22_930_28&#39;)"><span class="hl_varref"><span class="mpre">so_far</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">min</span></span><span class="mpre"> </span><a href="#loc_930_29_930_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_930_29_930_34&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><a href="#loc_944_13_944_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_944_13_944_14&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">)
                          </span><span class="hl_comment"><span class="mpre">-- NOTE: new count is    min count r</span></span><span class="mpre">
                          </span><span class="hl_comment"><span class="mpre">-- so we will just copy the contents of the</span></span><span class="mpre">
                          </span><span class="hl_comment"><span class="mpre">-- buffer in the recursive call, and not</span></span><span class="mpre">
                          </span><span class="hl_comment"><span class="mpre">-- loop again.</span></span><span class="mpre">


</span><a href="#loc_954_1_954_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_954_1_954_18&#39;)"><span class="mpre">bufReadNBNonEmpty</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_124_6_124_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_124_6_124_14&#39;)"><span class="hl_tyconref"><span class="mpre">Handle__</span></span></a><span class="mpre"> -&gt; </span><a href="GHC.IO.Buffer.html#loc_180_6_180_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_180_6_180_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_954_1_954_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_954_1_954_18&#39;)"><span class="hl_fundecl"><span class="mpre">bufReadNBNonEmpty</span></span></a><span class="mpre"> </span><a name="loc_954_19_954_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_954_19_954_21&#39;)"><span class="hl_specname"><span class="mpre">h_</span></span></a><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 954, srcSpanStartColumn = 22, srcSpanEndLine = 954, srcSpanEndColumn = 34}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 954, srcSpanStartColumn = 30, srcSpanEndLine = 954, srcSpanEndColumn = 31},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Handle__{..}</span></span><span class="mpre">
                  </span><span class="hl_specname"><span class="mpre">buf</span></span><span class="mpre">@</span><span class="warning" data-warning="PatPRec (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 955, srcSpanStartColumn = 23, srcSpanEndLine = 955, srcSpanEndColumn = 71}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 955, srcSpanStartColumn = 29, srcSpanEndLine = 955, srcSpanEndColumn = 30},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine ="><span class="mpre">Buffer{ bufRaw=raw, bufR=w, bufL=r, bufSize=sz }</span></span><span class="mpre">
                  </span><a name="loc_956_19_956_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_956_19_956_22&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_956_23_956_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_956_23_956_29&#39;)"><span class="hl_vardecl"><span class="mpre">so_far</span></span></a><span class="mpre"> </span><a name="loc_956_30_956_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_956_30_956_35&#39;)"><span class="hl_vardecl"><span class="mpre">count</span></span></a><span class="mpre">
  = do
        let </span><a name="loc_958_13_958_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_958_13_958_18&#39;)"><span class="hl_vardecl"><span class="mpre">avail</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">w</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">r</span></span><span class="mpre">
        if (</span><a href="#loc_956_30_956_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_956_30_956_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;</span></span><span class="mpre"> </span><a href="#loc_958_13_958_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_958_13_958_18&#39;)"><span class="hl_varref"><span class="mpre">avail</span></span></a><span class="mpre">)
           then do 
                </span><a href="#loc_987_1_987_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_987_1_987_18&#39;)"><span class="hl_varref"><span class="mpre">copyFromRawBuffer</span></span></a><span class="mpre"> </span><a href="#loc_956_19_956_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_956_19_956_22&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">r</span></span><span class="mpre"> </span><a href="#loc_956_30_956_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_956_30_956_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">
                </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 962, srcSpanStartColumn = 41, srcSpanEndLine = 962, srcSpanEndColumn = 64}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 962, srcSpanStartColumn = 44, srcSpanEndLine = 962, srcSpanEndColumn = 45},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartL"><span class="mpre">buf{ bufL = r + count }</span></span><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_956_23_956_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_956_23_956_29&#39;)"><span class="hl_varref"><span class="mpre">so_far</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_956_30_956_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_956_30_956_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre">)
           else do

        </span><a href="#loc_987_1_987_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_987_1_987_18&#39;)"><span class="hl_varref"><span class="mpre">copyFromRawBuffer</span></span></a><span class="mpre"> </span><a href="#loc_956_19_956_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_956_19_956_22&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">raw</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">r</span></span><span class="mpre"> </span><a href="#loc_958_13_958_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_958_13_958_18&#39;)"><span class="hl_varref"><span class="mpre">avail</span></span></a><span class="mpre">
        let </span><a name="loc_967_13_967_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_967_13_967_17&#39;)"><span class="hl_vardecl"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> = </span><span class="warning" data-warning="ExpRecUpdate (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 967, srcSpanStartColumn = 20, srcSpanEndLine = 967, srcSpanEndColumn = 41}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 967, srcSpanStartColumn = 23, srcSpanEndLine = 967, srcSpanEndColumn = 24},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartL"><span class="mpre">buf{ bufR=0, bufL=0 }</span></span><span class="mpre">
        </span><a href="GHC.IORef.html#loc_50_1_50_11" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IORef.html#loc_50_1_50_11&#39;)"><span class="hl_varref"><span class="mpre">writeIORef</span></span></a><span class="mpre"> </span><a href="GHC.IO.Handle.Types.html#loc_129_7_129_19" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_129_7_129_19&#39;)"><span class="hl_varref"><span class="mpre">haByteBuffer</span></span></a><span class="mpre"> </span><a href="#loc_967_13_967_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_967_13_967_17&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">
        let </span><a name="loc_969_13_969_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_969_13_969_22&#39;)"><span class="hl_vardecl"><span class="mpre">remaining</span></span></a><span class="mpre"> = </span><a href="#loc_956_30_956_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_956_30_956_35&#39;)"><span class="hl_varref"><span class="mpre">count</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_958_13_958_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_958_13_958_18&#39;)"><span class="hl_varref"><span class="mpre">avail</span></span></a><span class="mpre">
            </span><a name="loc_970_13_970_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_970_13_970_20&#39;)"><span class="hl_vardecl"><span class="mpre">so_far&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_956_23_956_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_956_23_956_29&#39;)"><span class="hl_varref"><span class="mpre">so_far</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_958_13_958_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_958_13_958_18&#39;)"><span class="hl_varref"><span class="mpre">avail</span></span></a><span class="mpre">
            </span><a name="loc_971_13_971_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_971_13_971_17&#39;)"><span class="hl_vardecl"><span class="mpre">ptr&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_956_19_956_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_956_19_956_22&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_958_13_958_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_958_13_958_18&#39;)"><span class="hl_varref"><span class="mpre">avail</span></span></a><span class="mpre">

        if </span><a href="#loc_969_13_969_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_969_13_969_22&#39;)"><span class="hl_varref"><span class="mpre">remaining</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
           then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_970_13_970_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_970_13_970_20&#39;)"><span class="hl_varref"><span class="mpre">so_far&#39;</span></span></a><span class="mpre">
           else </span><a href="#loc_928_1_928_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_928_1_928_15&#39;)"><span class="hl_varref"><span class="mpre">bufReadNBEmpty</span></span></a><span class="mpre"> </span><a href="#loc_954_19_954_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_954_19_954_21&#39;)"><span class="hl_varref"><span class="mpre">h_</span></span></a><span class="mpre"> </span><a href="#loc_967_13_967_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_967_13_967_17&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> </span><a href="#loc_971_13_971_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_971_13_971_17&#39;)"><span class="hl_varref"><span class="mpre">ptr&#39;</span></span></a><span class="mpre"> </span><a href="#loc_970_13_970_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_970_13_970_20&#39;)"><span class="hl_varref"><span class="mpre">so_far&#39;</span></span></a><span class="mpre"> </span><a href="#loc_969_13_969_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_969_13_969_22&#39;)"><span class="hl_varref"><span class="mpre">remaining</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- ---------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- memcpy wrappers</span></span><span class="mpre">

</span><a href="#loc_981_1_981_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_981_1_981_16&#39;)"><span class="mpre">copyToRawBuffer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">RawBuffer</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_981_1_981_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_981_1_981_16&#39;)"><span class="hl_fundecl"><span class="mpre">copyToRawBuffer</span></span></a><span class="mpre"> </span><a name="loc_981_17_981_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_981_17_981_20&#39;)"><span class="hl_vardecl"><span class="mpre">raw</span></span></a><span class="mpre"> </span><a name="loc_981_21_981_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_981_21_981_24&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_981_25_981_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_981_25_981_28&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_981_29_981_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_981_29_981_34&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre"> =
 </span><a href="GHC.IO.Buffer.html#loc_201_1_201_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_201_1_201_14&#39;)"><span class="hl_varref"><span class="mpre">withRawBuffer</span></span></a><span class="mpre"> </span><a href="#loc_981_17_981_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_981_17_981_20&#39;)"><span class="hl_varref"><span class="mpre">raw</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_982_23_982_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_982_23_982_27&#39;)"><span class="hl_vardecl"><span class="mpre">praw</span></span></a><span class="mpre"> -&gt;
   do _ &lt;- </span><span class="hl_varref"><span class="mpre">memcpy</span></span><span class="mpre"> (</span><a href="#loc_982_23_982_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_982_23_982_27&#39;)"><span class="hl_varref"><span class="mpre">praw</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_981_21_981_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_981_21_981_24&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre">) </span><a href="#loc_981_25_981_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_981_25_981_28&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_981_29_981_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_981_29_981_34&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">)
      </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><a href="#loc_987_1_987_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_987_1_987_18&#39;)"><span class="mpre">copyFromRawBuffer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">RawBuffer</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_987_1_987_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_987_1_987_18&#39;)"><span class="hl_fundecl"><span class="mpre">copyFromRawBuffer</span></span></a><span class="mpre"> </span><a name="loc_987_19_987_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_987_19_987_22&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_987_23_987_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_987_23_987_26&#39;)"><span class="hl_vardecl"><span class="mpre">raw</span></span></a><span class="mpre"> </span><a name="loc_987_27_987_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_987_27_987_30&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre"> </span><a name="loc_987_31_987_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_987_31_987_36&#39;)"><span class="hl_vardecl"><span class="mpre">bytes</span></span></a><span class="mpre"> =
 </span><a href="GHC.IO.Buffer.html#loc_201_1_201_14" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Buffer.html#loc_201_1_201_14&#39;)"><span class="hl_varref"><span class="mpre">withRawBuffer</span></span></a><span class="mpre"> </span><a href="#loc_987_23_987_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_987_23_987_26&#39;)"><span class="hl_varref"><span class="mpre">raw</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_988_23_988_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_988_23_988_27&#39;)"><span class="hl_vardecl"><span class="mpre">praw</span></span></a><span class="mpre"> -&gt;
   do _ &lt;- </span><span class="hl_varref"><span class="mpre">memcpy</span></span><span class="mpre"> </span><a href="#loc_987_19_987_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_987_19_987_22&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> (</span><a href="#loc_988_23_988_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_988_23_988_27&#39;)"><span class="hl_varref"><span class="mpre">praw</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_987_27_987_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_987_27_987_30&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_987_31_987_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_987_31_987_36&#39;)"><span class="hl_varref"><span class="mpre">bytes</span></span></a><span class="mpre">)
      </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">

</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 992, srcSpanStartColumn = 1, srcSpanEndLine = 993, srcSpanEndColumn = 52}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = 992, srcSpanStartColumn = 1, srcSpanEndLine = 992, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/GHC/IO/Handle/Text.hs&quot;, srcSpanStartLine = "><span class="mpre">foreign import ccall unsafe &quot;memcpy&quot;
   memcpy :: Ptr a -&gt; Ptr a -&gt; CSize -&gt; IO (Ptr ())</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Internal Utils</span></span><span class="mpre">

</span><a href="#loc_999_1_999_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_999_1_999_18&#39;)"><span class="mpre">illegalBufferSize</span></a><span class="mpre"> :: </span><a href="GHC.IO.Handle.Types.html#loc_100_6_100_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Handle.Types.html#loc_100_6_100_12&#39;)"><span class="hl_tyconref"><span class="mpre">Handle</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_999_1_999_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_999_1_999_18&#39;)"><span class="hl_fundecl"><span class="mpre">illegalBufferSize</span></span></a><span class="mpre"> </span><a name="loc_999_19_999_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_999_19_999_25&#39;)"><span class="hl_vardecl"><span class="mpre">handle</span></span></a><span class="mpre"> </span><a name="loc_999_26_999_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_999_26_999_28&#39;)"><span class="hl_vardecl"><span class="mpre">fn</span></span></a><span class="mpre"> </span><a name="loc_999_29_999_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_999_29_999_31&#39;)"><span class="hl_vardecl"><span class="mpre">sz</span></span></a><span class="mpre"> =
        </span><a href="GHC.IO.Exception.html#loc_217_1_217_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_217_1_217_12&#39;)"><span class="hl_varref"><span class="mpre">ioException</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">IOError</span></span><span class="mpre"> (</span><a href="Data.Maybe.html#loc_49_29_49_33" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_29_49_33&#39;)"><span class="hl_conref"><span class="mpre">Just</span></span></a><span class="mpre"> </span><a href="#loc_999_19_999_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_999_19_999_25&#39;)"><span class="hl_varref"><span class="mpre">handle</span></span></a><span class="mpre">)
                            </span><a href="GHC.IO.Exception.html#loc_272_5_272_20" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_272_5_272_20&#39;)"><span class="hl_conref"><span class="mpre">InvalidArgument</span></span></a><span class="mpre">  </span><a href="#loc_999_26_999_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_999_26_999_28&#39;)"><span class="hl_varref"><span class="mpre">fn</span></span></a><span class="mpre">
                            (</span><span class="hl_string"><span class="mpre">&quot;illegal buffer size &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">showsPrec</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">9</span></span><span class="mpre"> </span><a href="#loc_999_29_999_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_999_29_999_31&#39;)"><span class="hl_varref"><span class="mpre">sz</span></span></a><span class="mpre"> [])
                            </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">)

</span></div></body></html>