<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# OPTIONS_GHC -fno-warn-orphans #-}
{-# LANGUAGE CPP, MagicHash, UnboxedTuples #-}

#if __GLASGOW_HASKELL__ &gt;= 701
{-# LANGUAGE Trustworthy #-}
#endif

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Control.Monad.STM</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow 2004</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD-style (see the file libraries/base/LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  libraries@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (requires STM)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Software Transactional Memory: a modular composable concurrency</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- abstraction.  See</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * /Composable memory transactions/, by Tim Harris, Simon Marlow, Simon</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    Peyton Jones, and Maurice Herlihy, in /ACM Conference on Principles</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    and Practice of Parallel Programming/ 2005.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &lt;http://research.microsoft.com/Users/simonpj/papers/stm/index.htm&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This module only defines the &#39;STM&#39; monad; you probably want to </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- import &quot;Control.Concurrent.STM&quot; (which exports &quot;Control.Monad.STM&quot;).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module Control.Monad.STM (
          STM,
        atomically,
#ifdef __GLASGOW_HASKELL__
        always,
        alwaysSucceeds,
        retry,
        orElse,
        check,
#endif
        throwSTM,
        catchSTM
  ) where

#ifdef __GLASGOW_HASKELL__
#if ! (MIN_VERSION_base(4,3,0))
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Monad/STM.hs&quot;, srcSpanStartLine = 46, srcSpanStartColumn = 8, srcSpanEndLine = 46, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Conc&quot;"><span class="mpre">GHC.Conc</span></span><span class="mpre"> hiding (catchSTM)
import Control.Monad    ( </span><a href="Control.Monad.html#loc_122_18_122_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_122_18_122_27&#39;)"><span class="mpre">MonadPlus</span></a><span class="mpre">(..) )
import Control.Exception
#else
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Monad/STM.hs&quot;, srcSpanStartLine = 50, srcSpanStartColumn = 8, srcSpanEndLine = 50, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Conc&quot;"><span class="mpre">GHC.Conc</span></span><span class="mpre">
#endif
import GHC.Exts
import Control.Monad.Fix
#else
import Control.Sequential.STM
#endif

#ifdef __GLASGOW_HASKELL__
#if ! (MIN_VERSION_base(4,3,0))
import Control.Applicative
import Control.Monad (</span><a href="Control.Monad.html#loc_312_1_312_3" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_312_1_312_3&#39;)"><span class="mpre">ap</span></a><span class="mpre">)
#endif
#endif


#ifdef __GLASGOW_HASKELL__
#if ! (MIN_VERSION_base(4,3,0))
instance </span><a href="Control.Monad.html#loc_122_18_122_27" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_122_18_122_27&#39;)"><span class="hl_classref"><span class="mpre">MonadPlus</span></span></a><span class="mpre"> </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">STM</span></span></a><span class="mpre"> where
  </span><a href="Control.Monad.html#loc_128_4_128_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_128_4_128_9&#39;)"><span class="hl_vardecl"><span class="mpre">mzero</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">retry</span></span><span class="mpre">
  </span><a href="Control.Monad.html#loc_130_4_130_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_130_4_130_9&#39;)"><span class="hl_vardecl"><span class="mpre">mplus</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">orElse</span></span><span class="mpre">

instance </span><a href="Control.Applicative.html#loc_113_20_113_31" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_113_20_113_31&#39;)"><span class="hl_classref"><span class="mpre">Applicative</span></span></a><span class="mpre"> </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">STM</span></span></a><span class="mpre"> where
  </span><a href="Control.Applicative.html#loc_115_5_115_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_115_5_115_9&#39;)"><span class="hl_vardecl"><span class="mpre">pure</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre">
  </span><a href="Control.Applicative.html#loc_118_5_118_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_118_5_118_10&#39;)"><span class="hl_vardecl"><span class="mpre">(&lt;*&gt;)</span></span></a><span class="mpre"> = </span><a href="Control.Monad.html#loc_312_1_312_3" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_312_1_312_3&#39;)"><span class="hl_varref"><span class="mpre">ap</span></span></a><span class="mpre">

instance </span><a href="Control.Applicative.html#loc_138_24_138_35" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_138_24_138_35&#39;)"><span class="hl_classref"><span class="mpre">Alternative</span></span></a><span class="mpre"> </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">STM</span></span></a><span class="mpre"> where
  </span><a href="Control.Applicative.html#loc_140_5_140_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_140_5_140_10&#39;)"><span class="hl_vardecl"><span class="mpre">empty</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">retry</span></span><span class="mpre">
  </span><a href="Control.Applicative.html#loc_142_5_142_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Applicative.html#loc_142_5_142_10&#39;)"><span class="hl_vardecl"><span class="mpre">(&lt;|&gt;)</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">orElse</span></span><span class="mpre">
#endif

</span><a href="#loc_82_1_82_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_1_82_6&#39;)"><span class="mpre">check</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">STM</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_82_1_82_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_1_82_6&#39;)"><span class="hl_fundecl"><span class="mpre">check</span></span></a><span class="mpre"> </span><a name="loc_82_7_82_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_7_82_8&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = if </span><a href="#loc_82_7_82_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_82_7_82_8&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> then </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> else </span><span class="hl_varref"><span class="mpre">retry</span></span><span class="mpre">
#endif

#if ! (MIN_VERSION_base(4,3,0))
</span><span class="hl_comment"><span class="mpre">-- |Exception handling within STM actions.</span></span><span class="mpre">
</span><a href="#loc_88_1_88_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_9&#39;)"><span class="mpre">catchSTM</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Monad/STM.hs&quot;, srcSpanStartLine = 87, srcSpanStartColumn = 13, srcSpanEndLine = 87, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Monad/STM.hs&quot;, srcSpanStartLine = 87, srcSpanStartColumn = 25, srcSpanEndLine = 87, srcSpanEndColumn = 27}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Monad/"><span class="mpre">Exception e =&gt;</span></span><span class="mpre"> </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">STM</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">STM</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">STM</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_88_1_88_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_1_88_9&#39;)"><span class="hl_fundecl"><span class="mpre">catchSTM</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">STM</span></span><span class="mpre"> </span><a name="loc_88_15_88_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_15_88_16&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) </span><a name="loc_88_18_88_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_18_88_25&#39;)"><span class="hl_vardecl"><span class="mpre">handler</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.Prim.html#loc_2542_1_2542_10" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2542_1_2542_10&#39;)"><span class="hl_varref"><span class="mpre">catchSTM#</span></span></a><span class="mpre"> </span><a href="#loc_88_15_88_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_15_88_16&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_90_7_90_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_7_90_15&#39;)"><span class="hl_varref"><span class="mpre">handler&#39;</span></span></a><span class="mpre">
    where
      </span><a name="loc_90_7_90_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_7_90_15&#39;)"><span class="hl_fundecl"><span class="mpre">handler&#39;</span></span></a><span class="mpre"> </span><a name="loc_90_16_90_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_16_90_17&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> = case </span><span class="hl_varref"><span class="mpre">fromException</span></span><span class="mpre"> </span><a href="#loc_90_16_90_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_16_90_17&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre"> of
                     </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_91_27_91_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_27_91_29&#39;)"><span class="hl_vardecl"><span class="mpre">e&#39;</span></span></a><span class="mpre"> -&gt; case </span><a href="#loc_88_18_88_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_88_18_88_25&#39;)"><span class="hl_varref"><span class="mpre">handler</span></span></a><span class="mpre"> </span><a href="#loc_91_27_91_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_27_91_29&#39;)"><span class="hl_varref"><span class="mpre">e&#39;</span></span></a><span class="mpre"> of </span><span class="hl_conref"><span class="mpre">STM</span></span><span class="mpre"> </span><a name="loc_91_56_91_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_56_91_58&#39;)"><span class="hl_vardecl"><span class="mpre">m&#39;</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_91_56_91_58" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_91_56_91_58&#39;)"><span class="hl_varref"><span class="mpre">m&#39;</span></span></a><span class="mpre">
                     </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><a href="GHC.Prim.html#loc_2516_1_2516_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2516_1_2516_9&#39;)"><span class="hl_varref"><span class="mpre">raiseIO#</span></span></a><span class="mpre"> </span><a href="#loc_90_16_90_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_16_90_17&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A variant of &#39;throw&#39; that can only be used within the &#39;STM&#39; monad.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Throwing an exception in @STM@ aborts the transaction and propagates the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exception.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Although &#39;throwSTM&#39; has a type that is an instance of the type of &#39;throw&#39;, the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- two functions are subtly different:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; throw e    `seq` x  ===&gt; throw e</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; throwSTM e `seq` x  ===&gt; x</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The first example will cause the exception @e@ to be raised,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- whereas the second one won\&#39;t.  In fact, &#39;throwSTM&#39; will only cause</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- an exception to be raised when it is used within the &#39;STM&#39; monad.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The &#39;throwSTM&#39; variant should be used in preference to &#39;throw&#39; to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- raise an exception within the &#39;STM&#39; monad because it guarantees</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ordering with respect to other &#39;STM&#39; operations, whereas &#39;throw&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- does not.</span></span><span class="mpre">
</span><a href="#loc_113_1_113_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_1_113_9&#39;)"><span class="mpre">throwSTM</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Monad/STM.hs&quot;, srcSpanStartLine = 112, srcSpanStartColumn = 13, srcSpanEndLine = 112, srcSpanEndColumn = 27}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Monad/STM.hs&quot;, srcSpanStartLine = 112, srcSpanStartColumn = 25, srcSpanEndLine = 112, srcSpanEndColumn = 27}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Mo"><span class="mpre">Exception e =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">e</span></span><span class="mpre"> -&gt; </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">STM</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_113_1_113_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_1_113_9&#39;)"><span class="hl_fundecl"><span class="mpre">throwSTM</span></span></a><span class="mpre"> </span><a name="loc_113_10_113_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_10_113_11&#39;)"><span class="hl_vardecl"><span class="mpre">e</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="GHC.Prim.html#loc_2516_1_2516_9" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2516_1_2516_9&#39;)"><span class="hl_varref"><span class="mpre">raiseIO#</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">toException</span></span><span class="mpre"> </span><a href="#loc_113_10_113_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_10_113_11&#39;)"><span class="hl_varref"><span class="mpre">e</span></span></a><span class="mpre">)
#endif


data </span><a name="loc_117_6_117_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_6_117_12&#39;)"><span class="hl_tycondecl"><span class="mpre">STMret</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_117_17_117_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_17_117_23&#39;)"><span class="hl_condecl"><span class="mpre">STMret</span></span></a><span class="mpre"> (</span><a href="GHC.Prim.html#loc_2647_6_2647_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2647_6_2647_12&#39;)"><span class="hl_tyconref"><span class="mpre">State#</span></span></a><span class="mpre"> </span><a href="GHC.Prim.html#loc_2653_6_2653_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2653_6_2653_15&#39;)"><span class="hl_tyconref"><span class="mpre">RealWorld</span></span></a><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">

</span><a href="#loc_120_1_120_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_1_120_8&#39;)"><span class="mpre">liftSTM</span></a><span class="mpre"> :: </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">STM</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="GHC.Prim.html#loc_2647_6_2647_12" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2647_6_2647_12&#39;)"><span class="hl_tyconref"><span class="mpre">State#</span></span></a><span class="mpre"> </span><a href="GHC.Prim.html#loc_2653_6_2653_15" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.Prim.html#loc_2653_6_2653_15&#39;)"><span class="hl_tyconref"><span class="mpre">RealWorld</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_117_6_117_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_6_117_12&#39;)"><span class="hl_tyconref"><span class="mpre">STMret</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_120_1_120_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_1_120_8&#39;)"><span class="hl_fundecl"><span class="mpre">liftSTM</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">STM</span></span><span class="mpre"> </span><a name="loc_120_14_120_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_14_120_15&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre">) = \</span><a name="loc_120_20_120_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_20_120_21&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt; case </span><a href="#loc_120_14_120_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_14_120_15&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><a href="#loc_120_20_120_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_20_120_21&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre"> of (# </span><a name="loc_120_40_120_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_40_120_42&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a name="loc_120_44_120_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_44_120_45&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> #) -&gt; </span><a href="#loc_117_17_117_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_17_117_23&#39;)"><span class="hl_conref"><span class="mpre">STMret</span></span></a><span class="mpre"> </span><a href="#loc_120_40_120_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_40_120_42&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre"> </span><a href="#loc_120_44_120_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_44_120_45&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">

instance </span><a href="Control.Monad.Fix.html#loc_48_20_48_28" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Fix.html#loc_48_20_48_28&#39;)"><span class="hl_classref"><span class="mpre">MonadFix</span></span></a><span class="mpre"> </span><a href="Control.Sequential.STM.html#loc_25_9_25_12" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Sequential.STM.html#loc_25_9_25_12&#39;)"><span class="hl_tyconref"><span class="mpre">STM</span></span></a><span class="mpre"> where
  </span><a href="Control.Monad.Fix.html#loc_53_9_53_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.Fix.html#loc_53_9_53_13&#39;)"><span class="hl_fundecl"><span class="mpre">mfix</span></span></a><span class="mpre"> </span><a name="loc_123_8_123_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_8_123_9&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_123_19_123_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_19_123_20&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> -&gt;
    let </span><a name="loc_124_9_124_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_9_124_12&#39;)"><span class="hl_vardecl"><span class="mpre">ans</span></span></a><span class="mpre">        = </span><a href="#loc_120_1_120_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_1_120_8&#39;)"><span class="hl_varref"><span class="mpre">liftSTM</span></span></a><span class="mpre"> (</span><a href="#loc_123_8_123_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_8_123_9&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_125_18_125_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_18_125_19&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre">) </span><a href="#loc_123_19_123_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_19_123_20&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
        </span><a href="#loc_117_17_117_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_17_117_23&#39;)"><span class="hl_conref"><span class="mpre">STMret</span></span></a><span class="mpre"> _ </span><a name="loc_125_18_125_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_18_125_19&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> = </span><a href="#loc_124_9_124_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_9_124_12&#39;)"><span class="hl_varref"><span class="mpre">ans</span></span></a><span class="mpre">
    in case </span><a href="#loc_124_9_124_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_9_124_12&#39;)"><span class="hl_varref"><span class="mpre">ans</span></span></a><span class="mpre"> of </span><a href="#loc_117_17_117_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_17_117_23&#39;)"><span class="hl_conref"><span class="mpre">STMret</span></span></a><span class="mpre"> </span><a name="loc_126_27_126_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_27_126_29&#39;)"><span class="hl_vardecl"><span class="mpre">s&#39;</span></span></a><span class="mpre"> </span><a name="loc_126_30_126_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_30_126_31&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; (# </span><a href="#loc_126_27_126_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_27_126_29&#39;)"><span class="hl_varref"><span class="mpre">s&#39;</span></span></a><span class="mpre">, </span><a href="#loc_126_30_126_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_30_126_31&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> #)
</span></div></body></html>