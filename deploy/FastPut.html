<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE CPP, BangPatterns, Rank2Types #-}
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      : FastPut</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   : (c) 2010 Simon Meier</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     : BSD3-style (see LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  : Simon Meier &lt;iridcode@gmail.com&gt;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   : experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability : tested on GHC only</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Implementation of a &#39;Put&#39; monad with similar performance characteristics</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- like the &#39;Builder&#39; monoid.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module FastPut where

import Foreign
import Data.Monoid
import Control.Monad (</span><a href="Control.Monad.html#loc_270_1_270_7" onmouseover="nemnem.highlightLocalToRemote(&#39;Control.Monad.html#loc_270_1_270_7&#39;)"><span class="mpre">unless</span></a><span class="mpre">)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/FastPut.hs&quot;, srcSpanStartLine = 19, srcSpanStartColumn = 18, srcSpanEndLine = 19, srcSpanEndColumn = 33}, srcInfoPoints = []}) &quot;Data.ByteString&quot;"><span class="mpre">Data.ByteString</span></span><span class="mpre">      as S
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/FastPut.hs&quot;, srcSpanStartLine = 20, srcSpanStartColumn = 18, srcSpanEndLine = 20, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy&quot;"><span class="mpre">Data.ByteString.Lazy</span></span><span class="mpre"> as L

#ifdef BYTESTRING_IN_BASE
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/FastPut.hs&quot;, srcSpanStartLine = 23, srcSpanStartColumn = 8, srcSpanEndLine = 23, srcSpanEndColumn = 28}, srcInfoPoints = []}) &quot;Data.ByteString.Base&quot;"><span class="mpre">Data.ByteString.Base</span></span><span class="mpre"> (inlinePerformIO)
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/FastPut.hs&quot;, srcSpanStartLine = 24, srcSpanStartColumn = 18, srcSpanEndLine = 24, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Data.ByteString.Base&quot;"><span class="mpre">Data.ByteString.Base</span></span><span class="mpre"> as S
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/FastPut.hs&quot;, srcSpanStartLine = 25, srcSpanStartColumn = 18, srcSpanEndLine = 25, srcSpanEndColumn = 43}, srcInfoPoints = []}) &quot;Data.ByteString.Lazy.Base&quot;"><span class="mpre">Data.ByteString.Lazy.Base</span></span><span class="mpre"> as L </span><span class="hl_comment"><span class="mpre">-- FIXME: is this the right module for access to &#39;Chunks&#39;?</span></span><span class="mpre">
#else
import Data.ByteString.Internal (</span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="mpre">inlinePerformIO</span></a><span class="mpre">)
import qualified Data.ByteString.Internal as S
import qualified Data.ByteString.Lazy.Internal as L
#endif

import qualified Blaze.ByteString.Builder.Internal as B
import qualified </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/FastPut.hs&quot;, srcSpanStartLine = 33, srcSpanStartColumn = 18, srcSpanEndLine = 33, srcSpanEndColumn = 48}, srcInfoPoints = []}) &quot;Blaze.ByteString.Builder.Write&quot;"><span class="mpre">Blaze.ByteString.Builder.Write</span></span><span class="mpre">    as B
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/FastPut.hs&quot;, srcSpanStartLine = 34, srcSpanStartColumn = 8, srcSpanEndLine = 34, srcSpanEndColumn = 38}, srcInfoPoints = []}) &quot;Blaze.ByteString.Builder.Write&quot;"><span class="mpre">Blaze.ByteString.Builder.Write</span></span><span class="mpre"> (Write(..))
import qualified Blaze.ByteString.Builder.Word     as B
import Blaze.ByteString.Builder.Word (</span><a href="Blaze.ByteString.Builder.Word.html#loc_117_1_117_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Word.html#loc_117_1_117_11&#39;)"><span class="mpre">writeWord8</span></a><span class="mpre">)

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/FastPut.hs&quot;, srcSpanStartLine = 38, srcSpanStartColumn = 8, srcSpanEndLine = 38, srcSpanEndColumn = 22}, srcInfoPoints = []}) &quot;Criterion.Main&quot;"><span class="mpre">Criterion.Main</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Benchmarks</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_45_1_45_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_5&#39;)"><span class="mpre">main</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_45_1_45_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_45_1_45_5&#39;)"><span class="hl_vardecl"><span class="mpre">main</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">defaultMain</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">concat</span></span><span class="mpre">
    [ </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;cost of putBuilder&quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">whnf</span></span><span class="mpre">
        (</span><span class="hl_varref"><span class="mpre">L.length</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_605_1_605_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_1_605_18&#39;)"><span class="hl_varref"><span class="mpre">toLazyByteString2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">mapM_</span></span><span class="mpre">  (</span><a href="#loc_120_1_120_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_1_120_12&#39;)"><span class="hl_varref"><span class="mpre">fromBuilder</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_154_1_154_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_10&#39;)"><span class="hl_varref"><span class="mpre">fromWord8</span></span></a><span class="mpre">))
        </span><a href="#loc_71_1_71_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_7&#39;)"><span class="hl_varref"><span class="mpre">word8s</span></span></a><span class="mpre">
    , </span><a href="#loc_63_5_63_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_14&#39;)"><span class="hl_varref"><span class="mpre">benchmark</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;putBuilder&quot;</span></span><span class="mpre">
        (</span><a href="#loc_120_1_120_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_1_120_12&#39;)"><span class="hl_varref"><span class="mpre">fromBuilder</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="#loc_154_1_154_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_10&#39;)"><span class="hl_varref"><span class="mpre">fromWord8</span></span></a><span class="mpre">)
        (</span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Word.html#loc_269_1_269_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Word.html#loc_269_1_269_10&#39;)"><span class="hl_varref"><span class="mpre">B.fromWord8</span></span></a><span class="mpre">)
        </span><a href="#loc_71_1_71_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_7&#39;)"><span class="hl_varref"><span class="mpre">word8s</span></span></a><span class="mpre">
    , </span><a href="#loc_63_5_63_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_14&#39;)"><span class="hl_varref"><span class="mpre">benchmark</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;fromWriteSingleton&quot;</span></span><span class="mpre">
        (</span><span class="hl_varref"><span class="mpre">mapM_</span></span><span class="mpre"> </span><a href="#loc_162_1_162_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_1_162_9&#39;)"><span class="hl_varref"><span class="mpre">putWord8</span></span></a><span class="mpre">)
        (</span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Word.html#loc_269_1_269_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Word.html#loc_269_1_269_10&#39;)"><span class="hl_varref"><span class="mpre">B.fromWord8</span></span></a><span class="mpre">)
        </span><a href="#loc_71_1_71_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_7&#39;)"><span class="hl_varref"><span class="mpre">word8s</span></span></a><span class="mpre">
    , </span><a href="#loc_63_5_63_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_14&#39;)"><span class="hl_varref"><span class="mpre">benchmark</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;fromWrite&quot;</span></span><span class="mpre">
        (</span><span class="hl_varref"><span class="mpre">mapM_</span></span><span class="mpre"> (</span><a href="#loc_165_1_165_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_9&#39;)"><span class="hl_varref"><span class="mpre">putWrite</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Word.html#loc_117_1_117_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Word.html#loc_117_1_117_11&#39;)"><span class="hl_varref"><span class="mpre">writeWord8</span></span></a><span class="mpre">))
        (</span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> (</span><a href="Blaze.ByteString.Builder.Internal.Write.html#loc_221_1_221_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Write.html#loc_221_1_221_10&#39;)"><span class="hl_varref"><span class="mpre">B.fromWrite</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Word.html#loc_117_1_117_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Word.html#loc_117_1_117_11&#39;)"><span class="hl_varref"><span class="mpre">writeWord8</span></span></a><span class="mpre">))
        </span><a href="#loc_71_1_71_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_7&#39;)"><span class="hl_varref"><span class="mpre">word8s</span></span></a><span class="mpre">
    ]
  where
    </span><a name="loc_63_5_63_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_5_63_14&#39;)"><span class="hl_fundecl"><span class="mpre">benchmark</span></span></a><span class="mpre"> </span><a name="loc_63_15_63_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_15_63_19&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre"> </span><a name="loc_63_20_63_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_20_63_24&#39;)"><span class="hl_vardecl"><span class="mpre">putF</span></span></a><span class="mpre"> </span><a name="loc_63_25_63_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_25_63_33&#39;)"><span class="hl_vardecl"><span class="mpre">builderF</span></span></a><span class="mpre"> </span><a name="loc_63_34_63_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_34_63_35&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> =
        [ </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> (</span><a href="#loc_63_15_63_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_15_63_19&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; Put&quot;</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">whnf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">L.length</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_605_1_605_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_1_605_18&#39;)"><span class="hl_varref"><span class="mpre">toLazyByteString2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_63_20_63_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_20_63_24&#39;)"><span class="hl_varref"><span class="mpre">putF</span></span></a><span class="mpre">) </span><a href="#loc_63_34_63_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_34_63_35&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
        , </span><span class="hl_varref"><span class="mpre">bench</span></span><span class="mpre"> (</span><a href="#loc_63_15_63_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_15_63_19&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot; Builder&quot;</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
            </span><span class="hl_varref"><span class="mpre">whnf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">L.length</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.html#loc_269_1_269_17&#39;)"><span class="hl_varref"><span class="mpre">B.toLazyByteString</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_63_25_63_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_25_63_33&#39;)"><span class="hl_varref"><span class="mpre">builderF</span></span></a><span class="mpre">) </span><a href="#loc_63_34_63_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_34_63_35&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
        ]

</span><a href="#loc_71_1_71_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_7&#39;)"><span class="mpre">word8s</span></a><span class="mpre"> :: [</span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">]
</span><a name="loc_71_1_71_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_7&#39;)"><span class="hl_vardecl"><span class="mpre">word8s</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">take</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">100000</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">cycle</span></span><span class="mpre"> </span><span class="warning" data-warning="ExpEnumFrom (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/FastPut.hs&quot;, srcSpanStartLine = 71, srcSpanStartColumn = 30, srcSpanEndLine = 71, srcSpanEndColumn = 35}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/FastPut.hs&quot;, srcSpanStartLine = 71, srcSpanStartColumn = 30, srcSpanEndLine = 71, srcSpanEndColumn = 31},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/Fast"><span class="mpre">[0..]</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# NOINLINE </span><a href="#loc_71_1_71_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_7&#39;)"><span class="mpre">word8s</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The Put type</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">

data </span><a name="loc_78_6_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_6_78_14&#39;)"><span class="hl_tycondecl"><span class="mpre">BufRange</span></span></a><span class="mpre"> = </span><a name="loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_condecl"><span class="mpre">BufRange</span></span></a><span class="mpre"> {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">) {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)

newtype </span><a name="loc_80_9_80_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_12&#39;)"><span class="hl_tycondecl"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_80_17_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_17_80_20&#39;)"><span class="hl_condecl"><span class="mpre">Put</span></span></a><span class="mpre"> {
    </span><a name="loc_81_5_81_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_5_81_10&#39;)"><span class="hl_fielddecl"><span class="mpre">unPut</span></span></a><span class="mpre"> :: forall </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">. (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">
  }

data </span><a name="loc_84_6_84_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_6_84_15&#39;)"><span class="hl_tycondecl"><span class="mpre">PutSignal</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> =
    </span><a name="loc_85_5_85_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_5_85_9&#39;)"><span class="hl_condecl"><span class="mpre">Done</span></span></a><span class="mpre"> {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">) </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
  | </span><a name="loc_86_5_86_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_15&#39;)"><span class="hl_condecl"><span class="mpre">BufferFull</span></span></a><span class="mpre">
      {-# UNPACK #-} !</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
      {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)
                     !(</span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
  | </span><a name="loc_90_5_90_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_21&#39;)"><span class="hl_condecl"><span class="mpre">InsertByteString</span></span></a><span class="mpre">
      {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">) 
                     !</span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">S.ByteString</span></span></a><span class="mpre">
                     !(</span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)

</span><span class="warning" data-warning="DeclTypeDecl (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/FastPut.hs&quot;, srcSpanStartLine = 95, srcSpanStartColumn = 1, srcSpanEndLine = 95, srcSpanEndColumn = 47}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/FastPut.hs&quot;, srcSpanStartLine = 95, srcSpanStartColumn = 1, srcSpanEndLine = 95, srcSpanEndColumn = 5},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/FastPut"><span class="mpre">type PutStep a =  BufRange -&gt; IO (PutSignal a)</span></span><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Monad</span></span><span class="mpre"> </span><a href="#loc_80_9_80_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> where
  </span><span class="hl_fundecl"><span class="mpre">return</span></span><span class="mpre"> </span><a name="loc_98_10_98_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_10_98_11&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="#loc_80_17_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_17_80_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_98_21_98_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_21_98_22&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_98_21_98_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_21_98_22&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_98_10_98_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_98_10_98_11&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
  </span><span class="hl_pragma"><span class="mpre">{-# INLINE return #-}</span></span><span class="mpre">
  </span><a name="loc_100_3_100_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_3_100_4&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_fundecl"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a name="loc_100_9_100_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_9_100_10&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre">  = </span><a href="#loc_80_17_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_17_80_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_100_21_100_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_21_100_22&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_81_5_81_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_5_81_10&#39;)"><span class="hl_varref"><span class="mpre">unPut</span></span></a><span class="mpre"> </span><a href="#loc_100_3_100_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_3_100_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> (\</span><a name="loc_100_36_100_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_36_100_37&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_81_5_81_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_5_81_10&#39;)"><span class="hl_varref"><span class="mpre">unPut</span></span></a><span class="mpre"> (</span><a href="#loc_100_9_100_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_9_100_10&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_100_36_100_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_36_100_37&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">) </span><a href="#loc_100_21_100_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_21_100_22&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)
  </span><span class="hl_pragma"><span class="mpre">{-# INLINE (&gt;&gt;=) #-}</span></span><span class="mpre">
  </span><a name="loc_102_3_102_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_3_102_4&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_fundecl"><span class="mpre">&gt;&gt;</span></span><span class="mpre">  </span><a name="loc_102_9_102_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_9_102_10&#39;)"><span class="hl_vardecl"><span class="mpre">n</span></span></a><span class="mpre">  = </span><a href="#loc_80_17_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_17_80_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_102_21_102_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_21_102_22&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_81_5_81_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_5_81_10&#39;)"><span class="hl_varref"><span class="mpre">unPut</span></span></a><span class="mpre"> </span><a href="#loc_102_3_102_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_3_102_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> (\_ -&gt; </span><a href="#loc_81_5_81_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_81_5_81_10&#39;)"><span class="hl_varref"><span class="mpre">unPut</span></span></a><span class="mpre"> </span><a href="#loc_102_9_102_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_9_102_10&#39;)"><span class="hl_varref"><span class="mpre">n</span></span></a><span class="mpre"> </span><a href="#loc_102_21_102_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_21_102_22&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)
  </span><span class="hl_pragma"><span class="mpre">{-# INLINE (&gt;&gt;) #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The Builder type with equal signals as the Put type</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">

newtype </span><a name="loc_109_9_109_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_9_109_16&#39;)"><span class="hl_tycondecl"><span class="mpre">Builder</span></span></a><span class="mpre"> = </span><a name="loc_109_19_109_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_19_109_26&#39;)"><span class="hl_condecl"><span class="mpre">Builder</span></span></a><span class="mpre"> (forall </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">. </span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">r</span></span><span class="mpre">)

instance </span><a href="Data.Monoid.html#loc_79_7_79_13" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_79_7_79_13&#39;)"><span class="hl_classref"><span class="mpre">Monoid</span></span></a><span class="mpre"> </span><a href="#loc_109_9_109_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_9_109_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre"> where
  </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_vardecl"><span class="mpre">mempty</span></span></a><span class="mpre"> = </span><a href="#loc_109_19_109_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_19_109_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">
  </span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="mpre">mempty</span></a><span class="mpre"> #-}</span></span><span class="mpre">
  (</span><a href="#loc_109_19_109_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_19_109_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><a name="loc_114_12_114_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_12_114_14&#39;)"><span class="hl_vardecl"><span class="mpre">b1</span></span></a><span class="mpre">) </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_fundecl"><span class="mpre">`mappend`</span></span></a><span class="mpre"> (</span><a href="#loc_109_19_109_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_19_109_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><a name="loc_114_35_114_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_35_114_37&#39;)"><span class="hl_vardecl"><span class="mpre">b2</span></span></a><span class="mpre">) = </span><a href="#loc_109_19_109_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_19_109_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_114_12_114_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_12_114_14&#39;)"><span class="hl_varref"><span class="mpre">b1</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_114_35_114_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_35_114_37&#39;)"><span class="hl_varref"><span class="mpre">b2</span></span></a><span class="mpre">
  </span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="mpre">mappend</span></a><span class="mpre"> #-}</span></span><span class="mpre">
  </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_vardecl"><span class="mpre">mconcat</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">foldr</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_82_9_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_82_9_82_16&#39;)"><span class="hl_varref"><span class="mpre">mappend</span></span></a><span class="mpre"> </span><a href="Data.Monoid.html#loc_80_9_80_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_80_9_80_15&#39;)"><span class="hl_varref"><span class="mpre">mempty</span></span></a><span class="mpre">
  </span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="mpre">mconcat</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_120_1_120_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_1_120_12&#39;)"><span class="mpre">fromBuilder</span></a><span class="mpre"> :: </span><a href="#loc_109_9_109_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_9_109_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_80_9_80_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_120_1_120_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_1_120_12&#39;)"><span class="hl_fundecl"><span class="mpre">fromBuilder</span></span></a><span class="mpre"> (</span><a href="#loc_109_19_109_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_19_109_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><a name="loc_120_22_120_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_22_120_27&#39;)"><span class="hl_vardecl"><span class="mpre">build</span></span></a><span class="mpre">) = </span><a href="#loc_80_17_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_17_80_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_120_38_120_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_38_120_39&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_120_22_120_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_22_120_27&#39;)"><span class="hl_varref"><span class="mpre">build</span></span></a><span class="mpre"> (</span><a href="#loc_120_38_120_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_38_120_39&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">)

</span><a href="#loc_123_1_123_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_10&#39;)"><span class="mpre">toBuilder</span></a><span class="mpre"> :: </span><a href="#loc_80_9_80_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><a href="#loc_109_9_109_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_9_109_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_123_1_123_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_1_123_10&#39;)"><span class="hl_fundecl"><span class="mpre">toBuilder</span></span></a><span class="mpre"> (</span><a href="#loc_80_17_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_17_80_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><a name="loc_123_16_123_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_16_123_19&#39;)"><span class="hl_vardecl"><span class="mpre">put</span></span></a><span class="mpre">) = </span><a href="#loc_109_19_109_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_19_109_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_123_34_123_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_34_123_35&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_123_16_123_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_16_123_19&#39;)"><span class="hl_varref"><span class="mpre">put</span></span></a><span class="mpre"> (\_ -&gt; </span><a href="#loc_123_34_123_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_34_123_35&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)

</span><a href="#loc_126_1_126_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_10&#39;)"><span class="mpre">fromWrite</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Write</span></span><span class="mpre"> -&gt; </span><a href="#loc_109_9_109_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_9_109_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_126_1_126_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_10&#39;)"><span class="hl_fundecl"><span class="mpre">fromWrite</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Write</span></span><span class="mpre"> </span><a name="loc_126_18_126_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_18_126_22&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> </span><a name="loc_126_23_126_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_23_126_25&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre">) =
    </span><a href="#loc_109_19_109_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_19_109_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><a href="#loc_129_5_129_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_5_129_9&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre">
  where
    </span><a name="loc_129_5_129_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_5_129_9&#39;)"><span class="hl_fundecl"><span class="mpre">step</span></span></a><span class="mpre"> </span><a name="loc_129_10_129_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_10_129_11&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> (</span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_129_22_129_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_22_129_24&#39;)"><span class="hl_vardecl"><span class="mpre">pf</span></span></a><span class="mpre"> </span><a name="loc_129_25_129_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_25_129_27&#39;)"><span class="hl_vardecl"><span class="mpre">pe</span></span></a><span class="mpre">)
      | </span><a href="#loc_129_22_129_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_22_129_24&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_126_18_126_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_18_126_22&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><a href="#loc_129_25_129_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_25_129_27&#39;)"><span class="hl_varref"><span class="mpre">pe</span></span></a><span class="mpre"> = do
          </span><a href="#loc_126_23_126_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_23_126_25&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_129_22_129_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_22_129_24&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre">
          let !</span><a name="loc_132_16_132_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_16_132_19&#39;)"><span class="hl_vardecl"><span class="mpre">br&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> (</span><a href="#loc_129_22_129_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_22_129_24&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_126_18_126_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_18_126_22&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">) </span><a href="#loc_129_25_129_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_25_129_27&#39;)"><span class="hl_varref"><span class="mpre">pe</span></span></a><span class="mpre">
          </span><a href="#loc_129_10_129_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_10_129_11&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_132_16_132_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_16_132_19&#39;)"><span class="hl_varref"><span class="mpre">br&#39;</span></span></a><span class="mpre">
      | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_86_5_86_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_15&#39;)"><span class="hl_conref"><span class="mpre">BufferFull</span></span></a><span class="mpre"> </span><a href="#loc_126_18_126_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_18_126_22&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_129_22_129_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_22_129_24&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> (</span><a href="#loc_129_5_129_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_5_129_9&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_129_10_129_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_129_10_129_11&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_126_1_126_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_1_126_10&#39;)"><span class="mpre">fromWrite</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_138_1_138_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_19&#39;)"><span class="mpre">fromWriteSingleton</span></a><span class="mpre"> :: (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Write</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_109_9_109_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_9_109_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_138_1_138_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_19&#39;)"><span class="hl_fundecl"><span class="mpre">fromWriteSingleton</span></span></a><span class="mpre"> </span><a name="loc_138_20_138_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_20_138_25&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre"> = 
    </span><a href="#loc_141_5_141_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_5_141_10&#39;)"><span class="hl_varref"><span class="mpre">mkPut</span></span></a><span class="mpre">
  where
    </span><a name="loc_141_5_141_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_5_141_10&#39;)"><span class="hl_fundecl"><span class="mpre">mkPut</span></span></a><span class="mpre"> </span><a name="loc_141_11_141_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_11_141_12&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="#loc_109_19_109_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_19_109_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><a href="#loc_143_9_143_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_9_143_13&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre">
      where
        </span><a name="loc_143_9_143_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_9_143_13&#39;)"><span class="hl_fundecl"><span class="mpre">step</span></span></a><span class="mpre"> </span><a name="loc_143_14_143_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_14_143_15&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> (</span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_143_26_143_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_26_143_28&#39;)"><span class="hl_vardecl"><span class="mpre">pf</span></span></a><span class="mpre"> </span><a name="loc_143_29_143_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_29_143_31&#39;)"><span class="hl_vardecl"><span class="mpre">pe</span></span></a><span class="mpre">)
          | </span><a href="#loc_143_26_143_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_26_143_28&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_150_19_150_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_19_150_23&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><a href="#loc_143_29_143_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_29_143_31&#39;)"><span class="hl_varref"><span class="mpre">pe</span></span></a><span class="mpre"> = do
              </span><a href="#loc_150_24_150_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_24_150_26&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_143_26_143_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_26_143_28&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre">
              let !</span><a name="loc_146_20_146_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_20_146_23&#39;)"><span class="hl_vardecl"><span class="mpre">br&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> (</span><a href="#loc_143_26_143_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_26_143_28&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_150_19_150_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_19_150_23&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">) </span><a href="#loc_143_29_143_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_29_143_31&#39;)"><span class="hl_varref"><span class="mpre">pe</span></span></a><span class="mpre">
              </span><a href="#loc_143_14_143_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_14_143_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_146_20_146_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_20_146_23&#39;)"><span class="hl_varref"><span class="mpre">br&#39;</span></span></a><span class="mpre">
          | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">               = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_86_5_86_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_15&#39;)"><span class="hl_conref"><span class="mpre">BufferFull</span></span></a><span class="mpre"> </span><a href="#loc_150_19_150_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_19_150_23&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_143_26_143_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_26_143_28&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> (</span><a href="#loc_143_9_143_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_9_143_13&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_143_14_143_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_14_143_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)
          where
            </span><span class="hl_conref"><span class="mpre">Write</span></span><span class="mpre"> </span><a name="loc_150_19_150_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_19_150_23&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> </span><a name="loc_150_24_150_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_150_24_150_26&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> = </span><a href="#loc_138_20_138_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_20_138_25&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_141_11_141_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_11_141_12&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_138_1_138_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_19&#39;)"><span class="mpre">fromWriteSingleton</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_154_1_154_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_10&#39;)"><span class="mpre">fromWord8</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><a href="#loc_109_9_109_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_9_109_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_154_1_154_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_10&#39;)"><span class="hl_vardecl"><span class="mpre">fromWord8</span></span></a><span class="mpre"> = </span><a href="#loc_138_1_138_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_1_138_19&#39;)"><span class="hl_varref"><span class="mpre">fromWriteSingleton</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Word.html#loc_117_1_117_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Word.html#loc_117_1_117_11&#39;)"><span class="hl_varref"><span class="mpre">writeWord8</span></span></a><span class="mpre">


</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Implementations</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">

</span><a href="#loc_162_1_162_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_1_162_9&#39;)"><span class="mpre">putWord8</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><a href="#loc_80_9_80_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_162_1_162_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_162_1_162_9&#39;)"><span class="hl_vardecl"><span class="mpre">putWord8</span></span></a><span class="mpre"> = </span><a href="#loc_177_1_177_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_18&#39;)"><span class="hl_varref"><span class="mpre">putWriteSingleton</span></span></a><span class="mpre"> </span><a href="Blaze.ByteString.Builder.Word.html#loc_117_1_117_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Word.html#loc_117_1_117_11&#39;)"><span class="hl_varref"><span class="mpre">writeWord8</span></span></a><span class="mpre">

</span><a href="#loc_165_1_165_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_9&#39;)"><span class="mpre">putWrite</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Write</span></span><span class="mpre"> -&gt; </span><a href="#loc_80_9_80_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_165_1_165_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_9&#39;)"><span class="hl_fundecl"><span class="mpre">putWrite</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Write</span></span><span class="mpre"> </span><a name="loc_165_17_165_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_17_165_21&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> </span><a name="loc_165_22_165_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_22_165_24&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre">) =
    </span><a href="#loc_80_17_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_17_80_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><a href="#loc_168_5_168_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_5_168_9&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre">
  where
    </span><a name="loc_168_5_168_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_5_168_9&#39;)"><span class="hl_fundecl"><span class="mpre">step</span></span></a><span class="mpre"> </span><a name="loc_168_10_168_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_10_168_11&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> (</span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_168_22_168_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_22_168_24&#39;)"><span class="hl_vardecl"><span class="mpre">pf</span></span></a><span class="mpre"> </span><a name="loc_168_25_168_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_25_168_27&#39;)"><span class="hl_vardecl"><span class="mpre">pe</span></span></a><span class="mpre">)
      | </span><a href="#loc_168_22_168_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_22_168_24&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_165_17_165_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_17_165_21&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><a href="#loc_168_25_168_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_25_168_27&#39;)"><span class="hl_varref"><span class="mpre">pe</span></span></a><span class="mpre"> = do
          </span><a href="#loc_165_22_165_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_22_165_24&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_168_22_168_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_22_168_24&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre">
          let !</span><a name="loc_171_16_171_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_16_171_19&#39;)"><span class="hl_vardecl"><span class="mpre">br&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> (</span><a href="#loc_168_22_168_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_22_168_24&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_165_17_165_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_17_165_21&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">) </span><a href="#loc_168_25_168_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_25_168_27&#39;)"><span class="hl_varref"><span class="mpre">pe</span></span></a><span class="mpre">
          </span><a href="#loc_168_10_168_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_10_168_11&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> </span><a href="#loc_171_16_171_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_171_16_171_19&#39;)"><span class="hl_varref"><span class="mpre">br&#39;</span></span></a><span class="mpre">
      | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_86_5_86_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_15&#39;)"><span class="hl_conref"><span class="mpre">BufferFull</span></span></a><span class="mpre"> </span><a href="#loc_165_17_165_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_17_165_21&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_168_22_168_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_22_168_24&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> (</span><a href="#loc_168_5_168_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_5_168_9&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_168_10_168_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_168_10_168_11&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_165_1_165_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_165_1_165_9&#39;)"><span class="mpre">putWrite</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_177_1_177_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_18&#39;)"><span class="mpre">putWriteSingleton</span></a><span class="mpre"> :: (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Write</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="#loc_80_9_80_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_177_1_177_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_18&#39;)"><span class="hl_fundecl"><span class="mpre">putWriteSingleton</span></span></a><span class="mpre"> </span><a name="loc_177_19_177_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_19_177_24&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre"> = 
    </span><a href="#loc_180_5_180_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_5_180_10&#39;)"><span class="hl_varref"><span class="mpre">mkPut</span></span></a><span class="mpre">
  where
    </span><a name="loc_180_5_180_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_5_180_10&#39;)"><span class="hl_fundecl"><span class="mpre">mkPut</span></span></a><span class="mpre"> </span><a name="loc_180_11_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_11_180_12&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><a href="#loc_80_17_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_17_80_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><a href="#loc_182_9_182_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_9_182_13&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre">
      where
        </span><a name="loc_182_9_182_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_9_182_13&#39;)"><span class="hl_fundecl"><span class="mpre">step</span></span></a><span class="mpre"> </span><a name="loc_182_14_182_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_14_182_15&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> (</span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_182_26_182_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_26_182_28&#39;)"><span class="hl_vardecl"><span class="mpre">pf</span></span></a><span class="mpre"> </span><a name="loc_182_29_182_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_29_182_31&#39;)"><span class="hl_vardecl"><span class="mpre">pe</span></span></a><span class="mpre">)
          | </span><a href="#loc_182_26_182_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_26_182_28&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_189_19_189_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_19_189_23&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><a href="#loc_182_29_182_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_29_182_31&#39;)"><span class="hl_varref"><span class="mpre">pe</span></span></a><span class="mpre"> = do
              </span><a href="#loc_189_24_189_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_24_189_26&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre"> </span><a href="#loc_182_26_182_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_26_182_28&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre">
              let !</span><a name="loc_185_20_185_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_20_185_23&#39;)"><span class="hl_vardecl"><span class="mpre">br&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> (</span><a href="#loc_182_26_182_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_26_182_28&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_189_19_189_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_19_189_23&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">) </span><a href="#loc_182_29_182_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_29_182_31&#39;)"><span class="hl_varref"><span class="mpre">pe</span></span></a><span class="mpre">
              </span><a href="#loc_182_14_182_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_14_182_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> </span><a href="#loc_185_20_185_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_185_20_185_23&#39;)"><span class="hl_varref"><span class="mpre">br&#39;</span></span></a><span class="mpre">
          | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">               = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_86_5_86_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_15&#39;)"><span class="hl_conref"><span class="mpre">BufferFull</span></span></a><span class="mpre"> </span><a href="#loc_189_19_189_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_19_189_23&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_182_26_182_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_26_182_28&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> (</span><a href="#loc_182_9_182_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_9_182_13&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_182_14_182_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_182_14_182_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">)
          where
            </span><span class="hl_conref"><span class="mpre">Write</span></span><span class="mpre"> </span><a name="loc_189_19_189_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_19_189_23&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> </span><a name="loc_189_24_189_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_189_24_189_26&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> = </span><a href="#loc_177_19_177_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_19_177_24&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> </span><a href="#loc_180_11_180_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_180_11_180_12&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_177_1_177_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_177_1_177_18&#39;)"><span class="mpre">putWriteSingleton</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><a href="#loc_193_1_193_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_1_193_11&#39;)"><span class="mpre">putBuilder</span></a><span class="mpre"> :: </span><a href="Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Blaze.ByteString.Builder.Internal.Types.html#loc_69_9_69_16&#39;)"><span class="hl_tyconref"><span class="mpre">B.Builder</span></span></a><span class="mpre"> -&gt; </span><a href="#loc_80_9_80_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_193_1_193_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_1_193_11&#39;)"><span class="hl_fundecl"><span class="mpre">putBuilder</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">B.Builder</span></span><span class="mpre"> </span><a name="loc_193_23_193_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_23_193_24&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">) = 
    </span><a href="#loc_80_17_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_17_80_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><a href="#loc_198_5_198_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_5_198_9&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre">
  where
    </span><a name="loc_196_5_196_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_5_196_14&#39;)"><span class="hl_fundecl"><span class="mpre">finalStep</span></span></a><span class="mpre"> _ </span><a name="loc_196_17_196_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_17_196_19&#39;)"><span class="hl_vardecl"><span class="mpre">pf</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">B.Done</span></span><span class="mpre"> </span><a href="#loc_196_17_196_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_17_196_19&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre">

    </span><a name="loc_198_5_198_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_5_198_9&#39;)"><span class="hl_fundecl"><span class="mpre">step</span></span></a><span class="mpre"> </span><a name="loc_198_10_198_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_10_198_11&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = </span><a href="#loc_200_9_200_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_9_200_11&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> (</span><a href="#loc_193_23_193_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_193_23_193_24&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><a href="#loc_196_5_196_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_196_5_196_14&#39;)"><span class="hl_varref"><span class="mpre">finalStep</span></span></a><span class="mpre">)
      where
        </span><a name="loc_200_9_200_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_9_200_11&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_200_12_200_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_12_200_21&#39;)"><span class="hl_vardecl"><span class="mpre">buildStep</span></span></a><span class="mpre"> (</span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_200_32_200_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_32_200_34&#39;)"><span class="hl_vardecl"><span class="mpre">pf</span></span></a><span class="mpre"> </span><a name="loc_200_35_200_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_35_200_37&#39;)"><span class="hl_vardecl"><span class="mpre">pe</span></span></a><span class="mpre">) = do
          </span><a name="loc_201_11_201_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_11_201_17&#39;)"><span class="hl_vardecl"><span class="mpre">signal</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_200_12_200_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_12_200_21&#39;)"><span class="hl_varref"><span class="mpre">buildStep</span></span></a><span class="mpre"> </span><a href="#loc_200_32_200_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_32_200_34&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><a href="#loc_200_35_200_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_35_200_37&#39;)"><span class="hl_varref"><span class="mpre">pe</span></span></a><span class="mpre">
          case </span><a href="#loc_201_11_201_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_201_11_201_17&#39;)"><span class="hl_varref"><span class="mpre">signal</span></span></a><span class="mpre"> of
            </span><span class="hl_conref"><span class="mpre">B.Done</span></span><span class="mpre"> </span><a name="loc_203_20_203_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_20_203_23&#39;)"><span class="hl_vardecl"><span class="mpre">pf&#39;</span></span></a><span class="mpre"> -&gt; do
              let !</span><a name="loc_204_20_204_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_20_204_23&#39;)"><span class="hl_vardecl"><span class="mpre">br&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a href="#loc_203_20_203_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_203_20_203_23&#39;)"><span class="hl_varref"><span class="mpre">pf&#39;</span></span></a><span class="mpre"> </span><a href="#loc_200_35_200_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_35_200_37&#39;)"><span class="hl_varref"><span class="mpre">pe</span></span></a><span class="mpre">
              </span><a href="#loc_198_10_198_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_198_10_198_11&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre"> </span><a href="#loc_204_20_204_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_204_20_204_23&#39;)"><span class="hl_varref"><span class="mpre">br&#39;</span></span></a><span class="mpre">
            </span><span class="hl_conref"><span class="mpre">B.BufferFull</span></span><span class="mpre"> </span><a name="loc_206_26_206_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_26_206_33&#39;)"><span class="hl_vardecl"><span class="mpre">minSize</span></span></a><span class="mpre"> </span><a name="loc_206_34_206_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_34_206_37&#39;)"><span class="hl_vardecl"><span class="mpre">pf&#39;</span></span></a><span class="mpre"> </span><a name="loc_206_38_206_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_38_206_51&#39;)"><span class="hl_vardecl"><span class="mpre">nextBuildStep</span></span></a><span class="mpre"> -&gt; 
              </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_86_5_86_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_15&#39;)"><span class="hl_conref"><span class="mpre">BufferFull</span></span></a><span class="mpre"> </span><a href="#loc_206_26_206_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_26_206_33&#39;)"><span class="hl_varref"><span class="mpre">minSize</span></span></a><span class="mpre"> </span><a href="#loc_206_34_206_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_34_206_37&#39;)"><span class="hl_varref"><span class="mpre">pf&#39;</span></span></a><span class="mpre"> (</span><a href="#loc_200_9_200_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_200_9_200_11&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_206_38_206_51" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_206_38_206_51&#39;)"><span class="hl_varref"><span class="mpre">nextBuildStep</span></span></a><span class="mpre">)
            </span><span class="hl_conref"><span class="mpre">B.ModifyChunks</span></span><span class="mpre"> _ _ _ -&gt; 
              </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;putBuilder: ModifyChunks not implemented&quot;</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-
  m &gt;&gt;= f  = GetC $ \done empty pe -&gt;
      runGetC m (\pr&#39; x -&gt; runGetC (f x) done empty pe pr&#39;) 
                (\m&#39; -&gt; empty (m&#39; &gt;&gt;= f))
                pe


newtype GetC r a = GetC {
    runGetC ::
      (Ptr Word8 -&gt; a -&gt; IO r) -&gt;   -- done
      (GetC r a -&gt; IO r     )  -&gt;   -- empty buffer
      Ptr Word8                -&gt;   -- end of buffer
      Ptr Word8                -&gt;   -- next byte to read
      IO r
  }

instance Functor (GetC r) where
  fmap f g = GetC $ \done empty -&gt;
      runGetC g (\pr&#39; x -&gt; done pr&#39; (f x)) 
                (\g&#39;    -&gt; empty (fmap f g&#39;))

instance Monad (GetC r) where
  return x = GetC $ \done _ _ pr -&gt; done pr x
  m &gt;&gt;= f  = GetC $ \done empty pe -&gt;
      runGetC m (\pr&#39; x -&gt; runGetC (f x) done empty pe pr&#39;) 
                (\m&#39; -&gt; empty (m&#39; &gt;&gt;= f))
                pe

-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Internal global constants.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Default size (~32kb) for the buffer that becomes a chunk of the output</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- stream once it is filled.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_249_1_249_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_1_249_18&#39;)"><span class="mpre">defaultBufferSize</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_249_1_249_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_1_249_18&#39;)"><span class="hl_vardecl"><span class="mpre">defaultBufferSize</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">32</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1024</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_250_11_250_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_11_250_19&#39;)"><span class="hl_varref"><span class="mpre">overhead</span></span></a><span class="mpre"> </span><span class="hl_comment"><span class="mpre">-- Copied from Data.ByteString.Lazy.</span></span><span class="mpre">
    where </span><a name="loc_250_11_250_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_250_11_250_19&#39;)"><span class="hl_vardecl"><span class="mpre">overhead</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | The minimal length (~4kb) a buffer must have before filling it and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- outputting it as a chunk of the output stream. </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- This size determines when a buffer is spilled after a &#39;flush&#39; or a direct</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- bytestring insertion. It is also the size of the first chunk generated by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;toLazyByteString&#39;.</span></span><span class="mpre">
</span><a href="#loc_259_1_259_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_1_259_25&#39;)"><span class="mpre">defaultMinimalBufferSize</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_259_1_259_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_1_259_25&#39;)"><span class="hl_vardecl"><span class="mpre">defaultMinimalBufferSize</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">4</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><span class="hl_num"><span class="mpre">1024</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">-</span></span><span class="mpre"> </span><a href="#loc_260_11_260_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_260_11_260_19&#39;)"><span class="hl_varref"><span class="mpre">overhead</span></span></a><span class="mpre">
    where </span><a name="loc_260_11_260_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_260_11_260_19&#39;)"><span class="hl_vardecl"><span class="mpre">overhead</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | The default length (64) for the first buffer to be allocated when</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- converting a &#39;Builder&#39; to a lazy bytestring. </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- See &#39;toLazyByteStringWith&#39; for further explanation.</span></span><span class="mpre">
</span><a href="#loc_267_1_267_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_1_267_23&#39;)"><span class="mpre">defaultFirstBufferSize</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_267_1_267_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_1_267_23&#39;)"><span class="hl_vardecl"><span class="mpre">defaultFirstBufferSize</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">64</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | The maximal number of bytes for that copying is cheaper than direct</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- insertion into the output stream. This takes into account the fragmentation</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- that may occur in the output buffer due to the early &#39;flush&#39; implied by the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- direct bytestring insertion.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @&#39;defaultMaximalCopySize&#39; = 2 * &#39;defaultMinimalBufferSize&#39;@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_277_1_277_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_1_277_23&#39;)"><span class="mpre">defaultMaximalCopySize</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">
</span><a name="loc_277_1_277_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_277_1_277_23&#39;)"><span class="hl_vardecl"><span class="mpre">defaultMaximalCopySize</span></span></a><span class="mpre"> = </span><span class="hl_num"><span class="mpre">2</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">*</span></span><span class="mpre"> </span><a href="#loc_259_1_259_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_1_259_25&#39;)"><span class="hl_varref"><span class="mpre">defaultMinimalBufferSize</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Flushing and running a Builder</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | Output all data written in the current buffer and start a new chunk.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The use uf this function depends on how the resulting bytestrings are</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- consumed. &#39;flush&#39; is possibly not very useful in non-interactive scenarios.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- However, it is kept for compatibility with the builder provided by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Data.Binary.Builder.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- When using &#39;toLazyByteString&#39; to extract a lazy &#39;L.ByteString&#39; from a</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;Builder&#39;, this means that a new chunk will be started in the resulting lazy</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;L.ByteString&#39;. The remaining part of the buffer is spilled, if the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- reamining free space is smaller than the minimal desired buffer size.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">{-
flush :: Builder
flush = Builder $ \k pf _ -&gt; return $ ModifyChunks pf id k
-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Run a &#39;Builder&#39; with the given buffer sizes.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Use this function for integrating the &#39;Builder&#39; type with other libraries</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- that generate lazy bytestrings.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that the builders should guarantee that on average the desired chunk</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- size is attained. Builders may decide to start a new buffer and not</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- completely fill the existing buffer, if this is faster. However, they should</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- not spill too much of the buffer, if they cannot compensate for it.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A call @toLazyByteStringWith bufSize minBufSize firstBufSize@ will generate</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a lazy bytestring according to the following strategy. First, we allocate</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a buffer of size @firstBufSize@ and start filling it. If it overflows, we</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- allocate a buffer of size @minBufSize@ and copy the first buffer to it in</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- order to avoid generating a too small chunk. Finally, every next buffer will</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- be of size @bufSize@. This, slow startup strategy is required to achieve</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- good speed for short (&lt;200 bytes) resulting bytestrings, as for them the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- allocation cost is of a large buffer cannot be compensated. Moreover, this</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- strategy also allows us to avoid spilling too much memory for short</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- resulting bytestrings.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that setting @firstBufSize &gt;= minBufSize@ implies that the first buffer</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- is no longer copied but allocated and filled directly. Hence, setting</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @firstBufSize = bufSize@ means that all chunks will use an underlying buffer</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- of size @bufSize@. This is recommended, if you know that you always output</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- more than @minBufSize@ bytes.</span></span><span class="mpre">
</span><a href="#loc_339_1_339_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_1_339_21&#39;)"><span class="mpre">toLazyByteStringWith</span></a><span class="mpre"> 
    :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">           </span><span class="hl_comment"><span class="mpre">-- ^ Buffer size (upper-bounds the resulting chunk size).</span></span><span class="mpre">
    -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">           </span><span class="hl_comment"><span class="mpre">-- ^ Minimal free buffer space for continuing filling</span></span><span class="mpre">
                     </span><span class="hl_comment"><span class="mpre">-- the same buffer after a &#39;flush&#39; or a direct bytestring</span></span><span class="mpre">
                     </span><span class="hl_comment"><span class="mpre">-- insertion. This corresponds to the minimal desired</span></span><span class="mpre">
                     </span><span class="hl_comment"><span class="mpre">-- chunk size.</span></span><span class="mpre">
    -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre">           </span><span class="hl_comment"><span class="mpre">-- ^ Size of the first buffer to be used and copied for</span></span><span class="mpre">
                     </span><span class="hl_comment"><span class="mpre">-- larger resulting sequences</span></span><span class="mpre">
    -&gt; </span><a href="#loc_80_9_80_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">       </span><span class="hl_comment"><span class="mpre">-- ^ Builder to run.</span></span><span class="mpre">
    -&gt; </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^ Lazy bytestring to output after the builder is</span></span><span class="mpre">
                     </span><span class="hl_comment"><span class="mpre">-- finished.</span></span><span class="mpre">
    -&gt; </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^ Resulting lazy bytestring</span></span><span class="mpre">
</span><a name="loc_339_1_339_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_1_339_21&#39;)"><span class="hl_fundecl"><span class="mpre">toLazyByteStringWith</span></span></a><span class="mpre"> </span><a name="loc_339_22_339_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_22_339_29&#39;)"><span class="hl_vardecl"><span class="mpre">bufSize</span></span></a><span class="mpre"> </span><a name="loc_339_30_339_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_30_339_40&#39;)"><span class="hl_vardecl"><span class="mpre">minBufSize</span></span></a><span class="mpre"> </span><a name="loc_339_41_339_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_41_339_53&#39;)"><span class="hl_vardecl"><span class="mpre">firstBufSize</span></span></a><span class="mpre"> (</span><a href="#loc_80_17_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_17_80_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><a name="loc_339_59_339_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_59_339_60&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre">) </span><a name="loc_339_62_339_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_62_339_63&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> = 
    </span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">inlinePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_347_5_347_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_347_5_347_20&#39;)"><span class="hl_varref"><span class="mpre">fillFirstBuffer</span></span></a><span class="mpre"> (</span><a href="#loc_339_59_339_60" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_59_339_60&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><a href="#loc_342_5_342_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_5_342_14&#39;)"><span class="hl_varref"><span class="mpre">finalStep</span></span></a><span class="mpre">)
  where
    </span><a name="loc_342_5_342_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_5_342_14&#39;)"><span class="hl_fundecl"><span class="mpre">finalStep</span></span></a><span class="mpre"> _ (</span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_342_27_342_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_27_342_29&#39;)"><span class="hl_vardecl"><span class="mpre">pf</span></span></a><span class="mpre"> _) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_85_5_85_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_5_85_9&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> </span><a href="#loc_342_27_342_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_342_27_342_29&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- fill a first very small buffer, if we need more space then copy it</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- to the new buffer of size &#39;minBufSize&#39;. This way we don&#39;t pay the</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- allocation cost of the big &#39;bufSize&#39; buffer, when outputting only</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- small sequences.</span></span><span class="mpre">
    </span><a name="loc_347_5_347_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_347_5_347_20&#39;)"><span class="hl_fundecl"><span class="mpre">fillFirstBuffer</span></span></a><span class="mpre"> !</span><a name="loc_347_22_347_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_347_22_347_27&#39;)"><span class="hl_vardecl"><span class="mpre">step0</span></span></a><span class="mpre">
      | </span><a href="#loc_339_30_339_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_30_339_40&#39;)"><span class="hl_varref"><span class="mpre">minBufSize</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><a href="#loc_339_41_339_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_41_339_53&#39;)"><span class="hl_varref"><span class="mpre">firstBufSize</span></span></a><span class="mpre"> = </span><a href="#loc_380_5_380_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_380_5_380_18&#39;)"><span class="hl_varref"><span class="mpre">fillNewBuffer</span></span></a><span class="mpre"> </span><a href="#loc_339_41_339_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_41_339_53&#39;)"><span class="hl_varref"><span class="mpre">firstBufSize</span></span></a><span class="mpre"> </span><a href="#loc_347_22_347_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_347_22_347_27&#39;)"><span class="hl_varref"><span class="mpre">step0</span></span></a><span class="mpre">
      | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">                  = do
          </span><a name="loc_350_11_350_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_11_350_16&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> &lt;- </span><a href="Data.ByteString.Internal.html#loc_489_1_489_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_489_1_489_17&#39;)"><span class="hl_varref"><span class="mpre">S.mallocByteString</span></span></a><span class="mpre"> </span><a href="#loc_339_41_339_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_41_339_53&#39;)"><span class="hl_varref"><span class="mpre">firstBufSize</span></span></a><span class="mpre">
          </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> </span><a href="#loc_350_11_350_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_11_350_16&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_351_35_351_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_35_351_37&#39;)"><span class="hl_vardecl"><span class="mpre">pf</span></span></a><span class="mpre"> -&gt; do
              let !</span><a name="loc_352_20_352_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_20_352_22&#39;)"><span class="hl_vardecl"><span class="mpre">br</span></span></a><span class="mpre">      = </span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a href="#loc_351_35_351_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_35_351_37&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> (</span><a href="#loc_351_35_351_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_35_351_37&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_339_41_339_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_41_339_53&#39;)"><span class="hl_varref"><span class="mpre">firstBufSize</span></span></a><span class="mpre">)
                  </span><a name="loc_353_19_353_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_19_353_23&#39;)"><span class="hl_fundecl"><span class="mpre">mkbs</span></span></a><span class="mpre"> </span><a name="loc_353_24_353_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_24_353_27&#39;)"><span class="hl_vardecl"><span class="mpre">pf&#39;</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">S.PS</span></span></a><span class="mpre"> </span><a href="#loc_350_11_350_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_350_11_350_16&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> (</span><a href="#loc_353_24_353_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_24_353_27&#39;)"><span class="hl_varref"><span class="mpre">pf&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`minusPtr`</span></span><span class="mpre"> </span><a href="#loc_351_35_351_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_35_351_37&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre">)
                  </span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_353_19_353_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_19_353_23&#39;)"><span class="mpre">mkbs</span></a><span class="mpre"> #-}</span></span><span class="mpre">
              </span><a name="loc_355_15_355_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_355_15_355_19&#39;)"><span class="hl_vardecl"><span class="mpre">next</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_347_22_347_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_347_22_347_27&#39;)"><span class="hl_varref"><span class="mpre">step0</span></span></a><span class="mpre"> </span><a href="#loc_352_20_352_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_352_20_352_22&#39;)"><span class="hl_varref"><span class="mpre">br</span></span></a><span class="mpre">
              case </span><a href="#loc_355_15_355_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_355_15_355_19&#39;)"><span class="hl_varref"><span class="mpre">next</span></span></a><span class="mpre"> of
                  </span><a href="#loc_85_5_85_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_5_85_9&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> </span><a name="loc_357_24_357_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_24_357_27&#39;)"><span class="hl_vardecl"><span class="mpre">pf&#39;</span></span></a><span class="mpre"> _
                    | </span><a href="#loc_357_24_357_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_24_357_27&#39;)"><span class="hl_varref"><span class="mpre">pf&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_351_35_351_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_35_351_37&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_339_62_339_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_62_339_63&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">
                    | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_27_82_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_27_82_32&#39;)"><span class="hl_conref"><span class="mpre">L.Chunk</span></span></a><span class="mpre"> (</span><a href="#loc_353_19_353_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_353_19_353_23&#39;)"><span class="hl_varref"><span class="mpre">mkbs</span></span></a><span class="mpre"> </span><a href="#loc_357_24_357_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_357_24_357_27&#39;)"><span class="hl_varref"><span class="mpre">pf&#39;</span></span></a><span class="mpre">) </span><a href="#loc_339_62_339_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_62_339_63&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">

                  </span><a href="#loc_86_5_86_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_15&#39;)"><span class="hl_conref"><span class="mpre">BufferFull</span></span></a><span class="mpre"> </span><a name="loc_361_30_361_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_30_361_37&#39;)"><span class="hl_vardecl"><span class="mpre">newSize</span></span></a><span class="mpre"> </span><a name="loc_361_38_361_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_38_361_41&#39;)"><span class="hl_vardecl"><span class="mpre">pf&#39;</span></span></a><span class="mpre"> </span><a name="loc_361_42_361_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_42_361_50&#39;)"><span class="hl_vardecl"><span class="mpre">nextStep</span></span></a><span class="mpre">  -&gt; do
                      let !</span><a name="loc_362_28_362_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_362_28_362_29&#39;)"><span class="hl_vardecl"><span class="mpre">l</span></span></a><span class="mpre">  = </span><a href="#loc_361_38_361_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_38_361_41&#39;)"><span class="hl_varref"><span class="mpre">pf&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`minusPtr`</span></span><span class="mpre"> </span><a href="#loc_351_35_351_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_35_351_37&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre">
                      </span><a href="#loc_380_5_380_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_380_5_380_18&#39;)"><span class="hl_varref"><span class="mpre">fillNewBuffer</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">max</span></span><span class="mpre"> (</span><a href="#loc_362_28_362_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_362_28_362_29&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">+</span></span><span class="mpre"> </span><a href="#loc_361_30_361_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_30_361_37&#39;)"><span class="hl_varref"><span class="mpre">newSize</span></span></a><span class="mpre">) </span><a href="#loc_339_30_339_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_30_339_40&#39;)"><span class="hl_varref"><span class="mpre">minBufSize</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
                          \(</span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_364_38_364_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_364_38_364_43&#39;)"><span class="hl_vardecl"><span class="mpre">pfNew</span></span></a><span class="mpre"> </span><a name="loc_364_44_364_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_364_44_364_49&#39;)"><span class="hl_vardecl"><span class="mpre">peNew</span></span></a><span class="mpre">) -&gt; do
                              </span><a href="Foreign.Marshal.Utils.html#loc_154_1_154_10" onmouseover="nemnem.highlightLocalToRemote(&#39;Foreign.Marshal.Utils.html#loc_154_1_154_10&#39;)"><span class="hl_varref"><span class="mpre">copyBytes</span></span></a><span class="mpre"> </span><a href="#loc_364_38_364_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_364_38_364_43&#39;)"><span class="hl_varref"><span class="mpre">pfNew</span></span></a><span class="mpre"> </span><a href="#loc_351_35_351_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_351_35_351_37&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><a href="#loc_362_28_362_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_362_28_362_29&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">
                              let !</span><a name="loc_366_36_366_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_366_36_366_41&#39;)"><span class="hl_vardecl"><span class="mpre">brNew</span></span></a><span class="mpre"> = </span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> (</span><a href="#loc_364_38_364_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_364_38_364_43&#39;)"><span class="hl_varref"><span class="mpre">pfNew</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_362_28_362_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_362_28_362_29&#39;)"><span class="hl_varref"><span class="mpre">l</span></span></a><span class="mpre">) </span><a href="#loc_364_44_364_49" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_364_44_364_49&#39;)"><span class="hl_varref"><span class="mpre">peNew</span></span></a><span class="mpre">
                              </span><a href="#loc_361_42_361_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_361_42_361_50&#39;)"><span class="hl_varref"><span class="mpre">nextStep</span></span></a><span class="mpre"> </span><a href="#loc_366_36_366_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_366_36_366_41&#39;)"><span class="hl_varref"><span class="mpre">brNew</span></span></a><span class="mpre">
                      
                  </span><a href="#loc_90_5_90_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_21&#39;)"><span class="hl_conref"><span class="mpre">InsertByteString</span></span></a><span class="mpre"> _ _ _ -&gt; </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;not yet implemented&quot;</span></span><span class="mpre">
                  </span><span class="hl_comment"><span class="mpre">{-
                  ModifyChunks pf&#39; bsk nextStep( 
                      | pf&#39; == pf -&gt;
                          return $ bsk (inlinePerformIO $ fillNewBuffer bufSize nextStep)
                      | otherwise -&gt;
                          return $ L.Chunk (mkbs pf&#39;)
                              (bsk (inlinePerformIO $ fillNewBuffer bufSize nextStep))
                  -}</span></span><span class="mpre">
                    
    </span><span class="hl_comment"><span class="mpre">-- allocate and fill a new buffer</span></span><span class="mpre">
    </span><a name="loc_380_5_380_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_380_5_380_18&#39;)"><span class="hl_fundecl"><span class="mpre">fillNewBuffer</span></span></a><span class="mpre"> !</span><a name="loc_380_20_380_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_380_20_380_24&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> !</span><a name="loc_380_26_380_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_380_26_380_31&#39;)"><span class="hl_vardecl"><span class="mpre">step0</span></span></a><span class="mpre"> = do
        </span><a name="loc_381_9_381_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_381_9_381_14&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> &lt;- </span><a href="Data.ByteString.Internal.html#loc_489_1_489_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_489_1_489_17&#39;)"><span class="hl_varref"><span class="mpre">S.mallocByteString</span></span></a><span class="mpre"> </span><a href="#loc_380_20_380_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_380_20_380_24&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">
        </span><span class="hl_varref"><span class="mpre">withForeignPtr</span></span><span class="mpre"> </span><a href="#loc_381_9_381_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_381_9_381_14&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_384_9_384_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_9_384_19&#39;)"><span class="hl_varref"><span class="mpre">fillBuffer</span></span></a><span class="mpre"> </span><a href="#loc_381_9_381_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_381_9_381_14&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre">
      where
        </span><a name="loc_384_9_384_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_9_384_19&#39;)"><span class="hl_fundecl"><span class="mpre">fillBuffer</span></span></a><span class="mpre"> </span><a name="loc_384_20_384_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_20_384_25&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> !</span><a name="loc_384_27_384_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_27_384_31&#39;)"><span class="hl_vardecl"><span class="mpre">pbuf</span></span></a><span class="mpre"> = </span><a href="#loc_387_13_387_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_13_387_17&#39;)"><span class="hl_varref"><span class="mpre">fill</span></span></a><span class="mpre"> </span><a href="#loc_384_27_384_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_27_384_31&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> </span><a href="#loc_380_26_380_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_380_26_380_31&#39;)"><span class="hl_varref"><span class="mpre">step0</span></span></a><span class="mpre">
          where
            !</span><a name="loc_386_14_386_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_14_386_16&#39;)"><span class="hl_vardecl"><span class="mpre">pe</span></span></a><span class="mpre"> = </span><a href="#loc_384_27_384_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_27_384_31&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_380_20_380_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_380_20_380_24&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">
            </span><a name="loc_387_13_387_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_13_387_17&#39;)"><span class="hl_fundecl"><span class="mpre">fill</span></span></a><span class="mpre"> !</span><a name="loc_387_19_387_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_19_387_21&#39;)"><span class="hl_vardecl"><span class="mpre">pf</span></span></a><span class="mpre"> !</span><a name="loc_387_23_387_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_23_387_27&#39;)"><span class="hl_vardecl"><span class="mpre">step</span></span></a><span class="mpre"> = do
                let !</span><a name="loc_388_22_388_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_388_22_388_24&#39;)"><span class="hl_vardecl"><span class="mpre">br</span></span></a><span class="mpre"> = </span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a href="#loc_387_19_387_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_19_387_21&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><a href="#loc_386_14_386_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_386_14_386_16&#39;)"><span class="hl_varref"><span class="mpre">pe</span></span></a><span class="mpre">
                </span><a name="loc_389_17_389_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_17_389_21&#39;)"><span class="hl_vardecl"><span class="mpre">next</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_387_23_387_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_23_387_27&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_388_22_388_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_388_22_388_24&#39;)"><span class="hl_varref"><span class="mpre">br</span></span></a><span class="mpre">
                let </span><a name="loc_390_21_390_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_390_21_390_25&#39;)"><span class="hl_fundecl"><span class="mpre">mkbs</span></span></a><span class="mpre"> </span><a name="loc_390_26_390_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_390_26_390_29&#39;)"><span class="hl_vardecl"><span class="mpre">pf&#39;</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">S.PS</span></span></a><span class="mpre"> </span><a href="#loc_384_20_384_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_20_384_25&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> (</span><a href="#loc_387_19_387_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_19_387_21&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`minusPtr`</span></span><span class="mpre"> </span><a href="#loc_384_27_384_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_384_27_384_31&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre">) (</span><a href="#loc_390_26_390_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_390_26_390_29&#39;)"><span class="hl_varref"><span class="mpre">pf&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`minusPtr`</span></span><span class="mpre"> </span><a href="#loc_387_19_387_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_19_387_21&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre">)
                    </span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_390_21_390_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_390_21_390_25&#39;)"><span class="mpre">mkbs</span></a><span class="mpre"> #-}</span></span><span class="mpre">
                case </span><a href="#loc_389_17_389_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_389_17_389_21&#39;)"><span class="hl_varref"><span class="mpre">next</span></span></a><span class="mpre"> of
                    </span><a href="#loc_85_5_85_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_5_85_9&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> </span><a name="loc_393_26_393_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_393_26_393_29&#39;)"><span class="hl_vardecl"><span class="mpre">pf&#39;</span></span></a><span class="mpre"> _
                      | </span><a href="#loc_393_26_393_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_393_26_393_29&#39;)"><span class="hl_varref"><span class="mpre">pf&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_387_19_387_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_387_19_387_21&#39;)"><span class="hl_varref"><span class="mpre">pf</span></span></a><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_339_62_339_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_62_339_63&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">
                      | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_27_82_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_27_82_32&#39;)"><span class="hl_conref"><span class="mpre">L.Chunk</span></span></a><span class="mpre"> (</span><a href="#loc_390_21_390_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_390_21_390_25&#39;)"><span class="hl_varref"><span class="mpre">mkbs</span></span></a><span class="mpre"> </span><a href="#loc_393_26_393_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_393_26_393_29&#39;)"><span class="hl_varref"><span class="mpre">pf&#39;</span></span></a><span class="mpre">) </span><a href="#loc_339_62_339_63" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_62_339_63&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">

                    </span><a href="#loc_86_5_86_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_15&#39;)"><span class="hl_conref"><span class="mpre">BufferFull</span></span></a><span class="mpre"> </span><a name="loc_397_32_397_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_397_32_397_39&#39;)"><span class="hl_vardecl"><span class="mpre">newSize</span></span></a><span class="mpre"> </span><a name="loc_397_40_397_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_397_40_397_43&#39;)"><span class="hl_vardecl"><span class="mpre">pf&#39;</span></span></a><span class="mpre"> </span><a name="loc_397_44_397_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_397_44_397_52&#39;)"><span class="hl_vardecl"><span class="mpre">nextStep</span></span></a><span class="mpre"> -&gt;
                        </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_27_82_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_27_82_32&#39;)"><span class="hl_conref"><span class="mpre">L.Chunk</span></span></a><span class="mpre"> (</span><a href="#loc_390_21_390_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_390_21_390_25&#39;)"><span class="hl_varref"><span class="mpre">mkbs</span></span></a><span class="mpre"> </span><a href="#loc_397_40_397_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_397_40_397_43&#39;)"><span class="hl_varref"><span class="mpre">pf&#39;</span></span></a><span class="mpre">)
                            (</span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">inlinePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> 
                                </span><a href="#loc_380_5_380_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_380_5_380_18&#39;)"><span class="hl_varref"><span class="mpre">fillNewBuffer</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">max</span></span><span class="mpre"> </span><a href="#loc_397_32_397_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_397_32_397_39&#39;)"><span class="hl_varref"><span class="mpre">newSize</span></span></a><span class="mpre"> </span><a href="#loc_339_22_339_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_22_339_29&#39;)"><span class="hl_varref"><span class="mpre">bufSize</span></span></a><span class="mpre">) </span><a href="#loc_397_44_397_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_397_44_397_52&#39;)"><span class="hl_varref"><span class="mpre">nextStep</span></span></a><span class="mpre">)
                        
                    </span><a href="#loc_90_5_90_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_21&#39;)"><span class="hl_conref"><span class="mpre">InsertByteString</span></span></a><span class="mpre"> _ _ _ -&gt; </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;not yet implemented2&quot;</span></span><span class="mpre">
                    </span><span class="hl_comment"><span class="mpre">{-
                    ModifyChunks  pf&#39; bsk nextStep
                      | pf&#39; == pf                      -&gt;
                          return $ bsk (inlinePerformIO $ fill pf&#39; nextStep)
                      | minBufSize &lt; pe `minusPtr` pf&#39; -&gt;
                          return $ L.Chunk (mkbs pf&#39;)
                              (bsk (inlinePerformIO $ fill pf&#39; nextStep))
                      | otherwise                      -&gt;
                          return $ L.Chunk (mkbs pf&#39;)
                              (bsk (inlinePerformIO $ fillNewBuffer bufSize nextStep))
                    -}</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- | Extract the lazy &#39;L.ByteString&#39; from the builder by running it with default</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- buffer sizes. Use this function, if you do not have any special</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- considerations with respect to buffer sizes.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @ &#39;toLazyByteString&#39; b = &#39;toLazyByteStringWith&#39; &#39;defaultBufferSize&#39; &#39;defaultMinimalBufferSize&#39; &#39;defaultFirstBufferSize&#39; b L.empty@</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Note that @&#39;toLazyByteString&#39;@ is a &#39;Monoid&#39; homomorphism.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; toLazyByteString mempty          == mempty</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &gt; toLazyByteString (x `mappend` y) == toLazyByteString x `mappend` toLazyByteString y</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- However, in the second equation, the left-hand-side is generally faster to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- execute.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_431_1_431_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_1_431_17&#39;)"><span class="mpre">toLazyByteString</span></a><span class="mpre"> :: </span><a href="#loc_80_9_80_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre">
</span><a name="loc_431_1_431_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_1_431_17&#39;)"><span class="hl_fundecl"><span class="mpre">toLazyByteString</span></span></a><span class="mpre"> </span><a name="loc_431_18_431_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_18_431_19&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> = </span><a href="#loc_339_1_339_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_339_1_339_21&#39;)"><span class="hl_varref"><span class="mpre">toLazyByteStringWith</span></span></a><span class="mpre"> 
    </span><a href="#loc_249_1_249_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_1_249_18&#39;)"><span class="hl_varref"><span class="mpre">defaultBufferSize</span></span></a><span class="mpre"> </span><a href="#loc_259_1_259_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_259_1_259_25&#39;)"><span class="hl_varref"><span class="mpre">defaultMinimalBufferSize</span></span></a><span class="mpre"> </span><a href="#loc_267_1_267_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_267_1_267_23&#39;)"><span class="hl_varref"><span class="mpre">defaultFirstBufferSize</span></span></a><span class="mpre"> </span><a href="#loc_431_18_431_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_18_431_19&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">L.empty</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_431_1_431_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_431_1_431_17&#39;)"><span class="mpre">toLazyByteString</span></a><span class="mpre"> #-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Builder Enumeration</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">

data </span><a name="loc_439_6_439_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_6_439_17&#39;)"><span class="hl_tycondecl"><span class="mpre">BuildStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = 
         </span><a name="loc_440_10_440_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_440_10_440_20&#39;)"><span class="hl_condecl"><span class="mpre">BuildChunk</span></span></a><span class="mpre">  </span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">S.ByteString</span></span></a><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_439_6_439_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_6_439_17&#39;)"><span class="hl_tyconref"><span class="mpre">BuildStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">))
       | </span><a name="loc_441_10_441_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_441_10_441_20&#39;)"><span class="hl_condecl"><span class="mpre">BuildYield</span></span></a><span class="mpre">
           </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">            
           (forall </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">. </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; 
                      </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">S.ByteString</span></span></a><span class="mpre">) (</span><a href="#loc_80_9_80_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_439_6_439_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_6_439_17&#39;)"><span class="hl_tyconref"><span class="mpre">BuildStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)))

</span><a href="#loc_447_1_447_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_1_447_8&#39;)"><span class="mpre">enumPut</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_80_9_80_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_439_6_439_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_6_439_17&#39;)"><span class="hl_tyconref"><span class="mpre">BuildStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_447_1_447_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_1_447_8&#39;)"><span class="hl_fundecl"><span class="mpre">enumPut</span></span></a><span class="mpre"> </span><a name="loc_447_9_447_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_9_447_16&#39;)"><span class="hl_vardecl"><span class="mpre">bufSize</span></span></a><span class="mpre"> (</span><a href="#loc_80_17_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_17_80_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><a name="loc_447_22_447_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_22_447_26&#39;)"><span class="hl_vardecl"><span class="mpre">put0</span></span></a><span class="mpre">) =
    </span><a href="#loc_454_5_454_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_454_5_454_15&#39;)"><span class="hl_varref"><span class="mpre">fillBuffer</span></span></a><span class="mpre"> </span><a href="#loc_447_9_447_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_9_447_16&#39;)"><span class="hl_varref"><span class="mpre">bufSize</span></span></a><span class="mpre"> (</span><a href="#loc_447_22_447_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_22_447_26&#39;)"><span class="hl_varref"><span class="mpre">put0</span></span></a><span class="mpre"> </span><a href="#loc_451_5_451_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_451_5_451_14&#39;)"><span class="hl_varref"><span class="mpre">finalStep</span></span></a><span class="mpre">)
  where
    </span><a href="#loc_451_5_451_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_451_5_451_14&#39;)"><span class="mpre">finalStep</span></a><span class="mpre"> :: forall </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">. </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
    </span><a name="loc_451_5_451_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_451_5_451_14&#39;)"><span class="hl_fundecl"><span class="mpre">finalStep</span></span></a><span class="mpre"> </span><a name="loc_451_15_451_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_451_15_451_16&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> (</span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_451_27_451_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_451_27_451_29&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> _) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_85_5_85_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_5_85_9&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> </span><a href="#loc_451_27_451_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_451_27_451_29&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><a href="#loc_451_15_451_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_451_15_451_16&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">

    </span><a href="#loc_454_5_454_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_454_5_454_15&#39;)"><span class="mpre">fillBuffer</span></a><span class="mpre"> :: forall </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">. </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_439_6_439_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_6_439_17&#39;)"><span class="hl_tyconref"><span class="mpre">BuildStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)
    </span><a name="loc_454_5_454_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_454_5_454_15&#39;)"><span class="hl_fundecl"><span class="mpre">fillBuffer</span></span></a><span class="mpre"> </span><a name="loc_454_16_454_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_454_16_454_20&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> </span><a name="loc_454_21_454_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_454_21_454_25&#39;)"><span class="hl_vardecl"><span class="mpre">step</span></span></a><span class="mpre"> = do
        </span><a name="loc_455_9_455_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_9_455_14&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> &lt;- </span><a href="Data.ByteString.Internal.html#loc_489_1_489_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_489_1_489_17&#39;)"><span class="hl_varref"><span class="mpre">S.mallocByteString</span></span></a><span class="mpre"> </span><a href="#loc_447_9_447_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_9_447_16&#39;)"><span class="hl_varref"><span class="mpre">bufSize</span></span></a><span class="mpre"> 
        let !</span><a name="loc_456_14_456_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_456_14_456_18&#39;)"><span class="hl_vardecl"><span class="mpre">pbuf</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span><span class="mpre"> </span><a href="#loc_455_9_455_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_9_455_14&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre">
                  </span><span class="hl_comment"><span class="mpre">-- safe due to later reference of fpbuf</span></span><span class="mpre">
                  </span><span class="hl_comment"><span class="mpre">-- BETTER than withForeignPtr, as we lose a tail call otherwise</span></span><span class="mpre">
            !</span><a name="loc_459_14_459_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_459_14_459_16&#39;)"><span class="hl_vardecl"><span class="mpre">br</span></span></a><span class="mpre"> = </span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a href="#loc_456_14_456_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_456_14_456_18&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> (</span><a href="#loc_456_14_456_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_456_14_456_18&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_454_16_454_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_454_16_454_20&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">)
        </span><a href="#loc_475_5_475_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_5_475_13&#39;)"><span class="hl_varref"><span class="mpre">fillStep</span></span></a><span class="mpre"> </span><a href="#loc_455_9_455_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_455_9_455_14&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a href="#loc_459_14_459_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_459_14_459_16&#39;)"><span class="hl_varref"><span class="mpre">br</span></span></a><span class="mpre"> </span><a href="#loc_454_21_454_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_454_21_454_25&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre">

    </span><a href="#loc_464_5_464_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_5_464_12&#39;)"><span class="mpre">fillPut</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><a href="#loc_78_6_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_6_78_14&#39;)"><span class="hl_tyconref"><span class="mpre">BufRange</span></span></a><span class="mpre"> -&gt; 
               </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Either</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">S.ByteString</span></span></a><span class="mpre">) (</span><a href="#loc_80_9_80_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_439_6_439_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_6_439_17&#39;)"><span class="hl_tyconref"><span class="mpre">BuildStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">))
    </span><a name="loc_464_5_464_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_5_464_12&#39;)"><span class="hl_fundecl"><span class="mpre">fillPut</span></span></a><span class="mpre"> !</span><a name="loc_464_14_464_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_14_464_19&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> !(</span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_464_31_464_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_31_464_33&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> _) </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> 
      | </span><a href="#loc_469_9_469_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_469_9_469_13&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_464_31_464_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_31_464_33&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
      | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">  = </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
          </span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">S.PS</span></span></a><span class="mpre"> </span><a href="#loc_464_14_464_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_14_464_19&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> (</span><a href="#loc_464_31_464_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_31_464_33&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`minusPtr`</span></span><span class="mpre"> </span><a href="#loc_469_9_469_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_469_9_469_13&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre">)
      where
        </span><a name="loc_469_9_469_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_469_9_469_13&#39;)"><span class="hl_vardecl"><span class="mpre">pbuf</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span><span class="mpre"> </span><a href="#loc_464_14_464_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_14_464_19&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre">
        </span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_469_9_469_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_469_9_469_13&#39;)"><span class="mpre">pbuf</span></a><span class="mpre"> #-}</span></span><span class="mpre">
    </span><a href="#loc_464_5_464_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_5_464_12&#39;)"><span class="hl_fundecl"><span class="mpre">fillPut</span></span></a><span class="mpre"> !</span><a name="loc_471_14_471_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_471_14_471_19&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> !</span><a name="loc_471_21_471_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_471_21_471_23&#39;)"><span class="hl_vardecl"><span class="mpre">br</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre"> =
        </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \(</span><a href="#loc_80_17_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_17_80_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><a name="loc_472_23_472_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_472_23_472_26&#39;)"><span class="hl_vardecl"><span class="mpre">put</span></span></a><span class="mpre">) -&gt; </span><a href="#loc_475_5_475_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_5_475_13&#39;)"><span class="hl_varref"><span class="mpre">fillStep</span></span></a><span class="mpre"> </span><a href="#loc_471_14_471_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_471_14_471_19&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a href="#loc_471_21_471_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_471_21_471_23&#39;)"><span class="hl_varref"><span class="mpre">br</span></span></a><span class="mpre"> (</span><a href="#loc_472_23_472_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_472_23_472_26&#39;)"><span class="hl_varref"><span class="mpre">put</span></span></a><span class="mpre"> </span><a href="#loc_451_5_451_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_451_5_451_14&#39;)"><span class="hl_varref"><span class="mpre">finalStep</span></span></a><span class="mpre">)

    </span><a href="#loc_475_5_475_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_5_475_13&#39;)"><span class="mpre">fillStep</span></a><span class="mpre"> :: forall </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">. </span><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; </span><a href="#loc_78_6_78_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_6_78_14&#39;)"><span class="hl_tyconref"><span class="mpre">BufRange</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">PutStep</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_439_6_439_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_6_439_17&#39;)"><span class="hl_tyconref"><span class="mpre">BuildStream</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)
    </span><a name="loc_475_5_475_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_5_475_13&#39;)"><span class="hl_fundecl"><span class="mpre">fillStep</span></span></a><span class="mpre"> !</span><a name="loc_475_15_475_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_15_475_20&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> !</span><a name="loc_475_22_475_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_22_475_24&#39;)"><span class="hl_specname"><span class="mpre">br</span></span></a><span class="mpre">@(</span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> _ </span><a name="loc_475_37_475_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_37_475_40&#39;)"><span class="hl_vardecl"><span class="mpre">ope</span></span></a><span class="mpre">) </span><a name="loc_475_42_475_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_42_475_46&#39;)"><span class="hl_vardecl"><span class="mpre">step</span></span></a><span class="mpre"> = do
        let </span><a name="loc_476_13_476_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_476_13_476_17&#39;)"><span class="hl_vardecl"><span class="mpre">pbuf</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span><span class="mpre"> </span><a href="#loc_475_15_475_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_15_475_20&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre">
            </span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_476_13_476_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_476_13_476_17&#39;)"><span class="mpre">pbuf</span></a><span class="mpre"> #-}</span></span><span class="mpre">
        </span><a name="loc_478_9_478_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_478_9_478_15&#39;)"><span class="hl_vardecl"><span class="mpre">signal</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_475_42_475_46" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_42_475_46&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_475_22_475_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_22_475_24&#39;)"><span class="hl_varref"><span class="mpre">br</span></span></a><span class="mpre">
        case </span><a href="#loc_478_9_478_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_478_9_478_15&#39;)"><span class="hl_varref"><span class="mpre">signal</span></span></a><span class="mpre"> of
            </span><a href="#loc_85_5_85_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_5_85_9&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> </span><a name="loc_480_18_480_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_480_18_480_21&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a name="loc_480_22_480_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_480_22_480_23&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt; do      </span><span class="hl_comment"><span class="mpre">-- builder completed, buffer partially filled</span></span><span class="mpre">
                let !</span><a name="loc_481_22_481_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_481_22_481_25&#39;)"><span class="hl_vardecl"><span class="mpre">br&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a href="#loc_480_18_480_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_480_18_480_21&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a href="#loc_475_37_475_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_37_475_40&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_441_10_441_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_441_10_441_20&#39;)"><span class="hl_conref"><span class="mpre">BuildYield</span></span></a><span class="mpre"> </span><a href="#loc_480_22_480_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_480_22_480_23&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> (</span><a href="#loc_464_5_464_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_464_5_464_12&#39;)"><span class="hl_varref"><span class="mpre">fillPut</span></span></a><span class="mpre"> </span><a href="#loc_475_15_475_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_15_475_20&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a href="#loc_481_22_481_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_481_22_481_25&#39;)"><span class="hl_varref"><span class="mpre">br&#39;</span></span></a><span class="mpre">)

            </span><a href="#loc_86_5_86_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_15&#39;)"><span class="hl_conref"><span class="mpre">BufferFull</span></span></a><span class="mpre"> </span><a name="loc_484_24_484_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_484_24_484_31&#39;)"><span class="hl_vardecl"><span class="mpre">minSize</span></span></a><span class="mpre"> </span><a name="loc_484_32_484_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_484_32_484_35&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a name="loc_484_36_484_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_484_36_484_44&#39;)"><span class="hl_vardecl"><span class="mpre">nextStep</span></span></a><span class="mpre">  
              | </span><a href="#loc_476_13_476_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_476_13_476_17&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_484_32_484_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_484_32_484_35&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> -&gt; do </span><span class="hl_comment"><span class="mpre">-- nothing written, larger buffer required</span></span><span class="mpre">
                  </span><a href="#loc_454_5_454_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_454_5_454_15&#39;)"><span class="hl_varref"><span class="mpre">fillBuffer</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">max</span></span><span class="mpre"> </span><a href="#loc_447_9_447_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_9_447_16&#39;)"><span class="hl_varref"><span class="mpre">bufSize</span></span></a><span class="mpre"> </span><a href="#loc_484_24_484_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_484_24_484_31&#39;)"><span class="hl_varref"><span class="mpre">minSize</span></span></a><span class="mpre">) </span><a href="#loc_484_36_484_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_484_36_484_44&#39;)"><span class="hl_varref"><span class="mpre">nextStep</span></span></a><span class="mpre">
              | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">   -&gt; do </span><span class="hl_comment"><span class="mpre">-- some bytes written, new buffer required</span></span><span class="mpre">
                  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_440_10_440_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_440_10_440_20&#39;)"><span class="hl_conref"><span class="mpre">BuildChunk</span></span></a><span class="mpre"> 
                    (</span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">S.PS</span></span></a><span class="mpre"> </span><a href="#loc_475_15_475_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_15_475_20&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> (</span><a href="#loc_484_32_484_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_484_32_484_35&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`minusPtr`</span></span><span class="mpre"> </span><a href="#loc_476_13_476_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_476_13_476_17&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre">))
                    (</span><a href="#loc_454_5_454_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_454_5_454_15&#39;)"><span class="hl_varref"><span class="mpre">fillBuffer</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">max</span></span><span class="mpre"> </span><a href="#loc_447_9_447_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_9_447_16&#39;)"><span class="hl_varref"><span class="mpre">bufSize</span></span></a><span class="mpre"> </span><a href="#loc_484_24_484_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_484_24_484_31&#39;)"><span class="hl_varref"><span class="mpre">minSize</span></span></a><span class="mpre">) </span><a href="#loc_484_36_484_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_484_36_484_44&#39;)"><span class="hl_varref"><span class="mpre">nextStep</span></span></a><span class="mpre">)

            </span><a href="#loc_90_5_90_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_21&#39;)"><span class="hl_conref"><span class="mpre">InsertByteString</span></span></a><span class="mpre"> </span><a name="loc_492_30_492_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_30_492_33&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a name="loc_492_34_492_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_34_492_36&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a name="loc_492_37_492_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_37_492_45&#39;)"><span class="hl_vardecl"><span class="mpre">nextStep</span></span></a><span class="mpre">
              | </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_492_34_492_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_34_492_36&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> -&gt; do   </span><span class="hl_comment"><span class="mpre">-- empty bytestrings are ignored</span></span><span class="mpre">
                  let !</span><a name="loc_494_24_494_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_24_494_27&#39;)"><span class="hl_vardecl"><span class="mpre">br&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a href="#loc_492_30_492_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_30_492_33&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a href="#loc_475_37_475_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_37_475_40&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">
                  </span><a href="#loc_475_5_475_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_5_475_13&#39;)"><span class="hl_varref"><span class="mpre">fillStep</span></span></a><span class="mpre"> </span><a href="#loc_475_15_475_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_15_475_20&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a href="#loc_494_24_494_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_494_24_494_27&#39;)"><span class="hl_varref"><span class="mpre">br&#39;</span></span></a><span class="mpre"> </span><a href="#loc_492_37_492_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_37_492_45&#39;)"><span class="hl_varref"><span class="mpre">nextStep</span></span></a><span class="mpre">
              | </span><a href="#loc_476_13_476_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_476_13_476_17&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_492_30_492_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_30_492_33&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> -&gt; do </span><span class="hl_comment"><span class="mpre">-- no bytes written: just insert bytestring</span></span><span class="mpre">
                  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_440_10_440_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_440_10_440_20&#39;)"><span class="hl_conref"><span class="mpre">BuildChunk</span></span></a><span class="mpre"> </span><a href="#loc_492_34_492_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_34_492_36&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> (</span><a href="#loc_454_5_454_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_454_5_454_15&#39;)"><span class="hl_varref"><span class="mpre">fillBuffer</span></span></a><span class="mpre"> </span><a href="#loc_447_9_447_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_9_447_16&#39;)"><span class="hl_varref"><span class="mpre">bufSize</span></span></a><span class="mpre"> </span><a href="#loc_492_37_492_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_37_492_45&#39;)"><span class="hl_varref"><span class="mpre">nextStep</span></span></a><span class="mpre">)
              | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> -&gt; do   </span><span class="hl_comment"><span class="mpre">-- bytes written, insert buffer and bytestring</span></span><span class="mpre">
                  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_440_10_440_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_440_10_440_20&#39;)"><span class="hl_conref"><span class="mpre">BuildChunk</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">S.PS</span></span></a><span class="mpre"> </span><a href="#loc_475_15_475_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_475_15_475_20&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> (</span><a href="#loc_492_30_492_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_30_492_33&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`minusPtr`</span></span><span class="mpre"> </span><a href="#loc_476_13_476_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_476_13_476_17&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre">))
                    (</span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_440_10_440_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_440_10_440_20&#39;)"><span class="hl_conref"><span class="mpre">BuildChunk</span></span></a><span class="mpre"> </span><a href="#loc_492_34_492_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_34_492_36&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> (</span><a href="#loc_454_5_454_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_454_5_454_15&#39;)"><span class="hl_varref"><span class="mpre">fillBuffer</span></span></a><span class="mpre"> </span><a href="#loc_447_9_447_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_9_447_16&#39;)"><span class="hl_varref"><span class="mpre">bufSize</span></span></a><span class="mpre"> </span><a href="#loc_492_37_492_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_492_37_492_45&#39;)"><span class="hl_varref"><span class="mpre">nextStep</span></span></a><span class="mpre">))


</span><a href="#loc_504_1_504_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_504_1_504_18&#39;)"><span class="mpre">toLazyByteString&#39;</span></a><span class="mpre"> :: </span><a href="#loc_80_9_80_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre">
</span><a name="loc_504_1_504_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_504_1_504_18&#39;)"><span class="hl_fundecl"><span class="mpre">toLazyByteString&#39;</span></span></a><span class="mpre"> </span><a name="loc_504_19_504_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_504_19_504_22&#39;)"><span class="hl_vardecl"><span class="mpre">put</span></span></a><span class="mpre"> = 
    </span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">inlinePerformIO</span></span></a><span class="mpre"> (</span><a href="#loc_508_5_508_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_508_5_508_12&#39;)"><span class="hl_varref"><span class="mpre">consume</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><a href="#loc_447_1_447_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_447_1_447_8&#39;)"><span class="hl_varref"><span class="mpre">enumPut</span></span></a><span class="mpre"> </span><a href="#loc_249_1_249_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_1_249_18&#39;)"><span class="hl_varref"><span class="mpre">defaultBufferSize</span></span></a><span class="mpre"> </span><a href="#loc_504_19_504_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_504_19_504_22&#39;)"><span class="hl_varref"><span class="mpre">put</span></span></a><span class="mpre">)
  where
    </span><a href="#loc_508_5_508_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_508_5_508_12&#39;)"><span class="mpre">consume</span></a><span class="mpre"> :: </span><a href="#loc_439_6_439_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_439_6_439_17&#39;)"><span class="hl_tyconref"><span class="mpre">BuildStream</span></span></a><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre"> -&gt; </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre">
    </span><a name="loc_508_5_508_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_508_5_508_12&#39;)"><span class="hl_fundecl"><span class="mpre">consume</span></span></a><span class="mpre"> (</span><a href="#loc_441_10_441_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_441_10_441_20&#39;)"><span class="hl_conref"><span class="mpre">BuildYield</span></span></a><span class="mpre"> _ </span><a name="loc_508_27_508_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_508_27_508_28&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre">) = 
        case </span><a href="#loc_508_27_508_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_508_27_508_28&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre"> of
          </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">   -&gt; </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_19_82_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_19_82_24&#39;)"><span class="hl_conref"><span class="mpre">L.Empty</span></span></a><span class="mpre">
          </span><span class="hl_conref"><span class="mpre">Left</span></span><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_511_22_511_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_511_22_511_24&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre">) -&gt; </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_27_82_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_27_82_32&#39;)"><span class="hl_conref"><span class="mpre">L.Chunk</span></span></a><span class="mpre"> </span><a href="#loc_511_22_511_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_511_22_511_24&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_19_82_24" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_19_82_24&#39;)"><span class="hl_conref"><span class="mpre">L.Empty</span></span></a><span class="mpre">
          </span><span class="hl_conref"><span class="mpre">Right</span></span><span class="mpre"> _        -&gt; </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;toLazyByteString&#39;: enumPut violated postcondition&quot;</span></span><span class="mpre">
    </span><a href="#loc_508_5_508_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_508_5_508_12&#39;)"><span class="hl_fundecl"><span class="mpre">consume</span></span></a><span class="mpre"> (</span><a href="#loc_440_10_440_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_440_10_440_20&#39;)"><span class="hl_conref"><span class="mpre">BuildChunk</span></span></a><span class="mpre"> </span><a name="loc_513_25_513_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_513_25_513_27&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a name="loc_513_28_513_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_513_28_513_36&#39;)"><span class="hl_vardecl"><span class="mpre">ioStream</span></span></a><span class="mpre">) =
        </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_27_82_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_27_82_32&#39;)"><span class="hl_conref"><span class="mpre">L.Chunk</span></span></a><span class="mpre"> </span><a href="#loc_513_25_513_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_513_25_513_27&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">inlinePerformIO</span></span></a><span class="mpre"> (</span><a href="#loc_508_5_508_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_508_5_508_12&#39;)"><span class="hl_varref"><span class="mpre">consume</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`fmap`</span></span><span class="mpre"> </span><a href="#loc_513_28_513_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_513_28_513_36&#39;)"><span class="hl_varref"><span class="mpre">ioStream</span></span></a><span class="mpre">)
        


</span><span class="hl_comment"><span class="mpre">{-
                    BufferFull minSize pf&#39; nextStep  -&gt; do
                        io $ S.PS fpbuf 0 (pf&#39; `minusPtr` pf)
                        fillBuffer (max bufSize minSize) nextStep
                        
                    ModifyChunks pf&#39; bsk nextStep  -&gt; do
                        io $ S.PS fpbuf 0 (pf&#39; `minusPtr` pf)
                        L.foldrChunks (\bs -&gt; (io bs &gt;&gt;)) (return ()) (bsk L.empty)
                        fillBuffer bufSize nextStep
-}</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- More explicit implementation of running builders</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">------------------------------------------------------------------------------</span></span><span class="mpre">


data </span><a name="loc_534_6_534_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_6_534_12&#39;)"><span class="hl_tycondecl"><span class="mpre">Buffer</span></span></a><span class="mpre"> = </span><a name="loc_534_15_534_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_15_534_21&#39;)"><span class="hl_condecl"><span class="mpre">Buffer</span></span></a><span class="mpre"> {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">ForeignPtr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">) </span><span class="hl_comment"><span class="mpre">-- underlying pinned array</span></span><span class="mpre">
                     {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)        </span><span class="hl_comment"><span class="mpre">-- beginning of slice</span></span><span class="mpre">
                     {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)        </span><span class="hl_comment"><span class="mpre">-- next free byte</span></span><span class="mpre">
                     {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre">)        </span><span class="hl_comment"><span class="mpre">-- first byte after buffer</span></span><span class="mpre">

</span><a href="#loc_540_1_540_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_540_1_540_12&#39;)"><span class="mpre">allocBuffer</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><a href="#loc_534_6_534_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_6_534_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre">
</span><a name="loc_540_1_540_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_540_1_540_12&#39;)"><span class="hl_fundecl"><span class="mpre">allocBuffer</span></span></a><span class="mpre"> </span><a name="loc_540_13_540_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_540_13_540_17&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> = do
    </span><a name="loc_541_5_541_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_541_5_541_10&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> &lt;- </span><a href="Data.ByteString.Internal.html#loc_489_1_489_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_489_1_489_17&#39;)"><span class="hl_varref"><span class="mpre">S.mallocByteString</span></span></a><span class="mpre"> </span><a href="#loc_540_13_540_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_540_13_540_17&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">
    let !</span><a name="loc_542_10_542_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_542_10_542_14&#39;)"><span class="hl_vardecl"><span class="mpre">pbuf</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">unsafeForeignPtrToPtr</span></span><span class="mpre"> </span><a href="#loc_541_5_541_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_541_5_541_10&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre">
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$!</span></span><span class="mpre"> </span><a href="#loc_534_15_534_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_15_534_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a href="#loc_541_5_541_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_541_5_541_10&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a href="#loc_542_10_542_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_542_10_542_14&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> </span><a href="#loc_542_10_542_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_542_10_542_14&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> (</span><a href="#loc_542_10_542_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_542_10_542_14&#39;)"><span class="hl_varref"><span class="mpre">pbuf</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`plusPtr`</span></span><span class="mpre"> </span><a href="#loc_540_13_540_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_540_13_540_17&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">)

</span><a href="#loc_546_1_546_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_546_1_546_19&#39;)"><span class="mpre">unsafeFreezeBuffer</span></a><span class="mpre"> :: </span><a href="#loc_534_6_534_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_6_534_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> -&gt; </span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">S.ByteString</span></span></a><span class="mpre">
</span><a name="loc_546_1_546_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_546_1_546_19&#39;)"><span class="hl_fundecl"><span class="mpre">unsafeFreezeBuffer</span></span></a><span class="mpre"> (</span><a href="#loc_534_15_534_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_15_534_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a name="loc_546_28_546_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_546_28_546_33&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a name="loc_546_34_546_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_546_34_546_36&#39;)"><span class="hl_vardecl"><span class="mpre">p0</span></span></a><span class="mpre"> </span><a name="loc_546_37_546_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_546_37_546_39&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> _) = 
    </span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">S.PS</span></span></a><span class="mpre"> </span><a href="#loc_546_28_546_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_546_28_546_33&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> (</span><a href="#loc_546_37_546_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_546_37_546_39&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`minusPtr`</span></span><span class="mpre"> </span><a href="#loc_546_34_546_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_546_34_546_36&#39;)"><span class="hl_varref"><span class="mpre">p0</span></span></a><span class="mpre">)

</span><a href="#loc_550_1_550_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_1_550_27&#39;)"><span class="mpre">unsafeFreezeNonEmptyBuffer</span></a><span class="mpre"> :: </span><a href="#loc_534_6_534_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_6_534_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">S.ByteString</span></span></a><span class="mpre">
</span><a name="loc_550_1_550_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_1_550_27&#39;)"><span class="hl_fundecl"><span class="mpre">unsafeFreezeNonEmptyBuffer</span></span></a><span class="mpre"> (</span><a href="#loc_534_15_534_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_15_534_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a name="loc_550_36_550_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_36_550_41&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a name="loc_550_42_550_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_42_550_44&#39;)"><span class="hl_vardecl"><span class="mpre">p0</span></span></a><span class="mpre"> </span><a name="loc_550_45_550_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_45_550_47&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> _) 
  | </span><a href="#loc_550_42_550_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_42_550_44&#39;)"><span class="hl_varref"><span class="mpre">p0</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_550_45_550_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_45_550_47&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre">  = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.ByteString.Internal.html#loc_193_19_193_21" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_19_193_21&#39;)"><span class="hl_conref"><span class="mpre">S.PS</span></span></a><span class="mpre"> </span><a href="#loc_550_36_550_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_36_550_41&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> (</span><a href="#loc_550_45_550_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_45_550_47&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`minusPtr`</span></span><span class="mpre"> </span><a href="#loc_550_42_550_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_42_550_44&#39;)"><span class="hl_varref"><span class="mpre">p0</span></span></a><span class="mpre">)

</span><a href="#loc_555_1_555_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_555_1_555_10&#39;)"><span class="mpre">nextSlice</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_534_6_534_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_6_534_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><a href="#loc_534_6_534_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_6_534_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre">
</span><a name="loc_555_1_555_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_555_1_555_10&#39;)"><span class="hl_fundecl"><span class="mpre">nextSlice</span></span></a><span class="mpre"> </span><a name="loc_555_11_555_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_555_11_555_18&#39;)"><span class="hl_vardecl"><span class="mpre">minSize</span></span></a><span class="mpre"> (</span><a href="#loc_534_15_534_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_15_534_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a name="loc_555_27_555_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_555_27_555_32&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> _ </span><a name="loc_555_35_555_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_555_35_555_37&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> </span><a name="loc_555_38_555_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_555_38_555_41&#39;)"><span class="hl_vardecl"><span class="mpre">ope</span></span></a><span class="mpre">)
  | </span><a href="#loc_555_38_555_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_555_38_555_41&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">`minusPtr`</span></span><span class="mpre"> </span><a href="#loc_555_35_555_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_555_35_555_37&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">&lt;=</span></span><span class="mpre"> </span><a href="#loc_555_11_555_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_555_11_555_18&#39;)"><span class="hl_varref"><span class="mpre">minSize</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
  | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre">                    = </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a href="#loc_534_15_534_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_15_534_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a href="#loc_555_27_555_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_555_27_555_32&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a href="#loc_555_35_555_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_555_35_555_37&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><a href="#loc_555_35_555_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_555_35_555_37&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><a href="#loc_555_38_555_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_555_38_555_41&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">)

</span><a href="#loc_566_1_566_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_566_1_566_7&#39;)"><span class="mpre">runPut</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/FastPut.hs&quot;, srcSpanStartLine = 559, srcSpanStartColumn = 11, srcSpanEndLine = 560, srcSpanEndColumn = 10}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/blaze-builder-0.3.3.2/benchmarks/FastPut.hs&quot;, srcSpanStartLine = 560, srcSpanStartColumn = 8, srcSpanEndLine = 560, srcSpanEndColumn = 10}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/"><span class="mpre">Monad m 
       =&gt;</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_84_6_84_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_6_84_15&#39;)"><span class="hl_tyconref"><span class="mpre">PutSignal</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> (</span><a href="#loc_84_6_84_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_6_84_15&#39;)"><span class="hl_tyconref"><span class="mpre">PutSignal</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)) </span><span class="hl_comment"><span class="mpre">-- lifting of buildsteps</span></span><span class="mpre">
       -&gt; (</span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><a href="#loc_534_6_534_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_6_534_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><a href="#loc_534_6_534_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_6_534_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre">) </span><span class="hl_comment"><span class="mpre">-- output function for a guaranteedly non-empty buffer, the returned buffer will be filled next</span></span><span class="mpre">
       -&gt; (</span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">S.ByteString</span></span></a><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">)    </span><span class="hl_comment"><span class="mpre">-- output function for guaranteedly non-empty bytestrings, that are inserted directly into the stream</span></span><span class="mpre">
       -&gt; </span><a href="#loc_80_9_80_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">                     </span><span class="hl_comment"><span class="mpre">-- put to execute</span></span><span class="mpre">
       -&gt; </span><a href="#loc_534_6_534_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_6_534_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre">                    </span><span class="hl_comment"><span class="mpre">-- initial buffer to be used</span></span><span class="mpre">
       -&gt; </span><span class="hl_tyvar"><span class="mpre">m</span></span><span class="mpre"> (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><a href="#loc_534_6_534_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_6_534_12&#39;)"><span class="hl_tyconref"><span class="mpre">Buffer</span></span></a><span class="mpre">)             </span><span class="hl_comment"><span class="mpre">-- result of put and remaining buffer</span></span><span class="mpre">
</span><a name="loc_566_1_566_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_566_1_566_7&#39;)"><span class="hl_fundecl"><span class="mpre">runPut</span></span></a><span class="mpre"> </span><a name="loc_566_8_566_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_566_8_566_14&#39;)"><span class="hl_vardecl"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><a name="loc_566_15_566_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_566_15_566_24&#39;)"><span class="hl_vardecl"><span class="mpre">outputBuf</span></span></a><span class="mpre"> </span><a name="loc_566_25_566_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_566_25_566_33&#39;)"><span class="hl_vardecl"><span class="mpre">outputBS</span></span></a><span class="mpre"> (</span><a href="#loc_80_17_80_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_17_80_20&#39;)"><span class="hl_conref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><a name="loc_566_39_566_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_566_39_566_42&#39;)"><span class="hl_vardecl"><span class="mpre">put</span></span></a><span class="mpre">) =
    </span><a href="#loc_571_5_571_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_5_571_12&#39;)"><span class="hl_varref"><span class="mpre">runStep</span></span></a><span class="mpre"> (</span><a href="#loc_566_39_566_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_566_39_566_42&#39;)"><span class="hl_varref"><span class="mpre">put</span></span></a><span class="mpre"> </span><a href="#loc_569_5_569_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_569_5_569_14&#39;)"><span class="hl_varref"><span class="mpre">finalStep</span></span></a><span class="mpre">)
  where
    </span><a name="loc_569_5_569_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_569_5_569_14&#39;)"><span class="hl_fundecl"><span class="mpre">finalStep</span></span></a><span class="mpre"> </span><a name="loc_569_15_569_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_569_15_569_16&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> !(</span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_569_28_569_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_569_28_569_30&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> _) = </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_85_5_85_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_5_85_9&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> </span><a href="#loc_569_28_569_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_569_28_569_30&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><a href="#loc_569_15_569_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_569_15_569_16&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">

    </span><a name="loc_571_5_571_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_5_571_12&#39;)"><span class="hl_fundecl"><span class="mpre">runStep</span></span></a><span class="mpre"> </span><a name="loc_571_13_571_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_13_571_17&#39;)"><span class="hl_vardecl"><span class="mpre">step</span></span></a><span class="mpre"> </span><a name="loc_571_18_571_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_18_571_21&#39;)"><span class="hl_specname"><span class="mpre">buf</span></span></a><span class="mpre">@(</span><a href="#loc_534_15_534_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_15_534_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a name="loc_571_30_571_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_30_571_35&#39;)"><span class="hl_vardecl"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a name="loc_571_36_571_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_36_571_38&#39;)"><span class="hl_vardecl"><span class="mpre">p0</span></span></a><span class="mpre"> </span><a name="loc_571_39_571_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_39_571_41&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> </span><a name="loc_571_42_571_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_42_571_45&#39;)"><span class="hl_vardecl"><span class="mpre">ope</span></span></a><span class="mpre">) = do
        let !</span><a name="loc_572_14_572_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_572_14_572_16&#39;)"><span class="hl_vardecl"><span class="mpre">br</span></span></a><span class="mpre"> = </span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a href="#loc_571_39_571_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_39_571_41&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><a href="#loc_571_42_571_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_42_571_45&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">
        </span><a name="loc_573_9_573_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_573_9_573_15&#39;)"><span class="hl_vardecl"><span class="mpre">signal</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_566_8_566_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_566_8_566_14&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_571_13_571_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_13_571_17&#39;)"><span class="hl_varref"><span class="mpre">step</span></span></a><span class="mpre"> </span><a href="#loc_572_14_572_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_572_14_572_16&#39;)"><span class="hl_varref"><span class="mpre">br</span></span></a><span class="mpre">
        case </span><a href="#loc_573_9_573_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_573_9_573_15&#39;)"><span class="hl_varref"><span class="mpre">signal</span></span></a><span class="mpre"> of 
            </span><a href="#loc_85_5_85_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_5_85_9&#39;)"><span class="hl_conref"><span class="mpre">Done</span></span></a><span class="mpre"> </span><a name="loc_575_18_575_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_575_18_575_21&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a name="loc_575_22_575_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_575_22_575_23&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> -&gt;         </span><span class="hl_comment"><span class="mpre">-- put completed, buffer partially runSteped</span></span><span class="mpre">
                </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_575_22_575_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_575_22_575_23&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">, </span><a href="#loc_534_15_534_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_15_534_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a href="#loc_571_30_571_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_30_571_35&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a href="#loc_571_36_571_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_36_571_38&#39;)"><span class="hl_varref"><span class="mpre">p0</span></span></a><span class="mpre"> </span><a href="#loc_575_18_575_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_575_18_575_21&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a href="#loc_571_42_571_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_42_571_45&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">)

            </span><a href="#loc_86_5_86_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_15&#39;)"><span class="hl_conref"><span class="mpre">BufferFull</span></span></a><span class="mpre"> </span><a name="loc_578_24_578_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_578_24_578_31&#39;)"><span class="hl_vardecl"><span class="mpre">minSize</span></span></a><span class="mpre"> </span><a name="loc_578_32_578_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_578_32_578_35&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a name="loc_578_36_578_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_578_36_578_44&#39;)"><span class="hl_vardecl"><span class="mpre">nextStep</span></span></a><span class="mpre"> -&gt; do
                </span><a name="loc_579_17_579_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_579_17_579_21&#39;)"><span class="hl_vardecl"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_566_15_566_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_566_15_566_24&#39;)"><span class="hl_varref"><span class="mpre">outputBuf</span></span></a><span class="mpre"> </span><a href="#loc_578_24_578_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_578_24_578_31&#39;)"><span class="hl_varref"><span class="mpre">minSize</span></span></a><span class="mpre"> (</span><a href="#loc_534_15_534_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_15_534_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a href="#loc_571_30_571_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_30_571_35&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a href="#loc_571_36_571_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_36_571_38&#39;)"><span class="hl_varref"><span class="mpre">p0</span></span></a><span class="mpre"> </span><a href="#loc_578_32_578_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_578_32_578_35&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a href="#loc_571_42_571_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_42_571_45&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">)
                </span><a href="#loc_571_5_571_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_5_571_12&#39;)"><span class="hl_varref"><span class="mpre">runStep</span></span></a><span class="mpre"> </span><a href="#loc_578_36_578_44" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_578_36_578_44&#39;)"><span class="hl_varref"><span class="mpre">nextStep</span></span></a><span class="mpre"> </span><a href="#loc_579_17_579_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_579_17_579_21&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">

            </span><a href="#loc_90_5_90_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_21&#39;)"><span class="hl_conref"><span class="mpre">InsertByteString</span></span></a><span class="mpre"> </span><a name="loc_582_30_582_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_30_582_33&#39;)"><span class="hl_vardecl"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a name="loc_582_34_582_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_34_582_36&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> </span><a name="loc_582_37_582_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_37_582_45&#39;)"><span class="hl_vardecl"><span class="mpre">nextStep</span></span></a><span class="mpre">
              | </span><span class="hl_varref"><span class="mpre">S.null</span></span><span class="mpre"> </span><a href="#loc_582_34_582_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_34_582_36&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre"> -&gt;   </span><span class="hl_comment"><span class="mpre">-- flushing of buffer required</span></span><span class="mpre">
                  </span><a href="#loc_566_15_566_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_566_15_566_24&#39;)"><span class="hl_varref"><span class="mpre">outputBuf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> (</span><a href="#loc_534_15_534_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_15_534_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a href="#loc_571_30_571_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_30_571_35&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a href="#loc_571_36_571_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_36_571_38&#39;)"><span class="hl_varref"><span class="mpre">p0</span></span></a><span class="mpre"> </span><a href="#loc_582_30_582_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_30_582_33&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a href="#loc_571_42_571_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_42_571_45&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a href="#loc_571_5_571_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_5_571_12&#39;)"><span class="hl_varref"><span class="mpre">runStep</span></span></a><span class="mpre"> </span><a href="#loc_582_37_582_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_37_582_45&#39;)"><span class="hl_varref"><span class="mpre">nextStep</span></span></a><span class="mpre">
              | </span><a href="#loc_571_36_571_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_36_571_38&#39;)"><span class="hl_varref"><span class="mpre">p0</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_582_30_582_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_30_582_33&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> -&gt; do </span><span class="hl_comment"><span class="mpre">-- no bytes written: just insert bytestring</span></span><span class="mpre">
                  </span><a href="#loc_566_25_566_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_566_25_566_33&#39;)"><span class="hl_varref"><span class="mpre">outputBS</span></span></a><span class="mpre"> </span><a href="#loc_582_34_582_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_34_582_36&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
                  </span><a href="#loc_571_5_571_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_5_571_12&#39;)"><span class="hl_varref"><span class="mpre">runStep</span></span></a><span class="mpre"> </span><a href="#loc_582_37_582_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_37_582_45&#39;)"><span class="hl_varref"><span class="mpre">nextStep</span></span></a><span class="mpre"> </span><a href="#loc_571_18_571_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_18_571_21&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre">
              | </span><span class="hl_varref"><span class="mpre">otherwise</span></span><span class="mpre"> -&gt; do   </span><span class="hl_comment"><span class="mpre">-- bytes written, insert buffer and bytestring</span></span><span class="mpre">
                  </span><a name="loc_589_19_589_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_589_19_589_23&#39;)"><span class="hl_vardecl"><span class="mpre">buf&#39;</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_566_15_566_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_566_15_566_24&#39;)"><span class="hl_varref"><span class="mpre">outputBuf</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre"> (</span><a href="#loc_534_15_534_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_534_15_534_21&#39;)"><span class="hl_conref"><span class="mpre">Buffer</span></span></a><span class="mpre"> </span><a href="#loc_571_30_571_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_30_571_35&#39;)"><span class="hl_varref"><span class="mpre">fpbuf</span></span></a><span class="mpre"> </span><a href="#loc_571_36_571_38" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_36_571_38&#39;)"><span class="hl_varref"><span class="mpre">p0</span></span></a><span class="mpre"> </span><a href="#loc_582_30_582_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_30_582_33&#39;)"><span class="hl_varref"><span class="mpre">op&#39;</span></span></a><span class="mpre"> </span><a href="#loc_571_42_571_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_42_571_45&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">)
                  </span><a href="#loc_566_25_566_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_566_25_566_33&#39;)"><span class="hl_varref"><span class="mpre">outputBS</span></span></a><span class="mpre"> </span><a href="#loc_582_34_582_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_34_582_36&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">
                  </span><a href="#loc_571_5_571_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_571_5_571_12&#39;)"><span class="hl_varref"><span class="mpre">runStep</span></span></a><span class="mpre"> </span><a href="#loc_582_37_582_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_582_37_582_45&#39;)"><span class="hl_varref"><span class="mpre">nextStep</span></span></a><span class="mpre"> </span><a href="#loc_589_19_589_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_589_19_589_23&#39;)"><span class="hl_varref"><span class="mpre">buf&#39;</span></span></a><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_566_1_566_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_566_1_566_7&#39;)"><span class="mpre">runPut</span></a><span class="mpre"> #-}</span></span><span class="mpre">
              
</span><span class="hl_comment"><span class="mpre">-- | A monad for lazily composing lazy bytestrings using continuations.</span></span><span class="mpre">
newtype </span><a name="loc_595_9_595_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_9_595_13&#39;)"><span class="hl_tycondecl"><span class="mpre">LBSM</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_595_18_595_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_18_595_22&#39;)"><span class="hl_condecl"><span class="mpre">LBSM</span></span></a><span class="mpre"> { </span><a name="loc_595_25_595_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_25_595_31&#39;)"><span class="hl_fielddecl"><span class="mpre">unLBSM</span></span></a><span class="mpre"> :: (</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">, </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre"> -&gt; </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre">) }

instance </span><span class="hl_classref"><span class="mpre">Monad</span></span><span class="mpre"> </span><a href="#loc_595_9_595_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_9_595_13&#39;)"><span class="hl_tyconref"><span class="mpre">LBSM</span></span></a><span class="mpre"> where
    </span><span class="hl_fundecl"><span class="mpre">return</span></span><span class="mpre"> </span><a name="loc_598_12_598_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_598_12_598_13&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">                       = </span><a href="#loc_595_18_595_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_18_595_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><a href="#loc_598_12_598_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_598_12_598_13&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">)
    (</span><a href="#loc_595_18_595_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_18_595_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><a name="loc_599_12_599_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_599_12_599_13&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">,</span><a name="loc_599_14_599_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_599_14_599_15&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre">)) </span><span class="hl_fundecl"><span class="mpre">&gt;&gt;=</span></span><span class="mpre"> </span><a name="loc_599_22_599_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_599_22_599_23&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre">             = let </span><a href="#loc_595_18_595_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_18_595_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><a name="loc_599_48_599_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_599_48_599_50&#39;)"><span class="hl_vardecl"><span class="mpre">x&#39;</span></span></a><span class="mpre">,</span><a name="loc_599_51_599_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_599_51_599_53&#39;)"><span class="hl_vardecl"><span class="mpre">k&#39;</span></span></a><span class="mpre">) = </span><a href="#loc_599_22_599_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_599_22_599_23&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre"> </span><a href="#loc_599_12_599_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_599_12_599_13&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre"> in </span><a href="#loc_595_18_595_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_18_595_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><a href="#loc_599_48_599_50" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_599_48_599_50&#39;)"><span class="hl_varref"><span class="mpre">x&#39;</span></span></a><span class="mpre">, </span><a href="#loc_599_14_599_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_599_14_599_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_599_51_599_53" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_599_51_599_53&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre">)
    (</span><a href="#loc_595_18_595_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_18_595_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (_,</span><a name="loc_600_14_600_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_600_14_600_15&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre">)) </span><span class="hl_fundecl"><span class="mpre">&gt;&gt;</span></span><span class="mpre"> (</span><a href="#loc_595_18_595_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_18_595_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><a name="loc_600_28_600_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_600_28_600_30&#39;)"><span class="hl_vardecl"><span class="mpre">x&#39;</span></span></a><span class="mpre">,</span><a name="loc_600_31_600_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_600_31_600_33&#39;)"><span class="hl_vardecl"><span class="mpre">k&#39;</span></span></a><span class="mpre">)) = </span><a href="#loc_595_18_595_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_18_595_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><a href="#loc_600_28_600_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_600_28_600_30&#39;)"><span class="hl_varref"><span class="mpre">x&#39;</span></span></a><span class="mpre">, </span><a href="#loc_600_14_600_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_600_14_600_15&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_600_31_600_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_600_31_600_33&#39;)"><span class="hl_varref"><span class="mpre">k&#39;</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Execute a put and return the written buffers as the chunks of a lazy</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- bytestring.</span></span><span class="mpre">
</span><a href="#loc_605_1_605_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_1_605_18&#39;)"><span class="mpre">toLazyByteString2</span></a><span class="mpre"> :: </span><a href="#loc_80_9_80_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_80_9_80_12&#39;)"><span class="hl_tyconref"><span class="mpre">Put</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_6_82_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_6_82_16&#39;)"><span class="hl_tyconref"><span class="mpre">L.ByteString</span></span></a><span class="mpre">
</span><a name="loc_605_1_605_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_1_605_18&#39;)"><span class="hl_fundecl"><span class="mpre">toLazyByteString2</span></span></a><span class="mpre"> </span><a name="loc_605_19_605_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_19_605_22&#39;)"><span class="hl_vardecl"><span class="mpre">put</span></span></a><span class="mpre"> = 
    </span><a href="#loc_611_19_611_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_611_19_611_20&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> (</span><a href="#loc_613_5_613_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_5_613_17&#39;)"><span class="hl_varref"><span class="mpre">bufToLBSCont</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">snd</span></span><span class="mpre"> </span><a href="#loc_611_11_611_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_611_11_611_17&#39;)"><span class="hl_varref"><span class="mpre">result</span></span></a><span class="mpre">) </span><span class="hl_varref"><span class="mpre">L.empty</span></span><span class="mpre">)
  where
    </span><span class="hl_comment"><span class="mpre">-- initial buffer</span></span><span class="mpre">
    </span><a name="loc_609_5_609_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_609_5_609_9&#39;)"><span class="hl_vardecl"><span class="mpre">buf0</span></span></a><span class="mpre"> = </span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">inlinePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_540_1_540_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_540_1_540_12&#39;)"><span class="hl_varref"><span class="mpre">allocBuffer</span></span></a><span class="mpre"> </span><a href="#loc_249_1_249_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_1_249_18&#39;)"><span class="hl_varref"><span class="mpre">defaultBufferSize</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- run put, but don&#39;t force result =&gt; we&#39;re lazy enough</span></span><span class="mpre">
    </span><a href="#loc_595_18_595_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_18_595_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><a name="loc_611_11_611_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_611_11_611_17&#39;)"><span class="hl_vardecl"><span class="mpre">result</span></span></a><span class="mpre">, </span><a name="loc_611_19_611_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_611_19_611_20&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre">) = </span><a href="#loc_566_1_566_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_566_1_566_7&#39;)"><span class="hl_varref"><span class="mpre">runPut</span></span></a><span class="mpre"> </span><a href="#loc_615_5_615_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_615_5_615_11&#39;)"><span class="hl_varref"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><a href="#loc_617_5_617_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_617_5_617_14&#39;)"><span class="hl_varref"><span class="mpre">outputBuf</span></span></a><span class="mpre"> </span><a href="#loc_622_5_622_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_622_5_622_13&#39;)"><span class="hl_varref"><span class="mpre">outputBS</span></span></a><span class="mpre"> </span><a href="#loc_605_19_605_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_19_605_22&#39;)"><span class="hl_varref"><span class="mpre">put</span></span></a><span class="mpre"> </span><a href="#loc_609_5_609_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_609_5_609_9&#39;)"><span class="hl_varref"><span class="mpre">buf0</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- convert a buffer to a lazy bytestring continuation</span></span><span class="mpre">
    </span><a name="loc_613_5_613_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_5_613_17&#39;)"><span class="hl_vardecl"><span class="mpre">bufToLBSCont</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">maybe</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre"> </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_27_82_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_27_82_32&#39;)"><span class="hl_conref"><span class="mpre">L.Chunk</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_550_1_550_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_550_1_550_27&#39;)"><span class="hl_varref"><span class="mpre">unsafeFreezeNonEmptyBuffer</span></span></a><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- lifting an io putsignal to a lazy bytestring monad</span></span><span class="mpre">
    </span><a name="loc_615_5_615_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_615_5_615_11&#39;)"><span class="hl_fundecl"><span class="mpre">liftIO</span></span></a><span class="mpre"> </span><a name="loc_615_12_615_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_615_12_615_14&#39;)"><span class="hl_vardecl"><span class="mpre">io</span></span></a><span class="mpre"> = </span><a href="#loc_595_18_595_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_18_595_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">inlinePerformIO</span></span></a><span class="mpre"> </span><a href="#loc_615_12_615_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_615_12_615_14&#39;)"><span class="hl_varref"><span class="mpre">io</span></span></a><span class="mpre">, </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">)
    </span><span class="hl_comment"><span class="mpre">-- add buffer as a chunk prepare allocation of new one</span></span><span class="mpre">
    </span><a name="loc_617_5_617_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_617_5_617_14&#39;)"><span class="hl_fundecl"><span class="mpre">outputBuf</span></span></a><span class="mpre"> </span><a name="loc_617_15_617_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_617_15_617_22&#39;)"><span class="hl_vardecl"><span class="mpre">minSize</span></span></a><span class="mpre"> </span><a name="loc_617_23_617_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_617_23_617_26&#39;)"><span class="hl_vardecl"><span class="mpre">buf</span></span></a><span class="mpre"> = </span><a href="#loc_595_18_595_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_18_595_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre">
        ( </span><a href="Data.ByteString.Internal.html#loc_592_1_592_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_592_1_592_16&#39;)"><span class="hl_varref"><span class="mpre">inlinePerformIO</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_540_1_540_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_540_1_540_12&#39;)"><span class="hl_varref"><span class="mpre">allocBuffer</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">max</span></span><span class="mpre"> </span><a href="#loc_617_15_617_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_617_15_617_22&#39;)"><span class="hl_varref"><span class="mpre">minSize</span></span></a><span class="mpre"> </span><a href="#loc_249_1_249_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_249_1_249_18&#39;)"><span class="hl_varref"><span class="mpre">defaultBufferSize</span></span></a><span class="mpre">)
        , </span><a href="#loc_613_5_613_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_613_5_613_17&#39;)"><span class="hl_varref"><span class="mpre">bufToLBSCont</span></span></a><span class="mpre"> </span><a href="#loc_617_23_617_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_617_23_617_26&#39;)"><span class="hl_varref"><span class="mpre">buf</span></span></a><span class="mpre"> )
    </span><span class="hl_comment"><span class="mpre">-- add bytestring directly as a chunk; exploits postcondition of runPut</span></span><span class="mpre">
    </span><span class="hl_comment"><span class="mpre">-- that bytestrings are non-empty</span></span><span class="mpre">
    </span><a name="loc_622_5_622_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_622_5_622_13&#39;)"><span class="hl_fundecl"><span class="mpre">outputBS</span></span></a><span class="mpre"> </span><a name="loc_622_14_622_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_622_14_622_16&#39;)"><span class="hl_vardecl"><span class="mpre">bs</span></span></a><span class="mpre"> = </span><a href="#loc_595_18_595_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_595_18_595_22&#39;)"><span class="hl_conref"><span class="mpre">LBSM</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">()</span></span><span class="mpre">, </span><a href="Data.ByteString.Lazy.Internal.html#loc_82_27_82_32" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Lazy.Internal.html#loc_82_27_82_32&#39;)"><span class="hl_conref"><span class="mpre">L.Chunk</span></span></a><span class="mpre"> </span><a href="#loc_622_14_622_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_622_14_622_16&#39;)"><span class="hl_varref"><span class="mpre">bs</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | A Builder that traces a message</span></span><span class="mpre">
</span><a href="#loc_626_1_626_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_626_1_626_13&#39;)"><span class="mpre">traceBuilder</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><a href="#loc_109_9_109_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_9_109_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre"> 
</span><a name="loc_626_1_626_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_626_1_626_13&#39;)"><span class="hl_fundecl"><span class="mpre">traceBuilder</span></span></a><span class="mpre"> </span><a name="loc_626_14_626_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_626_14_626_17&#39;)"><span class="hl_vardecl"><span class="mpre">msg</span></span></a><span class="mpre"> = </span><a href="#loc_109_19_109_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_19_109_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_626_31_626_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_626_31_626_32&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> </span><a name="loc_626_33_626_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_626_33_626_35&#39;)"><span class="hl_specname"><span class="mpre">br</span></span></a><span class="mpre">@(</span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_626_46_626_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_626_46_626_48&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> </span><a name="loc_626_49_626_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_626_49_626_52&#39;)"><span class="hl_vardecl"><span class="mpre">ope</span></span></a><span class="mpre">) -&gt; do
    </span><span class="hl_varref"><span class="mpre">putStrLn</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;traceBuilder &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">show</span></span><span class="mpre"> (</span><a href="#loc_626_46_626_48" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_626_46_626_48&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre">, </span><a href="#loc_626_49_626_52" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_626_49_626_52&#39;)"><span class="hl_varref"><span class="mpre">ope</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;: &quot;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> </span><a href="#loc_626_14_626_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_626_14_626_17&#39;)"><span class="hl_varref"><span class="mpre">msg</span></span></a><span class="mpre">
    </span><a href="#loc_626_31_626_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_626_31_626_32&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre"> </span><a href="#loc_626_33_626_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_626_33_626_35&#39;)"><span class="hl_varref"><span class="mpre">br</span></span></a><span class="mpre">

</span><a href="#loc_631_1_631_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_631_1_631_13&#39;)"><span class="mpre">flushBuilder</span></a><span class="mpre"> :: </span><a href="#loc_109_9_109_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_9_109_16&#39;)"><span class="hl_tyconref"><span class="mpre">Builder</span></span></a><span class="mpre">
</span><a name="loc_631_1_631_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_631_1_631_13&#39;)"><span class="hl_vardecl"><span class="mpre">flushBuilder</span></span></a><span class="mpre"> = </span><a href="#loc_109_19_109_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_19_109_26&#39;)"><span class="hl_conref"><span class="mpre">Builder</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \</span><a name="loc_631_27_631_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_631_27_631_28&#39;)"><span class="hl_vardecl"><span class="mpre">k</span></span></a><span class="mpre"> (</span><a href="#loc_78_17_78_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_17_78_25&#39;)"><span class="hl_conref"><span class="mpre">BufRange</span></span></a><span class="mpre"> </span><a name="loc_631_39_631_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_631_39_631_41&#39;)"><span class="hl_vardecl"><span class="mpre">op</span></span></a><span class="mpre"> _) -&gt; do
    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_90_5_90_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_90_5_90_21&#39;)"><span class="hl_conref"><span class="mpre">InsertByteString</span></span></a><span class="mpre"> </span><a href="#loc_631_39_631_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_631_39_631_41&#39;)"><span class="hl_varref"><span class="mpre">op</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">S.empty</span></span><span class="mpre"> </span><a href="#loc_631_27_631_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_631_27_631_28&#39;)"><span class="hl_varref"><span class="mpre">k</span></span></a><span class="mpre">

</span><a href="#loc_635_1_635_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_635_1_635_6&#39;)"><span class="mpre">test2</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Word8</span></span><span class="mpre"> -&gt; [</span><a href="Data.ByteString.Internal.html#loc_193_6_193_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.ByteString.Internal.html#loc_193_6_193_16&#39;)"><span class="hl_tyconref"><span class="mpre">S.ByteString</span></span></a><span class="mpre">]
</span><a name="loc_635_1_635_6" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_635_1_635_6&#39;)"><span class="hl_fundecl"><span class="mpre">test2</span></span></a><span class="mpre"> </span><a name="loc_635_7_635_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_635_7_635_8&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">L.toChunks</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_605_1_605_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_605_1_605_18&#39;)"><span class="hl_varref"><span class="mpre">toLazyByteString2</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="#loc_120_1_120_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_1_120_12&#39;)"><span class="hl_varref"><span class="mpre">fromBuilder</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> </span><a href="Data.Monoid.html#loc_84_9_84_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Monoid.html#loc_84_9_84_16&#39;)"><span class="hl_varref"><span class="mpre">mconcat</span></span></a><span class="mpre">
  [ </span><a href="#loc_626_1_626_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_626_1_626_13&#39;)"><span class="hl_varref"><span class="mpre">traceBuilder</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;before flush&quot;</span></span><span class="mpre"> 
  , </span><a href="#loc_154_1_154_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_10&#39;)"><span class="hl_varref"><span class="mpre">fromWord8</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">48</span></span><span class="mpre">
  , </span><a href="#loc_631_1_631_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_631_1_631_13&#39;)"><span class="hl_varref"><span class="mpre">flushBuilder</span></span></a><span class="mpre">
  , </span><a href="#loc_631_1_631_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_631_1_631_13&#39;)"><span class="hl_varref"><span class="mpre">flushBuilder</span></span></a><span class="mpre">
  , </span><a href="#loc_626_1_626_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_626_1_626_13&#39;)"><span class="hl_varref"><span class="mpre">traceBuilder</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;after flush&quot;</span></span><span class="mpre">
  , </span><a href="#loc_154_1_154_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_154_1_154_10&#39;)"><span class="hl_varref"><span class="mpre">fromWord8</span></span></a><span class="mpre"> </span><a href="#loc_635_7_635_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_635_7_635_8&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
  ]

</span></div></body></html>