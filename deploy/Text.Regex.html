<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="/static/nemnem.css"><script src="/static/jquery-2.0.3.min.js"></script><script src="/static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# OPTIONS_GHC -fno-warn-name-shadowing #-}
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Text.Regex</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) Chris Kuklewicz 2006, derived from (c) The University of Glasgow 2001</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD-style (see the file LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  libraries@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (regex-base needs MPTC+FD)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Regular expression matching.  Uses the POSIX regular expression</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- interface in &quot;Text.Regex.Posix&quot;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">---------------------------------------------------------------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Modified by Chris Kuklewicz to be a thin layer over the regex-posix</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- package, and moved into a regex-compat package.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
module Text.Regex (
    </span><span class="hl_comment"><span class="mpre">-- * Regular expressions</span></span><span class="mpre">
    Regex,
    mkRegex,
    mkRegexWithOpts,
    matchRegex,
    matchRegexAll,
    subRegex,
    splitRegex
  ) where

import Data.Array((!))
import Data.Bits((.|.))
import Text.Regex.Base(</span><a href="Text.Regex.Base.RegexLike.html#loc_98_47_98_57" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.Base.RegexLike.html#loc_98_47_98_57&#39;)"><span class="mpre">RegexMaker</span></a><span class="mpre">(</span><a href="Text.Regex.Base.RegexLike.html#loc_103_3_103_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.Base.RegexLike.html#loc_103_3_103_16&#39;)"><span class="mpre">makeRegexOpts</span></a><span class="mpre">),</span><a href="Text.Regex.Base.RegexLike.html#loc_78_3_78_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.Base.RegexLike.html#loc_78_3_78_17&#39;)"><span class="mpre">defaultExecOpt</span></a><span class="mpre">,</span><a href="Text.Regex.Base.RegexLike.html#loc_130_26_130_35" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.Base.RegexLike.html#loc_130_26_130_35&#39;)"><span class="mpre">RegexLike</span></a><span class="mpre">(</span><a href="Text.Regex.Base.RegexLike.html#loc_141_3_141_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.Base.RegexLike.html#loc_141_3_141_11&#39;)"><span class="mpre">matchAll</span></a><span class="mpre">,</span><a href="Text.Regex.Base.RegexLike.html#loc_150_3_150_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.Base.RegexLike.html#loc_150_3_150_15&#39;)"><span class="mpre">matchAllText</span></a><span class="mpre">),</span><a href="Text.Regex.Base.RegexLike.html#loc_190_35_190_47" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.Base.RegexLike.html#loc_190_35_190_47&#39;)"><span class="mpre">RegexContext</span></a><span class="mpre">(</span><a href="Text.Regex.Base.RegexLike.html#loc_192_3_192_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.Base.RegexLike.html#loc_192_3_192_9&#39;)"><span class="mpre">matchM</span></a><span class="mpre">),MatchText)
import Text.Regex.Posix(Regex,compNewline,compIgnoreCase,compExtended)

</span><span class="hl_comment"><span class="mpre">-- | Makes a regular expression with the default options (multi-line,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- case-sensitive).  The syntax of regular expressions is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- otherwise that of @egrep@ (i.e. POSIX \&quot;extended\&quot; regular</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- expressions).</span></span><span class="mpre">
</span><a href="#loc_42_1_42_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_8&#39;)"><span class="mpre">mkRegex</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Regex</span></span><span class="mpre">
</span><a name="loc_42_1_42_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_8&#39;)"><span class="hl_fundecl"><span class="mpre">mkRegex</span></span></a><span class="mpre"> </span><a name="loc_42_9_42_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_9_42_10&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> = </span><a href="Text.Regex.Base.RegexLike.html#loc_103_3_103_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.Base.RegexLike.html#loc_103_3_103_16&#39;)"><span class="hl_varref"><span class="mpre">makeRegexOpts</span></span></a><span class="mpre"> </span><a href="#loc_43_9_43_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_9_43_12&#39;)"><span class="hl_varref"><span class="mpre">opt</span></span></a><span class="mpre"> </span><a href="Text.Regex.Base.RegexLike.html#loc_78_3_78_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.Base.RegexLike.html#loc_78_3_78_17&#39;)"><span class="hl_varref"><span class="mpre">defaultExecOpt</span></span></a><span class="mpre"> </span><a href="#loc_42_9_42_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_9_42_10&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">
  where </span><a name="loc_43_9_43_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_43_9_43_12&#39;)"><span class="hl_vardecl"><span class="mpre">opt</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">compExtended</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">compNewline</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Makes a regular expression, where the multi-line and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- case-sensitive options can be changed from the default settings.</span></span><span class="mpre">
</span><a href="#loc_55_1_55_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_16&#39;)"><span class="mpre">mkRegexWithOpts</span></a><span class="mpre">
   :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">  </span><span class="hl_comment"><span class="mpre">-- ^ The regular expression to compile</span></span><span class="mpre">
   -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ &#39;True&#39; @\&lt;=&gt;@ @\&#39;^\&#39;@ and @\&#39;$\&#39;@ match the beginning and </span></span><span class="mpre">
              </span><span class="hl_comment"><span class="mpre">-- end of individual lines respectively, and @\&#39;.\&#39;@ does /not/</span></span><span class="mpre">
              </span><span class="hl_comment"><span class="mpre">-- match the newline character.</span></span><span class="mpre">
   -&gt; </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">    </span><span class="hl_comment"><span class="mpre">-- ^ &#39;True&#39; @\&lt;=&gt;@ matching is case-sensitive</span></span><span class="mpre">
   -&gt; </span><span class="hl_tyconref"><span class="mpre">Regex</span></span><span class="mpre">   </span><span class="hl_comment"><span class="mpre">-- ^ Returns: the compiled regular expression</span></span><span class="mpre">

</span><a name="loc_55_1_55_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_1_55_16&#39;)"><span class="hl_fundecl"><span class="mpre">mkRegexWithOpts</span></span></a><span class="mpre"> </span><a name="loc_55_17_55_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_17_55_18&#39;)"><span class="hl_vardecl"><span class="mpre">s</span></span></a><span class="mpre"> </span><a name="loc_55_19_55_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_19_55_30&#39;)"><span class="hl_vardecl"><span class="mpre">single_line</span></span></a><span class="mpre"> </span><a name="loc_55_31_55_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_31_55_45&#39;)"><span class="hl_vardecl"><span class="mpre">case_sensitive</span></span></a><span class="mpre">
  = let </span><a name="loc_56_9_56_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_9_56_12&#39;)"><span class="hl_vardecl"><span class="mpre">opt</span></span></a><span class="mpre"> = (if </span><a href="#loc_55_19_55_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_19_55_30&#39;)"><span class="hl_varref"><span class="mpre">single_line</span></span></a><span class="mpre"> then (</span><span class="hl_varref"><span class="mpre">compNewline</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre">) else </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre">
              (if </span><a href="#loc_55_31_55_45" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_31_55_45&#39;)"><span class="hl_varref"><span class="mpre">case_sensitive</span></span></a><span class="mpre"> then </span><span class="hl_varref"><span class="mpre">id</span></span><span class="mpre"> else (</span><span class="hl_varref"><span class="mpre">compIgnoreCase</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">.|.</span></span><span class="mpre">)) </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
              </span><span class="hl_varref"><span class="mpre">compExtended</span></span><span class="mpre">
    in </span><a href="Text.Regex.Base.RegexLike.html#loc_103_3_103_16" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.Base.RegexLike.html#loc_103_3_103_16&#39;)"><span class="hl_varref"><span class="mpre">makeRegexOpts</span></span></a><span class="mpre"> </span><a href="#loc_56_9_56_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_56_9_56_12&#39;)"><span class="hl_varref"><span class="mpre">opt</span></span></a><span class="mpre"> </span><a href="Text.Regex.Base.RegexLike.html#loc_78_3_78_17" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.Base.RegexLike.html#loc_78_3_78_17&#39;)"><span class="hl_varref"><span class="mpre">defaultExecOpt</span></span></a><span class="mpre"> </span><a href="#loc_55_17_55_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_55_17_55_18&#39;)"><span class="hl_varref"><span class="mpre">s</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Match a regular expression against a string</span></span><span class="mpre">
</span><a href="#loc_68_1_68_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_1_68_11&#39;)"><span class="mpre">matchRegex</span></a><span class="mpre">
   :: </span><span class="hl_tyconref"><span class="mpre">Regex</span></span><span class="mpre">        </span><span class="hl_comment"><span class="mpre">-- ^ The regular expression</span></span><span class="mpre">
   -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">        </span><span class="hl_comment"><span class="mpre">-- ^ The string to match against</span></span><span class="mpre">
   -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> [</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">]        </span><span class="hl_comment"><span class="mpre">-- ^ Returns: @&#39;Just&#39; strs@ if the match succeeded</span></span><span class="mpre">
                        </span><span class="hl_comment"><span class="mpre">-- (and @strs@ is the list of subexpression matches),</span></span><span class="mpre">
                        </span><span class="hl_comment"><span class="mpre">-- or &#39;Nothing&#39; otherwise.</span></span><span class="mpre">
</span><a name="loc_68_1_68_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_1_68_11&#39;)"><span class="hl_fundecl"><span class="mpre">matchRegex</span></span></a><span class="mpre"> </span><a name="loc_68_12_68_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_12_68_13&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_68_14_68_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_14_68_17&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> (\(_,_,_,</span><a name="loc_68_34_68_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_34_68_37&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre">) -&gt; </span><a href="#loc_68_34_68_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_34_68_37&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">) (</span><a href="#loc_83_1_83_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_14&#39;)"><span class="hl_varref"><span class="mpre">matchRegexAll</span></span></a><span class="mpre"> </span><a href="#loc_68_12_68_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_12_68_13&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_68_14_68_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_68_14_68_17&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | Match a regular expression against a string, returning more information</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- about the match.</span></span><span class="mpre">
</span><a href="#loc_83_1_83_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_14&#39;)"><span class="mpre">matchRegexAll</span></a><span class="mpre">
   :: </span><span class="hl_tyconref"><span class="mpre">Regex</span></span><span class="mpre">        </span><span class="hl_comment"><span class="mpre">-- ^ The regular expression</span></span><span class="mpre">
   -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">        </span><span class="hl_comment"><span class="mpre">-- ^ The string to match against</span></span><span class="mpre">
   -&gt; </span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> ( </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">, </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">, [</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">] )
                </span><span class="hl_comment"><span class="mpre">-- ^ Returns: &#39;Nothing&#39; if the match failed, or:</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- &gt;  Just ( everything before match,</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- &gt;         portion matched,</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- &gt;         everything after the match,</span></span><span class="mpre">
                </span><span class="hl_comment"><span class="mpre">-- &gt;         subexpression matches )</span></span><span class="mpre">

</span><a name="loc_83_1_83_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_14&#39;)"><span class="hl_fundecl"><span class="mpre">matchRegexAll</span></span></a><span class="mpre"> </span><a name="loc_83_15_83_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_15_83_16&#39;)"><span class="hl_vardecl"><span class="mpre">p</span></span></a><span class="mpre"> </span><a name="loc_83_17_83_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_17_83_20&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> = </span><a href="Text.Regex.Base.RegexLike.html#loc_192_3_192_9" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.Base.RegexLike.html#loc_192_3_192_9&#39;)"><span class="hl_varref"><span class="mpre">matchM</span></span></a><span class="mpre"> </span><a href="#loc_83_15_83_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_15_83_16&#39;)"><span class="hl_varref"><span class="mpre">p</span></span></a><span class="mpre"> </span><a href="#loc_83_17_83_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_17_83_20&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{- | Replaces every occurance of the given regexp with the replacement string.

In the replacement string, @\&quot;\\1\&quot;@ refers to the first substring;
@\&quot;\\2\&quot;@ to the second, etc; and @\&quot;\\0\&quot;@ to the entire match.
@\&quot;\\\\\\\\\&quot;@ will insert a literal backslash.

This does not advance if the regex matches an empty string.  This
misfeature is here to match the behavior of the the original
Text.Regex API.
-}</span></span><span class="mpre">

</span><a href="#loc_100_1_100_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_9&#39;)"><span class="mpre">subRegex</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Regex</span></span><span class="mpre">                          </span><span class="hl_comment"><span class="mpre">-- ^ Search pattern</span></span><span class="mpre">
         -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">                         </span><span class="hl_comment"><span class="mpre">-- ^ Input string</span></span><span class="mpre">
         -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">                         </span><span class="hl_comment"><span class="mpre">-- ^ Replacement text</span></span><span class="mpre">
         -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">                         </span><span class="hl_comment"><span class="mpre">-- ^ Output string</span></span><span class="mpre">
</span><a name="loc_100_1_100_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_9&#39;)"><span class="hl_fundecl"><span class="mpre">subRegex</span></span></a><span class="mpre"> _ </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre"> _ = </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">
</span><a href="#loc_100_1_100_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_100_1_100_9&#39;)"><span class="hl_fundecl"><span class="mpre">subRegex</span></span></a><span class="mpre"> </span><a name="loc_101_10_101_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_10_101_16&#39;)"><span class="hl_vardecl"><span class="mpre">regexp</span></span></a><span class="mpre"> </span><a name="loc_101_17_101_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_17_101_20&#39;)"><span class="hl_vardecl"><span class="mpre">inp</span></span></a><span class="mpre"> </span><a name="loc_101_21_101_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_21_101_25&#39;)"><span class="hl_vardecl"><span class="mpre">repl</span></span></a><span class="mpre"> =
  let </span><a name="loc_102_7_102_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_7_102_14&#39;)"><span class="hl_fundecl"><span class="mpre">compile</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_i</span></span><span class="mpre"> </span><a name="loc_102_18_102_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_18_102_21&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> [] = \ </span><span class="hl_vardecl"><span class="mpre">_m</span></span><span class="mpre"> -&gt;  (</span><a href="#loc_102_18_102_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_18_102_21&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">)
      </span><a href="#loc_102_7_102_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_7_102_14&#39;)"><span class="hl_fundecl"><span class="mpre">compile</span></span></a><span class="mpre"> </span><a name="loc_103_15_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_15_103_16&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> </span><a name="loc_103_17_103_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_17_103_20&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> ((</span><span class="hl_string"><span class="mpre">&quot;\\&quot;</span></span><span class="mpre">,(</span><a name="loc_103_29_103_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_29_103_32&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre">,</span><a name="loc_103_33_103_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_33_103_36&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">))</span><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_103_39_103_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_39_103_43&#39;)"><span class="hl_vardecl"><span class="mpre">rest</span></span></a><span class="mpre">) =
        let </span><a name="loc_104_13_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_13_104_15&#39;)"><span class="hl_vardecl"><span class="mpre">i&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_103_29_103_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_29_103_32&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_103_33_103_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_33_103_36&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
            </span><a name="loc_105_13_105_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_13_105_16&#39;)"><span class="hl_vardecl"><span class="mpre">pre</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">take</span></span><span class="mpre"> (</span><a href="#loc_103_29_103_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_29_103_32&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><a href="#loc_103_15_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_15_103_16&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">) </span><a href="#loc_103_17_103_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_17_103_20&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
            </span><a name="loc_106_13_106_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_13_106_17&#39;)"><span class="hl_vardecl"><span class="mpre">str&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">drop</span></span><span class="mpre"> (</span><a href="#loc_104_13_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_13_104_15&#39;)"><span class="hl_varref"><span class="mpre">i&#39;</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><a href="#loc_103_15_103_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_15_103_16&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">) </span><a href="#loc_103_17_103_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_17_103_20&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
        in if </span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_106_13_106_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_13_106_17&#39;)"><span class="hl_varref"><span class="mpre">str&#39;</span></span></a><span class="mpre"> then \ </span><span class="hl_vardecl"><span class="mpre">_m</span></span><span class="mpre"> -&gt; (</span><a href="#loc_105_13_105_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_13_105_16&#39;)"><span class="hl_varref"><span class="mpre">pre</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (</span><span class="hl_char"><span class="mpre">&#39;\\&#39;</span></span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">)
             else \  </span><a name="loc_108_22_108_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_22_108_23&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_105_13_105_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_105_13_105_16&#39;)"><span class="hl_varref"><span class="mpre">pre</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> (</span><span class="hl_char"><span class="mpre">&#39;\\&#39;</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_102_7_102_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_7_102_14&#39;)"><span class="hl_varref"><span class="mpre">compile</span></span></a><span class="mpre"> </span><a href="#loc_104_13_104_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_104_13_104_15&#39;)"><span class="hl_varref"><span class="mpre">i&#39;</span></span></a><span class="mpre"> </span><a href="#loc_106_13_106_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_13_106_17&#39;)"><span class="hl_varref"><span class="mpre">str&#39;</span></span></a><span class="mpre"> </span><a href="#loc_103_39_103_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_103_39_103_43&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre"> </span><a href="#loc_108_22_108_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_108_22_108_23&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
      </span><a href="#loc_102_7_102_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_7_102_14&#39;)"><span class="hl_fundecl"><span class="mpre">compile</span></span></a><span class="mpre"> </span><a name="loc_109_15_109_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_15_109_16&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> </span><a name="loc_109_17_109_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_17_109_20&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> ((</span><a name="loc_109_23_109_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_23_109_27&#39;)"><span class="hl_vardecl"><span class="mpre">xstr</span></span></a><span class="mpre">,(</span><a name="loc_109_29_109_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_29_109_32&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre">,</span><a name="loc_109_33_109_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_33_109_36&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">))</span><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_109_39_109_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_39_109_43&#39;)"><span class="hl_vardecl"><span class="mpre">rest</span></span></a><span class="mpre">) =
        let </span><a name="loc_110_13_110_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_13_110_15&#39;)"><span class="hl_vardecl"><span class="mpre">i&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_109_29_109_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_29_109_32&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_109_33_109_36" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_33_109_36&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
            </span><a name="loc_111_13_111_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_13_111_16&#39;)"><span class="hl_vardecl"><span class="mpre">pre</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">take</span></span><span class="mpre"> (</span><a href="#loc_109_29_109_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_29_109_32&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><a href="#loc_109_15_109_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_15_109_16&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">) </span><a href="#loc_109_17_109_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_17_109_20&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
            </span><a name="loc_112_13_112_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_13_112_17&#39;)"><span class="hl_vardecl"><span class="mpre">str&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">drop</span></span><span class="mpre"> (</span><a href="#loc_110_13_110_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_13_110_15&#39;)"><span class="hl_varref"><span class="mpre">i&#39;</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><a href="#loc_109_15_109_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_15_109_16&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">) </span><a href="#loc_109_17_109_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_17_109_20&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
            </span><a name="loc_113_13_113_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_13_113_14&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">read</span></span><span class="mpre"> </span><a href="#loc_109_23_109_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_23_109_27&#39;)"><span class="hl_varref"><span class="mpre">xstr</span></span></a><span class="mpre">
        in if </span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_112_13_112_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_13_112_17&#39;)"><span class="hl_varref"><span class="mpre">str&#39;</span></span></a><span class="mpre"> then \ </span><a name="loc_114_32_114_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_32_114_33&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_111_13_111_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_13_111_16&#39;)"><span class="hl_varref"><span class="mpre">pre</span></span></a><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> ((</span><span class="hl_varref"><span class="mpre">fst</span></span><span class="mpre"> (</span><a href="#loc_114_32_114_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_32_114_33&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="hl_infix"><span class="mpre">!</span></span><a href="#loc_113_13_113_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_13_113_14&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">))</span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">)
             else \ </span><a name="loc_115_21_115_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_21_115_22&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> -&gt; (</span><a href="#loc_111_13_111_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_111_13_111_16&#39;)"><span class="hl_varref"><span class="mpre">pre</span></span></a><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> ((</span><span class="hl_varref"><span class="mpre">fst</span></span><span class="mpre"> (</span><a href="#loc_115_21_115_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_21_115_22&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="hl_infix"><span class="mpre">!</span></span><a href="#loc_113_13_113_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_113_13_113_14&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">))</span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre">) </span><span class="hl_infix"><span class="mpre">.</span></span><span class="mpre"> </span><a href="#loc_102_7_102_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_7_102_14&#39;)"><span class="hl_varref"><span class="mpre">compile</span></span></a><span class="mpre"> </span><a href="#loc_110_13_110_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_13_110_15&#39;)"><span class="hl_varref"><span class="mpre">i&#39;</span></span></a><span class="mpre"> </span><a href="#loc_112_13_112_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_112_13_112_17&#39;)"><span class="hl_varref"><span class="mpre">str&#39;</span></span></a><span class="mpre"> </span><a href="#loc_109_39_109_43" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_109_39_109_43&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre"> </span><a href="#loc_115_21_115_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_21_115_22&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">
      </span><a href="#loc_117_7_117_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_7_117_15&#39;)"><span class="mpre">compiled</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">MatchText</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">
      </span><a name="loc_117_7_117_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_7_117_15&#39;)"><span class="hl_vardecl"><span class="mpre">compiled</span></span></a><span class="mpre"> = </span><a href="#loc_102_7_102_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_102_7_102_14&#39;)"><span class="hl_varref"><span class="mpre">compile</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_101_21_101_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_21_101_25&#39;)"><span class="hl_varref"><span class="mpre">repl</span></span></a><span class="mpre"> </span><a href="#loc_120_9_120_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_9_120_17&#39;)"><span class="hl_varref"><span class="mpre">findrefs</span></span></a><span class="mpre"> where
        </span><span class="hl_comment"><span class="mpre">-- bre matches a backslash then capture either a backslash or some digits</span></span><span class="mpre">
        </span><a name="loc_119_9_119_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_9_119_12&#39;)"><span class="hl_vardecl"><span class="mpre">bre</span></span></a><span class="mpre"> = </span><a href="#loc_42_1_42_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_42_1_42_8&#39;)"><span class="hl_varref"><span class="mpre">mkRegex</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;\\\\(\\\\|[0-9]+)&quot;</span></span><span class="mpre">
        </span><a name="loc_120_9_120_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_9_120_17&#39;)"><span class="hl_vardecl"><span class="mpre">findrefs</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> (\</span><a name="loc_120_26_120_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_26_120_27&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> -&gt; (</span><span class="hl_varref"><span class="mpre">fst</span></span><span class="mpre"> (</span><a href="#loc_120_26_120_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_26_120_27&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="hl_infix"><span class="mpre">!</span></span><span class="hl_num"><span class="mpre">1</span></span><span class="mpre">),</span><span class="hl_varref"><span class="mpre">snd</span></span><span class="mpre"> (</span><a href="#loc_120_26_120_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_120_26_120_27&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="hl_infix"><span class="mpre">!</span></span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">))) (</span><a href="Text.Regex.Base.RegexLike.html#loc_150_3_150_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.Base.RegexLike.html#loc_150_3_150_15&#39;)"><span class="hl_varref"><span class="mpre">matchAllText</span></span></a><span class="mpre"> </span><a href="#loc_119_9_119_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_119_9_119_12&#39;)"><span class="hl_varref"><span class="mpre">bre</span></span></a><span class="mpre"> </span><a href="#loc_101_21_101_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_21_101_25&#39;)"><span class="hl_varref"><span class="mpre">repl</span></span></a><span class="mpre">)
      </span><a name="loc_121_7_121_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_7_121_9&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_i</span></span><span class="mpre"> </span><a name="loc_121_13_121_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_13_121_16&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> [] = </span><a href="#loc_121_13_121_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_13_121_16&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
      </span><a href="#loc_121_7_121_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_7_121_9&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_122_10_122_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_10_122_11&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> </span><a name="loc_122_12_122_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_12_122_15&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> (</span><a name="loc_122_17_122_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_17_122_18&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_122_19_122_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_19_122_21&#39;)"><span class="hl_vardecl"><span class="mpre">ms</span></span></a><span class="mpre">) =
        let (_,(</span><a name="loc_123_17_123_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_17_123_20&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre">,</span><a name="loc_123_21_123_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_21_123_24&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">)) = </span><a href="#loc_122_17_122_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_17_122_18&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="hl_infix"><span class="mpre">!</span></span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">
            </span><a name="loc_124_13_124_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_13_124_15&#39;)"><span class="hl_vardecl"><span class="mpre">i&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_123_17_123_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_17_123_20&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_123_21_123_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_21_123_24&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
            </span><a name="loc_125_13_125_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_13_125_16&#39;)"><span class="hl_vardecl"><span class="mpre">pre</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">take</span></span><span class="mpre"> (</span><a href="#loc_123_17_123_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_17_123_20&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><a href="#loc_122_10_122_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_10_122_11&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">) </span><a href="#loc_122_12_122_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_12_122_15&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
            </span><a name="loc_126_13_126_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_13_126_17&#39;)"><span class="hl_vardecl"><span class="mpre">str&#39;</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">drop</span></span><span class="mpre"> (</span><a href="#loc_124_13_124_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_13_124_15&#39;)"><span class="hl_varref"><span class="mpre">i&#39;</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><a href="#loc_122_10_122_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_10_122_11&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">) </span><a href="#loc_122_12_122_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_12_122_15&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
        in if </span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_126_13_126_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_13_126_17&#39;)"><span class="hl_varref"><span class="mpre">str&#39;</span></span></a><span class="mpre"> then </span><a href="#loc_125_13_125_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_13_125_16&#39;)"><span class="hl_varref"><span class="mpre">pre</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> (</span><a href="#loc_117_7_117_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_7_117_15&#39;)"><span class="hl_varref"><span class="mpre">compiled</span></span></a><span class="mpre"> </span><a href="#loc_122_17_122_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_17_122_18&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">)
             else </span><a href="#loc_125_13_125_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_13_125_16&#39;)"><span class="hl_varref"><span class="mpre">pre</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">++</span></span><span class="mpre"> (</span><a href="#loc_117_7_117_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_117_7_117_15&#39;)"><span class="hl_varref"><span class="mpre">compiled</span></span></a><span class="mpre"> </span><a href="#loc_122_17_122_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_17_122_18&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> (</span><a href="#loc_121_7_121_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_7_121_9&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_124_13_124_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_13_124_15&#39;)"><span class="hl_varref"><span class="mpre">i&#39;</span></span></a><span class="mpre"> </span><a href="#loc_126_13_126_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_13_126_17&#39;)"><span class="hl_varref"><span class="mpre">str&#39;</span></span></a><span class="mpre"> </span><a href="#loc_122_19_122_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_19_122_21&#39;)"><span class="hl_varref"><span class="mpre">ms</span></span></a><span class="mpre">))
  in </span><a href="#loc_121_7_121_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_7_121_9&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_101_17_101_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_17_101_20&#39;)"><span class="hl_varref"><span class="mpre">inp</span></span></a><span class="mpre"> (</span><a href="Text.Regex.Base.RegexLike.html#loc_150_3_150_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.Base.RegexLike.html#loc_150_3_150_15&#39;)"><span class="hl_varref"><span class="mpre">matchAllText</span></span></a><span class="mpre"> </span><a href="#loc_101_10_101_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_10_101_16&#39;)"><span class="hl_varref"><span class="mpre">regexp</span></span></a><span class="mpre"> </span><a href="#loc_101_17_101_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_17_101_20&#39;)"><span class="hl_varref"><span class="mpre">inp</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">{- | Splits a string based on a regular expression.  The regular expression
should identify one delimiter.

This does not advance and produces an infinite list of [] if the regex
matches an empty string.  This misfeature is here to match the
behavior of the the original Text.Regex API.
-}</span></span><span class="mpre">

</span><a href="#loc_140_1_140_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_1_140_11&#39;)"><span class="mpre">splitRegex</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Regex</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; [</span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre">]
</span><a name="loc_140_1_140_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_1_140_11&#39;)"><span class="hl_fundecl"><span class="mpre">splitRegex</span></span></a><span class="mpre"> _ [] = []
</span><a href="#loc_140_1_140_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_140_1_140_11&#39;)"><span class="hl_fundecl"><span class="mpre">splitRegex</span></span></a><span class="mpre"> </span><a name="loc_141_12_141_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_12_141_17&#39;)"><span class="hl_vardecl"><span class="mpre">delim</span></span></a><span class="mpre"> </span><a name="loc_141_18_141_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_18_141_23&#39;)"><span class="hl_vardecl"><span class="mpre">strIn</span></span></a><span class="mpre"> = 
  let </span><a name="loc_142_7_142_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_7_142_14&#39;)"><span class="hl_vardecl"><span class="mpre">matches</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">map</span></span><span class="mpre"> (</span><span class="hl_infix"><span class="mpre">!</span></span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">) (</span><a href="Text.Regex.Base.RegexLike.html#loc_141_3_141_11" onmouseover="nemnem.highlightLocalToRemote(&#39;Text.Regex.Base.RegexLike.html#loc_141_3_141_11&#39;)"><span class="hl_varref"><span class="mpre">matchAll</span></span></a><span class="mpre"> </span><a href="#loc_141_12_141_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_12_141_17&#39;)"><span class="hl_varref"><span class="mpre">delim</span></span></a><span class="mpre"> </span><a href="#loc_141_18_141_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_18_141_23&#39;)"><span class="hl_varref"><span class="mpre">strIn</span></span></a><span class="mpre">)
      </span><a name="loc_143_7_143_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_7_143_9&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_i</span></span><span class="mpre"> </span><a name="loc_143_13_143_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_13_143_16&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> [] = </span><a href="#loc_143_13_143_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_13_143_16&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> []
      </span><a href="#loc_143_7_143_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_7_143_9&#39;)"><span class="hl_fundecl"><span class="mpre">go</span></span></a><span class="mpre"> </span><a name="loc_144_10_144_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_10_144_11&#39;)"><span class="hl_vardecl"><span class="mpre">i</span></span></a><span class="mpre"> </span><a name="loc_144_12_144_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_12_144_15&#39;)"><span class="hl_vardecl"><span class="mpre">str</span></span></a><span class="mpre"> ((</span><a name="loc_144_18_144_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_18_144_21&#39;)"><span class="hl_vardecl"><span class="mpre">off</span></span></a><span class="mpre">,</span><a name="loc_144_22_144_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_22_144_25&#39;)"><span class="hl_vardecl"><span class="mpre">len</span></span></a><span class="mpre">)</span><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_144_27_144_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_27_144_31&#39;)"><span class="hl_vardecl"><span class="mpre">rest</span></span></a><span class="mpre">) =
        let </span><a name="loc_145_13_145_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_13_145_15&#39;)"><span class="hl_vardecl"><span class="mpre">i&#39;</span></span></a><span class="mpre"> = </span><a href="#loc_144_18_144_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_18_144_21&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="hl_infix"><span class="mpre">+</span></span><a href="#loc_144_22_144_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_22_144_25&#39;)"><span class="hl_varref"><span class="mpre">len</span></span></a><span class="mpre">
            </span><a name="loc_146_13_146_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_13_146_22&#39;)"><span class="hl_vardecl"><span class="mpre">firstline</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">take</span></span><span class="mpre"> (</span><a href="#loc_144_18_144_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_18_144_21&#39;)"><span class="hl_varref"><span class="mpre">off</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><a href="#loc_144_10_144_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_10_144_11&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">) </span><a href="#loc_144_12_144_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_12_144_15&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
            </span><a name="loc_147_13_147_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_13_147_22&#39;)"><span class="hl_vardecl"><span class="mpre">remainder</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">drop</span></span><span class="mpre"> (</span><a href="#loc_145_13_145_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_13_145_15&#39;)"><span class="hl_varref"><span class="mpre">i&#39;</span></span></a><span class="hl_infix"><span class="mpre">-</span></span><a href="#loc_144_10_144_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_10_144_11&#39;)"><span class="hl_varref"><span class="mpre">i</span></span></a><span class="mpre">) </span><a href="#loc_144_12_144_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_12_144_15&#39;)"><span class="hl_varref"><span class="mpre">str</span></span></a><span class="mpre">
        in </span><span class="hl_varref"><span class="mpre">seq</span></span><span class="mpre"> </span><a href="#loc_145_13_145_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_13_145_15&#39;)"><span class="hl_varref"><span class="mpre">i&#39;</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre">
           if </span><span class="hl_varref"><span class="mpre">null</span></span><span class="mpre"> </span><a href="#loc_147_13_147_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_13_147_22&#39;)"><span class="hl_varref"><span class="mpre">remainder</span></span></a><span class="mpre"> then [</span><a href="#loc_146_13_146_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_13_146_22&#39;)"><span class="hl_varref"><span class="mpre">firstline</span></span></a><span class="mpre">,</span><span class="hl_string"><span class="mpre">&quot;&quot;</span></span><span class="mpre">]
             else </span><a href="#loc_146_13_146_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_146_13_146_22&#39;)"><span class="hl_varref"><span class="mpre">firstline</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre"> </span><a href="#loc_143_7_143_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_7_143_9&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><a href="#loc_145_13_145_15" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_145_13_145_15&#39;)"><span class="hl_varref"><span class="mpre">i&#39;</span></span></a><span class="mpre"> </span><a href="#loc_147_13_147_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_147_13_147_22&#39;)"><span class="hl_varref"><span class="mpre">remainder</span></span></a><span class="mpre"> </span><a href="#loc_144_27_144_31" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_144_27_144_31&#39;)"><span class="hl_varref"><span class="mpre">rest</span></span></a><span class="mpre">
  in </span><a href="#loc_143_7_143_9" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_143_7_143_9&#39;)"><span class="hl_varref"><span class="mpre">go</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre"> </span><a href="#loc_141_18_141_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_141_18_141_23&#39;)"><span class="hl_varref"><span class="mpre">strIn</span></span></a><span class="mpre"> </span><a href="#loc_142_7_142_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_142_7_142_14&#39;)"><span class="hl_varref"><span class="mpre">matches</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">{-

-- These are the older versions which failed on (correct answer:)
-- let r = mkRegex &quot;^(.)&quot; in subRegex2 r &quot;abc\ndef&quot; &quot;|\\1&quot;
-- &quot;|abc\n|def&quot;

subRegex :: Regex                          -- ^ Search pattern
      -&gt; String                         -- ^ Input string
      -&gt; String                         -- ^ Replacement text
      -&gt; String                         -- ^ Output string
subRegex _ &quot;&quot; _ = &quot;&quot;
subRegex regexp inp repl =
  let -- bre matches a backslash then capture either a backslash or some digits
      bre = mkRegex &quot;\\\\(\\\\|[0-9]+)&quot;
      lookup _ [] _ = []
      lookup [] _ _ = []
      lookup match repl groups =
        case matchRegexAll bre repl of
          Nothing -&gt; repl
          Just (lead, _, trail, bgroups) -&gt;
            let newval =
                 if (head bgroups) == &quot;\\&quot;
                   then &quot;\\&quot;
                   else let index :: Int
                            index = (read (head bgroups)) - 1
                        in if index == -1
                             then match
                             else groups !! index
            in lead ++ newval ++ lookup match trail groups
  in case matchRegexAll regexp inp of
       Nothing -&gt; inp
       Just (lead, match, trail, groups) -&gt;
         lead ++ lookup match repl groups ++ (subRegex regexp trail repl)

splitRegex :: Regex -&gt; String -&gt; [String]
splitRegex _ [] = []
splitRegex delim strIn = loop strIn where
  loop str = case matchOnceText delim str of
                Nothing -&gt; [str]
                Just (firstline, _, remainder) -&gt;
                  if null remainder
                    then [firstline,&quot;&quot;]
                    else firstline : loop remainder

-}</span></span></div></body></html>