<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# OPTIONS_GHC -fno-warn-name-shadowing #-}
{-# LANGUAGE CPP, DeriveDataTypeable #-}

#if __GLASGOW_HASKELL__ &gt;= 701
{-# LANGUAGE Trustworthy #-}
#endif

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Control.Concurrent.STM.TQueue</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The University of Glasgow 2012</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD-style (see the file libraries/base/LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  libraries@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  experimental</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  non-portable (requires STM)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- A &#39;TQueue&#39; is like a &#39;TChan&#39;, with two important differences:</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * it has faster throughput than both &#39;TChan&#39; and &#39;Chan&#39; (although</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    the costs are amortised, so the cost of individual operations</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    can vary a lot).</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--  * it does /not/ provide equivalents of the &#39;dupTChan&#39; and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--    &#39;cloneTChan&#39; operations.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The implementation is based on the traditional purely-functional</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- queue representation that uses two lists to obtain amortised /O(1)/</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- enqueue and dequeue operations.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module Control.Concurrent.STM.TQueue (
        </span><span class="hl_comment"><span class="mpre">-- * TQueue</span></span><span class="mpre">
        TQueue,
        newTQueue,
        newTQueueIO,
        readTQueue,
        tryReadTQueue,
        peekTQueue,
        tryPeekTQueue,
        writeTQueue,
        unGetTQueue,
        isEmptyTQueue,
  ) where

import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TQueue.hs&quot;, srcSpanStartLine = 47, srcSpanStartColumn = 8, srcSpanEndLine = 47, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Conc&quot;"><span class="mpre">GHC.Conc</span></span><span class="mpre">

import Data.Typeable (</span><a href="Data.Typeable.Internal.html#loc_196_7_196_15" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Typeable.Internal.html#loc_196_7_196_15&#39;)"><span class="mpre">Typeable</span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- | &#39;TQueue&#39; is an abstract type representing an unbounded FIFO channel.</span></span><span class="mpre">
data </span><a name="loc_52_6_52_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_6_52_12&#39;)"><span class="hl_tycondecl"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> = </span><a name="loc_52_17_52_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_23&#39;)"><span class="hl_condecl"><span class="mpre">TQueue</span></span></a><span class="mpre"> {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">TVar</span></span><span class="mpre"> [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">])
                       {-# UNPACK #-} !(</span><span class="hl_tyconref"><span class="mpre">TVar</span></span><span class="mpre"> [</span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">])
  </span><span class="warning" data-warning="DataDecl DerivingsDeriving (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TQueue.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 3, srcSpanEndLine = 54, srcSpanEndColumn = 20}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm-2.4.3/Control/Concurrent/STM/TQueue.hs&quot;, srcSpanStartLine = 54, srcSpanStartColumn = 3, srcSpanEndLine = 54, srcSpanEndColumn = 11}]}) [IHead (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/stm"><span class="mpre">deriving Typeable</span></span><span class="mpre">

instance </span><span class="hl_classref"><span class="mpre">Eq</span></span><span class="mpre"> (</span><a href="#loc_52_6_52_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_6_52_12&#39;)"><span class="hl_tyconref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) where
  </span><a href="#loc_52_17_52_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_23&#39;)"><span class="hl_conref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><a name="loc_57_10_57_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_10_57_11&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> _ </span><span class="hl_fundecl"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_52_17_52_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_23&#39;)"><span class="hl_conref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><a name="loc_57_24_57_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_24_57_25&#39;)"><span class="hl_vardecl"><span class="mpre">b</span></span></a><span class="mpre"> _ = </span><a href="#loc_57_10_57_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_10_57_11&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><a href="#loc_57_24_57_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_57_24_57_25&#39;)"><span class="hl_varref"><span class="mpre">b</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Build and returns a new instance of &#39;TQueue&#39;</span></span><span class="mpre">
</span><a href="#loc_61_1_61_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_10&#39;)"><span class="mpre">newTQueue</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> (</span><a href="#loc_52_6_52_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_6_52_12&#39;)"><span class="hl_tyconref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_61_1_61_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_61_1_61_10&#39;)"><span class="hl_vardecl"><span class="mpre">newTQueue</span></span></a><span class="mpre"> = do
  </span><a name="loc_62_3_62_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_3_62_7&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre">  &lt;- </span><span class="hl_varref"><span class="mpre">newTVar</span></span><span class="mpre"> []
  </span><a name="loc_63_3_63_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_3_63_8&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVar</span></span><span class="mpre"> []
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_52_17_52_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_23&#39;)"><span class="hl_conref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><a href="#loc_62_3_62_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_62_3_62_7&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_63_3_63_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_63_3_63_8&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |@IO@ version of &#39;newTQueue&#39;.  This is useful for creating top-level</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;TQueue&#39;s using &#39;System.IO.Unsafe.unsafePerformIO&#39;, because using</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;atomically&#39; inside &#39;System.IO.Unsafe.unsafePerformIO&#39; isn&#39;t</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- possible.</span></span><span class="mpre">
</span><a href="#loc_71_1_71_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_12&#39;)"><span class="mpre">newTQueueIO</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><a href="#loc_52_6_52_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_6_52_12&#39;)"><span class="hl_tyconref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_71_1_71_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_71_1_71_12&#39;)"><span class="hl_vardecl"><span class="mpre">newTQueueIO</span></span></a><span class="mpre"> = do
  </span><a name="loc_72_3_72_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_3_72_7&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre">  &lt;- </span><span class="hl_varref"><span class="mpre">newTVarIO</span></span><span class="mpre"> []
  </span><a name="loc_73_3_73_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_3_73_8&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">newTVarIO</span></span><span class="mpre"> []
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> (</span><a href="#loc_52_17_52_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_23&#39;)"><span class="hl_conref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><a href="#loc_72_3_72_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_72_3_72_7&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_73_3_73_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_73_3_73_8&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |Write a value to a &#39;TQueue&#39;.</span></span><span class="mpre">
</span><a href="#loc_78_1_78_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_12&#39;)"><span class="mpre">writeTQueue</span></a><span class="mpre"> :: </span><a href="#loc_52_6_52_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_6_52_12&#39;)"><span class="hl_tyconref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_78_1_78_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_1_78_12&#39;)"><span class="hl_fundecl"><span class="mpre">writeTQueue</span></span></a><span class="mpre"> (</span><a href="#loc_52_17_52_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_23&#39;)"><span class="hl_conref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_read</span></span><span class="mpre"> </span><a name="loc_78_27_78_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_27_78_32&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre">) </span><a name="loc_78_34_78_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_34_78_35&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = do
  </span><a name="loc_79_3_79_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_3_79_10&#39;)"><span class="hl_vardecl"><span class="mpre">listend</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_78_27_78_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_27_78_32&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_78_27_78_32" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_27_78_32&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> (</span><a href="#loc_78_34_78_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_78_34_78_35&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_79_3_79_10" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_79_3_79_10&#39;)"><span class="hl_varref"><span class="mpre">listend</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |Read the next value from the &#39;TQueue&#39;.</span></span><span class="mpre">
</span><a href="#loc_84_1_84_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_11&#39;)"><span class="mpre">readTQueue</span></a><span class="mpre"> :: </span><a href="#loc_52_6_52_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_6_52_12&#39;)"><span class="hl_tyconref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_84_1_84_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_11&#39;)"><span class="hl_fundecl"><span class="mpre">readTQueue</span></span></a><span class="mpre"> (</span><a href="#loc_52_17_52_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_23&#39;)"><span class="hl_conref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><a name="loc_84_20_84_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_20_84_24&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre"> </span><a name="loc_84_25_84_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_25_84_30&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre">) = do
  </span><a name="loc_85_3_85_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_3_85_5&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_84_20_84_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_20_84_24&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre">
  case </span><a href="#loc_85_3_85_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_85_3_85_5&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre"> of
    (</span><a name="loc_87_6_87_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_6_87_7&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_87_8_87_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_8_87_11&#39;)"><span class="hl_vardecl"><span class="mpre">xs&#39;</span></span></a><span class="mpre">) -&gt; do </span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_84_20_84_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_20_84_24&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_87_8_87_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_8_87_11&#39;)"><span class="hl_varref"><span class="mpre">xs&#39;</span></span></a><span class="mpre">
                  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_87_6_87_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_87_6_87_7&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
    [] -&gt; do </span><a name="loc_89_14_89_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_14_89_16&#39;)"><span class="hl_vardecl"><span class="mpre">ys</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_84_25_84_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_25_84_30&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre">
             case </span><a href="#loc_89_14_89_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_14_89_16&#39;)"><span class="hl_varref"><span class="mpre">ys</span></span></a><span class="mpre"> of
               [] -&gt; </span><span class="hl_varref"><span class="mpre">retry</span></span><span class="mpre">
               _  -&gt; case </span><span class="hl_varref"><span class="mpre">reverse</span></span><span class="mpre"> </span><a href="#loc_89_14_89_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_89_14_89_16&#39;)"><span class="hl_varref"><span class="mpre">ys</span></span></a><span class="mpre"> of
                       [] -&gt; </span><span class="hl_varref"><span class="mpre">error</span></span><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;readTQueue&quot;</span></span><span class="mpre">
                       (</span><a name="loc_94_25_94_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_25_94_26&#39;)"><span class="hl_vardecl"><span class="mpre">z</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a name="loc_94_27_94_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_27_94_29&#39;)"><span class="hl_vardecl"><span class="mpre">zs</span></span></a><span class="mpre">) -&gt; do </span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_84_25_84_30" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_25_84_30&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre"> []
                                    </span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_84_20_84_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_20_84_24&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> </span><a href="#loc_94_27_94_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_27_94_29&#39;)"><span class="hl_varref"><span class="mpre">zs</span></span></a><span class="mpre">
                                    </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_94_25_94_26" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_94_25_94_26&#39;)"><span class="hl_varref"><span class="mpre">z</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A version of &#39;readTQueue&#39; which does not retry. Instead it</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- returns @Nothing@ if no value is available.</span></span><span class="mpre">
</span><a href="#loc_101_1_101_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_14&#39;)"><span class="mpre">tryReadTQueue</span></a><span class="mpre"> :: </span><a href="#loc_52_6_52_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_6_52_12&#39;)"><span class="hl_tyconref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_101_1_101_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_14&#39;)"><span class="hl_fundecl"><span class="mpre">tryReadTQueue</span></span></a><span class="mpre"> </span><a name="loc_101_15_101_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_15_101_16&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fmap</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> (</span><a href="#loc_84_1_84_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_11&#39;)"><span class="hl_varref"><span class="mpre">readTQueue</span></span></a><span class="mpre"> </span><a href="#loc_101_15_101_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_15_101_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">) </span><span class="hl_infix"><span class="mpre">`orElse`</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | Get the next value from the @TQueue@ without removing it,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- retrying if the channel is empty.</span></span><span class="mpre">
</span><a href="#loc_106_1_106_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_1_106_11&#39;)"><span class="mpre">peekTQueue</span></a><span class="mpre"> :: </span><a href="#loc_52_6_52_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_6_52_12&#39;)"><span class="hl_tyconref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">
</span><a name="loc_106_1_106_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_1_106_11&#39;)"><span class="hl_fundecl"><span class="mpre">peekTQueue</span></span></a><span class="mpre"> </span><a name="loc_106_12_106_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_12_106_13&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = do
  </span><a name="loc_107_3_107_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_3_107_4&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_84_1_84_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_84_1_84_11&#39;)"><span class="hl_varref"><span class="mpre">readTQueue</span></span></a><span class="mpre"> </span><a href="#loc_106_12_106_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_12_106_13&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">
  </span><a href="#loc_124_1_124_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_1_124_12&#39;)"><span class="hl_varref"><span class="mpre">unGetTQueue</span></span></a><span class="mpre"> </span><a href="#loc_106_12_106_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_106_12_106_13&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><a href="#loc_107_3_107_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_3_107_4&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_107_3_107_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_3_107_4&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A version of &#39;peekTQueue&#39; which does not retry. Instead it</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- returns @Nothing@ if no value is available.</span></span><span class="mpre">
</span><a href="#loc_114_1_114_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_1_114_14&#39;)"><span class="mpre">tryPeekTQueue</span></a><span class="mpre"> :: </span><a href="#loc_52_6_52_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_6_52_12&#39;)"><span class="hl_tyconref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Maybe</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_114_1_114_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_1_114_14&#39;)"><span class="hl_fundecl"><span class="mpre">tryPeekTQueue</span></span></a><span class="mpre"> </span><a name="loc_114_15_114_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_15_114_16&#39;)"><span class="hl_vardecl"><span class="mpre">c</span></span></a><span class="mpre"> = do
  </span><a name="loc_115_3_115_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_3_115_4&#39;)"><span class="hl_vardecl"><span class="mpre">m</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_101_1_101_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_101_1_101_14&#39;)"><span class="hl_varref"><span class="mpre">tryReadTQueue</span></span></a><span class="mpre"> </span><a href="#loc_114_15_114_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_15_114_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre">
  case </span><a href="#loc_115_3_115_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_3_115_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre"> of
    </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre"> -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">Nothing</span></span><span class="mpre">
    </span><span class="hl_conref"><span class="mpre">Just</span></span><span class="mpre"> </span><a name="loc_118_10_118_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_10_118_11&#39;)"><span class="hl_vardecl"><span class="mpre">x</span></span></a><span class="mpre">  -&gt; do
      </span><a href="#loc_124_1_124_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_1_124_12&#39;)"><span class="hl_varref"><span class="mpre">unGetTQueue</span></span></a><span class="mpre"> </span><a href="#loc_114_15_114_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_114_15_114_16&#39;)"><span class="hl_varref"><span class="mpre">c</span></span></a><span class="mpre"> </span><a href="#loc_118_10_118_11" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_118_10_118_11&#39;)"><span class="hl_varref"><span class="mpre">x</span></span></a><span class="mpre">
      </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_115_3_115_4" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_115_3_115_4&#39;)"><span class="hl_varref"><span class="mpre">m</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Put a data item back onto a channel, where it will be the next item read.</span></span><span class="mpre">
</span><a href="#loc_124_1_124_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_1_124_12&#39;)"><span class="mpre">unGetTQueue</span></a><span class="mpre"> :: </span><a href="#loc_52_6_52_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_6_52_12&#39;)"><span class="hl_tyconref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_124_1_124_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_1_124_12&#39;)"><span class="hl_fundecl"><span class="mpre">unGetTQueue</span></span></a><span class="mpre"> (</span><a href="#loc_52_17_52_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_23&#39;)"><span class="hl_conref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><a name="loc_124_21_124_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_21_124_25&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre"> </span><span class="hl_vardecl"><span class="mpre">_write</span></span><span class="mpre">) </span><a name="loc_124_34_124_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_34_124_35&#39;)"><span class="hl_vardecl"><span class="mpre">a</span></span></a><span class="mpre"> = do
  </span><a name="loc_125_3_125_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_3_125_5&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_124_21_124_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_21_124_25&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre">
  </span><span class="hl_varref"><span class="mpre">writeTVar</span></span><span class="mpre"> </span><a href="#loc_124_21_124_25" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_21_124_25&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre"> (</span><a href="#loc_124_34_124_35" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_34_124_35&#39;)"><span class="hl_varref"><span class="mpre">a</span></span></a><span class="hl_infix"><span class="mpre">:</span></span><a href="#loc_125_3_125_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_3_125_5&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |Returns &#39;True&#39; if the supplied &#39;TQueue&#39; is empty.</span></span><span class="mpre">
</span><a href="#loc_130_1_130_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_14&#39;)"><span class="mpre">isEmptyTQueue</span></a><span class="mpre"> :: </span><a href="#loc_52_6_52_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_6_52_12&#39;)"><span class="hl_tyconref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">STM</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Bool</span></span><span class="mpre">
</span><a name="loc_130_1_130_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_1_130_14&#39;)"><span class="hl_fundecl"><span class="mpre">isEmptyTQueue</span></span></a><span class="mpre"> (</span><a href="#loc_52_17_52_23" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_52_17_52_23&#39;)"><span class="hl_conref"><span class="mpre">TQueue</span></span></a><span class="mpre"> </span><a name="loc_130_23_130_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_23_130_27&#39;)"><span class="hl_vardecl"><span class="mpre">read</span></span></a><span class="mpre"> </span><a name="loc_130_28_130_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_28_130_33&#39;)"><span class="hl_vardecl"><span class="mpre">write</span></span></a><span class="mpre">) = do
  </span><a name="loc_131_3_131_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_3_131_5&#39;)"><span class="hl_vardecl"><span class="mpre">xs</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_130_23_130_27" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_23_130_27&#39;)"><span class="hl_varref"><span class="mpre">read</span></span></a><span class="mpre">
  case </span><a href="#loc_131_3_131_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_131_3_131_5&#39;)"><span class="hl_varref"><span class="mpre">xs</span></span></a><span class="mpre"> of
    (_</span><span class="hl_infix"><span class="mpre">:</span></span><span class="mpre">_) -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
    [] -&gt; do </span><a name="loc_134_14_134_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_14_134_16&#39;)"><span class="hl_vardecl"><span class="mpre">ys</span></span></a><span class="mpre"> &lt;- </span><span class="hl_varref"><span class="mpre">readTVar</span></span><span class="mpre"> </span><a href="#loc_130_28_130_33" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_130_28_130_33&#39;)"><span class="hl_varref"><span class="mpre">write</span></span></a><span class="mpre">
             case </span><a href="#loc_134_14_134_16" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_14_134_16&#39;)"><span class="hl_varref"><span class="mpre">ys</span></span></a><span class="mpre"> of
               [] -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">True</span></span><span class="mpre">
               _  -&gt; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_conref"><span class="mpre">False</span></span><span class="mpre">
</span></div></body></html>