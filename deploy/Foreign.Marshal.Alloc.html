<html><head><title>NemNem</title><link rel="stylesheet" type="text/css" href="static/nemnem.css"><script src="static/jquery-2.0.3.min.js"></script><script src="static/nemnem.js"></script></head><body><div id="code"><span class="mpre">{-# LANGUAGE Trustworthy #-}
{-# LANGUAGE NoImplicitPrelude
           , MagicHash
           , UnboxedTuples
  #-}

</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- |</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Module      :  Foreign.Marshal.Alloc</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Copyright   :  (c) The FFI task force 2001</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- License     :  BSD-style (see the file libraries/base/LICENSE)</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Maintainer  :  ffi@haskell.org</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Stability   :  provisional</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- Portability :  portable</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The module &quot;Foreign.Marshal.Alloc&quot; provides operations to allocate and</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- deallocate blocks of raw memory (i.e., unstructured chunks of memory</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- outside of the area maintained by the Haskell storage manager).  These</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- memory blocks are commonly used to pass compound data structures to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- foreign functions or to provide space in which compound result values</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- are obtained from foreign functions.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If any of the allocation functions fails, an exception is thrown.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- In some cases, memory exhaustion may mean the process is terminated.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If &#39;free&#39; or &#39;reallocBytes&#39; is applied to a memory area</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- that has been allocated with &#39;alloca&#39; or &#39;allocaBytes&#39;, the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- behaviour is undefined.  Any further access to memory areas allocated with</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;alloca&#39; or &#39;allocaBytes&#39;, after the computation that was passed to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the allocation function has terminated, leads to undefined behaviour.  Any</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- further access to the memory area referenced by a pointer passed to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;realloc&#39;, &#39;reallocBytes&#39;, or &#39;free&#39; entails undefined</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- behaviour.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- </span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- All storage allocated by functions that allocate based on a /size in bytes/</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- must be sufficiently aligned for any of the basic foreign types</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- that fits into the newly allocated storage. All storage allocated by</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- functions that allocate based on a specific type must be sufficiently</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- aligned for that type. Array allocation routines need to obey the same</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- alignment constraints for each array element.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-----------------------------------------------------------------------------</span></span><span class="mpre">

module Foreign.Marshal.Alloc (
  </span><span class="hl_comment"><span class="mpre">-- * Memory allocation</span></span><span class="mpre">
  </span><span class="hl_comment"><span class="mpre">-- ** Local allocation</span></span><span class="mpre">
  alloca,
  allocaBytes,
  allocaBytesAligned,

  </span><span class="hl_comment"><span class="mpre">-- ** Dynamic allocation</span></span><span class="mpre">
  malloc,
  mallocBytes,

  realloc,
  reallocBytes,

  free,
  finalizerFree
) where

import Data.Maybe
import Foreign.C.Types          ( CSize(..) )
import Foreign.Storable         ( Storable(sizeOf,alignment) )
import Foreign.ForeignPtr       ( FinalizerPtr )
import GHC.IO.Exception
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 67, srcSpanStartColumn = 8, srcSpanEndLine = 67, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Real&quot;"><span class="mpre">GHC.Real</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 68, srcSpanStartColumn = 8, srcSpanEndLine = 68, srcSpanEndColumn = 15}, srcInfoPoints = []}) &quot;GHC.Ptr&quot;"><span class="mpre">GHC.Ptr</span></span><span class="mpre">
import </span><span class="warning" data-warning="Module not foundModuleName (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 69, srcSpanStartColumn = 8, srcSpanEndLine = 69, srcSpanEndColumn = 16}, srcInfoPoints = []}) &quot;GHC.Base&quot;"><span class="mpre">GHC.Base</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- exported functions</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- ------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- |Allocate a block of memory that is sufficient to hold values of type</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- @a@.  The size of the area allocated is determined by the &#39;sizeOf&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- method from the instance of &#39;Storable&#39; for the appropriate type.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The memory may be deallocated using &#39;free&#39; or &#39;finalizerFree&#39; when</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- no longer required.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_83_1_83_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_7&#39;)"><span class="mpre">malloc</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_83_1_83_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_7&#39;)"><span class="mpre">malloc</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 82, srcSpanStartColumn = 11, srcSpanEndLine = 82, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 82, srcSpanStartColumn = 22, srcSpanEndLine = 82, srcSpanEndColumn = 24}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0"><span class="mpre">Storable a =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_83_1_83_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_83_1_83_7&#39;)"><span class="hl_vardecl"><span class="mpre">malloc</span></span></a><span class="mpre">  = </span><a href="#loc_86_5_86_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_13&#39;)"><span class="hl_varref"><span class="mpre">doMalloc</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre">
  where
    </span><a href="#loc_86_5_86_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_13&#39;)"><span class="mpre">doMalloc</span></a><span class="mpre">       :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 85, srcSpanStartColumn = 23, srcSpanEndLine = 85, srcSpanEndColumn = 36}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 85, srcSpanStartColumn = 34, srcSpanEndLine = 85, srcSpanEndColumn = 36}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0"><span class="mpre">Storable b =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)
    </span><a name="loc_86_5_86_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_5_86_13&#39;)"><span class="hl_fundecl"><span class="mpre">doMalloc</span></span></a><span class="mpre"> </span><a name="loc_86_14_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_14_86_19&#39;)"><span class="hl_vardecl"><span class="mpre">dummy</span></span></a><span class="mpre">  = </span><a href="#loc_96_1_96_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_12&#39;)"><span class="hl_varref"><span class="mpre">mallocBytes</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> </span><a href="#loc_86_14_86_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_86_14_86_19&#39;)"><span class="hl_varref"><span class="mpre">dummy</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |Allocate a block of memory of the given number of bytes.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The block of memory is sufficiently aligned for any of the basic</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- foreign types that fits into a memory block of the allocated size.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The memory may be deallocated using &#39;free&#39; or &#39;finalizerFree&#39; when</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- no longer required.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_96_1_96_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_12&#39;)"><span class="mpre">mallocBytes</span></a><span class="mpre">      :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_96_1_96_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_1_96_12&#39;)"><span class="hl_fundecl"><span class="mpre">mallocBytes</span></span></a><span class="mpre"> </span><a name="loc_96_13_96_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_13_96_17&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre">  = </span><a href="#loc_194_1_194_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_1_194_13&#39;)"><span class="hl_varref"><span class="mpre">failWhenNULL</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;malloc&quot;</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">_malloc</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_96_13_96_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_96_13_96_17&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">))

</span><span class="hl_comment"><span class="mpre">-- |@&#39;alloca&#39; f@ executes the computation @f@, passing as argument</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a pointer to a temporarily allocated block of memory sufficient to</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- hold values of type @a@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The memory is freed when @f@ terminates (either normally or via an</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exception), so the pointer passed to @f@ must /not/ be used after this.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_pragma"><span class="mpre">{-# INLINE </span><a href="#loc_107_1_107_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_1_107_7&#39;)"><span class="mpre">alloca</span></a><span class="mpre"> #-}</span></span><span class="mpre">
</span><a href="#loc_107_1_107_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_1_107_7&#39;)"><span class="mpre">alloca</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 106, srcSpanStartColumn = 11, srcSpanEndLine = 106, srcSpanEndColumn = 24}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 106, srcSpanStartColumn = 22, srcSpanEndLine = 106, srcSpanEndColumn = 24}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4"><span class="mpre">Storable a =&gt;</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
</span><a name="loc_107_1_107_7" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_107_1_107_7&#39;)"><span class="hl_vardecl"><span class="mpre">alloca</span></span></a><span class="mpre">  = </span><a href="#loc_110_5_110_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_5_110_13&#39;)"><span class="hl_varref"><span class="mpre">doAlloca</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre">
  where
    </span><a href="#loc_110_5_110_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_5_110_13&#39;)"><span class="mpre">doAlloca</span></a><span class="mpre">       :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 109, srcSpanStartColumn = 23, srcSpanEndLine = 109, srcSpanEndColumn = 37}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 109, srcSpanStartColumn = 35, srcSpanEndLine = 109, srcSpanEndColumn = 37}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4"><span class="mpre">Storable a&#39; =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a&#39;</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a&#39;</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b&#39;</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b&#39;</span></span><span class="mpre">
    </span><a name="loc_110_5_110_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_5_110_13&#39;)"><span class="hl_fundecl"><span class="mpre">doAlloca</span></span></a><span class="mpre"> </span><a name="loc_110_14_110_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_14_110_19&#39;)"><span class="hl_vardecl"><span class="mpre">dummy</span></span></a><span class="mpre">  = </span><a href="#loc_132_1_132_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_19&#39;)"><span class="hl_varref"><span class="mpre">allocaBytesAligned</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> </span><a href="#loc_110_14_110_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_14_110_19&#39;)"><span class="hl_varref"><span class="mpre">dummy</span></span></a><span class="mpre">) (</span><span class="hl_varref"><span class="mpre">alignment</span></span><span class="mpre"> </span><a href="#loc_110_14_110_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_110_14_110_19&#39;)"><span class="hl_varref"><span class="mpre">dummy</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |@&#39;allocaBytes&#39; n f@ executes the computation @f@, passing as argument</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- a pointer to a temporarily allocated block of memory of @n@ bytes.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The block of memory is sufficiently aligned for any of the basic</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- foreign types that fits into a memory block of the allocated size.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The memory is freed when @f@ terminates (either normally or via an</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- exception), so the pointer passed to @f@ must /not/ be used after this.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_121_1_121_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_1_121_12&#39;)"><span class="mpre">allocaBytes</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
</span><a name="loc_121_1_121_12" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_1_121_12&#39;)"><span class="hl_fundecl"><span class="mpre">allocaBytes</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_121_17_121_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_17_121_21&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre">) </span><a name="loc_121_23_121_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_23_121_29&#39;)"><span class="hl_vardecl"><span class="mpre">action</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_121_39_121_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_39_121_41&#39;)"><span class="hl_vardecl"><span class="mpre">s0</span></span></a><span class="mpre"> -&gt;
     case </span><span class="hl_varref"><span class="mpre">newPinnedByteArray#</span></span><span class="mpre"> </span><a href="#loc_121_17_121_21" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_17_121_21&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_121_39_121_41" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_39_121_41&#39;)"><span class="hl_varref"><span class="mpre">s0</span></span></a><span class="mpre">      of { (# </span><a name="loc_122_52_122_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_52_122_54&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">, </span><a name="loc_122_56_122_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_56_122_62&#39;)"><span class="hl_vardecl"><span class="mpre">mbarr#</span></span></a><span class="mpre"> #) -&gt;
     case </span><span class="hl_varref"><span class="mpre">unsafeFreezeByteArray#</span></span><span class="mpre"> </span><a href="#loc_122_56_122_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_56_122_62&#39;)"><span class="hl_varref"><span class="mpre">mbarr#</span></span></a><span class="mpre"> </span><a href="#loc_122_52_122_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_122_52_122_54&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre"> of { (# </span><a name="loc_123_52_123_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_52_123_54&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">, </span><a name="loc_123_56_123_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_56_123_61&#39;)"><span class="hl_vardecl"><span class="mpre">barr#</span></span></a><span class="mpre">  #) -&gt;
     let </span><a name="loc_124_10_124_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_10_124_14&#39;)"><span class="hl_vardecl"><span class="mpre">addr</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Ptr</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">byteArrayContents#</span></span><span class="mpre"> </span><a href="#loc_123_56_123_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_56_123_61&#39;)"><span class="hl_varref"><span class="mpre">barr#</span></span></a><span class="mpre">) in
     case </span><a href="#loc_121_23_121_29" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_121_23_121_29&#39;)"><span class="hl_varref"><span class="mpre">action</span></span></a><span class="mpre"> </span><a href="#loc_124_10_124_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_124_10_124_14&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre">     of { </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><a name="loc_125_35_125_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_35_125_42&#39;)"><span class="hl_vardecl"><span class="mpre">action&#39;</span></span></a><span class="mpre"> -&gt;
     case </span><a href="#loc_125_35_125_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_125_35_125_42&#39;)"><span class="hl_varref"><span class="mpre">action&#39;</span></span></a><span class="mpre"> </span><a href="#loc_123_52_123_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_52_123_54&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre">      of { (# </span><a name="loc_126_35_126_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_35_126_37&#39;)"><span class="hl_vardecl"><span class="mpre">s3</span></span></a><span class="mpre">, </span><a name="loc_126_39_126_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_39_126_40&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> #) -&gt;
     case </span><span class="hl_varref"><span class="mpre">touch#</span></span><span class="mpre"> </span><a href="#loc_123_56_123_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_123_56_123_61&#39;)"><span class="hl_varref"><span class="mpre">barr#</span></span></a><span class="mpre"> </span><a href="#loc_126_35_126_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_35_126_37&#39;)"><span class="hl_varref"><span class="mpre">s3</span></span></a><span class="mpre"> of { </span><a name="loc_127_32_127_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_32_127_34&#39;)"><span class="hl_vardecl"><span class="mpre">s4</span></span></a><span class="mpre"> -&gt;
     (# </span><a href="#loc_127_32_127_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_127_32_127_34&#39;)"><span class="hl_varref"><span class="mpre">s4</span></span></a><span class="mpre">, </span><a href="#loc_126_39_126_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_126_39_126_40&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> #)
  }}}}}

</span><a href="#loc_132_1_132_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_19&#39;)"><span class="mpre">allocaBytesAligned</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">
</span><a name="loc_132_1_132_19" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_1_132_19&#39;)"><span class="hl_fundecl"><span class="mpre">allocaBytesAligned</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_132_24_132_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_24_132_28&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre">) (</span><span class="hl_conref"><span class="mpre">I#</span></span><span class="mpre"> </span><a name="loc_132_34_132_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_34_132_39&#39;)"><span class="hl_vardecl"><span class="mpre">align</span></span></a><span class="mpre">) </span><a name="loc_132_41_132_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_41_132_47&#39;)"><span class="hl_vardecl"><span class="mpre">action</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_infix"><span class="mpre">$</span></span><span class="mpre"> \ </span><a name="loc_132_57_132_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_57_132_59&#39;)"><span class="hl_vardecl"><span class="mpre">s0</span></span></a><span class="mpre"> -&gt;
     case </span><span class="hl_varref"><span class="mpre">newAlignedPinnedByteArray#</span></span><span class="mpre"> </span><a href="#loc_132_24_132_28" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_24_132_28&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre"> </span><a href="#loc_132_34_132_39" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_34_132_39&#39;)"><span class="hl_varref"><span class="mpre">align</span></span></a><span class="mpre"> </span><a href="#loc_132_57_132_59" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_57_132_59&#39;)"><span class="hl_varref"><span class="mpre">s0</span></span></a><span class="mpre"> of { (# </span><a name="loc_133_60_133_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_60_133_62&#39;)"><span class="hl_vardecl"><span class="mpre">s1</span></span></a><span class="mpre">, </span><a name="loc_133_64_133_70" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_64_133_70&#39;)"><span class="hl_vardecl"><span class="mpre">mbarr#</span></span></a><span class="mpre"> #) -&gt;
     case </span><span class="hl_varref"><span class="mpre">unsafeFreezeByteArray#</span></span><span class="mpre"> </span><a href="#loc_133_64_133_70" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_64_133_70&#39;)"><span class="hl_varref"><span class="mpre">mbarr#</span></span></a><span class="mpre"> </span><a href="#loc_133_60_133_62" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_133_60_133_62&#39;)"><span class="hl_varref"><span class="mpre">s1</span></span></a><span class="mpre"> of { (# </span><a name="loc_134_52_134_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_52_134_54&#39;)"><span class="hl_vardecl"><span class="mpre">s2</span></span></a><span class="mpre">, </span><a name="loc_134_56_134_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_56_134_61&#39;)"><span class="hl_vardecl"><span class="mpre">barr#</span></span></a><span class="mpre">  #) -&gt;
     let </span><a name="loc_135_10_135_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_10_135_14&#39;)"><span class="hl_vardecl"><span class="mpre">addr</span></span></a><span class="mpre"> = </span><span class="hl_conref"><span class="mpre">Ptr</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">byteArrayContents#</span></span><span class="mpre"> </span><a href="#loc_134_56_134_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_56_134_61&#39;)"><span class="hl_varref"><span class="mpre">barr#</span></span></a><span class="mpre">) in
     case </span><a href="#loc_132_41_132_47" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_132_41_132_47&#39;)"><span class="hl_varref"><span class="mpre">action</span></span></a><span class="mpre"> </span><a href="#loc_135_10_135_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_135_10_135_14&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre">     of { </span><span class="hl_conref"><span class="mpre">IO</span></span><span class="mpre"> </span><a name="loc_136_35_136_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_35_136_42&#39;)"><span class="hl_vardecl"><span class="mpre">action&#39;</span></span></a><span class="mpre"> -&gt;
     case </span><a href="#loc_136_35_136_42" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_136_35_136_42&#39;)"><span class="hl_varref"><span class="mpre">action&#39;</span></span></a><span class="mpre"> </span><a href="#loc_134_52_134_54" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_52_134_54&#39;)"><span class="hl_varref"><span class="mpre">s2</span></span></a><span class="mpre">      of { (# </span><a name="loc_137_35_137_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_35_137_37&#39;)"><span class="hl_vardecl"><span class="mpre">s3</span></span></a><span class="mpre">, </span><a name="loc_137_39_137_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_39_137_40&#39;)"><span class="hl_vardecl"><span class="mpre">r</span></span></a><span class="mpre"> #) -&gt;
     case </span><span class="hl_varref"><span class="mpre">touch#</span></span><span class="mpre"> </span><a href="#loc_134_56_134_61" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_134_56_134_61&#39;)"><span class="hl_varref"><span class="mpre">barr#</span></span></a><span class="mpre"> </span><a href="#loc_137_35_137_37" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_35_137_37&#39;)"><span class="hl_varref"><span class="mpre">s3</span></span></a><span class="mpre"> of { </span><a name="loc_138_32_138_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_32_138_34&#39;)"><span class="hl_vardecl"><span class="mpre">s4</span></span></a><span class="mpre"> -&gt;
     (# </span><a href="#loc_138_32_138_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_138_32_138_34&#39;)"><span class="hl_varref"><span class="mpre">s4</span></span></a><span class="mpre">, </span><a href="#loc_137_39_137_40" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_137_39_137_40&#39;)"><span class="hl_varref"><span class="mpre">r</span></span></a><span class="mpre"> #)
  }}}}}

</span><span class="hl_comment"><span class="mpre">-- |Resize a memory area that was allocated with &#39;malloc&#39; or &#39;mallocBytes&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to the size needed to store values of type @b@.  The returned pointer</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- may refer to an entirely different memory area, but will be suitably</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- aligned to hold values of type @b@.  The contents of the referenced</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- memory area will be the same as of the original pointer up to the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- minimum of the original size and the size of values of type @b@.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If the argument to &#39;realloc&#39; is &#39;nullPtr&#39;, &#39;realloc&#39; behaves like</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;malloc&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_153_1_153_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_1_153_8&#39;)"><span class="mpre">realloc</span></a><span class="mpre"> :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 152, srcSpanStartColumn = 12, srcSpanEndLine = 152, srcSpanEndColumn = 25}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 152, srcSpanStartColumn = 23, srcSpanEndLine = 152, srcSpanEndColumn = 25}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4"><span class="mpre">Storable b =&gt;</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b</span></span><span class="mpre">)
</span><a name="loc_153_1_153_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_153_1_153_8&#39;)"><span class="hl_vardecl"><span class="mpre">realloc</span></span></a><span class="mpre">  = </span><a href="#loc_156_5_156_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_5_156_14&#39;)"><span class="hl_varref"><span class="mpre">doRealloc</span></span></a><span class="mpre"> </span><span class="hl_varref"><span class="mpre">undefined</span></span><span class="mpre">
  where
    </span><a href="#loc_156_5_156_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_5_156_14&#39;)"><span class="mpre">doRealloc</span></a><span class="mpre">           :: </span><span class="warning" data-warning="ContextCxSingle (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 155, srcSpanStartColumn = 28, srcSpanEndLine = 155, srcSpanEndColumn = 42}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 155, srcSpanStartColumn = 40, srcSpanEndLine = 155, srcSpanEndColumn = 42}]}) (ClassA (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4"><span class="mpre">Storable b&#39; =&gt;</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b&#39;</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a&#39;</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">b&#39;</span></span><span class="mpre">)
    </span><a name="loc_156_5_156_14" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_5_156_14&#39;)"><span class="hl_fundecl"><span class="mpre">doRealloc</span></span></a><span class="mpre"> </span><a name="loc_156_15_156_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_15_156_20&#39;)"><span class="hl_vardecl"><span class="mpre">dummy</span></span></a><span class="mpre"> </span><a name="loc_156_21_156_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_21_156_24&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre">  = let
                             </span><a name="loc_157_30_157_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_30_157_34&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre"> = </span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">sizeOf</span></span><span class="mpre"> </span><a href="#loc_156_15_156_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_15_156_20&#39;)"><span class="hl_varref"><span class="mpre">dummy</span></span></a><span class="mpre">)
                           in
                           </span><a href="#loc_194_1_194_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_1_194_13&#39;)"><span class="hl_varref"><span class="mpre">failWhenNULL</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;realloc&quot;</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">_realloc</span></span><span class="mpre"> </span><a href="#loc_156_21_156_24" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_156_21_156_24&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a href="#loc_157_30_157_34" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_157_30_157_34&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">)

</span><span class="hl_comment"><span class="mpre">-- |Resize a memory area that was allocated with &#39;malloc&#39; or &#39;mallocBytes&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- to the given size.  The returned pointer may refer to an entirely</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- different memory area, but will be sufficiently aligned for any of the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- basic foreign types that fits into a memory block of the given size.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- The contents of the referenced memory area will be the same as of</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- the original pointer up to the minimum of the original size and the</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- given size.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- If the pointer argument to &#39;reallocBytes&#39; is &#39;nullPtr&#39;, &#39;reallocBytes&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- behaves like &#39;malloc&#39;.  If the requested size is 0, &#39;reallocBytes&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- behaves like &#39;free&#39;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_174_1_174_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_1_174_13&#39;)"><span class="mpre">reallocBytes</span></a><span class="mpre">          :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">Int</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_174_1_174_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_1_174_13&#39;)"><span class="hl_fundecl"><span class="mpre">reallocBytes</span></span></a><span class="mpre"> </span><a name="loc_174_14_174_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_14_174_17&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><span class="hl_num"><span class="mpre">0</span></span><span class="mpre">     = do </span><a href="#loc_184_1_184_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_1_184_5&#39;)"><span class="hl_varref"><span class="mpre">free</span></span></a><span class="mpre"> </span><a href="#loc_174_14_174_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_14_174_17&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre">; </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">nullPtr</span></span><span class="mpre">
</span><a href="#loc_174_1_174_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_174_1_174_13&#39;)"><span class="hl_fundecl"><span class="mpre">reallocBytes</span></span></a><span class="mpre"> </span><a name="loc_175_14_175_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_14_175_17&#39;)"><span class="hl_vardecl"><span class="mpre">ptr</span></span></a><span class="mpre"> </span><a name="loc_175_18_175_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_18_175_22&#39;)"><span class="hl_vardecl"><span class="mpre">size</span></span></a><span class="mpre">  = 
  </span><a href="#loc_194_1_194_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_1_194_13&#39;)"><span class="hl_varref"><span class="mpre">failWhenNULL</span></span></a><span class="mpre"> </span><span class="hl_string"><span class="mpre">&quot;realloc&quot;</span></span><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">_realloc</span></span><span class="mpre"> </span><a href="#loc_175_14_175_17" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_14_175_17&#39;)"><span class="hl_varref"><span class="mpre">ptr</span></span></a><span class="mpre"> (</span><span class="hl_varref"><span class="mpre">fromIntegral</span></span><span class="mpre"> </span><a href="#loc_175_18_175_22" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_175_18_175_22&#39;)"><span class="hl_varref"><span class="mpre">size</span></span></a><span class="mpre">))

</span><span class="hl_comment"><span class="mpre">-- |Free a block of memory that was allocated with &#39;malloc&#39;,</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &#39;mallocBytes&#39;, &#39;realloc&#39;, &#39;reallocBytes&#39;, &#39;Foreign.Marshal.Utils.new&#39;</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- or any of the @new@/X/ functions in &quot;Foreign.Marshal.Array&quot; or</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- &quot;Foreign.C.String&quot;.</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_184_1_184_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_1_184_5&#39;)"><span class="mpre">free</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> </span><span class="hl_tyconref"><span class="mpre">()</span></span><span class="mpre">
</span><a name="loc_184_1_184_5" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_184_1_184_5&#39;)"><span class="hl_vardecl"><span class="mpre">free</span></span></a><span class="mpre">  = </span><span class="hl_varref"><span class="mpre">_free</span></span><span class="mpre">


</span><span class="hl_comment"><span class="mpre">-- auxilliary routines</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- -------------------</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- asserts that the pointer returned from the action in the second argument is</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- non-null</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><a href="#loc_194_1_194_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_1_194_13&#39;)"><span class="mpre">failWhenNULL</span></a><span class="mpre"> :: </span><span class="hl_tyconref"><span class="mpre">String</span></span><span class="mpre"> -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">) -&gt; </span><span class="hl_tyconref"><span class="mpre">IO</span></span><span class="mpre"> (</span><span class="hl_tyconref"><span class="mpre">Ptr</span></span><span class="mpre"> </span><span class="hl_tyvar"><span class="mpre">a</span></span><span class="mpre">)
</span><a name="loc_194_1_194_13" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_1_194_13&#39;)"><span class="hl_fundecl"><span class="mpre">failWhenNULL</span></span></a><span class="mpre"> </span><a name="loc_194_14_194_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_14_194_18&#39;)"><span class="hl_vardecl"><span class="mpre">name</span></span></a><span class="mpre"> </span><a name="loc_194_19_194_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_19_194_20&#39;)"><span class="hl_vardecl"><span class="mpre">f</span></span></a><span class="mpre"> = do
   </span><a name="loc_195_4_195_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_4_195_8&#39;)"><span class="hl_vardecl"><span class="mpre">addr</span></span></a><span class="mpre"> &lt;- </span><a href="#loc_194_19_194_20" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_19_194_20&#39;)"><span class="hl_varref"><span class="mpre">f</span></span></a><span class="mpre">
   if </span><a href="#loc_195_4_195_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_4_195_8&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre"> </span><span class="hl_infix"><span class="mpre">==</span></span><span class="mpre"> </span><span class="hl_varref"><span class="mpre">nullPtr</span></span><span class="mpre">
      then </span><a href="GHC.IO.Exception.html#loc_221_1_221_8" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_221_1_221_8&#39;)"><span class="hl_varref"><span class="mpre">ioError</span></span></a><span class="mpre"> (</span><span class="hl_conref"><span class="mpre">IOError</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="GHC.IO.Exception.html#loc_262_5_262_22" onmouseover="nemnem.highlightLocalToRemote(&#39;GHC.IO.Exception.html#loc_262_5_262_22&#39;)"><span class="hl_conref"><span class="mpre">ResourceExhausted</span></span></a><span class="mpre"> </span><a href="#loc_194_14_194_18" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_194_14_194_18&#39;)"><span class="hl_varref"><span class="mpre">name</span></span></a><span class="mpre"> 
                                        </span><span class="hl_string"><span class="mpre">&quot;out of memory&quot;</span></span><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre"> </span><a href="Data.Maybe.html#loc_49_19_49_26" onmouseover="nemnem.highlightLocalToRemote(&#39;Data.Maybe.html#loc_49_19_49_26&#39;)"><span class="hl_conref"><span class="mpre">Nothing</span></span></a><span class="mpre">)
      else </span><span class="hl_varref"><span class="mpre">return</span></span><span class="mpre"> </span><a href="#loc_195_4_195_8" onmouseover="nemnem.highlightLocalToLocal(&#39;loc_195_4_195_8&#39;)"><span class="hl_varref"><span class="mpre">addr</span></span></a><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- basic C routines needed for memory allocation</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">--</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 203, srcSpanStartColumn = 1, srcSpanEndLine = 203, srcSpanEndColumn = 88}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 203, srcSpanStartColumn = 1, srcSpanEndLine = 203, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanSta"><span class="mpre">foreign import ccall unsafe &quot;stdlib.h malloc&quot;  _malloc  ::          CSize -&gt; IO (Ptr a)</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 204, srcSpanStartColumn = 1, srcSpanEndLine = 204, srcSpanEndColumn = 88}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 204, srcSpanStartColumn = 1, srcSpanEndLine = 204, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanSta"><span class="mpre">foreign import ccall unsafe &quot;stdlib.h realloc&quot; _realloc :: Ptr a -&gt; CSize -&gt; IO (Ptr b)</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 205, srcSpanStartColumn = 1, srcSpanEndLine = 205, srcSpanEndColumn = 74}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 205, srcSpanStartColumn = 1, srcSpanEndLine = 205, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanSta"><span class="mpre">foreign import ccall unsafe &quot;stdlib.h free&quot;    _free    :: Ptr a -&gt; IO ()</span></span><span class="mpre">

</span><span class="hl_comment"><span class="mpre">-- | A pointer to a foreign function equivalent to &#39;free&#39;, which may be</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- used as a finalizer (cf &#39;Foreign.ForeignPtr.ForeignPtr&#39;) for storage</span></span><span class="mpre">
</span><span class="hl_comment"><span class="mpre">-- allocated with &#39;malloc&#39;, &#39;mallocBytes&#39;, &#39;realloc&#39; or &#39;reallocBytes&#39;.</span></span><span class="mpre">
</span><span class="warning" data-warning="DeclForImp (SrcSpanInfo {srcInfoSpan = SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 210, srcSpanStartColumn = 1, srcSpanEndLine = 210, srcSpanEndColumn = 77}, srcInfoPoints = [SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanStartLine = 210, srcSpanStartColumn = 1, srcSpanEndLine = 210, srcSpanEndColumn = 8},SrcSpan {srcSpanFilename = &quot;/home/vagrant/nemnem/pull/base-4.7.0.0/Foreign/Marshal/Alloc.hs&quot;, srcSpanSta"><span class="mpre">foreign import ccall unsafe &quot;stdlib.h &amp;free&quot; finalizerFree :: FinalizerPtr a</span></span><span class="mpre">

</span></div></body></html>